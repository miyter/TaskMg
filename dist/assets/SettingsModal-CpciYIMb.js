import{r as p,j as e}from"./react-vendor-D2I7O6xs.js";import{r as T,t as Q,v as F,j as N,u as B,k as q,I as w,B as h,w as L,c as Y,d as Z,a as M,x as P,y as R,z as ee,A as te,D as ae,E as se,F as re,G as ne,H as oe,l as le,J as ie,S as W,U as K,K as de,L as ce}from"./main-ClMj7z8a.js";import{u as G}from"./i18n-Cw5F73yC.js";import{M as me}from"./Modal-DaVDF2P-.js";import{l as ge,d as ue,w as xe,j as pe,r as he,E as be,x as fe}from"./firebase-CLDmeQtM.js";import"./vendor-CBsUEP5T.js";import"./dnd-CO_aCEbe.js";async function ye(s){const i=T.currentUser;if(!i)throw new Error("User not authenticated");const c=Q.tasks(i.uid,s),m=(await ge(ue(F,c))).docs.map(n=>({id:n.id,...n.data()})),d=new Map;for(const n of m){if(!n.title)continue;const r=n.title.trim(),g=d.get(r)||[];g.push(n),d.set(r,g)}const l=[];for(const[n,r]of d.entries())if(r.length>1){r.sort((u,k)=>{const v=b=>{if(!b)return 0;if(typeof b=="object"&&"toDate"in b&&typeof b.toDate=="function")return b.toDate().getTime();const f=new Date(b);return isNaN(f.getTime())?0:f.getTime()},o=v(u.createdAt),x=v(k.createdAt);return o-x});const g=r.slice(1);for(const u of g)u.id&&l.push(u.id)}if(l.length>0)for(let n=0;n<l.length;n+=500){const r=xe(F),g=l.slice(n,n+500);for(const u of g)r.delete(pe(F,c,u));await r.commit()}return l.length}const E=({title:s,children:i,defaultOpen:c=!1,icon:t,className:m})=>{const[d,l]=p.useState(c);return e.jsxs("section",{className:N("border border-gray-200 dark:border-gray-700/50 rounded-xl overflow-hidden",m),children:[e.jsxs("button",{onClick:()=>l(!d),className:"w-full flex items-center justify-between p-4 bg-gray-50/50 dark:bg-gray-800/30 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",type:"button","aria-expanded":d,"aria-controls":`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t&&e.jsx("span",{className:"text-lg",children:t}),e.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:s})]}),e.jsx("svg",{className:N("w-4 h-4 text-gray-400 transition-transform duration-200",d&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx("div",{id:`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,className:N("transition-all duration-100 ease-in-out overflow-hidden bg-white dark:bg-transparent",d?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700/30",children:i})})]})},je=()=>{const{t:s}=B(),{customDurations:i,setCustomDurations:c}=G(),[t,m]=p.useState(""),d=()=>{const r=parseInt(t,10);!isNaN(r)&&r>0&&!i.includes(r)&&(c([...i,r]),m(""))},l=r=>{c(i.filter(g=>g!==r))},n=r=>{r.key==="Enter"&&d()};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"â±ï¸"})," ",s("durations")]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:i.map(r=>e.jsxs("div",{className:"flex items-center gap-2 pl-3 pr-2 py-1.5 bg-white dark:bg-gray-700/50 rounded-lg text-sm border border-gray-200 dark:border-gray-600 shadow-sm",children:[e.jsxs("span",{className:"font-mono font-medium",children:[r," min"]}),e.jsx("button",{onClick:()=>l(r),className:"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 p-1 rounded transition-colors",title:s("delete"),children:e.jsx(q,{className:"w-3 h-3"})})]},r))}),e.jsxs("div",{className:"flex gap-2 items-center mt-2",children:[e.jsxs("div",{className:"relative w-24",children:[e.jsx(w,{type:"number",value:t,onChange:r=>m(r.target.value),onKeyDown:n,placeholder:"60",className:"h-9 text-sm"}),e.jsx("span",{className:"absolute right-8 top-1/2 -translate-y-1/2 text-xs text-gray-400 pointer-events-none",children:"min"})]}),e.jsxs(h,{onClick:d,size:"sm",variant:"secondary",disabled:!t,className:"h-9",children:[e.jsx(L,{className:"w-4 h-4"}),s("add")]})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.duration.description")||"Custom durations for task estimation."})]})},ke=()=>{const{t:s}=B(),{timeBlocks:i}=Y(),{workspaceId:c}=Z(),{openModal:t}=M(),[m,d]=p.useState(null),[l,n]=p.useState({}),r=o=>{d(o.id||null),n({...o})},g=()=>{d("new"),n({name:"",start:"09:00",end:"10:00",color:"#3b82f6"})},u=()=>{d(null),n({})},k=async()=>{!c||!l.start||!l.end||(await te(c,l),d(null),n({}))},v=(o,x)=>{c&&t("confirmation",{title:s("delete"),message:`${s("timeblocks")}: ${x||"Time Block"}
${s("msg.confirm_delete")}`,confirmLabel:s("delete"),variant:"danger",onConfirm:async()=>{await ae(c,o)}})};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"})," ",s("timeblocks")]}),m!=="new"&&e.jsxs(h,{onClick:g,size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 h-8 px-2",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),s("add")]})]}),e.jsxs("div",{className:"space-y-2",children:[i.length===0&&m!=="new"&&e.jsx("div",{className:"text-sm text-gray-500 italic py-2",children:s("no_items")||"No time blocks defined."}),i.map(o=>e.jsx("div",{className:"group flex items-center gap-3 p-3 bg-white dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm transition-all",children:m===o.id?e.jsxs("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(w,{value:l.name||"",onChange:x=>n({...l,name:x.target.value}),placeholder:"Name (Optional)",className:"h-8 text-sm col-span-2 sm:col-span-1"}),e.jsx(w,{type:"time",value:l.start||"",onChange:x=>n({...l,start:x.target.value}),className:"h-8 text-sm"}),e.jsx(w,{type:"time",value:l.end||"",onChange:x=>n({...l,end:x.target.value}),className:"h-8 text-sm"}),e.jsxs("div",{className:"flex items-center gap-1 justify-end col-span-2 sm:col-span-1",children:[e.jsx(h,{onClick:k,size:"sm",variant:"primary",className:"h-8 w-8 p-0 rounded-full",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(h,{onClick:u,size:"sm",variant:"ghost",className:"h-8 w-8 p-0 rounded-full text-gray-500",children:e.jsx(R,{className:"w-4 h-4"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1 h-8 rounded-full flex-shrink-0",style:{backgroundColor:o.color||"#ccc"}}),e.jsxs("div",{className:"flex-1 min-w-0 grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm",children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200 truncate",children:o.name||"(No Name)"}),e.jsxs("span",{className:"font-mono text-gray-500 text-xs sm:text-sm",children:[o.start," - ",o.end]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>r(o),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:e.jsx(ee,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(o.id,o.name||""),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(q,{className:"w-4 h-4"})})]})]})},o.id)),m==="new"&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800 animate-in fade-in slide-in-from-top-2",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(w,{value:l.name||"",onChange:o=>n({...l,name:o.target.value}),placeholder:"Name",className:"h-9 text-sm col-span-2 sm:col-span-1 bg-white dark:bg-gray-800",autoFocus:!0}),e.jsx(w,{type:"time",value:l.start||"",onChange:o=>n({...l,start:o.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsx(w,{type:"time",value:l.end||"",onChange:o=>n({...l,end:o.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsxs("div",{className:"flex items-center gap-2 justify-end col-span-2 sm:col-span-1",children:[e.jsx(h,{onClick:k,size:"sm",variant:"primary",className:"h-9 w-9 p-0 rounded-full",children:e.jsx(P,{className:"w-4 h-4"})}),e.jsx(h,{onClick:u,size:"sm",variant:"ghost",className:"h-9 w-9 p-0 rounded-full text-gray-500 hover:bg-white dark:hover:bg-gray-800",children:e.jsx(R,{className:"w-4 h-4"})})]})]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.timeblocks.description")||"Time blocks help you organize your day."})]})},ve=()=>{const{t:s}=B(),{user:i}=se(),{openModal:c}=M(),[t,m]=p.useState(""),[d,l]=p.useState(""),[n,r]=p.useState(!1),[g,u]=p.useState(!1),[k,v]=p.useState(null);if(!i)return e.jsx("div",{className:"text-center text-gray-500",children:s("settings_modal.account.not_logged_in")});const o=i.isAnonymous,x=async f=>{f.preventDefault(),u(!0),v(null);try{const C=be.credential(t,d);await fe(i,C),oe.success(s("settings_modal.account.register_success"))}catch(C){console.error("Link account error:",C);let y=s("settings_modal.account.register_fail");C.code==="auth/email-already-in-use"&&(y=s("settings_modal.account.already_in_use")),C.code==="auth/weak-password"&&(y=s("settings_modal.account.weak_password")),v(y)}finally{u(!1)}},b=()=>{c("confirmation",{title:s("settings_modal.account.logout"),message:s("settings_modal.account.logout_confirm"),confirmLabel:s("settings_modal.account.logout"),variant:"danger",onConfirm:async()=>{await he(T),window.location.reload()}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-6 flex flex-col sm:flex-row items-center gap-8 sm:gap-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-3xl shrink-0",children:o?"ðŸ•µï¸":"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:o?s("settings_modal.account.guest_user"):i.displayName||s("settings_modal.account.registered_user")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono mb-4 break-all",children:o?`ID: ${i.uid.slice(0,8)}...`:i.email}),!o&&e.jsx(h,{variant:"ghost",size:"sm",onClick:b,className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 font-bold",children:s("settings_modal.account.logout")})]})]}),o?e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx("svg",{className:"w-32 h-32 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"})," ",s("settings_modal.account.persist_account")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6 leading-relaxed whitespace-pre-wrap",children:s("settings_modal.account.persist_desc")}),e.jsxs("form",{onSubmit:x,className:"space-y-4 max-w-md",children:[k&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-lg font-medium",children:k}),e.jsx(w,{id:"account-email",type:"email",label:s("settings_modal.account.email_label"),required:!0,value:t,onChange:f=>m(f.target.value),placeholder:"mail@example.com",autoComplete:"email"}),e.jsx(w,{id:"account-password",type:n?"text":"password",label:s("settings_modal.account.password_label"),required:!0,minLength:6,value:d,onChange:f=>l(f.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"new-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>r(!n),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none p-1 pointer-events-auto","aria-label":s(n?"settings_modal.account.hide_password":"settings_modal.account.show_password"),children:n?e.jsx(re,{size:20}):e.jsx(ne,{size:20})})}),e.jsx(h,{type:"submit",isLoading:g,className:"w-full",rightIcon:g?void 0:e.jsx("span",{children:"â†’"}),children:s("settings_modal.account.register")})]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:s("settings_modal.account.registered_msg")})})]})},O=({active:s,onClick:i,label:c,icon:t})=>e.jsxs("button",{onClick:i,className:N("flex items-center gap-2 px-4 py-2 text-sm rounded-lg transition-all whitespace-nowrap min-w-0","md:w-full md:justify-start md:text-left md:py-2","flex-col w-full justify-center py-3 text-[10px] gap-1 rounded-none md:rounded-lg md:text-sm md:flex-row md:gap-3",s?"bg-white dark:bg-gray-800 shadow-sm text-blue-600 dark:text-blue-400 font-bold border-t-2 md:border-t-0 md:border md:border-gray-100 dark:md:border-gray-700 border-blue-500 md:border-transparent":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-200 border-t-2 md:border-t-0 border-transparent"),children:[e.jsx("span",{className:"text-lg md:text-base",children:t}),e.jsx("span",{className:"truncate font-medium",children:c})]}),De=({isOpen:s,zIndex:i,overlayClassName:c})=>{const{t}=B(),{closeModal:m,openModal:d}=M(),{themeMode:l,setThemeMode:n,density:r,setDensity:g,fontSize:u,setFontSize:k,fontEn:v,setFontEn:o,fontJp:x,setFontJp:b,language:f,setLanguage:C}=G(),{currentWorkspaceId:y}=le(),{addToast:S}=ie(),[j,I]=p.useState("appearance"),[U,V]=p.useState(!1),H=!!s;return e.jsx(me,{isOpen:H,onClose:m,title:t("settings_modal.title"),className:"w-full h-full p-0 overflow-hidden",zIndex:i,size:"xl",variant:"side-right",overlayClassName:c,children:e.jsxs("div",{className:"flex flex-col md:flex-row h-full",children:[e.jsx("div",{className:"order-last md:order-first w-full md:w-64 bg-white dark:bg-gray-900 md:bg-gray-50/50 md:dark:bg-gray-900/50 border-t md:border-t-0 md:border-r border-gray-200 dark:border-gray-700 shrink-0 z-10",children:e.jsxs("div",{className:"flex flex-row md:flex-col justify-around md:justify-start md:p-4 md:space-y-2 pb-safe md:pb-4",children:[e.jsx(O,{active:j==="general",onClick:()=>I("general"),label:t("settings_modal.tabs.general"),icon:"âš™ï¸"}),e.jsx(O,{active:j==="appearance",onClick:()=>I("appearance"),label:t("settings_modal.tabs.appearance"),icon:"ðŸŽ¨"}),e.jsx(O,{active:j==="schedule",onClick:()=>I("schedule"),label:t("settings_modal.tabs.schedule")||"Schedule",icon:"ðŸ“…"}),e.jsx(O,{active:j==="account",onClick:()=>I("account"),label:t("settings_modal.tabs.account"),icon:"ðŸ‘¤"}),e.jsx(O,{active:j==="advanced",onClick:()=>I("advanced"),label:t("settings_modal.tabs.advanced"),icon:"âš¡"})]})}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto custom-scrollbar bg-white dark:bg-gray-900 order-first md:order-last relative",children:[j==="appearance"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(E,{title:t("settings_modal.appearance.theme"),icon:"ðŸŒ“",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["light","dark","system"].map(a=>e.jsx("button",{onClick:()=>n(a),className:N("p-3 border rounded-xl text-sm font-medium transition-all",l===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:e.jsx("span",{className:"capitalize",children:t(`settings_modal.options.theme.${a}`)})},a))})}),e.jsx(E,{title:t("settings_modal.appearance.density"),icon:"ðŸ“",defaultOpen:!1,children:e.jsx("div",{className:"space-y-3",children:["compact","normal","comfortable","spacious"].map(a=>e.jsxs("label",{htmlFor:`density-${a}`,className:N("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors",r===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/10":"border-transparent hover:bg-white dark:hover:bg-gray-800"),children:[e.jsx("div",{className:N("w-4 h-4 rounded-full border flex items-center justify-center",r===a?"border-blue-500 bg-blue-500":"border-gray-300"),children:r===a&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("input",{id:`density-${a}`,type:"radio",name:"density",checked:r===a,onChange:()=>g(a),className:"hidden"}),e.jsx("span",{className:"capitalize text-sm font-medium text-gray-700 dark:text-gray-300",children:t(`settings_modal.options.density.${a}`)})]},a))})}),e.jsx(E,{title:t("settings_modal.appearance.font_size"),icon:"Aa",defaultOpen:!1,children:e.jsx("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:["sm","base","md","lg","xl"].map(a=>e.jsx("button",{onClick:()=>k(a),className:N("flex-1 py-1.5 px-3 rounded text-sm font-medium transition-all",u===a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:a},a))})}),e.jsxs(E,{title:t("settings_modal.appearance.fonts"),icon:"Tt",defaultOpen:!1,children:[e.jsx(W,{id:"settings-font-en",name:"fontEn",label:t("settings_modal.appearance.font_en"),value:v,onChange:a=>o(a.target.value),options:K.FONTS.EU}),e.jsx(W,{id:"settings-font-jp",name:"fontJp",label:t("settings_modal.appearance.font_jp"),value:x,onChange:a=>b(a.target.value),options:K.FONTS.JP})]})]}),j==="schedule"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(ke,{}),e.jsx(je,{})]}),j==="general"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¾"})," ",t("settings_modal.backup.title")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:t("settings_modal.backup.description")}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx(h,{onClick:async()=>{if(!(!T.currentUser||!y))try{const a=await de(T.currentUser.uid,y),z=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),D=URL.createObjectURL(z),_=document.createElement("a");_.href=D,_.download=`taskmg-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(D),S(t("settings_modal.backup.create_success"),"success")}catch(a){console.error(a),S(t("settings_modal.backup.create_fail"),"error")}},variant:"premium",leftIcon:e.jsx(L,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.create")}),e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx("input",{type:"file",accept:".json",className:"hidden",id:"backup-import-input",onChange:a=>{var D;const z=(D=a.target.files)==null?void 0:D[0];!z||!T.currentUser||!y||(a.target.value="",d("confirmation",{title:t("settings_modal.backup.import"),message:t("settings_modal.backup.import_confirm"),confirmLabel:t("modal.ok"),variant:"danger",onConfirm:()=>{const _=new FileReader;_.onload=async X=>{var $;try{const A=JSON.parse(($=X.target)==null?void 0:$.result),J=await ce(T.currentUser.uid,y,A);S(t("settings_modal.backup.import_success").replace("{tasks}",String(J.tasksCount)).replace("{projects}",String(J.projectsCount)),"success"),setTimeout(()=>{window.location.reload()},1e3)}catch(A){console.error(A),S(t("settings_modal.backup.import_fail"),"error")}},_.readAsText(z)}}))}}),e.jsx(h,{variant:"secondary",onClick:()=>{var a;return(a=document.getElementById("backup-import-input"))==null?void 0:a.click()},leftIcon:e.jsx(L,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.import")})]})]})]}),e.jsx(E,{title:t("settings_modal.language.title"),icon:"ðŸŒ",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{code:"ja",label:"æ—¥æœ¬èªž"},{code:"en",label:"English"}].map(a=>e.jsxs("button",{onClick:()=>C(a.code),className:N("p-3 border rounded-xl text-sm font-medium transition-all",f===a.code?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:[e.jsx("span",{className:"text-xl mr-2",children:a.code==="ja"?"ðŸ‡¯ðŸ‡µ":"ðŸ‡ºðŸ‡¸"}),a.label]},a.code))})})]}),j==="account"&&e.jsx(ve,{}),j==="advanced"&&e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/30",children:[e.jsxs("h4",{className:"font-bold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ§¹"})," ",t("settings_modal.maintenance.title")]}),e.jsx("p",{className:"text-sm text-red-600/80 dark:text-red-400/80 mb-4",children:t("settings_modal.maintenance.description")}),e.jsxs("label",{htmlFor:"backup-confirm-checkbox",className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{id:"backup-confirm-checkbox",name:"backupConfirmed",type:"checkbox",className:"w-4 h-4 text-red-600 rounded border-red-300 focus:ring-red-500",checked:U,onChange:a=>V(a.target.checked)}),e.jsx("span",{className:"text-sm font-bold text-red-700 dark:text-red-400",children:t("settings_modal.maintenance.confirm_backup")})]}),e.jsx(h,{onClick:()=>{y&&d("confirmation",{title:t("settings_modal.maintenance.title"),message:t("settings_modal.maintenance.confirm_final"),confirmLabel:t("settings_modal.maintenance.cleanup_duplicate"),variant:"danger",onConfirm:async()=>{try{const a=await ye(y);S(t("settings_modal.maintenance.cleanup_success").replace("{count}",String(a)),"success"),a>0&&setTimeout(()=>{window.location.reload()},1e3)}catch(a){console.error(a),S(t("settings_modal.maintenance.cleanup_fail").replace("{error}",a.message),"error")}}})},disabled:!U,variant:"danger",children:t("settings_modal.maintenance.cleanup_duplicate")})]})})]})]})})};export{De as SettingsModal};
