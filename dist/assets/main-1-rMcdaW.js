const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FilterEditModal-C3IZoqEH.js","assets/vendor-B1PbPNG1.js","assets/vendor-DKQ_J0ve.css","assets/i18n-wsfI0CSL.js","assets/firebase-DyJWnMqn.js","assets/ErrorMessage-B7n1AM_t.js","assets/Modal-Dh8Gz3hP.js","assets/Input-DZ3fag93.js","assets/LabelEditModal-l_0tSZXp.js","assets/ProjectEditModal-D74sltbz.js","assets/SettingsModal-oGEv2yFj.js","assets/TaskDetailModal-WAD8ZMys.js","assets/editor-CiKN4Fmo.js","assets/TimeBlockEditModal-WlOEppyp.js","assets/WorkspaceEditModal-h8XmMtIt.js","assets/WikiFrameworkModal-Cq7HwT7h.js","assets/wiki-data-oXipE0KF.js","assets/ConfirmationModal-DEfBdxug.js","assets/DashboardApp-CnzqAJAO.js","assets/targets-DUpeEqMU.js","assets/WikiApp-BaAIzRdU.js","assets/WizardApp-DKQK2pvg.js","assets/GeneralDashboard-DgOkmJVO.js","assets/SearchView-Dfo4dqnO.js"])))=>i.map(i=>d[i]);
var Nr=Object.defineProperty;var Er=(e,t,r)=>t in e?Nr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var H=(e,t,r)=>Er(e,typeof t!="symbol"?t+"":t,r);import{d as I,j as s,g as ye,Q as Tr,T as Cr,p as qe,c as S,U as Xt,V as Sr,W as Ar,X as f,Y as W,$ as se,a0 as Y,a1 as ze,a2 as st,a3 as Yt,a4 as at,a5 as Mr,a6 as Ce,a7 as Lr,y as Fr,a8 as Rr,a9 as Pr,aa as mt,ab as Me,i as Br,ac as ft,ad as He,S as xt,J as bt,L as nt,ae as Or,F as Wr,G as Rt,af as $r,P as zr,H as Ur,ag as Vr,ah as qr,I as Hr,ai as Kr,aj as Xr,ak as Yr}from"./vendor-B1PbPNG1.js";import{a as Pt,i as Gr,b as Jr,e as Zr,f as Qr,h as es,j as Gt,k as ts,T as Le,o as Fe,q as ce,m as yt,c as A,n as Jt,w as rs,g as oe,p as ke,r as K,d as F,u as Ne,t as Ee,v as ss,s as as,x as ns,y as Ae,z as Zt}from"./firebase-DyJWnMqn.js";import{u as q,g as Re,t as Bt,i as os}from"./i18n-wsfI0CSL.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const is="modulepreload",cs=function(e){return"/"+e},Ot={},z=function(t,r,a){let n=Promise.resolve();if(r&&r.length>0){let i=function(d){return Promise.all(d.map(u=>Promise.resolve(u).then(h=>({status:"fulfilled",value:h}),h=>({status:"rejected",reason:h}))))};document.getElementsByTagName("link");const c=document.querySelector("meta[property=csp-nonce]"),l=(c==null?void 0:c.nonce)||(c==null?void 0:c.getAttribute("nonce"));n=i(r.map(d=>{if(d=cs(d),d in Ot)return;Ot[d]=!0;const u=d.endsWith(".css"),h=u?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${h}`))return;const p=document.createElement("link");if(p.rel=u?"stylesheet":is,u||(p.as="script"),p.crossOrigin="",p.href=d,l&&p.setAttribute("nonce",l),document.head.appendChild(p),u)return new Promise((y,b)=>{p.addEventListener("load",y),p.addEventListener("error",()=>b(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const c=new Event("vite:preloadError",{cancelable:!0});if(c.payload=i,window.dispatchEvent(c),!c.defaultPrevented)throw i}return n.then(i=>{for(const c of i||[])c.status==="rejected"&&o(c.reason);return t().catch(o)})},ls={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function ds(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return window.GLOBAL_FIREBASE_CONFIG;try{const e=ls;if(e&&e.VITE_FIREBASE_API_KEY)return{apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}const de=ds();if(!(de!=null&&de.apiKey)||!(de!=null&&de.projectId)){const e="[Firebase] Configuration is missing required fields (apiKey, projectId). Application cannot start.";throw console.error(e,de),new Error(e)}let ot;Pt().length>0?ot=Pt()[0]:ot=Gr(de);const Qt=ot,C=Jr(Qt,{persistence:es,popupRedirectResolver:Qr}),w=Zr(Qt),P=()=>{const e=q(r=>r.language);return I.useMemo(()=>Re(e),[e])},us=()=>{const{t:e}=P(),[t,r]=I.useState(""),[a,n]=I.useState(""),[o,i]=I.useState(!1),[c,l]=I.useState(null),d=async h=>{h.preventDefault(),l(null),i(!0);try{await Gt(C,t,a)}catch(p){let y=e("login.error.login_fail");switch(p.code){case"auth/invalid-email":y=e("login.error.invalid_email");break;case"auth/user-disabled":y=e("login.error.user_disabled");break;case"auth/user-not-found":y=e("login.error.user_not_found");break;case"auth/wrong-password":y=e("login.error.wrong_password");break;case"auth/too-many-requests":y=e("login.error.too_many_requests");break;case"auth/network-request-failed":y=e("login.error.network_error");break}l(y)}finally{i(!1)}},u=async()=>{l(null),i(!0);try{await ts(C)}catch(h){l(e("login.error.guest_fail").replace("{message}",h.message))}finally{i(!1)}};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-premium-gradient p-4 antialiased",children:s.jsxs("div",{className:"max-w-md w-full p-6 sm:p-8 bg-white/70 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/30 rounded-[2rem] shadow-2xl transition-all duration-300",children:[s.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[s.jsx("div",{className:"inline-flex items-center justify-center p-4 bg-white dark:bg-gray-700 rounded-3xl shadow-lg mb-6 animate-float",children:s.jsx("img",{src:"/images/web-app-manifest-512x512.png",alt:"Logo",className:"h-12 w-12"})}),s.jsxs("h1",{className:"text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight",children:["Task",s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:e("login.tagline")})]}),s.jsxs("form",{onSubmit:d,className:"space-y-5 sm:space-y-6",children:[c&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-xl font-medium animate-in fade-in slide-in-from-top-4 duration-300 shadow-sm",children:c}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-email",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.email_label")}),s.jsx("input",{id:"login-email",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:h=>r(h.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"mail@example.com"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-password",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.password_label")}),s.jsx("input",{id:"login-password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:a,onChange:h=>n(h.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),s.jsx("button",{type:"submit",disabled:o,className:"btn-premium w-full py-4 text-lg shadow-lg hover:shadow-xl active:scale-[0.98] transition-all",children:e(o?"login.signing_in":"login.signin")})]}),s.jsxs("div",{className:"mt-8",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-gray-200/50 dark:border-gray-700/50"})}),s.jsx("div",{className:"relative flex justify-center text-xs",children:s.jsx("span",{className:"px-3 bg-transparent text-gray-400 uppercase tracking-widest font-bold",children:e("login.or")})})]}),s.jsxs("button",{onClick:u,disabled:o,className:"mt-8 w-full py-3.5 bg-gray-100/50 hover:bg-gray-200/70 active:bg-gray-300 dark:bg-gray-700/30 dark:hover:bg-gray-600/50 dark:active:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-3 border border-transparent hover:border-gray-300 dark:hover:border-gray-600",children:[s.jsx("span",{className:"text-xl",children:"ðŸ•µï¸"})," ",e("login.guest_login")]})]})]})})},hs={success:3e3,info:4e3,error:6e3},$e=new Map,ps=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,11),Se=ye(e=>({toasts:[],addToast:(t,r="info")=>{const a=ps();e(i=>({toasts:[...i.toasts,{id:a,message:t,type:r}]}));const n=hs[r],o=setTimeout(()=>{e(i=>({toasts:i.toasts.filter(c=>c.id!==a)})),$e.delete(a)},n);$e.set(a,o)},removeToast:t=>{const r=$e.get(t);r&&(clearTimeout(r),$e.delete(t)),e(a=>({toasts:a.toasts.filter(n=>n.id!==t)}))}})),M={success:e=>Se.getState().addToast(e,"success"),error:e=>Se.getState().addToast(e,"error"),info:e=>Se.getState().addToast(e,"info")},gs=Object.freeze(Object.defineProperty({__proto__:null,toast:M,useToastStore:Se},Symbol.toStringTag,{value:"Module"}));function E(...e){return Tr(Cr(e))}const ms=()=>{const{t:e}=P(),{toasts:t,removeToast:r}=Se();return t.length===0?null:s.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:t.map(a=>s.jsx("div",{onClick:()=>r(a.id),className:E("pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-xl shadow border text-sm font-medium cursor-pointer hover:opacity-90",a.type==="success"&&"bg-white dark:bg-gray-800 text-green-600 dark:text-green-400 border-green-200 dark:border-green-900",a.type==="error"&&"bg-white dark:bg-gray-800 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900",a.type==="info"&&"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-700"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[a.type==="success"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),a.type==="error"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),a.type==="info"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{className:"leading-5 flex-1",children:a.message}),s.jsx("button",{onClick:n=>{n.stopPropagation(),r(a.id)},className:"flex-shrink-0 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":e("close"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})},a.id))})},j={Z_INDEX:{BASE:0,SIDEBAR_BACKDROP:20,SIDEBAR_MOBILE:30,SIDEBAR_RESIZER:40,DROPDOWN:50,STICKY:100,MODAL_BACKDROP:9990,MODAL:9991,POPOVER_BACKDROP:9998,POPOVER:9999,TOOLTIP:1e4,TOAST:10001},DEFAULT_COLORS:{PROJECT:"#7E57C2",PROJECT_INACTIVE:"#cccccc",LABEL:"#42A5F5",TIME_BLOCK:"#3B82F6",TIME_BLOCK_INACTIVE:"#cccccc",LABEL_INACTIVE:"#9ca3af"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},SIDEBAR_DENSITY:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},DND:{PREFIX_TASK:"task:",PREFIX_PROJECT:"project:",PREFIX_FILTER:"filter:",TYPE_PROJECT:"project",TYPE_INBOX:"inbox",TYPE_TIMEBLOCK:"timeblock",TYPE_LABEL:"label",TOUCH_DELAY:250},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order",FONT_EN:"font_family_en",FONT_JP:"font_family_jp",FONT_SIZE:"fontSize"},SIDEBAR:{MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DURATIONS:[30,45,60,75,90]},TIME_BLOCK:{MAX_COUNT:10,DEFAULTS:[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}]},LAYOUT:{CONTAINER_WIDTH_CLASS:"w-full max-w-full",MOBILE_SIDEBAR_WIDTH_PX:280},FONTS:{EU:[{label:"Google Sans",value:'"Google Sans", Inter, sans-serif'},{label:"Inter",value:"Inter, sans-serif"},{label:"Roboto",value:"Roboto, sans-serif"},{label:"System UI",value:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}],JP:[{label:"M PLUS 2",value:'"M PLUS 2", sans-serif'},{label:"Noto Sans JP",value:'"Noto Sans JP", sans-serif'},{label:"Hiragino / Yu Gothic",value:'"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif'}]}},fs=[{value:"#EF5350",key:"red"},{value:"#EC407A",key:"pink"},{value:"#AB47BC",key:"purple"},{value:"#7E57C2",key:"deep_purple"},{value:"#5C6BC0",key:"indigo"},{value:"#42A5F5",key:"blue"},{value:"#29B6F6",key:"light_blue"},{value:"#26C6DA",key:"cyan"},{value:"#26A69A",key:"teal"},{value:"#66BB6A",key:"green"},{value:"#9CCC65",key:"light_green"},{value:"#D4E157",key:"lime"},{value:"#FFEE58",key:"yellow"},{value:"#FFCA28",key:"amber"},{value:"#FFA726",key:"orange"},{value:"#FF7043",key:"deep_orange"},{value:"#8D6E63",key:"brown"},{value:"#BDBDBD",key:"grey"},{value:"#78909C",key:"blue_grey"}];fs.map(e=>e.value);const xs=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),ne=ye(e=>({stack:[],openModal:(t,r=null)=>{if(!t)return;const n={id:xs(),type:t,data:r};e(o=>({stack:[...o.stack,n]}))},closeModal:()=>e(t=>t.stack.length===0?t:{stack:t.stack.slice(0,-1)}),closeAllModals:()=>e({stack:[]})})),bs=1024,Pe=ye()(qe(e=>({sidebarWidth:j.SIDEBAR.DEFAULT_WIDTH,isSidebarOpen:!0,sidebarDensity:"normal",sidebarSections:["general","projects","targets","timeblocks","durations","filters"],setSidebarWidth:t=>{const r=Math.max(j.SIDEBAR.MIN_WIDTH,Math.min(t,j.SIDEBAR.MAX_WIDTH));e({sidebarWidth:r})},toggleSidebar:()=>e(t=>({isSidebarOpen:!t.isSidebarOpen})),setSidebarOpen:t=>e({isSidebarOpen:t}),setSidebarDensity:t=>e({sidebarDensity:t}),setSidebarSections:t=>e({sidebarSections:t})}),{name:"ui-storage",partialize:e=>({sidebarWidth:e.sidebarWidth,sidebarDensity:e.sidebarDensity,isSidebarOpen:e.isSidebarOpen,sidebarSections:e.sidebarSections}),onRehydrateStorage:()=>e=>{typeof window<"u"&&window.innerWidth<bs&&(e==null||e.setSidebarOpen(!1));const t=["general","projects","targets","timeblocks","durations","filters"];if(e&&(!e.sidebarSections||!Array.isArray(e.sidebarSections)||e.sidebarSections.length===0))e.sidebarSections=t;else if(e){const r=new Set(e.sidebarSections),a=t.filter(n=>!r.has(n));a.length>0&&(a.includes("general")?e.sidebarSections=["general",...e.sidebarSections]:e.sidebarSections=[...e.sidebarSections,...a])}}})),T=(e,t="0 0 24 24")=>({className:r,size:a,strokeWidth:n=2,...o})=>s.jsx("svg",{className:E("w-4 h-4",r),width:a,height:a,fill:"none",stroke:"currentColor",viewBox:t,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",...o,children:e}),ys=T(s.jsx("path",{d:"M4 6h16M4 12h16M4 18h16"})),Vo=T(s.jsx("path",{d:"M18 6L6 18M6 6l12 12"})),er=T(s.jsx("path",{d:"M12 5v14M5 12h14"})),_e=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})]})),De=T(s.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),"0 0 24 24"),ks=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),kt=T(s.jsx("path",{d:"M20 6L9 17l-5-5"})),wt=T(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("path",{d:"M21 21l-4.35-4.35"})]})),qo=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),s.jsx("path",{d:"M12 9v4M12 17h.01"})]})),Ho=T(s.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})),Ko=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),s.jsx("path",{d:"M14 2v6h6"}),s.jsx("path",{d:"M16 13H8"}),s.jsx("path",{d:"M16 17H8"}),s.jsx("path",{d:"M10 9H8"})]})),Xo=T(s.jsx("path",{d:"M15 18l-6-6 6-6"})),ws=T(s.jsx("path",{d:"M9 18l6-6-6-6"})),tr=T(s.jsx("path",{d:"M6 9l6 6 6-6"})),Yo=T(s.jsx("path",{d:"M18 15l-6-6-6 6"})),js=T(s.jsx("path",{d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})),rr=T(s.jsx("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})),vs=T(s.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})),Is=T(s.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})),_s=T(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"9",cy:"12",r:"1"}),s.jsx("circle",{cx:"9",cy:"5",r:"1"}),s.jsx("circle",{cx:"9",cy:"19",r:"1"}),s.jsx("circle",{cx:"15",cy:"12",r:"1"}),s.jsx("circle",{cx:"15",cy:"5",r:"1"}),s.jsx("circle",{cx:"15",cy:"19",r:"1"})]})),it=T(s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})),Ds=T(s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"}),s.jsx("path",{d:"M8 14h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M16 14h.01"}),s.jsx("path",{d:"M8 18h.01"}),s.jsx("path",{d:"M12 18h.01"}),s.jsx("path",{d:"M16 18h.01"})]})),sr=T(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M12 6v6l4 2"})]})),Ns=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17 1l4 4-4 4"}),s.jsx("path",{d:"M3 11V9a4 4 0 014-4h14"}),s.jsx("path",{d:"M7 23l-4-4 4-4"}),s.jsx("path",{d:"M21 13v2a4 4 0 01-4 4H3"})]})),Es=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M4 11V4h16v7"}),s.jsx("path",{d:"M4 11h5.8a2.2 2.2 0 004.4 0H20v8a1 1 0 01-1 1H5a1 1 0 01-1-1v-8z"})]})),Go=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),Jo=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),s.jsx("path",{d:"M1 1l22 22"})]})),Zo=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"}),s.jsx("path",{d:"M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"})]})),Qo=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 4h-9"}),s.jsx("path",{d:"M14 20H5"}),s.jsx("path",{d:"M15 4L9 20"})]})),ei=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M8 6h13"}),s.jsx("path",{d:"M8 12h13"}),s.jsx("path",{d:"M8 18h13"}),s.jsx("path",{d:"M3 6h.01"}),s.jsx("path",{d:"M3 12h.01"}),s.jsx("path",{d:"M3 18h.01"})]})),ti=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10 6h11"}),s.jsx("path",{d:"M10 12h11"}),s.jsx("path",{d:"M10 18h11"}),s.jsx("path",{d:"M4 6h1v4"}),s.jsx("path",{d:"M4 10h2"}),s.jsx("path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"})]})),ri=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M9 11l3 3L22 4"}),s.jsx("path",{d:"M21 12v7a2 2 0 01-2 2H5a2 2 0 01-2-2V5a2 2 0 012-2h11"})]})),si=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M16 18l6-6-6-6"}),s.jsx("path",{d:"M8 6l-6 6 6 6"})]})),ai=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 4v16"}),s.jsx("path",{d:"M18 4v16"}),s.jsx("path",{d:"M6 12h12"})]})),ni=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10 13a5 5 0 007.54.54l3-3a5 5 0 00-7.07-7.07l-1.72 1.71"}),s.jsx("path",{d:"M14 11a5 5 0 00-7.54-.54l-3 3a5 5 0 007.07 7.07l1.71-1.71"})]})),oi=T(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"}),s.jsx("path",{d:"M16 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"})]})),Ts=({className:e,size:t,...r})=>s.jsxs("svg",{className:E("animate-spin",e),width:t||16,height:t||16,fill:"none",viewBox:"0 0 24 24",...r,children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Cs="/assets/logo-BADOZ29k.png",re=ye()(qe(e=>({filterType:"inbox",targetId:null,query:"",showCompleted:!1,sortCriteria:"createdAt_desc",setFilter:(t,r=null)=>e({filterType:t,targetId:r,query:""}),setSearchQuery:t=>e({query:t,filterType:"search"}),clearFilter:()=>e({filterType:"inbox",targetId:null,query:""}),setShowCompleted:t=>e({showCompleted:t}),setSortCriteria:t=>e({sortCriteria:t})}),{name:"filter-storage",partialize:e=>({filterType:e.filterType,targetId:e.targetId,query:e.query,showCompleted:e.showCompleted,sortCriteria:e.sortCriteria})})),ae=ye()(qe(e=>({currentView:"tasks",viewData:null,setView:(t,r=null)=>e({currentView:t,viewData:r})}),{name:"view-storage",partialize:e=>({currentView:e.currentView})})),Ss=()=>{const{t:e}=P(),{query:t,setFilter:r}=re(),{currentView:a,setView:n}=ae(),o=a==="search",i=()=>{r("search"),n("search")};return s.jsxs("button",{onClick:i,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-all duration-200 group ${o?"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-400"}`,"aria-label":e("sidebar.search_placeholder"),children:[s.jsx(wt,{className:`w-4 h-4 transition-colors ${o?"text-blue-600 dark:text-blue-400":"text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300"}`}),s.jsx("span",{className:"flex-1 text-sm font-medium",children:t?`"${t}"`:e("sidebar.search_placeholder")}),s.jsx("span",{className:"text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"/"})]})},As=({children:e})=>{const{sidebarWidth:t,isSidebarOpen:r,sidebarDensity:a,toggleSidebar:n,setSidebarWidth:o}=Pe(),{t:i}=P(),c={compact:"p-1",normal:"p-2",comfortable:"p-4",spacious:"p-6"}[a];S.useEffect(()=>{const d=h=>{if(!document.body.classList.contains("resizing"))return;const p=Math.max(j.SIDEBAR.MIN_WIDTH,Math.min(j.SIDEBAR.MAX_WIDTH,h.clientX));o(p)},u=()=>{document.body.classList.remove("resizing"),document.body.style.cursor="default"};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",u)}},[o]);const l=()=>{document.body.classList.add("resizing"),document.body.style.cursor="col-resize"};return s.jsxs("aside",{className:E("h-full transition-all duration-300 flex flex-col group relative","bg-white dark:bg-gray-900 lg:bg-white/70 lg:dark:bg-gray-800/60","lg:backdrop-blur-xl","border-r border-gray-200/50 dark:border-gray-700/30",r?"translate-x-0":"-translate-x-full lg:translate-x-0","fixed lg:relative lg:z-0 shadow-2xl lg:shadow-none overflow-hidden","w-[var(--sidebar-mobile)] lg:w-[var(--sidebar-desktop)]"),style:{"--sidebar-desktop":`${t}px`,"--sidebar-mobile":r?`${j.LAYOUT.MOBILE_SIDEBAR_WIDTH_PX}px`:"0px",width:r?void 0:"0px",zIndex:window.innerWidth<1024?j.Z_INDEX.SIDEBAR_MOBILE:void 0},children:[s.jsxs("div",{className:"flex items-center px-4 flex-shrink-0 justify-between border-b border-gray-100 dark:border-gray-800/50",style:{height:"calc(3.5rem + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)"},children:[s.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none",children:[s.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/20",children:s.jsx("img",{src:Cs,alt:"L",className:"h-5 w-5 invert brightness-0"})}),s.jsxs("span",{className:"text-lg font-black text-gray-900 dark:text-white tracking-tight",children:["Task",s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]})]}),s.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-900 dark:hover:text-white p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all active:scale-90",title:i(r?"sidebar.toggle_collapse":"sidebar.toggle_expand"),"aria-label":i(r?"sidebar.toggle_collapse":"sidebar.toggle_expand"),children:s.jsx(js,{className:E("w-5 h-5 transition-transform duration-300",!r&&"rotate-180"),strokeWidth:2.5})})]}),s.jsx("div",{className:"px-3 pb-2 pt-2",children:s.jsx(Ss,{})}),s.jsx("div",{className:E("flex-1 overflow-y-auto custom-scrollbar pt-2",c),style:{paddingBottom:"env(safe-area-inset-bottom, 0px)"},children:e}),s.jsx("div",{role:"separator","aria-orientation":"vertical","aria-label":i("sidebar.resizer_label"),"aria-valuenow":t,"aria-valuemin":j.SIDEBAR.MIN_WIDTH,"aria-valuemax":j.SIDEBAR.MAX_WIDTH,tabIndex:r?0:-1,onMouseDown:l,onKeyDown:d=>{d.key==="ArrowLeft"?o(Math.max(j.SIDEBAR.MIN_WIDTH,t-10)):d.key==="ArrowRight"&&o(Math.min(j.SIDEBAR.MAX_WIDTH,t+10))},className:E("absolute top-0 right-0 w-3 h-full cursor-col-resize transition-colors hidden lg:flex items-center justify-center outline-none focus:bg-blue-500","hover:bg-blue-500/30 active:bg-blue-600/50 group/resizer"),style:{zIndex:j.Z_INDEX.SIDEBAR_RESIZER},title:i("sidebar.resizer_hint"),children:s.jsx("div",{className:"absolute w-1 h-12 bg-gray-400 dark:bg-gray-500 rounded-full opacity-0 group-hover/resizer:opacity-100 group-focus/resizer:opacity-100 transition-opacity pointer-events-none"})}),s.jsx("div",{className:"absolute top-0 right-0 w-[1px] h-full bg-gray-200/50 dark:bg-gray-700/30 hidden lg:block"})]})},ie=Xt([Sr(),Ar(Le),f().datetime({offset:!0}).or(f().datetime())]).nullable().optional(),Ms=W({type:ze(["none","daily","weekly","weekdays","monthly"]).default("none"),days:se(Y().min(0).max(6)).optional()}).refine(e=>e.type==="weekly"?e.days&&e.days.length>0:!0,{params:{i18n:"validation.select_days"}}).nullable(),jt=W({id:f().optional(),title:f().refine(e=>e.length>=1,{params:{i18n:"validation.title_required"}}).pipe(f().max(15)),description:f().refine(e=>e?e.replace(/<[^>]*>/g,"").replace(/&nbsp;/g," ").length<=200:!0,{params:{i18n:"validation.description_too_long"}}).nullable().optional(),status:ze(["todo","completed","archived"]).default("todo"),dueDate:ie,completedAt:ie,createdAt:ie,ownerId:f(),projectId:f().nullable().optional(),labelIds:se(f()).optional(),timeBlockId:f().nullable().optional(),duration:Y().refine(e=>e>=0,{params:{i18n:"validation.duration_invalid"}}).optional(),isImportant:st().default(!1),recurrence:Ms,order:Y().optional(),isDetailPurged:st().optional()}),ar=W({id:f().optional(),name:f().refine(e=>e.length>=1,{params:{i18n:"validation.project_name_required"}}).pipe(f().max(10)),color:f().optional(),ownerId:f(),createdAt:ie,order:Y().optional()}),nr=W({id:f().optional(),name:f().refine(e=>e.length>=1,{params:{i18n:"validation.label_name_required"}}).pipe(f().max(20)),color:f().optional(),ownerId:f(),workspaceId:f().optional(),createdAt:ie,order:Y().optional()}),vt=W({id:f().optional(),name:f().refine(e=>e.length>=1,{params:{i18n:"validation.workspace_name_required"}}).pipe(f().max(30)),createdAt:ie}),or=W({id:f().optional(),name:f().refine(e=>e.length>=1,{params:{i18n:"validation.filter_name_required"}}).pipe(f().max(10)),query:f(),workspaceId:f().optional(),ownerId:f().optional(),createdAt:ie}),Wt=f().refine(e=>/^([01]\d|2[0-3]):([0-5]\d)$/.test(e),{params:{i18n:"validation.time_format_invalid"}}),Ls=W({id:f().optional(),name:f().refine(e=>e.length>=1,{params:{i18n:"validation.timeblock_name_required"}}).pipe(f().max(20)),start:Wt,end:Wt,color:f().optional(),order:Y().optional()});W({id:f().optional(),mode:f(),data:Yt(f(),f()),createdAt:ie,updatedAt:ie,ownerId:f(),workspaceId:f()});const Ke=ye()(qe(e=>({currentWorkspaceId:null,workspaces:[],setCurrentWorkspaceId:t=>e({currentWorkspaceId:t}),setWorkspaces:t=>{const r=t.filter(a=>{const n=vt.safeParse(a);return n.success?!0:(console.error("Invalid workspace data:",a,n.error),!1)});e({workspaces:r})}}),{name:"workspace-storage",partialize:e=>({currentWorkspaceId:e.currentWorkspaceId})}));function Fs(){return"default-app-id"}function ct(e){return`artifacts/${Fs()}/users/${e}`}function ve(e,t){return`${ct(e)}/workspaces/${t}`}const v={users:e=>ct(e),workspaces:e=>`${ct(e)}/workspaces`,filters:(e,t)=>`${ve(e,t)}/filters`,labels:(e,t)=>`${ve(e,t)}/labels`,timeblocks:(e,t)=>`${ve(e,t)}/timeblocks`,tasks:(e,t)=>`${ve(e,t)}/tasks`,projects:(e,t)=>`${ve(e,t)}/projects`,targets:(e,t)=>`${ve(e,t)}/targets`},Rs=["permission-denied","invalid-argument","unauthenticated","not-found","already-exists","failed-precondition"];async function U(e,t={}){const r=typeof t=="number"?{maxRetries:t}:t,{maxRetries:a=3,initialDelay:n=1e3,onError:o,onFinalFailure:i}=r;let c;for(let l=0;l<=a;l++)try{return await e()}catch(d){if(c=d,o&&o(d,l),l===a)break;const u=d,h=(u==null?void 0:u.code)||"";if(Rs.some(b=>h.includes(b)))throw i&&i(d),d;const y=n*Math.pow(2,l);await new Promise(b=>setTimeout(b,y))}throw i&&i(c),c}class we{constructor(t){H(this,"cacheMap",new Map);H(this,"listeners",new Map);H(this,"unsubscribes",new Map);H(this,"config");this.config=t}isInitialized(t){return this.cacheMap.has(t)}getItems(t){return this.cacheMap.get(t)||[]}setCache(t,r){this.cacheMap.set(t,r),this.notifyListeners(t)}clearCache(t){var r;t?(this.cacheMap.delete(t),(r=this.unsubscribes.get(t))==null||r(),this.unsubscribes.delete(t),this.listeners.delete(t)):(this.unsubscribes.forEach(a=>a()),this.cacheMap.clear(),this.unsubscribes.clear(),this.listeners.clear())}notifyListeners(t){const r=this.cacheMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}registerListener(t,r){this.listeners.has(t)||this.listeners.set(t,new Set);const a=this.listeners.get(t);a.add(r);const n=this.cacheMap.get(t);return n&&queueMicrotask(()=>r([...n])),()=>{var o;a.delete(r),a.size===0&&((o=this.unsubscribes.get(t))==null||o(),this.unsubscribes.delete(t),this.listeners.delete(t))}}setFirestoreSubscription(t,r){this.unsubscribes.has(t)||this.unsubscribes.set(t,r)}hasFirestoreSubscription(t){return this.unsubscribes.has(t)}__subscribeToQuery(t,r,a=o=>({id:o.id,...o.data()}),n){const o=Fe(r,i=>{const c=i.docs.map(a);if(n){const l=this.getItems(t);if(l.length>0&&n(l,c))return}this.setCache(t,c)},i=>{console.error(`${this.config.logPrefix} Subscription error:`,i)});this.setFirestoreSubscription(t,o)}}class Ps extends we{constructor(){super({logPrefix:"[WorkspaceCache]"})}getWorkspaces(t){return this.getItems(t)}subscribe(t,r){const a=this.registerListener(t,r);if(!this.hasFirestoreSubscription(t)){const n=v.workspaces(t),o=ce(A(w,n),yt("createdAt","asc")),i=Fe(o,c=>{const d=c.docs.map(u=>({id:u.id,...u.data()})).filter(u=>{const h=vt.safeParse(u);return h.success?!0:(console.error(`${this.config.logPrefix} Invalid workspace data:`,u,h.error),!1)});this.setCache(t,d)},c=>{console.error(`${this.config.logPrefix} Subscription error:`,c),this.setCache(t,[])});this.setFirestoreSubscription(t,i)}return a}}const G=new Ps,Bs=e=>G.isInitialized(e),Os=e=>G.getWorkspaces(e);function Ws(e,t){return G.subscribe(e,t)}async function ir(e,t){const r=G.getWorkspaces(e);vt.pick({name:!0}).parse({name:t});const a="temp-"+Date.now(),n={id:a,name:t,createdAt:new Date};G.setCache(e,[...r,n]);const o=v.workspaces(e);let i=a;return await U(async()=>{const c=await ke(A(w,o),{name:t,createdAt:K()});i=c.id,i=c.id},{onFinalFailure:()=>{console.error(`[WorkspaceCache] Failed to add workspace: ${t}`),G.setCache(e,r),M.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}}),{id:i,name:t}}async function $s(e,t,r=null){const a=v.workspaces(e),n=ce(A(w,a),rs("name","==",t),Jt(5));return(await oe(n)).docs.some(i=>i.id!==r)}async function zs(e,t,r){const a=G.getWorkspaces(e),n=a.map(o=>o.id===t?{...o,...r}:o);G.setCache(e,n),await U(async()=>{const o=v.workspaces(e),i=F(w,o,t);await Ne(i,r)},{onFinalFailure:()=>{G.setCache(e,a),M.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Us(e,t){const r=G.getWorkspaces(e),a=r.filter(n=>n.id!==t);G.setCache(e,a),await U(async()=>{const n=v.workspaces(e);await Ee(F(w,n,t))},{onFinalFailure:()=>{G.setCache(e,r),M.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Vs(e){try{const t=v.workspaces(e);(await oe(ce(A(w,t),Jt(1)))).empty&&await ir(e,"ãƒ¡ã‚¤ãƒ³")}catch(t){console.error("[WorkspaceCache] Failed to ensure default workspace:",t)}}function qs(e){var r;const t=e||((r=C.currentUser)==null?void 0:r.uid);return t?Os(t):[]}function $t(e){var r;const t=e||((r=C.currentUser)==null?void 0:r.uid);return t?Bs(t):!1}function he(){return Ke.getState().currentWorkspaceId}function Hs(e){if(!e)return;const t=Ke.getState();t.currentWorkspaceId!==e&&t.setCurrentWorkspaceId(e)}function Ks(e,t){var o;const r=typeof e=="function"?e:t,a=typeof e=="string"?e:(o=C.currentUser)==null?void 0:o.uid;return a?Ws(a,i=>{i.length===0?Vs(a).catch(c=>console.error("[Workspace] Default creation error:",c)):Xs(i),typeof r=="function"&&r(i)}):(typeof r=="function"&&r([]),()=>{})}function Xs(e){if(e.length===0)return null;const t=Ke.getState();let r=t.currentWorkspaceId;const a=r?e.some(n=>n.id===r):!1;return(!r||!a)&&(r=e[0].id,t.setCurrentWorkspaceId(r)),r}async function ii(e){const t=C.currentUser;if(!t)throw new Error("Authentication required");return ir(t.uid,e)}async function ci(e,t=null){const r=C.currentUser;return r?$s(r.uid,e,t):!1}async function li(e,t){const r=C.currentUser;if(!r)throw new Error("Authentication required");return zs(r.uid,e,{name:t})}async function zt(e){const t=C.currentUser;if(!t)throw new Error("Authentication required");return Us(t.uid,e)}async function Ue(e,t=!1){if(`${e.type.toUpperCase()}`,e.stack&&`${e.stack}`,e.type,C.currentUser)try{ke(A(w,"users",C.currentUser.uid,"error_logs"),{...e,userAgent:typeof navigator<"u"?navigator.userAgent:"unknown",href:typeof window<"u"?window.location.href:"unknown",createdAt:K()}).catch(r=>{})}catch{}if(t)try{const{toast:r}=await z(async()=>{const{toast:a}=await Promise.resolve().then(()=>gs);return{toast:a}},void 0);r.error(`System: ${e.message.substring(0,100)}${e.message.length>100?"...":""}`)}catch(r){console.error("Failed to show error toast",r)}}function Ys(){typeof window>"u"||(window.onerror=(e,t,r,a,n)=>(Ue({timestamp:new Date().toISOString(),type:"error",message:String(e),stack:n==null?void 0:n.stack,url:t,line:r,column:a},!0),!1),window.onunhandledrejection=e=>{const t=e.reason;Ue({timestamp:new Date().toISOString(),type:"unhandledrejection",message:(t==null?void 0:t.message)||String(t),stack:t==null?void 0:t.stack},!0)},console.info("[ErrorLogger] Initialized"))}function Gs(e,t,r=!0){Ue({timestamp:new Date().toISOString(),type:"react",message:e.message,stack:e.stack,componentStack:t},r)}class Js{constructor(){}getCurrentUserId(){var t;return((t=C.currentUser)==null?void 0:t.uid)||null}initAuthListener(t,r){return ss(C,n=>{n?t(n):r()})}async loginWithEmail(t,r){return await Gt(C,t,r)}async logout(){try{await as(C)}catch(t){throw Ue({timestamp:new Date().toISOString(),type:"error",message:`Logout failed: ${t.message}`,stack:t.stack,url:"auth.ts"}),t}}async updateUserAuthPassword(t){const r=C.currentUser;if(!r)throw new Error("Authentication required: No current user.");await ns(r,t)}}const Zs=new Js,Qs=(e,t)=>Zs.initAuthListener(e,t),ea={TIMEOUT:{AUTH_LOADING:1e4}},It=()=>{var i;const[e,t]=I.useState(((i=C.currentUser)==null?void 0:i.uid)||null),[r,a]=I.useState(C.currentUser),[n,o]=I.useState(!C.currentUser);return I.useEffect(()=>{const c=new AbortController;let l=()=>{},d=null;const u=async()=>{c.signal.aborted||(l=Qs(h=>{c.signal.aborted||(t(h.uid),a(h),o(!1),d&&clearTimeout(d))},()=>{c.signal.aborted||(t(null),a(null),o(!1),d&&clearTimeout(d))}))};return d=setTimeout(()=>{c.signal.aborted||(console.warn("[useAuth] Loading timeout reached, forcing loading=false"),o(!1))},ea.TIMEOUT.AUTH_LOADING),u(),()=>{c.abort(),l(),d&&clearTimeout(d)}},[]),{userId:e,user:r,loading:n}},ta=[],ra=()=>{const{userId:e,loading:t}=It(),r=I.useCallback(c=>e?Ks(e,()=>c()):()=>{},[e]),a=I.useCallback(()=>e&&$t(e)?qs(e):ta,[e]),n=I.useSyncExternalStore(r,a),o=e?$t(e):!1;return{workspaces:n,loading:t||!!e&&!o}},Be=()=>{const e=Ke(a=>a.currentWorkspaceId),{userId:t,loading:r}=It();return{workspaceId:e,userId:t,loading:r}},sa=()=>{const{t:e}=P(),{workspaces:t,loading:r}=ra(),{openModal:a}=ne(),[n,o]=I.useState(!1),i=I.useRef(null),{workspaceId:c}=Be(),l=t.find(m=>m.id===c),[d,u]=I.useState({visible:!1,x:0,y:0,workspace:null}),h=I.useRef(null);I.useEffect(()=>{const m=N=>{i.current&&!i.current.contains(N.target)&&o(!1),h.current&&!h.current.contains(N.target)&&u(g=>({...g,visible:!1}))},_=N=>{N.key==="Escape"&&(o(!1),u(g=>({...g,visible:!1})))};return document.addEventListener("mousedown",m),document.addEventListener("keydown",_),()=>{document.removeEventListener("mousedown",m),document.removeEventListener("keydown",_)}},[]);const p=(m,_)=>{m.preventDefault(),m.stopPropagation(),u({visible:!0,x:m.clientX,y:m.clientY,workspace:_})},y=()=>{d.workspace&&(o(!1),u(m=>({...m,visible:!1})),a("workspace-edit",d.workspace))},b=()=>{const m=d.workspace;if(m!=null&&m.id){if(t.length<=1){o(!1),u(_=>({..._,visible:!1}));return}u(_=>({..._,visible:!1})),o(!1),a("confirmation",{title:e("delete"),message:e("msg.confirm_delete_workspace")||`ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã€Œ${m.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,confirmLabel:e("delete"),variant:"danger",onConfirm:async()=>{try{await zt(m.id)}catch(_){console.error("Failed to delete workspace:",_)}}})}};return r?s.jsx("div",{className:"h-8 w-32 bg-gray-100 dark:bg-gray-800 animate-pulse rounded"}):s.jsxs("div",{className:"relative",ref:i,children:[s.jsxs("button",{onClick:()=>o(!n),className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 transition-colors group","aria-expanded":n,"aria-haspopup":"true",children:[s.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 truncate max-w-[120px] sm:max-w-[140px] md:max-w-[180px]",children:l?l.name:e("loading")}),s.jsx(tr,{className:E("w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-transform duration-200",n?"rotate-180":"")})]}),n&&s.jsxs("div",{className:"absolute left-0 mt-2 w-64 max-w-[calc(100vw-32px)] origin-top-left rounded-2xl shadow-2xl glass-effect overflow-hidden animate-scale-in custom-scrollbar",style:{zIndex:j.Z_INDEX.DROPDOWN},children:[s.jsx("div",{className:"p-2 border-b border-gray-200/50 dark:border-gray-700/30",children:s.jsxs("button",{onClick:()=>{o(!1),a("workspace-edit",null)},className:"flex items-center w-full px-3 py-2 text-sm font-medium text-blue-600 dark:text-blue-400 hover:bg-blue-50/50 dark:hover:bg-blue-500/10 transition-all rounded-xl group/add",children:[s.jsx("div",{className:"w-6 h-6 rounded-lg bg-blue-100 dark:bg-blue-900/40 flex items-center justify-center mr-2 group-hover/add:scale-110 transition-transform",children:s.jsx(er,{className:"w-4 h-4"})}),e("sidebar.add_workspace")]})}),s.jsx("div",{className:"py-2 max-h-[300px] overflow-y-auto custom-scrollbar",children:t.map(m=>{const _=m.id===c;return s.jsx("div",{className:"px-2",children:s.jsxs("div",{className:E("flex items-center group/item px-3 py-2.5 rounded-xl transition-all cursor-pointer relative",_?"bg-blue-50/50 dark:bg-blue-500/10":"hover:bg-gray-100/50 dark:hover:bg-gray-700/30"),onClick:()=>{m.id&&Hs(m.id),o(!1)},onContextMenu:N=>p(N,m),children:[s.jsx("div",{className:E("w-2 h-2 rounded-full mr-3",_?"bg-blue-500 shadow-[0_0_8px_rgba(59,130,246,0.5)]":"bg-transparent")}),s.jsx("span",{className:E("flex-1 text-sm truncate mr-2",_?"text-blue-700 dark:text-blue-300 font-bold":"text-gray-700 dark:text-gray-300"),children:m.name}),s.jsxs("div",{className:"flex items-center gap-1 opacity-100 lg:opacity-0 lg:group-hover/item:opacity-100 transition-opacity",children:[s.jsx("button",{onClick:N=>{N.stopPropagation(),o(!1),a("workspace-edit",m)},className:"p-1.5 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 text-gray-500 dark:text-gray-400 transition-colors",title:e("edit"),children:s.jsx(De,{className:"w-3.5 h-3.5"})}),t.length>1&&s.jsx("button",{onClick:N=>{var g;N.stopPropagation(),u({visible:!1,x:0,y:0,workspace:m}),o(!1),a("confirmation",{title:e("delete"),message:((g=e("msg.confirm_delete_workspace"))==null?void 0:g.replace("{name}",m.name))||`ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã€Œ${m.name}ã€ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ`,confirmLabel:e("delete"),variant:"danger",onConfirm:async()=>{await zt(m.id)}})},className:"p-1.5 rounded-lg hover:bg-red-100 dark:hover:bg-red-900/30 text-gray-400 hover:text-red-600 dark:hover:text-red-400 transition-colors",title:e("delete"),children:s.jsx(_e,{className:"w-3.5 h-3.5"})})]}),_&&!d.visible&&s.jsx("div",{className:"absolute right-3 opacity-100 group-hover/item:opacity-0 transition-opacity",children:s.jsx(kt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400"})})]})},m.id)})}),s.jsx("div",{className:"px-4 py-2 bg-gray-50/30 dark:bg-gray-800/20 border-t border-gray-200/50 dark:border-gray-700/30",children:s.jsx("p",{className:"text-[10px] uppercase tracking-wider font-semibold text-gray-400 dark:text-gray-500",children:e("workspaces")})})]}),d.visible&&d.workspace&&s.jsxs("div",{ref:h,className:"fixed rounded-xl shadow-2xl glass-effect py-1.5 min-w-[140px] animate-scale-in",style:{left:d.x,top:d.y,zIndex:j.Z_INDEX.MODAL},children:[s.jsxs("button",{onClick:y,className:"flex items-center w-full px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100/50 dark:hover:bg-gray-700/50 transition-colors",children:[s.jsx(De,{className:"w-4 h-4 mr-3 text-gray-500"}),e("edit")]}),s.jsxs("button",{onClick:b,className:"flex items-center w-full px-4 py-2 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors",children:[s.jsx(_e,{className:"w-4 h-4 mr-3"}),e("delete")]})]})]})},aa=({sidebarContent:e,title:t,children:r})=>{const{toggleSidebar:a,isSidebarOpen:n}=Pe(),{t:o}=P(),{openModal:i}=ne();return s.jsxs("div",{className:"w-full h-[100dvh] flex overflow-hidden bg-premium-gradient text-gray-800 dark:text-white antialiased",children:[n&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm lg:hidden transition-opacity duration-300",style:{zIndex:j.Z_INDEX.SIDEBAR_BACKDROP},onClick:a}),s.jsx(As,{children:e}),s.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[s.jsxs("header",{className:"border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm z-10 sticky top-0",style:{height:"calc(3rem + env(safe-area-inset-top, 0px))",paddingTop:"env(safe-area-inset-top, 0px)"},children:[s.jsxs("div",{className:"flex items-center gap-3",children:[!n&&s.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:o("sidebar.menu_open"),"aria-label":o("sidebar.menu_open"),children:s.jsx(ys,{className:"w-5 h-5"})}),s.jsx(sa,{}),s.jsx("h1",{className:"font-bold text-lg border-l border-gray-300 dark:border-gray-700 pl-3 ml-1 truncate",children:t})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("button",{onClick:()=>i("settings"),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:o("settings"),"aria-label":o("settings"),children:s.jsx(ks,{className:"w-5 h-5"})})})]}),s.jsx("main",{className:"flex-1 overflow-hidden flex flex-col",id:"main-content",children:s.jsx("div",{className:E("w-full h-full bg-white dark:bg-gray-900 relative flex-1",j.LAYOUT.CONTAINER_WIDTH_CLASS),children:r})})]})]})},na=S.lazy(()=>z(()=>import("./FilterEditModal-C3IZoqEH.js"),__vite__mapDeps([0,1,2,3,4,5,6,7])).then(e=>({default:e.FilterEditModal}))),oa=S.lazy(()=>z(()=>import("./LabelEditModal-l_0tSZXp.js"),__vite__mapDeps([8,1,2,5,6,7,4,3])).then(e=>({default:e.LabelEditModal}))),ia=S.lazy(()=>z(()=>import("./ProjectEditModal-D74sltbz.js"),__vite__mapDeps([9,1,2,5,6,7,4,3])).then(e=>({default:e.ProjectEditModal}))),ca=S.lazy(()=>z(()=>import("./SettingsModal-oGEv2yFj.js"),__vite__mapDeps([10,1,2,3,6,7,4])).then(e=>({default:e.SettingsModal}))),la=S.lazy(()=>z(()=>import("./TaskDetailModal-WAD8ZMys.js"),__vite__mapDeps([11,1,2,4,3,5,6,7,12])).then(e=>({default:e.TaskDetailModal}))),da=S.lazy(()=>z(()=>import("./TimeBlockEditModal-WlOEppyp.js"),__vite__mapDeps([13,1,2,4,5,6,3])).then(e=>({default:e.TimeBlockEditModal}))),ua=S.lazy(()=>z(()=>import("./WorkspaceEditModal-h8XmMtIt.js"),__vite__mapDeps([14,1,2,5,6,7,4,3])).then(e=>({default:e.WorkspaceEditModal}))),ha=S.lazy(()=>z(()=>import("./WikiFrameworkModal-Cq7HwT7h.js"),__vite__mapDeps([15,1,2,6,3,16,4])).then(e=>({default:e.WikiFrameworkModal}))),pa=S.lazy(()=>z(()=>import("./ConfirmationModal-DEfBdxug.js"),__vite__mapDeps([17,1,2,6,4,3])).then(e=>({default:e.ConfirmationModal}))),ga=()=>{const{stack:e}=ne();return e.length===0?null:s.jsx(I.Suspense,{fallback:null,children:e.map((t,r)=>{const n=r===0?void 0:"bg-black/30",o={isOpen:!0,data:t.data,zIndex:j.Z_INDEX.MODAL+r*10,overlayClassName:n};switch(t.type){case"settings":return s.jsx(ca,{...o},t.id);case"task-detail":return s.jsx(la,{...o},t.id);case"label-edit":return s.jsx(oa,{...o},t.id);case"project-edit":return s.jsx(ia,{...o},t.id);case"workspace-edit":return s.jsx(ua,{...o},t.id);case"filter-edit":return s.jsx(na,{...o},t.id);case"timeblock-edit":return s.jsx(da,{...o},t.id);case"wiki-framework":return s.jsx(ha,{...o},t.id);case"confirmation":return s.jsx(pa,{...o},t.id);default:return null}})})};function _t(e){const t={keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(!e)return t;const r=/(?:-?[a-zA-Z]+:(?:"[^"]*"|[^\s]+))|(?:"[^"]*")|(?:-?[^\s]+)/g,a=e.match(r);if(!a)return t;const n=[];for(let o=0;o<a.length;o++){const i=a[o];if(i==="OR"){const c=n.length-1,l=n[c],d=a[o+1],u=l&&(typeof l=="string"?!l.includes(":"):!0),h=d&&!d.includes(":")&&d!=="OR";if(u&&h){const p=Array.isArray(l)?l:[l];p.push(d.toLowerCase().replace(/^"|"$/g,"")),n[c]=p,o++;continue}}n.push(i)}return n.forEach(o=>{if(Array.isArray(o)){t.keywords.push(o);return}const i=o;if(i.startsWith('"')&&i.endsWith('"')){const c=i.substring(1,i.length-1);c&&t.keywords.push(c.toLowerCase());return}if(i.startsWith("-")&&!i.includes(":")){const c=i.substring(1);c&&t.excludeKeywords.push(c.toLowerCase());return}if(i.includes(":")){let c=!1,l=i;l.startsWith("-")&&(c=!0,l=l.substring(1));const d=l.indexOf(":"),u=l.substring(0,d).toLowerCase();let h=l.substring(d+1);switch(h.startsWith('"')&&h.endsWith('"')&&(h=h.substring(1,h.length-1)),h.toLowerCase(),u){case"project":case"p":c?h.split(",").forEach(b=>t.excludeProjects.push(b)):h.split(",").forEach(b=>t.projects.push(b));break;case"label":case"l":c?h.split(",").forEach(b=>t.excludeLabels.push(b)):h.split(",").forEach(b=>t.labels.push(b));break;case"timeblock":case"tb":c?h.split(",").forEach(b=>t.excludeTimeBlocks.push(b)):h.split(",").forEach(b=>t.timeBlocks.push(b));break;case"duration":case"d":h.split(",").forEach(b=>{const m=parseInt(b,10);isNaN(m)||t.durations.push(m)});break;case"date":case"due":const p=["today","tomorrow","week","upcoming","overdue","next-week"];h.split(",").forEach(b=>{const m=b.toLowerCase();p.includes(m)&&t.dates.push(m)});break;case"status":case"is":const y=["completed","active","todo"];h.split(",").forEach(b=>{const m=b.toLowerCase();y.includes(m)&&(c?t.excludeStatus.push(m):t.status.push(m)),m==="important"&&(t.isImportant=!c),m==="unimportant"&&(t.isImportant=c)});break;default:c?t.excludeKeywords.push(l.toLowerCase()):t.keywords.push(l.toLowerCase());break}}else i!=="OR"&&t.keywords.push(i.toLowerCase())}),t}function di(e){var r,a,n,o,i,c,l,d,u,h,p,y;const t=[];return(r=e.keywords)!=null&&r.length&&t.push(...e.keywords.map(b=>Array.isArray(b)?b.join(" OR "):b.includes(" ")?`"${b}"`:b)),(a=e.excludeKeywords)!=null&&a.length&&t.push(...e.excludeKeywords.map(b=>`-${b}`)),(n=e.projects)!=null&&n.length&&t.push(`project:${e.projects.join(",")}`),(o=e.excludeProjects)!=null&&o.length&&t.push(`-project:${e.excludeProjects.join(",")}`),(i=e.labels)!=null&&i.length&&t.push(`label:${e.labels.join(",")}`),(c=e.excludeLabels)!=null&&c.length&&t.push(`-label:${e.excludeLabels.join(",")}`),(l=e.timeBlocks)!=null&&l.length&&t.push(`timeblock:${e.timeBlocks.join(",")}`),(d=e.excludeTimeBlocks)!=null&&d.length&&t.push(`-timeblock:${e.excludeTimeBlocks.join(",")}`),(u=e.durations)!=null&&u.length&&t.push(`duration:${e.durations.join(",")}`),(h=e.dates)!=null&&h.length&&t.push(`date:${e.dates.join(",")}`),(p=e.status)!=null&&p.length&&t.push(`status:${e.status.join(",")}`),(y=e.excludeStatus)!=null&&y.length&&t.push(`-status:${e.excludeStatus.join(",")}`),e.isImportant===!0&&t.push("is:important"),e.isImportant===!1&&t.push("is:unimportant"),t.join(" ")}const Ut=()=>{const{language:e}=q.getState();return e==="en"?Lr:Fr},ma=()=>{const{language:e}=q.getState();return Bt[e]||Bt.ja};function Ve(){return Intl.DateTimeFormat().resolvedOptions().timeZone}function $(e){return Mr(e,Ve())}function lt(e){const t=new Date(e);return t.setUTCHours(0,0,0,0),t}function fa(e,t=1){const r=new Date(e),a=r.getUTCDay(),n=(a<t?7:0)+a-t;return r.setUTCDate(r.getUTCDate()-n),r.setUTCHours(0,0,0,0),r}function Oe(e,t){const r=lt(e),a=lt(t);return Math.round((r.getTime()-a.getTime())/864e5)}function Dt(e=new Date){const t=$(e);return lt(t)}function xa(e=new Date,t=1){const r=$(e);return fa(r,t)}function cr(e){const t=$(e),r=$(new Date);return Oe(t,r)===0}function ba(e){const t=$(e),r=$(new Date);return Oe(t,r)===1}function ya(e){const t=$(e),r=$(new Date);return Oe(t,r)===-1}function Vt(e){const t=ma();if(cr(e))return t.date_options.today;if(ba(e))return t.date_options.tomorrow;if(ya(e))return t.date_options.yesterday;const r=new Date,a=$(e),n=$(r);return a.getUTCFullYear()!==n.getUTCFullYear()?at(e,Ve(),"yyyy/MM/dd",{locale:Ut()}):at(e,Ve(),"MM/dd",{locale:Ut()})}function ui(e){return at(e,Ve(),"yyyy-MM-dd")}function B(e){if(e==null)return null;if(e instanceof Date)return e;if(typeof e=="object"&&"toDate"in e&&typeof e.toDate=="function")return e.toDate();const t=new Date(e);return isNaN(t.getTime())?null:t}function ka(e){const t=B(e);if(!t)return"text-gray-500 dark:text-gray-400";const r=$(t),a=$(new Date);r.setUTCHours(0,0,0,0),a.setUTCHours(0,0,0,0);const n=Oe(r,a);return n<0?"text-red-500 font-bold":n===0?"text-green-600 dark:text-green-400 font-medium":n===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}const hi=e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t};function wa(e,t){var n;if(!e||!(t!=null&&t.type))return null;const r=B(e);if(!r)return null;const a=new Date(r);switch(t.type){case"daily":return a.setDate(a.getDate()+1),a;case"weekly":{if(!((n=t.days)!=null&&n.length))return null;const o=a.getDay();for(let i=1;i<=7;i++){const c=(o+i)%7;if(t.days.includes(c))return a.setDate(a.getDate()+i),a}return null}case"weekdays":do a.setDate(a.getDate()+1);while(a.getDay()===0||a.getDay()===6);return a;case"monthly":return a.setMonth(a.getMonth()+1),a;default:return null}}function pi(e){const t=Dt(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&e.days&&e.days.length>0){const r=t.getDay();for(let a=0;a<=6;a++)if(e.days.includes((r+a)%7))return t.setDate(t.getDate()+a),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function ja(e,t){if(!e||!t)return 0;const[r,a]=e.split(":").map(Number),[n,o]=t.split(":").map(Number);if(isNaN(r)||isNaN(a)||isNaN(n)||isNaN(o))return 0;const i=r*60+a;let c=n*60+o;return c<i&&(c+=1440),c-i}const qt=(e,t)=>{const r=B(e),a=B(t);if(!r||!a)return!1;const n=$(r),o=$(a);return Oe(n,o)===0},va=(e,t=7)=>{const r=B(e);if(!r)return!1;const n=$(new Date);n.setHours(0,0,0,0);const o=Ce(n,1),i=Ce(n,t+1),c=$(r);return c>=o&&c<i};function Ia(e,t="createdAt_desc"){if(!Array.isArray(e))return[];const[r,a]=t.split("_"),o=a==="desc"?-1:1;return[...e].sort((i,c)=>{var u,h,p,y,b,m;let l,d;switch(r){case"dueDate":l=(u=B(i.dueDate))==null?void 0:u.getTime(),d=(h=B(c.dueDate))==null?void 0:h.getTime();break;case"createdAt":l=(p=B(i.createdAt))==null?void 0:p.getTime(),d=(y=B(c.createdAt))==null?void 0:y.getTime();break;case"title":l=i.title.toLowerCase(),d=c.title.toLowerCase();break;case"duration":l=i.duration||0,d=c.duration||0;break;case"important":l=i.isImportant?1:0,d=c.isImportant?1:0;break;case"manual":l=i.order!==void 0?i.order:Number.MAX_SAFE_INTEGER,d=c.order!==void 0?c.order:Number.MAX_SAFE_INTEGER;break;default:l=(b=B(i.createdAt))==null?void 0:b.getTime(),d=(m=B(c.createdAt))==null?void 0:m.getTime()}return _a(l,d)*o})}function _a(e,t){return e===t?0:e==null?1:t==null?-1:e>t?1:e<t?-1:0}function dt(){const e=Dt(new Date),t=Ce(e,1),r=xa(new Date),a=Ce(r,7),n=Ce(t,7);return{now:e,tomorrow:t,weekStart:r,weekEnd:a,upcomingEnd:n}}function Da(e,t,r,a){const{now:n,tomorrow:o,weekStart:i,weekEnd:c,upcomingEnd:l}=r;switch(t){case"today":return qt(e,n)||e<n&&a!=="completed";case"tomorrow":return qt(e,o);case"week":return e>=i&&e<c;case"upcoming":return e>=o&&e<l;case"overdue":return e<n&&a!=="completed";default:return!1}}function lr(e,t,r=null){if(!r&&t.dates.length>0&&(r=dt()),t.status.length>0){const n=e.status||"todo";if(!t.status.some(i=>i==="active"&&n==="todo"?!0:i===n))return!1}if(t.excludeStatus.length>0){const n=e.status||"todo";if(t.excludeStatus.some(i=>i==="active"&&n==="todo"?!0:i===n))return!1}if(t.isImportant===!0&&!e.isImportant||t.isImportant===!1&&e.isImportant||t.projects.length>0&&!t.projects.some(o=>o==="unassigned"?!e.projectId||e.projectId==="unassigned"||e.projectId==="none":e.projectId===o)||t.excludeProjects.length>0&&t.excludeProjects.some(n=>e.projectId===n)||t.labels.length>0&&(!e.labelIds||!t.labels.some(n=>{var o;return(o=e.labelIds)==null?void 0:o.includes(n)}))||t.excludeLabels.length>0&&e.labelIds&&t.excludeLabels.some(n=>{var o;return(o=e.labelIds)==null?void 0:o.includes(n)})||t.timeBlocks.length>0&&!t.timeBlocks.some(o=>o==="unassigned"?!e.timeBlockId:e.timeBlockId===o)||t.excludeTimeBlocks.length>0&&t.excludeTimeBlocks.some(n=>e.timeBlockId===n))return!1;if(t.durations.length>0){const n=e.duration||0;if(!t.durations.includes(n))return!1}if(t.dates.length>0){const n=r||dt(),o=B(e.dueDate);if(!o||!t.dates.some(c=>Da(o,c,n,e.status||"todo")))return!1}const a=`${e.title} ${e.description||""}`.toLowerCase();return!(t.keywords.length>0&&!t.keywords.every(o=>Array.isArray(o)?o.some(i=>a.includes(i)):a.includes(o))||t.excludeKeywords.length>0&&t.excludeKeywords.some(o=>a.includes(o)))}function Ht(e,t){if(!t)return e;const r=typeof t=="string"?_t(t):t,a=r.dates.length>0?dt():null;return e.filter(n=>lr(n,r,a))}function Na(e){const{keyword:t,showCompleted:r,projectId:a,labelId:n,timeBlockId:o,duration:i,filterType:c}=e,l=t?_t(t):{keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(a&&l.projects.push(a),n&&l.labels.push(n),o&&l.timeBlocks.push(o),i){const d=typeof i=="number"?i:parseInt(i,10);isNaN(d)||l.durations.push(d)}return c==="today"&&l.dates.push("today"),c==="upcoming"&&l.dates.push("upcoming"),c==="important"&&(l.isImportant=!0),r||l.status.length===0&&l.status.push("active"),l}function Ea(e,t){const{savedFilter:r,sortCriteria:a}=t,n=Na(t);let o=Ht(e,n);return r&&r.query&&(o=Ht(o,r.query)),Ia(o,a||"createdAt_desc")}const me=class me extends we{constructor(){super({logPrefix:"[FilterCache]"})}static getInstance(){return me.instance||(me.instance=new me),me.instance}getFilters(t){return this.getItems(t)}subscribe(t,r,a){if(!t||!r)return a([]),()=>{};const n=this.registerListener(r,a);if(!this.hasFirestoreSubscription(r)){const o=v.filters(t,r),i=ce(A(w,o)),c=Fe(i,l=>{const d=l.docs.map(u=>({id:u.id,...u.data()}));this.setCache(r,d)},l=>{console.error(`${this.config.logPrefix} Subscription error:`,l),this.setCache(r,[])});this.setFirestoreSubscription(r,c)}return n}};H(me,"instance");let ut=me;const J=ut.getInstance();function Ta(e,t,r){return J.subscribe(e,t,r)}function Ca(e){return J.getFilters(e)}function Sa(e){return J.isInitialized(e)}async function Aa(e,t,r){const a=J.getFilters(t),n="temp_"+Date.now(),o={...r,id:n,createdAt:new Date};J.setCache(t,[...a,o]);const i=v.filters(e,t);return U(async()=>(await ke(A(w,i),{...r,createdAt:K()})).id,{onFinalFailure:()=>{J.setCache(t,a),M.error("ãƒ•ã‚£ãƒ«ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ma(e,t,r,a){const n=J.getFilters(t),o=n.map(c=>c.id===r?{...c,...a}:c);J.setCache(t,o);const i=v.filters(e,t);return U(async()=>{await Ne(F(w,i,r),{...a,updatedAt:K()})},{onFinalFailure:()=>{J.setCache(t,n),M.error("ãƒ•ã‚£ãƒ«ã‚¿ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function La(e,t,r){const a=J.getFilters(t),n=a.filter(i=>i.id!==r);J.setCache(t,n);const o=v.filters(e,t);return U(async()=>{await Ee(F(w,o,r))},{onFinalFailure:()=>{J.setCache(t,a),M.error("ãƒ•ã‚£ãƒ«ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Nt=()=>Re(q.getState().language).t;function Fa(e){return e?Ca(e):[]}function Ra(e){return Sa(e)}function Pa(e,t){var a;const r=(a=C.currentUser)==null?void 0:a.uid;return!r||!e?(t([]),()=>{}):Ta(r,e,t)}async function gi(e){var l;const t=Nt(),r=(l=C.currentUser)==null?void 0:l.uid;if(!r)throw M.error(t("validation.auth_required")),new Error("Authentication required");const{workspaceId:a,...n}=e;if(!a)throw M.error(t("validation.workspace_required")),new Error("Workspace ID required");const o=or.pick({name:!0,query:!0}).safeParse(n);if(!o.success){const d=o.error.issues.map(u=>u.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),M.error(`${t("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...c}=n;await Aa(r,a,{name:c.name,query:c.query,workspaceId:a,ownerId:r})}async function mi(e,t,r){var l;const a=Nt(),n=(l=C.currentUser)==null?void 0:l.uid;if(!n||!e)throw M.error(a("validation.auth_required")),new Error("Authentication required");const o=or.partial().safeParse(r);if(!o.success){const d=o.error.issues.map(u=>u.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),M.error(`${a("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...c}=r;await Ma(n,e,t,c)}async function Ba(e,t){var n;const r=Nt(),a=(n=C.currentUser)==null?void 0:n.uid;if(!a||!e)throw M.error(r("validation.auth_required")),new Error("Authentication required");await La(a,e,t)}const Oa=[],We=({entityName:e,subscribeFn:t,getCacheFn:r,isInitializedFn:a})=>{const{workspaceId:n,userId:o,loading:i}=Be(),c=I.useCallback(p=>!n||!o?()=>{}:t(n,()=>p()),[n,o,t]),l=I.useCallback(()=>n&&o&&a(n)?r(n):Oa,[n,o,a,r]),d=I.useSyncExternalStore(c,l),u=n?a(n):!1;return{entities:d,loading:i||!!n&&!u}},dr=()=>{const{entities:e,loading:t}=We({entityName:"filters",subscribeFn:(r,a)=>Pa(r,a),getCacheFn:Fa,isInitializedFn:Ra});return{filters:e,loading:t}};class Wa{constructor(){H(this,"batch");H(this,"count",0);H(this,"commits",[]);this.batch=Ae(w)}set(t,r){this.batch.set(t,r),this.checkLimit()}update(t,r){this.batch.update(t,r),this.checkLimit()}delete(t){this.batch.delete(t),this.checkLimit()}checkLimit(){this.count++,this.count>=450&&(this.commits.push(this.batch.commit()),this.batch=Ae(w),this.count=0)}async commitAll(){this.count>0&&this.commits.push(this.batch.commit()),await Promise.all(this.commits)}}const ue=Xt([Y(),f(),Rr(),Pr()]),$a=W({id:f(),title:f().min(1),description:f().nullable().optional(),status:ze(["todo","completed","archived"]).optional(),dueDate:ue,completedAt:ue,createdAt:ue,ownerId:f().optional(),projectId:f().nullable().optional(),labelIds:se(f()).optional(),timeBlockId:f().nullable().optional(),duration:Y().optional(),isImportant:st().optional(),recurrence:W({type:ze(["none","daily","weekly","weekdays","monthly"]).optional(),days:se(Y()).optional()}).nullable().optional(),order:Y().optional()}).passthrough(),za=W({id:f(),name:f().min(1),color:f().optional(),ownerId:f().optional(),createdAt:ue,order:Y().optional()}).passthrough(),Ua=W({id:f(),name:f().min(1),color:f().optional(),ownerId:f().optional(),createdAt:ue}).passthrough(),Va=W({id:f(),mode:f(),data:Yt(f(),f()),createdAt:ue,updatedAt:ue,ownerId:f().optional(),workspaceId:f().optional()}).passthrough(),qa=W({id:f(),name:f().min(1),start:f(),end:f(),color:f().optional(),order:Y().optional()}).passthrough(),Ha=W({id:f(),name:f().min(1),query:f(),createdAt:ue}).passthrough(),Ka=W({version:f().optional(),exportedAt:f().optional(),userId:f().optional(),workspaceId:f().optional(),tasks:se($a).default([]),projects:se(za).default([]),labels:se(Ua).default([]),targets:se(Va).default([]),timeBlocks:se(qa).default([]),customFilters:se(Ha).default([])}),Xa=e=>e instanceof Date?Le.fromDate(e):e,ge=e=>{if(e!=null){if(typeof e=="number")return new Date(e);if(typeof e=="string")return new Date(e)}};async function fi(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");try{const r=m=>m.docs.map(_=>{const N=_.data(),g={id:_.id};for(const x in N){const k=N[x];g[x]=k instanceof Le?k.toMillis():k}return g}),a=await oe(A(w,v.tasks(e,t))),n=r(a),o=await oe(A(w,v.projects(e,t))),i=r(o),c=await oe(A(w,v.labels(e,t))),l=r(c),d=await oe(A(w,v.targets(e,t))),u=r(d),h=await oe(A(w,v.timeblocks(e,t))),p=r(h),y=await oe(A(w,v.filters(e,t))),b=r(y);return{version:"1.4",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:n,projects:i,labels:l,targets:u,timeBlocks:p,customFilters:b}}catch(r){throw console.error("[Backup] createBackupData failed:",r),r}}async function xi(e,t,r){var c;if(!e||!t)throw new Error("Invalid import parameters: userId and workspaceId are required.");if(!r)throw new Error("Invalid import parameters: backupData is required.");const a=Ka.safeParse(r);if(!a.success)throw console.error("[Backup] Validation failed:",a.error.format()),new Error(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™: ${a.error.issues.map(l=>l.message).join(", ")}`);const n=a.data,o=[],i=new Wa;try{const{tasks:l,projects:d,labels:u,targets:h,timeBlocks:p,customFilters:y}=n,b=new Map,m=new Map,_=await oe(A(w,v.labels(e,t))),N=new Map;_.forEach(g=>N.set(g.data().name,g.id));for(const g of u)try{const x=(c=g.name)==null?void 0:c.trim();if(!x)continue;if(N.has(x))m.set(g.id,N.get(x));else{const k={...g,name:x};delete k.id;const D=F(A(w,v.labels(e,t)));i.set(D,k),m.set(g.id,D.id),N.set(x,D.id)}}catch(x){o.push(`ãƒ©ãƒ™ãƒ« "${g.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}for(const g of d)try{const x={...g};delete x.id,x.createdAt=ge(g.createdAt);const k=F(A(w,v.projects(e,t)));i.set(k,x),b.set(g.id,k.id)}catch(x){o.push(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ "${g.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}for(const g of p)try{const x={...g};delete x.id;const k=F(A(w,v.timeblocks(e,t)));i.set(k,x)}catch(x){o.push(`ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ "${g.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}for(const g of y)try{const x={...g};delete x.id,x.createdAt=ge(g.createdAt);const k=F(A(w,v.filters(e,t)));i.set(k,x)}catch(x){o.push(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ "${g.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}for(const g of h)try{const x={...g};delete x.id,x.createdAt=ge(g.createdAt),x.updatedAt=ge(g.updatedAt),x.ownerId=e,x.workspaceId=t;const k=F(A(w,v.targets(e,t)));i.set(k,x)}catch(x){o.push(`ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (mode: ${g.mode}) ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}for(const g of l)try{const x={...g};delete x.id,x.createdAt=ge(g.createdAt);const k=ge(g.dueDate);x.dueDate=k?Xa(k):null,x.completedAt=ge(g.completedAt),g.projectId&&b.has(g.projectId)?x.projectId=b.get(g.projectId):x.projectId=null,Array.isArray(g.labelIds)&&(x.labelIds=g.labelIds.map(L=>m.get(L)).filter(L=>!!L)),x.ownerId=e;const D=F(A(w,v.tasks(e,t)));i.set(D,x)}catch(x){o.push(`ã‚¿ã‚¹ã‚¯ "${g.title}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆæº–å‚™ã«å¤±æ•—: ${x}`)}return await i.commitAll(),{tasksCount:l.length,projectsCount:d.length,labelsCount:u.length,targetsCount:h.length,timeBlocksCount:p.length,filtersCount:y.length,errors:o}}catch(l){throw console.error("[Backup] importBackupData failed:",l),l}}function Et(){var t;const e=(t=C.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function le(){var r;const e=(r=C.currentUser)==null?void 0:r.uid,t=he();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}function Xe(){return Re(q.getState().language).t}function Ya(e,t,r=!0){const a=e.safeParse(t);if(a.success)return{success:!0,data:a.data};const n=Ga(a.error);if(r){const o=Xe();M.error(`${o("validation.validation_error")}: ${n}`)}return{success:!1,errorMessage:n}}function Ga(e){return e.issues.map(t=>t.message).join(", ")}function Ye(e,t,r=!0){const a=Ya(e,t,r);if(!a.success)throw new Error(`Validation failed: ${a.errorMessage}`);return a.data}async function Q(e,t,r={}){var i;const{successMessageKey:a,rethrow:n=!0}=r,o=Xe();try{const c=await e();return a&&M.success(o(a)),c}catch(c){if(console.error(`[Store] ${t}:`,c),(i=c.message)!=null&&i.includes("Validation")||M.error(o(t)),n)throw c;return}}async function Tt(e,t,r,a,n){const o=e.getItems(t);try{const i=r(o);e.setCache(t,i),await U(a,{onFinalFailure:c=>{console.error("[OptimisticUpdate] Failed:",c),e.setCache(t,o);const l=Xe(),d=n.includes(".")?l(n):n;M.error(d)}})}catch(i){throw i}}class Ja extends we{constructor(){super({logPrefix:"[LabelCache]"})}getLabels(t){return this.getItems(t)}subscribe(t,r,a){const n=this.registerListener(r,a);if(!this.hasFirestoreSubscription(r)){const o=v.labels(t,r),i=ce(A(w,o));this.__subscribeToQuery(r,i,c=>({id:c.id,...c.data()}))}return n}}const Te=new Ja,Za=e=>Te.isInitialized(e),Qa=e=>Te.getLabels(e);function en(e,t,r){return!e||!t?(r([]),()=>{}):Te.subscribe(e,t,r)}async function tn(e,t,r,a){const o={id:"temp-"+Date.now(),name:r,color:a,ownerId:e,createdAt:new Date};return Tt(Te,t,i=>[...i,o],async()=>{const i=v.labels(e,t);await ke(A(w,i),{name:r,color:a,ownerId:e,workspaceId:t,createdAt:K()})},"ãƒ©ãƒ™ãƒ«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}async function rn(e,t,r,a){return Tt(Te,t,n=>n.map(o=>o.id===r?{...o,...a}:o),async()=>{const n=v.labels(e,t),o=F(w,n,r);await Ne(o,a)},"ãƒ©ãƒ™ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}async function sn(e,t,r){return Tt(Te,t,a=>a.filter(n=>n.id!==r),async()=>{const a=v.labels(e,t);await Ee(F(w,a,r))},"ãƒ©ãƒ™ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}const an=Qa,nn=e=>e?Za(e):!1;function on(e,t){var a;const r=(a=C.currentUser)==null?void 0:a.uid;return r&&e?en(r,e,t):(t([]),()=>{})}async function bi(e,t,r){const a=Et();if(!e)throw new Error("Workspace ID required");const n={name:t,color:r,ownerId:a};return Ye(nr.pick({name:!0,color:!0,ownerId:!0}),n),Q(()=>tn(a,e,t,r),"msg.label.create_fail")}async function yi(e,t,r){const a=Et();if(!e)throw new Error("Workspace ID required");return Ye(nr.partial(),r),Q(()=>rn(a,e,t,r),"msg.label.update_fail")}async function ki(e,t){const r=Et();if(!e)throw new Error("Workspace ID required");return Q(()=>sn(r,e,t),"msg.label.delete_fail",{successMessageKey:"msg.label.delete_success"})}function cn(e,t){return mt(e,t)}function ln(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;const r=[...e].sort((n,o)=>(n.id||"").localeCompare(o.id||"")),a=[...t].sort((n,o)=>(n.id||"").localeCompare(o.id||""));return mt(r,a)}function dn(e,t){return mt(e,t)}class un extends we{constructor(){super({logPrefix:"[ProjectCache]"})}getProjects(t){return this.getItems(t)}subscribe(t,r,a){const n=this.registerListener(r,a);if(!this.hasFirestoreSubscription(r)){const o=v.projects(t,r),i=ce(A(w,o));this.__subscribeToQuery(r,i,c=>({id:c.id,...c.data()}),dn)}return n}}const O=new un,hn=e=>O.isInitialized(e),pn=e=>O.getProjects(e),gn=(e,t)=>O.setCache(e,t);function mn(e,t,r){return O.subscribe(e,t,r)}async function fn(e,t,r,a){const n=O.getProjects(t),i={id:"temp-"+Date.now(),name:r,color:a,ownerId:e,createdAt:new Date};O.setCache(t,[...n,i]);const c=v.projects(e,t);return U(async()=>{const l=await ke(A(w,c),{name:r,color:a,ownerId:e,createdAt:K()})},{onFinalFailure:()=>{console.error(`[ProjectCache] Failed to add project: ${r}`),O.setCache(t,n),M.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function xn(e,t,r,a){const n=O.getProjects(t),o=n.map(i=>i.id===r?{...i,...a}:i);return O.setCache(t,o),U(async()=>{const i=v.projects(e,t),c=F(w,i,r);await Ne(c,a)},{onFinalFailure:()=>{O.setCache(t,n),M.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function bn(e,t,r){const a=O.getProjects(t),n=a.filter(o=>o.id!==r);return O.setCache(t,n),U(async()=>{const o=v.projects(e,t);await Ee(F(w,o,r))},{onFinalFailure:()=>{O.setCache(t,a),M.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function yn(e,t,r){const a=O.getProjects(t),n=new Map;r.forEach((i,c)=>n.set(i,c));const o=a.map(i=>{const c=n.get(i.id);return c!==void 0?{...i,order:c}:i});return o.sort((i,c)=>{const l=i.order??Number.MAX_SAFE_INTEGER,d=c.order??Number.MAX_SAFE_INTEGER;return l-d}),O.setCache(t,o),U(async()=>{const i=Ae(w),c=v.projects(e,t);r.forEach((l,d)=>{if(l&&!l.startsWith("temp-")){const u=F(w,c,l);i.update(u,{order:d})}}),await i.commit()},{onFinalFailure:()=>{O.setCache(t,a),M.error("ä¸¦ã³æ›¿ãˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const kn=e=>{const t=e||he();return t?pn(t):[]},wn=e=>{const t=e||he();return t?hn(t):!1},jn=(e,t)=>{const r=t||he();r&&gn(r,e)},vn=(e,t)=>{const r=typeof e=="function"?e:t,a=typeof e=="string"?e:he(),n=C.currentUser;return n&&a&&typeof r=="function"?mn(n.uid,a,r):(typeof r=="function"&&r([]),()=>{})},wi=async(e,t=null,r)=>{const a=C.currentUser;if(!a)throw new Error("Authentication required.");const n=t||he();if(!n)throw new Error("Workspace selection required.");const o={name:e,color:r,ownerId:a.uid};return Ye(ar.pick({name:!0,color:!0,ownerId:!0}),o),Q(()=>fn(a.uid,n,e,r),"msg.project.create_fail")},ji=async(e,t)=>{const{userId:r,workspaceId:a}=le();return Ye(ar.partial(),t),Q(()=>xn(r,a,e,t),"msg.project.update_fail")},In=async e=>{const{userId:t,workspaceId:r}=le();return Q(()=>bn(t,r,e),"msg.project.delete_fail",{successMessageKey:"msg.project.delete_success"})},_n=async e=>{const{userId:t,workspaceId:r}=le();return Q(()=>yn(t,r,e),"msg.project.reorder_fail")};class Dn extends we{constructor(){super({logPrefix:"[TargetCache]"})}getTargets(t){return this.getItems(t)}subscribe(t,r,a){const n=this.registerListener(r,a);if(!this.hasFirestoreSubscription(r)){const o=v.targets(t,r),i=ce(A(w,o),yt("createdAt","desc")),c=Fe(i,l=>{const d=l.docs.map(h=>({id:h.id,...h.data()})),u=this.getItems(r);u.length>0&&cn(u,d)||this.setCache(r,d)},l=>{console.error(`${this.config.logPrefix} Subscription error:`,l),this.setCache(r,[])});this.setFirestoreSubscription(r,c)}return n}}const Ie=new Dn,vi=e=>Ie.isInitialized(e),Ii=e=>Ie.getTargets(e);function _i(e,t,r,a){return!e||!t?(r([]),()=>{}):Ie.subscribe(e,t,n=>{r(n)})}async function Di(e,t,r){const a=Ie.getTargets(t),o={id:"temp-"+Date.now(),mode:r.mode||"",data:r.data||{},ownerId:e,workspaceId:t,createdAt:new Date,updatedAt:new Date,...r};return Ie.setCache(t,[o,...a]),U(async()=>{const i=v.targets(e,t),c={...r,ownerId:e,workspaceId:t,createdAt:K(),updatedAt:K()};delete c.id,await ke(A(w,i),c)},{onFinalFailure:()=>{console.error("[TargetCache] Failed to add target"),Ie.setCache(t,a),M.error("ç›®æ¨™ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const rt=e=>{if(e instanceof Le||typeof e=="object"&&e!==null&&"toDate"in e&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e},ur=e=>e instanceof Date?Le.fromDate(e):e;function Nn(e,t){if(!t||typeof t!="object")return console.warn(`[deserializeTask] Invalid data for task ${e}:`,t),{id:e,title:"Invalid Task",status:"todo",ownerId:""};const r=t.recurrence;let a=null;r&&typeof r=="object"&&"type"in r&&(a={type:r.type,days:Array.isArray(r.days)?r.days:void 0});const n={id:e,title:String(t.title||"Untitled"),description:t.description?String(t.description):null,status:t.status==="completed"||t.status==="todo"||t.status==="archived"?t.status:"todo",dueDate:rt(t.dueDate)||void 0,createdAt:rt(t.createdAt)||void 0,completedAt:rt(t.completedAt)||void 0,ownerId:String(t.ownerId||""),projectId:t.projectId?String(t.projectId):null,labelIds:Array.isArray(t.labelIds)?t.labelIds.map(String):[],timeBlockId:t.timeBlockId?String(t.timeBlockId):null,duration:typeof t.duration=="number"?t.duration:void 0,isImportant:!!t.isImportant,recurrence:a};return jt.safeParse(n).success,n}const fe=class fe extends we{constructor(){super({logPrefix:"[TaskCache]"});H(this,"currentWorkspaceId",null)}static getInstance(){return fe.instance||(fe.instance=new fe),fe.instance}getTasks(r){return this.getItems(r)}getTask(r,a){return this.getItems(r).find(o=>o.id===a)}reset(r){this.clearCache(r),this.currentWorkspaceId=null}subscribe(r,a,n,o){if(!r||!a)return n([]),()=>{};this.currentWorkspaceId=a;const i=this.registerListener(a,n);if(!this.hasFirestoreSubscription(a)){const c=v.tasks(r,a),l=ce(A(w,c));this.__subscribeToQuery(a,l,d=>Nn(d.id,d.data()),ln)}return i}};H(fe,"instance");let ht=fe;const Ge=ht.getInstance();function hr(e,t){return Ge.getTask(e,t)}function En(e){return Ge.getTasks(e)}function Tn(e){return Ge.isInitialized(e)}function Cn(e,t,r,a){return Ge.subscribe(e,t,r,a)}function pr(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!==void 0))}async function Sn(e,t,r){const a=v.tasks(e,t),n=[];for(let i=0;i<r.length;i+=500)n.push(r.slice(i,i+500));const o=new Map(r.map((i,c)=>[i,c]));for(const i of n){const c=Ae(w);i.forEach(l=>{const d=o.get(l),u=F(w,a,l);c.update(u,{order:d})}),await c.commit()}}async function gr(e,t,r){const a=v.tasks(e,t),n=pr({...r});n.dueDate&&(n.dueDate=ur(n.dueDate)),delete n.id,await ke(A(w,a),{...n,ownerId:e,status:"todo",createdAt:K()})}async function An(e,t,r,a){const n=v.tasks(e,t),o={status:a,completedAt:null};a==="completed"&&(o.completedAt=K()),await Ne(F(w,n,r),o)}async function Mn(e,t,r,a){const n=v.tasks(e,t),o=pr({...a});o.dueDate!==void 0&&(o.dueDate=ur(o.dueDate)),await Ne(F(w,n,r),o)}async function Ln(e,t,r){const a=v.tasks(e,t);await Ee(F(w,a,r))}async function Ni(e){const{userId:t,workspaceId:r}=le(),n=jt.partial().required({title:!0}).safeParse(e);return n.success||console.warn("[addTask] Validation warning:",n.error.flatten()),Q(()=>gr(t,r,e),"msg.task.create_fail")}async function Fn(e,t){const{userId:r,workspaceId:a}=le();if(t==="completed"){const n=hr(a,e);if(n!=null&&n.recurrence&&n.recurrence.type!=="none"){const o=wa(n.dueDate??null,n.recurrence);if(o){const i={title:n.title,description:n.description,projectId:n.projectId,labelIds:n.labelIds,timeBlockId:n.timeBlockId,duration:n.duration,isImportant:n.isImportant,recurrence:n.recurrence,dueDate:o,status:"todo"};gr(r,a,i).catch(c=>console.error("Failed to create recurring task:",c))}}}return Q(()=>An(r,a,e,t),"msg.task.status_update_fail")}async function mr(e,t){const{userId:r,workspaceId:a}=le(),n=jt.partial().safeParse(t);return n.success||console.warn("[updateTask] Validation warning:",n.error.flatten()),Q(()=>Mn(r,a,e,t),"msg.task.update_fail")}async function Rn(e){const{userId:t,workspaceId:r}=le();return Q(()=>Sn(t,r,e),"msg.task.update_fail")}async function Pn(e){const{userId:t,workspaceId:r}=le();return Q(()=>Ln(t,r,e),"msg.task.delete_fail",{successMessageKey:"msg.task.delete_success"})}async function Bn(e,t){const{workspaceId:r}=le(),a=Xe(),n=hr(r,e),i=((n==null?void 0:n.status)||t)==="completed"?"todo":"completed";await Fn(e,i),i==="completed"&&M.success(a("msg.task.complete_success"))}function On(e,t,r){const a=C.currentUser;return!a||!e?(typeof t=="function"&&t([]),()=>{}):Cn(a.uid,e,t,r)}const Wn=e=>{const t=e||he();return t?En(t):[]},$n=e=>{const t=e||he();return t?Tn(t):!1},zn=j.TIME_BLOCK.DEFAULTS.map(e=>({...e})),xe=class xe extends we{constructor(){super({logPrefix:"[TimeBlockCache]"})}static getInstance(){return xe.instance||(xe.instance=new xe),xe.instance}getBlocks(t){return this.getItems(t)}subscribe(t,r,a){if(!t||!r)return a([]),()=>{};const n=this.registerListener(r,a);if(!this.hasFirestoreSubscription(r)){const o=v.timeblocks(t,r),i=ce(A(w,o),yt("order","asc"));let c=!0;const l=Fe(i,d=>{const u=d.docs.map(h=>({id:h.id,...h.data()}));if(c&&u.length===0&&!d.metadata.hasPendingWrites){c=!1,Un(t,r).catch(h=>console.error(`${this.config.logPrefix} Failed to create defaults:`,h));return}c=!1,this.setCache(r,u)},d=>{console.error(`${this.config.logPrefix} Subscription error:`,d)});this.setFirestoreSubscription(r,l)}return n}};H(xe,"instance");let pt=xe;const Z=pt.getInstance();async function Un(e,t){const r=v.timeblocks(e,t),a=Ae(w);zn.forEach(n=>{const o=F(w,r,n.id);a.set(o,{name:n.name,start:n.start,end:n.end,color:n.color,order:n.order,updatedAt:K()})}),await a.commit()}function Vn(e,t,r){return Z.subscribe(e,t,r)}function qn(e){return Z.getBlocks(e)}function Hn(e){return Z.isInitialized(e)}async function Kn(e,t,r){const a=Z.getBlocks(t),n=[...a,r].sort((c,l)=>(c.order||0)-(l.order||0));Z.setCache(t,n);const o=v.timeblocks(e,t),i=r.id||crypto.randomUUID();return U(async()=>{await Zt(F(w,o,i),{...r,updatedAt:K()})},{onFinalFailure:()=>{Z.setCache(t,a),M.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Xn(e,t,r,a){const n=Z.getBlocks(t),o=n.map(c=>c.id===r?{...c,...a}:c).sort((c,l)=>(c.order||0)-(l.order||0));Z.setCache(t,o);const i=v.timeblocks(e,t);return U(async()=>{await Zt(F(w,i,r),{...a,updatedAt:K()},{merge:!0})},{onFinalFailure:()=>{Z.setCache(t,n),M.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Yn(e,t,r){const a=Z.getBlocks(t),n=a.filter(i=>i.id!==r);Z.setCache(t,n);const o=v.timeblocks(e,t);return U(async()=>{await Ee(F(w,o,r))},{onFinalFailure:()=>{Z.setCache(t,a),M.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Gn=()=>Re(q.getState().language).t;function fr(e){var r;const t=(r=C.currentUser)==null?void 0:r.uid;if(!t||!e)throw new Error("Authentication and Workspace are required.");return t}function Jn(e,t){var a;const r=(a=C.currentUser)==null?void 0:a.uid;return r?Vn(r,e,t):(t([]),()=>{})}function xr(e){return qn(e)}function Zn(e){return Hn(e)}async function Ei(e,t){const r=fr(e),a=Gn();try{const n=t.id||crypto.randomUUID(),o=xr(e),i=t.order!==void 0?t.order:Math.max(...o.map(u=>u.order||0),-1)+1,c={id:n,name:t.name||"",start:t.start||"09:00",end:t.end||"10:00",color:t.color||j.DEFAULT_COLORS.TIME_BLOCK_INACTIVE,order:i},l=Ls.safeParse(c);if(!l.success){const u=l.error.issues.map(h=>h.message).join(", ");return console.error("[TimeBlocks] Validation error:",l.error),M.error(`${a("validation.validation_error")}: ${u}`),!1}return o.some(u=>u.id===n)?await Xn(r,e,n,c):await Kn(r,e,c),!0}catch(n){return console.error("[TimeBlocks] Save error:",n),!1}}async function Qn(e,t){const r=fr(e);try{return await Yn(r,e,t),!0}catch(a){return console.error("[TimeBlocks] Delete error:",a),!1}}const Je=()=>{const{entities:e,loading:t}=We({entityName:"tasks",subscribeFn:(r,a)=>On(r,a,n=>console.error("Task subscription error:",n)),getCacheFn:Wn,isInitializedFn:$n});return{tasks:e,loading:t}};function Ct(){const{tasks:e}=Je(),{filters:t}=dr(),{showCompleted:r,query:a}=re();return I.useMemo(()=>{var l,d;const o={inbox:0,today:0,upcoming:0,important:0,all:0,search:0,projects:{},customFilters:{}},i=a?a.toLowerCase().trim():"",c=t.map(u=>({id:u.id,conditions:_t(u.query)}));for(const u of e){if(i){const p=(l=u.title)==null?void 0:l.toLowerCase().includes(i),y=(d=u.description)==null?void 0:d.toLowerCase().includes(i);(p||y)&&o.search++}if(u.status==="archived")continue;const h=u.status==="completed";if(!h)for(const{id:p,conditions:y}of c)lr(u,y)&&(o.customFilters[p]=(o.customFilters[p]||0)+1);if(!h&&(o.all++,u.projectId&&(o.projects[u.projectId]=(o.projects[u.projectId]||0)+1),(!u.projectId||u.projectId==="unassigned"||u.projectId==="none")&&o.inbox++,u.isImportant&&o.important++,u.dueDate)){const p=B(u.dueDate);if(p){const y=Dt(new Date);p<y||cr(p)?o.today++:va(p)&&o.upcoming++}}}return o},[e,a,t])}const eo=e=>e in j.SIDEBAR_DENSITY,Ze=e=>eo(e)?j.SIDEBAR_DENSITY[e]:j.SIDEBAR_DENSITY.normal,to=[{id:"inbox",i18nKey:"inbox",Icon:Es,color:"text-blue-500",droppable:!0},{id:"today",i18nKey:"today",Icon:it,color:"text-green-500"},{id:"upcoming",i18nKey:"upcoming",Icon:Ds,color:"text-purple-500"}],ro=()=>{const{language:e,density:t}=q(),{t:r}=Re(e),a=Ct(),{setView:n,currentView:o}=ae(),i=o==="dashboard";return s.jsxs("ul",{className:"space-y-0.5",children:[s.jsx("li",{children:s.jsxs("button",{onClick:()=>n("dashboard"),className:E("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Ze(t),i?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[s.jsx(rr,{className:"w-4 h-4 text-indigo-500"}),s.jsx("span",{className:"flex-1",children:r("dashboard")})]})}),to.map(c=>s.jsx(so,{item:c,label:r(c.i18nKey),count:a[c.id]||0},c.id))]})},so=({item:e,label:t,count:r})=>{const{filterType:a,setFilter:n}=re(),{setView:o}=ae(),{density:i}=q(),l=ae(y=>y.currentView)==="tasks"&&a===e.id,d=e.Icon,{setNodeRef:u,isOver:h}=Me({id:`filter:${e.id}`,disabled:!e.droppable,data:{type:e.id==="inbox"?"inbox":"filter",value:e.id}}),p=()=>{e.id==="search"?(o("tasks"),n("search")):(o("tasks"),n(e.id))};return s.jsx("li",{ref:u,children:s.jsxs("button",{onClick:p,className:E("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Ze(i),l?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",h&&e.droppable&&"bg-blue-50 dark:bg-blue-900/30"),children:[s.jsx(d,{className:E("w-4 h-4",e.color)}),s.jsx("span",{className:"flex-1",children:t}),e.id!=="search"&&r>0&&s.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:r})]})})},Qe=({x:e,y:t,onClose:r,children:a})=>{const n=I.useRef(null);return I.useEffect(()=>{const o=c=>{n.current&&!n.current.contains(c.target)&&r()},i=()=>r();return document.addEventListener("mousedown",o),window.addEventListener("scroll",i,!0),()=>{document.removeEventListener("mousedown",o),window.removeEventListener("scroll",i,!0)}},[r]),Br.createPortal(s.jsx("div",{ref:n,className:"fixed min-w-[160px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{top:t,left:e,zIndex:j.Z_INDEX.POPOVER},onContextMenu:o=>o.preventDefault(),children:a}),document.body)},ao=({label:e,icon:t,children:r})=>{const[a,n]=S.useState(!1);return s.jsxs("div",{className:"relative w-full",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[s.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm flex items-center justify-between gap-2 transition-colors text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[t&&s.jsx("span",{className:"w-4 h-4 text-gray-400",children:t}),e]}),s.jsx(ws,{className:"w-3 h-3 text-gray-400"})]}),a&&s.jsx("div",{className:"absolute left-full top-0 ml-1 min-w-[140px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{zIndex:j.Z_INDEX.POPOVER},children:r})]})},X=({onClick:e,children:t,className:r,icon:a,variant:n="default"})=>s.jsxs("button",{onClick:o=>{o.stopPropagation(),e()},className:E("w-full text-left px-3 py-2 text-sm flex items-center gap-2 transition-colors",n==="danger"?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",r),children:[a&&s.jsx("span",{className:E("w-4 h-4",n==="danger"?"text-red-500":"text-gray-400"),children:a}),t]}),be=({icon:e,label:t,count:r,isActive:a,isOver:n,onClick:o,onContextMenu:i,showZero:c=!1})=>{const{density:l}=q();return s.jsxs("button",{type:"button",onClick:o,onContextMenu:i,className:E("w-full text-left group flex items-center justify-between px-2 ml-1 rounded-md transition-colors select-none outline-none focus:ring-2 focus:ring-blue-500/50",Ze(l),a?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",n&&"bg-blue-50 dark:bg-blue-900/30"),children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e&&s.jsx("span",{className:"flex-shrink-0 w-5 flex justify-center text-sm",children:e}),s.jsx("span",{className:"text-sm truncate",children:t})]}),r!==void 0&&(r>0||c&&r===0)&&s.jsx("span",{className:E("text-[10px] font-bold px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700/50",a?"text-blue-700 dark:text-blue-300 bg-white":"text-gray-400"),children:r})]})},no=()=>{const{filters:e,loading:t}=dr(),{workspaceId:r}=Be(),a=Ct();return t?null:s.jsx("div",{className:"space-y-0.5 py-1",children:e.map(n=>s.jsx(oo,{filter:n,workspaceId:r,count:a.customFilters[n.id]||0},n.id))})},oo=({filter:e,workspaceId:t,count:r})=>{const{t:a}=P(),{filterType:n,targetId:o,setFilter:i}=re(),{openModal:c}=ne(),l=n==="custom"&&o===e.id,[d,u]=I.useState(null),h=()=>{u(null),c("filter-edit",e)},p=()=>{u(null),c("confirmation",{title:a("delete"),message:`${a("filter")}: ${e.name}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&t&&await Ba(t,e.id)}})},y=b=>{b.preventDefault(),b.stopPropagation(),u({x:b.clientX,y:b.clientY})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{onContextMenu:y,children:s.jsx(be,{label:e.name,icon:s.jsx(wt,{size:16}),count:r,isActive:l,onClick:()=>i("custom",e.id)})}),d&&s.jsxs(Qe,{x:d.x,y:d.y,onClose:()=>u(null),children:[s.jsx(X,{onClick:h,icon:s.jsx(De,{size:16}),children:a("edit")}),s.jsx(X,{onClick:p,variant:"danger",icon:s.jsx(_e,{size:16}),children:a("delete")})]})]})},io=S.memo(({mins:e,count:t})=>{const{t:r}=P(),{filterType:a,targetId:n,setFilter:o}=re(),{setView:i}=ae(),c=a==="duration"&&n===e.toString(),{setNodeRef:l,isOver:d}=Me({id:`duration:${e}`,data:{type:"duration",value:e.toString()}});return s.jsx("div",{ref:l,children:s.jsx(be,{label:r("sidebar.duration_format",{min:e}),icon:s.jsx(sr,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),count:t,isActive:c,isOver:d,onClick:()=>{i("tasks"),o("duration",e.toString())}})})}),co=()=>{const{tasks:e}=Je(),{customDurations:t}=q(),r=(t==null?void 0:t.length)>0?t:j.SIDEBAR.DURATIONS,a=I.useMemo(()=>{const n=new Map;return e.forEach(o=>{if(o.status!=="completed"&&o.duration){const i=Number(o.duration);isNaN(i)||n.set(i,(n.get(i)||0)+1)}}),n},[e]);return s.jsx("div",{className:"space-y-0.5 py-1",children:r.map(n=>s.jsx(io,{mins:n,count:a.get(n)||0},n))})},St=()=>{const{entities:e,loading:t}=We({entityName:"projects",subscribeFn:(n,o)=>vn(n,o),getCacheFn:kn,isInitializedFn:wn}),{workspaceId:r}=Be();return{projects:e,loading:t,setProjectsOverride:n=>{r&&jn(n,r)}}},lo=({id:e,children:t,className:r=""})=>{const{attributes:a,listeners:n,setNodeRef:o,transform:i,transition:c,isDragging:l,isOver:d}=ft({id:e}),u={transform:He.Transform.toString(i),transition:c},h=[l&&"opacity-50 scale-[1.02] shadow-lg z-50",d&&"ring-2 ring-indigo-500/50"].filter(Boolean).join(" ");return s.jsx("div",{ref:o,style:u,className:`${h} ${r}`.trim(),...a,...n,children:t})},br=()=>s.jsxs("div",{className:"space-y-2 p-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),uo=S.memo(({project:e})=>{const{t}=P(),{filterType:r,targetId:a,setFilter:n}=re(),{density:o}=q(),{openModal:i}=ne(),{setView:c}=ae(),l=r==="project"&&a===e.id,[d,u]=I.useState(null),{setNodeRef:h,isOver:p}=Me({id:`project:${e.id}`,data:{type:"project",value:e.id}}),y=g=>{g==null||g.stopPropagation(),u(null),i("project-edit",e)},b=()=>{u(null),i("confirmation",{title:t("delete"),message:`${t("project")}: ${e.name}
${t("msg.confirm_delete")}`,confirmLabel:t("delete"),variant:"danger",onConfirm:async()=>{e.id&&await In(e.id)}})},m=g=>{g.preventDefault(),g.stopPropagation(),u({x:g.clientX,y:g.clientY})},_=()=>{n("project",e.id),c("tasks")},N=Ct().projects[e.id]||0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{ref:h,onClick:_,onContextMenu:m,className:E("group flex items-center justify-between px-2 rounded-md cursor-pointer transition-colors select-none",Ze(o),l?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",p&&"bg-blue-50 dark:bg-blue-900/30"),role:"button",tabIndex:0,"aria-selected":l,"aria-label":`${t("project")}: ${e.name}${l?` (${t("active")})`:""}`,children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:E("text-xs shrink-0 transition-colors",l?"text-blue-500":"text-gray-400 group-hover:text-gray-500"),children:s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),s.jsx("span",{className:"text-sm truncate",children:e.name})]}),N>0&&s.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:N})]}),d&&s.jsxs(Qe,{x:d.x,y:d.y,onClose:()=>u(null),children:[s.jsx(X,{onClick:y,icon:s.jsx(De,{size:16}),children:t("edit")}),s.jsx(X,{onClick:b,variant:"danger",icon:s.jsx(_e,{size:16}),children:t("delete")})]})]})}),ho=()=>{const{t:e}=P(),{projects:t,loading:r}=St();return r?s.jsx(br,{}):t.length===0?s.jsx("div",{className:"p-4 text-xs text-gray-400",children:e("sidebar.no_projects")}):s.jsx(xt,{items:t.map(a=>`${j.DND.PREFIX_PROJECT}${a.id}`),strategy:bt,children:s.jsx("div",{className:"space-y-0.5 p-2",children:t.map(a=>s.jsx(lo,{id:`${j.DND.PREFIX_PROJECT}${a.id}`,children:s.jsx(uo,{project:a})},a.id))})})},po=({title:e,children:t,defaultExpanded:r=!0,action:a,dragHandleProps:n})=>{const{t:o}=P(),[i,c]=I.useState(()=>typeof window<"u"&&window.innerWidth<768?!1:r),d=`section-${encodeURIComponent(e.replace(/\s+/g,"-").toLowerCase())}`;return s.jsxs("div",{className:"mb-2 group/section",children:[s.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[s.jsxs("button",{...n,onClick:()=>c(!i),"aria-expanded":i,"aria-controls":d,className:"flex items-center flex-1 text-xs font-semibold text-gray-500 uppercase hover:text-gray-700 dark:hover:text-gray-300 transition-colors text-left cursor-grab active:cursor-grabbing touch-none select-none",title:o("sidebar.reorder_section"),children:[s.jsx("svg",{className:E("w-3 h-3 mr-1 transition-transform",i?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),e]}),a&&s.jsx("div",{className:"opacity-100 transition-opacity",onClick:u=>u.stopPropagation(),children:a})]}),i&&s.jsx("div",{className:"mt-1",id:d,children:t})]})},go=()=>{const{t:e}=P(),{currentView:t,setView:r}=ae();return s.jsxs("div",{className:"space-y-0.5 py-1",children:[s.jsx(be,{label:e("sidebar.target_wizard"),icon:s.jsx(vs,{}),isActive:t==="wizard",onClick:()=>r("wizard")}),s.jsx(be,{label:e("sidebar.target_dashboard"),icon:s.jsx(rr,{}),isActive:t==="target-dashboard",onClick:()=>r("target-dashboard")}),s.jsx(be,{label:e("sidebar.framework_wiki"),icon:s.jsx(Is,{}),isActive:t==="wiki",onClick:()=>r("wiki")})]})},At=()=>{const{entities:e,loading:t}=We({entityName:"timeblocks",subscribeFn:(r,a)=>Jn(r,a),getCacheFn:xr,isInitializedFn:Zn});return{timeBlocks:e,loading:t}},mo=()=>{const{timeBlocks:e,loading:t}=At(),{tasks:r}=Je(),{workspaceId:a}=Be(),n=S.useMemo(()=>{const o=new Map;let i=0;return r.forEach(c=>{c.status!=="completed"&&(!c.timeBlockId||c.timeBlockId==="unassigned"||c.timeBlockId==="null"?i++:o.set(c.timeBlockId,(o.get(c.timeBlockId)||0)+1))}),{map:o,unassignedCount:i}},[r]);return t?s.jsx(br,{}):s.jsxs("div",{className:"space-y-0.5 py-1",children:[e.map(o=>s.jsx(fo,{block:o,count:n.map.get(o.id||"")||0,workspaceId:a},o.id)),s.jsx(xo,{count:n.unassignedCount})]})},fo=({block:e,count:t,workspaceId:r})=>{const{t:a}=P(),{filterType:n,targetId:o,setFilter:i}=re(),{openModal:c}=ne(),l=n==="timeblock"&&o===e.id,{setView:d}=ae(),[u,h]=I.useState(null),{setNodeRef:p,isOver:y}=Me({id:`timeblock:${e.id}`,data:{type:"timeblock",value:e.id}}),b=()=>{h(null),c("timeblock-edit",e)},m=()=>{h(null),c("confirmation",{title:a("delete"),message:`${a("timeblock")}: ${e.start} - ${e.end}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&r&&await Qn(r,e.id)}})},_=g=>{g.preventDefault(),g.stopPropagation(),h({x:g.clientX,y:g.clientY})},N=()=>{i("timeblock",e.id||""),d("tasks")};return s.jsxs("div",{ref:p,onContextMenu:_,children:[s.jsx(be,{label:`${e.start} - ${e.end}`,icon:s.jsx("span",{className:"w-2 rounded-full aspect-square",style:{backgroundColor:e.color}}),count:t,isActive:l,isOver:y,onClick:N}),u&&s.jsxs(Qe,{x:u.x,y:u.y,onClose:()=>h(null),children:[s.jsx(X,{onClick:b,icon:s.jsx(De,{size:16}),children:a("edit")}),s.jsx(X,{onClick:m,variant:"danger",icon:s.jsx(_e,{size:16}),children:a("delete")})]})]})},xo=({count:e})=>{const{t}=P(),{filterType:r,targetId:a,setFilter:n}=re(),{setView:o}=ae(),i=r==="timeblock"&&a==="unassigned",{setNodeRef:c,isOver:l}=Me({id:"timeblock:unassigned",data:{type:"timeblock",value:"unassigned"}}),d=()=>{n("timeblock","unassigned"),o("tasks")};return s.jsx("div",{ref:c,children:s.jsx(be,{label:t("sidebar.unassigned"),icon:s.jsx("span",{className:"w-2 rounded-full aspect-square bg-gray-400"}),count:e,isActive:i,isOver:l,onClick:d})})},bo=({id:e,section:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:c}=ft({id:e}),l={transform:He.Transform.toString(o),transition:i,opacity:c?.5:1};return s.jsx("div",{ref:n,style:l,...r,children:s.jsx(po,{title:t.title,defaultExpanded:t.defaultExpanded,action:t.action,dragHandleProps:a,children:t.component})})},yo=()=>{const{t:e}=P(),{openModal:t}=ne(),{sidebarSections:r}=Pe(),a=r&&r.length>0?r:["general","projects","targets","timeblocks","durations","filters"],n=S.useMemo(()=>({general:{id:"general",title:e("general"),component:s.jsx(s.Fragment,{children:s.jsx(ro,{})}),defaultExpanded:!0},projects:{id:"projects",title:e("projects"),component:s.jsx(ho,{}),defaultExpanded:!0,action:s.jsx("button",{onClick:()=>t("project-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},targets:{id:"targets",title:e("targets"),component:s.jsx(go,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("wiki-framework"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},timeblocks:{id:"timeblocks",title:e("timeblocks"),component:s.jsx(mo,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("timeblock-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},durations:{id:"durations",title:e("durations"),component:s.jsx(co,{}),defaultExpanded:!1},filters:{id:"filters",title:e("filters"),component:s.jsx(no,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("filter-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})}}),[e,t]);return s.jsx(xt,{items:a,strategy:bt,children:s.jsx("div",{className:"flex flex-col gap-4",children:a.map(o=>{const i=n[o];return i?s.jsx(bo,{id:i.id,section:i},i.id):null})})})},yr=ye(e=>({onTasksReorder:null,setTasksReorderHandler:t=>e({onTasksReorder:t})})),gt=I.forwardRef(({className:e,variant:t="primary",size:r="md",isLoading:a,leftIcon:n,rightIcon:o,children:i,disabled:c,...l},d)=>{const u={primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg shadow-blue-500/30 border border-transparent",secondary:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 border border-transparent",danger:"bg-red-500 hover:bg-red-600 text-white shadow-md shadow-red-500/30 border border-transparent",ghost:"bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",outline:"bg-transparent border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",premium:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/40 border border-transparent"},h={sm:"text-xs px-3 py-1.5 rounded-lg gap-1.5",md:"text-sm px-4 py-2 rounded-lg gap-2",lg:"text-base px-6 py-3 rounded-xl gap-2.5",icon:"p-2 rounded-full aspect-square flex items-center justify-center"};return s.jsxs("button",{ref:d,className:E("flex items-center justify-center font-bold transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100",u[t],h[r],e),disabled:c||a,...l,children:[a&&s.jsx(Ts,{className:"-ml-1 text-currentColor",size:16}),!a&&n,i,!a&&o]})});gt.displayName="Button";const kr=I.forwardRef(({className:e,label:t,error:r,containerClassName:a,options:n,children:o,id:i,...c},l)=>{const d=I.useId(),u=i||d;return s.jsxs("div",{className:E("flex flex-col gap-1.5",a),children:[t&&s.jsx("label",{htmlFor:u,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),s.jsxs("div",{className:"relative group",children:[s.jsx("select",{ref:l,id:u,className:E("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl pl-4 pr-10 py-2.5 outline-none transition-all appearance-none cursor-pointer placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",r?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 text-gray-500 hover:border-gray-300 dark:hover:border-gray-600",e),"aria-invalid":!!r,"aria-describedby":r?`${u}-error`:void 0,...c,children:o||(n==null?void 0:n.map(h=>s.jsx("option",{value:h.value,children:h.label},h.value)))}),s.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",children:s.jsx(tr,{size:16})})]}),r&&s.jsx("p",{id:`${u}-error`,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:r})]})});kr.displayName="Select";const ko=e=>{if(!e)return"";const t=document.createElement("div");return t.innerHTML=e,t.textContent||t.innerText||""},wr=S.memo(({task:e,style:t,className:r,dragHandleProps:a})=>{const{t:n}=P(),o=e.status==="completed",{openModal:i}=ne(),{projects:c}=St(),{timeBlocks:l}=At(),[d,u]=I.useState(null),h=async D=>{D.stopPropagation(),e.id&&await Bn(e.id,e.status||"todo")},p=D=>{D.preventDefault(),D.stopPropagation(),u({x:D.clientX,y:D.clientY})},y=()=>{u(null),i("task-detail",e)},b=()=>{u(null),i("confirmation",{title:n("delete"),message:`${n("task")}: ${e.title}
${n("msg.confirm_delete")}`,confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{e.id&&await Pn(e.id)}})},m=async D=>{if(u(null),!e.id)return;let L=null;const R=new Date;switch(R.setHours(0,0,0,0),D){case"today":L=new Date;break;case"tomorrow":L=new Date(R),L.setDate(R.getDate()+1);break;case"next_week":L=new Date(R),L.setDate(R.getDate()+7);break;case"no_date":L=null;break}await mr(e.id,{dueDate:L})},_=e.projectId?c.find(D=>D.id===e.projectId):null,N=e.timeBlockId?l.find(D=>D.id===e.timeBlockId):null,g=!!(e.recurrence&&e.recurrence.type!=="none"),x=!!e.dueDate,k=B(e.dueDate);return s.jsxs(s.Fragment,{children:[s.jsxs("li",{style:t,onClick:()=>i("task-detail",e),onContextMenu:p,className:E("group flex items-center gap-3 p-[var(--task-p)] bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700/50 rounded-xl hover:shadow-sm hover:border-blue-200 dark:hover:border-blue-800 transition-all duration-200 cursor-default hover-lift",r),children:[a&&s.jsx("div",{...a,className:"cursor-move text-gray-300 dark:text-gray-600 hover:text-gray-500 dark:hover:text-gray-400 p-1 -ml-1 flex-shrink-0 touch-none",children:s.jsx(_s,{className:"w-4 h-4"})}),s.jsx("button",{onClick:h,className:E("w-5 h-5 rounded-full border flex items-center justify-center transition-colors shrink-0 cursor-pointer",o?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-blue-400 text-transparent"),"aria-label":o?"Mark as incomplete":"Mark as complete",children:s.jsx(kt,{className:"w-3 h-3",strokeWidth:3})}),s.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[s.jsx("div",{className:E("text-sm text-gray-800 dark:text-gray-200 break-words",o&&"line-through text-gray-400 dark:text-gray-500"),children:e.title}),e.description&&s.jsx("div",{className:"text-xs text-gray-500 line-clamp-1 truncate",children:ko(e.description)})]}),s.jsxs("div",{className:"hidden sm:grid grid-cols-[90px_110px_50px_80px] gap-2 text-xs shrink-0 items-center",children:[s.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-300 overflow-hidden",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full shrink-0",style:{backgroundColor:(_==null?void 0:_.color)||j.DEFAULT_COLORS.PROJECT_INACTIVE}}),s.jsx("span",{className:"truncate",children:_?_.name:"PJãªã—"})]}),s.jsx("div",{className:"flex items-center gap-1 text-gray-400 dark:text-gray-500 overflow-hidden",children:N?s.jsxs(s.Fragment,{children:[s.jsx(sr,{className:"w-3.5 h-3.5 shrink-0"}),s.jsx("span",{className:"truncate",children:N.name})]}):s.jsx("span",{className:"text-[10px] text-gray-300 dark:text-gray-600 truncate",children:"æ™‚é–“å¸¯ãªã—"})}),s.jsx("div",{className:"text-gray-400 dark:text-gray-500 tabular-nums text-right overflow-hidden",children:e.duration?`${e.duration}m`:""}),s.jsx("div",{className:E("flex items-center justify-end gap-1 overflow-hidden",g||x?o?"text-gray-400":ka(e.dueDate):"text-gray-400 dark:text-gray-500 opacity-50"),children:g?s.jsxs(s.Fragment,{children:[s.jsx(Ns,{className:"w-3.5 h-3.5 shrink-0"}),k&&s.jsx("span",{className:"truncate",children:Vt(k)})]}):x&&k?s.jsxs(s.Fragment,{children:[s.jsx(it,{className:"w-3.5 h-3.5 shrink-0"}),s.jsx("span",{className:"truncate",children:Vt(k)})]}):s.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest",children:n("no_date")})})]})]}),d&&s.jsxs(Qe,{x:d.x,y:d.y,onClose:()=>u(null),children:[s.jsxs(ao,{label:n("date_change")||"æ—¥ä»˜å¤‰æ›´",icon:s.jsx(it,{}),children:[s.jsx(X,{onClick:()=>m("today"),children:n("today")}),s.jsx(X,{onClick:()=>m("tomorrow"),children:n("tomorrow")}),s.jsx(X,{onClick:()=>m("next_week"),children:n("next_week")||"æ¥é€±"}),s.jsx(X,{onClick:()=>m("no_date"),children:n("no_date")||"æœŸé™ãªã—"})]}),s.jsx(X,{onClick:y,icon:s.jsx(De,{}),children:n("edit")}),s.jsx(X,{onClick:b,variant:"danger",icon:s.jsx(_e,{}),children:n("delete")})]})]})},(e,t)=>{const r=(a,n)=>{var c,l;const o=(c=B(a))==null?void 0:c.getTime(),i=(l=B(n))==null?void 0:l.getTime();return o===i};return e.task.id===t.task.id&&e.task.status===t.task.status&&e.task.title===t.task.title&&e.task.description===t.task.description&&e.task.projectId===t.task.projectId&&e.task.timeBlockId===t.task.timeBlockId&&e.task.duration===t.task.duration&&e.task.recurrence===t.task.recurrence&&r(e.task.dueDate,t.task.dueDate)}),wo=({tasks:e,timeBlockId:t})=>{const{t:r,formatNumber:a}=P(),{timeBlocks:n}=At(),o=e.reduce((p,y)=>{const b=y.duration,m=typeof b=="number"?b:Number(b);return p+(isNaN(m)?0:m)},0),i=p=>a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2})+"h",c=t?n.find(p=>p.id===t):null;if(c&&c.start&&c.end){const p=ja(c.start,c.end);if(p<=0)return null;const y=a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2}),b=a(o/60,{minimumFractionDigits:2,maximumFractionDigits:2}),m=o/p*100,_=Math.min(m,100),N=p-o,g=N<0,x=a(Math.abs(N)/60,{minimumFractionDigits:2,maximumFractionDigits:2}),k=m>100;return s.jsxs("div",{className:"flex items-center gap-3 py-2 px-3 my-1 border border-gray-100 dark:border-gray-800 rounded-lg bg-gray-50/30 dark:bg-gray-800/20",children:[s.jsx("div",{className:"flex-shrink-0 w-20 truncate text-[10px] font-bold text-gray-400 uppercase tracking-tight",title:c.name,children:c.name}),s.jsxs("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums min-w-[70px]",children:[s.jsxs("span",{className:"font-bold text-gray-700 dark:text-gray-300",children:[b,"h"]}),s.jsx("span",{className:"text-gray-400 mx-0.5",children:"/"}),s.jsxs("span",{children:[y,"h"]})]}),s.jsx("div",{className:"flex-1 relative h-2 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[60px]",children:s.jsx("div",{className:E("h-full rounded-full transition-all duration-500 ease-out",k?"bg-red-500":"bg-blue-500"),style:{width:k?"100%":`${_}%`}})}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 tabular-nums",children:[s.jsxs("span",{className:E("text-xs font-bold w-[4ch] text-right",k?"text-red-500 dark:text-red-400":"text-blue-500 dark:text-blue-400"),children:[Math.round(m),"%"]}),s.jsxs("span",{className:E("text-[10px] hidden sm:inline",g?"text-red-400 dark:text-red-300":"text-gray-400 dark:text-gray-500"),children:["(",g?"+":"-",x,"h)"]})]})]})}const l=e.length,d=l>0?o/l:0,u=r("task_stats.count_unit"),h=r("task_stats.avg_unit");return s.jsxs("div",{className:"glass-card flex items-center justify-evenly py-3 px-4 my-2",children:[s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.count_label")}),s.jsxs("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200",children:[a(l),u&&s.jsx("span",{className:"text-xs font-normal ml-0.5 text-gray-400",children:u})]})]}),s.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.total_label")}),s.jsx("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200 text-blue-600 dark:text-blue-400",children:i(o)})]}),s.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.avg_label")}),s.jsxs("span",{className:"font-medium text-sm",children:[i(d),s.jsx("span",{className:"text-xs ml-0.5",children:h})]})]})]})},jo=({task:e,className:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:c}=ft({id:`${j.DND.PREFIX_TASK}${e.id||""}`,data:{type:"task",task:e}}),l={transform:He.Transform.toString(o),transition:i,zIndex:c?50:"auto",position:"relative"};return s.jsx("div",{ref:n,style:l,className:"touch-manipulation",children:s.jsx(wr,{task:e,className:E(t,c&&"opacity-80 shadow-lg border-blue-400 bg-blue-50/50"),dragHandleProps:{...r,...a}})})},vo=({task:e,className:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,isDragging:i}=Or({id:`${j.DND.PREFIX_TASK}${e.id||""}`,data:{type:"task",task:e}}),c={transform:He.Translate.toString(o),zIndex:i?50:"auto",position:"relative"};return s.jsx("div",{ref:n,style:c,className:"touch-manipulation",children:s.jsx(wr,{task:e,className:E(t,i&&"opacity-80 shadow-lg border-blue-400 bg-blue-50/50"),dragHandleProps:{...r,...a}})})},Io=()=>{const{t:e}=P(),{tasks:t,loading:r}=Je(),{filterType:a,targetId:n,query:o,showCompleted:i,sortCriteria:c,setShowCompleted:l,setSortCriteria:d}=re(),{density:u}=q(),{openModal:h}=ne(),p=I.useMemo(()=>o&&o.trim().length>0?{keyword:o,showCompleted:i,projectId:null,labelId:null,timeBlockId:null,duration:null,filterType:"all_tasks",savedFilter:null,sortCriteria:c}:{keyword:o,showCompleted:i,projectId:a==="inbox"?"unassigned":a==="project"?n:null,labelId:a==="label"?n:null,timeBlockId:a==="timeblock"?n:null,duration:a==="duration"?n:null,filterType:a,savedFilter:null,sortCriteria:c},[a,n,o,i,c]),y=I.useMemo(()=>Ea(t,p),[t,p]),b={compact:"space-y-1",normal:"space-y-2",comfortable:"space-y-3",spacious:"space-y-4"}[u],{setTasksReorderHandler:m}=yr(),[_,N]=S.useState(null);S.useEffect(()=>{N(null)},[t,p]);const g=_||y,x=S.useRef({localOrderedTasks:_,processedTasks:y,sortCriteria:c});S.useEffect(()=>{x.current={localOrderedTasks:_,processedTasks:y,sortCriteria:c}});const k=S.useCallback(async(V,Mt)=>{const{localOrderedTasks:vr,processedTasks:Ir,sortCriteria:_r}=x.current;if(_r!=="manual")return;const et=vr||Ir,Lt=et.findIndex(je=>je.id===V),Ft=et.findIndex(je=>je.id===Mt);if(Lt!==-1&&Ft!==-1){const je=nt(et,Lt,Ft);N(je);const Dr=je.map(tt=>tt.id).filter(Boolean);try{await Rn(Dr)}catch(tt){console.error("Failed to reorder tasks",tt),N(null)}}},[]),D=S.useRef(0),L=S.useRef(Date.now());S.useEffect(()=>{const V=Date.now();if(V-L.current>1e3&&(D.current=0),L.current=V,D.current++,D.current>10){console.error("[TaskList] Infinite loop detected in setTasksReorderHandler effect. Aborting registration.");return}return m(k),()=>m(null)},[k,m]);const R=g.length===0,ee=!!(o&&o.trim().length>0);if(r&&!ee&&t.length===0)return s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"text-gray-400 text-sm animate-pulse",children:e("task_list.loading")})});const pe=c==="manual";return s.jsxs("div",{className:"flex flex-col h-full overflow-hidden relative",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-1 pb-24",children:[s.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm pt-2 pb-4 mb-4 flex items-center gap-2",children:[s.jsx("div",{className:"flex-1",children:ee&&s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[s.jsx(wt,{className:"w-4 h-4"}),e("task_list.searching_results",{query:o||""})]})}),s.jsx("div",{className:"flex items-center gap-2 px-1",children:s.jsxs(kr,{name:"sortCriteria","aria-label":e("task_list.sort_options")||"Sort Options",value:c,onChange:V=>d(V.target.value),className:"font-medium text-xs py-1.5 h-auto",children:[s.jsx("option",{value:"manual",children:e("task_list.sort_manual")}),s.jsx("option",{value:"createdAt_desc",children:e("task_list.sort_created")}),s.jsx("option",{value:"dueDate_asc",children:e("task_list.sort_due")}),s.jsx("option",{value:"important_desc",children:e("task_list.sort_important")}),s.jsx("option",{value:"title_asc",children:e("task_list.sort_title")})]})}),s.jsx(gt,{variant:i?"primary":"outline",size:"sm",onClick:()=>l(!i),title:e(i?"task_list.hide_completed":"task_list.show_completed"),className:"shrink-0",children:e(i?"task_list.hide_completed":"task_list.show_completed")})]}),R?s.jsxs("div",{className:"text-center py-20 flex flex-col items-center justify-center min-h-[60vh]",children:[s.jsxs("div",{className:"relative mb-8",children:[s.jsx("div",{className:"absolute -inset-4 bg-blue-500/10 dark:bg-blue-400/10 blur-3xl rounded-full"}),s.jsx("div",{className:"relative",children:s.jsx(kt,{className:"w-24 h-24 text-blue-200 dark:text-blue-900/50",strokeWidth:1.5})})]}),s.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:e("task_list.no_tasks_title")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs mb-8",children:e(i?"task_list.no_tasks_desc_showing":"task_list.no_tasks_desc_hiding")}),s.jsx(gt,{variant:"premium",onClick:()=>h("task-detail",{title:""}),leftIcon:s.jsx(er,{className:"w-5 h-5"}),children:e("task_list.add_new_task")})]}):pe?s.jsx(xt,{items:g.map(V=>`${j.DND.PREFIX_TASK}${V.id||""}`),strategy:bt,children:s.jsx("div",{className:E("transition-all duration-200",b),children:g.map(V=>s.jsx(jo,{task:V},V.id))})}):s.jsx("div",{className:E("transition-all duration-200",b),children:g.map(V=>s.jsx(vo,{task:V},V.id))})]}),s.jsx("div",{className:"flex-none mt-auto pt-2 border-t border-gray-100 dark:border-gray-800 bg-white/50 dark:bg-gray-900/50 backdrop-blur pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:s.jsx(wo,{tasks:g,timeBlockId:p.timeBlockId})})]})},_o=(e,t)=>{const r=Wr(Rt(zr,{activationConstraint:{distance:5}}),Rt($r,{activationConstraint:{delay:j.DND.TOUCH_DELAY,tolerance:5}})),{t:a}=P(),n=I.useRef(e),o=I.useCallback(()=>{n.current=e},[e]),i=I.useCallback(async c=>{var m,_,N,g,x;const{active:l,over:d}=c;if(!d)return;const u=String(l.id),h=String(d.id);let p=null;if(l.data.current&&l.data.current.type==="task"&&(p=((m=l.data.current.task)==null?void 0:m.id)||u.replace(j.DND.PREFIX_TASK,"")),p){const k=d.data.current,D=k==null?void 0:k.type,L=k==null?void 0:k.value;if(D&&Do(D)){const R={};if(D===j.DND.TYPE_PROJECT)R.projectId=L;else if(D===j.DND.TYPE_INBOX)R.projectId=null;else if(D===j.DND.TYPE_TIMEBLOCK)R.timeBlockId=L==="unassigned"?null:L;else if(D===j.DND.TYPE_LABEL){const ee=(_=l.data.current)==null?void 0:_.task,te=(ee==null?void 0:ee.labelIds)??[];L&&(te.includes(L)?R.labelIds=te.filter(pe=>pe!==L):R.labelIds=[...te,L])}if(Object.keys(R).length>0){try{await mr(p,R)}catch(ee){console.error("Failed to update task via dnd",ee),M.error(a("msg.dnd.reorderFailed")||a("error"))}return}}if(u!==h&&h.startsWith(j.DND.PREFIX_TASK)){const R=h.replace(j.DND.PREFIX_TASK,"");(N=t==null?void 0:t.onTasksReorder)==null||N.call(t,p,R);return}}if(u!==h&&u.startsWith(j.DND.PREFIX_PROJECT)&&h.startsWith(j.DND.PREFIX_PROJECT)){const k=n.current,D=u.replace(j.DND.PREFIX_PROJECT,""),L=h.replace(j.DND.PREFIX_PROJECT,""),R=k.findIndex(te=>te.id===D),ee=k.findIndex(te=>te.id===L);if(R!==-1&&ee!==-1){const te=nt(k,R,ee);(g=t==null?void 0:t.onOptimisticReorder)==null||g.call(t,te);try{await _n(te.map(pe=>pe.id))}catch(pe){console.error("Failed to update project order",pe),M.error(a("msg.dnd.reorderFailed")||a("error")),(x=t==null?void 0:t.onRevertReorder)==null||x.call(t,k)}}return}const{sidebarSections:y,setSidebarSections:b}=Pe.getState();if(u!==h&&y.includes(u)&&y.includes(h)){const k=y.indexOf(u),D=y.indexOf(h);k!==-1&&D!==-1&&b(nt(y,k,D));return}},[e,t,a]);return{sensors:r,handleDragEnd:i,handleDragStart:o}};function Do(e){return[j.DND.TYPE_PROJECT,j.DND.TYPE_INBOX,j.DND.TYPE_TIMEBLOCK,j.DND.TYPE_LABEL].includes(e)}const No=()=>{const{entities:e,loading:t}=We({entityName:"labels",subscribeFn:(r,a)=>on(r,a),getCacheFn:an,isInitializedFn:nn});return{labels:e,loading:t}},Eo=()=>{const{fontEn:e,fontJp:t,fontSize:r,density:a,themeMode:n}=q(),{setSidebarDensity:o}=Pe();I.useEffect(()=>{const i=document.documentElement,c=document.body;let l;(()=>{l=requestAnimationFrame(()=>{n==="dark"?i.classList.add("dark"):n==="light"?i.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?i.classList.add("dark"):i.classList.remove("dark"),i.style.setProperty("--font-en",e),i.style.setProperty("--font-jp",t);const p=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];c.classList.remove(...p),c.classList.add(`font-app-${r}`);const y=["app-density-compact","app-density-normal","app-density-comfortable","app-density-spacious"];c.classList.remove(...y),c.classList.add(`app-density-${a}`)})})(),o(a);const u=window.matchMedia("(prefers-color-scheme: dark)"),h=()=>{n==="system"&&(u.matches?i.classList.add("dark"):i.classList.remove("dark"))};return u.addEventListener("change",h),()=>{u.removeEventListener("change",h),l&&cancelAnimationFrame(l)}},[n,e,t,r,a,o])},To=S.lazy(()=>z(()=>import("./DashboardApp-CnzqAJAO.js"),__vite__mapDeps([18,1,2,19,4,3])).then(e=>({default:e.DashboardApp}))),Co=S.lazy(()=>z(()=>import("./WikiApp-BaAIzRdU.js"),__vite__mapDeps([20,1,2,3,16,4])).then(e=>({default:e.WikiApp}))),So=S.lazy(()=>z(()=>import("./WizardApp-DKQK2pvg.js"),__vite__mapDeps([21,1,2,3,4,19,7])).then(e=>({default:e.WizardApp}))),Ao=S.lazy(()=>z(()=>import("./GeneralDashboard-DgOkmJVO.js"),__vite__mapDeps([22,1,2,3,4])).then(e=>({default:e.GeneralDashboard}))),Mo=S.lazy(()=>z(()=>import("./SearchView-Dfo4dqnO.js"),__vite__mapDeps([23,1,2,7,4,3])).then(e=>({default:e.SearchView})));function Kt(e){const t=String(e);return t.startsWith("project:")||t==="inbox"||t.startsWith("timeblock:")||t.startsWith("duration:")||t.startsWith("label:")}const Lo=e=>{const r=Vr(e).filter(n=>Kt(n.id));if(r.length>0)return r;const a=e.droppableContainers.filter(n=>Kt(n.id));if(a.length>0){const n={...e,droppableContainers:a},o=qr(n);if(o.length>0)return o}return Hr(e)},Fo=()=>{Eo();const{filterType:e,targetId:t,query:r}=re(),{currentView:a,setView:n}=ae(),{setFilter:o}=re(),{projects:i,setProjectsOverride:c}=St(),{labels:l}=No(),{t:d}=P(),{user:u,loading:h}=It(),p=I.useCallback(x=>{const k=x.target,D=["INPUT","TEXTAREA"].includes(k.tagName)||k.closest("[contenteditable]"),L=ne.getState().stack.length>0;x.key==="/"&&!D&&!L&&(x.preventDefault(),o("search"),n("search"))},[o,n]);S.useEffect(()=>(document.addEventListener("keydown",p),()=>{document.removeEventListener("keydown",p)}),[p]);const{onTasksReorder:y}=yr(),{sensors:b,handleDragEnd:m,handleDragStart:_}=_o(i,{onOptimisticReorder:c,onRevertReorder:c,onTasksReorder:y||void 0}),N=I.useMemo(()=>{var x,k;if(a==="wizard")return d("sidebar.target_wizard");if(a==="target-dashboard")return d("sidebar.target_dashboard");if(a==="wiki")return d("sidebar.framework_wiki");if(a==="search")return r?d("search_view.results_for",{query:r}):d("search");if(e==="project")return((x=i.find(D=>D.id===t))==null?void 0:x.name)||d("project");if(e==="label")return((k=l.find(D=>D.id===t))==null?void 0:k.name)||d("label");if(e==="search")return r?d("search_view.results_for",{query:r}):d("search");switch(e){case"inbox":return d("inbox");case"today":return d("today");case"upcoming":return d("upcoming");default:return"TaskMg"}},[a,r,e,t,i,l,d]),g=q(x=>x._hasHydrated);return h||!g?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"èª­ã¿è¾¼ã¿ä¸­..."})]})}):u?s.jsxs(Ur,{sensors:b,collisionDetection:Lo,onDragEnd:m,onDragStart:_,children:[s.jsx(ms,{}),s.jsx(ga,{}),s.jsx(aa,{sidebarContent:s.jsx(yo,{}),title:N,children:s.jsx(I.Suspense,{fallback:s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-500"})}),children:a==="wizard"?s.jsx(So,{}):a==="target-dashboard"?s.jsx(To,{}):a==="wiki"?s.jsx(Co,{}):a==="search"?s.jsx(Mo,{}):a==="dashboard"?s.jsx(Ao,{}):s.jsx(Io,{})})})]}):s.jsx(us,{})};class Ro extends I.Component{constructor(r){super(r);H(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){Gs(r,a.componentStack??void 0,!1)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=n=>({"error_boundary.title":"ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ / An Error Occurred","error_boundary.description":`ç”³ã—è¨³ã‚ã‚Šã¾ã›ã‚“ã€‚äºˆæœŸã›ã¬ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚
Sorry, an unexpected error has occurred.`,"error_boundary.retry":"å†è©¦è¡Œ / Retry","error_boundary.reload":"å†èª­ã¿è¾¼ã¿ / Reload","error_boundary.reset":"ç·Šæ€¥ãƒªã‚»ãƒƒãƒˆ / Hard Reset","error_boundary.details":"ã‚¨ãƒ©ãƒ¼è©³ç´° / Error Details"})[n]||n,a=()=>{window.confirm(`æœ¬å½“ã«ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ
ãƒ­ãƒ¼ã‚«ãƒ«ã®è¨­å®šã¨ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’æ¶ˆåŽ»ã—ã¾ã™ã€‚
ã‚¯ãƒ©ã‚¦ãƒ‰ä¸Šã®ãƒ‡ãƒ¼ã‚¿ã¯å®‰å…¨ã§ã™ã€‚

Are you sure?
This will clear local settings and cache.
Your cloud data is safe.`)&&(localStorage.clear(),sessionStorage.clear(),window.location.href="/")};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:s.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:r("error_boundary.title")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6 whitespace-pre-line",children:r("error_boundary.description")}),s.jsxs("div",{className:"flex flex-col gap-3 justify-center",children:[s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:r("error_boundary.retry")}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:r("error_boundary.reload")})]}),s.jsx("button",{onClick:a,className:"text-xs text-gray-400 hover:text-red-500 underline mt-2",children:r("error_boundary.reset")})]}),!1]})})}return this.props.children}}const Po=new Kr({defaultOptions:{queries:{staleTime:1/0,refetchOnWindowFocus:!1,retry:!1}}});z(()=>Promise.resolve().then(()=>Oo),void 0);Ys();os();const jr=document.getElementById("app");if(!jr)throw new Error("Failed to find the root element");const Bo=s.jsx(Ro,{children:s.jsx(Yr,{client:Po,children:s.jsx(Fo,{})})});Xr.createRoot(jr).render(Bo);const Oo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Qo as $,ii as A,gt as B,fs as C,Hs as D,zt as E,ws as F,vs as G,tr as H,Xo as I,Is as J,B as K,Je as L,At as M,Ct as N,Es as O,it as P,Ds as Q,wo as R,kr as S,Io as T,j as U,St as V,di as W,mi as X,gi as Y,_t as Z,Zo as _,C as a,ai as a0,ei as a1,ti as a2,ri as a3,ni as a4,si as a5,oi as a6,pi as a7,Ya as a8,jt as a9,Ni as aa,mr as ab,Pn as ac,Ho as ad,ui as ae,hi as af,lo as ag,er as ah,qo as ai,Qn as aj,Ei as ak,We as al,Yo as am,kt as an,M as ao,v as ap,w as aq,Wa as ar,De as as,It as at,Jo as au,Go as av,Se as aw,fi as ax,xi as ay,Ii as b,Di as c,re as d,ae as e,Vo as f,he as g,wt as h,vi as i,ne as j,Be as k,yi as l,bi as m,ki as n,E as o,_e as p,Ke as q,ji as r,_i as s,wi as t,P as u,In as v,Ko as w,qs as x,ci as y,li as z};
