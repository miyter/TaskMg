var ec=Object.defineProperty;var nc=(n,t,e)=>t in n?ec(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var w=(n,t,e)=>nc(n,typeof t!="symbol"?t+"":t,e);import{getAuth as ic,signInWithEmailAndPassword as sc,updatePassword as rc,onAuthStateChanged as oc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as ac,updateDoc as Me,doc as lt,serverTimestamp as ce,addDoc as pn,collection as rt,deleteDoc as Ee,query as de,orderBy as Ts,onSnapshot as Ie,getDocs as Wn,limit as lc,Timestamp as ra,getDoc as cc,setDoc as dc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as uc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();let Un,O,q,ai=!1;function hc(){if(ai)return;const n=fc();if(n!=null&&n.apiKey)try{Un=uc(n),O=ic(Un),q=ac(Un),ai=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function fc(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG)return window.GLOBAL_FIREBASE_CONFIG;if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(n){return console.error("[Firebase] Config parse failed. Check raw config:",__firebase_config),console.error("Parse error details:",n),null}return null}function mn(){if(!ai)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:Un,auth:O,db:q}}function gc(n,t,e){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2">
                        ${n.title}
                    </h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed">${n.message}</p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${e?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${n.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${n.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function C(n,t=null){var d;(d=document.getElementById("message-modal"))==null||d.remove();let e={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};typeof n=="object"&&n!==null?e={...e,...n}:(e.message=String(n),typeof t=="function"?(e.type="confirm",e.onConfirm=t):typeof t=="string"&&(e.type=t));let i="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",i="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",i="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",i="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const s=e.type==="confirm";s||(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",gc(e,i,s));const r=document.getElementById("message-modal"),o=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel"),l=()=>{document.removeEventListener("keydown",c),r.classList.add("opacity-0"),setTimeout(()=>r.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!s&&l()};document.addEventListener("keydown",c),o.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),r.onclick=u=>{u.target===r&&(s||l())},o.focus()}async function pc(n,t){if(!ai)throw new Error("Firebase not initialized");try{return await sc(O,n,t)}catch(e){let i="ログインに失敗しました。";switch(e.code){case"auth/invalid-email":i="メールアドレスの形式が正しくありません。";break;case"auth/user-disabled":i="このアカウントは無効化されています。";break;case"auth/user-not-found":i="アカウントが見つかりません。";break;case"auth/wrong-password":i="パスワードが間違っています。";break;case"auth/too-many-requests":i="試行回数が多すぎます。しばらく待ってからお試しください。";break;case"auth/network-request-failed":i="ネットワークエラーが発生しました。通信環境を確認してください。";break}throw new Error(i)}}async function mc(n){const t=O.currentUser;if(!t)throw new Error("認証されていません。");try{await rc(t,n),C("パスワードを変更しました")}catch(e){let i="変更に失敗しました: "+e.message;throw e.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要です。一度ログアウトしてから再度お試しください。"),C(i,"error"),e}}function bc(){const n=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),e=document.getElementById("password-input");if(n&&t&&e){const i=async()=>{const s=t.value.trim(),r=e.value.trim();if(!s||!r)return C("メールアドレスとパスワードを入力してください。","error");try{await pc(s,r)}catch(o){C(o.message,"error")}};n.onclick=i,e.addEventListener("keydown",s=>{s.key==="Enter"&&i()})}}function yc(n){const t={loginForm:document.getElementById("login-form-container"),userInfo:document.getElementById("user-info"),userEmailDisplay:document.getElementById("user-email-display"),emailInput:document.getElementById("email-input"),passInput:document.getElementById("password-input")};!t.loginForm||!t.userInfo||(n?(n.uid,t.loginForm.classList.add("hidden"),t.userInfo.classList.remove("hidden"),t.userInfo.classList.add("flex"),t.userEmailDisplay&&(t.userEmailDisplay.textContent=n.email||"ユーザー")):(t.loginForm.classList.remove("hidden"),t.userInfo.classList.add("hidden"),t.userInfo.classList.remove("flex"),t.emailInput&&(t.emailInput.value=""),t.passInput&&(t.passInput.value=""),t.userEmailDisplay&&(t.userEmailDisplay.textContent="")))}function xc(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function ye(n){return`artifacts/${xc()}/users/${n}`}function ar(n,t){return`${ye(n)}/workspaces/${t}`}const F={users:n=>ye(n),filters:n=>`${ye(n)}/filters`,labels:n=>`${ye(n)}/labels`,workspaces:n=>`${ye(n)}/workspaces`,timeblocks:n=>`${ye(n)}/timeblocks`,tasks:(n,t)=>`${ar(n,t)}/tasks`,projects:(n,t)=>`${ar(n,t)}/projects`},os="currentWorkspaceId",vc="workspace-changed";let Mn=null,oa=[];function li(){return oa}function _c(n){const t=O.currentUser;if(!t)return n([]),()=>{};Mn&&Mn();const e=F.workspaces(t.uid),i=de(rt(q,e),Ts("createdAt","asc"));return Mn=Ie(i,async s=>{const r=s.docs.map(o=>({id:o.id,...o.data()}));oa=r,r.length===0&&!s.metadata.hasPendingWrites?await kc():(wc(r),n(r))},s=>{console.error("Error subscribing to workspaces:",s),n([])}),Mn}async function kc(n){try{const t=O.currentUser;if(!t)return;const e=F.workspaces(t.uid);(await Wn(de(rt(q,e),lc(1)))).empty&&await aa("メイン")}catch(t){console.error("Failed to ensure default workspace:",t)}}function wc(n){if(n.length===0)return;const t=Pt(),e=n.some(i=>i.id===t);(!t||!e)&&_i(n[0].id)}function Pt(){return localStorage.getItem(os)}function _i(n){if(!n||localStorage.getItem(os)===n)return;localStorage.setItem(os,n);const e=new CustomEvent(vc,{detail:{workspaceId:n}});document.dispatchEvent(e)}async function aa(n){const t=O.currentUser;if(!t)throw new Error("User not authenticated");const e=F.workspaces(t.uid),i={name:n,createdAt:ce()};return{id:(await pn(rt(q,e),i)).id,name:n}}async function Sc(n,t){const e=O.currentUser;if(!e)throw new Error("User not authenticated");const i=F.workspaces(e.uid);await Me(lt(q,i,n),{name:t})}async function Mc(n){const t=O.currentUser;if(!t)throw new Error("User not authenticated");const e=F.workspaces(t.uid);await Ee(lt(q,e,n))}let Pi=null;function ki(){return Pi||(Pi=mn().db),Pi}let qn=[];function Ec(n,t,e){qn=[];const i=F.projects(n,t),s=ki(),r=de(rt(s,i),Ts("createdAt","asc"));return Ie(r,o=>{const a=o.docs.map(l=>({id:l.id,...l.data()}));qn=a,e(a)},o=>{console.error("Error subscribing to projects:",o),qn=[],e([])})}function Ic(){return qn}async function Cc(n,t,e){const i=F.projects(n,t),s=ki();await pn(rt(s,i),{name:e,ownerId:n,createdAt:ce()})}async function Lc(n,t,e,i){const s=F.projects(n,t),r=ki(),o=lt(r,s,e);return Me(o,i)}async function Ac(n,t,e){const i=F.projects(n,t),s=ki();await Ee(lt(s,i,e))}function Ps(){var e;const n=(e=O.currentUser)==null?void 0:e.uid;if(!n)throw new Error("Authentication required.");const t=Pt();if(!t)throw new Error("Workspace selection required.");return{userId:n,workspaceId:t}}const Dc=Ic,Tc=(n,t=null)=>{const e=O.currentUser,i=t||Pt();return!e||!i?(n&&n([]),()=>{}):Ec(e.uid,i,n)},Pc=async(n,t=null)=>{let e,i;if(t){const s=O.currentUser;if(!s)throw new Error("Authentication required.");e=s.uid,i=t}else{const s=Ps();e=s.userId,i=s.workspaceId}return Cc(e,i,n)},Oc=async(n,t)=>{const{userId:e,workspaceId:i}=Ps();return Lc(e,i,n,t)},la=async n=>{const{userId:t,workspaceId:e}=Ps();return Ac(t,e,n)},Oi=(()=>{let n=280;return{getWidth:()=>n,setWidth:t=>{n=t}}})();function ca(n,t,e){if(!e||!n)return;const i=localStorage.getItem("sidebarWidth"),s=i?parseInt(i,10):280;Oi.setWidth(s),n.classList.contains("sidebar-closed")||(n.style.width=`${s}px`);let r=!1;const o=c=>{n.classList.contains("sidebar-closed")||(r=!0,document.body.style.cursor="col-resize",document.body.classList.add("select-none"),document.addEventListener("mousemove",a),document.addEventListener("mouseup",l),c.preventDefault())},a=c=>{if(!r)return;let d=c.clientX;const u=150,h=500;d<u&&(d=u),d>h&&(d=h),Oi.setWidth(d),n.style.width=`${d}px`},l=()=>{r&&(r=!1,document.body.style.cursor="",document.body.classList.remove("select-none"),document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",l),localStorage.setItem("sidebarWidth",Oi.getWidth()))};e.addEventListener("mousedown",o)}function wt(n,t,e,i,s=""){return`
        <label class="flex items-center cursor-pointer p-2 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <input type="radio" name="${n}" value="${t}" class="form-radio text-blue-600 w-4 h-4 focus:ring-blue-500" ${i?"checked":""}>
            <div class="ml-2 flex items-center gap-1.5">
                ${s}
                <span class="text-sm text-gray-900 dark:text-white">${e}</span>
            </div>
        </label>
    `}function Ri(n,t,e=!1){return`
        <details class="group border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 overflow-hidden transition-all" ${e?"open":""}>
            <summary class="flex justify-between items-center px-3 py-2.5 cursor-pointer bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors select-none">
                <h4 class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">${n}</h4>
                <span class="transform group-open:rotate-180 transition-transform duration-200 text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </span>
            </summary>
            <div class="p-3 border-t border-gray-100 dark:border-gray-700 space-y-4">
                ${t}
            </div>
        </details>
    `}function Rc(n,t,e){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||"medium",r=localStorage.getItem("background")||"none",o=n||"?",a=`
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">テーマ</label>
            <div class="grid grid-cols-2 gap-3">
                ${wt("app-theme","light","ライト",i==="light",'<svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                ${wt("app-theme","dark","ダーク",i==="dark",'<svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">文字サイズ</label>
            <div class="grid grid-cols-3 gap-3">
                ${wt("font-size","large","大",s==="large")}
                ${wt("font-size","medium","中",s==="medium")}
                ${wt("font-size","small","小",s==="small")}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークのみ)</label>
            <div class="grid grid-cols-2 gap-3">
                ${wt("bg-pattern","none","無地",r==="none")}
                ${wt("bg-pattern","haikei","テクスチャ",r==="haikei")}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">サイドバーの密度</label>
            <div class="grid grid-cols-2 gap-3">
                ${wt("sidebar-density","normal","通常",!e)}
                ${wt("sidebar-density","compact","コンパクト",e)}
            </div>
        </div>
    `,l=`
        <button id="export-data-btn-new" class="w-full text-left px-3 py-2.5 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors flex justify-between items-center group border border-gray-100 dark:border-gray-700">
            <div>
                <div class="text-sm font-medium text-gray-800 dark:text-gray-200">バックアップを作成 (JSON)</div>
                <div class="text-xs text-gray-500 mt-0.5">タスク・プロジェクト等の全データをDL</div>
            </div>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
        </button>
    `,c=`
        <div class="flex items-center gap-3 mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md">
            <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center text-blue-600 dark:text-blue-200 font-bold text-lg shadow-sm">
                ${o}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-600 dark:text-gray-300 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300">パスワードの変更</label>
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新パスワード (6文字以上)" class="flex-1 px-3 py-1.5 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm outline-none">
                <button id="update-password-btn-new" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 text-white text-sm font-medium rounded-md transition-colors whitespace-nowrap">変更</button>
            </div>
        </div>
        <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-700">
            <button id="logout-btn-settings" class="w-full py-2 bg-red-50 hover:bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400 font-bold rounded-md border border-red-200 dark:border-red-800 flex items-center justify-center gap-2 group text-sm">
                <svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `;return`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg overflow-hidden flex flex-col max-h-[85vh]">
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50">
                <h3 class="text-base font-bold text-gray-800 dark:text-white flex items-center gap-2">設定</h3>
                <button id="close-settings-modal" class="text-gray-500 hover:text-gray-700"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="p-4 overflow-y-auto custom-scrollbar flex-1 space-y-3">
                ${Ri("表示設定",a,!0)}
                ${Ri("データ管理",l)}
                ${Ri("アカウント",c)}
            </div>

            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/50 flex justify-end">
                <button id="close-settings-footer" class="px-4 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-md font-bold text-xs">閉じる</button>
            </div>
        </div>
    `}var lr={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const da=function(n){const t=[];let e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Bc=function(n){const t=[];let e=0,i=0;for(;e<n.length;){const s=n[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[e++];t[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[e++],o=n[e++],a=n[e++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const r=n[e++],o=n[e++];t[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return t.join("")},ua={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=r>>2,u=(r&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(h=64)),i.push(e[d],e[u],e[h],e[f])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(da(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Bc(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=e[n.charAt(s++)],a=s<n.length?e[n.charAt(s)]:0;++s;const c=s<n.length?e[n.charAt(s)]:64;++s;const u=s<n.length?e[n.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw new Nc;const h=r<<2|a>>4;if(i.push(h),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const g=c<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Nc extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Fc=function(n){const t=da(n);return ua.encodeByteArray(t,!0)},ha=function(n){return Fc(n).replace(/\./g,"")},fa=function(n){try{return ua.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $c(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zc=()=>$c().__FIREBASE_DEFAULTS__,jc=()=>{if(typeof process>"u"||typeof lr>"u")return;const n=lr.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Hc=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&fa(n[1]);return t&&JSON.parse(t)},Vc=()=>{try{return zc()||jc()||Hc()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Wc=n=>{var t;return(t=Vc())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function kt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Uc(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(kt())}function qc(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Yc(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Xc(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Kc(){try{return typeof indexedDB=="object"}catch{return!1}}function Gc(){return new Promise((n,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var r;t(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jc="FirebaseError";class ue extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Jc,Object.setPrototypeOf(this,ue.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,bn.prototype.create)}}class bn{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],o=r?Zc(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new ue(s,a,i)}}function Zc(n,t){return n.replace(Qc,(e,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const Qc=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ga(n){const t=[];for(const[e,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function td(n,t){const e=new ed(n,t);return e.subscribe.bind(e)}class ed{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,i){let s;if(t===void 0&&e===void 0&&i===void 0)throw new Error("Missing Observer.");nd(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:i},s.next===void 0&&(s.next=Bi),s.error===void 0&&(s.error=Bi),s.complete===void 0&&(s.complete=Bi);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function nd(n,t){if(typeof n!="object"||n===null)return!1;for(const e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function Bi(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yn(n){return n&&n._delegate?n._delegate:n}class tn{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var z;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(z||(z={}));const id={debug:z.DEBUG,verbose:z.VERBOSE,info:z.INFO,warn:z.WARN,error:z.ERROR,silent:z.SILENT},sd=z.INFO,rd={[z.DEBUG]:"log",[z.VERBOSE]:"log",[z.INFO]:"info",[z.WARN]:"warn",[z.ERROR]:"error"},od=(n,t,...e)=>{if(t<n.logLevel)return;const i=new Date().toISOString(),s=rd[t];if(s)console[s](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class pa{constructor(t){this.name=t,this._logLevel=sd,this._logHandler=od,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in z))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?id[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,z.DEBUG,...t),this._logHandler(this,z.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,z.VERBOSE,...t),this._logHandler(this,z.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,z.INFO,...t),this._logHandler(this,z.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,z.WARN,...t),this._logHandler(this,z.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,z.ERROR,...t),this._logHandler(this,z.ERROR,...t)}}const ad=(n,t)=>t.some(e=>n instanceof e);let cr,dr;function ld(){return cr||(cr=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function cd(){return dr||(dr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const ma=new WeakMap,as=new WeakMap,ba=new WeakMap,Ni=new WeakMap,Os=new WeakMap;function dd(n){const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(Ht(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&ma.set(e,n)}).catch(()=>{}),Os.set(t,n),t}function ud(n){if(as.has(n))return;const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});as.set(n,t)}let ls={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return as.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ba.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Ht(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function hd(n){ls=n(ls)}function fd(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=n.call(Fi(this),t,...e);return ba.set(i,t.sort?t.sort():[t]),Ht(i)}:cd().includes(n)?function(...t){return n.apply(Fi(this),t),Ht(ma.get(this))}:function(...t){return Ht(n.apply(Fi(this),t))}}function gd(n){return typeof n=="function"?fd(n):(n instanceof IDBTransaction&&ud(n),ad(n,ld())?new Proxy(n,ls):n)}function Ht(n){if(n instanceof IDBRequest)return dd(n);if(Ni.has(n))return Ni.get(n);const t=gd(n);return t!==n&&(Ni.set(n,t),Os.set(t,n)),t}const Fi=n=>Os.get(n);function pd(n,t,{blocked:e,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,t),a=Ht(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Ht(o.result),l.oldVersion,l.newVersion,Ht(o.transaction),l)}),e&&o.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const md=["get","getKey","getAll","getAllKeys","count"],bd=["put","add","delete","clear"],$i=new Map;function ur(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if($i.get(t))return $i.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,s=bd.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||md.includes(e)))return;const r=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[e](...a),s&&l.done]))[0]};return $i.set(t,r),r}hd(n=>({...n,get:(t,e,i)=>ur(t,e)||n.get(t,e,i),has:(t,e)=>!!ur(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(xd(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function xd(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const cs="@firebase/app",hr="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tt=new pa("@firebase/app"),vd="@firebase/app-compat",_d="@firebase/analytics-compat",kd="@firebase/analytics",wd="@firebase/app-check-compat",Sd="@firebase/app-check",Md="@firebase/auth",Ed="@firebase/auth-compat",Id="@firebase/database",Cd="@firebase/data-connect",Ld="@firebase/database-compat",Ad="@firebase/functions",Dd="@firebase/functions-compat",Td="@firebase/installations",Pd="@firebase/installations-compat",Od="@firebase/messaging",Rd="@firebase/messaging-compat",Bd="@firebase/performance",Nd="@firebase/performance-compat",Fd="@firebase/remote-config",$d="@firebase/remote-config-compat",zd="@firebase/storage",jd="@firebase/storage-compat",Hd="@firebase/firestore",Vd="@firebase/vertexai-preview",Wd="@firebase/firestore-compat",Ud="firebase",qd="10.14.1",Yd={[cs]:"fire-core",[vd]:"fire-core-compat",[kd]:"fire-analytics",[_d]:"fire-analytics-compat",[Sd]:"fire-app-check",[wd]:"fire-app-check-compat",[Md]:"fire-auth",[Ed]:"fire-auth-compat",[Id]:"fire-rtdb",[Cd]:"fire-data-connect",[Ld]:"fire-rtdb-compat",[Ad]:"fire-fn",[Dd]:"fire-fn-compat",[Td]:"fire-iid",[Pd]:"fire-iid-compat",[Od]:"fire-fcm",[Rd]:"fire-fcm-compat",[Bd]:"fire-perf",[Nd]:"fire-perf-compat",[Fd]:"fire-rc",[$d]:"fire-rc-compat",[zd]:"fire-gcs",[jd]:"fire-gcs-compat",[Hd]:"fire-fst",[Wd]:"fire-fst-compat",[Vd]:"fire-vertex","fire-js":"fire-js",[Ud]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Xd=new Map,Kd=new Map,fr=new Map;function gr(n,t){try{n.container.addComponent(t)}catch(e){Tt.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function en(n){const t=n.name;if(fr.has(t))return Tt.debug(`There were multiple attempts to register component ${t}.`),!1;fr.set(t,n);for(const e of Xd.values())gr(e,n);for(const e of Kd.values())gr(e,n);return!0}function Ne(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gd={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rs=new bn("app","Firebase",Gd);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bs=qd;function We(n,t,e){var i;let s=(i=Yd[n])!==null&&i!==void 0?i:n;e&&(s+=`-${e}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${t}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Tt.warn(a.join(" "));return}en(new tn(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jd="firebase-heartbeat-database",Zd=1,nn="firebase-heartbeat-store";let zi=null;function ya(){return zi||(zi=pd(Jd,Zd,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(nn)}catch(e){console.warn(e)}}}}).catch(n=>{throw Rs.create("idb-open",{originalErrorMessage:n.message})})),zi}async function Qd(n){try{const e=(await ya()).transaction(nn),i=await e.objectStore(nn).get(xa(n));return await e.done,i}catch(t){if(t instanceof ue)Tt.warn(t.message);else{const e=Rs.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Tt.warn(e.message)}}}async function pr(n,t){try{const i=(await ya()).transaction(nn,"readwrite");await i.objectStore(nn).put(t,xa(n)),await i.done}catch(e){if(e instanceof ue)Tt.warn(e.message);else{const i=Rs.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});Tt.warn(i.message)}}}function xa(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const tu=1024,eu=30*24*60*60*1e3;class nu{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new su(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=mr();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=eu}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Tt.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=mr(),{heartbeatsToSend:i,unsentEntries:s}=iu(this._heartbeatsCache.heartbeats),r=ha(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Tt.warn(e),""}}}function mr(){return new Date().toISOString().substring(0,10)}function iu(n,t=tu){const e=[];let i=n.slice();for(const s of n){const r=e.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),br(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),br(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class su{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Kc()?Gc().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Qd(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return pr(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return pr(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function br(n){return ha(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ru(n){en(new tn("platform-logger",t=>new yd(t),"PRIVATE")),en(new tn("heartbeat",t=>new nu(t),"PRIVATE")),We(cs,hr,n),We(cs,hr,"esm2017"),We("fire-js","")}ru("");function va(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(e[i[s]]=n[i[s]]);return e}function _a(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ou=_a,ka=new bn("auth","Firebase",_a());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ci=new pa("@firebase/auth");function au(n,...t){ci.logLevel<=z.WARN&&ci.warn(`Auth (${Bs}): ${n}`,...t)}function Yn(n,...t){ci.logLevel<=z.ERROR&&ci.error(`Auth (${Bs}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yr(n,...t){throw Ns(n,...t)}function wa(n,...t){return Ns(n,...t)}function Sa(n,t,e){const i=Object.assign(Object.assign({},ou()),{[t]:e});return new bn("auth","Firebase",i).create(t,{appName:n.name})}function Xn(n){return Sa(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ns(n,...t){if(typeof n!="string"){const e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return ka.create(n,...t)}function B(n,t,...e){if(!n)throw Ns(t,...e)}function Ue(n){const t="INTERNAL ASSERTION FAILED: "+n;throw Yn(t),new Error(t)}function di(n,t){n||Ue(t)}function lu(){return xr()==="http:"||xr()==="https:"}function xr(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cu(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(lu()||Yc()||"connection"in navigator)?navigator.onLine:!0}function du(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xn{constructor(t,e){this.shortDelay=t,this.longDelay=e,di(e>t,"Short delay should be less than long delay!"),this.isMobile=Uc()||Xc()}get(){return cu()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function uu(n,t){di(n.emulator,"Emulator should always be set here");const{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ma{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Ue("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Ue("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Ue("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const hu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fu=new xn(3e4,6e4);function Ea(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function wi(n,t,e,i,s={}){return Ia(n,s,async()=>{let r={},o={};i&&(t==="GET"?o=i:r={body:JSON.stringify(i)});const a=ga(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:t,headers:l},r);return qc()||(c.referrerPolicy="no-referrer"),Ma.fetch()(Ca(n,n.config.apiHost,e,a),c)})}async function Ia(n,t,e){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},hu),t);try{const s=new gu(n),r=await Promise.race([e(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw En(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw En(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw En(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw En(n,"user-disabled",o);const d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw Sa(n,d,c);yr(n,d)}}catch(s){if(s instanceof ue)throw s;yr(n,"network-request-failed",{message:String(s)})}}function Ca(n,t,e,i){const s=`${t}${e}?${i}`;return n.config.emulator?uu(n.config,s):`${n.config.apiScheme}://${s}`}class gu{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(wa(this.auth,"network-request-failed")),fu.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function En(n,t,e){const i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);const s=wa(n,t,i);return s.customData._tokenResponse=e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function pu(n,t){return wi(n,"POST","/v1/accounts:delete",t)}async function La(n,t){return wi(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qe(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function mu(n,t=!1){const e=yn(n),i=await e.getIdToken(t),s=Aa(i);B(s&&s.exp&&s.auth_time&&s.iat,e.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:qe(ji(s.auth_time)),issuedAtTime:qe(ji(s.iat)),expirationTime:qe(ji(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function ji(n){return Number(n)*1e3}function Aa(n){const[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return Yn("JWT malformed, contained fewer than 3 sections"),null;try{const s=fa(e);return s?JSON.parse(s):(Yn("Failed to decode base64 JWT payload"),null)}catch(s){return Yn("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function vr(n){const t=Aa(n);return B(t,"internal-error"),B(typeof t.exp<"u","internal-error"),B(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ds(n,t,e=!1){if(e)return t;try{return await t}catch(i){throw i instanceof ue&&bu(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function bu({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yu{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class us{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=qe(this.lastLoginAt),this.creationTime=qe(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function ui(n){var t;const e=n.auth,i=await n.getIdToken(),s=await ds(n,La(e,{idToken:i}));B(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=!((t=r.providerUserInfo)===null||t===void 0)&&t.length?Da(r.providerUserInfo):[],a=vu(n.providerData,o),l=n.isAnonymous,c=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new us(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(n,u)}async function xu(n){const t=yn(n);await ui(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function vu(n,t){return[...n.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function Da(n){return n.map(t=>{var{providerId:e}=t,i=va(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function _u(n,t){const e=await Ia(n,{},async()=>{const i=ga({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=Ca(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",Ma.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function ku(n,t){return wi(n,"POST","/v2/accounts:revokeToken",Ea(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class xe{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){B(t.idToken,"internal-error"),B(typeof t.idToken<"u","internal-error"),B(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):vr(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){B(t.length!==0,"internal-error");const e=vr(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(B(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:s,expiresIn:r}=await _u(t,e);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){const{refreshToken:i,accessToken:s,expirationTime:r}=e,o=new xe;return i&&(B(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),s&&(B(typeof s=="string","internal-error",{appName:t}),o.accessToken=s),r&&(B(typeof r=="number","internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new xe,this.toJSON())}_performRefresh(){return Ue("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ot(n,t){B(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Rt{constructor(t){var{uid:e,auth:i,stsTokenManager:s}=t,r=va(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new yu(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new us(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(t){const e=await ds(this,this.stsTokenManager.getToken(this.auth,t));return B(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return mu(this,t)}reload(){return xu(this)}_assign(t){this!==t&&(B(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Rt(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await ui(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Ne(this.auth.app))return Promise.reject(Xn(this.auth));const t=await this.getIdToken();return await ds(this,pu(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,s,r,o,a,l,c,d;const u=(i=e.displayName)!==null&&i!==void 0?i:void 0,h=(s=e.email)!==null&&s!==void 0?s:void 0,f=(r=e.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=e.photoURL)!==null&&o!==void 0?o:void 0,p=(a=e.tenantId)!==null&&a!==void 0?a:void 0,m=(l=e._redirectEventId)!==null&&l!==void 0?l:void 0,b=(c=e.createdAt)!==null&&c!==void 0?c:void 0,y=(d=e.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:v,emailVerified:_,isAnonymous:x,providerData:k,stsTokenManager:S}=e;B(v&&S,t,"internal-error");const M=xe.fromJSON(this.name,S);B(typeof v=="string",t,"internal-error"),Ot(u,t.name),Ot(h,t.name),B(typeof _=="boolean",t,"internal-error"),B(typeof x=="boolean",t,"internal-error"),Ot(f,t.name),Ot(g,t.name),Ot(p,t.name),Ot(m,t.name),Ot(b,t.name),Ot(y,t.name);const E=new Rt({uid:v,auth:t,email:h,emailVerified:_,displayName:u,isAnonymous:x,photoURL:g,phoneNumber:f,tenantId:p,stsTokenManager:M,createdAt:b,lastLoginAt:y});return k&&Array.isArray(k)&&(E.providerData=k.map(L=>Object.assign({},L))),m&&(E._redirectEventId=m),E}static async _fromIdTokenResponse(t,e,i=!1){const s=new xe;s.updateFromServerResponse(e);const r=new Rt({uid:e.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await ui(r),r}static async _fromGetAccountInfoResponse(t,e,i){const s=e.users[0];B(s.localId!==void 0,"internal-error");const r=s.providerUserInfo!==void 0?Da(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(r!=null&&r.length),a=new xe;a.updateFromIdToken(i);const l=new Rt({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new us(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(r!=null&&r.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _r=new Map;function ne(n){di(n instanceof Function,"Expected a class definition");let t=_r.get(n);return t?(di(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,_r.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ta{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}Ta.type="NONE";const kr=Ta;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Hi(n,t,e){return`firebase:${n}:${t}:${e}`}class ve{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=Hi(this.userKey,s.apiKey,r),this.fullPersistenceKey=Hi("persistence",s.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Rt._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new ve(ne(kr),t,i);const s=(await Promise.all(e.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=s[0]||ne(kr);const o=Hi(i,t.config.apiKey,t.name);let a=null;for(const c of e)try{const d=await c._get(o);if(d){const u=Rt._fromJSON(t,d);c!==r&&(a=u),r=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new ve(r,t,i):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(e.map(async c=>{if(c!==r)try{await c._remove(o)}catch{}})),new ve(r,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function wr(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Eu(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(wu(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Cu(t))return"Blackberry";if(Lu(t))return"Webos";if(Su(t))return"Safari";if((t.includes("chrome/")||Mu(t))&&!t.includes("edge/"))return"Chrome";if(Iu(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function wu(n=kt()){return/firefox\//i.test(n)}function Su(n=kt()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Mu(n=kt()){return/crios\//i.test(n)}function Eu(n=kt()){return/iemobile/i.test(n)}function Iu(n=kt()){return/android/i.test(n)}function Cu(n=kt()){return/blackberry/i.test(n)}function Lu(n=kt()){return/webos/i.test(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Pa(n,t=[]){let e;switch(n){case"Browser":e=wr(kt());break;case"Worker":e=`${wr(kt())}-${n}`;break;default:e=n}const i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${Bs}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Au{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=r=>new Promise((o,a)=>{try{const l=t(r);o(l)}catch(l){a(l)}});i.onAbort=e,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const i of this.queue)await i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(const s of e)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Du(n,t={}){return wi(n,"GET","/v2/passwordPolicy",Ea(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Tu=6;class Pu{constructor(t){var e,i,s,r;const o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=o.minPasswordLength)!==null&&e!==void 0?e:Tu,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(r=t.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,s,r,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(e=l.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.containsUppercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),s&&(e.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ou{constructor(t,e,i,s){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Sr(this),this.idTokenSubscription=new Sr(this),this.beforeStateQueue=new Au(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ka,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=ne(e)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await ve.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await La(this,{idToken:t}),i=await Rt._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(Ne(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(t);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await ui(t)}catch(e){if((e==null?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=du()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Ne(this.app))return Promise.reject(Xn(this));const e=t?yn(t):null;return e&&B(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&B(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Ne(this.app)?Promise.reject(Xn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Ne(this.app)?Promise.reject(Xn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ne(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Du(this),e=new Pu(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new bn("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),await ku(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&ne(t)||this._popupRedirectResolver;B(e,this,"argument-error"),this.redirectPersistenceManager=await ve.create(this,[ne(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;return this._isInitialized&&await this.queue(async()=>{}),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,s){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(B(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof e=="function"){const l=t.addObserver(e,i,s);return()=>{o=!0,l()}}else{const l=t.addObserver(e);return()=>{o=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=Pa(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(e["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return e!=null&&e.error&&au(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function Ru(n){return yn(n)}class Sr{constructor(t){this.auth=t,this.observer=null,this.addObserver=td(e=>this.observer=e)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Bu(n,t){const e=(t==null?void 0:t.persistence)||[],i=(Array.isArray(e)?e:[e]).map(ne);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t==null?void 0:t.popupRedirectResolver)}function Nu(n){return yn(n).signOut()}new xn(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new xn(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new xn(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new xn(5e3,15e3);var Mr="@firebase/auth",Er="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Fu{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(i=>{t((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function $u(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function zu(n){en(new tn("auth",(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;B(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:Pa(n)},c=new Ou(i,s,r,l);return Bu(c,e),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),en(new tn("auth-internal",t=>{const e=Ru(t.getProvider("auth").getImmediate());return(i=>new Fu(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),We(Mr,Er,$u(n)),We(Mr,Er,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ju=5*60;Wc("authIdTokenMaxAge");zu("Browser");const Fs=n=>n?n.toDate?n.toDate():new Date(n):null;function Hu(n){const t=Fs(n);if(!t||isNaN(t.getTime()))return"";const e=new Date,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return r!==e.getFullYear()?`${r}/${o}/${a}`:`${o}/${a}`}function Vu(n){const t=Fs(n);if(!t)return"text-gray-500";const e=new Date,i=new Date(e.getFullYear(),e.getMonth(),e.getDate()),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));return s<0?"text-red-500 font-bold":s===0?"text-green-600 dark:text-green-400 font-medium":s===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function Wu(n,t){var i;if(!n||!(t!=null&&t.type))return null;const e=new Date(Fs(n));switch(t.type){case"daily":return e.setDate(e.getDate()+1),e;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=e.getDay();for(let r=1;r<=7;r++)if(t.days.includes((s+r)%7))return e.setDate(e.getDate()+r),e;return null;case"monthly":return e.setMonth(e.getMonth()+1),e;default:return null}}function Oa(n){var e;const t=new Date;if(t.setHours(0,0,0,0),!(n!=null&&n.type)||n.type==="daily"||n.type==="monthly")return t;if(n.type==="weekly"&&((e=n.days)==null?void 0:e.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(n.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}return t}function Ra(n,t){var e,i;return{id:n,...t,createdAt:(e=t.createdAt)!=null&&e.toDate?t.createdAt.toDate():t.createdAt||null,dueDate:(i=t.dueDate)!=null&&i.toDate?t.dueDate.toDate():t.dueDate||null,recurrence:t.recurrence||null}}function Uu(n,t,e){if(!n||!t)return e([]),()=>{};const i=F.tasks(n,t),s=de(rt(q,i));return Ie(s,r=>{const o=r.docs.map(a=>Ra(a.id,a.data()));e(o)},r=>{console.error("[Tasks] Subscription error:",r),e([])})}async function qu(n,t,e){const i=F.tasks(n,t),s=lt(q,i,e),r=await cc(s);return r.exists()?Ra(r.id,r.data()):null}async function Ba(n,t,e){const i=F.tasks(n,t),s={...e};return s.dueDate instanceof Date&&(s.dueDate=ra.fromDate(s.dueDate)),await pn(rt(q,i),{...s,ownerId:n,status:"todo",createdAt:ce()})}async function Yu(n,t,e,i){const s=F.tasks(n,t);await Me(lt(q,s,e),{status:i})}async function Xu(n,t,e,i){const s=F.tasks(n,t),r=lt(q,s,e),o={...i};o.dueDate!==void 0&&(o.dueDate instanceof Date?o.dueDate=ra.fromDate(o.dueDate):o.dueDate===null&&(o.dueDate=null)),o.recurrence===void 0&&delete o.recurrence,await Me(r,o)}async function Ku(n,t,e){const i=F.tasks(n,t);await Ee(lt(q,i,e))}async function Gu(n,t){if(!n||!t)throw new Error("Credentials missing for backup");const e=rt(q,F.tasks(n,t)),i=rt(q,F.projects(n,t)),s=rt(q,F.labels(n)),[r,o,a]=await Promise.all([Wn(e),Wn(i),Wn(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]&&u[f].toDate?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:n,workspaceId:t,tasks:l(r),projects:l(o),labels:l(a)}}function vn(){var t;const n=(t=O.currentUser)==null?void 0:t.uid;if(!n)throw new Error("Authentication required.");return n}function _n(){const n=Pt();if(!n)throw new Error("Workspace required.");return n}async function Ju(n){var r;if(n.status!=="completed"||!n.recurrence)return;const{recurrence:t,dueDate:e}=n;if(!e||typeof t!="object"||!t.type)return;const i=Wu(e,t);if(!i)return;const s={title:n.title,description:n.description||"",status:"todo",dueDate:i,projectId:n.projectId||null,labelIds:n.labelIds||[],recurrence:n.recurrence};try{const o=(r=O.currentUser)==null?void 0:r.uid,a=Pt();o&&a&&await Ba(o,a,s)}catch(o){console.error("[Recurring] Generation failed:",o)}}function Zu(n){var i;const t=(i=O.currentUser)==null?void 0:i.uid,e=Pt();return t&&e?Uu(t,e,n):(n([]),()=>{})}async function Qu(n){const t=vn(),e=_n(),i={...n};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),Ba(t,e,i)}async function th(n,t){const e=vn(),i=_n();if(await Yu(e,i,n,t),t==="completed"){const s=await qu(e,i,n);s&&Ju(s).catch(r=>console.error(r))}}async function Na(n,t){const e=vn(),i=_n();return Xu(e,i,n,t)}async function Fa(n){const t=vn(),e=_n();return Ku(t,e,n)}async function eh(){const n=vn(),t=_n();return Gu(n,t)}function nh(n){var s;const t=(s=O.currentUser)==null?void 0:s.uid;if(!t)return n&&n([]),()=>{};const e=F.filters(t),i=de(rt(q,e));return Ie(i,r=>{const o=r.docs.map(a=>({id:a.id,...a.data()}));n&&n(o)},r=>{console.error("Error subscribing to filters:",r),n&&n([])})}async function ih(n){var r;const t=(r=O.currentUser)==null?void 0:r.uid;if(!t)throw new Error("Authentication required");const e=F.filters(t),{id:i,...s}=n;await pn(rt(q,e),{...s,ownerId:t,createdAt:ce()})}async function sh(n,t){var o;const e=(o=O.currentUser)==null?void 0:o.uid;if(!e)throw new Error("Authentication required");const i=F.filters(e),{id:s,...r}=t;await Me(lt(q,i,n),{...r,updatedAt:ce()})}async function rh(n){var i;const t=(i=O.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const e=F.filters(t);await Ee(lt(q,e,n))}function oh(n,t){if(!n)return t([]),()=>{};const e=F.labels(n),{db:i}=mn(),s=de(rt(i,e));return Ie(s,r=>{const o=r.docs.map(a=>({id:a.id,...a.data()}));t(o)},r=>{console.error("[Labels] Subscription error:",r),t([])})}async function ah(n,t,e){const i=F.labels(n),{db:s}=mn();await pn(rt(s,i),{name:t,color:e,ownerId:n,createdAt:ce()})}async function lh(n,t,e){const i=F.labels(n),{db:s}=mn(),r=lt(s,i,t);return Me(r,e)}async function ch(n,t){const e=F.labels(n),{db:i}=mn();await Ee(lt(i,e,t))}function $s(){var t;const n=(t=O.currentUser)==null?void 0:t.uid;if(!n)throw C("操作にはログインが必要です。","error"),new Error("Authentication required.");return n}function dh(n){var e;const t=(e=O.currentUser)==null?void 0:e.uid;return t?oh(t,n):(n([]),()=>{})}async function uh(n,t){const e=$s();return ah(e,n,t)}async function hh(n,t){const e=$s();return lh(e,n,t)}async function fh(n){const t=$s();return ch(t,n)}let ie=[];const gh=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function ph(n){var s;const t=(s=O.currentUser)==null?void 0:s.uid;if(!t)return ie=[...gh],n&&n(ie),()=>{};const e=F.timeblocks(t),i=de(rt(q,e),Ts("order","asc"));return Ie(i,r=>{ie=r.docs.map(a=>({id:a.id,...a.data()})),n&&n(ie)},r=>{console.error("Timeblocks subscription error:",r)})}function he(){return[...ie].sort((n,t)=>n.order-t.order)}function mh(){ie=[]}async function bh(n){var o;const t=(o=O.currentUser)==null?void 0:o.uid;if(!t)throw C("ログインが必要です"),new Error("Authentication required");const e=F.timeblocks(t),i=n.id||crypto.randomUUID();let s=n.order;s===void 0&&(s=ie.length);const r={name:n.name,start:n.start,end:n.end,color:n.color,order:s,updatedAt:ce()};return await dc(lt(q,e,i),r,{merge:!0}),!0}async function yh(n){var i;const t=(i=O.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const e=F.timeblocks(t);return await Ee(lt(q,e,n)),!0}function xh(){const n=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",n);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),hs()}function hs(){const n=document.getElementById("main-content");if(!n)return;const t=localStorage.getItem("background")||"none";n.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(n.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}function vh(n,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),n.addEventListener("click",i=>{i.target===n&&t()}),In("app-theme","theme",i=>{document.documentElement.classList.toggle("dark",i==="dark"),hs()}),In("font-size","fontSize",i=>{document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${i}`)}),In("bg-pattern","background",()=>hs()),In("sidebar-density","sidebar_compact",i=>{const s=i==="compact";window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{compact:s}}))}),_h(),kh(),wh(t)}function In(n,t,e){const i=document.querySelectorAll(`input[name="${n}"]`),s=localStorage.getItem(t);if(i.forEach(r=>{r.addEventListener("change",o=>{const a=o.target.value;localStorage.setItem(t,a),e(a)})}),s)e(s);else{const r=document.querySelector(`input[name="${n}"]:checked`);r&&e(r.value)}}function _h(){const n=document.getElementById("export-data-btn-new");n&&(n.onclick=async()=>{const t=n.querySelector("div.font-medium").textContent;n.querySelector("div.text-xs"),n.disabled=!0,n.classList.add("opacity-70","cursor-wait"),n.querySelector("div.font-medium").textContent="バックアップ作成中...";try{const e=await eh(),i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19);Sh(e,`backup_${i}.json`),C("バックアップをダウンロードしました")}catch(e){console.error(e),C("エクスポートに失敗しました","error")}finally{n.disabled=!1,n.classList.remove("opacity-70","cursor-wait"),n.querySelector("div.font-medium").textContent=t}})}function kh(){const n=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!n||!t||(n.onclick=async()=>{const e=t.value.trim();if(e.length<6)return C("6文字以上必要です","error");try{await mc(e),C("パスワードを変更しました"),t.value=""}catch(i){let s="失敗しました: "+i.message;i.code==="auth/requires-recent-login"&&(s="セキュリティのため、再ログインが必要です。ログアウトして再度お試しください。"),C(s,"error")}})}function wh(n){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Nu(O),n()}catch{C("エラーが発生しました","error")}})}function Sh(n,t){const e=new Blob([JSON.stringify(n,null,2)],{type:"application/json"}),i=URL.createObjectURL(e),s=document.createElement("a");s.href=i,s.download=t,s.click(),URL.revokeObjectURL(i)}let Ir=!1;function Mh(){Ir||(document.addEventListener("click",n=>{n.target.closest("#nav-settings")&&(n.preventDefault(),Si())}),Ir=!0)}function Si(){var o;const n="settings-modal-dynamic";(o=document.getElementById(n))==null||o.remove();const t=localStorage.getItem("sidebar_compact")==="true",e=O.currentUser,i=(e==null?void 0:e.email)||"匿名ユーザー",s=i[0].toUpperCase(),r=document.createElement("div");r.id=n,r.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",r.innerHTML=Rc(s,i,t),document.body.appendChild(r),vh(r,()=>r.remove())}function Eh(n=null){const t=!!n,e={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:t?"":"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${e.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(n==null?void 0:n.name)||""}" 
                        placeholder="${e.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${e.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${e.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function $a(n=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.innerHTML=Eh(n),document.body.appendChild(e),Ih(e,n)}function Ih(n,t){const e=n.querySelector("#save-workspace-btn"),i=n.querySelector("#modal-workspace-name"),s=n.querySelector("#cancel-modal-btn"),r=n.querySelector("#workspace-modal-overlay"),o=()=>{document.removeEventListener("keydown",a),n.remove()},a=c=>{c.key==="Escape"&&o()};document.addEventListener("keydown",a),r.onclick=c=>{c.target===r&&o()},s&&(s.onclick=o);const l=async()=>{if(e.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return C("ワークスペース名を入力してください","error");if(li().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return C("その名前のワークスペースは既に存在します","error");e.disabled=!0,e.textContent=t?"更新中...":"作成中...";try{if(t)await Sc(t.id,c);else{const u=await aa(c);_i(u.id)}o()}catch(u){e.disabled=!1,e.textContent=t?"保存":"作成",C(`失敗しました: ${u.message}`,"error")}};e==null||e.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function za(n=null){const t=!!n,e=Dc(),i=he(),s=[30,45,60,75,90],r=Ch((n==null?void 0:n.query)||""),o=document.createElement("div");o.id="filter-creation-modal",o.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-fade-in",o.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh] transform transition-all" role="dialog" aria-modal="true">
            <!-- ヘッダー -->
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50">
                <h3 class="text-base font-bold text-gray-800 dark:text-white flex items-center gap-2">
                    <svg class="w-5 h-5 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>
                    ${t?"フィルター編集":"フィルター作成"}
                </h3>
                <button id="close-filter-modal" class="p-1 rounded-full hover:bg-gray-200 dark:hover:bg-gray-700 text-gray-500 transition-colors">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>

            <!-- ボディ -->
            <div class="p-4 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div>
                    <label class="block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1.5 uppercase tracking-wider">フィルター名</label>
                    <input type="text" id="filter-name" value="${(n==null?void 0:n.name)||""}" class="w-full px-3 py-2.5 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm transition-all" placeholder="例: 午前の重要タスク">
                </div>

                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    <!-- プロジェクト -->
                    ${fs("プロジェクト",e,r.project,"filter-project-checkbox")}
                    <!-- 時間帯 -->
                    ${Lh(i,r.timeblock)}
                    <!-- 所要時間 -->
                    ${fs("所要時間",s,r.duration,"filter-duration-checkbox",a=>`⏱️ ${a} min`)}
                </div>

                <div class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg text-xs text-blue-600 dark:text-blue-300">
                    <p class="flex items-center gap-2">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                        条件設定のヒント: 各カテゴリ内は「OR（いずれか）」、カテゴリ間は「AND（かつ）」条件になります。
                    </p>
                </div>
            </div>

            <!-- フッター -->
            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/50 flex justify-end gap-3 border-t border-gray-100 dark:border-gray-700">
                <button id="cancel-filter-btn" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:text-gray-800 dark:hover:text-gray-200 transition-colors">キャンセル</button>
                <button id="save-filter-btn" class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-sm transition-all transform active:scale-95">
                    ${t?"変更を保存":"フィルターを作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(o),Ah(o,n),requestAnimationFrame(()=>{const a=o.querySelector("#filter-name");a&&a.focus()})}function Ch(n){const t={project:[],timeblock:[],duration:[]};return n&&n.split(" ").forEach(e=>{if(!e.includes(":"))return;const[i,s]=e.split(":");!t[i]||!s||(t[i]=s.split(",").map(r=>i==="timeblock"&&r==="null"?"none":r))}),t}function fs(n,t,e,i,s=r=>r.name||r){const r=Array.isArray(e)?e:[];return`
        <div class="flex flex-col h-64 bg-white dark:bg-gray-900 rounded-lg border border-gray-200 dark:border-gray-700 overflow-hidden shadow-sm">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800 border-b border-gray-200 dark:border-gray-700 flex justify-between items-center font-bold text-xs text-gray-500 dark:text-gray-400 uppercase tracking-wider">
                <span>${n}</span>
                <span class="text-[10px] bg-gray-200 dark:bg-gray-700 px-1.5 py-0.5 rounded-full">${t.length}</span>
            </div>
            <div class="p-2 overflow-y-auto custom-scrollbar flex-1 space-y-1">
                ${t.map(o=>{const a=String(o.id||o),l=r.includes(a);return`
                        <label class="flex items-center px-2 py-2 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800 cursor-pointer transition-colors group">
                            <input type="checkbox" value="${a}" ${l?"checked":""} class="${i} form-checkbox h-4 w-4 text-blue-600 rounded border-gray-300 focus:ring-blue-500 dark:bg-gray-800 dark:border-gray-600">
                            <span class="ml-2.5 text-sm text-gray-700 dark:text-gray-300 truncate group-hover:text-gray-900 dark:group-hover:text-white transition-colors">${s(o)}</span>
                        </label>
                    `}).join("")}
                ${t.length===0?'<div class="text-center text-xs text-gray-400 py-4">項目がありません</div>':""}
            </div>
        </div>
    `}function Lh(n,t){const e=[{id:"none",name:"未定",color:"#9CA3AF"},...n];return fs("時間帯",e,t,"filter-timeblock-checkbox",i=>`
        <span class="flex items-center gap-2">
            <span class="w-2.5 h-2.5 rounded-full ring-1 ring-white/10" style="background-color: ${i.color}"></span>
            ${i.id==="none"?i.name:`${i.start} - ${i.end}`}
        </span>
    `)}function Ah(n,t){const e=()=>{document.removeEventListener("keydown",i),n.classList.add("opacity-0"),setTimeout(()=>n.remove(),200)},i=s=>{s.key==="Escape"&&e()};document.addEventListener("keydown",i),n.querySelector("#close-filter-modal").onclick=e,n.querySelector("#cancel-filter-btn").onclick=e,n.onclick=s=>{s.target===n&&e()},n.querySelector("#save-filter-btn").onclick=async()=>{const s=n.querySelector("#filter-name"),r=s.value.trim();if(!r){C({message:"フィルター名を入力してください",type:"error"}),s.focus();return}const o=u=>Array.from(n.querySelectorAll(`.${u}:checked`)).map(h=>h.value),a=o("filter-timeblock-checkbox").map(u=>u==="none"?"null":u),l={project:o("filter-project-checkbox"),timeblock:a,duration:o("filter-duration-checkbox")},c=Object.entries(l).filter(([u,h])=>h.length>0).map(([u,h])=>`${u}:${h.join(",")}`).join(" ");if(!c)return C({message:"少なくとも1つの条件を選択してください",type:"error"});const d={name:r,query:c,type:"custom"};try{t?await sh(t.id,d):await ih(d),document.dispatchEvent(new CustomEvent("filters-updated")),e()}catch(u){console.error(u),C({message:"保存に失敗しました: "+u.message,type:"error"})}}}function Dh(n=null){const t=!!n,e={title:(n==null?void 0:n.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更します。":"新しいプロジェクトを作成します。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${e.title}" placeholder="${e.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${e.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${e.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function ja(n=null){var i;const t="project-modal";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.innerHTML=Dh(n),document.body.appendChild(e),Th(e,n)}function Th(n,t){const e=()=>n.remove(),i=n.querySelector("#modal-project-name"),s=n.querySelector("#save-project-btn"),r=n.querySelector("#delete-project-btn"),o=n.querySelector("#cancel-modal-btn");o&&(o.onclick=e),n.onclick=l=>{l.target===n&&e()};const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return C("プロジェクト名を入力してください","error");try{if(t)await Oc(t.id,{name:l});else{const c=Pt();if(!c)throw new Error("ワークスペースが選択されていません");await Pc(l,c)}e()}catch(c){C("保存に失敗しました: "+c.message,"error")}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&a()}),r&&t&&(r.onclick=()=>{C(`プロジェクト「${t.name}」を削除しますか？`,async()=>{try{await la(t.id),e()}catch{C("削除に失敗しました","error")}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function kn(n){return n+.5|0}const Bt=(n,t,e)=>Math.max(Math.min(n,e),t);function Fe(n){return Bt(kn(n*2.55),0,255)}function Vt(n){return Bt(kn(n*255),0,255)}function It(n){return Bt(kn(n/2.55)/100,0,1)}function Cr(n){return Bt(kn(n*100),0,100)}const ut={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},gs=[..."0123456789ABCDEF"],Ph=n=>gs[n&15],Oh=n=>gs[(n&240)>>4]+gs[n&15],Cn=n=>(n&240)>>4===(n&15),Rh=n=>Cn(n.r)&&Cn(n.g)&&Cn(n.b)&&Cn(n.a);function Bh(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ut[n[1]]*17,g:255&ut[n[2]]*17,b:255&ut[n[3]]*17,a:t===5?ut[n[4]]*17:255}:(t===7||t===9)&&(e={r:ut[n[1]]<<4|ut[n[2]],g:ut[n[3]]<<4|ut[n[4]],b:ut[n[5]]<<4|ut[n[6]],a:t===9?ut[n[7]]<<4|ut[n[8]]:255})),e}const Nh=(n,t)=>n<255?t(n):"";function Fh(n){var t=Rh(n)?Ph:Oh;return n?"#"+t(n.r)+t(n.g)+t(n.b)+Nh(n.a,t):void 0}const $h=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Ha(n,t,e){const i=t*Math.min(e,1-e),s=(r,o=(r+n/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[s(0),s(8),s(4)]}function zh(n,t,e){const i=(s,r=(s+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function jh(n,t,e){const i=Ha(n,1,.5);let s;for(t+e>1&&(s=1/(t+e),t*=s,e*=s),s=0;s<3;s++)i[s]*=1-t-e,i[s]+=t;return i}function Hh(n,t,e,i,s){return n===s?(t-e)/i+(t<e?6:0):t===s?(e-n)/i+2:(n-t)/i+4}function zs(n){const e=n.r/255,i=n.g/255,s=n.b/255,r=Math.max(e,i,s),o=Math.min(e,i,s),a=(r+o)/2;let l,c,d;return r!==o&&(d=r-o,c=a>.5?d/(2-r-o):d/(r+o),l=Hh(e,i,s,d,r),l=l*60+.5),[l|0,c||0,a]}function js(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(Vt)}function Hs(n,t,e){return js(Ha,n,t,e)}function Vh(n,t,e){return js(jh,n,t,e)}function Wh(n,t,e){return js(zh,n,t,e)}function Va(n){return(n%360+360)%360}function Uh(n){const t=$h.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Fe(+t[5]):Vt(+t[5]));const s=Va(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=Vh(s,r,o):t[1]==="hsv"?i=Wh(s,r,o):i=Hs(s,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function qh(n,t){var e=zs(n);e[0]=Va(e[0]+t),e=Hs(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Yh(n){if(!n)return;const t=zs(n),e=t[0],i=Cr(t[1]),s=Cr(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${s}%, ${It(n.a)})`:`hsl(${e}, ${i}%, ${s}%)`}const Lr={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Ar={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Xh(){const n={},t=Object.keys(Ar),e=Object.keys(Lr);let i,s,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],s=0;s<e.length;s++)r=e[s],a=a.replace(r,Lr[r]);r=parseInt(Ar[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let Ln;function Kh(n){Ln||(Ln=Xh(),Ln.transparent=[0,0,0,0]);const t=Ln[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Gh=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Jh(n){const t=Gh.exec(n);let e=255,i,s,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?Fe(o):Bt(o*255,0,255)}return i=+t[1],s=+t[3],r=+t[5],i=255&(t[2]?Fe(i):Bt(i,0,255)),s=255&(t[4]?Fe(s):Bt(s,0,255)),r=255&(t[6]?Fe(r):Bt(r,0,255)),{r:i,g:s,b:r,a:e}}}function Zh(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${It(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Vi=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,me=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Qh(n,t,e){const i=me(It(n.r)),s=me(It(n.g)),r=me(It(n.b));return{r:Vt(Vi(i+e*(me(It(t.r))-i))),g:Vt(Vi(s+e*(me(It(t.g))-s))),b:Vt(Vi(r+e*(me(It(t.b))-r))),a:n.a+e*(t.a-n.a)}}function An(n,t,e){if(n){let i=zs(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=Hs(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function Wa(n,t){return n&&Object.assign(t||{},n)}function Dr(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Vt(n[3]))):(t=Wa(n,{r:0,g:0,b:0,a:1}),t.a=Vt(t.a)),t}function tf(n){return n.charAt(0)==="r"?Jh(n):Uh(n)}class sn{constructor(t){if(t instanceof sn)return t;const e=typeof t;let i;e==="object"?i=Dr(t):e==="string"&&(i=Bh(t)||Kh(t)||tf(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Wa(this._rgb);return t&&(t.a=It(t.a)),t}set rgb(t){this._rgb=Dr(t)}rgbString(){return this._valid?Zh(this._rgb):void 0}hexString(){return this._valid?Fh(this._rgb):void 0}hslString(){return this._valid?Yh(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,i.r=255&c*i.r+r*s.r+.5,i.g=255&c*i.g+r*s.g+.5,i.b=255&c*i.b+r*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Qh(this._rgb,t._rgb,e)),this}clone(){return new sn(this.rgb)}alpha(t){return this._rgb.a=Vt(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=kn(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return An(this._rgb,2,t),this}darken(t){return An(this._rgb,2,-t),this}saturate(t){return An(this._rgb,1,t),this}desaturate(t){return An(this._rgb,1,-t),this}rotate(t){return qh(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function St(){}const ef=(()=>{let n=0;return()=>n++})();function D(n){return n==null}function W(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function T(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function Y(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function dt(n,t){return Y(n)?n:t}function I(n,t){return typeof n>"u"?t:n}const nf=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,Ua=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function j(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function N(n,t,e,i){let s,r,o;if(W(n))for(r=n.length,s=0;s<r;s++)t.call(e,n[s],s);else if(T(n))for(o=Object.keys(n),r=o.length,s=0;s<r;s++)t.call(e,n[o[s]],o[s])}function hi(n,t){let e,i,s,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(s=n[e],r=t[e],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function fi(n){if(W(n))return n.map(fi);if(T(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let s=0;for(;s<i;++s)t[e[s]]=fi(n[e[s]]);return t}return n}function qa(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function sf(n,t,e,i){if(!qa(n))return;const s=t[n],r=e[n];T(s)&&T(r)?rn(s,r,i):t[n]=fi(r)}function rn(n,t,e){const i=W(t)?t:[t],s=i.length;if(!T(n))return n;e=e||{};const r=e.merger||sf;let o;for(let a=0;a<s;++a){if(o=i[a],!T(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)r(l[c],n,o,e)}return n}function Ye(n,t){return rn(n,t,{merger:rf})}function rf(n,t,e){if(!qa(n))return;const i=t[n],s=e[n];T(i)&&T(s)?Ye(i,s):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=fi(s))}const Tr={"":n=>n,x:n=>n.x,y:n=>n.y};function of(n){const t=n.split("."),e=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function af(n){const t=of(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function Wt(n,t){return(Tr[t]||(Tr[t]=af(t)))(n)}function Vs(n){return n.charAt(0).toUpperCase()+n.slice(1)}const on=n=>typeof n<"u",Ut=n=>typeof n=="function",Pr=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function lf(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const R=Math.PI,H=2*R,cf=H+R,gi=Number.POSITIVE_INFINITY,df=R/180,K=R/2,Kt=R/4,Or=R*2/3,Nt=Math.log10,_t=Math.sign;function Xe(n,t,e){return Math.abs(n-t)<e}function Rr(n){const t=Math.round(n);n=Xe(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(Nt(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function uf(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((s,r)=>s-r).pop(),t}function hf(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function ke(n){return!hf(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function ff(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Ya(n,t,e){let i,s,r;for(i=0,s=n.length;i<s;i++)r=n[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function pt(n){return n*(R/180)}function Ws(n){return n*(180/R)}function Br(n){if(!Y(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function Xa(n,t){const e=t.x-n.x,i=t.y-n.y,s=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*R&&(r+=H),{angle:r,distance:s}}function ps(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function gf(n,t){return(n-t+cf)%H-R}function nt(n){return(n%H+H)%H}function an(n,t,e,i){const s=nt(n),r=nt(t),o=nt(e),a=nt(r-s),l=nt(o-s),c=nt(s-r),d=nt(s-o);return s===r||s===o||i&&r===o||a>l&&c<d}function J(n,t,e){return Math.max(t,Math.min(e,n))}function pf(n){return J(n,-32768,32767)}function Lt(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function Us(n,t,e){e=e||(o=>n[o]<t);let i=n.length-1,s=0,r;for(;i-s>1;)r=s+i>>1,e(r)?s=r:i=r;return{lo:s,hi:i}}const At=(n,t,e,i)=>Us(n,e,i?s=>{const r=n[s][t];return r<e||r===e&&n[s+1][t]===e}:s=>n[s][t]<e),mf=(n,t,e)=>Us(n,e,i=>n[i][t]>=e);function bf(n,t,e){let i=0,s=n.length;for(;i<s&&n[i]<t;)i++;for(;s>i&&n[s-1]>e;)s--;return i>0||s<n.length?n.slice(i,s):n}const Ka=["push","pop","shift","splice","unshift"];function yf(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Ka.forEach(e=>{const i="_onData"+Vs(e),s=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=s.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function Nr(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(Ka.forEach(r=>{delete n[r]}),delete n._chartjs)}function Ga(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Ja=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Za(n,t){let e=[],i=!1;return function(...s){e=s,i||(i=!0,Ja.call(window,()=>{i=!1,n.apply(t,e)}))}}function xf(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const qs=n=>n==="start"?"left":n==="end"?"right":"center",et=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,vf=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Qa(n,t,e){const i=t.length;let s=0,r=i;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=o.axis,{min:u,max:h,minDefined:f,maxDefined:g}=o.getUserBounds();if(f){if(s=Math.min(At(l,d,u).lo,e?i:At(t,d,o.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!D(m[a.axis]));s-=Math.max(0,p)}s=J(s,0,i-1)}if(g){let p=Math.max(At(l,o.axis,h,!0).hi+1,e?0:At(t,d,o.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!D(b[a.axis]));p+=Math.max(0,m)}r=J(p,s,i)-s}else r=i-s}return{start:s,count:r}}function tl(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,s={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,s),r}const Dn=n=>n===0||n===1,Fr=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*H/e)),$r=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*H/e)+1,Ke={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*K)+1,easeOutSine:n=>Math.sin(n*K),easeInOutSine:n=>-.5*(Math.cos(R*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Dn(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Dn(n)?n:Fr(n,.075,.3),easeOutElastic:n=>Dn(n)?n:$r(n,.075,.3),easeInOutElastic(n){return Dn(n)?n:n<.5?.5*Fr(n*2,.1125,.45):.5+.5*$r(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Ke.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Ke.easeInBounce(n*2)*.5:Ke.easeOutBounce(n*2-1)*.5+.5};function Ys(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function zr(n){return Ys(n)?n:new sn(n)}function Wi(n){return Ys(n)?n:new sn(n).saturate(.5).darken(.1).hexString()}const _f=["x","y","borderWidth","radius","tension"],kf=["color","borderColor","backgroundColor"];function wf(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:kf},numbers:{type:"number",properties:_f}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Sf(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const jr=new Map;function Mf(n,t){t=t||{};const e=n+JSON.stringify(t);let i=jr.get(e);return i||(i=new Intl.NumberFormat(n,t),jr.set(e,i)),i}function wn(n,t,e){return Mf(t,e).format(n)}const el={values(n){return W(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let s,r=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),r=Ef(n,e)}const o=Nt(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),wn(n,i,l)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(Nt(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?el.numeric.call(this,n,t,e):""}};function Ef(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Mi={formatters:el};function If(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Mi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const ae=Object.create(null),ms=Object.create(null);function Ge(n,t){if(!t)return n;const e=t.split(".");for(let i=0,s=e.length;i<s;++i){const r=e[i];n=n[r]||(n[r]=Object.create(null))}return n}function Ui(n,t,e){return typeof t=="string"?rn(Ge(n,t),e):rn(Ge(n,""),t)}class Cf{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Wi(s.backgroundColor),this.hoverBorderColor=(i,s)=>Wi(s.borderColor),this.hoverColor=(i,s)=>Wi(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Ui(this,t,e)}get(t){return Ge(this,t)}describe(t,e){return Ui(ms,t,e)}override(t,e){return Ui(ae,t,e)}route(t,e,i,s){const r=Ge(this,t),o=Ge(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[s];return T(l)?Object.assign({},c,l):I(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var U=new Cf({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[wf,Sf,If]);function Lf(n){return!n||D(n.size)||D(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function pi(n,t,e,i,s){let r=t[s];return r||(r=t[s]=n.measureText(s).width,e.push(s)),r>i&&(i=r),i}function Af(n,t,e,i){i=i||{};let s=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},r=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=e[l],u!=null&&!W(u))o=pi(n,s,r,o,u);else if(W(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!W(h)&&(o=pi(n,s,r,o,h));n.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete s[r[l]];r.splice(0,f)}return o}function Gt(n,t,e){const i=n.currentDevicePixelRatio,s=e!==0?Math.max(e/2,.5):0;return Math.round((t-s)*i)/i+s}function Hr(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function bs(n,t,e,i){nl(n,t,e,i,null)}function nl(n,t,e,i,s){let r,o,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*df;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(p)||p<=0)){switch(n.beginPath(),f){default:s?n.ellipse(e,i,s/2,p,0,0,H):n.arc(e,i,p,0,H),n.closePath();break;case"triangle":d=s?s/2:p,n.moveTo(e+Math.sin(m)*d,i-Math.cos(m)*p),m+=Or,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*p),m+=Or,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*p),n.closePath();break;case"rectRounded":c=p*.516,l=p-c,o=Math.cos(m+Kt)*l,u=Math.cos(m+Kt)*(s?s/2-c:l),a=Math.sin(m+Kt)*l,h=Math.sin(m+Kt)*(s?s/2-c:l),n.arc(e-u,i-a,c,m-R,m-K),n.arc(e+h,i-o,c,m-K,m),n.arc(e+u,i+a,c,m,m+K),n.arc(e-h,i+o,c,m+K,m+R),n.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,n.rect(e-d,i-l,2*d,2*l);break}m+=Kt;case"rectRot":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+h,i-o),n.lineTo(e+u,i+a),n.lineTo(e-h,i+o),n.closePath();break;case"crossRot":m+=Kt;case"cross":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o);break;case"star":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o),m+=Kt,u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o);break;case"line":o=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,n.moveTo(e-o,i-a),n.lineTo(e+o,i+a);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Dt(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Ei(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Ii(n){n.restore()}function Df(n,t,e,i,s){if(!t)return n.lineTo(e.x,e.y);if(s==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else s==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function Tf(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function Pf(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),D(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function Of(n,t,e,i,s){if(s.strikethrough||s.underline){const r=n.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(o,d),n.lineTo(a,d),n.stroke()}}function Rf(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function le(n,t,e,i,s,r={}){const o=W(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(n.save(),n.font=s.string,Pf(n,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&Rf(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),D(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(c,e,i,r.maxWidth)),n.fillText(c,e,i,r.maxWidth),Of(n,e,i,c,r),i+=Number(s.lineHeight);n.restore()}function ln(n,t){const{x:e,y:i,w:s,h:r,radius:o}=t;n.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*R,R,!0),n.lineTo(e,i+r-o.bottomLeft),n.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,R,K,!0),n.lineTo(e+s-o.bottomRight,i+r),n.arc(e+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,K,0,!0),n.lineTo(e+s,i+o.topRight),n.arc(e+s-o.topRight,i+o.topRight,o.topRight,0,-K,!0),n.lineTo(e+o.topLeft,i)}const Bf=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Nf=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Ff(n,t){const e=(""+n).match(Bf);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const $f=n=>+n||0;function Xs(n,t){const e={},i=T(t),s=i?Object.keys(t):t,r=T(n)?i?o=>I(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of s)e[o]=$f(r(o));return e}function il(n){return Xs(n,{top:"y",right:"x",bottom:"y",left:"x"})}function re(n){return Xs(n,["topLeft","topRight","bottomLeft","bottomRight"])}function st(n){const t=il(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function G(n,t){n=n||{},t=t||U.font;let e=I(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=I(n.style,t.style);i&&!(""+i).match(Nf)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:I(n.family,t.family),lineHeight:Ff(I(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:I(n.weight,t.weight),string:""};return s.string=Lf(s),s}function $e(n,t,e,i){let s,r,o;for(s=0,r=n.length;s<r;++s)if(o=n[s],o!==void 0&&o!==void 0)return o}function zf(n,t,e){const{min:i,max:s}=n,r=Ua(t,(s-i)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(i,-Math.abs(r)),max:o(s,r)}}function qt(n,t){return Object.assign(Object.create(n),t)}function Ks(n,t=[""],e,i,s=()=>n[0]){const r=e||n;typeof i>"u"&&(i=al("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:i,_getTarget:s,override:a=>Ks([a,...n],t,r,i)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return rl(a,l,()=>Xf(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Wr(a).includes(l)},ownKeys(a){return Wr(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function we(n,t,e,i){const s={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:sl(n,i),setContext:r=>we(n,r,e,i),override:r=>we(n.override(r),t,e,i)};return new Proxy(s,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return rl(r,o,()=>Hf(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function sl(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=n;return{allKeys:s,scriptable:e,indexable:i,isScriptable:Ut(e)?e:()=>e,isIndexable:Ut(i)?i:()=>i}}const jf=(n,t)=>n?n+Vs(t):t,Gs=(n,t)=>T(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function rl(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function Hf(n,t,e){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=n;let a=i[t];return Ut(a)&&o.isScriptable(t)&&(a=Vf(t,a,n,e)),W(a)&&a.length&&(a=Wf(t,a,n,o.isIndexable)),Gs(t,a)&&(a=we(a,s,r&&r[t],o)),a}function Vf(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||i);return a.delete(n),Gs(n,l)&&(l=Js(s._scopes,s,n,l)),l}function Wf(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&i(n))return t[r.index%t.length];if(T(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=Js(c,s,n,d);t.push(we(u,r,o&&o[n],a))}}return t}function ol(n,t,e){return Ut(n)?n(t,e):n}const Uf=(n,t)=>n===!0?t:typeof n=="string"?Wt(t,n):void 0;function qf(n,t,e,i,s){for(const r of t){const o=Uf(e,r);if(o){n.add(o);const a=ol(o._fallback,e,s);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function Js(n,t,e,i){const s=t._rootScopes,r=ol(t._fallback,e,i),o=[...n,...s],a=new Set;a.add(i);let l=Vr(a,o,e,r||e,i);return l===null||typeof r<"u"&&r!==e&&(l=Vr(a,o,r,l,i),l===null)?!1:Ks(Array.from(a),[""],s,r,()=>Yf(t,e,i))}function Vr(n,t,e,i,s){for(;e;)e=qf(n,t,e,i,s);return e}function Yf(n,t,e){const i=n._getTarget();t in i||(i[t]={});const s=i[t];return W(s)&&T(e)?e:s||{}}function Xf(n,t,e,i){let s;for(const r of t)if(s=al(jf(r,n),e),typeof s<"u")return Gs(n,s)?Js(e,i,n,s):s}function al(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function Wr(n){let t=n._keys;return t||(t=n._keys=Kf(n._scopes)),t}function Kf(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function ll(n,t,e,i){const{iScale:s}=n,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+e,d=t[c],o[a]={r:s.parse(Wt(d,r),c)};return o}const Gf=Number.EPSILON||1e-14,Se=(n,t)=>t<n.length&&!n[t].skip&&n[t],cl=n=>n==="x"?"y":"x";function Jf(n,t,e,i){const s=n.skip?t:n,r=t,o=e.skip?t:e,a=ps(r,s),l=ps(o,r);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:r.x-u*(o.x-s.x),y:r.y-u*(o.y-s.y)},next:{x:r.x+h*(o.x-s.x),y:r.y+h*(o.y-s.y)}}}function Zf(n,t,e){const i=n.length;let s,r,o,a,l,c=Se(n,0);for(let d=0;d<i-1;++d)if(l=c,c=Se(n,d+1),!(!l||!c)){if(Xe(t[d],0,Gf)){e[d]=e[d+1]=0;continue}s=e[d]/t[d],r=e[d+1]/t[d],a=Math.pow(s,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[d]=s*o*t[d],e[d+1]=r*o*t[d])}}function Qf(n,t,e="x"){const i=cl(e),s=n.length;let r,o,a,l=Se(n,0);for(let c=0;c<s;++c){if(o=a,a=l,l=Se(n,c+1),!a)continue;const d=a[e],u=a[i];o&&(r=(d-o[e])/3,a[`cp1${e}`]=d-r,a[`cp1${i}`]=u-r*t[c]),l&&(r=(l[e]-d)/3,a[`cp2${e}`]=d+r,a[`cp2${i}`]=u+r*t[c])}}function tg(n,t="x"){const e=cl(t),i=n.length,s=Array(i).fill(0),r=Array(i);let o,a,l,c=Se(n,0);for(o=0;o<i;++o)if(a=l,l=c,c=Se(n,o+1),!!l){if(c){const d=c[t]-l[t];s[o]=d!==0?(c[e]-l[e])/d:0}r[o]=a?c?_t(s[o-1])!==_t(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}Zf(n,s,r),Qf(n,r,t)}function Tn(n,t,e){return Math.max(Math.min(n,e),t)}function eg(n,t){let e,i,s,r,o,a=Dt(n[0],t);for(e=0,i=n.length;e<i;++e)o=r,r=a,a=e<i-1&&Dt(n[e+1],t),r&&(s=n[e],o&&(s.cp1x=Tn(s.cp1x,t.left,t.right),s.cp1y=Tn(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=Tn(s.cp2x,t.left,t.right),s.cp2y=Tn(s.cp2y,t.top,t.bottom)))}function ng(n,t,e,i,s){let r,o,a,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")tg(n,s);else{let c=i?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=Jf(c,a,n[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&eg(n,e)}function Zs(){return typeof window<"u"&&typeof document<"u"}function Qs(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function mi(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const Ci=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function ig(n,t){return Ci(n).getPropertyValue(t)}const sg=["top","right","bottom","left"];function oe(n,t,e){const i={};e=e?"-"+e:"";for(let s=0;s<4;s++){const r=sg[s];i[r]=parseFloat(n[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const rg=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function og(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:s,offsetY:r}=i;let o=!1,a,l;if(rg(s,r,n.target))a=s,l=r;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function Qt(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,s=Ci(e),r=s.boxSizing==="border-box",o=oe(s,"padding"),a=oe(s,"border","width"),{x:l,y:c,box:d}=og(n,e),u=o.left+(d&&a.left),h=o.top+(d&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((l-u)/f*e.width/i),y:Math.round((c-h)/g*e.height/i)}}function ag(n,t,e){let i,s;if(t===void 0||e===void 0){const r=n&&Qs(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Ci(r),l=oe(a,"border","width"),c=oe(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,i=mi(a.maxWidth,r,"clientWidth"),s=mi(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||gi,maxHeight:s||gi}}const Ft=n=>Math.round(n*10)/10;function lg(n,t,e,i){const s=Ci(n),r=oe(s,"margin"),o=mi(s.maxWidth,n,"clientWidth")||gi,a=mi(s.maxHeight,n,"clientHeight")||gi,l=ag(n,t,e);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=oe(s,"border","width"),f=oe(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-r.width),d=Math.max(0,i?c/i:d-r.height),c=Ft(Math.min(c,o,l.maxWidth)),d=Ft(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Ft(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Ft(Math.floor(d*i))),{width:c,height:d}}function Ur(n,t,e){const i=t||1,s=Ft(n.height*i),r=Ft(n.width*i);n.height=Ft(n.height),n.width=Ft(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||o.height!==s||o.width!==r?(n.currentDevicePixelRatio=i,o.height=s,o.width=r,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const cg=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Zs()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function qr(n,t){const e=ig(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function te(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function dg(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function ug(n,t,e,i){const s={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=te(n,s,e),a=te(s,r,e),l=te(r,t,e),c=te(o,a,e),d=te(a,l,e);return te(c,d,e)}const hg=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},fg=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function _e(n,t,e){return n?hg(t,e):fg()}function dl(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function ul(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function hl(n){return n==="angle"?{between:an,compare:gf,normalize:nt}:{between:Lt,compare:(t,e)=>t-e,normalize:t=>t}}function Yr({start:n,end:t,count:e,loop:i,style:s}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:s}}function gg(n,t,e){const{property:i,start:s,end:r}=e,{between:o,normalize:a}=hl(i),l=t.length;let{start:c,end:d,loop:u}=n,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&o(a(t[c%l][i]),s,r);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function fl(n,t,e){if(!e)return[n];const{property:i,start:s,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=hl(i),{start:d,end:u,loop:h,style:f}=gg(n,t,e),g=[];let p=!1,m=null,b,y,v;const _=()=>l(s,v,b)&&a(s,v)!==0,x=()=>a(r,b)===0||l(r,v,b),k=()=>p||_(),S=()=>!p||x();for(let M=d,E=d;M<=u;++M)y=t[M%o],!y.skip&&(b=c(y[i]),b!==v&&(p=l(b,s,r),m===null&&k()&&(m=a(b,s)===0?M:E),m!==null&&S()&&(g.push(Yr({start:m,end:M,loop:h,count:o,style:f})),m=null),E=M,v=b));return m!==null&&g.push(Yr({start:m,end:u,loop:h,count:o,style:f})),g}function gl(n,t){const e=[],i=n.segments;for(let s=0;s<i.length;s++){const r=fl(i[s],n.points,t);r.length&&e.push(...r)}return e}function pg(n,t,e,i){let s=0,r=t-1;if(e&&!i)for(;s<t&&!n[s].skip;)s++;for(;s<t&&n[s].skip;)s++;for(s%=t,e&&(r+=s);r>s&&n[r%t].skip;)r--;return r%=t,{start:s,end:r}}function mg(n,t,e,i){const s=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%s];c.skip||c.stop?a.skip||(i=!1,r.push({start:t%s,end:(l-1)%s,loop:i}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%s,end:o%s,loop:i}),r}function bg(n,t){const e=n.points,i=n.options.spanGaps,s=e.length;if(!s)return[];const r=!!n._loop,{start:o,end:a}=pg(e,s,r,i);if(i===!0)return Xr(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+s:a,c=!!n._fullLoop&&o===0&&a===s-1;return Xr(n,mg(e,o,l,c),e,t)}function Xr(n,t,e,i){return!i||!i.setContext||!e?t:yg(n,t,e,i)}function yg(n,t,e,i){const s=n._chart.getContext(),r=Kr(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,c=[];let d=r,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;e[g%l].skip;)g-=y;for(;e[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=e[u%l],m;for(h=u+1;h<=g.end;h++){const b=e[h%l];m=Kr(i.setContext(qt(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:o}))),xg(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Kr(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function xg(n,t){if(!t)return!1;const e=[],i=function(s,r){return Ys(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function Pn(n,t,e){return n.options.clip?n[e]:t[e]}function vg(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:Pn(e,t,"left"),right:Pn(e,t,"right"),top:Pn(i,t,"top"),bottom:Pn(i,t,"bottom")}:t}function pl(n,t){const e=t._clip;if(e.disabled)return!1;const i=vg(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class _g{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const r=e.listeners[s],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Ja.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),r.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Mt=new _g;const Gr="transparent",kg={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=zr(n||Gr),s=i.valid&&zr(t||Gr);return s&&s.valid?s.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class wg{constructor(t,e,i,s){const r=e[i];s=$e([t.to,s,r,t.from]);const o=$e([t.from,r,s]);this._active=!0,this._fn=t.fn||kg[t.type||typeof o],this._easing=Ke[t.easing]||Ke.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=$e([t.to,e,s,t.from]),this._from=$e([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<i),!this._active){this._target[s]=a,this._notify(!0);return}if(e<0){this._target[s]=r;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][e]()}}class ml{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!T(t))return;const e=Object.keys(U.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const r=t[s];if(!T(r))return;const o={};for(const a of e)o[a]=r[a];(W(r.properties)&&r.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,s=Mg(t,i);if(!s)return[];const r=this._createAnimations(s,i);return i.$shared&&Sg(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,s=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,e));continue}const d=e[c];let u=r[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}r[c]=u=new wg(h,t,c,d),s.push(u)}return s}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Mt.add(this._chart,i),!0}}function Sg(n,t){const e=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const r=n[i[s]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function Mg(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Jr(n,t){const e=n&&n.options||{},i=e.reverse,s=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:s,end:i?s:r}}function Eg(n,t,e){if(e===!1)return!1;const i=Jr(n,e),s=Jr(t,e);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function Ig(n){let t,e,i,s;return T(n)?(t=n.top,e=n.right,i=n.bottom,s=n.left):t=e=i=s=n,{top:t,right:e,bottom:i,left:s,disabled:n===!1}}function bl(n,t){const e=[],i=n._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)e.push(i[s].index);return e}function Zr(n,t,e,i={}){const s=n.keys,r=i.mode==="single";let o,a,l,c;if(t===null)return;let d=!1;for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===e){if(d=!0,i.all)continue;break}c=n.values[l],Y(c)&&(r||t===0||_t(t)===_t(c))&&(t+=c)}return!d&&!i.all?0:t}function Cg(n,t){const{iScale:e,vScale:i}=t,s=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],a[l]={[s]:d,[r]:n[d]};return a}function qi(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function Lg(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function Ag(n){const{min:t,max:e,minDefined:i,maxDefined:s}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?e:Number.POSITIVE_INFINITY}}function Dg(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function Qr(n,t,e,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const r=n[s.index];if(e&&r>0||!e&&r<0)return s.index}return null}function to(n,t){const{chart:e,_cachedMeta:i}=n,s=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,d=Lg(r,o,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=Dg(s,d,p),h[a]=m,h._top=Qr(h,o,!0,i.type),h._bottom=Qr(h,o,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function Yi(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function Tg(n,t){return qt(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Pg(n,t,e){return qt(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function Ae(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const s of t){const r=s._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const Xi=n=>n==="reset"||n==="none",eo=(n,t)=>t?n:Object.assign({},n),Og=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:bl(e,!0),values:null};class mt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=qi(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Ae(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,r=e.xAxisID=I(i.xAxisID,Yi(t,"x")),o=e.yAxisID=I(i.yAxisID,Yi(t,"y")),a=e.rAxisID=I(i.rAxisID,Yi(t,"r")),l=e.indexAxis,c=e.iAxisID=s(l,r,o,a),d=e.vAxisID=s(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Nr(this._data,this),t._stacked&&Ae(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(T(e)){const s=this._cachedMeta;this._data=Cg(e,s)}else if(i!==e){if(i){Nr(i,this);const s=this._cachedMeta;Ae(s),s._parsed=[]}e&&Object.isExtensible(e)&&yf(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const r=e._stacked;e._stacked=qi(e.vScale,e),e.stack!==i.stack&&(s=!0,Ae(e),e.stack=i.stack),this._resyncElements(t),(s||r!==e._stacked)&&(to(this,e._parsed),e._stacked=qi(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:r,_stacked:o}=i,a=r.axis;let l=t===0&&e===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{W(s[t])?h=this.parseArrayData(i,s,t,e):T(s[t])?h=this.parseObjectData(i,s,t,e):h=this.parsePrimitiveData(i,s,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<e;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}o&&to(this,h)}parsePrimitiveData(t,e,i,s){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),d=r===o,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||r.parse(c[g],g),[l]:o.parse(e[g],g)};return u}parseArrayData(t,e,i,s){const{xScale:r,yScale:o}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=e[d],a[l]={x:r.parse(u[0],d),y:o.parse(u[1],d)};return a}parseObjectData(t,e,i,s){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=e[h],c[d]={x:r.parse(Wt(f,a),h),y:o.parse(Wt(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:bl(s,!0),values:e._stacks[t.axis]._visualValues};return Zr(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const r=i[e.axis];let o=r===null?NaN:r;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Zr(s,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,r=i._sorted&&t===i.iScale,o=s.length,a=this._getOtherScale(t),l=Og(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=Ag(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!Y(f[t.axis])||d>p||u<p}for(h=0;h<o&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),r));++h);if(r){for(h=o-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,r,o;for(s=0,r=e.length;s<r;++s)o=e[s][t.axis],Y(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:s?""+s.getLabelForValue(r[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=Ig(I(this.options.clip,Eg(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,r,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(d=0;d<o.length;++d)o[d].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=Pg(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=s.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=Tg(this.chart.getContext(),this.index)),r.dataset=s,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&on(i);if(a)return eo(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(U.elements[t]),g=()=>this.getContext(i,s,e),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,r[o]=Object.freeze(eo(p,l))),p}_resolveAnimations(t,e,i){const s=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,e))}const c=new ml(s,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Xi(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==s;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,s){Xi(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!Xi(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const r=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,r=e.length,o=Math.min(r,s);o&&this.parse(0,o),r>s?this._insertElements(s,r-s,t):r<s&&this._removeElements(r,s-r)}_insertElements(t,e,i=!0){const s=this._cachedMeta,r=s.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&Ae(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}w(mt,"defaults",{}),w(mt,"datasetElementType",null),w(mt,"dataElementType",null);function Rg(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let s=0,r=e.length;s<r;s++)i=i.concat(e[s].controller.getAllParsedValues(n));n._cache.$bar=Ga(i.sort((s,r)=>s-r))}return n._cache.$bar}function Bg(n){const t=n.iScale,e=Rg(t,n.type);let i=t._length,s,r,o,a;const l=()=>{o===32767||o===-32768||(on(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(s=0,r=e.length;s<r;++s)o=t.getPixelForValue(e[s]),l();for(a=void 0,s=0,r=t.ticks.length;s<r;++s)o=t.getPixelForTick(s),l();return i}function Ng(n,t,e,i){const s=e.barThickness;let r,o;return D(s)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[n]-r/2}}function Fg(n,t,e,i){const s=t.pixels,r=s[n];let o=n>0?s[n-1]:null,a=n<s.length-1?s[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:e.barPercentage,start:c}}function $g(n,t,e,i){const s=e.parse(n[0],i),r=e.parse(n[1],i),o=Math.min(s,r),a=Math.max(s,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:r,min:o,max:a}}function yl(n,t,e,i){return W(n)?$g(n,t,e,i):t[e.axis]=e.parse(n,i),t}function no(n,t,e,i){const s=n.iScale,r=n.vScale,o=s.getLabels(),a=s===r,l=[];let c,d,u,h;for(c=e,d=e+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(o[c],c),l.push(yl(h,u,r,c));return l}function Ki(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function zg(n,t,e){return n!==0?_t(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function jg(n){let t,e,i,s,r;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(s="end",r="start"):(s="start",r="end"),{start:e,end:i,reverse:t,top:s,bottom:r}}function Hg(n,t,e,i){let s=t.borderSkipped;const r={};if(!s){n.borderSkipped=r;return}if(s===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:d}=jg(n);s==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?s=c:(e._bottom||0)===i?s=d:(r[io(d,o,a,l)]=!0,s=c)),r[io(s,o,a,l)]=!0,n.borderSkipped=r}function io(n,t,e,i){return i?(n=Vg(n,t,e),n=so(n,e,t)):n=so(n,t,e),n}function Vg(n,t,e){return n===t?e:n===e?t:n}function so(n,t,e){return n==="start"?t:n==="end"?e:n}function Wg(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class Kn extends mt{parsePrimitiveData(t,e,i,s){return no(t,e,i,s)}parseArrayData(t,e,i,s){return no(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,d=o.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=e[h],g={},g[r.axis]=r.parse(Wt(p,c),h),u.push(yl(Wt(p,d),g,o,h));return u}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,r=this.getParsed(t),o=r._custom,a=Ki(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(r[s.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,s){const r=s==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,s);for(let f=e;f<e+i;f++){const g=this.getParsed(f),p=r||D(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||Ki(g._custom)||o===b._top||o===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const v=y.options||t[f].options;Hg(y,v,b,o),Wg(y,v,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),r=i.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(D(h)||isNaN(h))return!0};for(const d of s)if(!(e!==void 0&&c(d))&&((r===!1||o.indexOf(d.stack)===-1||r===void 0&&d.stack===void 0)&&o.push(d.stack),d.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[I(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const s=this._getStacks(t,i),r=e!==void 0?s.indexOf(e):-1;return r===-1?s.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let r,o;for(r=0,o=e.data.length;r<o;++r)s.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||Bg(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:s},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,d=Ki(c);let u=l[e.axis],h=0,f=i?this.applyStack(e,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&_t(u)!==_t(c.barEnd)&&(h=0),h+=u);const m=!D(r)&&!d?r:h;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<o){p=zg(p,e,a)*o,u===a&&(b-=p/2);const y=e.getPixelForDecimal(0),v=e.getPixelForDecimal(1),_=Math.min(y,v),x=Math.max(y,v);b=Math.max(Math.min(b,x),_),g=b+p,i&&!d&&(l._stacks[e.axis]._visualValues[s]=e.getValueForPixel(g)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const y=_t(p)*e.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const i=e.scale,s=this.options,r=s.skipNull,o=I(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const d=r?this._getStackCount(t):e.stackCount,u=s.barThickness==="flex"?Fg(t,e,s,d*c):Ng(t,e,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(I(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let r=0;for(;r<s;++r)this.getParsed(r)[e.axis]!==null&&!i[r].hidden&&i[r].draw(this._ctx)}}w(Kn,"id","bar"),w(Kn,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),w(Kn,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Gn extends mt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const r=super.parsePrimitiveData(t,e,i,s);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,s){const r=super.parseArrayData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=I(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,s){const r=super.parseObjectData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=I(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,s),d=o.axis,u=a.axis;for(let h=e;h<e+i;h++){const f=t[h],g=!r&&this.getParsed(h),p={},m=p[d]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[d]),b=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),r&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const r=s.radius;return e!=="active"&&(s.radius=0),s.radius+=I(i&&i._custom,r),s}}w(Gn,"id","bubble"),w(Gn,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),w(Gn,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Ug(n,t,e){let i=1,s=1,r=0,o=0;if(t<H){const a=n,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(v,_,x)=>an(v,a,l,!0)?1:Math.max(_,_*e,x,x*e),g=(v,_,x)=>an(v,a,l,!0)?-1:Math.min(_,_*e,x,x*e),p=f(0,c,u),m=f(K,d,h),b=g(R,c,u),y=g(R+K,d,h);i=(p-b)/2,s=(m-y)/2,r=-(p+b)/2,o=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}class se extends mt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let r=l=>+i[l];if(T(i[t])){const{key:l="value"}=this._parsing;r=c=>+Wt(i[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)s._parsed[o]=r(o)}}_getRotation(){return pt(this.options.rotation-90)}_getCircumference(){return pt(this.options.circumference)}_getRotationExtents(){let t=H,e=-H;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,r=s._getRotation(),o=s._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,r=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min(nf(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Ug(u,d,l),m=(i.width-o)/h,b=(i.height-o)/f,y=Math.max(Math.min(m,b)/2,0),v=Ua(this.options.radius,y),_=Math.max(v*l,0),x=(v-_)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=p*v,s.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*r/H)}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=r&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,s);let b=this._getRotation(),y;for(y=0;y<e;++y)b+=this._circumference(y,r);for(y=e;y<e+i;++y){const v=this._circumference(y,r),_=t[y],x={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+v,circumference:v,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(y,_.active?"active":s)),b+=v,this.updateElement(_,y,x,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,s;for(s=0;s<e.length;s++){const r=t._parsed[s];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(s)&&!e[s].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?H*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=wn(e._parsed[t],i.options.locale);return{label:s[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,r,o,a,l;if(!t){for(s=0,r=i.data.datasets.length;s<r;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}}if(!t)return 0;for(s=0,r=t.length;s<r;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(I(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}w(se,"id","doughnut"),w(se,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),w(se,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),w(se,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class Jn extends mt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Qa(e,s,o);this._drawStart=a,this._drawCount=l,tl(e)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,s),h=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=ke(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||s==="none",y=e+i,v=t.length;let _=e>0&&this.getParsed(e-1);for(let x=0;x<v;++x){const k=t[x],S=b?k:{};if(x<e||x>=y){S.skip=!0;continue}const M=this.getParsed(x),E=D(M[f]),L=S[h]=o.getPixelForValue(M[h],x),A=S[f]=r||E?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,M,l):M[f],x);S.skip=isNaN(L)||isNaN(A)||E,S.stop=x>0&&Math.abs(M[h]-_[h])>m,p&&(S.parsed=M,S.raw=c.data[x]),u&&(S.options=d||this.resolveDataElementOptions(x,k.active?"active":s)),b||this.updateElement(k,x,S,s),_=M}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const r=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}w(Jn,"id","line"),w(Jn,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),w(Jn,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class Je extends mt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=wn(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:r}}parseObjectData(t,e,i,s){return ll.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const r=this.getParsed(s).r;!isNaN(r)&&this.chart.getDataVisibility(s)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(s/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*R;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,s,p);for(g=e;g<e+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),v=o.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,r&&(l.animateScale&&(v=0),l.animateRotate&&(b=y=h));const _={x:d,y:u,innerRadius:0,outerRadius:v,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,_,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?pt(this.resolveDataElementOptions(t,e).angle||i):0}}w(Je,"id","polarArea"),w(Je,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),w(Je,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class ys extends se{}w(ys,"id","pie"),w(ys,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Zn extends mt{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return ll.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],r=e.iScale.getLabels();if(i.points=s,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===s.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const r=this._cachedMeta.rScale,o=s==="reset";for(let a=e;a<e+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:d.x,h=o?r.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}w(Zn,"id","radar"),w(Zn,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),w(Zn,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Qn extends mt{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:r,count:o}=Qa(e,i,s);if(this._drawStart=r,this._drawCount=o,tl(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=ke(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||s==="none";let v=e>0&&this.getParsed(e-1);for(let _=e;_<e+i;++_){const x=t[_],k=this.getParsed(_),S=y?x:{},M=D(k[g]),E=S[f]=o.getPixelForValue(k[f],_),L=S[g]=r||M?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,k,l):k[g],_);S.skip=isNaN(E)||isNaN(L)||M,S.stop=_>0&&Math.abs(k[f]-v[f])>b,m&&(S.parsed=k,S.raw=c.data[_]),h&&(S.options=u||this.resolveDataElementOptions(_,x.active?"active":s)),y||this.updateElement(x,_,S,s),v=k}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,r,o)/2}}w(Qn,"id","scatter"),w(Qn,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),w(Qn,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var qg=Object.freeze({__proto__:null,BarController:Kn,BubbleController:Gn,DoughnutController:se,LineController:Jn,PieController:ys,PolarAreaController:Je,RadarController:Zn,ScatterController:Qn});function Jt(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class tr{constructor(t){w(this,"options");this.options=t||{}}static override(t){Object.assign(tr.prototype,t)}init(){}formats(){return Jt()}parse(){return Jt()}format(){return Jt()}add(){return Jt()}diff(){return Jt()}startOf(){return Jt()}endOf(){return Jt()}}var Yg={_date:tr};function Xg(n,t,e,i){const{controller:s,data:r,_sorted:o}=n,a=s._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?mf:At;if(i){if(s._sharedOptions){const d=r[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(r,t,e-u),f=c(r,t,e+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(r,t,e);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=n,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!D(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!D(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:r.length-1}}function Li(n,t,e,i,s){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:d}=r[a],{lo:u,hi:h}=Xg(r[a],t,o,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Kg(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,s){const r=t?Math.abs(i.x-s.x):0,o=e?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function Gi(n,t,e,i,s){const r=[];return!s&&!n.isPointInArea(t)||Li(n,e,t,function(a,l,c){!s&&!Dt(a,n.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function Gg(n,t,e,i){let s=[];function r(o,a,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],i),{angle:u}=Xa(o,{x:t.x,y:t.y});an(u,c,d)&&s.push({element:o,datasetIndex:a,index:l})}return Li(n,e,t,r),s}function Jg(n,t,e,i,s,r){let o=[];const a=Kg(e);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!r||n.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(o=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&o.push({element:d,datasetIndex:u,index:h})}return Li(n,e,t,c),o}function Ji(n,t,e,i,s,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!i?Gg(n,t,e,s):Jg(n,t,e,i,s,r)}function ro(n,t,e,i,s){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Li(n,e,t,(l,c,d)=>{l[o]&&l[o](t[e],s)&&(r.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:r}var Zg={modes:{index(n,t,e,i){const s=Qt(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?Gi(n,s,r,i,o):Ji(n,s,r,!1,i,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,i){const s=Qt(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?Gi(n,s,r,i,o):Ji(n,s,r,!1,i,o);if(a.length>0){const l=a[0].datasetIndex,c=n.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(n,t,e,i){const s=Qt(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return Gi(n,s,r,i,o)},nearest(n,t,e,i){const s=Qt(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return Ji(n,s,r,e.intersect,i,o)},x(n,t,e,i){const s=Qt(t,n);return ro(n,s,"x",e.intersect,i)},y(n,t,e,i){const s=Qt(t,n);return ro(n,s,"y",e.intersect,i)}}};const xl=["left","top","right","bottom"];function De(n,t){return n.filter(e=>e.pos===t)}function oo(n,t){return n.filter(e=>xl.indexOf(e.pos)===-1&&e.box.axis===t)}function Te(n,t){return n.sort((e,i)=>{const s=t?i:e,r=t?e:i;return s.weight===r.weight?s.index-r.index:s.weight-r.weight})}function Qg(n){const t=[];let e,i,s,r,o,a;for(e=0,i=(n||[]).length;e<i;++e)s=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=s,t.push({index:e,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return t}function tp(n){const t={};for(const e of n){const{stack:i,pos:s,stackWeight:r}=e;if(!i||!xl.includes(s))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function ep(n,t){const e=tp(n),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,c=e[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return e}function np(n){const t=Qg(n),e=Te(t.filter(c=>c.box.fullSize),!0),i=Te(De(t,"left"),!0),s=Te(De(t,"right")),r=Te(De(t,"top"),!0),o=Te(De(t,"bottom")),a=oo(t,"x"),l=oo(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:De(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}function ao(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function vl(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function ip(n,t,e,i){const{pos:s,box:r}=e,o=n.maxPadding;if(!T(s)){e.size&&(n[s]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[s]+=e.size}r.getPadding&&vl(o,r.getPadding());const a=Math.max(0,t.outerWidth-ao(o,n,"left","right")),l=Math.max(0,t.outerHeight-ao(o,n,"top","bottom")),c=a!==n.w,d=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function sp(n){const t=n.maxPadding;function e(i){const s=Math.max(t[i]-n[i],0);return n[i]+=s,s}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function rp(n,t){const e=t.maxPadding;function i(s){const r={left:0,top:0,right:0,bottom:0};return s.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(n?["left","right"]:["top","bottom"])}function ze(n,t,e,i){const s=[];let r,o,a,l,c,d;for(r=0,o=n.length,c=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,rp(a.horizontal,t));const{same:u,other:h}=ip(t,e,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&ze(s,t,e,i)||d}function On(n,t,e,i,s){n.top=e,n.left=t,n.right=t+i,n.bottom=e+s,n.width=i,n.height=s}function lo(n,t,e,i){const s=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;on(c.start)&&(o=c.start),l.fullSize?On(l,s.left,o,e.outerWidth-s.right-s.left,h):On(l,t.left+c.placed,o,u,h),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*d,h=c.size||l.width;on(c.start)&&(r=c.start),l.fullSize?On(l,r,s.top,h,e.outerHeight-s.bottom-s.top):On(l,r,t.top+c.placed,h,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var it={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const s=st(n.options.layout.padding),r=Math.max(t-s.width,0),o=Math.max(e-s.height,0),a=np(n.boxes),l=a.vertical,c=a.horizontal;N(n.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/d,hBoxMaxHeight:o/2}),h=Object.assign({},s);vl(h,st(i));const f=Object.assign({maxPadding:h,w:r,h:o,x:s.left,y:s.top},s),g=ep(l.concat(c),u);ze(a.fullSize,f,u,g),ze(l,f,u,g),ze(c,f,u,g)&&ze(l,f,u,g),sp(f),lo(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,lo(a.rightAndBottom,f,u,g),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},N(a.chartArea,p=>{const m=p.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class _l{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class op extends _l{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const ti="$chartjs",ap={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},co=n=>n===null||n==="";function lp(n,t){const e=n.style,i=n.getAttribute("height"),s=n.getAttribute("width");if(n[ti]={initial:{height:i,width:s,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",co(s)){const r=qr(n,"width");r!==void 0&&(n.width=r)}if(co(i))if(n.style.height==="")n.height=n.width/(t||2);else{const r=qr(n,"height");r!==void 0&&(n.height=r)}return n}const kl=cg?{passive:!0}:!1;function cp(n,t,e){n&&n.addEventListener(t,e,kl)}function dp(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,kl)}function up(n,t){const e=ap[n.type]||n.type,{x:i,y:s}=Qt(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:s!==void 0?s:null}}function bi(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function hp(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||bi(a.addedNodes,i),o=o&&!bi(a.removedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}function fp(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||bi(a.removedNodes,i),o=o&&!bi(a.addedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}const cn=new Map;let uo=0;function wl(){const n=window.devicePixelRatio;n!==uo&&(uo=n,cn.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function gp(n,t){cn.size||window.addEventListener("resize",wl),cn.set(n,t)}function pp(n){cn.delete(n),cn.size||window.removeEventListener("resize",wl)}function mp(n,t,e){const i=n.canvas,s=i&&Qs(i);if(!s)return;const r=Za((a,l)=>{const c=s.clientWidth;e(a,l),c<s.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||r(c,d)});return o.observe(s),gp(n,r),o}function Zi(n,t,e){e&&e.disconnect(),t==="resize"&&pp(n)}function bp(n,t,e){const i=n.canvas,s=Za(r=>{n.ctx!==null&&e(up(r,n))},n);return cp(i,t,s),s}class yp extends _l{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(lp(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[ti])return!1;const i=e[ti].initial;["height","width"].forEach(r=>{const o=i[r];D(o)?e.removeAttribute(r):e.setAttribute(r,o)});const s=i.style||{};return Object.keys(s).forEach(r=>{e.style[r]=s[r]}),e.width=e.width,delete e[ti],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),o={attach:hp,detach:fp,resize:mp}[e]||bp;s[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:Zi,detach:Zi,resize:Zi}[e]||dp)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return lg(t,e,i,s)}isAttached(t){const e=t&&Qs(t);return!!(e&&e.isConnected)}}function xp(n){return!Zs()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?op:yp}class bt{constructor(){w(this,"x");w(this,"y");w(this,"active",!1);w(this,"options");w(this,"$animations")}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return ke(this.x)&&ke(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach(r=>{s[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),s}}w(bt,"defaults",{}),w(bt,"defaultRoutes");function vp(n,t){const e=n.options.ticks,i=_p(n),s=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?wp(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>s)return Sp(t,c,r,o/s),c;const d=kp(r,t,s);if(o>0){let u,h;const f=o>1?Math.round((l-a)/(o-1)):null;for(Rn(t,c,d,D(f)?0:a-f,a),u=0,h=o-1;u<h;u++)Rn(t,c,d,r[u],r[u+1]);return Rn(t,c,d,l,D(f)?t.length:l+f),c}return Rn(t,c,d),c}function _p(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),s=n._maxLength/e;return Math.floor(Math.min(i,s))}function kp(n,t,e){const i=Mp(n),s=t.length/e;if(!i)return Math.max(s,1);const r=uf(i);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>s)return l}return Math.max(s,1)}function wp(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function Sp(n,t,e,i){let s=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<n.length;o++)o===r&&(t.push(n[o]),s++,r=e[s*i])}function Rn(n,t,e,i,s){const r=I(i,0),o=Math.min(I(s,n.length),n.length);let a=0,l,c,d;for(e=Math.ceil(e),s&&(l=s-i,e=l/Math.floor(l/e)),d=r;d<0;)a++,d=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===d&&(t.push(n[c]),a++,d=Math.round(r+a*e))}function Mp(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const Ep=n=>n==="left"?"right":n==="right"?"left":n,ho=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,fo=(n,t)=>Math.min(t||n,n);function go(n,t){const e=[],i=n.length/t,s=n.length;let r=0;for(;r<s;r+=i)e.push(n[Math.floor(r)]);return e}function Ip(n,t,e){const i=n.ticks.length,s=Math.min(t,i-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(s),c;if(!(e&&(i===1?c=Math.max(l-r,o-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<r-a||l>o+a)))return l}function Cp(n,t){N(n,e=>{const i=e.gc,s=i.length/2;let r;if(s>t){for(r=0;r<s;++r)delete e.data[i[r]];i.splice(0,s)}})}function Pe(n){return n.drawTicks?n.tickLength:0}function po(n,t){if(!n.display)return 0;const e=G(n.font,t),i=st(n.padding);return(W(n.text)?n.text.length:1)*e.lineHeight+i.height}function Lp(n,t){return qt(n,{scale:t,type:"scale"})}function Ap(n,t,e){return qt(n,{tick:e,index:t,type:"tick"})}function Dp(n,t,e){let i=qs(n);return(e&&t!=="right"||!e&&t==="right")&&(i=Ep(i)),i}function Tp(n,t,e,i){const{top:s,left:r,bottom:o,right:a,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=o-s,m=a-r;if(n.isHorizontal()){if(f=et(i,r,a),T(e)){const b=Object.keys(e)[0],y=e[b];g=d[b].getPixelForValue(y)+p-t}else e==="center"?g=(c.bottom+c.top)/2+p-t:g=ho(n,e,t);h=a-r}else{if(T(e)){const b=Object.keys(e)[0],y=e[b];f=d[b].getPixelForValue(y)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=ho(n,e,t);g=et(i,o,s),u=e==="left"?-K:K}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class fe extends bt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=dt(t,Number.POSITIVE_INFINITY),e=dt(e,Number.NEGATIVE_INFINITY),i=dt(i,Number.POSITIVE_INFINITY),s=dt(s,Number.NEGATIVE_INFINITY),{min:dt(t,i),max:dt(e,s),minDefined:Y(t),maxDefined:Y(e)}}getMinMax(t){let{min:e,max:i,minDefined:s,maxDefined:r}=this.getUserBounds(),o;if(s&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),s||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=s&&e>i?e:i,{min:dt(e,dt(i,e)),max:dt(i,dt(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){j(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=zf(this,r,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?go(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=vp(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){j(this.options.afterUpdate,[this])}beforeSetDimensions(){j(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){j(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),j(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){j(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i],r.label=j(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){j(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){j(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=fo(this.ticks.length,t.ticks.maxTicksLimit),s=e.minRotation||0,r=e.maxRotation;let o=s,a,l,c;if(!this._isVisible()||!e.display||s>=r||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=J(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Pe(t.grid)-e.padding-po(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),o=Ws(Math.min(Math.asin(J((d.highest.height+6)/a,-1,1)),Math.asin(J(l/c,-1,1))-Math.asin(J(h/c,-1,1)))),o=Math.max(s,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){j(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){j(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=po(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Pe(r)+l):(t.height=this.maxHeight,t.width=Pe(r)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=pt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*e.height):(h=i*t.height,f=s*e.width):r==="start"?f=e.width:r==="end"?h=t.width:r!=="inner"&&(h=t.width/2,f=e.width/2),this.paddingLeft=Math.max((h-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;r==="start"?(d=0,u=t.height):r==="end"&&(d=e.height,u=0),this.paddingTop=d+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){j(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)D(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=go(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:s,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/fo(e,i));let c=0,d=0,u,h,f,g,p,m,b,y,v,_,x;for(u=0;u<e;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=r[m]=r[m]||{data:{},gc:[]},y=p.lineHeight,v=_=0,!D(g)&&!W(g))v=pi(s,b.data,b.gc,v,g),_=y;else if(W(g))for(h=0,f=g.length;h<f;++h)x=g[h],!D(x)&&!W(x)&&(v=pi(s,b.data,b.gc,v,x),_+=y);o.push(v),a.push(_),c=Math.max(v,c),d=Math.max(_,d)}Cp(r,e);const k=o.indexOf(c),S=a.indexOf(d),M=E=>({width:o[E]||0,height:a[E]||0});return{first:M(0),last:M(e-1),widest:M(k),highest:M(S),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return pf(this._alignToPixels?Gt(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=Ap(this.getContext(),t,i))}return this.$context||(this.$context=Lp(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=pt(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:r,position:o,border:a}=s,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Pe(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(V){return Gt(i,V,p)};let y,v,_,x,k,S,M,E,L,A,P,Z;if(o==="top")y=b(this.bottom),S=this.bottom-h,E=y-m,A=b(t.top)+m,Z=t.bottom;else if(o==="bottom")y=b(this.top),A=t.top,Z=b(t.bottom)-m,S=y+m,E=this.top+h;else if(o==="left")y=b(this.right),k=this.right-h,M=y-m,L=b(t.left)+m,P=t.right;else if(o==="right")y=b(this.left),L=t.left,P=b(t.right)-m,k=y+m,M=this.left+h;else if(e==="x"){if(o==="center")y=b((t.top+t.bottom)/2+.5);else if(T(o)){const V=Object.keys(o)[0],X=o[V];y=b(this.chart.scales[V].getPixelForValue(X))}A=t.top,Z=t.bottom,S=y+m,E=S+h}else if(e==="y"){if(o==="center")y=b((t.left+t.right)/2);else if(T(o)){const V=Object.keys(o)[0],X=o[V];y=b(this.chart.scales[V].getPixelForValue(X))}k=y-m,M=k-h,L=t.left,P=t.right}const ct=I(s.ticks.maxTicksLimit,u),$=Math.max(1,Math.ceil(u/ct));for(v=0;v<u;v+=$){const V=this.getContext(v),X=r.setContext(V),ht=a.setContext(V),Q=X.lineWidth,ge=X.color,Sn=ht.dash||[],pe=ht.dashOffset,Ce=X.tickWidth,Yt=X.tickColor,Le=X.tickBorderDash||[],Xt=X.tickBorderDashOffset;_=Ip(this,v,l),_!==void 0&&(x=Gt(i,_,Q),c?k=M=L=P=x:S=E=A=Z=x,f.push({tx1:k,ty1:S,tx2:M,ty2:E,x1:L,y1:A,x2:P,y2:Z,width:Q,color:ge,borderDash:Sn,borderDashOffset:pe,tickWidth:Ce,tickColor:Yt,tickBorderDash:Le,tickBorderDashOffset:Xt}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=r,h=Pe(i.grid),f=h+d,g=u?-d:f,p=-pt(this.labelRotation),m=[];let b,y,v,_,x,k,S,M,E,L,A,P,Z="middle";if(s==="top")k=this.bottom-g,S=this._getXAxisLabelAlignment();else if(s==="bottom")k=this.top+g,S=this._getXAxisLabelAlignment();else if(s==="left"){const $=this._getYAxisLabelAlignment(h);S=$.textAlign,x=$.x}else if(s==="right"){const $=this._getYAxisLabelAlignment(h);S=$.textAlign,x=$.x}else if(e==="x"){if(s==="center")k=(t.top+t.bottom)/2+f;else if(T(s)){const $=Object.keys(s)[0],V=s[$];k=this.chart.scales[$].getPixelForValue(V)+f}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if(T(s)){const $=Object.keys(s)[0],V=s[$];x=this.chart.scales[$].getPixelForValue(V)}S=this._getYAxisLabelAlignment(h).textAlign}e==="y"&&(l==="start"?Z="top":l==="end"&&(Z="bottom"));const ct=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){v=a[b],_=v.label;const $=r.setContext(this.getContext(b));M=this.getPixelForTick(b)+r.labelOffset,E=this._resolveTickFontOptions(b),L=E.lineHeight,A=W(_)?_.length:1;const V=A/2,X=$.color,ht=$.textStrokeColor,Q=$.textStrokeWidth;let ge=S;o?(x=M,S==="inner"&&(b===y-1?ge=this.options.reverse?"left":"right":b===0?ge=this.options.reverse?"right":"left":ge="center"),s==="top"?c==="near"||p!==0?P=-A*L+L/2:c==="center"?P=-ct.highest.height/2-V*L+L:P=-ct.highest.height+L/2:c==="near"||p!==0?P=L/2:c==="center"?P=ct.highest.height/2-V*L:P=ct.highest.height-A*L,u&&(P*=-1),p!==0&&!$.showLabelBackdrop&&(x+=L/2*Math.sin(p))):(k=M,P=(1-A)*L/2);let Sn;if($.showLabelBackdrop){const pe=st($.backdropPadding),Ce=ct.heights[b],Yt=ct.widths[b];let Le=P-pe.top,Xt=0-pe.left;switch(Z){case"middle":Le-=Ce/2;break;case"bottom":Le-=Ce;break}switch(S){case"center":Xt-=Yt/2;break;case"right":Xt-=Yt;break;case"inner":b===y-1?Xt-=Yt:b>0&&(Xt-=Yt/2);break}Sn={left:Xt,top:Le,width:Yt+pe.width,height:Ce+pe.height,color:$.backdropColor}}m.push({label:_,font:E,textOffset:P,options:{rotation:p,color:X,strokeColor:ht,strokeWidth:Q,textAlign:ge,textBaseline:Z,translation:[x,k],backdrop:Sn}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-pt(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,d;return e==="left"?s?(d=this.right+r,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?s?(d=this.left+r,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(r=>r.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=s.length;r<o;++r){const l=s[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=Gt(t,this.left,o)-o/2,d=Gt(t,this.right,a)+a/2,u=h=l):(u=Gt(t,this.top,o)-o/2,h=Gt(t,this.bottom,a)+a/2,c=d=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&Ei(i,s);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,d=o.textOffset;le(i,c,0,d,l,a)}s&&Ii(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const r=G(i.font),o=st(i.padding),a=i.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||T(e)?(l+=o.bottom,W(i.text)&&(l+=r.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=Tp(this,l,e,a);le(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:h,textAlign:Dp(a,e,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=I(t.grid&&t.grid.z,-1),s=I(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==fe.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return G(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Bn{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;Rp(e)&&(i=this.register(e));const s=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in s||(s[r]=t,Pp(t,o,i),this.override&&U.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in U[s]&&(delete U[s][i],this.override&&delete ae[i])}}function Pp(n,t,e){const i=rn(Object.create(null),[e?U.get(e):{},U.get(t),n.defaults]);U.set(t,i),n.defaultRoutes&&Op(t,n.defaultRoutes),n.descriptors&&U.describe(t,n.descriptors)}function Op(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),s=i.pop(),r=[n].concat(i).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");U.route(r,s,l,a)})}function Rp(n){return"id"in n&&"defaults"in n}class Bp{constructor(){this.controllers=new Bn(mt,"datasets",!0),this.elements=new Bn(bt,"elements"),this.plugins=new Bn(Object,"plugins"),this.scales=new Bn(fe,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(s=>{const r=i||this._getRegistryForType(s);i||r.isForType(s)||r===this.plugins&&s.id?this._exec(t,r,s):N(s,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const s=Vs(t);j(i["before"+s],[],i),e[t](i),j(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var xt=new Bp;class Np{constructor(){this._init=void 0}notify(t,e,i,s){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,s){s=s||{};for(const r of t){const o=r.plugin,a=o[i],l=[e,s,r.options];if(j(a,l,o)===!1&&s.cancelable)return!1}return!0}invalidate(){D(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=I(i.options&&i.options.plugins,{}),r=Fp(i);return s===!1&&!e?[]:zp(t,r,s,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function Fp(n){const t={},e=[],i=Object.keys(xt.plugins.items);for(let r=0;r<i.length;r++)e.push(xt.getPlugin(i[r]));const s=n.plugins||[];for(let r=0;r<s.length;r++){const o=s[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function $p(n,t){return!t&&n===!1?null:n===!0?{}:n}function zp(n,{plugins:t,localIds:e},i,s){const r=[],o=n.getContext();for(const a of t){const l=a.id,c=$p(i[l],s);c!==null&&r.push({plugin:a,options:jp(n.config,{plugin:a,local:e[l]},c,o)})}return r}function jp(n,{plugin:t,local:e},i,s){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function xs(n,t){const e=U.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Hp(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function Vp(n,t){return n===t?"_index_":"_value_"}function mo(n){if(n==="x"||n==="y"||n==="r")return n}function Wp(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function vs(n,...t){if(mo(n))return n;for(const e of t){const i=e.axis||Wp(e.position)||n.length>1&&mo(n[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function bo(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function Up(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return bo(n,"x",e[0])||bo(n,"y",e[0])}return{}}function qp(n,t){const e=ae[n.type]||{scales:{}},i=t.scales||{},s=xs(n.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!T(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=vs(o,a,Up(o,n),U.scales[a.type]),c=Vp(l,s),d=e.scales||{};r[o]=Ye(Object.create(null),[{axis:l},a,d[l],d[c]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||xs(a,t),d=(ae[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=Hp(u,l),f=o[h+"AxisID"]||h;r[f]=r[f]||Object.create(null),Ye(r[f],[{axis:h},i[f],d[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];Ye(a,[U.scales[a.type],U.scale])}),r}function Sl(n){const t=n.options||(n.options={});t.plugins=I(t.plugins,{}),t.scales=qp(n,t)}function Ml(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Yp(n){return n=n||{},n.data=Ml(n.data),Sl(n),n}const yo=new Map,El=new Set;function Nn(n,t){let e=yo.get(n);return e||(e=t(),yo.set(n,e),El.add(e)),e}const Oe=(n,t,e)=>{const i=Wt(t,e);i!==void 0&&n.add(i)};class Xp{constructor(t){this._config=Yp(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Ml(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Sl(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Nn(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Nn(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Nn(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return Nn(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return(!s||e)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>Oe(l,t,u))),d.forEach(u=>Oe(l,s,u)),d.forEach(u=>Oe(l,ae[r]||{},u)),d.forEach(u=>Oe(l,U,u)),d.forEach(u=>Oe(l,ms,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),El.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,ae[e]||{},U.datasets[e]||{},{type:e},U,ms]}resolveNamedOptions(t,e,i,s=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=xo(this._resolverCache,t,s);let l=o;if(Gp(o,e)){r.$shared=!1,i=Ut(i)?i():i;const c=this.createResolver(t,i,a);l=we(o,i,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,i=[""],s){const{resolver:r}=xo(this._resolverCache,t,i);return T(e)?we(r,e,void 0,s):r}}function xo(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const s=e.join();let r=i.get(s);return r||(r={resolver:Ks(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,r)),r}const Kp=n=>T(n)&&Object.getOwnPropertyNames(n).some(t=>Ut(n[t]));function Gp(n,t){const{isScriptable:e,isIndexable:i}=sl(n);for(const s of t){const r=e(s),o=i(s),a=(o||r)&&n[s];if(r&&(Ut(a)||Kp(a))||o&&W(a))return!0}return!1}var Jp="4.5.1";const Zp=["top","bottom","left","right","chartArea"];function vo(n,t){return n==="top"||n==="bottom"||Zp.indexOf(n)===-1&&t==="x"}function _o(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function ko(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),j(e&&e.onComplete,[n],t)}function Qp(n){const t=n.chart,e=t.options.animation;j(e&&e.onProgress,[n],t)}function Il(n){return Zs()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const ei={},wo=n=>{const t=Il(n);return Object.values(ei).filter(e=>e.canvas===t).pop()};function tm(n,t,e){const i=Object.keys(n);for(const s of i){const r=+s;if(r>=t){const o=n[s];delete n[s],(e>0||r>t)&&(n[r+e]=o)}}}function em(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}class Ct{static register(...t){xt.add(...t),So()}static unregister(...t){xt.remove(...t),So()}constructor(t,e){const i=this.config=new Xp(e),s=Il(t),r=wo(s);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||xp(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=ef(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Np,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=xf(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],ei[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Mt.listen(this,"complete",ko),Mt.listen(this,"progress",Qp),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:r}=this;return D(t)?e&&r?r:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return xt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ur(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Hr(this.canvas,this.ctx),this}stop(){return Mt.stop(this),this}resize(t,e){Mt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Ur(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),j(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};N(e,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=vs(o,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),N(r,o=>{const a=o.options,l=a.id,c=vs(l,a),d=I(a.type,o.dtype);(a.position===void 0||vo(a.position,c)!==vo(o.dposition))&&(a.position=o.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=xt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),N(s,(o,a)=>{o||delete i[a]}),N(i,o=>{it.configure(this,o,o.options),it.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((s,r)=>s.index-r.index),i>e){for(let s=e;s<i;++s)this._destroyDatasetMeta(s);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(_o("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,s)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||xs(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=xt.getController(a),{datasetElementType:c,dataElementType:d}=U.datasets[a];Object.assign(l,{dataElementType:xt.getElement(d),datasetElementType:c&&xt.getElement(c)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){N(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&r.indexOf(u)===-1;u.buildOrUpdateElements(h),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||N(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(_o("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){N(this.scales,t=>{it.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!Pr(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:r}of e){const o=i==="_removeElements"?-r:r;tm(t,s,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),s=i(0);for(let r=1;r<e;r++)if(!Pr(s,i(r)))return;return Array.from(s).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;it.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],N(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,r)=>{s._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,Ut(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Mt.has(this)?this.attached&&!Mt.running(this)&&Mt.start(this):(this.draw(),ko({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,r;for(s=0,r=e.length;s<r;++s){const o=e[s];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=pl(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&Ei(e,s),t.controller.draw(),s&&Ii(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Dt(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const r=Zg.modes[e];return typeof r=="function"?r(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter(r=>r&&r._dataset===e).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=qt(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,s);on(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Mt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Hr(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete ei[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},s=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};N(this.options.events,r=>i(r,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,s("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){N(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},N(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!hi(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const s=this.options.hover,r=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:r}=this,o=e,a=this._getActiveElements(t,s,i,o),l=lf(t),c=em(t,this._lastEvent,i,l);i&&(this._lastEvent=null,j(r.onHover,[t,a,this],this),l&&j(r.onClick,[t,a,this],this));const d=!hi(a,s);return(d||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=c,d}_getActiveElements(t,e,i,s){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,s)}}w(Ct,"defaults",U),w(Ct,"instances",ei),w(Ct,"overrides",ae),w(Ct,"registry",xt),w(Ct,"version",Jp),w(Ct,"getChart",wo);function So(){return N(Ct.instances,n=>n._plugins.invalidate())}function nm(n,t,e){const{startAngle:i,x:s,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/o,nt(i-e));if(n.beginPath(),n.arc(s,r,o-c/2,i+u/2,e-u/2),a>0){const h=Math.min(c/a,nt(i-e));n.arc(s,r,a+c/2,e-h/2,i+h/2,!0)}else{const h=Math.min(c/2,o*nt(i-e));if(d==="round")n.arc(s,r,h,e-R/2,i+R/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(e+R/2)+s,p=-f*Math.sin(e+R/2)+r,m=f*Math.cos(i+R/2)+s,b=f*Math.sin(i+R/2)+r;n.lineTo(g,p),n.lineTo(m,b)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function im(n,t,e){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=s/a;n.beginPath(),n.arc(r,o,a,i-c,e+c),l>s?(c=s/l,n.arc(r,o,l,e+c,i-c,!0)):n.arc(r,o,s,e+K,i-K),n.closePath(),n.clip()}function sm(n){return Xs(n,["outerStart","outerEnd","innerStart","innerEnd"])}function rm(n,t,e,i){const s=sm(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=l=>{const c=(e-Math.min(r,l))*i/2;return J(l,0,Math.min(r,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:J(s.innerStart,0,o),innerEnd:J(s.innerEnd,0,o)}}function be(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function yi(n,t,e,i,s,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+e-c,0),h=d>0?d+i+e+c:0;let f=0;const g=s-l;if(i){const $=d>0?d-i:0,V=u>0?u-i:0,X=($+V)/2,ht=X!==0?g*X/(X+i):g;f=(g-ht)/2}const p=Math.max(.001,g*u-e/R)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:v,outerEnd:_,innerStart:x,innerEnd:k}=rm(t,h,u,y-b),S=u-v,M=u-_,E=b+v/S,L=y-_/M,A=h+x,P=h+k,Z=b+x/A,ct=y-k/P;if(n.beginPath(),r){const $=(E+L)/2;if(n.arc(o,a,u,E,$),n.arc(o,a,u,$,L),_>0){const Q=be(M,L,o,a);n.arc(Q.x,Q.y,_,L,y+K)}const V=be(P,y,o,a);if(n.lineTo(V.x,V.y),k>0){const Q=be(P,ct,o,a);n.arc(Q.x,Q.y,k,y+K,ct+Math.PI)}const X=(y-k/h+(b+x/h))/2;if(n.arc(o,a,h,y-k/h,X,!0),n.arc(o,a,h,X,b+x/h,!0),x>0){const Q=be(A,Z,o,a);n.arc(Q.x,Q.y,x,Z+Math.PI,b-K)}const ht=be(S,b,o,a);if(n.lineTo(ht.x,ht.y),v>0){const Q=be(S,E,o,a);n.arc(Q.x,Q.y,v,b-K,E)}}else{n.moveTo(o,a);const $=Math.cos(E)*u+o,V=Math.sin(E)*u+a;n.lineTo($,V);const X=Math.cos(L)*u+o,ht=Math.sin(L)*u+a;n.lineTo(X,ht)}n.closePath()}function om(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){yi(n,t,e,i,l,s);for(let c=0;c<r;++c)n.fill();isNaN(a)||(l=o+(a%H||H))}return yi(n,t,e,i,l,s),n.fill(),l}function am(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=h,g?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let p=t.endAngle;if(r){yi(n,t,e,i,p,s);for(let m=0;m<r;++m)n.stroke();isNaN(a)||(p=o+(a%H||H))}g&&im(n,t,p),l.selfJoin&&p-o>=R&&f===0&&d!=="miter"&&nm(n,t,p),r||(yi(n,t,e,i,p,s),n.stroke())}class je extends bt{constructor(e){super();w(this,"circumference");w(this,"endAngle");w(this,"fullCircles");w(this,"innerRadius");w(this,"outerRadius");w(this,"pixelMargin");w(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,i,s){const r=this.getProps(["x","y"],s),{angle:o,distance:a}=Xa(r,{x:e,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=I(h,c-l),p=an(o,l,c)&&l!==c,m=g>=H||p,b=Lt(a,d+f,u+f);return m&&b}getCenterPoint(e){const{x:i,y:s,startAngle:r,endAngle:o,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(r+o)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:i,circumference:s}=this,r=(i.offset||0)/4,o=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>H?Math.floor(s/H):0,s===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*r,Math.sin(l)*r);const c=1-Math.sin(Math.min(R,s||0)),d=r*c;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,om(e,this,d,o,a),am(e,this,d,o,a),e.restore()}}w(je,"id","arc"),w(je,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),w(je,"defaultRoutes",{backgroundColor:"backgroundColor"}),w(je,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function Cl(n,t,e=t){n.lineCap=I(e.borderCapStyle,t.borderCapStyle),n.setLineDash(I(e.borderDash,t.borderDash)),n.lineDashOffset=I(e.borderDashOffset,t.borderDashOffset),n.lineJoin=I(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=I(e.borderWidth,t.borderWidth),n.strokeStyle=I(e.borderColor,t.borderColor)}function lm(n,t,e){n.lineTo(e.x,e.y)}function cm(n){return n.stepped?Df:n.tension||n.cubicInterpolationMode==="monotone"?Tf:lm}function Ll(n,t,e={}){const i=n.length,{start:s=0,end:r=i-1}=e,{start:o,end:a}=t,l=Math.max(s,o),c=Math.min(r,a),d=s<o&&r<o||s>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function dm(n,t,e,i){const{points:s,options:r}=t,{count:o,start:a,loop:l,ilen:c}=Ll(s,e,i),d=cm(r);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%o],!g.skip&&(u?(n.moveTo(g.x,g.y),u=!1):d(n,p,g,h,r.stepped),p=g);return l&&(g=s[(a+(h?c:0))%o],d(n,p,g,h,r.stepped)),!!l}function um(n,t,e,i){const s=t.points,{count:r,start:o,ilen:a}=Ll(s,e,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=_=>(o+(c?a-_:_))%r,v=()=>{p!==m&&(n.lineTo(d,m),n.lineTo(d,p),n.lineTo(d,b))};for(l&&(f=s[y(0)],n.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const _=f.x,x=f.y,k=_|0;k===g?(x<p?p=x:x>m&&(m=x),d=(u*d+_)/++u):(v(),n.lineTo(_,x),g=k,u=0,p=m=x),b=x}v()}function _s(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?um:dm}function hm(n){return n.stepped?dg:n.tension||n.cubicInterpolationMode==="monotone"?ug:te}function fm(n,t,e,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,e,i)&&s.closePath()),Cl(n,t.options),n.stroke(s)}function gm(n,t,e,i){const{segments:s,options:r}=t,o=_s(t);for(const a of s)Cl(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const pm=typeof Path2D=="function";function mm(n,t,e,i){pm&&!t.options.segment?fm(n,t,e,i):gm(n,t,e,i)}class $t extends bt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;ng(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=bg(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],r=this.points,o=gl(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],l=hm(i);let c,d;for(c=0,d=o.length;c<d;++c){const{start:u,end:h}=o[c],f=r[u],g=r[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[e])/(g[e]-f[e])),m=l(f,g,p,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return _s(this)(t,this,e,i)}path(t,e,i){const s=this.segments,r=_s(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),mm(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}w($t,"id","line"),w($t,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),w($t,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),w($t,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function Mo(n,t,e,i){const s=n.options,{[e]:r}=n.getProps([e],i);return Math.abs(t-r)<s.radius+s.hitRadius}class ni extends bt{constructor(e){super();w(this,"parsed");w(this,"skip");w(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,s){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],s);return Math.pow(e-o,2)+Math.pow(i-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,i){return Mo(this,e,"x",i)}inYRange(e,i){return Mo(this,e,"y",i)}getCenterPoint(e){const{x:i,y:s}=this.getProps(["x","y"],e);return{x:i,y:s}}size(e){e=e||this.options||{};let i=e.radius||0;i=Math.max(i,i&&e.hoverRadius||0);const s=i&&e.borderWidth||0;return(i+s)*2}draw(e,i){const s=this.options;this.skip||s.radius<.1||!Dt(this,i,this.size(s)/2)||(e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.fillStyle=s.backgroundColor,bs(e,s,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}w(ni,"id","point"),w(ni,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),w(ni,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Al(n,t){const{x:e,y:i,base:s,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return n.horizontal?(u=o/2,a=Math.min(e,s),l=Math.max(e,s),c=i-u,d=i+u):(u=r/2,a=e-u,l=e+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function zt(n,t,e,i){return n?0:J(t,e,i)}function bm(n,t,e){const i=n.options.borderWidth,s=n.borderSkipped,r=il(i);return{t:zt(s.top,r.top,0,e),r:zt(s.right,r.right,0,t),b:zt(s.bottom,r.bottom,0,e),l:zt(s.left,r.left,0,t)}}function ym(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),s=n.options.borderRadius,r=re(s),o=Math.min(t,e),a=n.borderSkipped,l=i||T(s);return{topLeft:zt(!l||a.top||a.left,r.topLeft,0,o),topRight:zt(!l||a.top||a.right,r.topRight,0,o),bottomLeft:zt(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:zt(!l||a.bottom||a.right,r.bottomRight,0,o)}}function xm(n){const t=Al(n),e=t.right-t.left,i=t.bottom-t.top,s=bm(n,e/2,i/2),r=ym(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+s.l,y:t.top+s.t,w:e-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}function Qi(n,t,e,i){const s=t===null,r=e===null,a=n&&!(s&&r)&&Al(n,i);return a&&(s||Lt(t,a.left,a.right))&&(r||Lt(e,a.top,a.bottom))}function vm(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function _m(n,t){n.rect(t.x,t.y,t.w,t.h)}function ts(n,t,e={}){const i=n.x!==e.x?-t:0,s=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-i,o=(n.y+n.h!==e.y+e.h?t:0)-s;return{x:n.x+i,y:n.y+s,w:n.w+r,h:n.h+o,radius:n.radius}}class ii extends bt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:r,outer:o}=xm(this),a=vm(o.radius)?ln:_m;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,ts(o,e,r)),t.clip(),a(t,ts(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,ts(r,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return Qi(this,t,e,i)}inXRange(t,e){return Qi(this,t,null,e)}inYRange(t,e){return Qi(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+s)/2:e,y:r?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}w(ii,"id","bar"),w(ii,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),w(ii,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var km=Object.freeze({__proto__:null,ArcElement:je,BarElement:ii,LineElement:$t,PointElement:ni});const ks=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],Eo=ks.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function Dl(n){return ks[n%ks.length]}function Tl(n){return Eo[n%Eo.length]}function wm(n,t){return n.borderColor=Dl(t),n.backgroundColor=Tl(t),++t}function Sm(n,t){return n.backgroundColor=n.data.map(()=>Dl(t++)),t}function Mm(n,t){return n.backgroundColor=n.data.map(()=>Tl(t++)),t}function Em(n){let t=0;return(e,i)=>{const s=n.getDatasetMeta(i).controller;s instanceof se?t=Sm(e,t):s instanceof Je?t=Mm(e,t):s&&(t=wm(e,t))}}function Io(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function Im(n){return n&&(n.borderColor||n.backgroundColor)}function Cm(){return U.borderColor!=="rgba(0,0,0,0.1)"||U.backgroundColor!=="rgba(0,0,0,0.1)"}var Lm={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:s}=n.config,{elements:r}=s,o=Io(i)||Im(s)||r&&Io(r)||Cm();if(!e.forceOverride&&o)return;const a=Em(n);i.forEach(a)}};function Am(n,t,e,i,s){const r=s.samples||i;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let d=t,u,h,f,g,p;for(o[l++]=n[d],u=0;u<r-2;u++){let m=0,b=0,y;const v=Math.floor((u+1)*a)+1+t,_=Math.min(Math.floor((u+2)*a)+1,e)+t,x=_-v;for(y=v;y<_;y++)m+=n[y].x,b+=n[y].y;m/=x,b/=x;const k=Math.floor(u*a)+1+t,S=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:M,y:E}=n[d];for(f=g=-1,y=k;y<S;y++)g=.5*Math.abs((M-m)*(n[y].y-E)-(M-n[y].x)*(b-E)),g>f&&(f=g,h=n[y],p=y);o[l++]=h,d=p}return o[l++]=n[c],o}function Dm(n,t,e,i){let s=0,r=0,o,a,l,c,d,u,h,f,g,p;const m=[],b=t+e-1,y=n[t].x,_=n[b].x-y;for(o=t;o<t+e;++o){a=n[o],l=(a.x-y)/_*i,c=a.y;const x=l|0;if(x===d)c<g?(g=c,u=o):c>p&&(p=c,h=o),s=(r*s+a.x)/++r;else{const k=o-1;if(!D(u)&&!D(h)){const S=Math.min(u,h),M=Math.max(u,h);S!==f&&S!==k&&m.push({...n[S],x:s}),M!==f&&M!==k&&m.push({...n[M],x:s})}o>0&&k!==f&&m.push(n[k]),m.push(a),d=x,r=0,g=p=c,u=h=f=o}}return m}function Pl(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function Co(n){n.data.datasets.forEach(t=>{Pl(t)})}function Tm(n,t){const e=t.length;let i=0,s;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(i=J(At(t,r.axis,o).lo,0,e-1)),c?s=J(At(t,r.axis,a).hi+1,i,e)-i:s=e-i,{start:i,count:s}}var Pm={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){Co(n);return}const i=n.width;n.data.datasets.forEach((s,r)=>{const{_data:o,indexAxis:a}=s,l=n.getDatasetMeta(r),c=o||s.data;if($e([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:h}=Tm(l,c);const f=e.threshold||4*i;if(h<=f){Pl(s);return}D(o)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=Am(c,u,h,i,e);break;case"min-max":g=Dm(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}s._decimated=g})},destroy(n){Co(n)}};function Om(n,t,e){const i=n.segments,s=n.points,r=t.points,o=[];for(const a of i){let{start:l,end:c}=a;c=Ai(l,c,s);const d=ws(e,s[l],s[c],a.loop);if(!t.segments){o.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=gl(t,d);for(const h of u){const f=ws(e,r[h.start],r[h.end],h.loop),g=fl(a,s,f);for(const p of g)o.push({source:p,target:h,start:{[e]:Lo(d,f,"start",Math.max)},end:{[e]:Lo(d,f,"end",Math.min)}})}}return o}function ws(n,t,e,i){if(i)return;let s=t[n],r=e[n];return n==="angle"&&(s=nt(s),r=nt(r)),{property:n,start:s,end:r}}function Rm(n,t){const{x:e=null,y:i=null}=n||{},s=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Ai(o,a,s);const l=s[o],c=s[a];i!==null?(r.push({x:l.x,y:i}),r.push({x:c.x,y:i})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Ai(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function Lo(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function Ol(n,t){let e=[],i=!1;return W(n)?(i=!0,e=n):e=Rm(n,t),e.length?new $t({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function Ao(n){return n&&n.fill!==!1}function Bm(n,t,e){let s=n[t].fill;const r=[t];let o;if(!e)return s;for(;s!==!1&&r.indexOf(s)===-1;){if(!Y(s))return s;if(o=n[s],!o)return!1;if(o.visible)return s;r.push(s),s=o.fill}return!1}function Nm(n,t,e){const i=jm(n);if(T(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return Y(s)&&Math.floor(s)===s?Fm(i[0],t,s,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Fm(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function $m(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:T(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function zm(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:T(n)?i=n.value:i=t.getBaseValue(),i}function jm(n){const t=n.options,e=t.fill;let i=I(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Hm(n){const{scale:t,index:e,line:i}=n,s=[],r=i.segments,o=i.points,a=Vm(t,e);a.push(Ol({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const c=r[l];for(let d=c.start;d<=c.end;d++)Wm(s,o[d],a)}return new $t({points:s,options:{}})}function Vm(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const r=i[s];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function Wm(n,t,e){const i=[];for(let s=0;s<e.length;s++){const r=e[s],{first:o,last:a,point:l}=Um(r,t,"x");if(!(!l||o&&a)){if(o)i.unshift(l);else if(n.push(l),!a)break}}n.push(...i)}function Um(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const s=i[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const d=r[c],u=o[d.start][e],h=o[d.end][e];if(Lt(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Rl{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:r,radius:o}=this;return e=e||{start:0,end:H},t.arc(s,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,r=t.angle;return{x:e+Math.cos(r)*s,y:i+Math.sin(r)*s,angle:r}}}function qm(n){const{chart:t,fill:e,line:i}=n;if(Y(e))return Ym(t,e);if(e==="stack")return Hm(n);if(e==="shape")return!0;const s=Xm(n);return s instanceof Rl?s:Ol(s,i)}function Ym(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function Xm(n){return(n.scale||{}).getPointPositionForValue?Gm(n):Km(n)}function Km(n){const{scale:t={},fill:e}=n,i=$m(e,t);if(Y(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function Gm(n){const{scale:t,fill:e}=n,i=t.options,s=t.getLabels().length,r=i.reverse?t.max:t.min,o=zm(e,t,r),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,r);return new Rl({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,o));return a}function es(n,t,e){const i=qm(t),{chart:s,index:r,line:o,scale:a,axis:l}=t,c=o.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(r),p=pl(s,g);i&&o.points.length&&(Ei(n,e),Jm(n,{line:o,target:i,above:h,below:f,area:e,scale:a,axis:l,clip:p}),Ii(n))}function Jm(n,t){const{line:e,target:i,above:s,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=r;r!==s&&(c==="x"?(Do(n,i,o.top),ns(n,{line:e,target:i,color:s,scale:a,property:c,clip:l}),n.restore(),n.save(),Do(n,i,o.bottom)):c==="y"&&(To(n,i,o.left),ns(n,{line:e,target:i,color:r,scale:a,property:c,clip:l}),n.restore(),n.save(),To(n,i,o.right),d=s)),ns(n,{line:e,target:i,color:d,scale:a,property:c,clip:l}),n.restore()}function Do(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Ai(l,c,s)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function To(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Ai(l,c,s)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function ns(n,t){const{line:e,target:i,property:s,color:r,scale:o,clip:a}=t,l=Om(e,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=r}={}}=c,g=i!==!0;n.save(),n.fillStyle=f,Zm(n,o,a,g&&ws(s,u,h)),n.beginPath();const p=!!e.pathSegment(n,c);let m;if(g){p?n.closePath():Po(n,i,h,s);const b=!!i.pathSegment(n,d,{move:p,reverse:!0});m=p&&b,m||Po(n,i,u,s)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function Zm(n,t,e,i){const s=t.chart.chartArea,{property:r,start:o,end:a}=i||{};if(r==="x"||r==="y"){let l,c,d,u;r==="x"?(l=o,c=s.top,d=a,u=s.bottom):(l=s.left,c=o,d=s.right,u=a),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function Po(n,t,e,i){const s=t.interpolate(e,i);s&&n.lineTo(s.x,s.y)}var Qm={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,s=[];let r,o,a,l;for(o=0;o<i;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof $t&&(l={visible:n.isDatasetVisible(o),index:o,fill:Nm(a,o,i),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,s.push(l);for(o=0;o<i;++o)l=s[o],!(!l||l.fill===!1)&&(l.fill=Bm(s,o,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",s=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=s.length-1;o>=0;--o){const a=s[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&es(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const r=i[s].$filler;Ao(r)&&es(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!Ao(i)||e.drawTime!=="beforeDatasetDraw"||es(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Oo=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},t0=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Ro extends bt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=j(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=G(i.font),r=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Oo(i,r);let c,d;e.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,r,a,l)+10):(d=this.maxHeight,c=this._fitCols(o,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+e/2+r.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>o)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,e,i,s){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:v}=e0(i,e,r,m,s);b>0&&f+v+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:v},h=Math.max(h,y),f+=v+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:r}}=this,o=_e(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=et(i,this.left+s,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=et(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+s}else{let a=0,l=et(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=et(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Ei(t,this),this._draw(),Ii(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:r,labels:o}=t,a=U.color,l=_e(t.rtl,this.left,this.width),c=G(o.font),{padding:d}=o,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=Oo(o,u),b=function(k,S,M){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const E=I(M.lineWidth,1);if(s.fillStyle=I(M.fillStyle,a),s.lineCap=I(M.lineCap,"butt"),s.lineDashOffset=I(M.lineDashOffset,0),s.lineJoin=I(M.lineJoin,"miter"),s.lineWidth=E,s.strokeStyle=I(M.strokeStyle,a),s.setLineDash(I(M.lineDash,[])),o.usePointStyle){const L={radius:p*Math.SQRT2/2,pointStyle:M.pointStyle,rotation:M.rotation,borderWidth:E},A=l.xPlus(k,g/2),P=S+h;nl(s,L,A,P,o.pointStyleWidth&&g)}else{const L=S+Math.max((u-p)/2,0),A=l.leftForLtr(k,g),P=re(M.borderRadius);s.beginPath(),Object.values(P).some(Z=>Z!==0)?ln(s,{x:A,y:L,w:g,h:p,radius:P}):s.rect(A,L,g,p),s.fill(),E!==0&&s.stroke()}s.restore()},y=function(k,S,M){le(s,M.text,k,S+m/2,c,{strikethrough:M.hidden,textAlign:l.textAlign(M.textAlign)})},v=this.isHorizontal(),_=this._computeTitleHeight();v?f={x:et(r,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:f={x:this.left+d,y:et(r,this.top+_+d,this.bottom-e[0].height),line:0},dl(this.ctx,t.textDirection);const x=m+d;this.legendItems.forEach((k,S)=>{s.strokeStyle=k.fontColor,s.fillStyle=k.fontColor;const M=s.measureText(k.text).width,E=l.textAlign(k.textAlign||(k.textAlign=o.textAlign)),L=g+h+M;let A=f.x,P=f.y;l.setWidth(this.width),v?S>0&&A+L+d>this.right&&(P=f.y+=x,f.line++,A=f.x=et(r,this.left+d,this.right-i[f.line])):S>0&&P+x>this.bottom&&(A=f.x=A+e[f.line].width+d,f.line++,P=f.y=et(r,this.top+_+d,this.bottom-e[f.line].height));const Z=l.x(A);if(b(Z,P,k),A=vf(E,A+g+h,v?A+L:this.right,t.rtl),y(l.x(A),P,k),v)f.x+=L+d;else if(typeof k.text!="string"){const ct=c.lineHeight;f.y+=Bl(k,ct)+d}else f.y+=x}),ul(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=G(e.font),s=st(e.padding);if(!e.display)return;const r=_e(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=et(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+et(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=et(a,u,u+h);o.textAlign=r.textAlign(qs(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,le(o,e.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,e=G(t.font),i=st(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,r;if(Lt(t,this.left,this.right)&&Lt(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(s=r[i],Lt(t,s.left,s.left+s.width)&&Lt(e,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!s0(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,r=t0(s,i);s&&!r&&j(e.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!r&&j(e.onHover,[t,i,this],this)}else i&&j(e.onClick,[t,i,this],this)}}function e0(n,t,e,i,s){const r=n0(i,n,t,e),o=i0(s,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function n0(n,t,e,i){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(s).width}function i0(n,t,e){let i=n;return typeof t.text!="string"&&(i=Bl(t,e)),i}function Bl(n,t){const e=n.text?n.text.length:0;return t*e}function s0(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var r0={id:"legend",_element:Ro,start(n,t,e){const i=n.legend=new Ro({ctx:n.ctx,options:e,chart:n});it.configure(n,i,e),it.addBox(n,i)},stop(n){it.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;it.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,s=e.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=st(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class er extends bt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const s=W(i.text)?i.text.length:1;this._padding=st(i.padding);const r=s*G(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:s,right:r,options:o}=this,a=o.align;let l=0,c,d,u;return this.isHorizontal()?(d=et(a,i,r),u=e+t,c=r-i):(o.position==="left"?(d=i+t,u=et(a,s,e),l=R*-.5):(d=r-t,u=et(a,e,s),l=R*.5),c=s-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=G(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);le(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:qs(e.align),textBaseline:"middle",translation:[o,a]})}}function o0(n,t){const e=new er({ctx:n.ctx,options:t,chart:n});it.configure(n,e,t),it.addBox(n,e),n.titleBlock=e}var a0={id:"title",_element:er,start(n,t,e){o0(n,e)},stop(n){const t=n.titleBlock;it.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;it.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Fn=new WeakMap;var l0={id:"subtitle",start(n,t,e){const i=new er({ctx:n.ctx,options:e,chart:n});it.configure(n,i,e),it.addBox(n,i),Fn.set(n,i)},stop(n){it.removeBox(n,Fn.get(n)),Fn.delete(n)},beforeUpdate(n,t,e){const i=Fn.get(n);it.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const He={average(n){if(!n.length)return!1;let t,e,i=new Set,s=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,s=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=ps(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function yt(n,t){return t&&(W(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Et(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function c0(n,t){const{element:e,datasetIndex:i,index:s}=t,r=n.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:n,label:o,parsed:r.getParsed(s),raw:n.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:e}}function Bo(n,t){const e=n.chart.ctx,{body:i,footer:s,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=G(t.bodyFont),c=G(t.titleFont),d=G(t.footerFont),u=r.length,h=s.length,f=i.length,g=st(t.padding);let p=g.height,m=0,b=i.reduce((_,x)=>_+x.before.length+x.lines.length+x.after.length,0);if(b+=n.beforeBody.length+n.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*_+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(_){m=Math.max(m,e.measureText(_).width+y)};return e.save(),e.font=c.string,N(n.title,v),e.font=l.string,N(n.beforeBody.concat(n.afterBody),v),y=t.displayColors?o+2+t.boxPadding:0,N(i,_=>{N(_.before,v),N(_.lines,v),N(_.after,v)}),y=0,e.font=d.string,N(n.footer,v),e.restore(),m+=g.width,{width:m,height:p}}function d0(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function u0(n,t,e,i){const{x:s,width:r}=i,o=e.caretSize+e.caretPadding;if(n==="left"&&s+r+o>t.width||n==="right"&&s-r-o<0)return!0}function h0(n,t,e,i){const{x:s,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=r/2?c="left":s>=o-r/2&&(c="right"),u0(c,n,t,e)&&(c="center"),c}function No(n,t,e){const i=e.yAlign||t.yAlign||d0(n,e);return{xAlign:e.xAlign||t.xAlign||h0(n,t,e,i),yAlign:i}}function f0(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function g0(n,t,e){let{y:i,height:s}=n;return t==="top"?i+=e:t==="bottom"?i-=s+e:i-=s/2,i}function Fo(n,t,e,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,c=s+r,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=re(o);let g=f0(t,a);const p=g0(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:J(g,0,i.width-t.width),y:J(p,0,i.height-t.height)}}function $n(n,t,e){const i=st(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function $o(n){return yt([],Et(n))}function p0(n,t,e){return qt(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function zo(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const Nl={beforeTitle:St,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:St,beforeBody:St,beforeLabel:St,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return D(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:St,afterBody:St,beforeFooter:St,footer:St,afterFooter:St};function ot(n,t,e,i){const s=n[t].call(e,i);return typeof s>"u"?Nl[t].call(e,i):s}class Ss extends bt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,r=new ml(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=p0(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,s=ot(i,"beforeTitle",this,t),r=ot(i,"title",this,t),o=ot(i,"afterTitle",this,t);let a=[];return a=yt(a,Et(s)),a=yt(a,Et(r)),a=yt(a,Et(o)),a}getBeforeBody(t,e){return $o(ot(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return N(t,r=>{const o={before:[],lines:[],after:[]},a=zo(i,r);yt(o.before,Et(ot(a,"beforeLabel",this,r))),yt(o.lines,ot(a,"label",this,r)),yt(o.after,Et(ot(a,"afterLabel",this,r))),s.push(o)}),s}getAfterBody(t,e){return $o(ot(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=ot(i,"beforeFooter",this,t),r=ot(i,"footer",this,t),o=ot(i,"afterFooter",this,t);let a=[];return a=yt(a,Et(s)),a=yt(a,Et(r)),a=yt(a,Et(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(c0(this.chart,e[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),N(a,d=>{const u=zo(t.callbacks,d);s.push(ot(u,"labelColor",this,d)),r.push(ot(u,"labelPointStyle",this,d)),o.push(ot(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let r,o=[];if(!s.length)this.opacity!==0&&(r={opacity:0});else{const a=He[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=Bo(this,i),c=Object.assign({},a,l),d=No(this.chart,i,c),u=Fo(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const r=this.getCaretPosition(t,i,s);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=re(a),{x:h,y:f}=t,{width:g,height:p}=e;let m,b,y,v,_,x;return r==="center"?(_=f+p/2,s==="left"?(m=h,b=m-o,v=_+o,x=_-o):(m=h+g,b=m+o,v=_-o,x=_+o),y=m):(s==="left"?b=h+Math.max(l,d)+o:s==="right"?b=h+g-Math.max(c,u)-o:b=this.caretX,r==="top"?(v=f,_=v-o,m=b-o,y=b+o):(v=f+p,_=v+o,m=b+o,y=b-o),x=v),{x1:m,x2:b,x3:y,y1:v,y2:_,y3:x}}drawTitle(t,e,i){const s=this.title,r=s.length;let o,a,l;if(r){const c=_e(i.rtl,this.x,this.width);for(t.x=$n(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",o=G(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(s[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=r,d=G(r.bodyFont),u=$n(this,"left",r),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=e.y+f;if(r.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,bs(t,p,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,bs(t,p,m,b)}else{t.lineWidth=T(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=re(o.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,ln(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),ln(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=G(i.bodyFont);let h=u.lineHeight,f=0;const g=_e(i.rtl,this.x,this.width),p=function(M){e.fillText(M,g.x(t.x+f),t.y+h/2),t.y+=h+r},m=g.textAlign(o);let b,y,v,_,x,k,S;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=$n(this,m,i),e.fillStyle=i.bodyColor,N(this.beforeBody,p),f=a&&m!=="right"?o==="center"?c/2+d:c+2+d:0,_=0,k=s.length;_<k;++_){for(b=s[_],y=this.labelTextColors[_],e.fillStyle=y,N(b.before,p),v=b.lines,a&&v.length&&(this._drawColorBox(e,t,_,g,i),h=Math.max(u.lineHeight,l)),x=0,S=v.length;x<S;++x)p(v[x]),h=u.lineHeight;N(b.after,p)}f=0,h=u.lineHeight,N(this.afterBody,p),t.y-=r}drawFooter(t,e,i){const s=this.footer,r=s.length;let o,a;if(r){const l=_e(i.rtl,this.x,this.width);for(t.x=$n(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=G(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(s[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=re(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,i,s),e.lineTo(a+c-h,l),e.quadraticCurveTo(a+c,l,a+c,l+h),o==="center"&&r==="right"&&this.drawCaret(t,e,i,s),e.lineTo(a+c,l+d-g),e.quadraticCurveTo(a+c,l+d,a+c-g,l+d),o==="bottom"&&this.drawCaret(t,e,i,s),e.lineTo(a+f,l+d),e.quadraticCurveTo(a,l+d,a,l+d-f),o==="center"&&r==="left"&&this.drawCaret(t,e,i,s),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,r=i&&i.y;if(s||r){const o=He[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=Bo(this,t),l=Object.assign({},o,this._size),c=No(e,t,l),d=Fo(t,l,c,e);(s._to!==d.x||r._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=st(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,s,e),dl(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),ul(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!hi(i,s),o=this._positionChanged(s,e);(r||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),l=e||!hi(o,r)||a;return l&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,s){const r=this.options;if(t.type==="mouseout")return[];if(!s)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:r}=this,o=He[r.position].call(this,t,e);return o!==!1&&(i!==o.x||s!==o.y)}}w(Ss,"positioners",He);var m0={id:"tooltip",_element:Ss,positioners:He,afterInit(n,t,e){e&&(n.tooltip=new Ss({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Nl},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},b0=Object.freeze({__proto__:null,Colors:Lm,Decimation:Pm,Filler:Qm,Legend:r0,SubTitle:l0,Title:a0,Tooltip:m0});const y0=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function x0(n,t,e,i){const s=n.indexOf(t);if(s===-1)return y0(n,t,e,i);const r=n.lastIndexOf(t);return s!==r?e:s}const v0=(n,t)=>n===null?null:J(Math.round(n),0,t);function jo(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class Ms extends fe{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:s,label:r}of e)i[s]===r&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(D(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:x0(i,t,I(e,t),this._addedLabels),v0(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)s.push({value:o});return s}getLabelForValue(t){return jo.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}w(Ms,"id","category"),w(Ms,"defaults",{ticks:{callback:jo}});function _0(n,t){const e=[],{bounds:s,step:r,min:o,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=n,f=r||1,g=d-1,{min:p,max:m}=t,b=!D(o),y=!D(a),v=!D(c),_=(m-p)/(u+1);let x=Rr((m-p)/g/f)*f,k,S,M,E;if(x<1e-14&&!b&&!y)return[{value:p},{value:m}];E=Math.ceil(m/x)-Math.floor(p/x),E>g&&(x=Rr(E*x/g/f)*f),D(l)||(k=Math.pow(10,l),x=Math.ceil(x*k)/k),s==="ticks"?(S=Math.floor(p/x)*x,M=Math.ceil(m/x)*x):(S=p,M=m),b&&y&&r&&ff((a-o)/r,x/1e3)?(E=Math.round(Math.min((a-o)/x,d)),x=(a-o)/E,S=o,M=a):v?(S=b?o:S,M=y?a:M,E=c-1,x=(M-S)/E):(E=(M-S)/x,Xe(E,Math.round(E),x/1e3)?E=Math.round(E):E=Math.ceil(E));const L=Math.max(Br(x),Br(S));k=Math.pow(10,D(l)?L:l),S=Math.round(S*k)/k,M=Math.round(M*k)/k;let A=0;for(b&&(h&&S!==o?(e.push({value:o}),S<o&&A++,Xe(Math.round((S+A*x)*k)/k,o,Ho(o,_,n))&&A++):S<o&&A++);A<E;++A){const P=Math.round((S+A*x)*k)/k;if(y&&P>a)break;e.push({value:P})}return y&&h&&M!==a?e.length&&Xe(e[e.length-1].value,a,Ho(a,_,n))?e[e.length-1].value=a:e.push({value:a}):(!y||M===a)&&e.push({value:M}),e}function Ho(n,t,{horizontal:e,minRotation:i}){const s=pt(i),r=(e?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class xi extends fe{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return D(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:r}=this;const o=l=>s=e?s:l,a=l=>r=i?r:l;if(t){const l=_t(s),c=_t(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(s===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(s-l)}this.min=s,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),e=e||11),e&&(s=Math.min(e,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=_0(s,r);return t.bounds==="ticks"&&Ya(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return wn(t,this.chart.options.locale,this.options.ticks.format)}}class Es extends xi{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Y(t)?t:0,this.max=Y(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=pt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}w(Es,"id","linear"),w(Es,"defaults",{ticks:{callback:Mi.formatters.numeric}});const dn=n=>Math.floor(Nt(n)),Zt=(n,t)=>Math.pow(10,dn(n)+t);function Vo(n){return n/Math.pow(10,dn(n))===1}function Wo(n,t,e){const i=Math.pow(10,e),s=Math.floor(n/i);return Math.ceil(t/i)-s}function k0(n,t){const e=t-n;let i=dn(e);for(;Wo(n,t,i)>10;)i++;for(;Wo(n,t,i)<10;)i--;return Math.min(i,dn(n))}function w0(n,{min:t,max:e}){t=dt(n.min,t);const i=[],s=dn(t);let r=k0(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=s>r?Math.pow(10,s):0,c=Math.round((t-l)*o)/o,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,r)),h=dt(n.min,Math.round((l+d+u*Math.pow(10,r))*o)/o);for(;h<e;)i.push({value:h,major:Vo(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),h=Math.round((l+d+u*Math.pow(10,r))*o)/o;const f=dt(n.max,h);return i.push({value:f,major:Vo(f),significand:u}),i}class Is extends fe{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=xi.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return Y(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=Y(t)?Math.max(0,t):null,this.max=Y(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!Y(this._userMin)&&(this.min=t===Zt(this.min,0)?Zt(this.min,-1):Zt(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const r=a=>i=t?i:a,o=a=>s=e?s:a;i===s&&(i<=0?(r(1),o(10)):(r(Zt(i,-1)),o(Zt(s,1)))),i<=0&&r(Zt(s,-1)),s<=0&&o(Zt(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=w0(e,this);return t.bounds==="ticks"&&Ya(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":wn(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Nt(t),this._valueRange=Nt(this.max)-Nt(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Nt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}w(Is,"id","logarithmic"),w(Is,"defaults",{ticks:{callback:Mi.formatters.logarithmic,major:{enabled:!0}}});function Cs(n){const t=n.ticks;if(t.display&&n.display){const e=st(t.backdropPadding);return I(t.font&&t.font.size,U.font.size)+e.height}return 0}function S0(n,t,e){return e=W(e)?e:[e],{w:Af(n,t.string,e),h:e.length*t.lineHeight}}function Uo(n,t,e,i,s){return n===i||n===s?{start:t-e/2,end:t+e/2}:n<i||n>s?{start:t-e,end:t}:{start:t,end:t+e}}function M0(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],s=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?R/r:0;for(let l=0;l<r;l++){const c=o.setContext(n.getPointLabelContext(l));s[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+s[l],a),u=G(c.font),h=S0(n.ctx,u,n._pointLabels[l]);i[l]=h;const f=nt(n.getIndexAngle(l)+a),g=Math.round(Ws(f)),p=Uo(g,d.x,h.w,0,180),m=Uo(g,d.y,h.h,90,270);E0(e,t,f,p,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=L0(n,i,s)}function E0(n,t,e,i,s){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,n.l=Math.min(n.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/o,n.t=Math.min(n.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function I0(n,t,e){const i=n.drawingArea,{extra:s,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,i+s+o,r),c=Math.round(Ws(nt(l.angle+K))),d=T0(l.y,a.h,c),u=A0(c),h=D0(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function C0(n,t){if(!t)return!0;const{left:e,top:i,right:s,bottom:r}=n;return!(Dt({x:e,y:i},t)||Dt({x:e,y:r},t)||Dt({x:s,y:i},t)||Dt({x:s,y:r},t))}function L0(n,t,e){const i=[],s=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:Cs(r)/2,additionalAngle:o?R/s:0};let c;for(let d=0;d<s;d++){l.padding=e[d],l.size=t[d];const u=I0(n,d,l);i.push(u),a==="auto"&&(u.visible=C0(u,c),u.visible&&(c=u))}return i}function A0(n){return n===0||n===180?"center":n<180?"left":"right"}function D0(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function T0(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function P0(n,t,e){const{left:i,top:s,right:r,bottom:o}=e,{backdropColor:a}=t;if(!D(a)){const l=re(t.borderRadius),c=st(t.backdropPadding);n.fillStyle=a;const d=i-c.left,u=s-c.top,h=r-i+c.width,f=o-s+c.height;Object.values(l).some(g=>g!==0)?(n.beginPath(),ln(n,{x:d,y:u,w:h,h:f,radius:l}),n.fill()):n.fillRect(d,u,h,f)}}function O0(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let s=t-1;s>=0;s--){const r=n._pointLabelItems[s];if(!r.visible)continue;const o=i.setContext(n.getPointLabelContext(s));P0(e,o,r);const a=G(o.font),{x:l,y:c,textAlign:d}=r;le(e,n._pointLabels[s],l,c+a.lineHeight/2,a,{color:o.color,textAlign:d,textBaseline:"middle"})}}function Fl(n,t,e,i){const{ctx:s}=n;if(e)s.arc(n.xCenter,n.yCenter,t,0,H);else{let r=n.getPointPosition(0,t);s.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=n.getPointPosition(o,t),s.lineTo(r.x,r.y)}}function R0(n,t,e,i,s){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(s.dash||[]),r.lineDashOffset=s.dashOffset,r.beginPath(),Fl(n,e,o,i),r.closePath(),r.stroke(),r.restore())}function B0(n,t,e){return qt(n,{label:e,index:t,type:"pointLabel"})}class Ve extends xi{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=st(Cs(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=Y(t)&&!isNaN(t)?t:0,this.max=Y(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Cs(this.options))}generateTickLabels(t){xi.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const s=j(this.options.pointLabels.callback,[e,i],this);return s||s===0?s:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?M0(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){const e=H/(this._pointLabels.length||1),i=this.options.startAngle||0;return nt(t*e+pt(i))}getDistanceFromCenterForValue(t){if(D(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(D(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return B0(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-K+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Fl(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&O0(this,o),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=r.setContext(h);R0(this,f,l,o,g)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),d=G(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=st(c.backdropPadding);t.fillRect(-o/2-u.left,-r-d.size/2-u.top,o+u.width,d.size+u.height)}le(t,a.label,0,-r,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}w(Ve,"id","radialLinear"),w(Ve,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Mi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),w(Ve,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),w(Ve,"descriptors",{angleLines:{_fallback:"grid"}});const Di={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},at=Object.keys(Di);function qo(n,t){return n-t}function Yo(n,t){if(D(t))return null;const e=n._adapter,{parser:i,round:s,isoWeekday:r}=n._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),Y(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(s&&(o=s==="week"&&(ke(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,s)),+o)}function Xo(n,t,e,i){const s=at.length;for(let r=at.indexOf(n);r<s-1;++r){const o=Di[at[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return at[r]}return at[s-1]}function N0(n,t,e,i,s){for(let r=at.length-1;r>=at.indexOf(e);r--){const o=at[r];if(Di[o].common&&n._adapter.diff(s,i,o)>=t-1)return o}return at[e?at.indexOf(e):0]}function F0(n){for(let t=at.indexOf(n)+1,e=at.length;t<e;++t)if(Di[at[t]].common)return at[t]}function Ko(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:s}=Us(e,t),r=e[i]>=t?e[i]:e[s];n[r]=!0}}function $0(n,t,e,i){const s=n._adapter,r=+s.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,i))l=e[a],l>=0&&(t[l].major=!0);return t}function Go(n,t,e){const i=[],s={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],s[a]=o,i.push({value:a,major:!1});return r===0||!e?i:$0(n,i,s,e)}class un extends fe{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new Yg._date(t.adapters.date);s.init(e),Ye(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Yo(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=Y(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),r=Y(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,r-1),this.max=Math.max(s+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const r=this.min,o=this.max,a=bf(s,r,o);return this._unit=e.unit||(i.autoSkip?Xo(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):N0(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:F0(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Go(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,s,r;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?e=1-s:e=(this.getDecimalForValue(t[1])-s)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=J(e,0,o),i=J(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,r=s.time,o=r.unit||Xo(r.minUnit,e,i,this._getLabelCapacity(e)),a=I(s.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=ke(l)||l===!0,d={};let u=e,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,o),f++)Ko(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Ko(d,h,g),Object.keys(d).sort(qo).map(p=>+p)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,r=this._unit,o=e||s[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,s){const r=this.options,o=r.ticks.callback;if(o)return j(o,[t,e,i],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[e],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=pt(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,Go(this,[t],this._majorUnit),s),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(e=0,i=s.length;e<i;++e)t=t.concat(s[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(Yo(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Ga(t.sort(qo))}}w(un,"id","time"),w(un,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function zn(n,t,e){let i=0,s=n.length-1,r,o,a,l;e?(t>=n[i].pos&&t<=n[s].pos&&({lo:i,hi:s}=At(n,"pos",t)),{pos:r,time:a}=n[i],{pos:o,time:l}=n[s]):(t>=n[i].time&&t<=n[s].time&&({lo:i,hi:s}=At(n,"time",t)),{time:r,pos:a}=n[i],{time:o,pos:l}=n[s]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class Ls extends un{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=zn(e,this.min),this._tableRange=zn(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],r=[];let o,a,l,c,d;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=i&&s.push(c);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)d=s[o+1],l=s[o-1],c=s[o],Math.round((d+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((s,r)=>s-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(zn(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return zn(this._table,i*this._tableRange+this._minPos,!0)}}w(Ls,"id","timeseries"),w(Ls,"defaults",un.defaults);var z0=Object.freeze({__proto__:null,CategoryScale:Ms,LinearScale:Es,LogarithmicScale:Is,RadialLinearScale:Ve,TimeScale:un,TimeSeriesScale:Ls});const j0=[qg,km,b0,z0];Ct.register(...j0);function Ti(n,t=""){return`
        <div class="bg-white/70 dark:bg-gray-900/60 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-800/30 ${t}">
            ${n}
        </div>
    `}function $l(n,t,e,i){return Ti(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${n}</span>
        <span id="${e}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${t}</span>
    `,"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform")}function zl(n){const t=[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],e=[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500"},{id:"weekly",label:"週次推移",dot:"bg-green-500"},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],i=typeof n=="function"?n:$l;return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>

            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${t.map(s=>i(s.label,"-",s.id,s.color)).join("")}
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${e.map(s=>Ti(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${s.dot}"></span> ${s.label}
                    </h3>
                    <div class="relative flex-1 min-h-0 w-full">
                        <canvas id="${s.id}Chart"></canvas>
                    </div>
                `,`p-3 h-64 flex flex-col ${s.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function H0(n=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(n)?n:[]).map(s=>`<option value="${s.id}">${s.name}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${Ti(i,"p-8 mb-8")}
            <div id="search-results-container">
                <div class="text-center text-gray-400 py-16 flex flex-col items-center">
                    <span class="text-sm">キーワードを入力してタスクを検索</span>
                </div>
            </div>
        </div>
    `}const is={daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},jt={daily:null,weekly:null,monthly:null};function V0(n){const t=document.getElementById("dashboard-view");if(!n||!t)return;W0(),t.innerHTML=zl();const e=n.filter(s=>s.status==="completed"&&s.completedAt);Y0(e),[{id:"daily",color:is.daily,label:"日次",count:7,unit:"day"},{id:"weekly",color:is.weekly,label:"週次",count:4,unit:"week"},{id:"monthly",color:is.monthly,label:"月次",count:6,unit:"month"}].forEach(s=>{const{labels:r,data:o}=X0(e,s.count,s.unit);K0(s.id,r,o,s.color)})}function W0(){Object.keys(jt).forEach(n=>{jt[n]&&(jt[n].destroy(),jt[n]=null)})}function jl(n){if(!n)return null;if(n.toDate&&typeof n.toDate=="function")return n.toDate();if(n instanceof Date)return n;const t=new Date(n);return isNaN(t.getTime())?null:t}function nr(n){const t=new Date(n);return t.setHours(0,0,0,0),t}function U0(n){const t=new Date(n);return t.setHours(23,59,59,999),t}function Hl(n){const t=new Date(n),e=t.getDay(),i=t.getDate()-e+(e===0?-6:1),s=new Date(t.setDate(i));return nr(s)}function q0(n){return new Date(n.getFullYear(),n.getMonth(),1)}function Y0(n){const t=new Date,e=nr(t).getTime(),i=Hl(t).getTime(),s=q0(t).getTime(),r=n.reduce((o,a)=>{const l=jl(a.completedAt);if(!l)return o;const c=l.getTime();return c>=e&&o.today++,c>=i&&o.weekly++,c>=s&&o.monthly++,o},{today:0,weekly:0,monthly:0,total:n.length});Object.entries(r).forEach(([o,a])=>{const l=document.getElementById(`${o}-count`);l&&(l.textContent=a)})}function X0(n,t,e){const i=[],s=[],r=new Date;for(let o=t-1;o>=0;o--){let a,l,c;const d=new Date(r);e==="day"?(d.setDate(r.getDate()-o),a=nr(d),l=U0(d),c=`${a.getMonth()+1}/${a.getDate()}`):e==="week"?(d.setDate(r.getDate()-o*7),a=Hl(d),l=new Date(a),l.setDate(a.getDate()+6),l.setHours(23,59,59,999),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(r.getFullYear(),r.getMonth()-o,1),l=new Date(a.getFullYear(),a.getMonth()+1,0,23,59,59,999),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=n.filter(h=>{const f=jl(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function K0(n,t,e,i){const s=document.getElementById(`${n}Chart`);s&&(jt[n]&&(jt[n].destroy(),jt[n]=null),jt[n]=new Ct(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:e,backgroundColor:i,borderRadius:4,barThickness:"flex",maxBarThickness:30}]},options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0,ticks:{precision:0},grid:{color:"rgba(0,0,0,0.05)",drawBorder:!1}},x:{grid:{display:!1},ticks:{font:{size:10},color:"#9CA3AF"}}},plugins:{legend:{display:!1},tooltip:{backgroundColor:"#111827",padding:8,displayColors:!1,callbacks:{label:r=>`${r.raw} 件`}}}}}))}function G0(n){return n?(n.toDate?n.toDate():new Date(n)).toISOString().split("T")[0]:""}function J0(n=[]){return["日","月","火","水","木","金","土"].map((e,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer">
            <input type="checkbox" data-day-index="${i}" ${n.includes(i)?"checked":""} 
                   class="form-checkbox h-4 w-4 text-blue-600 dark:text-blue-400 bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded">
            <span class="text-xs text-gray-700 dark:text-gray-300">${e}</span>
        </label>
    `).join("")}function Jo(n,t,e){return n.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${e(i)}
        </option>
    `).join("")}function Z0(n){let t=n.dueDate;const e=n.recurrence||{type:"none",days:[]};e.type!=="none"&&!t&&(t=Oa(e));const i=t?G0(t.toDate?t.toDate():new Date(t)):"",s=Jo(he(),n.timeBlockId,a=>`${a.start} - ${a.end}`),r=Jo([30,45,60,75,90],n.duration,a=>`${a} min`),o=i||e.type!=="none"||n.timeBlockId||n.duration;return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-task-title" value="${n.title}" placeholder="タスクのタイトル"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition ml-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ -->
                <div class="px-6 py-4 space-y-5 overflow-y-auto flex-1 min-h-0">
                    
                    <!-- スケジュール設定（アコーディオン） -->
                    <details class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900/30" ${o?"":"open"}>
                        <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none">
                            <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                スケジュール設定
                            </span>
                            <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </span>
                        </summary>
                        
                        <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900/10 grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                <input type="date" id="modal-task-date" value="${i}"
                                    class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="none" ${e.type==="none"?"selected":""}>なし</option>
                                    <option value="daily" ${e.type==="daily"?"selected":""}>毎日</option>
                                    <option value="weekly" ${e.type==="weekly"?"selected":""}>毎週</option>
                                    <option value="monthly" ${e.type==="monthly"?"selected":""}>毎月</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="">未定</option>
                                    ${s}
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="">指定なし</option>
                                    ${r}
                                </select>
                            </div>
                            <div id="recurrence-days-container" class="${e.type!=="weekly"?"hidden":""} col-span-2 pt-2 border-t border-gray-100 dark:border-gray-700">
                                <label class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</label>
                                <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                    ${J0(e.days)}
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- メモ -->
                    <div class="flex flex-col flex-1">
                        <label class="text-xs font-semibold text-gray-500 mb-1.5 flex justify-between items-center uppercase">
                            <span>メモ (Markdown)</span>
                            <button id="toggle-memo-view" class="text-blue-500 hover:underline font-normal">プレビュー</button>
                        </label>
                        <textarea id="modal-task-desc" rows="5" placeholder="詳細を入力..."
                            class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none text-sm transition-all resize-none leading-relaxed">${n.description||""}</textarea>
                        <div id="modal-task-desc-preview" class="hidden w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output"></div>
                    </div>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                    </div>
                </div>
            </div>
        </div>
    `}function Q0(n){return n.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function tb(n){if(!n)return"";const t=n.split(`
`);let e=[],i=!1;return t.forEach(s=>{const r=s.trimStart(),o=r.startsWith("* ")||r.startsWith("- ");if(o&&!i?(e.push('<ul class="list-disc ml-5 space-y-1">'),i=!0):!o&&i&&(e.push("</ul>"),i=!1),o){const a=Zo(r.substring(2));e.push(`<li>${a}</li>`)}else s.trim()?e.push(`<p class="mb-2">${Zo(s)}</p>`):i&&(e.push("</ul>"),i=!1)}),i&&e.push("</ul>"),e.join(`
`)}function Zo(n){return Q0(n).replace(/\[(.*?)\]\((.*?)\)/g,(e,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}function eb(){const n=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),e=document.getElementById("toggle-memo-view");if(!n||!t||!e)return;let i=!0;const s=()=>{t.innerHTML=tb(n.value)};e.addEventListener("click",()=>{i=!i,i?(n.classList.remove("hidden"),t.classList.add("hidden"),e.textContent="プレビュー"):(s(),n.classList.add("hidden"),t.classList.remove("hidden"),e.textContent="編集")}),n.addEventListener("input",()=>{i||s()}),s()}function nb(){const n=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),e=document.getElementById("modal-task-date");if(!n||!t||!e)return;const i=(s,r=[])=>{const o=Oa({type:s,days:r});e.value=o.toISOString().substring(0,10)};n.addEventListener("change",s=>{const r=s.target.value,o=r==="weekly";if(t.classList.toggle("hidden",!o),r!=="none"){const a=o?Qo():[];i(r,a)}}),t.querySelectorAll('input[type="checkbox"]').forEach(s=>{s.addEventListener("change",()=>{const r=Qo();r.length>0&&i("weekly",r)})})}function Qo(){const n=document.getElementById("recurrence-days-container");return Array.from(n.querySelectorAll("input:checked")).map(t=>parseInt(t.dataset.dayIndex,10))}function ib(n,t,e){var i,s,r,o,a;(i=n.querySelector("#close-modal-btn"))==null||i.addEventListener("click",e),(s=n.querySelector("#cancel-modal-btn"))==null||s.addEventListener("click",e),(r=n.querySelector("div.fixed"))==null||r.addEventListener("click",l=>{l.target===l.currentTarget&&e()}),(o=n.querySelector("#save-task-modal-btn"))==null||o.addEventListener("click",async()=>{await sb(t,e)}),(a=n.querySelector("#delete-task-modal-btn"))==null||a.addEventListener("click",()=>{C("本当に削除しますか？",async()=>{await Fa(t.id),e()})}),nb(),eb()}async function sb(n,t){var a,l;const e=c=>{var d;return(d=document.getElementById(c))==null?void 0:d.value},i=(a=e("modal-task-title"))==null?void 0:a.trim();if(!i){C("タイトルを入力してください");return}const s=e("modal-task-recurrence");let r=null;if(s!=="none"&&(r={type:s},s==="weekly")){const c=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(d=>parseInt(d.dataset.dayIndex,10)).sort((d,u)=>d-u);if(c.length===0){C("曜日を選択してください");return}r.days=c}const o={title:i,description:((l=e("modal-task-desc"))==null?void 0:l.trim())||"",dueDate:e("modal-task-date")?new Date(e("modal-task-date")):null,recurrence:r,timeBlockId:e("modal-task-timeblock")||null,duration:e("modal-task-duration")?parseInt(e("modal-task-duration"),10):null};try{await Na(n.id,o),t()}catch(c){console.error("Failed to update task:",c)}}function rb(n=null){const t=!!n,e={title:(n==null?void 0:n.name)||"",placeholder:t?"ラベル名":"新しいラベル名",description:t?"ラベルの名前を変更します。":"新しいラベルを作成します。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-label-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <div class="flex items-center gap-3 w-full">
                        <div class="w-6 h-6 rounded-full flex-shrink-0" style="background-color: ${(n==null?void 0:n.color)||"#3B82F6"}"></div>
                        <input type="text" id="modal-label-name" value="${e.title}" placeholder="${e.placeholder}"
                            class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                    </div>
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${e.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-label-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-label-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${e.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function ob(n=null){var i;const t="label-modal";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.innerHTML=rb(n),document.body.appendChild(e),ab(e,n)}function ab(n,t){var a;const e=()=>n.remove(),i=n.querySelector("#modal-label-name"),s=n.querySelector("#save-label-btn"),r=n.querySelector("#delete-label-btn");(a=n.querySelector("#cancel-label-modal-btn"))==null||a.addEventListener("click",e),n.onclick=l=>{l.target===n&&e()};const o=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return C("名前を入力してください","error");try{if(t)await hh(t.id,{name:l}),C("ラベルを更新しました");else{const c=`#${Math.floor(Math.random()*16777215).toString(16).padStart(6,"0")}`;await uh(l,c),C("ラベルを作成しました")}e()}catch{C("保存に失敗しました","error")}};s.onclick=o,i.onkeydown=l=>{l.key==="Enter"&&o()},r&&(r.onclick=()=>{C(`ラベル「${t.name}」を削除しますか？`,async()=>{try{await fh(t.id),e()}catch{C("削除に失敗しました","error")}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Vl=n=>{n.key==="Escape"&&Wl()};function lb(n){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=Z0(n),ib(t,n,Wl),document.addEventListener("keydown",Vl)}function Wl(){const n=document.getElementById("modal-container");n&&(n.innerHTML="",document.removeEventListener("keydown",Vl))}function cb(n,t,e){var r;(r=document.getElementById("task-context-menu"))==null||r.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-50 animate-fade-in text-sm min-w-[150px]",i.style.left=`${t}px`,i.style.top=`${e}px`,i.innerHTML=`
        <button id="ctx-delete-task-btn" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,document.body.appendChild(i),i.querySelector("#ctx-delete-task-btn").addEventListener("click",()=>{i.remove(),C("削除しますか？",async()=>await Fa(n.id))});const s=o=>{i.contains(o.target)||(i.remove(),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),0)}function db(n){const t=document.createElement("li");t.setAttribute("data-id",n.id),t.setAttribute("draggable","true");const e=n.status==="completed",i=Hu(n.dueDate),s=Vu(n.dueDate),r=!!n.recurrence,o=!!n.dueDate&&!r,a=he(),l=n.timeBlockId?a.find(c=>c.id===n.timeBlockId):null;return t.className=`group flex items-start gap-2 sm:gap-3 py-2 px-2 rounded -mx-2 transition-all duration-200 cursor-default border border-transparent ${e?"opacity-60 bg-gray-50 dark:bg-gray-900/50":"hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700"}`,t.innerHTML=`
        <div class="task-drag-handle mt-1 text-gray-300 dark:text-gray-600 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing hidden sm:block mr-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
        </div>

        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 cursor-pointer ${e?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500"}">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center">
            <div class="col-span-1 sm:col-span-7 flex flex-col justify-center">
                <div class="leading-snug truncate font-medium transition-colors ${e?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"}">${n.title}</div>
                ${n.description?`<div class="text-xs text-gray-400 truncate mt-0.5 font-light">${n.description}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-5 flex items-center sm:justify-end space-x-2 text-xs h-full mt-1 sm:mt-0 overflow-hidden">
                ${r?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${o?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${l?`
                    <div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${l.start} - ${l.end}">
                        <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${l.color}"></span>
                        <span class="truncate font-mono text-[11px]">${l.start} - ${l.end}</span>
                    </div>
                `:""}

                ${n.duration?`
                    <div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${n.duration}分">
                        <span class="mr-0.5 text-[10px]">⏱️</span>${n.duration}m
                    </div>
                `:""}

                ${i?`<div class="flex items-center ${s} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${i}</div>`:""}
            </div>
        </div>
    `,t.addEventListener("dragstart",c=>{t.classList.add("opacity-50"),c.dataTransfer.setData("text/plain",n.id),c.dataTransfer.effectAllowed="move"}),t.addEventListener("dragend",()=>t.classList.remove("opacity-50")),t.querySelector(".task-checkbox").addEventListener("click",async c=>{c.stopPropagation(),await th(n.id,e?"todo":"completed")}),t.addEventListener("click",c=>{!c.target.closest(".task-checkbox")&&!c.target.closest(".task-drag-handle")&&lb(n)}),t.addEventListener("contextmenu",c=>{c.preventDefault(),c.stopPropagation(),cb(n,c.clientX,c.clientY)}),t}function Ul(n,t){const e=document.createElement("ul");e.id="task-list-ul",e.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2",!t||t.length===0?e.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none">
                タスクがありません
            </li>
        `:t.forEach(i=>{e.appendChild(db(i))}),n.innerHTML="",n.appendChild(e)}function ir(n,t,e){if(!(n.dataset.expanded==="true")){n.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,n.querySelector("#show-input-btn").addEventListener("click",()=>{n.dataset.expanded="true",ir(n,t,e)});return}const r=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1">
                    <option value="">時間帯 (未定)</option>
                    ${he().map(o=>`<option value="${o.id}">${o.start} - ${o.end}</option>`).join("")}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="text-xs text-gray-500 px-3 py-1.5">キャンセル</button>
                    <button id="submit-task-btn" class="bg-red-600 text-white text-xs font-bold px-4 py-1.5 rounded">タスクを追加</button>
                </div>
            </div>
        </div>
    `;n.innerHTML=Ti(r,"p-3 animate-fade-in-down"),ub(n,t,e)}function ub(n,t,e){const i=n.querySelector("#inline-title-input"),s=n.querySelector("#submit-task-btn");i.focus(),n.querySelector("#cancel-input-btn").addEventListener("click",()=>{n.dataset.expanded="false",ir(n,t,e)});const r=async()=>{const o=i.value.trim();o&&(s.disabled=!0,await hb({title:o,description:n.querySelector("#inline-desc-input").value.trim(),projectId:t,labelIds:e?[e]:[],timeBlockId:n.querySelector("#inline-timeblock-select").value||null}),i.value="",n.querySelector("#inline-desc-input").value="",i.focus(),s.disabled=!1)};s.addEventListener("click",r),i.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&r()})}async function hb(n){try{await Qu(n)}catch(t){console.error(t),C("タスクの追加に失敗しました: "+(t.message||"不明なエラー"),"error")}}function fb(n,t="createdAt_desc"){return Array.isArray(n)?[...n].sort((e,i)=>{switch(t){case"createdAt_asc":return ss(e.createdAt,i.createdAt);case"createdAt_desc":return ss(i.createdAt,e.createdAt);case"dueDate_asc":return jn(e.dueDate,i.dueDate,(s,r)=>ss(s,r));case"timeBlockId_asc":return jn(e.timeBlockId,i.timeBlockId,(s,r)=>String(s).localeCompare(String(r)));case"projectId_asc":return jn(e.projectId,i.projectId,(s,r)=>String(s).localeCompare(String(r)));case"duration_asc":return jn(e.duration,i.duration,(s,r)=>Number(s)-Number(r));case"title_asc":return(e.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function ss(n,t){const e=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return e(n)-e(t)}function jn(n,t,e){return n===t?0:n==null||n==="null"?1:t==null||t==="null"?-1:e(n,t)}function gb(n,t,e=[],i=null,s=null){const r=document.getElementById("task-view");if(!r)return;pb(n.length,i,s,t,e);const o=document.getElementById("sort-select"),a=document.getElementById("sort-trigger");let l="createdAt_desc";o?l=o.value:a&&a.dataset.value&&(l=a.dataset.value);const c=fb(n,l);r.innerHTML="";const d=document.createElement("div");d.id="task-list-container",r.appendChild(d),Ul(d,c);const u=document.createElement("div");u.id="inline-input-container",u.className="mt-2 pb-10",r.appendChild(u),ir(u,i,s)}function pb(n,t,e,i,s){const r=document.getElementById("header-title"),o=document.getElementById("header-count");if(r){let a="インボックス";if(t){const l=i.find(c=>c.id===t);a=l?l.name:"プロジェクト"}else if(e){const l=s.find(c=>c.id===e);a=l?`${l.name}`:"ラベル"}r.textContent=a}o&&(o.textContent=`${n}件`)}function mb(n,t){let e=ql(n,t);return bb(e,t.sortCriteria)}function ql(n,t){const{keyword:e,projectId:i,labelId:s,showCompleted:r,timeBlockId:o,duration:a}=t;return n.filter(l=>{if(!r&&l.status==="completed"||i&&l.projectId!==i||s&&(!l.labelIds||!l.labelIds.includes(s)))return!1;if(o){if(o==="unassigned"){if(l.timeBlockId&&l.timeBlockId!=="null")return!1}else if(String(l.timeBlockId)!==String(o))return!1}if(a&&Number(l.duration)!==Number(a))return!1;if(e){const c=e.toLowerCase(),d=l.title.toLowerCase().includes(c),u=(l.description||"").toLowerCase().includes(c);if(!d&&!u)return!1}return!0})}function bb(n,t="createdAt_desc"){return[...n].sort((e,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(e.createdAt||0);case"createdAt_asc":return(e.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return e.dueDate?i.dueDate?e.dueDate-i.dueDate:-1:1;case"project_asc":return(e.projectId||"").localeCompare(i.projectId||"");default:return 0}})}const ta=["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],ea=["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"];function As(n,t){t.forEach(e=>{e.classList.add("hidden"),e.classList.remove("animate-fade-in")}),n.classList.remove("hidden"),n.classList.add("animate-fade-in")}function si(n){document.querySelectorAll(".sidebar-item-row").forEach(e=>{var s;e.classList.remove(...ta),e.classList.add(...ea);const i=e.querySelector("svg, span:not(.truncate)");i&&(i.classList.remove("text-white"),((s=e.id)!=null&&s.startsWith("nav-")||e.dataset.type==="project")&&i.classList.add("text-gray-400"))});const t=yb(n);if(t){t.classList.remove(...ea),t.classList.add(...ta);const e=t.querySelector("svg, span:not(.truncate)");e&&(e.classList.remove("text-gray-400"),e.classList.add("text-white"))}}function yb({type:n,id:t}){return["inbox","dashboard","search","settings"].includes(n)?document.getElementById(`nav-${n}`):n==="custom"?document.querySelector(`.sidebar-item-row[data-type="filter"][data-id="${t}"]`):document.querySelector(`.sidebar-item-row[data-type="${n}"][data-id="${t}"]`)}function xb(n){const t=document.getElementById("header-title");t&&(t.textContent=n)}function vb(){["task-view","dashboard-view","settings-view","search-view"].forEach(t=>{const e=document.getElementById(t);e&&(e.innerHTML=t==="task-view"?'<div class="p-20 text-center text-gray-400 font-medium">ログインしてください</div>':"")})}function _b(n,t,e,i,s){var a;As(n,t),n.innerHTML=H0(i);const r={input:document.getElementById("page-search-input"),select:document.getElementById("page-search-project"),container:document.getElementById("search-results-container")};if(!r.input||!r.container)return;const o=()=>kb(r,e);r.input.addEventListener("input",o),(a=r.select)==null||a.addEventListener("change",o),xb("検索"),si(null),setTimeout(()=>r.input.focus(),0)}function kb(n,t){var r;const e=n.input.value.trim().toLowerCase(),i=((r=n.select)==null?void 0:r.value)||null;if(!e){wb(n.container);return}const s=ql(t,{keyword:e,projectId:i,showCompleted:!0});s.length===0?Sb(n.container):Mb(n.container,s)}function wb(n){n.innerHTML=`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function Sb(n){n.innerHTML=`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}function Mb(n,t){n.innerHTML="",Ul(n,t)}let tt={type:"inbox",id:null};function hn(n){tt=n}function Eb(n,t,e){var c;const i={task:document.getElementById("task-view"),dashboard:document.getElementById("dashboard-view"),search:document.getElementById("search-view"),settings:document.getElementById("settings-view")};if(!i.task||!i.dashboard||!i.search)return;const s=document.getElementById("sort-trigger"),r=(s==null?void 0:s.dataset.value)||"createdAt_desc";if(tt.type==="dashboard"){As(i.dashboard,[i.task,i.search,i.settings]),i.dashboard.innerHTML=zl($l),V0(n),na("ダッシュボード"),si(tt);return}if(tt.type==="settings"&&(tt={type:"inbox",id:null},si(tt),Si()),tt.type==="search"){_b(i.search,[i.task,i.dashboard,i.settings],n,t),na("タスク検索");return}As(i.task,[i.dashboard,i.settings,i.search]);const a={keyword:"",showCompleted:((c=document.getElementById("toggle-completed-btn"))==null?void 0:c.classList.contains("text-blue-500"))||!1,projectId:tt.type==="project"?tt.id:null,labelId:tt.type==="label"?tt.id:null,timeBlockId:tt.type==="timeblock"?tt.id:null,duration:tt.type==="duration"?tt.id:null,sortCriteria:r},l=mb(n,a);i.task.style.opacity="0",requestAnimationFrame(()=>{gb(l,t,e,a.projectId,a.labelId),requestAnimationFrame(()=>{i.task.style.opacity="1",si(tt)})})}function na(n){const t=document.getElementById("header-title"),e=document.getElementById("header-count");t&&(t.textContent=n),e&&(e.textContent="")}function fn(n,t,e,i,s){const r=document.createElement("li"),o=localStorage.getItem("sidebar_compact")==="true";r.dataset.type=t,r.dataset.id=e,r.className=`group flex items-center justify-between px-3 ${o?"py-0.5":"py-1.5"} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;let a="";t==="project"?a='<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>':t==="label"||t==="timeblock"?a=`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i||"#a0aec0"}"></span>`:(t==="duration"||t==="filter")&&(i&&typeof i=="string"&&i.includes("<")?a=i:a='<span class="mr-3 text-sm">🔹</span>');const l=typeof s=="number"?s:0,c=l>0?`<span class="text-xs text-gray-400 font-light mr-2">${l}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${a}
            <span class="truncate">${n}</span>
        </div>
        <div class="flex items-center">${c}</div>
    `,r}function sr(n,t,e){var r;const i=Ib(t,e);if(!i)return;(r=document.getElementById("sidebar-context-menu"))==null||r.remove();const s=Cb(i);document.body.appendChild(s),Lb(s,n),Ab(s,i)}function Ib(n,t){return{project:{editLabel:"編集",onEdit:()=>ja(t),onDelete:async()=>{await la(t.id),hn({type:"inbox",id:null})},deleteMsg:`${t.name} を削除しますか？
（関連タスクのプロジェクト情報も削除されます）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>za(t),onDelete:async()=>{await rh(t.id),document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"inbox"}}))},deleteMsg:`フィルター「${t.name}」を削除しますか？`},workspace:{editLabel:"名前変更",onEdit:()=>$a(t),onDelete:async()=>{if(li().length<=1)throw new Error("最後のワークスペースは削除できません。");await Mc(t.id);const s=li().filter(r=>r.id!==t.id);s.length>0&&_i(s[0].id)},deleteMsg:`ワークスペース「${t.name}」を本当に削除しますか？

この操作は取り消せません。関連する全データ（プロジェクト・タスクなど）が削除されます。`}}[n]}function Cb(n){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${n.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function Lb(n,t){n.style.left=`${t.clientX}px`,n.style.top=`${t.clientY}px`;const e=n.getBoundingClientRect(),i=window.innerWidth,s=window.innerHeight;e.right>i&&(n.style.left=`${i-e.width-8}px`),e.bottom>s&&(n.style.top=`${s-e.height-8}px`)}function Ab(n,t){const e=()=>{n.remove(),document.removeEventListener("click",i),document.removeEventListener("keydown",s)},i=r=>{n.contains(r.target)||e()},s=r=>{r.key==="Escape"&&e()};setTimeout(()=>{document.addEventListener("click",i),document.addEventListener("keydown",s)},0),n.querySelector("#ctx-edit-btn").onclick=()=>{e(),t.onEdit()},n.querySelector("#ctx-delete-btn").onclick=()=>{e(),C({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete(),t.onSuccess&&C(t.onSuccess,"success")}catch(r){C({message:"処理に失敗しました: "+r.message,type:"error"})}}})}}const Hn={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let vt=null,ri=null;function Ze(n){vt&&(n?(vt.classList.remove(...Hn.MENU_INVISIBLE),vt.classList.add(...Hn.MENU_VISIBLE),document.addEventListener("click",ia)):(vt.classList.remove(...Hn.MENU_VISIBLE),vt.classList.add(...Hn.MENU_INVISIBLE),document.removeEventListener("click",ia)))}const ia=n=>{vt&&!vt.contains(n.target)&&!ri.contains(n.target)&&Ze(!1)};function Yl(){ri=document.getElementById("workspace-trigger"),vt=document.getElementById("workspace-menu");const n=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!ri||!vt||(ri.onclick=e=>{e.stopPropagation();const i=vt.classList.contains("opacity-100");Ze(!i)},n&&(n.onclick=()=>{Ze(!1),$a(null)}),t&&(t.onclick=()=>{Ze(!1),Si()}),document.addEventListener("workspace-changed",()=>{Xl(li())}))}function Xl(n){const t=document.getElementById("workspace-list"),e=document.getElementById("workspace-label"),i=Pt();if(t&&Db(n,t,i),e){const s=n.find(r=>r.id===i);e.textContent=s?s.name:"ワークスペース",e.classList.toggle("text-gray-400",!s)}}function Db(n,t,e){t.innerHTML="",n.forEach(i=>{const s=i.id===e,r=document.createElement("button");r.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`,r.innerHTML=`
            <span class="truncate pointer-events-none">${i.name}</span>
            ${s?`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `:""}
        `,r.onclick=()=>{s||_i(i.id),Ze(!1)},r.oncontextmenu=o=>{o.preventDefault(),sr(o,"workspace",i)},t.appendChild(r)})}const Tb=()=>`
    <!-- モバイル用オーバーレイ -->
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-20 hidden md:hidden transition-opacity duration-300"></div>

    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-30 fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: 280px;">
        <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
            <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
                <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
                <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">
                    Task<span class="text-blue-600 dark:text-blue-400">Mg</span>
                </span>
            </div>
            <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800 hidden md:block" title="サイドバーを閉じる">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
            </button>
            <button id="sidebar-close-mobile" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800 md:hidden" title="閉じる">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>
        </div>
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-50 opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,Pb=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-10 relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>

            <!-- ワークスペース -->
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-30">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                        <button id="settings-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                            設定
                        </button>
                    </div>
                </div>
            </div>
            
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
            <span id="header-count" class="ml-2 text-xs text-gray-500 font-normal hidden sm:inline-block"></span>
        </div>

        <div class="flex items-center space-x-2">
            <!-- ソート -->
            <div id="custom-sort-dropdown" class="relative inline-block text-left z-20">
                <button id="sort-trigger" class="bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-500 text-xs py-1.5 pl-2 pr-6 rounded cursor-pointer focus:outline-none flex items-center transition-colors">
                    <span id="sort-label">作成日(新しい順)</span>
                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-1">
                        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </button>
                <div id="sort-menu" class="absolute right-0 mt-2 w-[180px] origin-top-right rounded-lg shadow-lg bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 pointer-events-none z-50 border border-gray-100 dark:border-gray-700">
                    <div class="py-1">
                        <button data-value="createdAt_desc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">作成日(新しい順)</button>
                        <button data-value="createdAt_asc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">作成日(古い順)</button>
                        <button data-value="dueDate_asc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">期限日(近い順)</button>
                        <button data-value="timeBlockId_asc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">時間帯順</button>
                        <button data-value="projectId_asc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">プロジェクト名順</button>
                        <button data-value="title_asc" class="sort-option block w-full text-left px-4 py-2 text-sm text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">タスク名順</button>
                    </div>
                </div>
            </div>

            <!-- 認証UI -->
            <div id="auth-ui" class="ml-1 flex items-center space-x-2">
                 <div id="login-form-container" class="space-x-2 flex items-center">
                     <span class="text-xs text-gray-500 dark:text-gray-400 font-medium whitespace-nowrap">未ログイン</span>
                     <input type="email" id="email-input" placeholder="メール" class="w-24 lg:w-32 bg-gray-100 dark:bg-gray-800 text-sm rounded py-1 px-2 border-none outline-none placeholder-gray-500 dark:text-gray-200">
                     <input type="password" id="password-input" placeholder="パスワード" class="w-24 lg:w-32 bg-gray-100 dark:bg-gray-800 text-sm rounded py-1 px-2 border-none outline-none placeholder-gray-500 dark:text-gray-200">
                     <button id="email-login-btn" class="bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold py-1 px-2 rounded shadow-md transition duration-150">ログイン</button>
                 </div>
                 <!-- ユーザー情報表示エリア -->
                 <div id="user-info" class="hidden items-center space-x-2">
                     <div class="flex flex-col items-end">
                         <span class="text-xs font-bold text-blue-600 dark:text-blue-400 whitespace-nowrap">ログイン中</span>
                         <span id="user-email-display" class="text-[10px] text-gray-500 dark:text-gray-400 font-mono hidden sm:block"></span>
                     </div>
                 </div>
            </div>
        </div>
    </header>
`;function Ob(){const n=document.getElementById("app");n&&(n.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${Tb()}
            
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${Pb()}
                
                <div id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar scroll-smooth">
                    <div class="w-full max-w-4xl mx-auto">
                        <div id="task-view" class="w-full animate-fade-in transition-opacity duration-150"></div>
                        <div id="search-view" class="hidden w-full animate-fade-in"></div>
                        <div id="dashboard-view" class="hidden w-full animate-fade-in"></div>
                        <div id="settings-view" class="hidden w-full animate-fade-in"></div>
                    </div>
                </div>
            </main>
        </div>
        <!-- モーダルコンテナ (z-index管理のため最前面に配置) -->
        <div id="modal-container" class="z-50 relative"></div>
    `,ca(document.getElementById("sidebar"),document.querySelector("main"),document.getElementById("sidebar-resizer")),Yl(),Bb(),Rb())}function Rb(){const n=document.getElementById("sidebar-overlay"),t=document.getElementById("sidebar"),e=document.getElementById("sidebar-close-mobile");n==null||n.addEventListener("click",()=>{var s;t.classList.contains("-translate-x-full")||(s=document.getElementById("sidebar-close-btn"))==null||s.click()}),e==null||e.addEventListener("click",()=>{var s;(s=document.getElementById("sidebar-close-btn"))==null||s.click()});const i=new MutationObserver(s=>{s.forEach(r=>{r.attributeName==="class"&&(t.classList.contains("-translate-x-full")?n==null||n.classList.add("hidden"):n==null||n.classList.remove("hidden"))})});t&&i.observe(t,{attributes:!0})}function Bb(){document.addEventListener("keydown",n=>{var t;n.key==="/"&&!["INPUT","TEXTAREA"].includes(document.activeElement.tagName)&&(n.preventDefault(),(t=document.getElementById("page-search-input"))==null||t.focus())})}function rr(n){return localStorage.getItem(`sidebar:${n}-open`)!=="false"}function Re(n,t,e=!1,i=""){const r=rr(t)?"transform: rotate(0deg);":"transform: rotate(-90deg);",o=e?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" title="${n}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" data-target="${t}">
            <div class="flex items-center min-w-0">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0" style="${r}" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${n}</h3>
            </div>
            ${o}
        </div>
    `}function Be(n){const e=rr(n)?"":"hidden";return`<ul id="${n}" class="space-y-0.5 mb-4 pl-1 ${e}"></ul>`}function Nb(){const n=rr("basic-list");return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" data-target="basic-list">
            <div class="flex items-center min-w-0">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0" style="${n?"transform: rotate(0deg);":"transform: rotate(-90deg);"}" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" /></svg>
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">基本項目</h3>
            </div>
        </div>
        <ul id="basic-list" class="space-y-0.5 mb-4 pl-1 ${n?"":"hidden"}">
            <li>
                <a href="#" id="nav-dashboard" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                    <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.488 9H15V3.512A9.025 9.025 0 0120.488 9z"></path></svg>
                    ダッシュボード
                </a>
            </li>
            <li>
                <a href="#" id="nav-inbox" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                    <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path></svg>
                    <span class="flex-1">インボックス</span>
                    <span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>
                </a>
            </li>
            <li>
                <a href="#" id="nav-search" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                    <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                    検索
                </a>
            </li>
            <li>
                <a href="#" id="nav-settings" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                    <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path></svg>
                    設定
                </a>
            </li>
        </ul>
    `}function Fb(){return`
        <div class="mt-2 select-none">
            ${Nb()}

            <!-- プロジェクト -->
            ${Re("プロジェクト","project-list",!0,"add-project-btn")}
            ${Be("project-list")}

            <!-- ラベル (復活) -->
            ${Re("ラベル","label-list",!0,"add-label-btn")}
            ${Be("label-list")}

            <!-- 時間帯 -->
            ${Re("時間帯","timeblock-list",!0,"edit-timeblocks-btn")}
            ${Be("timeblock-list")}

            <!-- 所要時間 -->
            ${Re("所要時間","duration-list")}
            ${Be("duration-list")}

            <!-- フィルター -->
            ${Re("フィルター","filter-list",!0,"add-filter-btn")}
            ${Be("filter-list")}
        </div>
    `}function $b(){document.querySelectorAll(".sidebar-section-header").forEach(n=>{const t=n.dataset.target,e=document.getElementById(t),i=n.querySelector("svg");!e||!i||n.addEventListener("click",s=>{if(s.target.closest("button"))return;const o=e.classList.contains("hidden");e.classList.toggle("hidden",!o),i.style.transform=o?"rotate(0deg)":"rotate(-90deg)",localStorage.setItem(`sidebar:${t}-open`,o)})})}const Vn=["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"];function gn(n,t,e=null){if(!n)return;let i=0;n.addEventListener("dragenter",s=>{s.preventDefault(),i++,n.classList.add(...Vn)}),n.addEventListener("dragover",s=>{s.preventDefault(),n.classList.contains("ring-2")||n.classList.add(...Vn)}),n.addEventListener("dragleave",s=>{s.preventDefault(),i--,i<=0&&(n.classList.remove(...Vn),i=0)}),n.addEventListener("drop",async s=>{s.preventDefault(),i=0,n.classList.remove(...Vn);const r=s.dataTransfer.getData("text/plain");r&&await zb(r,t,e)})}async function zb(n,t,e){const i={};switch(t){case"inbox":i.projectId=null;break;case"project":e&&(i.projectId=e);break;case"timeblock":i.timeBlockId=e==="unassigned"||e===null?null:e;break;case"duration":const s=parseInt(e,10);if(!isNaN(s)&&s>0)i.duration=s;else{console.warn("[Drop] Invalid duration value:",e),C({message:"無効な所要時間です。",type:"error"});return}break;default:console.warn(`[Drop] Unknown drop type: ${t}`);return}try{Object.keys(i).length>0&&await Na(n,i)}catch(s){console.error(`[Drop Error] Type: ${t}, Task: ${n}`,s),C({message:"タスクの更新に失敗しました",type:"error"})}}const oi=5;function Kl(n=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",e.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <!-- ヘッダー -->
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <!-- ボディ -->
            <div class="p-6 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div id="tb-list" class="divide-y divide-gray-100 dark:divide-gray-700"></div>
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
                    <!-- アイコンとテキストはJSで設定 -->
                </button>

                <div class="p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-800 flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-3 h-3 rounded-full bg-gray-400 mr-3"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs">デフォルトのゾーンです（削除不可）</span>
                </div>
            </div>

            <!-- フッター -->
            <div class="px-6 py-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/50 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-sm transition-all active:scale-95">完了</button>
            </div>
        </div>
    `,document.body.appendChild(e),jb(n),Wb(e)}function jb(n){const t=document.getElementById("tb-list");if(!t)return;if(t.innerHTML="",he().forEach(i=>t.appendChild(Gl(i))),Qe(),n&&n.id){const i=t.querySelector(`.tb-row[data-id="${n.id}"]`);i&&setTimeout(()=>{i.scrollIntoView({behavior:"smooth",block:"center"}),i.classList.add("bg-blue-50","dark:bg-blue-900/20","ring-2","ring-blue-400","ring-inset","rounded-lg"),setTimeout(()=>i.classList.remove("ring-2","ring-blue-400","ring-inset"),2e3)},100)}}function vi(n){if(!n)return 0;const[t,e]=n.split(":").map(Number);return t*60+e}function Hb(n,t,e){const s=he().filter(r=>r.id!==n);for(const r of s){const o=vi(r.start),a=vi(r.end);if(Math.max(t,o)<Math.min(e,a))return!0}return!1}function Gl(n=null){const t=n||{id:null,start:"09:00",end:"10:00",color:"#3B82F6"},[e,i]=t.start.split(":"),[s,r]=t.end.split(":"),o=document.createElement("div");o.className="tb-row flex items-center gap-4 py-4 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg",t.id&&(o.dataset.id=t.id);const a=(l,c)=>c.map(d=>{const u=String(d).padStart(2,"0");return`<option value="${u}" ${u===l?"selected":""}>${u}</option>`}).join("");return o.innerHTML=`
        <div class="flex-shrink-0 relative">
            <input type="color" class="w-8 h-8 rounded cursor-pointer border-none p-0 bg-transparent" value="${t.color}">
            <div class="absolute inset-0 pointer-events-none rounded border border-gray-200 dark:border-gray-600"></div>
        </div>

        <div class="flex-1 flex items-center gap-2">
            <div class="flex items-center gap-1 bg-gray-50 dark:bg-gray-900 px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700">
                <select class="start-h bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${a(e,Array.from({length:24},(l,c)=>c))}</select>
                <span class="text-gray-400">:</span>
                <select class="start-m bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${a(i,["00","15","30","45"])}</select>
            </div>
            <span class="text-gray-300 font-bold">~</span>
            <div class="flex items-center gap-1 bg-gray-50 dark:bg-gray-900 px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700">
                <select class="end-h bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${a(s,Array.from({length:24},(l,c)=>c))}</select>
                <span class="text-gray-400">:</span>
                <select class="end-m bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${a(r,["00","15","30","45"])}</select>
            </div>
        </div>

        <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
            <button class="save-btn p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors" title="保存">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </button>
            <button class="delete-btn p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `,Vb(o),o}function Vb(n){const t=s=>n.querySelector(s).value,e=n.querySelector(".save-btn"),i=n.querySelector(".delete-btn");e.onclick=async()=>{const s=`${t(".start-h")}:${t(".start-m")}`,r=`${t(".end-h")}:${t(".end-m")}`,o=t('input[type="color"]'),a=n.dataset.id||null,l=vi(s),c=vi(r);if(l>=c)return C({message:"終了時間は開始時間より後にしてください",type:"error"});if(Hb(a,l,c))return C({message:"他の時間帯と重複しています。時間を調整してください。",type:"error"});e.disabled=!0,e.classList.add("opacity-50");try{const d=await bh({id:a,name:`${s}-${r}`,start:s,end:r,color:o});d&&d.id&&(n.dataset.id=d.id),n.classList.add("bg-green-50","dark:bg-green-900/20"),setTimeout(()=>n.classList.remove("bg-green-50","dark:bg-green-900/20"),1e3),document.dispatchEvent(new CustomEvent("timeblocks-updated")),Qe()}catch(d){C({message:d.message||"保存に失敗しました",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-50")}},i.onclick=()=>{const s=n.dataset.id;if(!s){n.remove(),Qe();return}C({message:`この時間帯を削除すると、関連するタスクの時間帯が「未定」に変更されます。

本当に削除しますか？`,type:"confirm",onConfirm:async()=>{try{await yh(s),n.remove(),Qe(),document.dispatchEvent(new CustomEvent("timeblocks-updated"))}catch{C({message:"削除に失敗しました",type:"error"})}}})}}function Wb(n){const t=()=>n.remove();n.querySelector("#close-tb-modal").onclick=t,n.querySelector("#close-tb-footer").onclick=t,n.onclick=i=>{i.target===n&&t()};const e=i=>{i.key==="Escape"&&(t(),document.removeEventListener("keydown",e))};document.addEventListener("keydown",e),n.querySelector("#add-tb-btn").onclick=()=>{const i=document.getElementById("tb-list");if(document.querySelectorAll(".tb-row").length<oi){const s=Gl();i.appendChild(s),Qe(),s.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{var r;return(r=s.querySelector("select"))==null?void 0:r.focus()},100)}}}function Qe(){const n=document.getElementById("add-tb-btn");if(!n)return;const e=document.querySelectorAll(".tb-row").length>=oi;n.disabled=e,e?n.innerHTML=`<span class="text-gray-400">これ以上追加できません (最大${oi}個)</span>`:n.innerHTML=`
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            <span>新しい時間帯を追加 (最大${oi}個)</span>
        `}function Ub(n){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",e=>{e.stopPropagation(),ja()})}function qb(n,t=[]){const e=document.getElementById("project-list");if(e){if(e.innerHTML="",n.length===0){e.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}n.forEach(i=>{const s=t.filter(o=>o.projectId===i.id&&!o.completed).length,r=fn(i.name,"project",i.id,i.color,s);r.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},r.oncontextmenu=o=>{o.preventDefault(),o.stopPropagation(),sr(o,"project",i)},gn(r,"project",i.id),e.appendChild(r)})}}function Yb(n){const t=document.getElementById("inbox-count");if(!t)return;const e=n.filter(i=>!i.projectId&&i.status!=="completed").length;t.textContent=e,t.classList.toggle("hidden",e===0)}function Xb(n=[],t=[]){const e=document.getElementById("label-list");e&&(e.innerHTML="",n.forEach(i=>{const s=t.filter(o=>{var a;return((a=o.labelIds)==null?void 0:a.includes(i.id))&&o.status!=="completed"}).length,r=fn(i.name,"label",i.id,i.color,s);r.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"label",id:i.id}}))}),r.addEventListener("contextmenu",o=>{o.preventDefault(),sr(o,"label",i)}),e.appendChild(r)}))}function Kb(n=[]){const t=document.getElementById("timeblock-list");if(!t)return;t.innerHTML="",he().forEach(r=>{const o=n.filter(c=>String(c.timeBlockId)===String(r.id)&&c.status!=="completed").length,a=`${r.start} - ${r.end}`,l=fn(a,"timeblock",r.id,r.color,o);l.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:r.id}}))}),l.addEventListener("contextmenu",c=>{c.preventDefault(),Kl(r)}),gn(l,"timeblock",r.id),t.appendChild(l)});const i=n.filter(r=>(r.timeBlockId===null||r.timeBlockId==="null")&&r.status!=="completed").length,s=fn("未定","timeblock","unassigned","#a0aec0",i);s.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}}))}),gn(s,"timeblock","unassigned"),t.appendChild(s)}function Gb(n=[]){const t=document.getElementById("duration-list");if(!t)return;t.innerHTML="";const e=[30,45,60,75,90],i='<span class="mr-3 text-sm">⏱️</span>';e.forEach(s=>{const r=n.filter(a=>Number(a.duration)===s&&a.status!=="completed").length,o=fn(`${s} min`,"duration",s.toString(),i,r);o.addEventListener("click",()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:s.toString()}}))}),gn(o,"duration",s.toString()),t.appendChild(o)})}function Jb(){const n=document.getElementById("sidebar-content");if(!n)return;n.innerHTML=Fb();const t=document.getElementById("sidebar"),e=document.getElementById("sidebar-resizer");ca(t,document.querySelector("main"),e),Qb(),$b(),gn(document.getElementById("nav-inbox"),"inbox"),Ub(),Ds(),window.addEventListener("resize",Ds),Zb(),ty()}function Zb(){const n=localStorage.getItem("sidebar_compact")==="true";Jl(n)}function Jl(n){document.querySelectorAll(".sidebar-item-row").forEach(t=>{n?(t.classList.add("py-0.5"),t.classList.remove("py-1.5")):(t.classList.add("py-1.5"),t.classList.remove("py-0.5"))})}function Qb(){var t,e,i,s,r,o,a,l,c;const n=(d,u=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:d,id:u}}));(t=document.getElementById("nav-dashboard"))==null||t.addEventListener("click",d=>{d.preventDefault(),n("dashboard")}),(e=document.getElementById("nav-inbox"))==null||e.addEventListener("click",d=>{d.preventDefault(),n("inbox")}),(i=document.getElementById("nav-search"))==null||i.addEventListener("click",d=>{d.preventDefault(),n("search")}),(s=document.getElementById("nav-settings"))==null||s.addEventListener("click",d=>{d.preventDefault(),Si()}),(r=document.getElementById("add-filter-btn"))==null||r.addEventListener("click",()=>za()),(o=document.getElementById("edit-timeblocks-btn"))==null||o.addEventListener("click",()=>Kl()),(a=document.getElementById("add-label-btn"))==null||a.addEventListener("click",()=>ob()),(l=document.getElementById("sidebar-open-btn"))==null||l.addEventListener("click",()=>sa(!0)),(c=document.getElementById("sidebar-close-btn"))==null||c.addEventListener("click",()=>sa(!1))}function sa(n){const t=document.getElementById("sidebar"),e=document.getElementById("sidebar-resizer");if(t){if(t.classList.toggle("sidebar-closed",!n),t.classList.toggle("hidden",!n),window.innerWidth>=768)if(e&&e.classList.toggle("hidden",!n),n){const i=localStorage.getItem("sidebarWidth")||280;t.style.width=`${i}px`}else t.style.width="0";Ds()}}function Ds(){const n=document.getElementById("sidebar"),t=document.getElementById("sidebar-open-btn"),e=document.getElementById("sidebar-close-btn");if(!n||!t||!e)return;const i=n.classList.contains("sidebar-closed")||n.classList.contains("hidden");window.innerWidth>=768?(t.classList.toggle("hidden",!i),e.classList.toggle("hidden",i),i||n.classList.remove("hidden")):(t.classList.remove("hidden"),e.classList.remove("hidden"),n.classList.remove("hidden"))}function ty(){window.addEventListener("sidebar-settings-updated",n=>{const t=!!n.detail.compact;Jl(t)})}let ee={tasks:[],projects:[],labels:[],timeBlocks:[],filters:[]},ft={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null},rs=null;function gt(){rs||(rs=requestAnimationFrame(()=>{const{tasks:n,projects:t,labels:e}=ee;Yb(n),qb(t,n),Xb(e,n),Kb(n),Gb(n),Eb(n,t,e),rs=null}))}function Zl(){if(!(O!=null&&O.currentUser))return;or(!1);const n=Pt();if(!n){console.warn("[DataSync] No workspace selected.");return}console.log("[DataSync] Start syncing workspace:",n),ft.tasks=Zu(t=>{ee.tasks=t,gt()}),ft.projects=Tc(t=>{ee.projects=t,gt()}),ft.labels=dh(t=>{ee.labels=t,gt()}),ft.timeBlocks=ph(t=>{ee.timeBlocks=t,gt()}),ft.filters=nh(t=>{ee.filters=t,gt()})}function or(n=!1){Object.keys(ft).forEach(t=>{t==="workspaces"&&!n||ft[t]&&(ft[t](),ft[t]=null)}),mh(),ee={tasks:[],projects:[],labels:[],timeBlocks:[],filters:[]},gt()}function Ql(){return ft.workspaces}function tc(n){ft.workspaces=n}function ey(){const n=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),e=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!n||!t||!e)return;const s=o=>{o?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",r)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",r))},r=o=>{o&&(t.contains(o.target)||n.contains(o.target))||s(!1)};n.addEventListener("click",o=>{o.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(o=>{o.addEventListener("click",a=>{const l=o.dataset.value,c=o.textContent;e.textContent=c,n.dataset.value=l,gt(),s(!1)})}),n.dataset.value||(n.dataset.value="createdAt_desc",e.textContent="作成日(新しい順)")}function ny(n,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>n(...i),t)}}function iy(){var t,e;document.addEventListener("workspace-changed",i=>{const s=document.getElementById("header-title");s&&(s.textContent="読み込み中..."),O!=null&&O.currentUser&&(hn({type:"inbox",id:null}),or(!1),Zl(),gt())}),document.addEventListener("route-change",i=>{const{page:s,id:r}=i.detail;hn({type:s,id:r||null}),localStorage.setItem("lastPage",JSON.stringify({page:s,id:r||null})),gt()});const n=ny(()=>gt(),300);(t=document.getElementById("search-input"))==null||t.addEventListener("input",n),(e=document.getElementById("toggle-completed-btn"))==null||e.addEventListener("click",i=>{i.currentTarget.classList.toggle("text-blue-500"),gt()}),ey()}function sy(){try{hc()}catch(n){console.error("Firebase Initialization Failed",n);return}xh(),Ob(),Mh(),Yl(),bc(),iy(),oy()}function ry(){try{const n=JSON.parse(localStorage.getItem("lastPage"));hn(n?{type:n.page,id:n.id||null}:{type:"inbox"})}catch{hn({type:"inbox"})}}function oy(){O&&oc(O,n=>{yc(n),n?ay():ly()})}function ay(n){Jb();const t=Ql();t&&t();const e=_c(i=>{Xl(i)});tc(e),Zl(),ry()}function ly(){const n=Ql();n&&(n(),tc(null)),or(!0),vb()}function cy(){sy()}function dy(){let n=document.querySelector("link[rel*='icon']");n||(n=document.createElement("link"),n.rel="icon",document.head.appendChild(n)),n.type="image/png",n.href="/images/favicon-96x96.png"}document.addEventListener("DOMContentLoaded",()=>{dy(),cy()});
