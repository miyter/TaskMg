import{l as se,d as y,j as e}from"./vendor-j1jwJuCp.js";import{a as T,ap as G,aq as O,K as V,o as k,u as z,M as re,k as ne,j as $,B as b,ah as F,an as q,f as J,U as B,ar as oe,p as le,ak as ie,aj as ce,as as de,at as me,au as ge,ao as ue,q as xe,av as pe,S as W,aw as he,ax as be}from"./main-DP3x7AFG.js";import{u as X}from"./i18n-DnoxxtLm.js";import{M as fe}from"./Modal-C8UH6Z5J.js";import{I as _}from"./Input-De1UEU8G.js";import{g as H,c as Q,w as Y,d as Z,q as ye,a as je,s as ke,E as ve,l as we}from"./firebase-CTDNBn9D.js";async function Ne(s){const i=T.currentUser;if(!i)throw new Error("User not authenticated");const d=G.tasks(i.uid,s),u=(await H(Q(O,d))).docs.map(n=>({id:n.id,...n.data()})),o=new Map;for(const n of u){if(!n.title)continue;const c=n.title.trim(),m=o.get(c)||[];m.push(n),o.set(c,m)}const r=[];for(const[n,c]of o.entries())if(c.length>1){c.sort((g,h)=>{const j=E=>{var f;return((f=V(E))==null?void 0:f.getTime())||0},l=j(g.createdAt),x=j(h.createdAt);return l-x});const m=c.slice(1);for(const g of m)g.id&&r.push(g.id)}if(r.length>0)for(let n=0;n<r.length;n+=500){const c=Y(O),m=r.slice(n,n+500);for(const g of m)c.delete(Z(O,d,g));await c.commit()}return r.length}async function _e(s){const i=T.currentUser;if(!i)throw new Error("User not authenticated");const d=G.tasks(i.uid,s),t=ye(Q(O,d),je("status","==","completed")),u=await H(t),o=se(new Date,30),r=[];for(const c of u.docs){const m={id:c.id,...c.data()};if(!m.isDetailPurged&&m.completedAt){const g=V(m.completedAt);g&&g<o&&(m.description||!m.isDetailPurged)&&r.push(m)}}if(r.length===0)return 0;let n=0;for(let c=0;c<r.length;c+=500){const m=Y(O),g=r.slice(c,c+500);for(const h of g)m.update(Z(O,d,h.id),{description:"",isDetailPurged:!0}),n++;await m.commit()}return n}const S=({title:s,children:i,defaultOpen:d=!1,icon:t,className:u})=>{const[o,r]=y.useState(d);return e.jsxs("section",{className:k("border border-gray-200 dark:border-gray-700/50 rounded-xl overflow-hidden",u),children:[e.jsxs("button",{onClick:()=>r(!o),className:"w-full flex items-center justify-between p-4 bg-gray-50/50 dark:bg-gray-800/30 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",type:"button","aria-expanded":o,"aria-controls":`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t&&e.jsx("span",{className:"text-lg",children:t}),e.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:s})]}),e.jsx("svg",{className:k("w-4 h-4 text-gray-400 transition-transform duration-200",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx("div",{id:`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,className:k("transition-all duration-100 ease-in-out overflow-hidden bg-white dark:bg-transparent",o?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700/30",children:i})})]})},Ce=()=>{const{t:s}=z(),{customDurations:i,setCustomDurations:d}=X(),t=[15,30,45,60,75,90,105,120],u=o=>{i.includes(o)?d(i.filter(r=>r!==o)):d([...i,o].sort((r,n)=>r-n))};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"â±ï¸"})," ",s("durations")]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.map(o=>{const r=i.includes(o);return e.jsxs("button",{onClick:()=>u(o),className:k("flex flex-col items-center justify-center p-2 rounded-lg border text-sm font-medium transition-all duration-200",r?"bg-blue-600 text-white border-blue-600 shadow-md transform scale-105":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600"),children:[e.jsx("span",{children:o}),e.jsx("span",{className:"text-[10px] opacity-80",children:"min"})]},o)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.duration.description")||"Select preset durations available in task details."})]})},Se=()=>{const{t:s}=z(),{timeBlocks:i}=re(),{workspaceId:d}=ne(),{openModal:t}=$(),[u,o]=y.useState(null),[r,n]=y.useState({}),c=l=>{o(l.id||null),n({...l})},m=()=>{o("new"),n({name:"",start:"09:00",end:"10:00",color:B.DEFAULT_COLORS.TIME_BLOCK})},g=()=>{o(null),n({})},h=async()=>{!d||!r.start||!r.end||(await ie(d,r),o(null),n({}))},j=(l,x)=>{d&&t("confirmation",{title:s("delete"),message:`${s("timeblocks")}: ${x||"Time Block"} 
${s("msg.confirm_delete")} `,confirmLabel:s("delete"),variant:"danger",onConfirm:async()=>{await ce(d,l)}})};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"})," ",s("timeblocks")]}),u!=="new"&&e.jsxs(b,{onClick:m,size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 h-8 px-2",children:[e.jsx(F,{className:"w-4 h-4 mr-1"}),s("add")]})]}),e.jsxs("div",{className:"space-y-2",children:[i.length===0&&u!=="new"&&e.jsx("div",{className:"text-sm text-gray-500 italic py-2",children:s("no_items")||"No time blocks defined."}),i.map(l=>e.jsx("div",{className:"group flex items-center gap-3 p-3 bg-white dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm transition-all",children:u===l.id?e.jsxs("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(_,{value:r.name||"",onChange:x=>n({...r,name:x.target.value}),placeholder:"Name (Optional)",className:"h-8 text-sm col-span-2 sm:col-span-1"}),e.jsx(_,{type:"time",value:r.start||"",onChange:x=>n({...r,start:x.target.value}),className:"h-8 text-sm"}),e.jsx(_,{type:"time",value:r.end||"",onChange:x=>n({...r,end:x.target.value}),className:"h-8 text-sm"}),e.jsxs("div",{className:"flex items-center gap-1 justify-end col-span-2 sm:col-span-1",children:[e.jsx(b,{onClick:h,size:"sm",variant:"primary",className:"h-8 w-8 p-0 rounded-full",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx(b,{onClick:g,size:"sm",variant:"ghost",className:"h-8 w-8 p-0 rounded-full text-gray-500",children:e.jsx(J,{className:"w-4 h-4"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1 h-8 rounded-full flex-shrink-0",style:{backgroundColor:l.color||B.DEFAULT_COLORS.TIME_BLOCK_INACTIVE}}),e.jsxs("div",{className:"flex-1 min-w-0 grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm",children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200 truncate",children:l.name||"(No Name)"}),e.jsxs("span",{className:"font-mono text-gray-500 text-xs sm:text-sm",children:[l.start," - ",l.end]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(l),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:e.jsx(oe,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>j(l.id,l.name||""),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(le,{className:"w-4 h-4"})})]})]})},l.id)),u==="new"&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800 animate-in fade-in slide-in-from-top-2",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(_,{value:r.name||"",onChange:l=>n({...r,name:l.target.value}),placeholder:"Name",className:"h-9 text-sm col-span-2 sm:col-span-1 bg-white dark:bg-gray-800",autoFocus:!0}),e.jsx(_,{type:"time",value:r.start||"",onChange:l=>n({...r,start:l.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsx(_,{type:"time",value:r.end||"",onChange:l=>n({...r,end:l.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsxs("div",{className:"flex items-center gap-2 justify-end col-span-2 sm:col-span-1",children:[e.jsx(b,{onClick:h,size:"sm",variant:"primary",className:"h-9 w-9 p-0 rounded-full",children:e.jsx(q,{className:"w-4 h-4"})}),e.jsx(b,{onClick:g,size:"sm",variant:"ghost",className:"h-9 w-9 p-0 rounded-full text-gray-500 hover:bg-white dark:hover:bg-gray-800",children:e.jsx(J,{className:"w-4 h-4"})})]})]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.timeblocks.description")||"Time blocks help you organize your day."})]})},Te=()=>{const{t:s}=z(),{user:i}=de(),{openModal:d}=$(),[t,u]=y.useState(""),[o,r]=y.useState(""),[n,c]=y.useState(!1),[m,g]=y.useState(!1),[h,j]=y.useState(null);if(!i)return e.jsx("div",{className:"text-center text-gray-500",children:s("settings_modal.account.not_logged_in")});const l=i.isAnonymous,x=async f=>{f.preventDefault(),g(!0),j(null);try{const C=ve.credential(t,o);await we(i,C),ue.success(s("settings_modal.account.register_success"))}catch(C){console.error("Link account error:",C);let p=s("settings_modal.account.register_fail");C.code==="auth/email-already-in-use"&&(p=s("settings_modal.account.already_in_use")),C.code==="auth/weak-password"&&(p=s("settings_modal.account.weak_password")),j(p)}finally{g(!1)}},E=()=>{d("confirmation",{title:s("settings_modal.account.logout"),message:s("settings_modal.account.logout_confirm"),confirmLabel:s("settings_modal.account.logout"),variant:"danger",onConfirm:async()=>{await ke(T),window.location.reload()}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-6 flex flex-col sm:flex-row items-center gap-8 sm:gap-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-3xl shrink-0",children:l?"ðŸ•µï¸":"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:l?s("settings_modal.account.guest_user"):i.displayName||s("settings_modal.account.registered_user")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono mb-4 break-all",children:l?`ID: ${i.uid.slice(0,8)}...`:i.email}),!l&&e.jsx(b,{variant:"ghost",size:"sm",onClick:E,className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 font-bold",children:s("settings_modal.account.logout")})]})]}),l?e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx("svg",{className:"w-32 h-32 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"})," ",s("settings_modal.account.persist_account")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6 leading-relaxed whitespace-pre-wrap",children:s("settings_modal.account.persist_desc")}),e.jsxs("form",{onSubmit:x,className:"space-y-4 max-w-md",children:[h&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-lg font-medium",children:h}),e.jsx(_,{id:"account-email",type:"email",label:s("settings_modal.account.email_label"),required:!0,value:t,onChange:f=>u(f.target.value),placeholder:"mail@example.com",autoComplete:"email"}),e.jsx(_,{id:"account-password",type:n?"text":"password",label:s("settings_modal.account.password_label"),required:!0,minLength:6,value:o,onChange:f=>r(f.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"new-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>c(!n),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none p-1 pointer-events-auto","aria-label":s(n?"settings_modal.account.hide_password":"settings_modal.account.show_password"),children:n?e.jsx(me,{size:20}):e.jsx(ge,{size:20})})}),e.jsx(b,{type:"submit",isLoading:m,className:"w-full",rightIcon:m?void 0:e.jsx("span",{children:"â†’"}),children:s("settings_modal.account.register")})]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:s("settings_modal.account.registered_msg")})})]})},A=({active:s,onClick:i,label:d,icon:t})=>e.jsxs("button",{onClick:i,className:k("flex items-center gap-2 px-4 py-2 text-sm rounded-lg transition-all whitespace-nowrap min-w-0","md:w-full md:justify-start md:text-left md:py-2","flex-col w-full justify-center py-3 text-[10px] gap-1 rounded-none md:rounded-lg md:text-sm md:flex-row md:gap-3",s?"bg-white dark:bg-gray-800 shadow-sm text-blue-600 dark:text-blue-400 font-bold border-t-2 md:border-t-0 md:border md:border-gray-100 dark:md:border-gray-700 border-blue-500 md:border-transparent":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-200 border-t-2 md:border-t-0 border-transparent"),children:[e.jsx("span",{className:"text-lg md:text-base",children:t}),e.jsx("span",{className:"truncate font-medium",children:d})]}),K=({isActive:s,onClick:i,children:d,className:t})=>e.jsx("button",{type:"button",onClick:i,"aria-pressed":s,className:k("p-3 border rounded-xl text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-blue-500",s?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400",t),children:d}),Be=({isOpen:s,zIndex:i,overlayClassName:d})=>{const{t}=z(),{closeModal:u,openModal:o}=$(),{themeMode:r,setThemeMode:n,density:c,setDensity:m,fontSize:g,setFontSize:h,fontEn:j,setFontEn:l,fontJp:x,setFontJp:E,language:f,setLanguage:C}=X(),{currentWorkspaceId:p}=xe(),{addToast:v}=pe(),[w,D]=y.useState("appearance"),[U,ee]=y.useState(!1),te=!!s;return e.jsx(fe,{isOpen:te,onClose:u,title:t("settings_modal.title"),className:"w-full h-full p-0 overflow-hidden",zIndex:i,size:"xl",variant:"side-right",overlayClassName:d,children:e.jsxs("div",{className:"flex flex-col md:flex-row h-full",children:[e.jsx("div",{className:"order-last md:order-first w-full md:w-64 bg-white dark:bg-gray-900 md:bg-gray-50/50 md:dark:bg-gray-900/50 border-t md:border-t-0 md:border-r border-gray-200 dark:border-gray-700 shrink-0 z-10",children:e.jsxs("div",{className:"flex flex-row md:flex-col justify-around md:justify-start md:p-4 md:space-y-2 pb-safe md:pb-4",children:[e.jsx(A,{active:w==="general",onClick:()=>D("general"),label:t("settings_modal.tabs.general"),icon:"âš™ï¸"}),e.jsx(A,{active:w==="appearance",onClick:()=>D("appearance"),label:t("settings_modal.tabs.appearance"),icon:"ðŸŽ¨"}),e.jsx(A,{active:w==="schedule",onClick:()=>D("schedule"),label:t("settings_modal.tabs.schedule"),icon:"ðŸ“…"}),e.jsx(A,{active:w==="security",onClick:()=>D("security"),label:t("settings_modal.tabs.security"),icon:"ðŸ”"})]})}),e.jsxs("div",{className:"flex-1 p-modal overflow-y-auto custom-scrollbar bg-white dark:bg-gray-900 order-first md:order-last relative",children:[w==="appearance"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(S,{title:t("settings_modal.appearance.theme"),icon:"ðŸŒ“",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["light","dark","system"].map(a=>e.jsx(K,{isActive:r===a,onClick:()=>n(a),children:e.jsx("span",{className:"capitalize",children:t(`settings_modal.options.theme.${a}`)})},a))})}),e.jsx(S,{title:t("settings_modal.appearance.density"),icon:"ðŸ“",defaultOpen:!1,children:e.jsx("div",{className:"space-y-3",children:["compact","normal","comfortable","spacious"].map(a=>e.jsxs("label",{htmlFor:`density-${a}`,className:k("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors focus-within:ring-2 focus-within:ring-blue-500",c===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/10":"border-transparent hover:bg-white dark:hover:bg-gray-800"),children:[e.jsx("div",{className:k("w-4 h-4 rounded-full border flex items-center justify-center",c===a?"border-blue-500 bg-blue-500":"border-gray-300"),children:c===a&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("input",{id:`density-${a}`,type:"radio",name:"density",checked:c===a,onChange:()=>m(a),className:"sr-only"}),e.jsx("span",{className:"capitalize text-sm font-medium text-gray-700 dark:text-gray-300",children:t(`settings_modal.options.density.${a}`)})]},a))})}),e.jsx(S,{title:t("settings_modal.appearance.font_size"),icon:"Aa",defaultOpen:!1,children:e.jsx("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:["sm","base","md","lg","xl"].map(a=>e.jsx("button",{onClick:()=>h(a),className:k("flex-1 py-1.5 px-3 rounded text-sm font-medium transition-all",g===a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:a},a))})}),e.jsxs(S,{title:t("settings_modal.appearance.fonts"),icon:"Tt",defaultOpen:!1,children:[e.jsx(W,{id:"settings-font-en",name:"fontEn",label:t("settings_modal.appearance.font_en"),value:j,onChange:a=>l(a.target.value),options:B.FONTS.EU}),e.jsx(W,{id:"settings-font-jp",name:"fontJp",label:t("settings_modal.appearance.font_jp"),value:x,onChange:a=>E(a.target.value),options:B.FONTS.JP})]})]}),w==="schedule"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(S,{title:t("time_block.settings_title"),icon:"ðŸ“…",defaultOpen:!0,children:e.jsx(Se,{})}),e.jsx(S,{title:t("task_detail.duration_label")||"Duration",icon:"â±ï¸",defaultOpen:!1,children:e.jsx(Ce,{})})]}),w==="general"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¾"})," ",t("settings_modal.backup.title")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:t("settings_modal.backup.description")}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx(b,{onClick:async()=>{if(!(!T.currentUser||!p))try{const a=await he(T.currentUser.uid,p),L=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),I=URL.createObjectURL(L),N=document.createElement("a");N.href=I,N.download=`taskmg-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(N),N.click(),document.body.removeChild(N),URL.revokeObjectURL(I),v(t("settings_modal.backup.create_success"),"success")}catch(a){console.error(a),v(t("settings_modal.backup.create_fail"),"error")}},variant:"premium",leftIcon:e.jsx(F,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.create")}),e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx("input",{type:"file",accept:".json",className:"hidden",id:"backup-import-input",onChange:a=>{var I;const L=(I=a.target.files)==null?void 0:I[0];!L||!T.currentUser||!p||(a.target.value="",o("confirmation",{title:t("settings_modal.backup.import"),message:t("settings_modal.backup.import_confirm"),confirmLabel:t("modal.ok"),variant:"danger",onConfirm:()=>{const N=new FileReader;N.onload=async ae=>{var P;try{const M=JSON.parse((P=ae.target)==null?void 0:P.result),R=await be(T.currentUser.uid,p,M);v(t("settings_modal.backup.import_success").replace("{tasks}",String(R.tasksCount)).replace("{projects}",String(R.projectsCount)),"success"),setTimeout(()=>window.location.reload(),1e3)}catch(M){console.error(M),v(t("settings_modal.backup.import_fail"),"error")}},N.readAsText(L)}}))}}),e.jsx(b,{variant:"secondary",onClick:()=>{var a;return(a=document.getElementById("backup-import-input"))==null?void 0:a.click()},leftIcon:e.jsx(F,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.import")})]})]})]}),e.jsx(S,{title:t("settings_modal.language.title"),icon:"ðŸŒ",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{code:"ja",label:"æ—¥æœ¬èªž"},{code:"en",label:"English"}].map(a=>e.jsxs(K,{isActive:f===a.code,onClick:()=>C(a.code),children:[e.jsx("span",{className:"text-xl mr-2",children:a.code==="ja"?"ðŸ‡¯ðŸ‡µ":"ðŸ‡ºðŸ‡¸"}),a.label]},a.code))})})]}),w==="security"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Te,{}),e.jsx("hr",{className:"border-gray-200 dark:border-gray-700 my-2"}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/30",children:[e.jsxs("h4",{className:"font-bold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ§¹"})," ",t("settings_modal.maintenance.title")]}),e.jsx("p",{className:"text-sm text-red-600/80 dark:text-red-400/80 mb-4",children:t("settings_modal.maintenance.description")}),e.jsxs("label",{htmlFor:"backup-confirm-checkbox",className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{id:"backup-confirm-checkbox",name:"backupConfirmed",type:"checkbox",className:"w-4 h-4 text-red-600 rounded border-red-300 focus:ring-red-500",checked:U,onChange:a=>ee(a.target.checked)}),e.jsx("span",{className:"text-sm font-bold text-red-700 dark:text-red-400",children:t("settings_modal.maintenance.confirm_backup")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(b,{onClick:()=>{p&&o("confirmation",{title:t("settings_modal.maintenance.title"),message:t("settings_modal.maintenance.confirm_final"),confirmLabel:t("settings_modal.maintenance.cleanup_duplicate"),variant:"danger",onConfirm:async()=>{try{const a=await Ne(p);v(t("settings_modal.maintenance.cleanup_success").replace("{count}",String(a)),"success"),a>0&&setTimeout(()=>{window.location.reload()},1e3)}catch(a){console.error(a),v(t("settings_modal.maintenance.cleanup_fail").replace("{error}",a.message),"error")}}})},disabled:!U,variant:"danger",className:"flex-1",children:t("settings_modal.maintenance.cleanup_duplicate")}),e.jsx(b,{onClick:()=>{p&&o("confirmation",{title:t("settings_modal.maintenance.cleanup_old"),message:`${t("settings_modal.maintenance.cleanup_old_desc")}

${t("settings_modal.maintenance.confirm_final")}`,confirmLabel:t("modal.ok"),variant:"danger",onConfirm:async()=>{try{const a=await _e(p);v(t("settings_modal.maintenance.cleanup_success").replace("{count}",String(a)),"success")}catch(a){console.error(a),v(t("settings_modal.maintenance.cleanup_fail").replace("{error}",a.message),"error")}}})},disabled:!U,variant:"danger",className:"flex-1",children:t("settings_modal.maintenance.cleanup_old")})]})]})})]})]})]})})};export{Be as SettingsModal};
