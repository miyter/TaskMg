import{j as r,r as u,R as D}from"./react-vendor-De2reJJN.js";import{u as R,a as z,z as L,A,b as G,D as K,E as O,F as Q,I as P,B,G as T}from"./main-DtKxsxrw.js";import"./i18n-YbRa781D.js";import"./firebase-lj-RYa46.js";import{E as U}from"./ErrorMessage-B0ErqnNj.js";import{M as W}from"./Modal-rUWnqeIQ.js";import"./vendor-DCNAVw4P.js";import"./dnd-WiqQl0IC.js";import"./date-fns-0kIV_IaA.js";function b({title:c,items:d,selectedItems:n,onToggle:j,labelFn:t=s=>s.name??s.id??String(s)}){return r.jsxs("div",{className:"flex flex-col min-h-[10rem] max-h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:[r.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500 uppercase tracking-wider shrink-0",children:c}),r.jsx("div",{className:"p-2 overflow-y-auto space-y-1 custom-scrollbar flex-1",children:d.map(s=>{const i=s.id||s.toString(),a=n.includes(i),m=`filter-${c.replace(/ /g,"-")}-${i}`,x=t(s);return r.jsxs("div",{className:"flex items-center px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group",onClick:()=>j(i),children:[r.jsx("input",{id:m,type:"checkbox",checked:a,onChange:()=>{},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer","aria-label":`${c}: ${x}`}),r.jsx("label",{htmlFor:m,className:"ml-2 text-sm text-gray-700 dark:text-gray-300 truncate flex-1 cursor-pointer pointer-events-none",children:x})]},i)})})]})}const k="none",H=c=>{const d=T(c);return{project:d.projects,timeblock:d.timeBlocks.map(n=>n==="null"||n==="none"?k:n),duration:d.durations.map(n=>n.toString()),date:d.dates}},J=[30,45,60,75,90],oe=({isOpen:c,data:d,zIndex:n,overlayClassName:j})=>{const{t}=R(),{closeModal:s}=z(),i=!!c,a=d,m=!!(a!=null&&a.id),{projects:x}=L(),{timeBlocks:E}=A(),{workspaceId:v}=G(),[f,S]=u.useState(""),[l,C]=u.useState({project:[],timeblock:[],duration:[],date:[]}),[_,h]=u.useState(!1),[w,p]=u.useState(null),I=D.useRef(null);u.useEffect(()=>{i&&(S((a==null?void 0:a.name)||""),C(H((a==null?void 0:a.query)||"")),p(null),h(!1))},[i,a]),u.useEffect(()=>{var e;w&&((e=I.current)==null||e.focus())},[w]);const y=(e,g)=>{C(o=>{const N=o[e],$=N.includes(g)?N.filter(q=>q!==g):[...N,g];return{...o,[e]:$}})},F=u.useCallback(async()=>{const e=f.trim();if(!e){p(t("validation.filter_name_required"));return}const g=K({projects:l.project,timeBlocks:l.timeblock.map(o=>o===k?"null":o),durations:l.duration.map(Number),dates:l.date});if(!g){p(t("validation.filter_condition_required"));return}h(!0),p(null);try{if(!v){p(t("validation.workspace_required")),h(!1);return}const o={name:e,query:g,type:"custom"};m&&(a!=null&&a.id)?await O(v,a.id,o):await Q({...o,workspaceId:v}),s()}catch(o){p(t("validation.save_fail")+": "+(o.message||"Error")),h(!1)}},[f,l,m,a,s,t]),M=e=>{e.key==="Enter"&&!e.nativeEvent.isComposing&&(!_&&f.trim()&&F(),e.preventDefault())};return i?r.jsx(W,{isOpen:i,onClose:s,title:t(m?"filter_edit_title":"filter_create_title"),size:"xl",className:"w-full h-[90vh] sm:h-auto",zIndex:n,overlayClassName:j,children:r.jsxs("div",{className:"space-y-6",children:[r.jsx("div",{children:r.jsx(P,{ref:I,id:"filter-name-input",name:"filterName",label:t("filter_name"),type:"text",value:f,onChange:e=>S(e.target.value),onKeyDown:M,placeholder:t("modal.filter_name_placeholder"),autoFocus:!0,maxLength:10})}),r.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[r.jsx(b,{title:t("project"),items:x,selectedItems:l.project,onToggle:e=>y("project",e)}),r.jsx(b,{title:t("timeblock"),items:[...E,{id:k,name:t("sidebar.unassigned")}],selectedItems:l.timeblock,onToggle:e=>y("timeblock",e),labelFn:e=>e.id===k||!e.start?e.name:`${e.start}-${e.end}`}),r.jsx(b,{title:t("modal.duration"),items:J.map(e=>({id:e.toString(),name:`${e} min`})),selectedItems:l.duration,onToggle:e=>y("duration",e)}),r.jsx(b,{title:t("modal.due_date"),items:[{id:"today",name:t("date_options.today")},{id:"tomorrow",name:t("date_options.tomorrow")},{id:"week",name:t("date_options.week")},{id:"next-week",name:t("date_options.next_week")}],selectedItems:l.date,onToggle:e=>y("date",e)})]}),r.jsx(U,{message:w}),r.jsxs("div",{className:"flex justify-end items-center gap-3 pt-3 border-t border-gray-100 dark:border-gray-700",children:[r.jsx(B,{variant:"ghost",size:"sm",onClick:s,disabled:_,children:t("modal.cancel")}),r.jsx(B,{variant:"primary",size:"sm",onClick:F,isLoading:_,children:t(m?"modal.save":"modal.create")})]})]})}):null};export{oe as FilterEditModal};
