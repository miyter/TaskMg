import{c as D,d as i,j as e}from"./vendor-j1jwJuCp.js";import{T as le}from"./firebase-CTDNBn9D.js";import{u as V,o as g,_ as ne,$ as ie,a0 as de,a1 as ce,a2 as ue,a3 as me,a4 as he,a5 as pe,a6 as xe,j as ge,V as be,M as ye,K as ke,a7 as ve,a8 as fe,a9 as je,aa as _e,ab as we,ac as Ne,B as k,ad as Ce,f as De,ae as Ie,af as Se,S as C,p as Te,H as Ae}from"./main-DP3x7AFG.js";import{u as Le}from"./i18n-DnoxxtLm.js";import{E as Me}from"./ErrorMessage-B01ntcHN.js";import{M as Be}from"./Modal-C8UH6Z5J.js";import{I as U}from"./Input-De1UEU8G.js";import{i as Ee,a as Oe,b as Re,u as ze,E as Ke}from"./editor-d_YbrVPU.js";const h=({onClick:d,isActive:p,disabled:u,children:b,title:t})=>e.jsx("button",{type:"button",onClick:d,disabled:u,title:t,className:g("p-1.5 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors text-gray-600 dark:text-gray-300",p&&"bg-blue-50 dark:bg-blue-900/40 text-blue-600 dark:text-blue-300",u&&"opacity-50 cursor-not-allowed"),children:b}),He=({value:d,onChange:p,placeholder:u="Write something...",className:b,editable:t=!0})=>{const{t:n}=V(),_=D.useMemo(()=>[Ee.configure({link:!1}),Oe.configure({placeholder:u}),Re.configure({openOnClick:!1,linkOnPaste:!0})],[u]),s=ze({extensions:_,content:d,editable:t,onUpdate:D.useCallback(({editor:c})=>{p(c.getHTML())},[p]),editorProps:D.useMemo(()=>({attributes:{class:g("prose prose-sm dark:prose-invert max-w-none focus:outline-none min-h-[150px] px-3 py-2","prose-p:my-1 prose-headings:my-2 prose-ul:my-1 prose-ol:my-1 prose-li:my-0",!t&&"min-h-0")}}),[t])});if(i.useEffect(()=>{if(s&&d!==s.getHTML()){if(s.getText()===""&&d==="")return;s.isEmpty&&d&&s.commands.setContent(d)}},[s,d]),!s)return null;const r=()=>{const c=s.getAttributes("link").href,v=window.prompt("URL",c);if(v!==null){if(v===""){s.chain().focus().extendMarkRange("link").unsetLink().run();return}s.chain().focus().extendMarkRange("link").setLink({href:v}).run()}};return e.jsxs("div",{className:g("border border-gray-200 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-800 transition-colors focus-within:ring-2 focus-within:ring-blue-500/50",b),children:[t&&e.jsxs("div",{className:"flex flex-wrap items-center gap-1 p-1 border-b border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-900/30",children:[e.jsx(h,{onClick:()=>s.chain().focus().toggleBold().run(),isActive:s.isActive("bold"),title:n("rich_text.bold"),children:e.jsx(ne,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleItalic().run(),isActive:s.isActive("italic"),title:n("rich_text.italic"),children:e.jsx(ie,{className:"w-4 h-4"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx(h,{onClick:()=>s.chain().focus().toggleHeading({level:1}).run(),isActive:s.isActive("heading",{level:1}),title:n("rich_text.heading"),children:e.jsx(de,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleBulletList().run(),isActive:s.isActive("bulletList"),title:n("rich_text.bullet_list"),children:e.jsx(ce,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleOrderedList().run(),isActive:s.isActive("orderedList"),title:n("rich_text.ordered_list"),children:e.jsx(ue,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleTaskList().run(),isActive:s.isActive("taskList"),title:n("rich_text.task_list"),disabled:!0,children:e.jsx(me,{className:"w-4 h-4 opacity-50"})}),e.jsx("div",{className:"w-px h-4 bg-gray-300 dark:bg-gray-600 mx-1"}),e.jsx(h,{onClick:r,isActive:s.isActive("link"),title:n("rich_text.link"),children:e.jsx(he,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleCodeBlock().run(),isActive:s.isActive("codeBlock"),title:n("rich_text.code_block"),children:e.jsx(pe,{className:"w-4 h-4"})}),e.jsx(h,{onClick:()=>s.chain().focus().toggleBlockquote().run(),isActive:s.isActive("blockquote"),title:n("rich_text.blockquote"),children:e.jsx(xe,{className:"w-4 h-4"})})]}),e.jsx(Ke,{editor:s,className:"min-h-[150px]"})]})},W={TODO:"todo"},$=({children:d,onClick:p,isOpen:u,isCollapsible:b,className:t})=>{const n="w-full flex items-center justify-between text-[10px] font-bold text-gray-400 uppercase tracking-widest pb-1 border-b border-gray-100 dark:border-gray-800 transition-colors";return b?e.jsxs("button",{type:"button",onClick:p,"aria-expanded":u,className:g(n,"group hover:text-blue-500 focus:outline-none focus:border-blue-500",t),children:[e.jsx("span",{className:"flex items-center gap-2",children:d}),e.jsx(Ae,{className:g("w-3 h-3 transition-transform duration-200",u?"rotate-180":"")})]}):e.jsx("div",{className:g(n,t),children:d})},Xe=({isOpen:d,data:p,zIndex:u,overlayClassName:b})=>{const{t}=V(),{closeModal:n,openModal:_}=ge(),s=!!d,r=p||null,c=!(r!=null&&r.id)||r.id.startsWith("temp-"),{projects:v}=be(),{timeBlocks:Q}=ye(),{customDurations:X}=Le(),[w,E]=i.useState(""),[I,O]=i.useState(""),[N,R]=i.useState(null),[z,G]=i.useState(W.TODO),[y,K]=i.useState(!1),[f,S]=i.useState(null),[o,T]=i.useState({type:"none",days:[]}),[A,H]=i.useState(null),[L,P]=i.useState(null),[M,F]=i.useState(!1),q=D.useRef(null),J=i.useMemo(()=>[{value:"none",label:t("recurrence.none")},{value:"daily",label:t("recurrence.daily")},{value:"weekdays",label:t("recurrence.weekdays")},{value:"weekly",label:t("recurrence.weekly")},{value:"monthly",label:t("recurrence.monthly")}],[t]),Y=i.useMemo(()=>[t("days.sun"),t("days.mon"),t("days.tue"),t("days.wed"),t("days.thu"),t("days.fri"),t("days.sat")],[t]),[Z,j]=i.useState(null);i.useEffect(()=>{if(r){E(r.title||""),O(r.description||""),R(r.projectId||null),G(r.status||W.TODO),K(!!r.isImportant),H(r.timeBlockId||null),P(r.duration||null);const a=ke(r.dueDate);S(a);const l=r.recurrence||{type:"none",days:[]};T(l),l!=null&&l.type&&l.type!=="none"&&!a&&S(ve(l));const m=!!(a||(l==null?void 0:l.type)!=="none"||r.timeBlockId||r.duration);F(m||c)}},[r,s]);const B=i.useCallback(async()=>{j(null);const a={title:w.trim(),recurrence:(o==null?void 0:o.type)==="none"?null:o},l=fe(je.pick({title:!0,recurrence:!0}),a,!1);if(!l.success){j(l.errorMessage||t("validation.validation_error"));return}const m={title:w.trim(),description:I.trim()??null,projectId:N==="none"?null:N,status:z,isImportant:y,dueDate:f?le.fromDate(f):null,recurrence:(o==null?void 0:o.type)==="none"?null:o,timeBlockId:A??null,duration:L??void 0};try{c?await _e(m):await we(r.id,m),n()}catch(x){console.error("Failed to save task",x),j(t("validation.save_fail"))}},[w,I,N,z,y,f,o,A,L,c,r,n,t]),ee=i.useCallback(async a=>{a==null||a.preventDefault(),a==null||a.stopPropagation(),j(null),!(!(r!=null&&r.id)||c)&&_("confirmation",{title:t("delete"),message:t("modal.delete_confirm"),confirmLabel:t("delete"),variant:"danger",onConfirm:async()=>{try{await Ne(r.id),n()}catch(l){console.error("Failed to delete task",l),j(t("validation.delete_fail"))}}})},[r==null?void 0:r.id,c,n,_,t]),ae=i.useCallback(a=>{let l=[];a==="weekly"?l=(o==null?void 0:o.days)||[]:a==="weekdays"&&(l=[1,2,3,4,5]),T({type:a,days:l})},[o==null?void 0:o.days]),te=i.useCallback(a=>{const l=(o==null?void 0:o.days)||[],m=l.includes(a)?l.filter(x=>x!==a):[...l,a].sort((x,oe)=>x-oe);T({type:"weekly",days:m})},[o==null?void 0:o.days]),se=a=>{a.key==="Enter"&&!a.nativeEvent.isComposing&&(a.preventDefault(),B())},re=a=>{(a.metaKey||a.ctrlKey)&&a.key==="Enter"&&(a.preventDefault(),B())};return s?e.jsx(Be,{isOpen:s,onClose:n,zIndex:u,size:"xl",className:"h-[95vh] sm:h-[85vh] w-full mx-2 sm:mx-auto mt-4 sm:mt-0 pb-safe",overlayClassName:b,children:e.jsxs("div",{className:"flex flex-col h-full",onKeyDown:re,children:[e.jsxs("div",{className:"px-modal py-2 border-b border-gray-100 dark:border-gray-700 flex items-center gap-2 shrink-0",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx(U,{id:"task-title",name:"title",type:"text",value:w,onChange:a=>E(a.target.value),onKeyDown:se,placeholder:t("task_detail.title_placeholder"),className:"text-base sm:text-lg font-semibold bg-transparent border-none focus:ring-0 px-0 py-0 shadow-none h-auto rounded-none",containerClassName:"gap-0",autoFocus:!0,"aria-label":t("task_detail.title_placeholder"),maxLength:15})}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>K(!y),className:g("p-1.5 rounded-md transition-colors",y?"text-yellow-500 hover:bg-yellow-50 dark:hover:bg-yellow-900/30":"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"),title:t(y?"task_detail.unmark_important":"task_detail.mark_important"),"aria-label":t(y?"task_detail.unmark_important":"task_detail.mark_important"),children:e.jsx(Ce,{size:16,fill:y?"currentColor":"none"})}),e.jsx(k,{variant:"ghost",size:"icon",onClick:n,className:"p-1.5 rounded-md text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":t("modal.close"),children:e.jsx(De,{size:16})})]})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-modal custom-scrollbar",children:[e.jsx(Me,{message:Z,className:"mb-3"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-6 h-full",children:[e.jsx("div",{className:"md:col-span-8 flex flex-col h-full min-h-[400px]",children:e.jsx(He,{value:I,onChange:O,placeholder:t("task_detail.description_placeholder"),className:"flex-1 flex flex-col"},(r==null?void 0:r.id)||"new")}),e.jsx("div",{className:"hidden md:block col-span-1 w-px bg-gray-100 dark:bg-gray-800 h-full mx-auto"}),e.jsxs("div",{className:"md:col-span-3 space-y-5 pt-1 overflow-y-auto no-scrollbar",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx($,{isCollapsible:!0,isOpen:M,onClick:()=>F(!M),children:t("task_detail.schedule_label")}),M&&e.jsxs("div",{className:"space-y-3 px-1 animate-in slide-in-from-top-1 fade-in duration-200",children:[e.jsx("div",{className:"relative group",children:e.jsx("div",{className:"relative cursor-pointer",onClick:()=>{var a;return(a=q.current)==null?void 0:a.showPicker()},children:e.jsx(U,{ref:q,type:"date",id:"task-due-date",label:t("task_detail.due_date_label"),value:f?Ie(f):"",onChange:a=>S(Se(a.target.value)),className:"cursor-pointer bg-transparent border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors text-sm rounded px-2 py-1.5 h-auto w-full"})})}),e.jsx("div",{children:e.jsx(C,{id:"task-recurrence",label:t("task_detail.recurrence_label"),value:(o==null?void 0:o.type)||"none",onChange:a=>ae(a.target.value),className:"bg-transparent border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors text-sm rounded px-2 py-1.5 h-auto",options:J})}),((o==null?void 0:o.type)==="weekly"||(o==null?void 0:o.type)==="weekdays")&&e.jsx("div",{className:"pt-2 animate-in fade-in slide-in-from-top-1 duration-200",children:e.jsx("div",{className:"flex flex-wrap gap-1.5",children:Y.map((a,l)=>{var x;const m=(x=o.days)==null?void 0:x.includes(l);return e.jsx(k,{type:"button",variant:m?"primary":"outline",size:"icon",onClick:()=>te(l),className:g("w-7 h-7 text-xs rounded-full p-0 border",!m&&"bg-transparent text-gray-500 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"),children:a},l)})})}),e.jsx("div",{children:e.jsxs(C,{id:"task-timeblock",label:t("task_detail.time_block_label"),value:A||"",onChange:a=>H(a.target.value||null),className:"bg-transparent border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors text-sm rounded px-2 py-1.5 h-auto",children:[e.jsx("option",{value:"",children:t("task_detail.time_block_unspecified")}),Q.map(a=>e.jsxs("option",{value:a.id,children:[a.start," - ",a.end]},a.id))]})}),e.jsx("div",{children:e.jsxs(C,{id:"task-duration",label:t("task_detail.duration_label"),value:L||"",onChange:a=>P(a.target.value?parseInt(a.target.value,10):null),className:"bg-transparent border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors text-sm rounded px-2 py-1.5 h-auto",children:[e.jsx("option",{value:"",children:t("task_detail.duration_none")}),X.map(a=>e.jsxs("option",{value:a,children:[a," ",t("task_detail.duration_unit")]},a))]})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx($,{children:t("task_detail.project_label")}),e.jsx("div",{className:"px-1",children:e.jsxs(C,{id:"task-project",value:N||"none",onChange:a=>R(a.target.value==="none"?null:a.target.value),className:"bg-transparent border border-gray-200 dark:border-gray-700 hover:border-blue-400 dark:hover:border-blue-500 transition-colors text-sm rounded px-2 py-1.5 h-auto",containerClassName:"gap-2",children:[e.jsx("option",{value:"none",children:t("task_detail.project_none")}),v.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})})]})]})]})]}),e.jsxs("div",{className:"px-modal py-2 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center shrink-0",children:[c?e.jsx("div",{}):e.jsx(k,{variant:"ghost",size:"sm",onClick:ee,className:"text-gray-400 hover:text-red-500 font-medium px-2",leftIcon:e.jsx(Te,{size:14}),children:t("task_detail.delete_button")}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(k,{variant:"ghost",size:"sm",onClick:n,className:"font-medium",children:t("modal.cancel")}),e.jsx(k,{variant:"primary",size:"sm",onClick:B,children:t(c?"modal.create":"modal.save")})]})]})]})}):null};export{Xe as TaskDetailModal};
