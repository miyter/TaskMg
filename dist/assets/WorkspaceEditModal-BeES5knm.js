import{r as l,R as C,j as r}from"./react-vendor-DDdoHvMu.js";import{u as E,j as N,x as y,y as W,z as D,A as M,D as S,E as R,B as g}from"./main-C6MtqIFH.js";import{E as I}from"./ErrorMessage-sCAOwXXn.js";import{M as L}from"./Modal-CiEOda-4.js";import{I as z}from"./Input-B8JvqnmM.js";import"./vendor-BH6fgtF9.js";import"./firebase-KXKkrMez.js";import"./i18n-T70mTwBZ.js";const P=({isOpen:_,data:b,zIndex:A})=>{const{t:a}=E(),{closeModal:s,openModal:c}=N(),m=!!_,e=b,n=!!(e!=null&&e.id),[f,h]=l.useState(""),[p,d]=l.useState(!1),[x,o]=l.useState(null),v=C.useRef(null);l.useEffect(()=>{m&&(h((e==null?void 0:e.name)||""),o(null),d(!1))},[m,e]),l.useEffect(()=>{var t;x&&((t=v.current)==null||t.focus())},[x]);const k=l.useCallback(async()=>{const t=f.trim();if(!t){o(a("validation.workspace_name_required"));return}d(!0),o(null);try{if(y().some(i=>i.name===t&&i.id!==(e==null?void 0:e.id))){o(a("validation.workspace_duplicate")),d(!1);return}if(await W(t,(e==null?void 0:e.id)||null)){o(a("validation.workspace_duplicate")),d(!1);return}if(n&&(e!=null&&e.id))await D(e.id,t),s();else{const i=await M(t);i!=null&&i.id?(s(),c("confirmation",{title:a("modal.workspace_create_title"),message:a("validation.workspace_confirm_switch"),confirmLabel:a("modal.ok"),onConfirm:()=>S(i.id)})):s()}}catch(u){o(a("validation.save_fail")+": "+(u.message||"Error")),d(!1)}},[f,n,e,s,c,a]),j=l.useCallback(()=>{if(!(e!=null&&e.id))return;if(y().length<=1){o(a("validation.workspace_delete_last")||"Cannot delete the last workspace.");return}s(),c("confirmation",{title:a("delete"),message:a("msg.confirm_delete_workspace")||`Are you sure you want to delete workspace "${e.name}"?`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{try{await R(e.id)}catch(u){console.error("Failed to delete workspace:",u)}}})},[e,s,c,a]),w=t=>{t.key==="Enter"&&!t.nativeEvent.isComposing&&k()};return m?r.jsx(L,{isOpen:m,onClose:s,className:"max-w-md",children:r.jsxs("div",{className:"flex flex-col gap-6 max-h-[85vh] overflow-y-auto p-1",children:[r.jsx("div",{children:r.jsx(z,{ref:v,id:"workspace-name-input",name:"workspaceName",label:a(n?"modal.workspace_edit_title":"modal.workspace_create_title"),type:"text",value:f,onChange:t=>h(t.target.value),onKeyDown:w,placeholder:a("modal.workspace_name_placeholder"),className:"w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600 px-0 py-0 h-auto focus:ring-0",autoFocus:!0})}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed",children:a(n?"modal.workspace_desc_edit":"modal.workspace_desc_create")}),r.jsx(I,{message:x}),r.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("div",{children:n&&r.jsx(g,{onClick:j,disabled:p,variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 px-2",children:a("delete")})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(g,{onClick:s,disabled:p,variant:"ghost",className:"text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",children:a("modal.cancel")}),r.jsx(g,{onClick:k,disabled:p,isLoading:p,variant:"primary",children:a(n?"modal.save":"modal.create")})]})]})]})}):null};export{P as WorkspaceEditModal};
