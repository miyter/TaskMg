import{r as k,j as e}from"./react-vendor-De2reJJN.js";import{a5 as O,a6 as K,a7 as D,R as te,f as j,u as z,A as ae,b as se,a as $,B as f,a1 as M,I as C,a8 as J,Y as q,U as B,a9 as re,g as ne,a4 as oe,a3 as le,aa as ie,ab as ce,ac as de,ad as me,h as ge,ae as ue,$ as W,af as xe,ag as pe}from"./main-CWFzE4NY.js";import{u as G}from"./i18n-YbRa781D.js";import{M as he}from"./Modal-BZ4FPY-m.js";import{g as V,c as X,w as Y,d as H,q as be,a as fe,s as ye,E as ke,l as je}from"./firebase-lj-RYa46.js";import{s as ve}from"./date-fns-C4HQ7vGy.js";import"./vendor-DCNAVw4P.js";import"./dnd-WiqQl0IC.js";async function we(s){const i=O.currentUser;if(!i)throw new Error("User not authenticated");const m=K.tasks(i.uid,s),u=(await V(X(D,m))).docs.map(n=>({id:n.id,...n.data()})),o=new Map;for(const n of u){if(!n.title)continue;const c=n.title.trim(),d=o.get(c)||[];d.push(n),o.set(c,d)}const r=[];for(const[n,c]of o.entries())if(c.length>1){c.sort((g,h)=>{const v=y=>{if(!y)return 0;if(typeof y=="object"&&"toDate"in y&&typeof y.toDate=="function")return y.toDate().getTime();const b=new Date(y);return isNaN(b.getTime())?0:b.getTime()},l=v(g.createdAt),x=v(h.createdAt);return l-x});const d=c.slice(1);for(const g of d)g.id&&r.push(g.id)}if(r.length>0)for(let n=0;n<r.length;n+=500){const c=Y(D),d=r.slice(n,n+500);for(const g of d)c.delete(H(D,m,g));await c.commit()}return r.length}async function Ne(s){const i=O.currentUser;if(!i)throw new Error("User not authenticated");const m=K.tasks(i.uid,s),t=be(X(D,m),fe("status","==","completed")),u=await V(t),o=ve(new Date,30),r=[];for(const c of u.docs){const d={id:c.id,...c.data()};if(!d.isDetailPurged&&d.completedAt){const g=te(d.completedAt);g&&g<o&&(d.description||!d.isDetailPurged)&&r.push(d)}}if(r.length===0)return 0;let n=0;for(let c=0;c<r.length;c+=500){const d=Y(D),g=r.slice(c,c+500);for(const h of g)d.update(H(D,m,h.id),{description:"",isDetailPurged:!0}),n++;await d.commit()}return n}const T=({title:s,children:i,defaultOpen:m=!1,icon:t,className:u})=>{const[o,r]=k.useState(m);return e.jsxs("section",{className:j("border border-gray-200 dark:border-gray-700/50 rounded-xl overflow-hidden",u),children:[e.jsxs("button",{onClick:()=>r(!o),className:"w-full flex items-center justify-between p-4 bg-gray-50/50 dark:bg-gray-800/30 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",type:"button","aria-expanded":o,"aria-controls":`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[t&&e.jsx("span",{className:"text-lg",children:t}),e.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:s})]}),e.jsx("svg",{className:j("w-4 h-4 text-gray-400 transition-transform duration-200",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx("div",{id:`accordion-panel-${s.replace(/\s+/g,"-").toLowerCase()}`,className:j("transition-all duration-100 ease-in-out overflow-hidden bg-white dark:bg-transparent",o?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700/30",children:i})})]})},_e=()=>{const{t:s}=z(),{customDurations:i,setCustomDurations:m}=G(),t=[15,30,45,60,75,90,105,120],u=o=>{i.includes(o)?m(i.filter(r=>r!==o)):m([...i,o].sort((r,n)=>r-n))};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"â±ï¸"})," ",s("durations")]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:t.map(o=>{const r=i.includes(o);return e.jsxs("button",{onClick:()=>u(o),className:j("flex flex-col items-center justify-center p-2 rounded-lg border text-sm font-medium transition-all duration-200",r?"bg-blue-600 text-white border-blue-600 shadow-md transform scale-105":"bg-white dark:bg-gray-700 text-gray-700 dark:text-gray-200 border-gray-200 dark:border-gray-600 hover:bg-gray-50 dark:hover:bg-gray-600"),children:[e.jsx("span",{children:o}),e.jsx("span",{className:"text-[10px] opacity-80",children:"min"})]},o)})}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.duration.description")||"Select preset durations available in task details."})]})},Ce=()=>{const{t:s}=z(),{timeBlocks:i}=ae(),{workspaceId:m}=se(),{openModal:t}=$(),[u,o]=k.useState(null),[r,n]=k.useState({}),c=l=>{o(l.id||null),n({...l})},d=()=>{o("new"),n({name:"",start:"09:00",end:"10:00",color:B.DEFAULT_COLORS.TIME_BLOCK})},g=()=>{o(null),n({})},h=async()=>{!m||!r.start||!r.end||(await oe(m,r),o(null),n({}))},v=(l,x)=>{m&&t("confirmation",{title:s("delete"),message:`${s("timeblocks")}: ${x||"Time Block"} 
${s("msg.confirm_delete")} `,confirmLabel:s("delete"),variant:"danger",onConfirm:async()=>{await le(m,l)}})};return e.jsxs("div",{className:"space-y-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-xl border border-gray-100 dark:border-gray-700",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-gray-100 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ“…"})," ",s("timeblocks")]}),u!=="new"&&e.jsxs(f,{onClick:d,size:"sm",variant:"ghost",className:"text-blue-600 hover:bg-blue-50 dark:text-blue-400 dark:hover:bg-blue-900/20 h-8 px-2",children:[e.jsx(M,{className:"w-4 h-4 mr-1"}),s("add")]})]}),e.jsxs("div",{className:"space-y-2",children:[i.length===0&&u!=="new"&&e.jsx("div",{className:"text-sm text-gray-500 italic py-2",children:s("no_items")||"No time blocks defined."}),i.map(l=>e.jsx("div",{className:"group flex items-center gap-3 p-3 bg-white dark:bg-gray-700/30 rounded-lg border border-gray-200 dark:border-gray-600 shadow-sm transition-all",children:u===l.id?e.jsxs("div",{className:"flex-1 grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(C,{value:r.name||"",onChange:x=>n({...r,name:x.target.value}),placeholder:"Name (Optional)",className:"h-8 text-sm col-span-2 sm:col-span-1"}),e.jsx(C,{type:"time",value:r.start||"",onChange:x=>n({...r,start:x.target.value}),className:"h-8 text-sm"}),e.jsx(C,{type:"time",value:r.end||"",onChange:x=>n({...r,end:x.target.value}),className:"h-8 text-sm"}),e.jsxs("div",{className:"flex items-center gap-1 justify-end col-span-2 sm:col-span-1",children:[e.jsx(f,{onClick:h,size:"sm",variant:"primary",className:"h-8 w-8 p-0 rounded-full",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(f,{onClick:g,size:"sm",variant:"ghost",className:"h-8 w-8 p-0 rounded-full text-gray-500",children:e.jsx(q,{className:"w-4 h-4"})})]})]}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-1 h-8 rounded-full flex-shrink-0",style:{backgroundColor:l.color||B.DEFAULT_COLORS.TIME_BLOCK_INACTIVE}}),e.jsxs("div",{className:"flex-1 min-w-0 grid grid-cols-2 sm:grid-cols-3 gap-2 text-sm",children:[e.jsx("span",{className:"font-bold text-gray-800 dark:text-gray-200 truncate",children:l.name||"(No Name)"}),e.jsxs("span",{className:"font-mono text-gray-500 text-xs sm:text-sm",children:[l.start," - ",l.end]})]}),e.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[e.jsx("button",{onClick:()=>c(l),className:"p-1.5 text-gray-400 hover:text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/20 rounded",children:e.jsx(re,{className:"w-4 h-4"})}),e.jsx("button",{onClick:()=>v(l.id,l.name||""),className:"p-1.5 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded",children:e.jsx(ne,{className:"w-4 h-4"})})]})]})},l.id)),u==="new"&&e.jsx("div",{className:"p-3 bg-blue-50 dark:bg-blue-900/10 rounded-lg border border-blue-200 dark:border-blue-800 animate-in fade-in slide-in-from-top-2",children:e.jsxs("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 items-center",children:[e.jsx(C,{value:r.name||"",onChange:l=>n({...r,name:l.target.value}),placeholder:"Name",className:"h-9 text-sm col-span-2 sm:col-span-1 bg-white dark:bg-gray-800",autoFocus:!0}),e.jsx(C,{type:"time",value:r.start||"",onChange:l=>n({...r,start:l.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsx(C,{type:"time",value:r.end||"",onChange:l=>n({...r,end:l.target.value}),className:"h-9 text-sm bg-white dark:bg-gray-800"}),e.jsxs("div",{className:"flex items-center gap-2 justify-end col-span-2 sm:col-span-1",children:[e.jsx(f,{onClick:h,size:"sm",variant:"primary",className:"h-9 w-9 p-0 rounded-full",children:e.jsx(J,{className:"w-4 h-4"})}),e.jsx(f,{onClick:g,size:"sm",variant:"ghost",className:"h-9 w-9 p-0 rounded-full text-gray-500 hover:bg-white dark:hover:bg-gray-800",children:e.jsx(q,{className:"w-4 h-4"})})]})]})})]}),e.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 mt-2",children:s("settings_modal.timeblocks.description")||"Time blocks help you organize your day."})]})},Se=()=>{const{t:s}=z(),{user:i}=ie(),{openModal:m}=$(),[t,u]=k.useState(""),[o,r]=k.useState(""),[n,c]=k.useState(!1),[d,g]=k.useState(!1),[h,v]=k.useState(null);if(!i)return e.jsx("div",{className:"text-center text-gray-500",children:s("settings_modal.account.not_logged_in")});const l=i.isAnonymous,x=async b=>{b.preventDefault(),g(!0),v(null);try{const S=ke.credential(t,o);await je(i,S),me.success(s("settings_modal.account.register_success"))}catch(S){console.error("Link account error:",S);let p=s("settings_modal.account.register_fail");S.code==="auth/email-already-in-use"&&(p=s("settings_modal.account.already_in_use")),S.code==="auth/weak-password"&&(p=s("settings_modal.account.weak_password")),v(p)}finally{g(!1)}},y=()=>{m("confirmation",{title:s("settings_modal.account.logout"),message:s("settings_modal.account.logout_confirm"),confirmLabel:s("settings_modal.account.logout"),variant:"danger",onConfirm:async()=>{await ye(O),window.location.reload()}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-6 flex flex-col sm:flex-row items-center gap-8 sm:gap-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-3xl shrink-0",children:l?"ðŸ•µï¸":"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:l?s("settings_modal.account.guest_user"):i.displayName||s("settings_modal.account.registered_user")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono mb-4 break-all",children:l?`ID: ${i.uid.slice(0,8)}...`:i.email}),!l&&e.jsx(f,{variant:"ghost",size:"sm",onClick:y,className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 font-bold",children:s("settings_modal.account.logout")})]})]}),l?e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx("svg",{className:"w-32 h-32 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"})," ",s("settings_modal.account.persist_account")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6 leading-relaxed whitespace-pre-wrap",children:s("settings_modal.account.persist_desc")}),e.jsxs("form",{onSubmit:x,className:"space-y-4 max-w-md",children:[h&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-lg font-medium",children:h}),e.jsx(C,{id:"account-email",type:"email",label:s("settings_modal.account.email_label"),required:!0,value:t,onChange:b=>u(b.target.value),placeholder:"mail@example.com",autoComplete:"email"}),e.jsx(C,{id:"account-password",type:n?"text":"password",label:s("settings_modal.account.password_label"),required:!0,minLength:6,value:o,onChange:b=>r(b.target.value),placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"new-password",rightIcon:e.jsx("button",{type:"button",onClick:()=>c(!n),className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none p-1 pointer-events-auto","aria-label":s(n?"settings_modal.account.hide_password":"settings_modal.account.show_password"),children:n?e.jsx(ce,{size:20}):e.jsx(de,{size:20})})}),e.jsx(f,{type:"submit",isLoading:d,className:"w-full",rightIcon:d?void 0:e.jsx("span",{children:"â†’"}),children:s("settings_modal.account.register")})]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:s("settings_modal.account.registered_msg")})})]})},A=({active:s,onClick:i,label:m,icon:t})=>e.jsxs("button",{onClick:i,className:j("flex items-center gap-2 px-4 py-2 text-sm rounded-lg transition-all whitespace-nowrap min-w-0","md:w-full md:justify-start md:text-left md:py-2","flex-col w-full justify-center py-3 text-[10px] gap-1 rounded-none md:rounded-lg md:text-sm md:flex-row md:gap-3",s?"bg-white dark:bg-gray-800 shadow-sm text-blue-600 dark:text-blue-400 font-bold border-t-2 md:border-t-0 md:border md:border-gray-100 dark:md:border-gray-700 border-blue-500 md:border-transparent":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-200 border-t-2 md:border-t-0 border-transparent"),children:[e.jsx("span",{className:"text-lg md:text-base",children:t}),e.jsx("span",{className:"truncate font-medium",children:m})]}),ze=({isOpen:s,zIndex:i,overlayClassName:m})=>{const{t}=z(),{closeModal:u,openModal:o}=$(),{themeMode:r,setThemeMode:n,density:c,setDensity:d,fontSize:g,setFontSize:h,fontEn:v,setFontEn:l,fontJp:x,setFontJp:y,language:b,setLanguage:S}=G(),{currentWorkspaceId:p}=ge(),{addToast:w}=ue(),[N,I]=k.useState("appearance"),[U,Q]=k.useState(!1),Z=!!s;return e.jsx(he,{isOpen:Z,onClose:u,title:t("settings_modal.title"),className:"w-full h-full p-0 overflow-hidden",zIndex:i,size:"xl",variant:"side-right",overlayClassName:m,children:e.jsxs("div",{className:"flex flex-col md:flex-row h-full",children:[e.jsx("div",{className:"order-last md:order-first w-full md:w-64 bg-white dark:bg-gray-900 md:bg-gray-50/50 md:dark:bg-gray-900/50 border-t md:border-t-0 md:border-r border-gray-200 dark:border-gray-700 shrink-0 z-10",children:e.jsxs("div",{className:"flex flex-row md:flex-col justify-around md:justify-start md:p-4 md:space-y-2 pb-safe md:pb-4",children:[e.jsx(A,{active:N==="general",onClick:()=>I("general"),label:t("settings_modal.tabs.general"),icon:"âš™ï¸"}),e.jsx(A,{active:N==="appearance",onClick:()=>I("appearance"),label:t("settings_modal.tabs.appearance"),icon:"ðŸŽ¨"}),e.jsx(A,{active:N==="schedule",onClick:()=>I("schedule"),label:t("settings_modal.tabs.schedule")||"Schedule",icon:"ðŸ“…"}),e.jsx(A,{active:N==="security",onClick:()=>I("security"),label:t("settings_modal.tabs.security"),icon:"ðŸ”"})]})}),e.jsxs("div",{className:"flex-1 p-4 md:p-6 overflow-y-auto custom-scrollbar bg-white dark:bg-gray-900 order-first md:order-last relative",children:[N==="appearance"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(T,{title:t("settings_modal.appearance.theme"),icon:"ðŸŒ“",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["light","dark","system"].map(a=>e.jsx("button",{onClick:()=>n(a),"aria-pressed":r===a,className:j("p-3 border rounded-xl text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-blue-500",r===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:e.jsx("span",{className:"capitalize",children:t(`settings_modal.options.theme.${a}`)})},a))})}),e.jsx(T,{title:t("settings_modal.appearance.density"),icon:"ðŸ“",defaultOpen:!1,children:e.jsx("div",{className:"space-y-3",children:["compact","normal","comfortable","spacious"].map(a=>e.jsxs("label",{htmlFor:`density-${a}`,className:j("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors focus-within:ring-2 focus-within:ring-blue-500",c===a?"border-blue-500 bg-blue-50 dark:bg-blue-900/10":"border-transparent hover:bg-white dark:hover:bg-gray-800"),children:[e.jsx("div",{className:j("w-4 h-4 rounded-full border flex items-center justify-center",c===a?"border-blue-500 bg-blue-500":"border-gray-300"),children:c===a&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("input",{id:`density-${a}`,type:"radio",name:"density",checked:c===a,onChange:()=>d(a),className:"sr-only"}),e.jsx("span",{className:"capitalize text-sm font-medium text-gray-700 dark:text-gray-300",children:t(`settings_modal.options.density.${a}`)})]},a))})}),e.jsx(T,{title:t("settings_modal.appearance.font_size"),icon:"Aa",defaultOpen:!1,children:e.jsx("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:["sm","base","md","lg","xl"].map(a=>e.jsx("button",{onClick:()=>h(a),className:j("flex-1 py-1.5 px-3 rounded text-sm font-medium transition-all",g===a?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:a},a))})}),e.jsxs(T,{title:t("settings_modal.appearance.fonts"),icon:"Tt",defaultOpen:!1,children:[e.jsx(W,{id:"settings-font-en",name:"fontEn",label:t("settings_modal.appearance.font_en"),value:v,onChange:a=>l(a.target.value),options:B.FONTS.EU}),e.jsx(W,{id:"settings-font-jp",name:"fontJp",label:t("settings_modal.appearance.font_jp"),value:x,onChange:a=>y(a.target.value),options:B.FONTS.JP})]})]}),N==="schedule"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsx(T,{title:t("time_block.settings_title"),icon:"ðŸ“…",defaultOpen:!0,children:e.jsx(Ce,{})}),e.jsx(T,{title:t("task_detail.duration_label")||"Duration",icon:"â±ï¸",defaultOpen:!1,children:e.jsx(_e,{})})]}),N==="general"&&e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¾"})," ",t("settings_modal.backup.title")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:t("settings_modal.backup.description")}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx(f,{onClick:async()=>{if(!(!O.currentUser||!p))try{const a=await xe(O.currentUser.uid,p),L=new Blob([JSON.stringify(a,null,2)],{type:"application/json"}),E=URL.createObjectURL(L),_=document.createElement("a");_.href=E,_.download=`taskmg-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(E),w(t("settings_modal.backup.create_success"),"success")}catch(a){console.error(a),w(t("settings_modal.backup.create_fail"),"error")}},variant:"premium",leftIcon:e.jsx(M,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.create")}),e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx("input",{type:"file",accept:".json",className:"hidden",id:"backup-import-input",onChange:a=>{var E;const L=(E=a.target.files)==null?void 0:E[0];!L||!O.currentUser||!p||(a.target.value="",o("confirmation",{title:t("settings_modal.backup.import"),message:t("settings_modal.backup.import_confirm"),confirmLabel:t("modal.ok"),variant:"danger",onConfirm:()=>{const _=new FileReader;_.onload=async ee=>{var P;try{const F=JSON.parse((P=ee.target)==null?void 0:P.result),R=await pe(O.currentUser.uid,p,F);w(t("settings_modal.backup.import_success").replace("{tasks}",String(R.tasksCount)).replace("{projects}",String(R.projectsCount)),"success"),setTimeout(()=>window.location.reload(),1e3)}catch(F){console.error(F),w(t("settings_modal.backup.import_fail"),"error")}},_.readAsText(L)}}))}}),e.jsx(f,{variant:"secondary",onClick:()=>{var a;return(a=document.getElementById("backup-import-input"))==null?void 0:a.click()},leftIcon:e.jsx(M,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:t("settings_modal.backup.import")})]})]})]}),e.jsx(T,{title:t("settings_modal.language.title"),icon:"ðŸŒ",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{code:"ja",label:"æ—¥æœ¬èªž"},{code:"en",label:"English"}].map(a=>e.jsxs("button",{onClick:()=>S(a.code),"aria-pressed":b===a.code,className:j("p-3 border rounded-xl text-sm font-medium transition-all focus:outline-none focus:ring-2 focus:ring-blue-500",b===a.code?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:[e.jsx("span",{className:"text-xl mr-2",children:a.code==="ja"?"ðŸ‡¯ðŸ‡µ":"ðŸ‡ºðŸ‡¸"}),a.label]},a.code))})})]}),N==="security"&&e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx(Se,{}),e.jsx("hr",{className:"border-gray-200 dark:border-gray-700 my-2"}),e.jsx("div",{className:"flex flex-col gap-3",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/30",children:[e.jsxs("h4",{className:"font-bold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ§¹"})," ",t("settings_modal.maintenance.title")]}),e.jsx("p",{className:"text-sm text-red-600/80 dark:text-red-400/80 mb-4",children:t("settings_modal.maintenance.description")}),e.jsxs("label",{htmlFor:"backup-confirm-checkbox",className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{id:"backup-confirm-checkbox",name:"backupConfirmed",type:"checkbox",className:"w-4 h-4 text-red-600 rounded border-red-300 focus:ring-red-500",checked:U,onChange:a=>Q(a.target.checked)}),e.jsx("span",{className:"text-sm font-bold text-red-700 dark:text-red-400",children:t("settings_modal.maintenance.confirm_backup")})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[e.jsx(f,{onClick:()=>{p&&o("confirmation",{title:t("settings_modal.maintenance.title"),message:t("settings_modal.maintenance.confirm_final"),confirmLabel:t("settings_modal.maintenance.cleanup_duplicate"),variant:"danger",onConfirm:async()=>{try{const a=await we(p);w(t("settings_modal.maintenance.cleanup_success").replace("{count}",String(a)),"success"),a>0&&setTimeout(()=>{window.location.reload()},1e3)}catch(a){console.error(a),w(t("settings_modal.maintenance.cleanup_fail").replace("{error}",a.message),"error")}}})},disabled:!U,variant:"danger",className:"flex-1",children:t("settings_modal.maintenance.cleanup_duplicate")}),e.jsx(f,{onClick:()=>{p&&o("confirmation",{title:t("settings_modal.maintenance.cleanup_old"),message:`${t("settings_modal.maintenance.cleanup_old_desc")}

${t("settings_modal.maintenance.confirm_final")}`,confirmLabel:t("modal.ok"),variant:"danger",onConfirm:async()=>{try{const a=await Ne(p);w(t("settings_modal.maintenance.cleanup_success").replace("{count}",String(a)),"success")}catch(a){console.error(a),w(t("settings_modal.maintenance.cleanup_fail").replace("{error}",a.message),"error")}}})},disabled:!U,variant:"danger",className:"flex-1",children:t("settings_modal.maintenance.cleanup_old")})]})]})})]})]})]})})};export{ze as SettingsModal};
