const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FilterEditModal-CeHtcitM.js","assets/react-vendor-D2I7O6xs.js","assets/vendor-CBsUEP5T.js","assets/vendor-DKQ_J0ve.css","assets/i18n-CkMKOdEg.js","assets/firebase-Dk4oNdYC.js","assets/ErrorMessage-ysv-5oYb.js","assets/Modal-D4Lhsglk.js","assets/dnd-BYudv-0e.js","assets/LabelEditModal-H3f7qhdR.js","assets/ProjectEditModal-ByHA5MDP.js","assets/SettingsModal-BXRVrA0z.js","assets/TaskDetailModal-C2qrhKhJ.js","assets/TimeBlockEditModal-D_gtRMHR.js","assets/WorkspaceEditModal-BQ2Q1gLj.js","assets/WikiFrameworkModal-onCFu8SS.js","assets/ConfirmationModal-DFReklaz.js"])))=>i.map(i=>d[i]);
var Ar=Object.defineProperty;var Mr=(e,t,s)=>t in e?Ar(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s;var se=(e,t,s)=>Mr(e,typeof t!="symbol"?t+"":t,s);import{r as k,j as r,c as we,R as D,u as Bt,b as Rr,a as Fr,d as Lr,Q as Pr}from"./react-vendor-D2I7O6xs.js";import{e as Fe,f as gt,C as ht,S as mt,v as pt,u as $t,a as We,s as Or,K as Br,P as Wt,D as zt,c as qt,d as ft,T as $r,p as Wr,r as zr}from"./dnd-BYudv-0e.js";import{a as At,i as qr,b as Ur,e as Kr,f as Vr,h as Hr,j as Ut,k as Gr,T as Le,q as ge,o as xt,c as M,m as je,n as Kt,p as Xr,g as ce,r as V,t as Z,d as W,u as De,v as Te,x as Yr,y as Vt,s as Jr,z as Qr,w as bt,A as Ht}from"./firebase-Dk4oNdYC.js";import{u as $,g as Ee,i as Zr}from"./i18n-CkMKOdEg.js";import{t as es,d as ts,p as Ue,u as Gt,e as rs,f as ss,g as b,h as q,j as ae,k as G,l as ze,m as Xt,q as Yt,v as as,w as ns,x as os}from"./vendor-CBsUEP5T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function s(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=s(n);fetch(n.href,o)}})();const is="modulepreload",ls=function(e){return"/"+e},Mt={},ne=function(t,s,a){let n=Promise.resolve();if(s&&s.length>0){let i=function(d){return Promise.all(d.map(g=>Promise.resolve(g).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=i(s.map(d=>{if(d=ls(d),d in Mt)return;Mt[d]=!0;const g=d.endsWith(".css"),u=g?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const p=document.createElement("link");if(p.rel=g?"stylesheet":is,g||(p.as="script"),p.crossOrigin="",p.href=d,c&&p.setAttribute("nonce",c),document.head.appendChild(p),g)return new Promise((y,x)=>{p.addEventListener("load",y),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})},cs={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function ds(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return window.GLOBAL_FIREBASE_CONFIG;try{const e=cs;if(e&&e.VITE_FIREBASE_API_KEY)return{apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}const me=ds();if(!(me!=null&&me.apiKey)||!(me!=null&&me.projectId)){const e="[Firebase] Configuration is missing required fields (apiKey, projectId). Application cannot start.";throw console.error(e,me),new Error(e)}let at;At().length>0?at=At()[0]:at=qr(me);const Jt=at,T=Ur(Jt,{persistence:Hr,popupRedirectResolver:Vr}),j=Kr(Jt),A=()=>{const e=$(s=>s.language);return k.useMemo(()=>Ee(e),[e])},us=()=>{const{t:e}=A(),[t,s]=k.useState(""),[a,n]=k.useState(""),[o,i]=k.useState(!1),[l,c]=k.useState(null),d=async u=>{u.preventDefault(),c(null),i(!0);try{await Ut(T,t,a)}catch(p){let y=e("login.error.login_fail");switch(p.code){case"auth/invalid-email":y=e("login.error.invalid_email");break;case"auth/user-disabled":y=e("login.error.user_disabled");break;case"auth/user-not-found":y=e("login.error.user_not_found");break;case"auth/wrong-password":y=e("login.error.wrong_password");break;case"auth/too-many-requests":y=e("login.error.too_many_requests");break;case"auth/network-request-failed":y=e("login.error.network_error");break}c(y)}finally{i(!1)}},g=async()=>{c(null),i(!0);try{await Gr(T)}catch(u){c(e("login.error.guest_fail").replace("{message}",u.message))}finally{i(!1)}};return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-premium-gradient p-4 antialiased",children:r.jsxs("div",{className:"max-w-md w-full p-6 sm:p-8 bg-white/70 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/30 rounded-[2rem] shadow-2xl transition-all duration-300",children:[r.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[r.jsx("div",{className:"inline-flex items-center justify-center p-4 bg-white dark:bg-gray-700 rounded-3xl shadow-lg mb-6 animate-float",children:r.jsx("img",{src:"/images/web-app-manifest-512x512.png",alt:"Logo",className:"h-12 w-12"})}),r.jsxs("h1",{className:"text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight",children:["Task",r.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:e("login.tagline")})]}),r.jsxs("form",{onSubmit:d,className:"space-y-5 sm:space-y-6",children:[l&&r.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-xl font-medium animate-in fade-in slide-in-from-top-4 duration-300 shadow-sm",children:l}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"login-email",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.email_label")}),r.jsx("input",{id:"login-email",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:u=>s(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"mail@example.com"})]}),r.jsxs("div",{children:[r.jsx("label",{htmlFor:"login-password",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.password_label")}),r.jsx("input",{id:"login-password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:a,onChange:u=>n(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),r.jsx("button",{type:"submit",disabled:o,className:"btn-premium w-full py-4 text-lg shadow-lg hover:shadow-xl active:scale-[0.98] transition-all",children:e(o?"login.signing_in":"login.signin")})]}),r.jsxs("div",{className:"mt-8",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 flex items-center",children:r.jsx("div",{className:"w-full border-t border-gray-200/50 dark:border-gray-700/50"})}),r.jsx("div",{className:"relative flex justify-center text-xs",children:r.jsx("span",{className:"px-3 bg-transparent text-gray-400 uppercase tracking-widest font-bold",children:e("login.or")})})]}),r.jsxs("button",{onClick:g,disabled:o,className:"mt-8 w-full py-3.5 bg-gray-100/50 hover:bg-gray-200/70 active:bg-gray-300 dark:bg-gray-700/30 dark:hover:bg-gray-600/50 dark:active:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-3 border border-transparent hover:border-gray-300 dark:hover:border-gray-600",children:[r.jsx("span",{className:"text-xl",children:"ðŸ•µï¸"})," ",e("login.guest_login")]})]})]})})},gs={success:3e3,info:4e3,error:6e3},Oe=new Map,hs=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,11),$e=we(e=>({toasts:[],addToast:(t,s="info")=>{const a=hs();e(i=>({toasts:[...i.toasts,{id:a,message:t,type:s}]}));const n=gs[s],o=setTimeout(()=>{e(i=>({toasts:i.toasts.filter(l=>l.id!==a)})),Oe.delete(a)},n);Oe.set(a,o)},removeToast:t=>{const s=Oe.get(t);s&&(clearTimeout(s),Oe.delete(t)),e(a=>({toasts:a.toasts.filter(n=>n.id!==t)}))}})),C={success:e=>$e.getState().addToast(e,"success"),error:e=>$e.getState().addToast(e,"error"),info:e=>$e.getState().addToast(e,"info")};function I(...e){return es(ts(e))}const ms=()=>{const{toasts:e,removeToast:t}=$e();return e.length===0?null:r.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:e.map(s=>r.jsx("div",{onClick:()=>t(s.id),className:I("pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-xl shadow border text-sm font-medium cursor-pointer hover:opacity-90",s.type==="success"&&"bg-white dark:bg-gray-800 text-green-600 dark:text-green-400 border-green-200 dark:border-green-900",s.type==="error"&&"bg-white dark:bg-gray-800 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900",s.type==="info"&&"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-700"),children:r.jsxs("div",{className:"flex items-start gap-3",children:[s.type==="success"&&r.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),s.type==="error"&&r.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.type==="info"&&r.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.jsx("p",{className:"leading-5 flex-1",children:s.message}),r.jsx("button",{onClick:a=>{a.stopPropagation(),t(s.id)},className:"flex-shrink-0 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"é–‰ã˜ã‚‹",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})},s.id))})},v={Z_INDEX:{BASE:0,SIDEBAR_BACKDROP:20,SIDEBAR_MOBILE:30,SIDEBAR_RESIZER:40,DROPDOWN:50,STICKY:100,MODAL_BACKDROP:9990,MODAL:9991,POPOVER_BACKDROP:9998,POPOVER:9999,TOOLTIP:1e4,TOAST:10001},DEFAULT_COLORS:{PROJECT:"#7E57C2",PROJECT_INACTIVE:"#cccccc",LABEL:"#42A5F5",TIME_BLOCK:"#3B82F6",TIME_BLOCK_INACTIVE:"#cccccc",LABEL_INACTIVE:"#9ca3af"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},SIDEBAR_DENSITY:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},DND:{PREFIX_TASK:"task:",PREFIX_PROJECT:"project:",PREFIX_FILTER:"filter:",TYPE_PROJECT:"project",TYPE_INBOX:"inbox",TYPE_TIMEBLOCK:"timeblock",TYPE_LABEL:"label",TOUCH_DELAY:250},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order",FONT_EN:"font_family_en",FONT_JP:"font_family_jp",FONT_SIZE:"fontSize"},SIDEBAR:{MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DURATIONS:[30,45,60,75,90]},TIME_BLOCK:{MAX_COUNT:10,DEFAULTS:[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}]},LAYOUT:{CONTAINER_WIDTH_CLASS:"w-full max-w-full",MOBILE_SIDEBAR_WIDTH_PX:280},FONTS:{EU:[{label:"Google Sans",value:'"Google Sans", Inter, sans-serif'},{label:"Inter",value:"Inter, sans-serif"},{label:"Roboto",value:"Roboto, sans-serif"},{label:"System UI",value:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}],JP:[{label:"M PLUS 2",value:'"M PLUS 2", sans-serif'},{label:"Noto Sans JP",value:'"Noto Sans JP", sans-serif'},{label:"Hiragino / Yu Gothic",value:'"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif'}]}},ps=[{value:"#EF5350",key:"red"},{value:"#EC407A",key:"pink"},{value:"#AB47BC",key:"purple"},{value:"#7E57C2",key:"deep_purple"},{value:"#5C6BC0",key:"indigo"},{value:"#42A5F5",key:"blue"},{value:"#29B6F6",key:"light_blue"},{value:"#26C6DA",key:"cyan"},{value:"#26A69A",key:"teal"},{value:"#66BB6A",key:"green"},{value:"#9CCC65",key:"light_green"},{value:"#D4E157",key:"lime"},{value:"#FFEE58",key:"yellow"},{value:"#FFCA28",key:"amber"},{value:"#FFA726",key:"orange"},{value:"#FF7043",key:"deep_orange"},{value:"#8D6E63",key:"brown"},{value:"#BDBDBD",key:"grey"},{value:"#78909C",key:"blue_grey"}];ps.map(e=>e.value);const fs=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),oe=we(e=>({stack:[],openModal:(t,s=null)=>{if(!t)return;const n={id:fs(),type:t,data:s};e(o=>({stack:[...o.stack,n]}))},closeModal:()=>e(t=>t.stack.length===0?t:{stack:t.stack.slice(0,-1)}),closeAllModals:()=>e({stack:[]})})),xs=1024,yt=we()(Ue(e=>({sidebarWidth:v.SIDEBAR.DEFAULT_WIDTH,isSidebarOpen:!0,sidebarDensity:"normal",setSidebarWidth:t=>{const s=Math.max(v.SIDEBAR.MIN_WIDTH,Math.min(t,v.SIDEBAR.MAX_WIDTH));e({sidebarWidth:s})},toggleSidebar:()=>e(t=>({isSidebarOpen:!t.isSidebarOpen})),setSidebarOpen:t=>e({isSidebarOpen:t}),setSidebarDensity:t=>e({sidebarDensity:t})}),{name:"ui-storage",partialize:e=>({sidebarWidth:e.sidebarWidth,sidebarDensity:e.sidebarDensity,isSidebarOpen:e.isSidebarOpen}),onRehydrateStorage:()=>e=>{typeof window<"u"&&window.innerWidth<xs&&(e==null||e.setSidebarOpen(!1))}})),E=(e,t="0 0 24 24")=>({className:s,size:a,strokeWidth:n=2,...o})=>r.jsx("svg",{className:I("w-4 h-4",s),width:a,height:a,fill:"none",stroke:"currentColor",viewBox:t,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",...o,children:e}),bs=E(r.jsx("path",{d:"M4 6h16M4 12h16M4 18h16"})),ys=E(r.jsx("path",{d:"M18 6L6 18M6 6l12 12"})),Qt=E(r.jsx("path",{d:"M12 5v14M5 12h14"})),Ke=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M3 6h18"}),r.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})]})),Ve=E(r.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),"0 0 24 24"),Zt=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),Pe=E(r.jsx("path",{d:"M20 6L9 17l-5-5"})),Ae=E(r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"11",cy:"11",r:"8"}),r.jsx("path",{d:"M21 21l-4.35-4.35"})]})),ai=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),r.jsx("path",{d:"M12 9v4M12 17h.01"})]})),kt=E(r.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})),ni=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),r.jsx("path",{d:"M14 2v6h6"}),r.jsx("path",{d:"M16 13H8"}),r.jsx("path",{d:"M16 17H8"}),r.jsx("path",{d:"M10 9H8"})]})),ks=E(r.jsx("path",{d:"M15 18l-6-6 6-6"})),Me=E(r.jsx("path",{d:"M9 18l6-6-6-6"})),er=E(r.jsx("path",{d:"M6 9l6 6 6-6"})),ws=E(r.jsx("path",{d:"M18 15l-6-6-6 6"})),js=E(r.jsx("path",{d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})),tr=E(r.jsx("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})),rr=E(r.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})),sr=E(r.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})),vs=E(r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"9",cy:"12",r:"1"}),r.jsx("circle",{cx:"9",cy:"5",r:"1"}),r.jsx("circle",{cx:"9",cy:"19",r:"1"}),r.jsx("circle",{cx:"15",cy:"12",r:"1"}),r.jsx("circle",{cx:"15",cy:"5",r:"1"}),r.jsx("circle",{cx:"15",cy:"19",r:"1"})]})),qe=E(r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})),ar=E(r.jsxs(r.Fragment,{children:[r.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),r.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"}),r.jsx("path",{d:"M8 14h.01"}),r.jsx("path",{d:"M12 14h.01"}),r.jsx("path",{d:"M16 14h.01"}),r.jsx("path",{d:"M8 18h.01"}),r.jsx("path",{d:"M12 18h.01"}),r.jsx("path",{d:"M16 18h.01"})]})),nr=E(r.jsxs(r.Fragment,{children:[r.jsx("circle",{cx:"12",cy:"12",r:"10"}),r.jsx("path",{d:"M12 6v6l4 2"})]})),Ns=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17 1l4 4-4 4"}),r.jsx("path",{d:"M3 11V9a4 4 0 014-4h14"}),r.jsx("path",{d:"M7 23l-4-4 4-4"}),r.jsx("path",{d:"M21 13v2a4 4 0 01-4 4H3"})]})),or=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M4 11V4h16v7"}),r.jsx("path",{d:"M4 11h5.8a2.2 2.2 0 004.4 0H20v8a1 1 0 01-1 1H5a1 1 0 01-1-1v-8z"})]})),_s=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"}),r.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})),oi=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),r.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),ii=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),r.jsx("path",{d:"M1 1l22 22"})]})),li=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"}),r.jsx("path",{d:"M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"})]})),ci=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M19 4h-9"}),r.jsx("path",{d:"M14 20H5"}),r.jsx("path",{d:"M15 4L9 20"})]})),di=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M8 6h13"}),r.jsx("path",{d:"M8 12h13"}),r.jsx("path",{d:"M8 18h13"}),r.jsx("path",{d:"M3 6h.01"}),r.jsx("path",{d:"M3 12h.01"}),r.jsx("path",{d:"M3 18h.01"})]})),ui=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M10 6h11"}),r.jsx("path",{d:"M10 12h11"}),r.jsx("path",{d:"M10 18h11"}),r.jsx("path",{d:"M4 6h1v4"}),r.jsx("path",{d:"M4 10h2"}),r.jsx("path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"})]})),gi=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M6 4v16"}),r.jsx("path",{d:"M18 4v16"}),r.jsx("path",{d:"M6 12h12"})]})),hi=E(r.jsxs(r.Fragment,{children:[r.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"}),r.jsx("path",{d:"M16 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"})]})),Is=({className:e,size:t,...s})=>r.jsxs("svg",{className:I("animate-spin",e),width:t||16,height:t||16,fill:"none",viewBox:"0 0 24 24",...s,children:[r.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),r.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Cs="/assets/logo-BADOZ29k.png",ee=we()(Ue(e=>({filterType:"inbox",targetId:null,query:"",showCompleted:!1,sortCriteria:"createdAt_desc",setFilter:(t,s=null)=>e({filterType:t,targetId:s,query:""}),setSearchQuery:t=>e({query:t,filterType:"search"}),clearFilter:()=>e({filterType:"inbox",targetId:null,query:""}),setShowCompleted:t=>e({showCompleted:t}),setSortCriteria:t=>e({sortCriteria:t})}),{name:"filter-storage",partialize:e=>({filterType:e.filterType,targetId:e.targetId,query:e.query,showCompleted:e.showCompleted,sortCriteria:e.sortCriteria})})),te=we()(Ue(e=>({currentView:"tasks",viewData:null,setView:(t,s=null)=>e({currentView:t,viewData:s})}),{name:"view-storage",partialize:e=>({currentView:e.currentView})})),Ds=()=>{const{t:e}=A(),{query:t,setFilter:s}=ee(),{currentView:a,setView:n}=te(),o=a==="search",i=()=>{s("search"),n("search")};return r.jsxs("button",{onClick:i,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-all duration-200 group ${o?"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-400"}`,"aria-label":e("sidebar.search_placeholder"),children:[r.jsx(Ae,{className:`w-4 h-4 transition-colors ${o?"text-blue-600 dark:text-blue-400":"text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300"}`}),r.jsx("span",{className:"flex-1 text-sm font-medium",children:t?`"${t}"`:e("sidebar.search_placeholder")}),r.jsx("span",{className:"text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"/"})]})},Ts=({children:e})=>{const{sidebarWidth:t,isSidebarOpen:s,sidebarDensity:a,toggleSidebar:n,setSidebarWidth:o}=yt(),{t:i}=A(),l={compact:"p-1",normal:"p-2",comfortable:"p-4",spacious:"p-6"}[a];D.useEffect(()=>{const d=u=>{if(!document.body.classList.contains("resizing"))return;const p=Math.max(v.SIDEBAR.MIN_WIDTH,Math.min(v.SIDEBAR.MAX_WIDTH,u.clientX));o(p)},g=()=>{document.body.classList.remove("resizing"),document.body.style.cursor="default"};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",g),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",g)}},[o]);const c=()=>{document.body.classList.add("resizing"),document.body.style.cursor="col-resize"};return r.jsxs("aside",{className:I("h-full transition-all duration-300 flex flex-col group relative","bg-white dark:bg-gray-900 lg:bg-white/70 lg:dark:bg-gray-800/60","lg:backdrop-blur-xl","border-r border-gray-200/50 dark:border-gray-700/30",s?"translate-x-0":"-translate-x-full lg:translate-x-0","fixed lg:relative lg:z-0 shadow-2xl lg:shadow-none overflow-hidden","w-[var(--sidebar-mobile)] lg:w-[var(--sidebar-desktop)]"),style:{"--sidebar-desktop":`${t}px`,"--sidebar-mobile":s?`${v.LAYOUT.MOBILE_SIDEBAR_WIDTH_PX}px`:"0px",width:s?void 0:"0px",zIndex:window.innerWidth<1024?v.Z_INDEX.SIDEBAR_MOBILE:void 0},children:[r.jsxs("div",{className:"h-14 flex items-center px-4 flex-shrink-0 justify-between border-b border-gray-100 dark:border-gray-800/50",children:[r.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none",children:[r.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/20",children:r.jsx("img",{src:Cs,alt:"L",className:"h-5 w-5 invert brightness-0"})}),r.jsxs("span",{className:"text-lg font-black text-gray-900 dark:text-white tracking-tight",children:["Task",r.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]})]}),r.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-900 dark:hover:text-white p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all active:scale-90",title:i(s?"sidebar.toggle_collapse":"sidebar.toggle_expand"),"aria-label":i(s?"sidebar.toggle_collapse":"sidebar.toggle_expand"),children:r.jsx(js,{className:I("w-5 h-5 transition-transform duration-300",!s&&"rotate-180"),strokeWidth:2.5})})]}),r.jsx("div",{className:"px-3 pb-2 pt-2",children:r.jsx(Ds,{})}),r.jsx("div",{className:I("flex-1 overflow-y-auto custom-scrollbar pt-2",l),children:e}),r.jsx("div",{role:"separator","aria-orientation":"vertical","aria-label":i("sidebar.resizer_label"),"aria-valuenow":t,"aria-valuemin":v.SIDEBAR.MIN_WIDTH,"aria-valuemax":v.SIDEBAR.MAX_WIDTH,tabIndex:s?0:-1,onMouseDown:c,onKeyDown:d=>{d.key==="ArrowLeft"?o(Math.max(v.SIDEBAR.MIN_WIDTH,t-10)):d.key==="ArrowRight"&&o(Math.min(v.SIDEBAR.MAX_WIDTH,t+10))},className:I("absolute top-0 right-0 w-3 h-full cursor-col-resize transition-colors hidden lg:flex items-center justify-center outline-none focus:bg-blue-500","hover:bg-blue-500/30 active:bg-blue-600/50 group/resizer"),style:{zIndex:v.Z_INDEX.SIDEBAR_RESIZER},title:i("sidebar.resizer_hint"),children:r.jsx("div",{className:"absolute w-1 h-12 bg-gray-400 dark:bg-gray-500 rounded-full opacity-0 group-hover/resizer:opacity-100 group-focus/resizer:opacity-100 transition-opacity pointer-events-none"})}),r.jsx("div",{className:"absolute top-0 right-0 w-[1px] h-full bg-gray-200/50 dark:bg-gray-700/30 hidden lg:block"})]})},de=Gt([rs(),ss(Le),b().datetime({offset:!0}).or(b().datetime())]).nullable().optional(),Es=q({type:ze(["none","daily","weekly","weekdays","monthly"]).default("none"),days:ae(G().min(0).max(6)).optional()}).nullable(),wt=q({id:b().optional(),title:b().refine(e=>e.length>=1,{params:{i18n:"validation.title_required"}}),description:b().nullable().optional(),status:ze(["todo","completed","archived"]).default("todo"),dueDate:de,completedAt:de,createdAt:de,ownerId:b(),projectId:b().nullable().optional(),labelIds:ae(b()).optional(),timeBlockId:b().nullable().optional(),duration:G().refine(e=>e>=0,{params:{i18n:"validation.duration_invalid"}}).optional(),isImportant:Xt().default(!1),recurrence:Es,order:G().optional()}),ir=q({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.project_name_required"}}),color:b().optional(),ownerId:b(),createdAt:de,order:G().optional()}),lr=q({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.label_name_required"}}),color:b().optional(),ownerId:b(),workspaceId:b().optional(),createdAt:de,order:G().optional()}),jt=q({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.workspace_name_required"}}),createdAt:de}),cr=q({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.filter_name_required"}}),query:b(),workspaceId:b().optional(),ownerId:b().optional(),createdAt:de}),Rt=b().refine(e=>/^([01]\d|2[0-3]):([0-5]\d)$/.test(e),{params:{i18n:"validation.time_format_invalid"}}),Ss=q({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.timeblock_name_required"}}),start:Rt,end:Rt,color:b().optional(),order:G().optional()});q({id:b().optional(),mode:b(),data:Yt(b(),b()),createdAt:de,updatedAt:de,ownerId:b(),workspaceId:b()});const He=we()(Ue(e=>({currentWorkspaceId:null,workspaces:[],setCurrentWorkspaceId:t=>e({currentWorkspaceId:t}),setWorkspaces:t=>{const s=t.filter(a=>{const n=jt.safeParse(a);return n.success?!0:(console.error("Invalid workspace data:",a,n.error),!1)});e({workspaces:s})}}),{name:"workspace-storage",partialize:e=>({currentWorkspaceId:e.currentWorkspaceId})}));function As(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function nt(e){return`artifacts/${As()}/users/${e}`}function Ie(e,t){return`${nt(e)}/workspaces/${t}`}const N={users:e=>nt(e),workspaces:e=>`${nt(e)}/workspaces`,filters:(e,t)=>`${Ie(e,t)}/filters`,labels:(e,t)=>`${Ie(e,t)}/labels`,timeblocks:(e,t)=>`${Ie(e,t)}/timeblocks`,tasks:(e,t)=>`${Ie(e,t)}/tasks`,projects:(e,t)=>`${Ie(e,t)}/projects`,targets:(e,t)=>`${Ie(e,t)}/targets`},Ms=["permission-denied","invalid-argument","unauthenticated","not-found","already-exists","failed-precondition"];async function L(e,t={}){const s=typeof t=="number"?{maxRetries:t}:t,{maxRetries:a=3,initialDelay:n=1e3,onError:o,onFinalFailure:i}=s;let l;for(let c=0;c<=a;c++)try{return await e()}catch(d){if(l=d,o&&o(d,c),c===a)break;const g=(d==null?void 0:d.code)||"";if(Ms.some(y=>g.includes(y)))throw i&&i(d),d;const p=n*Math.pow(2,c);await new Promise(y=>setTimeout(y,p))}throw i&&i(l),l}class ve{constructor(t){se(this,"cacheMap",new Map);se(this,"listeners",new Map);se(this,"unsubscribes",new Map);se(this,"config");this.config=t}isInitialized(t){return this.cacheMap.has(t)}getItems(t){return this.cacheMap.get(t)||[]}setCache(t,s){this.cacheMap.set(t,s),this.notifyListeners(t)}clearCache(t){var s;t?(this.cacheMap.delete(t),(s=this.unsubscribes.get(t))==null||s(),this.unsubscribes.delete(t),this.listeners.delete(t)):(this.unsubscribes.forEach(a=>a()),this.cacheMap.clear(),this.unsubscribes.clear(),this.listeners.clear())}notifyListeners(t){const s=this.cacheMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...s];a.forEach(o=>o(n))}}registerListener(t,s){this.listeners.has(t)||this.listeners.set(t,new Set);const a=this.listeners.get(t);a.add(s);const n=this.cacheMap.get(t);return n&&queueMicrotask(()=>s([...n])),()=>{var o;a.delete(s),a.size===0&&((o=this.unsubscribes.get(t))==null||o(),this.unsubscribes.delete(t),this.listeners.delete(t))}}setFirestoreSubscription(t,s){this.unsubscribes.has(t)||this.unsubscribes.set(t,s)}hasFirestoreSubscription(t){return this.unsubscribes.has(t)}}class Rs extends ve{constructor(){super({logPrefix:"[WorkspaceCache]"})}getWorkspaces(t){return this.getItems(t)}subscribe(t,s){const a=this.registerListener(t,s);if(!this.hasFirestoreSubscription(t)){const n=N.workspaces(t),o=ge(M(j,n),xt("createdAt","asc"));console.log(`${this.config.logPrefix} Subscribing to path: ${n}`);const i=je(o,l=>{const c=l.docs.map(g=>({id:g.id,...g.data()}));console.log(`${this.config.logPrefix} Received ${c.length} workspaces from Firestore`);const d=c.filter(g=>{const u=jt.safeParse(g);return u.success?!0:(console.error(`${this.config.logPrefix} Invalid workspace data:`,g,u.error),!1)});this.setCache(t,d)},l=>{console.error(`${this.config.logPrefix} Subscription error:`,l),this.setCache(t,[])});this.setFirestoreSubscription(t,i)}return a}}const X=new Rs,Fs=e=>X.isInitialized(e),Ls=e=>X.getWorkspaces(e);function Ps(e,t){return X.subscribe(e,t)}async function dr(e,t){const s=X.getWorkspaces(e);jt.pick({name:!0}).parse({name:t});const a="temp-"+Date.now(),n={id:a,name:t,createdAt:new Date};X.setCache(e,[...s,n]);const o=N.workspaces(e);console.log(`[WorkspaceCache] Adding workspace to path: ${o}`);let i=a;return await L(async()=>{const l=await V(M(j,o),{name:t,createdAt:Z()});i=l.id,console.log(`[WorkspaceCache] Successfully added workspace with ID: ${l.id}`)},{onFinalFailure:()=>{console.error(`[WorkspaceCache] Failed to add workspace: ${t}`),X.setCache(e,s),C.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}}),{id:i,name:t}}async function Os(e,t,s=null){const a=N.workspaces(e),n=ge(M(j,a),Xr("name","==",t),Kt(5));return(await ce(n)).docs.some(i=>i.id!==s)}async function Bs(e,t,s){const a=X.getWorkspaces(e),n=a.map(o=>o.id===t?{...o,...s}:o);X.setCache(e,n),await L(async()=>{const o=N.workspaces(e),i=W(j,o,t);await De(i,s)},{onFinalFailure:()=>{X.setCache(e,a),C.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function $s(e,t){const s=X.getWorkspaces(e),a=s.filter(n=>n.id!==t);X.setCache(e,a),await L(async()=>{const n=N.workspaces(e);await Te(W(j,n,t))},{onFinalFailure:()=>{X.setCache(e,s),C.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ws(e){try{const t=N.workspaces(e);(await ce(ge(M(j,t),Kt(1)))).empty&&await dr(e,"ãƒ¡ã‚¤ãƒ³")}catch(t){console.error("[WorkspaceCache] Failed to ensure default workspace:",t)}}function zs(e){var s;const t=e||((s=T.currentUser)==null?void 0:s.uid);return t?Ls(t):[]}function qs(e){var s;const t=e||((s=T.currentUser)==null?void 0:s.uid);return t?Fs(t):!1}function ie(){return He.getState().currentWorkspaceId}function Us(e){if(!e)return;const t=He.getState();t.currentWorkspaceId!==e&&t.setCurrentWorkspaceId(e)}function Ks(e,t){var o;const s=typeof e=="function"?e:t,a=typeof e=="string"?e:(o=T.currentUser)==null?void 0:o.uid;return a?Ps(a,i=>{i.length===0?Ws(a).catch(l=>console.error("[Workspace] Default creation error:",l)):Vs(i),typeof s=="function"&&s(i)}):(typeof s=="function"&&s([]),()=>{})}function Vs(e){if(e.length===0)return null;const t=He.getState();let s=t.currentWorkspaceId;const a=s?e.some(n=>n.id===s):!1;return(!s||!a)&&(s=e[0].id,t.setCurrentWorkspaceId(s)),s}async function mi(e){const t=T.currentUser;if(!t)throw new Error("Authentication required");return dr(t.uid,e)}async function pi(e,t=null){const s=T.currentUser;return s?Os(s.uid,e,t):!1}async function fi(e,t){const s=T.currentUser;if(!s)throw new Error("Authentication required");return Bs(s.uid,e,{name:t})}async function xi(e){const t=T.currentUser;if(!t)throw new Error("Authentication required");return $s(t.uid,e)}function Re(e){const t=`[ErrorLogger] [${e.type.toUpperCase()}]`,s=e.stack?`
${e.stack}`:"";e.type==="warn"?console.warn(`${t} ${e.message}${s}`):console.error(`${t} ${e.message}${s}`)}function Hs(){window.onerror=(e,t,s,a,n)=>(Re({timestamp:new Date().toISOString(),type:"error",message:String(e),stack:n==null?void 0:n.stack}),!1),window.onunhandledrejection=e=>{const t=e.reason;Re({timestamp:new Date().toISOString(),type:"unhandledrejection",message:(t==null?void 0:t.message)||String(t),stack:t==null?void 0:t.stack})},console.info("[ErrorLogger] Initialized")}function Gs(e,t){Re({timestamp:new Date().toISOString(),type:"react",message:e.message,stack:e.stack})}class Xs{constructor(){se(this,"initialLoginPromise",null)}getCurrentUserId(){var t;return((t=T.currentUser)==null?void 0:t.uid)||null}hasInitialToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return!0;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return!0}catch{}return!1}getInitialAuthToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return window.GLOBAL_INITIAL_AUTH_TOKEN;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return __initial_auth_token}catch{}return null}async tryInitialTokenLogin(){if(this.initialLoginPromise)return this.initialLoginPromise;const t=this.getInitialAuthToken();if(!t){this.initialLoginPromise=Promise.resolve();return}return this.initialLoginPromise=(async()=>{try{await Yr(T,t),console.log("[Auth] Initial token login success")}catch(s){Re({timestamp:new Date().toISOString(),type:"error",message:`Initial token login failed: ${s.message}`,stack:s.stack})}})(),this.initialLoginPromise}initAuthListener(t,s){return this.tryInitialTokenLogin(),Vt(T,n=>{n?t(n):s()})}async loginWithEmail(t,s){return await Ut(T,t,s)}async logout(){try{await Jr(T)}catch(t){throw Re({timestamp:new Date().toISOString(),type:"error",message:`Logout failed: ${t.message}`,stack:t.stack}),t}}async updateUserAuthPassword(t){const s=T.currentUser;if(!s)throw new Error("Authentication required: No current user.");await Qr(s,t)}}const ot=new Xs,Ys=(e,t)=>ot.initAuthListener(e,t),Js={TIMEOUT:{AUTH_LOADING:1e4}},ur=()=>{var i;const[e,t]=k.useState(((i=T.currentUser)==null?void 0:i.uid)||null),[s,a]=k.useState(T.currentUser),[n,o]=k.useState(!0);return k.useEffect(()=>{const l=new AbortController;let c=()=>{},d=null;const g=async()=>{if(ot.hasInitialToken())try{await ot.tryInitialTokenLogin()}catch(u){console.error("[useAuth] Initial token login failed:",u)}l.signal.aborted||(c=Ys(u=>{l.signal.aborted||(t(u.uid),a(u),o(!1),d&&clearTimeout(d))},()=>{l.signal.aborted||(t(null),a(null),o(!1),d&&clearTimeout(d))}))};return d=setTimeout(()=>{l.signal.aborted||(console.warn("[useAuth] Loading timeout reached, forcing loading=false"),o(!1))},Js.TIMEOUT.AUTH_LOADING),g(),()=>{l.abort(),c(),d&&clearTimeout(d)}},[]),{userId:e,user:s,loading:n}},Be=new Map;function Ne(e,t,s,a){const n=Bt(),o=JSON.stringify(e),i=15e3;return k.useEffect(()=>{if(e.some(c=>c==null))return;let l=Be.get(o);return l||(l={count:0,unsubscribe:t(d=>{n.setQueryData(e,d)})},Be.set(o,l)),l.count++,()=>{const c=Be.get(o);c&&(c.count--,c.count===0&&(c.unsubscribe(),Be.delete(o)))}},[o]),Rr({queryKey:e,queryFn:()=>{const l=n.getQueryData(e);return l!==void 0?Promise.resolve(l):s!==void 0?Promise.resolve(s):new Promise(c=>{const d=setTimeout(()=>{const p=n.getQueryData(e);console.debug(`[FirestoreSub] Timeout waiting for data (monitor): ${o}`),c(p??s??null)},i),g=n.getQueryCache().subscribe(p=>{if(p.type==="updated"&&JSON.stringify(p.query.queryKey)===o){const y=p.query.state.data;y!==void 0&&(clearTimeout(d),g(),c(y))}}),u=n.getQueryData(e);u!==void 0&&(clearTimeout(d),g(),c(u))})},initialData:s,staleTime:1/0,gcTime:1e3*60*5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})}const Qs=()=>{const{userId:e,loading:t}=ur(),s=k.useCallback(c=>e?Ks(e,c):()=>{},[e]),n=(e?qs(e):!1)&&e?zs(e):void 0,{data:o,isPending:i}=Ne(["workspaces",e||void 0],s,n);return{workspaces:o||[],loading:t||!!e&&i}},le=()=>{const e=He(a=>a.currentWorkspaceId),{userId:t,loading:s}=ur();return{workspaceId:e,userId:t,loading:s}},Zs=()=>{const{t:e}=A(),{workspaces:t,loading:s}=Qs(),{openModal:a}=oe(),[n,o]=k.useState(!1),i=k.useRef(null),{workspaceId:l}=le(),c=t.find(d=>d.id===l);return k.useEffect(()=>{const d=u=>{i.current&&!i.current.contains(u.target)&&o(!1)},g=u=>{u.key==="Escape"&&o(!1)};return n&&(document.addEventListener("mousedown",d),document.addEventListener("keydown",g)),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",g)}},[n]),s?r.jsx("div",{className:"h-8 w-32 bg-gray-100 dark:bg-gray-800 animate-pulse rounded"}):r.jsxs("div",{className:"relative",ref:i,children:[r.jsxs("button",{onClick:()=>o(!n),className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 transition-colors group","aria-expanded":n,"aria-haspopup":"true",children:[r.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 truncate max-w-[120px] sm:max-w-[140px] md:max-w-[180px]",children:c?c.name:e("loading")}),r.jsx(er,{className:I("w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-transform duration-200",n?"rotate-180":"")})]}),n&&r.jsxs("div",{className:"absolute left-0 mt-2 w-60 sm:w-64 max-w-[calc(100vw-32px)] origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 border border-gray-100 dark:border-gray-700 overflow-hidden animate-scale-in custom-scrollbar",style:{zIndex:v.Z_INDEX.DROPDOWN},children:[r.jsx("div",{className:"p-1 border-b border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:r.jsxs("button",{onClick:()=>{o(!1),a("workspace-edit",null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors rounded-md",children:[r.jsx(Qt,{className:"w-4 h-4 mr-2"}),e("sidebar.add_workspace")]})}),r.jsx("div",{className:"py-1 max-h-[300px] overflow-y-auto custom-scrollbar",children:t.map(d=>{const g=d.id===l;return r.jsxs("div",{className:"flex items-center justify-between group/item px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[r.jsx("button",{onClick:()=>{d.id&&Us(d.id),o(!1)},className:I("flex-1 text-left text-sm truncate mr-2",g?"text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300"),children:r.jsx("span",{className:"truncate block max-w-[120px] sm:max-w-[140px]",children:d.name})}),r.jsxs("div",{className:"flex items-center gap-1",children:[g&&r.jsx(Pe,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),r.jsx("button",{onClick:u=>{u.stopPropagation(),o(!1),a("workspace-edit",d)},className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded opacity-0 group-hover/item:opacity-100 transition-opacity",title:e("edit"),children:r.jsx(Zt,{className:"w-3.5 h-3.5"})})]})]},d.id)})})]})]})},ea=({sidebarContent:e,title:t,children:s})=>{const{toggleSidebar:a,isSidebarOpen:n}=yt(),{t:o}=A(),{openModal:i}=oe();return r.jsxs("div",{className:"w-full h-full flex overflow-hidden bg-premium-gradient text-gray-800 dark:text-white antialiased",children:[n&&r.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm lg:hidden transition-opacity duration-300",style:{zIndex:v.Z_INDEX.SIDEBAR_BACKDROP},onClick:a}),r.jsx(Ts,{children:e}),r.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[r.jsxs("header",{className:"h-12 border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm z-10 sticky top-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[!n&&r.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:o("sidebar.menu_open"),"aria-label":o("sidebar.menu_open"),children:r.jsx(bs,{className:"w-5 h-5"})}),r.jsx(Zs,{}),r.jsx("h1",{className:"font-bold text-lg border-l border-gray-300 dark:border-gray-700 pl-3 ml-1 truncate",children:t})]}),r.jsx("div",{className:"flex items-center gap-2",children:r.jsx("button",{onClick:()=>i("settings"),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Settings","aria-label":"Settings",children:r.jsx(Zt,{className:"w-5 h-5"})})})]}),r.jsx("main",{className:"flex-1 overflow-hidden flex flex-col",id:"main-content",children:r.jsx("div",{className:I("w-full h-full bg-white dark:bg-gray-900 relative flex-1",v.LAYOUT.CONTAINER_WIDTH_CLASS),children:s})})]})]})},ta=D.lazy(()=>ne(()=>import("./FilterEditModal-CeHtcitM.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>({default:e.FilterEditModal}))),ra=D.lazy(()=>ne(()=>import("./LabelEditModal-H3f7qhdR.js"),__vite__mapDeps([9,1,2,3,6,7,8,5,4])).then(e=>({default:e.LabelEditModal}))),sa=D.lazy(()=>ne(()=>import("./ProjectEditModal-ByHA5MDP.js"),__vite__mapDeps([10,1,2,3,6,7,8,5,4])).then(e=>({default:e.ProjectEditModal}))),aa=D.lazy(()=>ne(()=>import("./SettingsModal-BXRVrA0z.js"),__vite__mapDeps([11,1,2,3,4,7,5,8])).then(e=>({default:e.SettingsModal}))),na=D.lazy(()=>ne(()=>import("./TaskDetailModal-C2qrhKhJ.js"),__vite__mapDeps([12,1,2,3,5,4,6,7,8])).then(e=>({default:e.TaskDetailModal}))),oa=D.lazy(()=>ne(()=>import("./TimeBlockEditModal-D_gtRMHR.js"),__vite__mapDeps([13,1,2,3,8,4,6,7,5])).then(e=>({default:e.TimeBlockEditModal}))),ia=D.lazy(()=>ne(()=>import("./WorkspaceEditModal-BQ2Q1gLj.js"),__vite__mapDeps([14,1,2,3,6,7,8,5,4])).then(e=>({default:e.WorkspaceEditModal}))),la=D.lazy(()=>ne(()=>import("./WikiFrameworkModal-onCFu8SS.js"),__vite__mapDeps([15,1,2,3,7,4,8,5])).then(e=>({default:e.WikiFrameworkModal}))),ca=D.lazy(()=>ne(()=>import("./ConfirmationModal-DFReklaz.js"),__vite__mapDeps([16,1,2,3,7,8,5,4])).then(e=>({default:e.ConfirmationModal}))),da=()=>{const{stack:e}=oe();return e.length===0?null:r.jsx(k.Suspense,{fallback:null,children:e.map((t,s)=>{const n=s===0?void 0:"bg-black/30",o={isOpen:!0,data:t.data,zIndex:v.Z_INDEX.MODAL+s*10,overlayClassName:n};switch(t.type){case"settings":return r.jsx(aa,{...o},t.id);case"task-detail":return r.jsx(na,{...o},t.id);case"label-edit":return r.jsx(ra,{...o},t.id);case"project-edit":return r.jsx(sa,{...o},t.id);case"workspace-edit":return r.jsx(ia,{...o},t.id);case"filter-edit":return r.jsx(ta,{...o},t.id);case"timeblock-edit":return r.jsx(oa,{...o},t.id);case"wiki-framework":return r.jsx(la,{...o},t.id);case"confirmation":return r.jsx(ca,{...o},t.id);default:return null}})})};function O(e){if(!e)return null;if(e instanceof Date)return e;if(e.toDate&&typeof e.toDate=="function")return e.toDate();const t=new Date(e);return isNaN(t.getTime())?null:t}const Ft=(e,t)=>{const s=O(e),a=O(t);return!s||!a?!1:s.getFullYear()===a.getFullYear()&&s.getMonth()===a.getMonth()&&s.getDate()===a.getDate()},ua=e=>{const t=O(e);if(!t)return!1;const s=new Date;return t.getFullYear()===s.getFullYear()&&t.getMonth()===s.getMonth()&&t.getDate()===s.getDate()},ga=(e,t=7)=>{const s=O(e);if(!s)return!1;const a=new Date;a.setHours(0,0,0,0);const n=new Date(a);n.setDate(a.getDate()+1);const o=new Date(a);return o.setDate(a.getDate()+t+1),s>=n&&s<o};function Ge(e=new Date){const t=O(e)||new Date,s=new Date(t);return s.setHours(0,0,0,0),s}function ha(e=new Date,t=1){const s=O(e)||new Date,a=s.getDay(),n=s.getDate()-a+(a<t?t-7:t),o=new Date(s);return o.setDate(n),Ge(o)}function Lt(e){const t=O(e);if(!t)return"";const s=new Date,a=Ge(s),n=Math.round((t.getTime()-a.getTime())/(1e3*60*60*24));if(n===0)return"ä»Šæ—¥";if(n===1)return"æ˜Žæ—¥";if(n===-1)return"æ˜¨æ—¥";const o=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return o!==s.getFullYear()?`${o}/${i}/${l}`:`${i}/${l}`}const bi=e=>{const t=O(e);if(!t)return"";const s=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${s}-${a}-${n}`},yi=e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t};function ma(e){const t=O(e);if(!t)return"text-gray-500";const s=Ge(new Date),a=Math.round((t.getTime()-s.getTime())/(1e3*60*60*24));return a<0?"text-red-500 font-bold":a===0?"text-green-600 dark:text-green-400 font-medium":a===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function pa(e,t){var a;if(!e||!(t!=null&&t.type))return null;const s=new Date(O(e));switch(t.type){case"daily":return s.setDate(s.getDate()+1),s;case"weekly":{if(!((a=t.days)!=null&&a.length))return null;const n=s.getDay();for(let o=1;o<=7;o++){const i=(n+o)%7;if(t.days.includes(i))return s.setDate(s.getDate()+o),s}return null}case"weekdays":do s.setDate(s.getDate()+1);while(s.getDay()===0||s.getDay()===6);return s;case"monthly":return s.setMonth(s.getMonth()+1),s;default:return null}}function ki(e){const t=Ge(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&e.days&&e.days.length>0){const s=t.getDay();for(let a=0;a<=6;a++)if(e.days.includes((s+a)%7))return t.setDate(t.getDate()+a),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function fa(e,t){if(!e||!t)return 0;const[s,a]=e.split(":").map(Number),[n,o]=t.split(":").map(Number);if(isNaN(s)||isNaN(a)||isNaN(n)||isNaN(o))return 0;const i=s*60+a;let l=n*60+o;return l<i&&(l+=1440),l-i}const pe=Gt([G(),b(),as(),ns()]),xa=q({id:b(),title:b().min(1),description:b().nullable().optional(),status:ze(["todo","completed","archived"]).optional(),dueDate:pe,completedAt:pe,createdAt:pe,ownerId:b().optional(),projectId:b().nullable().optional(),labelIds:ae(b()).optional(),timeBlockId:b().nullable().optional(),duration:G().optional(),isImportant:Xt().optional(),recurrence:q({type:ze(["none","daily","weekly","weekdays","monthly"]).optional(),days:ae(G()).optional()}).nullable().optional(),order:G().optional()}).passthrough(),ba=q({id:b(),name:b().min(1),color:b().optional(),ownerId:b().optional(),createdAt:pe,order:G().optional()}).passthrough(),ya=q({id:b(),name:b().min(1),color:b().optional(),ownerId:b().optional(),createdAt:pe}).passthrough(),ka=q({id:b(),mode:b(),data:Yt(b(),b()),createdAt:pe,updatedAt:pe,ownerId:b().optional(),workspaceId:b().optional()}).passthrough(),wa=q({id:b(),name:b().min(1),start:b(),end:b(),color:b().optional(),order:G().optional()}).passthrough(),ja=q({id:b(),name:b().min(1),query:b(),createdAt:pe}).passthrough(),va=q({version:b().optional(),exportedAt:b().optional(),userId:b().optional(),workspaceId:b().optional(),tasks:ae(xa).default([]),projects:ae(ba).default([]),labels:ae(ya).default([]),targets:ae(ka).default([]),timeBlocks:ae(wa).default([]),customFilters:ae(ja).default([])}),Na=e=>e instanceof Date?Le.fromDate(e):e,fe=e=>{if(e!=null){if(typeof e=="number")return new Date(e);if(typeof e=="string")return new Date(e)}};async function wi(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");try{const s=M(j,N.tasks(e,t)),a=M(j,N.projects(e,t)),n=M(j,N.labels(e,t)),o=M(j,N.targets(e,t)),i=M(j,N.timeblocks(e,t)),l=M(j,N.filters(e,t)),[c,d,g,u,p,y]=await Promise.all([ce(s),ce(a),ce(n),ce(o),ce(i),ce(l)]),x=h=>h.docs.map(w=>{const _=w.data(),m={id:w.id};for(const f in _){const S=_[f];m[f]=S instanceof Le?S.toMillis():S}return m});return{version:"1.4",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:x(c),projects:x(d),labels:x(g),targets:x(u),timeBlocks:x(p),customFilters:x(y)}}catch(s){throw console.error("[Backup] createBackupData failed:",s),s}}async function ji(e,t,s){var i;if(!e||!t)throw new Error("Invalid import parameters: userId and workspaceId are required.");if(!s)throw new Error("Invalid import parameters: backupData is required.");const a=va.safeParse(s);if(!a.success)throw console.error("[Backup] Validation failed:",a.error.format()),new Error(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™: ${a.error.issues.map(l=>l.message).join(", ")}`);const n=a.data,o=[];try{const{tasks:l,projects:c,labels:d,targets:g,timeBlocks:u,customFilters:p}=n,y=new Map,x=new Map,h=await ce(M(j,N.labels(e,t))),w=new Map;h.forEach(m=>w.set(m.data().name,m.id));for(const m of d)try{const f=(i=m.name)==null?void 0:i.trim();if(!f)continue;if(w.has(f))x.set(m.id,w.get(f));else{const S={...m,name:f};delete S.id;const R=await V(M(j,N.labels(e,t)),S);x.set(m.id,R.id),w.set(f,R.id)}}catch(f){o.push(`ãƒ©ãƒ™ãƒ« "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of c)try{const f={...m};delete f.id,f.createdAt=fe(m.createdAt);const S=await V(M(j,N.projects(e,t)),f);y.set(m.id,S.id)}catch(f){o.push(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of u)try{const f={...m};delete f.id,await V(M(j,N.timeblocks(e,t)),f)}catch(f){o.push(`ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of p)try{const f={...m};delete f.id,f.createdAt=fe(m.createdAt),await V(M(j,N.filters(e,t)),f)}catch(f){o.push(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of g)try{const f={...m};delete f.id,f.createdAt=fe(m.createdAt),f.updatedAt=fe(m.updatedAt),f.ownerId=e,f.workspaceId=t,await V(M(j,N.targets(e,t)),f)}catch(f){o.push(`ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (mode: ${m.mode}) ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}const _=l.map(async m=>{try{const f={...m};delete f.id,f.createdAt=fe(m.createdAt);const S=fe(m.dueDate);f.dueDate=S?Na(S):null,f.completedAt=fe(m.completedAt),m.projectId&&y.has(m.projectId)?f.projectId=y.get(m.projectId):f.projectId=null,Array.isArray(m.labelIds)&&(f.labelIds=m.labelIds.map(R=>x.get(R)).filter(R=>!!R)),f.ownerId=e,await V(M(j,N.tasks(e,t)),f)}catch(f){o.push(`ã‚¿ã‚¹ã‚¯ "${m.title}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}});return await Promise.all(_),{tasksCount:l.length,projectsCount:c.length,labelsCount:d.length,targetsCount:g.length,timeBlocksCount:u.length,filtersCount:p.length,errors:o}}catch(l){throw console.error("[Backup] importBackupData failed:",l),l}}const xe=class xe extends ve{constructor(){super({logPrefix:"[FilterCache]"})}static getInstance(){return xe.instance||(xe.instance=new xe),xe.instance}getFilters(t){return this.getItems(t)}subscribe(t,s,a){if(!t||!s)return a([]),()=>{};const n=this.registerListener(s,a);if(!this.hasFirestoreSubscription(s)){const o=N.filters(t,s),i=ge(M(j,o)),l=je(i,c=>{const d=c.docs.map(g=>({id:g.id,...g.data()}));this.setCache(s,d)},c=>{console.error(`${this.config.logPrefix} Subscription error:`,c),this.setCache(s,[])});this.setFirestoreSubscription(s,l)}return n}};se(xe,"instance");let it=xe;const Y=it.getInstance();function _a(e,t,s){return Y.subscribe(e,t,s)}function Ia(e){return Y.getFilters(e)}function Ca(e){return Y.isInitialized(e)}async function Da(e,t,s){const a=Y.getFilters(t),n="temp_"+Date.now(),o={...s,id:n,createdAt:new Date};Y.setCache(t,[...a,o]);const i=N.filters(e,t);return L(async()=>(await V(M(j,i),{...s,createdAt:Z()})).id,{onFinalFailure:()=>{Y.setCache(t,a),C.error("ãƒ•ã‚£ãƒ«ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ta(e,t,s,a){const n=Y.getFilters(t),o=n.map(l=>l.id===s?{...l,...a}:l);Y.setCache(t,o);const i=N.filters(e,t);return L(async()=>{await De(W(j,i,s),{...a,updatedAt:Z()})},{onFinalFailure:()=>{Y.setCache(t,n),C.error("ãƒ•ã‚£ãƒ«ã‚¿ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ea(e,t,s){const a=Y.getFilters(t),n=a.filter(i=>i.id!==s);Y.setCache(t,n);const o=N.filters(e,t);return L(async()=>{await Te(W(j,o,s))},{onFinalFailure:()=>{Y.setCache(t,a),C.error("ãƒ•ã‚£ãƒ«ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const vt=()=>Ee($.getState().language).t;function Sa(e){return e?Ia(e):[]}function Aa(e){return Ca(e)}function Ma(e,t){var a;const s=(a=T.currentUser)==null?void 0:a.uid;return!s||!e?(t([]),()=>{}):_a(s,e,t)}async function vi(e){var c;const t=vt(),s=(c=T.currentUser)==null?void 0:c.uid;if(!s)throw C.error(t("validation.auth_required")),new Error("Authentication required");const{workspaceId:a,...n}=e;if(!a)throw C.error(t("validation.workspace_required")),new Error("Workspace ID required");const o=cr.pick({name:!0,query:!0}).safeParse(n);if(!o.success){const d=o.error.issues.map(g=>g.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),C.error(`${t("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=n;await Da(s,a,{name:l.name,query:l.query,workspaceId:a,ownerId:s})}async function Ni(e,t,s){var c;const a=vt(),n=(c=T.currentUser)==null?void 0:c.uid;if(!n||!e)throw C.error(a("validation.auth_required")),new Error("Authentication required");const o=cr.partial().safeParse(s);if(!o.success){const d=o.error.issues.map(g=>g.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),C.error(`${a("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=s;await Ta(n,e,t,l)}async function Ra(e,t){var n;const s=vt(),a=(n=T.currentUser)==null?void 0:n.uid;if(!a||!e)throw C.error(s("validation.auth_required")),new Error("Authentication required");await Ea(a,e,t)}class Fa extends ve{constructor(){super({logPrefix:"[LabelCache]"})}getLabels(t){return this.getItems(t)}subscribe(t,s,a){const n=this.registerListener(s,a);if(!this.hasFirestoreSubscription(s)){const o=N.labels(t,s),i=ge(M(j,o));console.log(`${this.config.logPrefix} Subscribing to path: ${o}`);const l=je(i,c=>{const d=c.docs.map(g=>({id:g.id,...g.data()}));console.log(`${this.config.logPrefix} Received ${d.length} labels from Firestore for workspace: ${s}`),this.setCache(s,d)},c=>{console.error(`${this.config.logPrefix} Subscription error:`,c),this.setCache(s,[])});this.setFirestoreSubscription(s,l)}return n}}const J=new Fa,La=e=>J.isInitialized(e),Pa=e=>J.getLabels(e);function Oa(e,t,s){return!e||!t?(s([]),()=>{}):J.subscribe(e,t,s)}async function Ba(e,t,s,a){const n=J.getLabels(t),i={id:"temp-"+Date.now(),name:s,color:a,ownerId:e,createdAt:new Date};J.setCache(t,[...n,i]);const l=N.labels(e,t);return console.log(`[LabelCache] Adding label to path: ${l}`),L(async()=>{await V(M(j,l),{name:s,color:a,ownerId:e,workspaceId:t,createdAt:Z()})},{onFinalFailure:()=>{console.error(`[LabelCache] Failed to add label: ${s}`),J.setCache(t,n),C.error("ãƒ©ãƒ™ãƒ«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function $a(e,t,s,a){const n=J.getLabels(t),o=n.map(i=>i.id===s?{...i,...a}:i);return J.setCache(t,o),L(async()=>{const i=N.labels(e,t),l=W(j,i,s);await De(l,a)},{onFinalFailure:()=>{J.setCache(t,n),C.error("ãƒ©ãƒ™ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Wa(e,t,s){const a=J.getLabels(t),n=a.filter(o=>o.id!==s);return J.setCache(t,n),L(async()=>{const o=N.labels(e,t);await Te(W(j,o,s))},{onFinalFailure:()=>{J.setCache(t,a),C.error("ãƒ©ãƒ™ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}function Nt(){var t;const e=(t=T.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function he(){var s;const e=(s=T.currentUser)==null?void 0:s.uid,t=ie();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}function _t(){return Ee($.getState().language).t}function za(e,t,s=!0){const a=e.safeParse(t);if(a.success)return{success:!0,data:a.data};const n=qa(a.error);if(s){const o=_t();C.error(`${o("validation.validation_error")}: ${n}`)}return{success:!1,errorMessage:n}}function qa(e){return e.issues.map(t=>t.message).join(", ")}function Xe(e,t,s=!0){const a=za(e,t,s);if(!a.success)throw new Error(`Validation failed: ${a.errorMessage}`);return a.data}async function re(e,t,s={}){var i;const{successMessageKey:a,rethrow:n=!0}=s,o=_t();try{const l=await e();return a&&C.success(o(a)),l}catch(l){if(console.error(`[Store] ${t}:`,l),(i=l.message)!=null&&i.includes("Validation")||C.error(o(t)),n)throw l;return}}const Ua=Pa,Ka=e=>e?La(e):!1;function Va(e,t){var a;const s=(a=T.currentUser)==null?void 0:a.uid;return s&&e?Oa(s,e,t):(t([]),()=>{})}async function _i(e,t,s){const a=Nt();if(!e)throw new Error("Workspace ID required");const n={name:t,color:s,ownerId:a};return Xe(lr.pick({name:!0,color:!0,ownerId:!0}),n),re(()=>Ba(a,e,t,s),"msg.label.create_fail")}async function Ii(e,t,s){const a=Nt();if(!e)throw new Error("Workspace ID required");return Xe(lr.partial(),s),re(()=>$a(a,e,t,s),"msg.label.update_fail")}async function Ci(e,t){const s=Nt();if(!e)throw new Error("Workspace ID required");return re(()=>Wa(s,e,t),"msg.label.delete_fail",{successMessageKey:"msg.label.delete_success"})}function Ha(e,t){return e===t?!0:!e||!t||e.length!==t.length?!1:JSON.stringify(e)===JSON.stringify(t)}function Ga(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;const s=[...e].sort((n,o)=>(n.id||"").localeCompare(o.id||"")),a=[...t].sort((n,o)=>(n.id||"").localeCompare(o.id||""));for(let n=0;n<s.length;n++){const o=s[n],i=a[n];if(o.id!==i.id||o.status!==i.status||o.title!==i.title||o.description!==i.description||o.projectId!==i.projectId||o.timeBlockId!==i.timeBlockId||o.duration!==i.duration||o.isImportant!==i.isImportant)return!1;const l=c=>c==null?c:c instanceof Date?c.getTime():typeof(c==null?void 0:c.toMillis)=="function"?c.toMillis():c;if(l(o.dueDate)!==l(i.dueDate))return!1}return!0}function Xa(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let s=0;s<e.length;s++)if(e[s].id!==t[s].id||e[s].name!==t[s].name||e[s].color!==t[s].color)return!1;return!0}class Ya extends ve{constructor(){super({logPrefix:"[ProjectCache]"})}getProjects(t){return this.getItems(t)}subscribe(t,s,a){const n=this.registerListener(s,a);if(!this.hasFirestoreSubscription(s)){const o=N.projects(t,s),i=ge(M(j,o));console.log(`${this.config.logPrefix} Subscribing to path: ${o} for user: ${t}`);const l=je(i,c=>{const d=c.docs.map(u=>({id:u.id,...u.data()}));console.log(`${this.config.logPrefix} Received ${d.length} projects from Firestore for workspace: ${s}`);const g=this.getItems(s);if(g.length>0&&Xa(g,d)){console.log(`${this.config.logPrefix} Data identical, skipping update`);return}console.log(`${this.config.logPrefix} Updating cache and notifying listeners`),this.setCache(s,d)},c=>{console.error(`${this.config.logPrefix} Subscription error:`,c),this.setCache(s,[])});this.setFirestoreSubscription(s,l)}return n}}const z=new Ya,Ja=e=>z.isInitialized(e),Qa=e=>z.getProjects(e),Za=(e,t)=>z.setCache(e,t);function en(e,t,s){return z.subscribe(e,t,s)}async function tn(e,t,s,a){const n=z.getProjects(t),i={id:"temp-"+Date.now(),name:s,color:a,ownerId:e,createdAt:new Date};z.setCache(t,[...n,i]);const l=N.projects(e,t);return console.log(`[ProjectCache] Adding project to path: ${l}`),L(async()=>{const c=await V(M(j,l),{name:s,color:a,ownerId:e,createdAt:Z()});console.log(`[ProjectCache] Successfully added project with ID: ${c.id}`)},{onFinalFailure:()=>{console.error(`[ProjectCache] Failed to add project: ${s}`),z.setCache(t,n),C.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function rn(e,t,s,a){const n=z.getProjects(t),o=n.map(i=>i.id===s?{...i,...a}:i);return z.setCache(t,o),L(async()=>{const i=N.projects(e,t),l=W(j,i,s);await De(l,a)},{onFinalFailure:()=>{z.setCache(t,n),C.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function sn(e,t,s){const a=z.getProjects(t),n=a.filter(o=>o.id!==s);return z.setCache(t,n),L(async()=>{const o=N.projects(e,t);await Te(W(j,o,s))},{onFinalFailure:()=>{z.setCache(t,a),C.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function an(e,t,s){const a=z.getProjects(t),n=new Map;s.forEach((i,l)=>n.set(i,l));const o=a.map(i=>{const l=n.get(i.id);return l!==void 0?{...i,order:l}:i});return o.sort((i,l)=>{const c=i.order??Number.MAX_SAFE_INTEGER,d=l.order??Number.MAX_SAFE_INTEGER;return c-d}),z.setCache(t,o),L(async()=>{const i=bt(j),l=N.projects(e,t);s.forEach((c,d)=>{if(c&&!c.startsWith("temp-")){const g=W(j,l,c);i.update(g,{order:d})}}),await i.commit()},{onFinalFailure:()=>{z.setCache(t,a),C.error("ä¸¦ã³æ›¿ãˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const nn=e=>{const t=e||ie();return t?Qa(t):[]},on=e=>{const t=e||ie();return t?Ja(t):!1},ln=(e,t)=>{const s=t||ie();s&&Za(s,e)},cn=(e,t)=>{const s=typeof e=="function"?e:t,a=typeof e=="string"?e:ie(),n=T.currentUser;return n&&a&&typeof s=="function"?en(n.uid,a,s):(typeof s=="function"&&s([]),()=>{})},Di=async(e,t=null,s)=>{const a=T.currentUser;if(!a)throw new Error("Authentication required.");const n=t||ie();if(!n)throw new Error("Workspace selection required.");const o={name:e,color:s,ownerId:a.uid};return Xe(ir.pick({name:!0,color:!0,ownerId:!0}),o),re(()=>tn(a.uid,n,e,s),"msg.project.create_fail")},Ti=async(e,t)=>{const{userId:s,workspaceId:a}=he();return Xe(ir.partial(),t),re(()=>rn(s,a,e,t),"msg.project.update_fail")},dn=async e=>{const{userId:t,workspaceId:s}=he();return re(()=>sn(t,s,e),"msg.project.delete_fail",{successMessageKey:"msg.project.delete_success"})},un=async e=>{const{userId:t,workspaceId:s}=he();return re(()=>an(t,s,e),"msg.project.reorder_fail")};class gn extends ve{constructor(){super({logPrefix:"[TargetCache]"})}getTargets(t){return this.getItems(t)}subscribe(t,s,a){const n=this.registerListener(s,a);if(!this.hasFirestoreSubscription(s)){const o=N.targets(t,s),i=ge(M(j,o),xt("createdAt","desc"));console.log(`${this.config.logPrefix} Subscribing to path: ${o}`);const l=je(i,c=>{const d=c.docs.map(u=>({id:u.id,...u.data()})),g=this.getItems(s);g.length>0&&Ha(g,d)||(console.log(`${this.config.logPrefix} Received ${d.length} targets from Firestore for workspace: ${s}`),this.setCache(s,d))},c=>{console.error(`${this.config.logPrefix} Subscription error:`,c),this.setCache(s,[])});this.setFirestoreSubscription(s,l)}return n}}const Ce=new gn,hn=e=>Ce.isInitialized(e),mn=e=>Ce.getTargets(e);function pn(e,t,s,a){return!e||!t?(s([]),()=>{}):Ce.subscribe(e,t,n=>{s(n)})}async function fn(e,t,s){const a=Ce.getTargets(t),o={id:"temp-"+Date.now(),mode:s.mode||"",data:s.data||{},ownerId:e,workspaceId:t,createdAt:new Date,updatedAt:new Date,...s};return Ce.setCache(t,[o,...a]),L(async()=>{const i=N.targets(e,t),l={...s,ownerId:e,workspaceId:t,createdAt:Z(),updatedAt:Z()};delete l.id,await V(M(j,i),l)},{onFinalFailure:()=>{console.error("[TargetCache] Failed to add target"),Ce.setCache(t,a),C.error("ç›®æ¨™ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}function xn(){var t;const e=(t=T.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}const bn=e=>{const t=e||ie();return t?mn(t):[]},yn=e=>{const t=e||ie();return t?hn(t):!1},kn=(e,t,s)=>{const a=T.currentUser;return a&&e&&typeof t=="function"?pn(a.uid,e,t):(typeof t=="function"&&t([]),()=>{})},wn=async(e,t)=>{const s=xn();if(!e)throw new Error("Workspace ID required.");return fn(s,e,t)},rt=e=>e instanceof Le?e.toDate():e instanceof Date?e:void 0,gr=e=>e instanceof Date?Le.fromDate(e):e;function jn(e,t){if(!t||typeof t!="object")return console.warn(`[deserializeTask] Invalid data for task ${e}:`,t),{id:e,title:"Invalid Task",status:"todo",ownerId:""};const s=t.recurrence||null,a={id:e,title:String(t.title||"Untitled"),description:t.description?String(t.description):null,status:t.status==="completed"||t.status==="todo"||t.status==="archived"?t.status:"todo",dueDate:rt(t.dueDate)||void 0,createdAt:rt(t.createdAt)||void 0,completedAt:rt(t.completedAt)||void 0,ownerId:String(t.ownerId||""),projectId:t.projectId?String(t.projectId):null,labelIds:Array.isArray(t.labelIds)?t.labelIds.map(String):[],timeBlockId:t.timeBlockId?String(t.timeBlockId):null,duration:typeof t.duration=="number"?t.duration:null,isImportant:!!t.isImportant,recurrence:s};return wt.safeParse(a).success,a}const be=class be extends ve{constructor(){super({logPrefix:"[TaskCache]"});se(this,"currentWorkspaceId",null)}static getInstance(){return be.instance||(be.instance=new be),be.instance}getTasks(s){return this.getItems(s)}getTask(s,a){return this.getItems(s).find(o=>o.id===a)}reset(s){this.clearCache(s),this.currentWorkspaceId=null}subscribe(s,a,n,o){if(!s||!a)return n([]),()=>{};this.currentWorkspaceId=a;const i=this.registerListener(a,n);if(!this.hasFirestoreSubscription(a)){const l=N.tasks(s,a),c=ge(M(j,l)),d=je(c,g=>{const u=g.docs.map(y=>jn(y.id,y.data())),p=this.getItems(a);p.length>0&&Ga(p,u)||this.setCache(a,u)},g=>{console.error(`${this.config.logPrefix} Subscription error:`,g),o&&o(g)});this.setFirestoreSubscription(a,d)}return i}};se(be,"instance");let lt=be;const B=lt.getInstance();function hr(e,t){return B.getTask(e,t)}function vn(e){return B.getTasks(e)}function Nn(e){return B.isInitialized(e)}function _n(e,t,s,a){return B.subscribe(e,t,s,a)}function mr(e){return Object.fromEntries(Object.entries(e).filter(([t,s])=>s!==void 0))}async function In(e,t,s){const a=new Map;s.forEach((o,i)=>a.set(o,i));const n=B.getTasks(t);if(n&&n.length>0){const o=n.map(i=>{const l=a.get(i.id);return l!==void 0?{...i,order:l}:i});o.sort((i,l)=>{const c=i.order??Number.MAX_SAFE_INTEGER,d=l.order??Number.MAX_SAFE_INTEGER;return c-d}),B.setCache(t,o)}return L(async()=>{const o=N.tasks(e,t),i=[];for(let l=0;l<s.length;l+=500)i.push(s.slice(l,l+500));for(const l of i){const c=bt(j);l.forEach(d=>{const g=a.get(d),u=W(j,o,d);c.update(u,{order:g})}),await c.commit()}})}async function pr(e,t,s){const a=B.getTasks(t),o={id:"temp-"+Date.now(),title:s.title||"Untitled",description:s.description||null,status:"todo",dueDate:s.dueDate,createdAt:new Date,ownerId:e,projectId:s.projectId||null,labelIds:s.labelIds||[],timeBlockId:s.timeBlockId||null,duration:s.duration||null,isImportant:s.isImportant||!1,recurrence:s.recurrence||null};return B.setCache(t,[...a,o]),L(async()=>{const i=N.tasks(e,t),l=mr({...s});return l.dueDate&&(l.dueDate=gr(l.dueDate)),delete l.id,await V(M(j,i),{...l,ownerId:e,status:"todo",createdAt:Z()})},{onFinalFailure:()=>{console.error(`[TaskCache] Failed to add task: ${s.title}`),B.setCache(t,a),C.error("ã‚¿ã‚¹ã‚¯ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Cn(e,t,s,a){const n=B.getTasks(t);if(n==null||n.find(o=>o.id===s),n){const o=n.map(i=>i.id===s?{...i,status:a,completedAt:a==="completed"?new Date:void 0}:i);B.setCache(t,o)}return L(async()=>{const o=N.tasks(e,t),i={status:a};a==="completed"?i.completedAt=Z():i.completedAt=null,await De(W(j,o,s),i)},{onFinalFailure:()=>{n&&B.setCache(t,n),C.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Dn(e,t,s,a){const n=B.getTasks(t);if(n){const o=n.map(i=>i.id===s?{...i,...a}:i);B.setCache(t,o)}return L(async()=>{const o=N.tasks(e,t),i=mr({...a});i.dueDate!==void 0&&(i.dueDate=gr(i.dueDate)),await De(W(j,o,s),i)},{onFinalFailure:()=>{n&&B.setCache(t,n),C.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Tn(e,t,s){const a=B.getTasks(t);if(a){const n=a.filter(o=>o.id!==s);B.setCache(t,n)}return L(async()=>{const n=N.tasks(e,t);await Te(W(j,n,s))},{onFinalFailure:()=>{a&&B.setCache(t,a),C.error("ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ei(e){const{userId:t,workspaceId:s}=he(),n=wt.partial().required({title:!0}).safeParse(e);return n.success||console.warn("[addTask] Validation warning:",n.error.flatten()),re(()=>pr(t,s,e),"msg.task.create_fail")}async function En(e,t){const{userId:s,workspaceId:a}=he();if(t==="completed"){const n=hr(a,e);if(n!=null&&n.recurrence&&n.recurrence.type!=="none"){const o=pa(n.dueDate??null,n.recurrence);if(o){const i={title:n.title,description:n.description,projectId:n.projectId,labelIds:n.labelIds,timeBlockId:n.timeBlockId,duration:n.duration,isImportant:n.isImportant,recurrence:n.recurrence,dueDate:o,status:"todo"};pr(s,a,i).catch(l=>console.error("Failed to create recurring task:",l))}}}return re(()=>Cn(s,a,e,t),"msg.task.status_update_fail")}async function ct(e,t){const{userId:s,workspaceId:a}=he(),n=wt.partial().safeParse(t);return n.success||console.warn("[updateTask] Validation warning:",n.error.flatten()),re(()=>Dn(s,a,e,t),"msg.task.update_fail")}async function Sn(e){const{userId:t,workspaceId:s}=he();return re(()=>In(t,s,e),"msg.task.update_fail")}async function An(e){const{userId:t,workspaceId:s}=he();return re(()=>Tn(t,s,e),"msg.task.delete_fail",{successMessageKey:"msg.task.delete_success"})}async function Mn(e,t){const{workspaceId:s}=he(),a=_t(),n=hr(s,e),i=((n==null?void 0:n.status)||t)==="completed"?"todo":"completed";await En(e,i),i==="completed"&&C.success(a("msg.task.complete_success"))}function Rn(e,t,s){const a=T.currentUser;return!a||!e?(typeof t=="function"&&t([]),()=>{}):_n(a.uid,e,t,s)}const Fn=e=>{const t=e||ie();return t?vn(t):[]},Ln=e=>{const t=e||ie();return t?Nn(t):!1},Pn=v.TIME_BLOCK.DEFAULTS.map(e=>({...e})),ye=class ye extends ve{constructor(){super({logPrefix:"[TimeBlockCache]"})}static getInstance(){return ye.instance||(ye.instance=new ye),ye.instance}getBlocks(t){return this.getItems(t)}subscribe(t,s,a){if(!t||!s)return a([]),()=>{};const n=this.registerListener(s,a);if(!this.hasFirestoreSubscription(s)){const o=N.timeblocks(t,s),i=ge(M(j,o),xt("order","asc"));let l=!0;const c=je(i,d=>{const g=d.docs.map(u=>({id:u.id,...u.data()}));if(l&&g.length===0&&!d.metadata.hasPendingWrites){l=!1,On(t,s).catch(u=>console.error(`${this.config.logPrefix} Failed to create defaults:`,u));return}l=!1,this.setCache(s,g)},d=>{console.error(`${this.config.logPrefix} Subscription error:`,d)});this.setFirestoreSubscription(s,c)}return n}};se(ye,"instance");let dt=ye;const Q=dt.getInstance();async function On(e,t){const s=N.timeblocks(e,t),a=bt(j);Pn.forEach(n=>{const o=W(j,s,n.id);a.set(o,{name:n.name,start:n.start,end:n.end,color:n.color,order:n.order,updatedAt:Z()})}),await a.commit()}function Bn(e,t,s){return Q.subscribe(e,t,s)}function $n(e){return Q.getBlocks(e)}function Wn(e){return Q.isInitialized(e)}async function zn(e,t,s){const a=Q.getBlocks(t),n=[...a,s].sort((l,c)=>(l.order||0)-(c.order||0));Q.setCache(t,n);const o=N.timeblocks(e,t),i=s.id||crypto.randomUUID();return L(async()=>{await Ht(W(j,o,i),{...s,updatedAt:Z()})},{onFinalFailure:()=>{Q.setCache(t,a),C.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function qn(e,t,s,a){const n=Q.getBlocks(t),o=n.map(l=>l.id===s?{...l,...a}:l).sort((l,c)=>(l.order||0)-(c.order||0));Q.setCache(t,o);const i=N.timeblocks(e,t);return L(async()=>{await Ht(W(j,i,s),{...a,updatedAt:Z()},{merge:!0})},{onFinalFailure:()=>{Q.setCache(t,n),C.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Un(e,t,s){const a=Q.getBlocks(t),n=a.filter(i=>i.id!==s);Q.setCache(t,n);const o=N.timeblocks(e,t);return L(async()=>{await Te(W(j,o,s))},{onFinalFailure:()=>{Q.setCache(t,a),C.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Kn=()=>Ee($.getState().language).t;function fr(e){var s;const t=(s=T.currentUser)==null?void 0:s.uid;if(!t||!e)throw new Error("Authentication and Workspace are required.");return t}function Vn(e,t){var a;const s=(a=T.currentUser)==null?void 0:a.uid;return s?Bn(s,e,t):(t([]),()=>{})}function xr(e){return $n(e)}function Hn(e){return Wn(e)}async function Si(e,t){const s=fr(e),a=Kn();try{const n=t.id||crypto.randomUUID(),o=xr(e),i=t.order!==void 0?t.order:Math.max(...o.map(g=>g.order||0),-1)+1,l={id:n,name:t.name||"",start:t.start||"09:00",end:t.end||"10:00",color:t.color||v.DEFAULT_COLORS.TIME_BLOCK_INACTIVE,order:i},c=Ss.safeParse(l);if(!c.success){const g=c.error.issues.map(u=>u.message).join(", ");return console.error("[TimeBlocks] Validation error:",c.error),C.error(`${a("validation.validation_error")}: ${g}`),!1}return o.some(g=>g.id===n)?await qn(s,e,n,l):await zn(s,e,l),!0}catch(n){return console.error("[TimeBlocks] Save error:",n),!1}}async function Gn(e,t){const s=fr(e);try{return await Un(s,e,t),!0}catch(a){return console.error("[TimeBlocks] Delete error:",a),!1}}const Se=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=k.useCallback(c=>!e||!t?()=>{}:Rn(e,d=>c(d),d=>console.error("Task subscription error:",d)),[e,t]),n=e?Ln(e):!1,{data:o,isPending:i}=Ne(["tasks",t||void 0,e||void 0],a,e&&n?Fn(e):void 0);return{tasks:o||[],loading:s||!!e&&!n&&i}};function It(){const{tasks:e}=Se(),{showCompleted:t,query:s}=ee();return k.useMemo(()=>{var i,l;const n={inbox:0,today:0,upcoming:0,important:0,all:0,search:0,projects:{}},o=s?s.toLowerCase().trim():"";for(const c of e){if(o){const g=(i=c.title)==null?void 0:i.toLowerCase().includes(o),u=(l=c.description)==null?void 0:l.toLowerCase().includes(o);(g||u)&&n.search++}c.status==="archived"||c.status==="completed"||(n.all++,c.projectId&&(n.projects[c.projectId]=(n.projects[c.projectId]||0)+1),(!c.projectId||c.projectId==="unassigned"||c.projectId==="none")&&n.inbox++,c.isImportant&&n.important++,c.dueDate&&(ua(c.dueDate)?n.today++:ga(c.dueDate)&&n.upcoming++))}return n},[e,s])}const Xn=e=>e in v.SIDEBAR_DENSITY,Ye=e=>Xn(e)?v.SIDEBAR_DENSITY[e]:v.SIDEBAR_DENSITY.normal,Yn=[{id:"inbox",i18nKey:"inbox",Icon:or,color:"text-blue-500",droppable:!0},{id:"today",i18nKey:"today",Icon:qe,color:"text-green-500"},{id:"upcoming",i18nKey:"upcoming",Icon:ar,color:"text-purple-500"},{id:"important",i18nKey:"important",Icon:kt,color:"text-amber-400"},{id:"custom",i18nKey:"all_tasks",Icon:_s,color:"text-gray-500"}],Jn=()=>{const{language:e,density:t}=$(),{t:s}=Ee(e),a=It(),{setView:n,currentView:o}=te(),i=o==="dashboard";return r.jsxs("ul",{className:"space-y-0.5",children:[r.jsx("li",{children:r.jsxs("button",{onClick:()=>n("dashboard"),className:I("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Ye(t),i?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[r.jsx(tr,{className:"w-4 h-4 text-indigo-500"}),r.jsx("span",{className:"flex-1",children:s("dashboard")})]})}),Yn.map(l=>r.jsx(Qn,{item:l,label:s(l.i18nKey),count:a[l.id]||0},l.id))]})},Qn=({item:e,label:t,count:s})=>{const{filterType:a,setFilter:n}=ee(),{setView:o}=te(),{density:i}=$(),c=te(y=>y.currentView)==="tasks"&&a===e.id,d=e.Icon,{setNodeRef:g,isOver:u}=Fe({id:`filter:${e.id}`,disabled:!e.droppable,data:{type:e.id==="inbox"?"inbox":"filter",value:e.id}}),p=()=>{e.id==="search"?(o("tasks"),n("search")):(o("tasks"),n(e.id))};return r.jsx("li",{ref:g,children:r.jsxs("button",{onClick:p,className:I("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Ye(i),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",u&&e.droppable&&"bg-blue-50 dark:bg-blue-900/30"),children:[r.jsx(d,{className:I("w-4 h-4",e.color)}),r.jsx("span",{className:"flex-1",children:t}),e.id!=="search"&&s>0&&r.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:s})]})})},Zn=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=k.useCallback(c=>!e||!t?()=>{}:Ma(e,c),[e,t]),n=e?Aa(e):!1,{data:o,isPending:i}=Ne(["filters",t||void 0,e||void 0],a,e&&n?Sa(e):void 0);return{filters:o,loading:s||!!e&&i}};function br(e){const t={keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(!e)return t;const s=/(?:-?[a-zA-Z]+:(?:"[^"]*"|[^\s]+))|(?:"[^"]*")|(?:-?[^\s]+)/g,a=e.match(s);if(!a)return t;const n=[];for(let o=0;o<a.length;o++){const i=a[o];if(i==="OR"){const l=n.length-1,c=n[l],d=a[o+1],g=c&&(typeof c=="string"?!c.includes(":"):!0),u=d&&!d.includes(":")&&d!=="OR";if(g&&u){const p=Array.isArray(c)?c:[c];p.push(d.toLowerCase().replace(/^"|"$/g,"")),n[l]=p,o++;continue}}n.push(i)}return n.forEach(o=>{if(Array.isArray(o)){t.keywords.push(o);return}const i=o;if(i.startsWith('"')&&i.endsWith('"')){const l=i.substring(1,i.length-1);l&&t.keywords.push(l.toLowerCase());return}if(i.startsWith("-")&&!i.includes(":")){const l=i.substring(1);l&&t.excludeKeywords.push(l.toLowerCase());return}if(i.includes(":")){let l=!1,c=i;c.startsWith("-")&&(l=!0,c=c.substring(1));const d=c.indexOf(":"),g=c.substring(0,d).toLowerCase();let u=c.substring(d+1);switch(u.startsWith('"')&&u.endsWith('"')&&(u=u.substring(1,u.length-1)),u.toLowerCase(),g){case"project":case"p":l?u.split(",").forEach(x=>t.excludeProjects.push(x)):u.split(",").forEach(x=>t.projects.push(x));break;case"label":case"l":l?u.split(",").forEach(x=>t.excludeLabels.push(x)):u.split(",").forEach(x=>t.labels.push(x));break;case"timeblock":case"tb":l?u.split(",").forEach(x=>t.excludeTimeBlocks.push(x)):u.split(",").forEach(x=>t.timeBlocks.push(x));break;case"duration":case"d":u.split(",").forEach(x=>{const h=parseInt(x,10);isNaN(h)||t.durations.push(h)});break;case"date":case"due":const p=["today","tomorrow","week","upcoming","overdue","next-week"];u.split(",").forEach(x=>{const h=x.toLowerCase();p.includes(h)&&t.dates.push(h)});break;case"status":case"is":const y=["completed","active","todo"];u.split(",").forEach(x=>{const h=x.toLowerCase();y.includes(h)&&(l?t.excludeStatus.push(h):t.status.push(h)),h==="important"&&(t.isImportant=!l),h==="unimportant"&&(t.isImportant=l)});break;default:l?t.excludeKeywords.push(c.toLowerCase()):t.keywords.push(c.toLowerCase());break}}else i!=="OR"&&t.keywords.push(i.toLowerCase())}),t}function Ai(e){var s,a,n,o,i,l,c,d,g,u,p,y;const t=[];return(s=e.keywords)!=null&&s.length&&t.push(...e.keywords.map(x=>Array.isArray(x)?x.join(" OR "):x.includes(" ")?`"${x}"`:x)),(a=e.excludeKeywords)!=null&&a.length&&t.push(...e.excludeKeywords.map(x=>`-${x}`)),(n=e.projects)!=null&&n.length&&t.push(`project:${e.projects.join(",")}`),(o=e.excludeProjects)!=null&&o.length&&t.push(`-project:${e.excludeProjects.join(",")}`),(i=e.labels)!=null&&i.length&&t.push(`label:${e.labels.join(",")}`),(l=e.excludeLabels)!=null&&l.length&&t.push(`-label:${e.excludeLabels.join(",")}`),(c=e.timeBlocks)!=null&&c.length&&t.push(`timeblock:${e.timeBlocks.join(",")}`),(d=e.excludeTimeBlocks)!=null&&d.length&&t.push(`-timeblock:${e.excludeTimeBlocks.join(",")}`),(g=e.durations)!=null&&g.length&&t.push(`duration:${e.durations.join(",")}`),(u=e.dates)!=null&&u.length&&t.push(`date:${e.dates.join(",")}`),(p=e.status)!=null&&p.length&&t.push(`status:${e.status.join(",")}`),(y=e.excludeStatus)!=null&&y.length&&t.push(`-status:${e.excludeStatus.join(",")}`),e.isImportant===!0&&t.push("is:important"),e.isImportant===!1&&t.push("is:unimportant"),t.join(" ")}function eo(e,t="createdAt_desc"){if(!Array.isArray(e))return[];const[s,a]=t.split("_"),o=a==="desc"?-1:1;return[...e].sort((i,l)=>{var g,u,p,y,x,h;let c,d;switch(s){case"dueDate":c=(g=O(i.dueDate))==null?void 0:g.getTime(),d=(u=O(l.dueDate))==null?void 0:u.getTime();break;case"createdAt":c=(p=O(i.createdAt))==null?void 0:p.getTime(),d=(y=O(l.createdAt))==null?void 0:y.getTime();break;case"title":c=i.title.toLowerCase(),d=l.title.toLowerCase();break;case"duration":c=i.duration||0,d=l.duration||0;break;case"important":c=i.isImportant?1:0,d=l.isImportant?1:0;break;case"manual":c=i.order!==void 0?i.order:Number.MAX_SAFE_INTEGER,d=l.order!==void 0?l.order:Number.MAX_SAFE_INTEGER;break;default:c=(x=O(i.createdAt))==null?void 0:x.getTime(),d=(h=O(l.createdAt))==null?void 0:h.getTime()}return to(c,d)*o})}function to(e,t){return e===t?0:e==null?1:t==null?-1:e>t?1:e<t?-1:0}function ro(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);t.setDate(t.getDate()+1);const s=ha(e),a=new Date(s);a.setDate(a.getDate()+7);const n=new Date(t);return n.setDate(n.getDate()+7),{now:e,tomorrow:t,weekStart:s,weekEnd:a,upcomingEnd:n}}function so(e,t,s,a){const{now:n,tomorrow:o,weekStart:i,weekEnd:l,upcomingEnd:c}=s;switch(t){case"today":return Ft(e,n);case"tomorrow":return Ft(e,o);case"week":return e>=i&&e<l;case"upcoming":return e>=o&&e<c;case"overdue":return e<n&&a!=="completed";default:return!1}}function Pt(e,t){if(!t)return e;const s=typeof t=="string"?br(t):t,a=s.dates.length>0?ro():null;return e.filter(n=>{if(s.status.length>0){const i=n.status||"todo";if(!s.status.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(s.excludeStatus.length>0){const i=n.status||"todo";if(s.excludeStatus.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(s.isImportant===!0&&!n.isImportant||s.isImportant===!1&&n.isImportant||s.projects.length>0&&!s.projects.some(l=>l==="unassigned"?!n.projectId||n.projectId==="unassigned"||n.projectId==="none":n.projectId===l)||s.excludeProjects.length>0&&s.excludeProjects.some(i=>n.projectId===i)||s.labels.length>0&&(!n.labelIds||!s.labels.some(i=>{var l;return(l=n.labelIds)==null?void 0:l.includes(i)}))||s.excludeLabels.length>0&&n.labelIds&&s.excludeLabels.some(i=>{var l;return(l=n.labelIds)==null?void 0:l.includes(i)})||s.timeBlocks.length>0&&!s.timeBlocks.some(l=>l==="unassigned"?!n.timeBlockId:n.timeBlockId===l)||s.excludeTimeBlocks.length>0&&s.excludeTimeBlocks.some(i=>n.timeBlockId===i))return!1;if(s.durations.length>0){const i=n.duration||0;if(!s.durations.includes(i))return!1}if(a&&s.dates.length>0){const i=O(n.dueDate);if(!i||!s.dates.some(c=>so(i,c,a,n.status||"todo")))return!1}const o=`${n.title} ${n.description||""}`.toLowerCase();return!(s.keywords.length>0&&!s.keywords.every(l=>Array.isArray(l)?l.some(c=>o.includes(c)):o.includes(l))||s.excludeKeywords.length>0&&s.excludeKeywords.some(l=>o.includes(l)))})}function ao(e){const{keyword:t,showCompleted:s,projectId:a,labelId:n,timeBlockId:o,duration:i,filterType:l}=e,c=t?br(t):{keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(a&&c.projects.push(a),n&&c.labels.push(n),o&&c.timeBlocks.push(o),i){const d=typeof i=="number"?i:parseInt(i,10);isNaN(d)||c.durations.push(d)}return l==="today"&&c.dates.push("today"),l==="upcoming"&&c.dates.push("upcoming"),l==="important"&&(c.isImportant=!0),s||c.status.length===0&&c.status.push("active"),c}function yr(e,t){const{savedFilter:s,sortCriteria:a}=t,n=ao(t);let o=Pt(e,n);return s&&s.query&&(o=Pt(o,s.query)),eo(o,a||"createdAt_desc")}const Je=({x:e,y:t,onClose:s,children:a})=>{const n=k.useRef(null);return k.useEffect(()=>{const o=l=>{n.current&&!n.current.contains(l.target)&&s()},i=()=>s();return document.addEventListener("mousedown",o),window.addEventListener("scroll",i,!0),()=>{document.removeEventListener("mousedown",o),window.removeEventListener("scroll",i,!0)}},[s]),Fr.createPortal(r.jsx("div",{ref:n,className:"fixed min-w-[160px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{top:t,left:e,zIndex:v.Z_INDEX.POPOVER},onContextMenu:o=>o.preventDefault(),children:a}),document.body)},no=({label:e,icon:t,children:s})=>{const[a,n]=D.useState(!1);return r.jsxs("div",{className:"relative w-full",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[r.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm flex items-center justify-between gap-2 transition-colors text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[t&&r.jsx("span",{className:"w-4 h-4 text-gray-400",children:t}),e]}),r.jsx(Me,{className:"w-3 h-3 text-gray-400"})]}),a&&r.jsx("div",{className:"absolute left-full top-0 ml-1 min-w-[140px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{zIndex:v.Z_INDEX.POPOVER},children:s})]})},H=({onClick:e,children:t,className:s,icon:a,variant:n="default"})=>r.jsxs("button",{onClick:o=>{o.stopPropagation(),e()},className:I("w-full text-left px-3 py-2 text-sm flex items-center gap-2 transition-colors",n==="danger"?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",s),children:[a&&r.jsx("span",{className:I("w-4 h-4",n==="danger"?"text-red-500":"text-gray-400"),children:a}),t]}),ke=({icon:e,label:t,count:s,isActive:a,isOver:n,onClick:o,onContextMenu:i,showZero:l=!1})=>{const{density:c}=$();return r.jsxs("button",{type:"button",onClick:o,onContextMenu:i,className:I("w-full text-left group flex items-center justify-between px-2 ml-1 rounded-md transition-colors select-none outline-none focus:ring-2 focus:ring-blue-500/50",Ye(c),a?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",n&&"bg-blue-50 dark:bg-blue-900/30"),children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e&&r.jsx("span",{className:"flex-shrink-0 w-5 flex justify-center text-sm",children:e}),r.jsx("span",{className:"text-sm truncate",children:t})]}),s!==void 0&&(s>0||l&&s===0)&&r.jsx("span",{className:I("text-[10px] font-bold px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700/50",a?"text-blue-700 dark:text-blue-300 bg-white":"text-gray-400"),children:s})]})},oo=()=>{const{filters:e,loading:t}=Zn(),{tasks:s}=Se(),{workspaceId:a}=le();return t?null:r.jsx("div",{className:"space-y-0.5 py-1",children:e.map(n=>r.jsx(io,{filter:n,tasks:s,workspaceId:a},n.id))})},io=({filter:e,tasks:t,workspaceId:s})=>{const{t:a}=A(),{filterType:n,targetId:o,setFilter:i}=ee(),{openModal:l}=oe(),c=n==="custom"&&o===e.id,[d,g]=k.useState(null),u=D.useMemo(()=>{try{return yr(t,{savedFilter:e,showCompleted:!1}).length}catch(h){return console.warn("[CustomFilterItem] Count error:",h),0}},[t,e]),p=()=>{g(null),l("filter-edit",e)},y=()=>{g(null),l("confirmation",{title:a("delete"),message:`${a("filter")}: ${e.name}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&s&&await Ra(s,e.id)}})},x=h=>{h.preventDefault(),h.stopPropagation(),g({x:h.clientX,y:h.clientY})};return r.jsxs(r.Fragment,{children:[r.jsx("div",{onContextMenu:x,children:r.jsx(ke,{label:e.name,icon:r.jsx(Ae,{size:16}),count:u,isActive:c,onClick:()=>i("custom",e.id)})}),d&&r.jsxs(Je,{x:d.x,y:d.y,onClose:()=>g(null),children:[r.jsx(H,{onClick:p,icon:r.jsx(Ve,{size:16}),children:a("edit")}),r.jsx(H,{onClick:y,variant:"danger",icon:r.jsx(Ke,{size:16}),children:a("delete")})]})]})},lo=D.memo(({mins:e,count:t})=>{const{t:s}=A(),{filterType:a,targetId:n,setFilter:o}=ee(),{setView:i}=te(),l=a==="duration"&&n===e.toString(),{setNodeRef:c,isOver:d}=Fe({id:`duration:${e}`,data:{type:"duration",value:e.toString()}});return r.jsx("div",{ref:c,children:r.jsx(ke,{label:s("sidebar.duration_format",{min:e}),icon:r.jsx(nr,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),count:t,isActive:l,isOver:d,onClick:()=>{i("tasks"),o("duration",e.toString())}})})}),co=()=>{const{tasks:e}=Se(),{customDurations:t}=$(),s=(t==null?void 0:t.length)>0?t:v.SIDEBAR.DURATIONS,a=k.useMemo(()=>{const n=new Map;return e.forEach(o=>{if(o.status!=="completed"&&o.duration){const i=Number(o.duration);isNaN(i)||n.set(i,(n.get(i)||0)+1)}}),n},[e]);return r.jsx("div",{className:"space-y-0.5 py-1",children:s.map(n=>r.jsx(lo,{mins:n,count:a.get(n)||0},n))})},Ct=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=Bt(),n=k.useCallback(u=>!e||!t?()=>{}:cn(e,u),[e,t]),i=(e?on(e):!1)&&e?nn(e):void 0,{data:l,isPending:c}=Ne(["projects",t||void 0,e||void 0],n,i);return{projects:l||[],loading:s||!!e&&c,setProjectsOverride:u=>{e&&(a.setQueryData(["projects",e],u),ln(u,e))}}},uo=({id:e,children:t,className:s=""})=>{const{attributes:a,listeners:n,setNodeRef:o,transform:i,transition:l,isDragging:c,isOver:d}=gt({id:e}),g={transform:ht.Transform.toString(i),transition:l},u=[c&&"opacity-50 scale-[1.02] shadow-lg z-50",d&&"ring-2 ring-indigo-500/50"].filter(Boolean).join(" ");return r.jsx("div",{ref:o,style:g,className:`${u} ${s}`.trim(),...a,...n,children:t})},kr=()=>r.jsxs("div",{className:"space-y-2 p-2",children:[r.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),r.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),r.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),go=D.memo(({project:e})=>{const{t}=A(),{filterType:s,targetId:a,setFilter:n}=ee(),{density:o}=$(),{openModal:i}=oe(),{setView:l}=te(),c=s==="project"&&a===e.id,[d,g]=k.useState(null),{setNodeRef:u,isOver:p}=Fe({id:`project:${e.id}`,data:{type:"project",value:e.id}}),y=m=>{m==null||m.stopPropagation(),g(null),i("project-edit",e)},x=()=>{g(null),i("confirmation",{title:t("delete"),message:`${t("project")}: ${e.name}
${t("msg.confirm_delete")}`,confirmLabel:t("delete"),variant:"danger",onConfirm:async()=>{e.id&&await dn(e.id)}})},h=m=>{m.preventDefault(),m.stopPropagation(),g({x:m.clientX,y:m.clientY})},w=()=>{n("project",e.id),l("tasks")},_=It().projects[e.id]||0;return r.jsxs(r.Fragment,{children:[r.jsxs("div",{ref:u,onClick:w,onContextMenu:h,className:I("group flex items-center justify-between px-2 rounded-md cursor-pointer transition-colors select-none",Ye(o),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",p&&"bg-blue-50 dark:bg-blue-900/30"),role:"button",tabIndex:0,"aria-selected":c,"aria-label":`${t("project")}: ${e.name}${c?` (${t("active")})`:""}`,children:[r.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[r.jsx("span",{className:I("text-xs shrink-0 transition-colors",c?"text-blue-500":"text-gray-400 group-hover:text-gray-500"),children:r.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),r.jsx("span",{className:"text-sm truncate",children:e.name})]}),_>0&&r.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:_})]}),d&&r.jsxs(Je,{x:d.x,y:d.y,onClose:()=>g(null),children:[r.jsx(H,{onClick:y,icon:r.jsx(Ve,{size:16}),children:t("edit")}),r.jsx(H,{onClick:x,variant:"danger",icon:r.jsx(Ke,{size:16}),children:t("delete")})]})]})}),ho=()=>{const{t:e}=A(),{projects:t,loading:s}=Ct();return s?r.jsx(kr,{}):t.length===0?r.jsx("div",{className:"p-4 text-xs text-gray-400",children:e("sidebar.no_projects")}):r.jsx(mt,{items:t.map(a=>`${v.DND.PREFIX_PROJECT}${a.id}`),strategy:pt,children:r.jsx("div",{className:"space-y-0.5 p-2",children:t.map(a=>r.jsx(uo,{id:`${v.DND.PREFIX_PROJECT}${a.id}`,children:r.jsx(go,{project:a})},a.id))})})},mo=({title:e,children:t,defaultExpanded:s=!0,action:a,dragHandleProps:n})=>{const{t:o}=A(),[i,l]=k.useState(()=>typeof window<"u"&&window.innerWidth<768?!1:s),d=`section-${encodeURIComponent(e.replace(/\s+/g,"-").toLowerCase())}`;return r.jsxs("div",{className:"mb-2 group/section",children:[r.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[r.jsxs("button",{...n,onClick:()=>l(!i),"aria-expanded":i,"aria-controls":d,className:"flex items-center flex-1 text-xs font-semibold text-gray-500 uppercase hover:text-gray-700 dark:hover:text-gray-300 transition-colors text-left cursor-grab active:cursor-grabbing touch-none select-none",title:o("sidebar.reorder_section"),children:[r.jsx("svg",{className:I("w-3 h-3 mr-1 transition-transform",i?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),e]}),a&&r.jsx("div",{className:"opacity-100 transition-opacity",onClick:g=>g.stopPropagation(),children:a})]}),i&&r.jsx("div",{className:"mt-1",id:d,children:t})]})},po=()=>{const{t:e}=A(),{currentView:t,setView:s}=te();return r.jsxs("div",{className:"space-y-0.5 py-1",children:[r.jsx(ke,{label:e("sidebar.target_wizard"),icon:r.jsx(rr,{}),isActive:t==="wizard",onClick:()=>s("wizard")}),r.jsx(ke,{label:e("sidebar.target_dashboard"),icon:r.jsx(tr,{}),isActive:t==="target-dashboard",onClick:()=>s("target-dashboard")}),r.jsx(ke,{label:e("sidebar.framework_wiki"),icon:r.jsx(sr,{}),isActive:t==="wiki",onClick:()=>s("wiki")})]})},Qe=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=k.useCallback(c=>!e||!t?()=>{}:Vn(e,c),[e,t]),n=e?Hn(e):!1,{data:o,isPending:i}=Ne(["timeblocks",t||void 0,e||void 0],a,e&&n?xr(e):void 0);return{timeBlocks:o||[],loading:s||!!e&&i}},fo=()=>{const{timeBlocks:e,loading:t}=Qe(),{tasks:s}=Se(),{workspaceId:a}=le(),n=D.useMemo(()=>{const o=new Map;let i=0;return s.forEach(l=>{l.status!=="completed"&&(!l.timeBlockId||l.timeBlockId==="unassigned"||l.timeBlockId==="null"?i++:o.set(l.timeBlockId,(o.get(l.timeBlockId)||0)+1))}),{map:o,unassignedCount:i}},[s]);return t?r.jsx(kr,{}):r.jsxs("div",{className:"space-y-0.5 py-1",children:[e.map(o=>r.jsx(xo,{block:o,count:n.map.get(o.id||"")||0,workspaceId:a},o.id)),r.jsx(bo,{count:n.unassignedCount})]})},xo=({block:e,count:t,workspaceId:s})=>{const{t:a}=A(),{filterType:n,targetId:o,setFilter:i}=ee(),{openModal:l}=oe(),c=n==="timeblock"&&o===e.id,{setView:d}=te(),[g,u]=k.useState(null),{setNodeRef:p,isOver:y}=Fe({id:`timeblock:${e.id}`,data:{type:"timeblock",value:e.id}}),x=()=>{u(null),l("timeblock-edit",e)},h=()=>{u(null),l("confirmation",{title:a("delete"),message:`${a("timeblock")}: ${e.start} - ${e.end}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&s&&await Gn(s,e.id)}})},w=m=>{m.preventDefault(),m.stopPropagation(),u({x:m.clientX,y:m.clientY})},_=()=>{i("timeblock",e.id||""),d("tasks")};return r.jsxs("div",{ref:p,onContextMenu:w,children:[r.jsx(ke,{label:`${e.start} - ${e.end}`,icon:r.jsx("span",{className:"w-2 rounded-full aspect-square",style:{backgroundColor:e.color}}),count:t,isActive:c,isOver:y,onClick:_}),g&&r.jsxs(Je,{x:g.x,y:g.y,onClose:()=>u(null),children:[r.jsx(H,{onClick:x,icon:r.jsx(Ve,{size:16}),children:a("edit")}),r.jsx(H,{onClick:h,variant:"danger",icon:r.jsx(Ke,{size:16}),children:a("delete")})]})]})},bo=({count:e})=>{const{t}=A(),{filterType:s,targetId:a,setFilter:n}=ee(),{setView:o}=te(),i=s==="timeblock"&&a==="unassigned",{setNodeRef:l,isOver:c}=Fe({id:"timeblock:unassigned",data:{type:"timeblock",value:"unassigned"}}),d=()=>{n("timeblock","unassigned"),o("tasks")};return r.jsx("div",{ref:l,children:r.jsx(ke,{label:t("sidebar.unassigned"),icon:r.jsx("span",{className:"w-2 rounded-full aspect-square bg-gray-400"}),count:e,isActive:i,isOver:c,onClick:d})})},yo=({id:e,section:t})=>{const{attributes:s,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:l}=gt({id:e}),c={transform:ht.Transform.toString(o),transition:i,opacity:l?.5:1};return r.jsx("div",{ref:n,style:c,...s,children:r.jsx(mo,{title:t.title,defaultExpanded:t.defaultExpanded,action:t.action,dragHandleProps:a,children:t.component})})},st=["general","projects","targets","timeblocks","durations","filters"],ko=()=>{const{t:e}=A(),{openModal:t}=oe(),[s,a]=D.useState(()=>{const l=localStorage.getItem(v.STORAGE_KEYS.SECTION_ORDER);let c=st;if(l)try{const d=JSON.parse(l);if(Array.isArray(d)&&d.every(g=>typeof g=="string")){const g=[...d];st.forEach(u=>{g.includes(u)||(u==="general"?g.unshift(u):g.push(u))}),c=g.filter(u=>st.includes(u))}}catch{}return c});k.useEffect(()=>{localStorage.setItem(v.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(s))},[s]);const n=$t(We(Wt,{activationConstraint:{distance:8}}),We(Br,{coordinateGetter:Or})),o=l=>{const{active:c,over:d}=l;d&&c.id!==d.id&&a(g=>{const u=g.indexOf(c.id),p=g.indexOf(d.id);return ft(g,u,p)})},i=D.useMemo(()=>({general:{id:"general",title:e("general"),component:r.jsx(r.Fragment,{children:r.jsx(Jn,{})}),defaultExpanded:!0},projects:{id:"projects",title:e("projects"),component:r.jsx(ho,{}),defaultExpanded:!0,action:r.jsx("button",{onClick:()=>t("project-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},targets:{id:"targets",title:e("targets"),component:r.jsx(po,{}),defaultExpanded:!1,action:r.jsx("button",{onClick:()=>t("wiki-framework"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},timeblocks:{id:"timeblocks",title:e("timeblocks"),component:r.jsx(fo,{}),defaultExpanded:!1,action:r.jsx("button",{onClick:()=>t("timeblock-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},durations:{id:"durations",title:e("durations"),component:r.jsx(co,{}),defaultExpanded:!1},filters:{id:"filters",title:e("filters"),component:r.jsx(oo,{}),defaultExpanded:!1,action:r.jsx("button",{onClick:()=>t("filter-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})}}),[e,t]);return r.jsx(zt,{sensors:n,collisionDetection:qt,onDragEnd:o,children:r.jsx(mt,{items:s,strategy:pt,children:r.jsx("div",{className:"flex flex-col gap-4",children:s.map(l=>{const c=i[l];return c?r.jsx(yo,{id:c.id,section:c},c.id):null})})})})},wr=we(e=>({onTasksReorder:null,setTasksReorderHandler:t=>e({onTasksReorder:t})})),ue=k.forwardRef(({className:e,variant:t="primary",size:s="md",isLoading:a,leftIcon:n,rightIcon:o,children:i,disabled:l,...c},d)=>{const g={primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg shadow-blue-500/30 border border-transparent",secondary:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 border border-transparent",danger:"bg-red-500 hover:bg-red-600 text-white shadow-md shadow-red-500/30 border border-transparent",ghost:"bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",outline:"bg-transparent border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",premium:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/40 border border-transparent"},u={sm:"text-xs px-3 py-1.5 rounded-lg gap-1.5",md:"text-sm px-4 py-2 rounded-lg gap-2",lg:"text-base px-6 py-3 rounded-xl gap-2.5",icon:"p-2 rounded-full aspect-square flex items-center justify-center"};return r.jsxs("button",{ref:d,className:I("flex items-center justify-center font-bold transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100",g[t],u[s],e),disabled:l||a,...c,children:[a&&r.jsx(Is,{className:"-ml-1 text-currentColor",size:16}),!a&&n,i,!a&&o]})});ue.displayName="Button";const jr=k.forwardRef(({className:e,label:t,error:s,containerClassName:a,options:n,children:o,id:i,...l},c)=>r.jsxs("div",{className:I("flex flex-col gap-1.5",a),children:[t&&r.jsx("label",{htmlFor:i,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),r.jsxs("div",{className:"relative group",children:[r.jsx("select",{ref:c,id:i,className:I("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl pl-4 pr-10 py-2.5 outline-none transition-all appearance-none cursor-pointer placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 text-gray-500 hover:border-gray-300 dark:hover:border-gray-600",e),"aria-invalid":!!s,"aria-describedby":s&&i?`${i}-error`:void 0,...l,children:o||(n==null?void 0:n.map(d=>r.jsx("option",{value:d.value,children:d.label},d.value)))}),r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",children:r.jsx(er,{size:16})})]}),s&&r.jsx("p",{id:i?`${i}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]}));jr.displayName="Select";const vr=D.memo(({task:e,style:t,className:s,dragHandleProps:a})=>{const{t:n}=A(),o=e.status==="completed",i=!!e.isImportant,{openModal:l}=oe(),{projects:c}=Ct(),{timeBlocks:d}=Qe(),[g,u]=k.useState(null),p=async F=>{F.stopPropagation(),e.id&&await Mn(e.id,e.status||"todo")},y=async F=>{F.stopPropagation(),e.id&&await ct(e.id,{isImportant:!i})},x=F=>{F.preventDefault(),F.stopPropagation(),u({x:F.clientX,y:F.clientY})},h=()=>{u(null),l("task-detail",e)},w=()=>{u(null),l("confirmation",{title:n("delete"),message:`${n("task")}: ${e.title}
${n("msg.confirm_delete")}`,confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{e.id&&await An(e.id)}})},_=async F=>{if(u(null),!e.id)return;let P=null;const U=new Date;switch(U.setHours(0,0,0,0),F){case"today":P=new Date;break;case"tomorrow":P=new Date(U),P.setDate(U.getDate()+1);break;case"next_week":P=new Date(U),P.setDate(U.getDate()+7);break;case"no_date":P=null;break}await ct(e.id,{dueDate:P})},m=e.projectId?c.find(F=>F.id===e.projectId):null,f=e.timeBlockId?d.find(F=>F.id===e.timeBlockId):null,S=!!(e.recurrence&&e.recurrence.type!=="none"),R=!!e.dueDate;return r.jsxs(r.Fragment,{children:[r.jsxs("li",{style:t,onClick:()=>l("task-detail",e),onContextMenu:x,className:I("group flex items-center gap-3 p-[var(--task-p)] bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700/50 rounded-xl hover:shadow-sm hover:border-blue-200 dark:hover:border-blue-800 transition-all duration-200 cursor-default hover-lift",s),children:[a&&r.jsx("div",{...a,className:"cursor-move text-gray-300 dark:text-gray-600 hover:text-gray-500 dark:hover:text-gray-400 p-1 -ml-1 flex-shrink-0 touch-none",children:r.jsx(vs,{className:"w-4 h-4"})}),r.jsx("button",{onClick:p,className:I("w-5 h-5 rounded-full border flex items-center justify-center transition-colors shrink-0 cursor-pointer",o?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-blue-400 text-transparent"),"aria-label":o?"Mark as incomplete":"Mark as complete",children:r.jsx(Pe,{className:"w-3 h-3",strokeWidth:3})}),r.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[r.jsx("div",{className:I("text-sm text-gray-800 dark:text-gray-200 break-words",o&&"line-through text-gray-400 dark:text-gray-500"),children:e.title}),e.description&&r.jsx("div",{className:"text-xs text-gray-500 line-clamp-1 truncate",children:e.description})]}),r.jsxs("div",{className:"flex items-center gap-3 text-xs shrink-0",children:[r.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-300",children:[r.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:(m==null?void 0:m.color)||v.DEFAULT_COLORS.PROJECT_INACTIVE}}),r.jsx("span",{className:"max-w-[100px] truncate",children:m?m.name:n("task_detail.project_none")})]}),r.jsx("div",{className:"hidden sm:flex items-center gap-1 text-gray-400 dark:text-gray-500 min-w-[80px]",children:f?r.jsxs(r.Fragment,{children:[r.jsx(nr,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"max-w-[120px] truncate",children:f.name||`${f.start} - ${f.end}`})]}):r.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest opacity-30",children:n("task_detail.time_block_unspecified")})}),r.jsx("div",{className:I("flex items-center gap-1 min-w-[70px]",S||R?o?"text-gray-400":ma(e.dueDate||null):"text-gray-400 dark:text-gray-500 opacity-50"),children:S?r.jsxs(r.Fragment,{children:[r.jsx(Ns,{className:"w-3.5 h-3.5"}),e.dueDate&&r.jsx("span",{className:"hidden sm:inline",children:Lt(e.dueDate)})]}):R?r.jsxs(r.Fragment,{children:[r.jsx(qe,{className:"w-3.5 h-3.5"}),r.jsx("span",{className:"hidden sm:inline",children:Lt(e.dueDate)})]}):r.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest",children:n("no_date")})})]}),r.jsx("div",{className:I("flex items-center gap-1 transition-opacity shrink-0",i?"opacity-100":"opacity-0 group-hover:opacity-100 placeholder-opacity"),children:r.jsx("button",{onClick:y,className:I("p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",i?"text-yellow-500":"text-gray-400"),title:i?"é‡è¦åº¦ã‚’è§£é™¤":"é‡è¦ã¨ã—ã¦ãƒžãƒ¼ã‚¯",children:r.jsx(kt,{className:"w-4 h-4",fill:i?"currentColor":"none"})})})]}),g&&r.jsxs(Je,{x:g.x,y:g.y,onClose:()=>u(null),children:[r.jsxs(no,{label:n("date_change")||"æ—¥ä»˜å¤‰æ›´",icon:r.jsx(qe,{}),children:[r.jsx(H,{onClick:()=>_("today"),children:n("today")}),r.jsx(H,{onClick:()=>_("tomorrow"),children:n("tomorrow")}),r.jsx(H,{onClick:()=>_("next_week"),children:n("next_week")||"æ¥é€±"}),r.jsx(H,{onClick:()=>_("no_date"),children:n("no_date")||"æœŸé™ãªã—"})]}),r.jsx(H,{onClick:h,icon:r.jsx(Ve,{}),children:n("edit")}),r.jsx(H,{onClick:w,variant:"danger",icon:r.jsx(Ke,{}),children:n("delete")})]})]})},(e,t)=>{const s=n=>n?n instanceof Date?n.getTime():typeof n.toDate=="function"?n.toDate().getTime():typeof n.getTime=="function"?n.getTime():null:null,a=(n,o)=>{const i=s(n),l=s(o);return i===l};return e.task.id===t.task.id&&e.task.status===t.task.status&&e.task.title===t.task.title&&e.task.description===t.task.description&&e.task.projectId===t.task.projectId&&e.task.timeBlockId===t.task.timeBlockId&&e.task.isImportant===t.task.isImportant&&e.task.recurrence===t.task.recurrence&&a(e.task.dueDate,t.task.dueDate)}),ut=({tasks:e,timeBlockId:t})=>{const{t:s,formatNumber:a}=A(),{timeBlocks:n}=Qe(),o=e.reduce((p,y)=>{const x=y.duration,h=typeof x=="number"?x:Number(x);return p+(isNaN(h)?0:h)},0),i=p=>a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2})+"h",l=t?n.find(p=>p.id===t):null;if(l&&l.start&&l.end){const p=fa(l.start,l.end);if(p<=0)return null;const y=a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2}),x=a(o/60,{minimumFractionDigits:2,maximumFractionDigits:2}),h=o/p*100,w=Math.min(h,100),_=p-o,m=_<0,f=a(Math.abs(_)/60,{minimumFractionDigits:2,maximumFractionDigits:2}),S=h>100;return r.jsxs("div",{className:"flex items-center gap-3 py-2 px-3 my-1 border border-gray-100 dark:border-gray-800 rounded-lg bg-gray-50/30 dark:bg-gray-800/20",children:[r.jsx("div",{className:"flex-shrink-0 w-20 truncate text-[10px] font-bold text-gray-400 uppercase tracking-tight",title:l.name,children:l.name}),r.jsxs("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums min-w-[70px]",children:[r.jsxs("span",{className:"font-bold text-gray-700 dark:text-gray-300",children:[x,"h"]}),r.jsx("span",{className:"text-gray-400 mx-0.5",children:"/"}),r.jsxs("span",{children:[y,"h"]})]}),r.jsx("div",{className:"flex-1 relative h-2 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[60px]",children:r.jsx("div",{className:I("h-full rounded-full transition-all duration-500 ease-out",S?"bg-red-500":"bg-blue-500"),style:{width:S?"100%":`${w}%`}})}),r.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 tabular-nums",children:[r.jsxs("span",{className:I("text-xs font-bold w-[4ch] text-right",S?"text-red-500":"text-blue-500"),children:[Math.round(h),"%"]}),r.jsxs("span",{className:I("text-[10px] hidden sm:inline",m?"text-red-400":"text-gray-400"),children:["(",m?"+":"-",f,"h)"]})]})]})}const c=e.length,d=c>0?o/c:0,g=s("task_stats.count_unit"),u=s("task_stats.avg_unit");return r.jsxs("div",{className:"glass-card flex items-center justify-evenly py-3 px-4 my-2",children:[r.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[r.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.count_label")}),r.jsxs("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200",children:[a(c),g&&r.jsx("span",{className:"text-xs font-normal ml-0.5 text-gray-400",children:g})]})]}),r.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),r.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[r.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.total_label")}),r.jsx("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200 text-blue-600 dark:text-blue-400",children:i(o)})]}),r.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),r.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[r.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.avg_label")}),r.jsxs("span",{className:"font-medium text-sm",children:[i(d),r.jsx("span",{className:"text-xs ml-0.5",children:u})]})]})]})},wo=({task:e,className:t})=>{const{attributes:s,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:l}=gt({id:`${v.DND.PREFIX_TASK}${e.id||""}`,data:{type:"task",task:e}}),c={transform:ht.Transform.toString(o),transition:i,zIndex:l?50:"auto",position:"relative"};return r.jsx("div",{ref:n,style:c,className:"touch-manipulation",children:r.jsx(vr,{task:e,className:I(t,l&&"opacity-80 shadow-lg border-blue-400 bg-blue-50/50"),dragHandleProps:{...s,...a}})})},Nr=()=>{const{t:e}=A(),{tasks:t,loading:s}=Se(),{filterType:a,targetId:n,query:o,showCompleted:i,sortCriteria:l,setShowCompleted:c,setSortCriteria:d}=ee(),{density:g}=$(),{openModal:u}=oe(),p=k.useMemo(()=>o&&o.trim().length>0?{keyword:o,showCompleted:i,projectId:null,labelId:null,timeBlockId:null,duration:null,filterType:"all_tasks",savedFilter:null,sortCriteria:l}:{keyword:o,showCompleted:i,projectId:a==="inbox"?"unassigned":a==="project"?n:null,labelId:a==="label"?n:null,timeBlockId:a==="timeblock"?n:null,duration:a==="duration"?n:null,filterType:a,savedFilter:null,sortCriteria:l},[a,n,o,i,l]),y=k.useMemo(()=>yr(t,p),[t,p]),x={compact:"space-y-1",normal:"space-y-2",comfortable:"space-y-3",spacious:"space-y-4"}[g],{setTasksReorderHandler:h}=wr(),[w,_]=D.useState(null);D.useEffect(()=>{_(null)},[t,p]);const m=w||y,f=D.useRef({localOrderedTasks:w,processedTasks:y,sortCriteria:l});D.useEffect(()=>{f.current={localOrderedTasks:w,processedTasks:y,sortCriteria:l}});const S=D.useCallback(async(K,Tt)=>{const{localOrderedTasks:Dr,processedTasks:Tr,sortCriteria:Er}=f.current;if(Er!=="manual")return;const et=Dr||Tr,Et=et.findIndex(_e=>_e.id===K),St=et.findIndex(_e=>_e.id===Tt);if(Et!==-1&&St!==-1){const _e=ft(et,Et,St);_(_e);const Sr=_e.map(tt=>tt.id).filter(Boolean);try{await Sn(Sr)}catch(tt){console.error("Failed to reorder tasks",tt),_(null)}}},[]),R=D.useRef(0),F=D.useRef(Date.now());D.useEffect(()=>{const K=Date.now();if(K-F.current>1e3&&(R.current=0),F.current=K,R.current++,R.current>10){console.error("[TaskList] Infinite loop detected in setTasksReorderHandler effect. Aborting registration.");return}return h(S),()=>h(null)},[S,h]);const P=m.length===0,U=!!(o&&o.trim().length>0);if(s&&!U&&t.length===0)return r.jsx("div",{className:"flex items-center justify-center h-full",children:r.jsx("div",{className:"text-gray-400 text-sm animate-pulse",children:e("task_list.loading")})});const Cr=l==="manual";return r.jsxs("div",{className:"flex flex-col h-full overflow-hidden relative",children:[r.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-1 pb-24",children:[r.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm pt-2 pb-4 mb-4 flex items-center gap-2",children:[r.jsx("div",{className:"flex-1",children:U&&r.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[r.jsx(Ae,{className:"w-4 h-4"}),e("task_list.searching_results",{query:o||""})]})}),r.jsx("div",{className:"flex items-center gap-2 px-1",children:r.jsxs(jr,{name:"sortCriteria","aria-label":e("task_list.sort_options")||"Sort Options",value:l,onChange:K=>d(K.target.value),className:"font-medium text-xs py-1.5 h-auto",children:[r.jsx("option",{value:"manual",children:e("task_list.sort_manual")}),r.jsx("option",{value:"createdAt_desc",children:e("task_list.sort_created")}),r.jsx("option",{value:"dueDate_asc",children:e("task_list.sort_due")}),r.jsx("option",{value:"important_desc",children:e("task_list.sort_important")}),r.jsx("option",{value:"title_asc",children:e("task_list.sort_title")})]})}),r.jsx(ue,{variant:i?"primary":"outline",size:"sm",onClick:()=>c(!i),title:e(i?"task_list.hide_completed":"task_list.show_completed"),className:"shrink-0",children:e(i?"task_list.hide_completed":"task_list.show_completed")})]}),P?r.jsxs("div",{className:"text-center py-20 flex flex-col items-center justify-center min-h-[60vh]",children:[r.jsxs("div",{className:"relative mb-8",children:[r.jsx("div",{className:"absolute -inset-4 bg-blue-500/10 dark:bg-blue-400/10 blur-3xl rounded-full"}),r.jsx("div",{className:"relative",children:r.jsx(Pe,{className:"w-24 h-24 text-blue-200 dark:text-blue-900/50",strokeWidth:1.5})})]}),r.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:e("task_list.no_tasks_title")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs mb-8",children:e(i?"task_list.no_tasks_desc_showing":"task_list.no_tasks_desc_hiding")}),r.jsx(ue,{variant:"premium",onClick:()=>u("task-detail",{title:""}),leftIcon:r.jsx(Qt,{className:"w-5 h-5"}),children:e("task_list.add_new_task")})]}):Cr?r.jsx(mt,{items:m.map(K=>`${v.DND.PREFIX_TASK}${K.id||""}`),strategy:pt,children:r.jsx("div",{className:I("transition-all duration-200",x),children:m.map(K=>r.jsx(wo,{task:K},K.id))})}):r.jsx("ul",{className:I("transition-all duration-200",x),children:m.map(K=>r.jsx(vr,{task:K},K.id))})]}),r.jsx("div",{className:"flex-none mt-auto pt-2 border-t border-gray-100 dark:border-gray-800 bg-white/50 dark:bg-gray-900/50 backdrop-blur pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:r.jsx(ut,{tasks:m,timeBlockId:p.timeBlockId})})]})},jo=()=>{const{t:e}=A(),{tasks:t}=Se(),{timeBlocks:s}=Qe(),a=It(),{density:n}=$();t.length,t.filter(i=>i.status==="completed").length;const o=[{id:"inbox",label:e("inbox"),count:a.inbox,icon:or,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{id:"today",label:e("today"),count:a.today,icon:qe,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},{id:"upcoming",label:e("upcoming"),count:a.upcoming,icon:ar,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},{id:"important",label:e("important"),count:a.important,icon:kt,color:"text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/20"}];return r.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar p-4 md:p-6 space-y-6",children:[r.jsxs("header",{className:"mb-4",children:[r.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:e("dashboard")}),r.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:[e("general_dashboard.overall_stats")," & ",e("general_dashboard.time_block_usage")]})]}),r.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:o.map(i=>r.jsxs("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm flex items-center justify-between",children:[r.jsxs("div",{children:[r.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:i.label}),r.jsx("p",{className:"text-2xl font-black text-gray-800 dark:text-gray-100 tabular-nums",children:i.count})]}),r.jsx("div",{className:`p-3 rounded-lg ${i.bg}`,children:r.jsx(i.icon,{className:`w-6 h-6 ${i.color}`})})]},i.id))}),r.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded-xl p-4 border border-gray-100 dark:border-gray-800",children:[r.jsx("h2",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:e("general_dashboard.overall_stats")}),r.jsx(ut,{tasks:t.filter(i=>i.status!=="completed"),timeBlockId:null})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:e("general_dashboard.time_block_usage")}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(i=>{const l=t.filter(c=>c.timeBlockId===i.id&&c.status!=="completed");return l.length===0?null:r.jsx("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm",children:r.jsx(ut,{tasks:l,timeBlockId:i.id||null})},i.id)})})]})]})},Dt=k.forwardRef(({className:e,label:t,error:s,leftIcon:a,rightIcon:n,containerClassName:o,id:i,...l},c)=>{const d=k.useId(),g=i||d;return r.jsxs("div",{className:I("flex flex-col gap-1.5",o),children:[t&&r.jsx("label",{htmlFor:g,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),r.jsxs("div",{className:"relative group",children:[a&&r.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:a}),r.jsx("input",{ref:c,id:g,className:I("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-2.5 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 group-hover:border-gray-300 dark:group-hover:border-gray-600",a&&"pl-10",n&&"pr-10",e),"aria-invalid":!!s,"aria-describedby":s?`${g}-error`:void 0,...l}),n&&r.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:n})]}),s&&r.jsx("p",{id:`${g}-error`,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]})});Dt.displayName="Input";const vo=()=>{const{t:e}=A(),{query:t,setSearchQuery:s,setFilter:a}=ee(),{setView:n}=te(),[o,i]=k.useState(t),l=k.useRef(null);k.useEffect(()=>{var u;(u=l.current)==null||u.focus()},[]),k.useEffect(()=>{t!==o&&i(t)},[t]),k.useEffect(()=>{const u=setTimeout(()=>{o!==t&&s(o)},150);return()=>{clearTimeout(u)}},[o,t,s]);const c=u=>{i(u.target.value)},d=()=>{var u;i(""),s(""),(u=l.current)==null||u.focus()},g=()=>{s(""),a("inbox"),n("tasks")};return r.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-br from-slate-50 via-white to-blue-50/30 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800",children:[r.jsxs("div",{className:"relative p-4 sm:p-6 border-b border-gray-100 dark:border-gray-800",children:[r.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0"}),r.jsxs("div",{className:"relative z-10 max-w-3xl mx-auto",children:[r.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[r.jsx(ue,{variant:"ghost",size:"icon",onClick:g,className:"rounded-xl transition-all hover:scale-105 active:scale-95","aria-label":e("close"),children:r.jsx(ks,{className:"w-5 h-5 text-gray-500"})}),r.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:e("sidebar.search_placeholder")})]}),r.jsxs("div",{className:"relative group",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity duration-300 pointer-events-none"}),r.jsx(Dt,{ref:l,id:"search-input",name:"search",type:"text",value:o,onChange:c,placeholder:e("sidebar.search_placeholder"),className:"py-4 text-base bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-lg shadow-gray-200/50 dark:shadow-black/20",leftIcon:r.jsx(Ae,{className:"w-5 h-5"}),rightIcon:o?r.jsx("button",{type:"button",onClick:d,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors pointer-events-auto","aria-label":e("clear"),children:r.jsx(ys,{className:"w-5 h-5"})}):void 0})]}),!o&&r.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-400",children:[r.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 font-mono",children:"/"}),r.jsx("span",{children:e("search_view.tips")})]}),o&&r.jsxs("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[r.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),e("search_view.results_for",{query:o})]})]})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:o?r.jsx(Nr,{}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500 p-8",children:[r.jsxs("div",{className:"relative",children:[r.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full blur-2xl"}),r.jsx("div",{className:"relative w-24 h-24 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center mb-6",children:r.jsx(Ae,{className:"w-12 h-12 text-gray-400 dark:text-gray-500",strokeWidth:1.5})})]}),r.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300 mb-2",children:e("search_view.empty_title")}),r.jsx("p",{className:"text-sm text-center max-w-xs opacity-75",dangerouslySetInnerHTML:{__html:e("search_view.empty_desc")}})]})})]})},No=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=k.useCallback(c=>!e||!t?()=>{}:kn(e,c),[e,t]),n=e?yn(e):!1,{data:o,isPending:i}=Ne(["targets",t||void 0,e||void 0],a,e&&n?bn(e):void 0);return{targets:o||[],loading:s||!!e&&i}},_o=D.memo(({kgi:e,currentTab:t,onTabChange:s,collapsed:a,onToggleCollapse:n})=>{const{t:o}=A(),i={good:"text-emerald-500",warning:"text-amber-500",danger:"text-red-500"},l={good:"bg-emerald-500",warning:"bg-amber-500",danger:"bg-red-500"},c=i[e.status]||"text-gray-500",d=l[e.status]||"bg-gray-500",g=[{id:"backward",label:o("backward_map"),icon:"ðŸ—ºï¸"},{id:"woop",label:o("woop_board"),icon:"âœ¨"},{id:"okr",label:o("okr_tree"),icon:"ðŸŽ¯"}];return r.jsx("div",{className:`mb-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg transition-all duration-300 mx-4 mt-4 ${a?"py-2":"py-4"}`,children:r.jsxs("div",{className:"px-6 flex items-center justify-between gap-6",children:[r.jsx("div",{className:"flex-1 min-w-0",children:r.jsx("h1",{className:`font-bold text-gray-900 dark:text-white truncate transition-all duration-300 ${a?"text-sm opacity-50":"text-base"}`,children:e.title})}),r.jsx("div",{className:"flex-1 max-w-md hidden sm:block",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"flex-1",children:r.jsx("div",{className:"h-3 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",children:r.jsx("div",{style:{width:`${e.progress}%`},className:`h-full ${d} transition-all duration-1000 ease-out rounded-full`})})}),r.jsxs("span",{className:`font-black ${c} tabular-nums text-sm whitespace-nowrap`,children:[e.progress,"%"]})]})}),r.jsxs("div",{className:"flex items-center gap-6 flex-shrink-0",children:[r.jsxs("div",{className:"text-center hidden sm:block",children:[r.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:o("target_dashboard.days_left")}),r.jsxs("div",{className:`font-black ${c} tabular-nums`,children:[e.daysLeft,r.jsx("span",{className:"text-xs font-medium ml-0.5 text-gray-400",children:o("target_dashboard.days_unit")})]})]}),r.jsx("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-900/50 p-1 rounded-lg",children:g.map(u=>r.jsxs("button",{onClick:()=>s(u.id),className:`group px-3 py-1.5 rounded-md text-xs font-bold transition-all flex flex-col sm:flex-row items-center gap-1 sm:gap-2 ${t===u.id?"bg-white dark:bg-gray-700 shadow-sm text-gray-900 dark:text-white":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}`,title:u.label,children:[r.jsx("span",{className:"text-sm sm:text-base leading-none",children:u.icon}),r.jsx("span",{className:"text-[10px] sm:text-xs leading-none",children:u.label})]},u.id))}),r.jsx(ue,{variant:"ghost",size:"icon",onClick:n,title:o(a?"target_dashboard.header_expand":"target_dashboard.header_collapse"),className:"rounded-lg",children:r.jsx(ws,{className:`w-4 h-4 text-gray-500 transition-transform duration-300 ${a?"rotate-180":""}`})})]})]})})}),Io=D.memo(({data:e})=>{const{t}=A();return!e||!e.milestones?r.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")}):r.jsxs("div",{className:"max-w-4xl mx-auto relative pb-10",children:[r.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700 -translate-x-1/2"}),e.milestones.map((s,a)=>{const n=s.type==="goal",o=s.type==="current",i=s.completed;let l,c="";return n?(l=r.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-400 text-white flex items-center justify-center text-base shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"ðŸ†"}),c="bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700"):o?(l=r.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 animate-pulse relative",children:t("target_dashboard.backward.now_icon")}),c="border-blue-500 border-2 shadow-md"):i?(l=r.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs shadow ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"âœ“"}),c="bg-gray-50 dark:bg-gray-800 opacity-70"):(l=r.jsx("div",{className:"w-5 h-5 rounded-full bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative"}),c="bg-white dark:bg-gray-800"),r.jsxs("div",{className:"relative flex items-center mb-4 animate-fade-in group",style:{animationDelay:`${a*50}ms`},children:[r.jsx("div",{className:"w-16 flex-shrink-0 flex justify-center items-center z-10",children:l}),r.jsx("div",{className:"flex-1 pr-4 min-w-0",children:r.jsx("div",{className:`px-3 py-3 rounded-lg border ${o&&!c.includes("border-2")?"border-2 border-blue-500":o?"":"border-gray-200 dark:border-gray-700"} ${c} shadow-sm transition-all hover:shadow-md hover:translate-x-1 cursor-pointer`,children:r.jsxs("div",{className:"flex items-center justify-between gap-3",children:[r.jsx("span",{className:`text-xs font-bold ${o?"text-blue-600":"text-gray-500"} flex-shrink-0 font-mono`,children:s.date}),r.jsx("h3",{className:"font-bold text-gray-900 dark:text-white flex-1 truncate text-sm md:text-base",children:s.title}),n&&r.jsx("span",{className:"text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-bold flex-shrink-0",children:t("target_dashboard.backward.target_label")}),o&&r.jsx("span",{className:"text-[10px] text-blue-500 font-bold flex-shrink-0",children:t("target_dashboard.backward.now_label")})]})})})]},s.id||`milestone-${a}`)})]})}),Co=D.memo(({data:e})=>{const{t}=A();if(!e||!e.keyResults)return r.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")});const s=a=>a==="high"?"bg-emerald-500":a==="medium"?"bg-amber-500":"bg-red-500";return r.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in",children:[r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-2xl border-2 border-blue-100 dark:border-blue-900 shadow-lg text-center mb-12 relative z-10 transition-transform hover:scale-[1.01]",children:[r.jsx("div",{className:"absolute top-[-15px] left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-md",children:t("target_dashboard.okr.objective_label")}),r.jsxs("h2",{className:"font-black text-2xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 leading-tight",children:['"',e.objective,'"']}),r.jsx("div",{className:"absolute bottom-[-50px] left-1/2 w-1 h-[50px] bg-gray-200 dark:bg-gray-700 z-0"})]}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 relative",children:[r.jsx("div",{className:"hidden md:block absolute top-[-25px] left-[16.66%] right-[16.66%] h-1 bg-gray-200 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700 rounded-t-xl z-0"}),e.keyResults.map(a=>{const n=a.target>0?Math.round(a.current/a.target*100):0,o=s(a.confidence);return r.jsxs("div",{className:"relative pt-6",children:[r.jsx("div",{className:"absolute top-[-25px] left-1/2 w-1 h-[25px] bg-gray-200 dark:bg-gray-700 md:block hidden"}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-700 transition-all group h-full flex flex-col",children:[r.jsxs("div",{className:"flex justify-between items-start mb-3",children:[r.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[t("target_dashboard.okr.kr_prefix"),a.id]}),r.jsx("div",{className:`w-3 h-3 rounded-full ${o}`,title:`Confidence: ${a.confidence}`})]}),r.jsx("h4",{className:"font-bold text-gray-800 dark:text-gray-200 mb-4 h-12 line-clamp-2",children:a.text}),r.jsxs("div",{className:"space-y-1 mt-auto",children:[r.jsxs("div",{className:"flex justify-between text-xs font-bold text-gray-500 dark:text-gray-400",children:[r.jsx("span",{children:a.current}),r.jsx("span",{children:a.target})]}),r.jsx("div",{className:"h-2 w-full bg-gray-100 dark:bg-gray-900 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${n}%`}})}),r.jsxs("div",{className:"text-right text-sm font-black text-blue-600 mt-1",children:[n,"%"]})]})]})]},a.id)})]})]})}),Do=D.memo(({data:e})=>{const{t}=A();return!e||!e.obstacles?r.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")}):r.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto animate-fade-in",children:[r.jsxs("div",{className:"space-y-6",children:[r.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/30 dark:to-blue-900/30 p-6 rounded-2xl border border-indigo-100 dark:border-indigo-800 shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("h3",{className:"text-sm font-bold text-indigo-500 uppercase mb-2",children:t("target_dashboard.woop.wish_label")}),r.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',e.wish,'"']})]}),r.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900/30 dark:to-rose-900/30 p-6 rounded-2xl border border-pink-100 dark:border-pink-800 shadow-sm hover:shadow-md transition-shadow",children:[r.jsx("h3",{className:"text-sm font-bold text-pink-500 uppercase mb-2",children:t("target_dashboard.woop.outcome_label")}),r.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',e.outcome,'"']})]})]}),r.jsxs("div",{className:"space-y-4",children:[r.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-2 flex items-center",children:[r.jsx("span",{className:"mr-2",children:"ðŸš§"})," ",t("target_dashboard.woop.obstacles_header")]}),e.obstacles.map(s=>r.jsxs("div",{className:"group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all overflow-hidden relative",children:[r.jsx("div",{className:"p-5 border-l-4 border-gray-400 bg-gray-50 dark:bg-gray-800 relative z-10 transition-transform group-hover:translate-x-1",children:r.jsxs("h4",{className:"font-bold text-gray-700 dark:text-gray-300 flex items-center",children:[r.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 text-xs px-2 py-1 rounded mr-3 text-gray-600 dark:text-gray-400",children:t("target_dashboard.woop.obstacle_badge")}),s.text]})}),r.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-t border-gray-100 dark:border-gray-700 flex items-start",children:[r.jsx("div",{className:"flex-shrink-0 mt-1",children:r.jsx("span",{className:"block w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs font-bold",children:t("target_dashboard.woop.if_badge")})}),r.jsx("div",{className:"ml-3 flex-1",children:r.jsxs("p",{className:"text-emerald-800 dark:text-emerald-300 font-bold text-sm",children:["â†’ ",s.plan]})}),r.jsxs("div",{className:"ml-2 flex flex-col items-center",children:[r.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:t("target_dashboard.woop.score_label")}),r.jsx("span",{className:"text-lg font-black text-emerald-500 leading-none",children:s.overcomeCount})]})]})]},s.id)),r.jsx("button",{className:"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl text-gray-400 hover:border-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition flex items-center justify-center font-bold text-sm",children:t("target_dashboard.woop.add_obstacle")})]})]})}),To=()=>{var x;const{t:e}=A(),{targets:t}=No(),[s,a]=k.useState("backward"),[n,o]=k.useState(!1),i=t.filter(h=>{var w;return((w=h.mode)==null?void 0:w.toLowerCase())===s.toLowerCase()}),l=h=>({milestones:[{date:e("target_dashboard.backward.timeline.future"),title:h.data.goal_kgi||e("target_dashboard.kgi_default"),type:"goal",completed:!1},{date:e("target_dashboard.backward.timeline.milestone"),title:h.data.milestone_minus_1mo||"",type:"milestone",completed:!1},{date:e("target_dashboard.backward.timeline.today"),title:e("target_dashboard.backward.current_status"),type:"current",completed:!0},{date:e("target_dashboard.backward.timeline.now"),title:h.data.first_action||"",type:"action",completed:!1}]}),c=h=>({wish:h.data.wish||"",outcome:h.data.outcome||"",obstacles:[{id:1,text:h.data.obstacle||"",plan:h.data.plan||"",overcomeCount:0}]}),d=h=>({objective:h.data.objective||"",keyResults:[{id:1,text:h.data.kr_1||`${e("target_dashboard.okr.kr_prefix")}1`,current:0,target:100,confidence:"medium"},{id:2,text:h.data.kr_2||`${e("target_dashboard.okr.kr_prefix")}2`,current:0,target:100,confidence:"medium"},{id:3,text:h.data.kr_3||`${e("target_dashboard.okr.kr_prefix")}3`,current:0,target:100,confidence:"medium"}]}),g=()=>i.length===0?r.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:r.jsx("p",{className:"mb-4",children:e("target_dashboard.no_targets",{mode:s.toUpperCase()})})}):r.jsx("div",{className:"space-y-12",children:i.map(h=>{var w;return r.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-12 last:border-0",children:[r.jsx("div",{className:"mb-4 text-xs text-gray-400 flex justify-end",children:e("target_dashboard.created_at",{date:((w=O(h.createdAt))==null?void 0:w.toLocaleDateString())||"Unknown"})}),s==="backward"&&r.jsx(Io,{data:l(h)}),s==="woop"&&r.jsx(Do,{data:c(h)}),s==="okr"&&r.jsx(Co,{data:d(h)})]},h.id)})}),u=i[0],y={title:((h,w)=>h?w==="backward"?h.data.goal_kgi||e("target_dashboard.kgi_default"):w==="woop"?h.data.wish||e("target_dashboard.wish_default"):w==="okr"?h.data.objective||e("target_dashboard.obj_default"):e("target_dashboard.target_default"):e("target_dashboard.title_default"))(u,s),progress:Number(((x=u==null?void 0:u.data)==null?void 0:x.progress)||0),daysLeft:0,status:"good"};return r.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[r.jsx(_o,{kgi:y,currentTab:s,onTabChange:a,collapsed:n,onToggleCollapse:()=>o(!n)}),r.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-6 pb-6 pt-4",children:g()})]})},Eo=[{id:"okr",title:"OKR (Objectives and Key Results)",subTitle:"é‡Žå¿ƒçš„ãªç›®æ¨™ã¨æˆæžœæŒ‡æ¨™",color:"blue",icon:"ðŸŽ¯",concept:{summary:"ã€Œä½•ã‚’é”æˆã—ãŸã„ã‹ï¼ˆObjectiveï¼‰ã€ã¨ã€Œã©ã†ã‚„ã£ã¦é”æˆã‚’æ¸¬ã‚‹ã‹ï¼ˆKey Resultsï¼‰ã€ã‚’ã‚»ãƒƒãƒˆã§ç®¡ç†ã™ã‚‹æ‰‹æ³•ã€‚",detail:"Googleã‚„Intelã‚‚æŽ¡ç”¨ã™ã‚‹ç›®æ¨™ç®¡ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚60-70%ã®é”æˆåº¦ã§æˆåŠŸã¨ã¿ãªã™ã€Œãƒ ãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãªç›®æ¨™è¨­å®šãŒç‰¹å¾´ã§ã€ç¾çŠ¶ç¶­æŒã§ã¯ãªãé£›èºçš„ãªæˆé•·ã‚’ä¿ƒã—ã¾ã™ã€‚"},useCases:[{title:"ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å€‹äººã®ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—",before:"æ¼ ç„¶ã¨ã€ŒæŠ€è¡“åŠ›ã‚’ä¸Šã’ãŸã„ã€ã¨è€ƒãˆã€æ‰‹å½“ãŸã‚Šæ¬¡ç¬¬ã«æœ¬ã‚’èª­ã‚€ãŒèº«ã«ã¤ã‹ãªã„ã€‚",after:"O:ã€Œãƒãƒ¼ãƒ ã®Rustç§»è¡Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹å­˜åœ¨ã«ãªã‚‹ã€ KR:ã€ŒRustã§ãƒžã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’1ã¤å®Ÿè£…ã™ã‚‹ã€ã€Œç¤¾å†…å‹‰å¼·ä¼šã‚’3å›žé–‹å‚¬ã™ã‚‹ã€ã¨è¨­å®šã—ã€å­¦ç¿’ã®ç„¦ç‚¹ãŒå®šã¾ã£ãŸã€‚"},{title:"å‰¯æ¥­ãƒ»å€‹äººé–‹ç™º",before:"ã€Œã„ã¤ã‹ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã„ã€ã¨æ€ã„ã¤ã¤ã€ãƒ€ãƒ©ãƒ€ãƒ©ã¨é–‹ç™ºã‚’ç¶šã‘ã¦ã—ã¾ã†ã€‚",after:"O:ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ„›ã•ã‚Œã‚‹MVPã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã€ KR:ã€Œ3æœˆæœ«ã¾ã§ã«ã‚¹ãƒˆã‚¢å…¬é–‹ã€ã€ŒåˆæœŸãƒ¦ãƒ¼ã‚¶ãƒ¼100äººç²å¾—ã€ã€Œé€±æ¬¡ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŽ‡30%é”æˆã€ã¨æœŸé™ã¨æ•°å­—ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸã€‚"}],tips:[{q:"ç›®æ¨™ãŒé«˜ã™ãŽã¦ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¶šãã¾ã›ã‚“ã€‚",a:"OKRã¯ã€Œé”æˆã§ããªãã¦ã‚‚ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒãªã„ã€ã®ãŒå‰æã§ã™ã€‚60%é”æˆã§ãã‚Œã°å¾¡ã®å­—ã¨è€ƒãˆã€å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨è‡ªä½“ã‚’è©•ä¾¡ã—ã¾ã—ã‚‡ã†ã€‚é€²æ—ã¯é€±æ¬¡ã§ãƒã‚§ãƒƒã‚¯ã—ï¼ˆWinã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã€å°ã•ãªå‰é€²ã‚’ç¥ã†ã“ã¨ãŒé‡è¦ã§ã™ã€‚"},{q:"KRï¼ˆæˆæžœæŒ‡æ¨™ï¼‰ã®æ•°å­—ã¯ã©ã†æ±ºã‚ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œé ‘å¼µã‚Œã°é”æˆã§ãã‚‹ï¼ˆ50%ï¼‰ã€ã¨ã€Œã‹ãªã‚Šé‹ãŒè‰¯ããªã„ã¨ç„¡ç†ï¼ˆ100%ï¼‰ã€ã®é–“ã€ã€Œå°‘ã—èƒŒä¼¸ã³ãŒå¿…è¦ï¼ˆ70%ï¼‰ã€ãªãƒ©ã‚¤ãƒ³ã‚’ç‹™ã„ã¾ã—ã‚‡ã†ã€‚è¨ˆæ¸¬ä¸å¯èƒ½ãªã€Œã€œã‚’é ‘å¼µã‚‹ã€ã¯NGã§ã™ã€‚"}]},{id:"woop",title:"WOOP (Wish, Outcome, Obstacle, Plan)",subTitle:"ç§‘å­¦çš„ãªé¡˜æœ›å®Ÿç¾ãƒ¡ã‚½ãƒƒãƒ‰",color:"amber",icon:"âœ¨",concept:{summary:"ã€Œæœ€é«˜ã®æœªæ¥ã€ã¨ã€Œç¾å®Ÿã®éšœå®³ã€ã‚’å¯¾æ¯”ã•ã›ã€è„³ã‚’æœ¬æ°—ã«ã•ã›ã‚‹ï¼ˆãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰ã€‚",detail:"ãŸã ãƒã‚¸ãƒ†ã‚£ãƒ–ã«è€ƒãˆã‚‹ã ã‘ã§ãªãã€ãã‚Œã‚’é˜»ã‚€è‡ªåˆ†ã®å†…é¢ã®éšœå®³ã‚’ç›´è¦–ã—ã€ã€ŒIf-Thenãƒ—ãƒ©ãƒ³ï¼ˆã‚‚ã—XãŒèµ·ããŸã‚‰Yã™ã‚‹ï¼‰ã€ã‚’äº‹å‰ã«ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€å®Ÿè¡ŒçŽ‡ã‚’é£›èºçš„ã«é«˜ã‚ã¾ã™ã€‚"},useCases:[{title:"æ¯Žæ—¥ã®é‹å‹•ç¿’æ…£",before:"ã€Œç—©ã›ãŸã„ã€ã¨æ€ã†ã ã‘ã§ã€ä»•äº‹ã§ç–²ã‚Œã‚‹ã¨ã€Œä»Šæ—¥ã¯ã„ã„ã‚„ã€ã¨ã‚µãƒœã£ã¦ã—ã¾ã†ã€‚",after:"W:ã€Œæ¯Žæ—¥30åˆ†èµ°ã‚‹ã€ O:ã€Œä½“ãŒè»½ããªã‚Šã€è‡ªä¿¡ãŒã¤ãã€ Obs:ã€Œä»•äº‹å¸°ã‚Šã®ç–²åŠ´æ„Ÿã€ Plan:ã€Œã‚‚ã—ã€Žç–²ã‚ŒãŸã€ã¨æ„Ÿã˜ãŸã‚‰ã€ã€Žã¨ã‚Šã‚ãˆãšã‚¦ã‚§ã‚¢ã«ç€æ›¿ãˆã‚‹ã€ã€ã¨æ±ºã‚ã¦ãŠãã“ã¨ã§ã€è‡ªå‹•çš„ã«è¡Œå‹•ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚"},{title:"è³‡æ ¼è©¦é¨“ã®å‹‰å¼·",before:"ã‚¹ãƒžãƒ›ã®é€šçŸ¥ãŒæ°—ã«ãªã£ã¦é›†ä¸­åŠ›ãŒé€”åˆ‡ã‚Œã¦ã—ã¾ã†ã€‚",after:"Obs:ã€Œã‚¹ãƒžãƒ›ã‚’è¦‹ã¦ã—ã¾ã†ç™–ã€ Plan:ã€Œã‚‚ã—ã€Žå‹‰å¼·ã‚’å§‹ã‚ã‚‹ã€æ™‚ã¯ã€ã€Žã‚¹ãƒžãƒ›ã‚’åˆ¥ã®éƒ¨å±‹ã«ç½®ãã€ã€ã¨ã„ã†ã‚»ãƒƒãƒˆè¡Œå‹•ã‚’å¾¹åº•ã—ã€é›†ä¸­æ™‚é–“ã‚’ç¢ºä¿ã—ãŸã€‚"}],tips:[{q:"éšœå®³ï¼ˆObstacleï¼‰ã«ã¯ä½•ã‚’æ›¸ã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œæ™‚é–“ãŒãªã„ã€ã€ŒãŠé‡‘ãŒãªã„ã€ã¨ã„ã£ãŸå¤–éƒ¨è¦å› ã§ã¯ãªãã€ã€Œã¤ã„ãƒ€ãƒ©ãƒ€ãƒ©ã—ã¦ã—ã¾ã†ã€ã€Œå¤±æ•—ã™ã‚‹ã®ãŒæ€–ã„ã€ã¨ã„ã£ãŸã€Žè‡ªåˆ†ã®å†…é¢ã«ã‚ã‚‹æ„Ÿæƒ…ã‚„ç™–ã€ã‚’æŽ¢ã‚Šã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã“ããŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å¯èƒ½ãªçœŸã®éšœå®³ã§ã™ã€‚"},{q:"è¨ˆç”»ï¼ˆPlanï¼‰ãŒã†ã¾ãæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚",a:"ã€Œã‚‚ã—ã€œãªã‚‰ã€ã®æ¡ä»¶ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰ã‚’ã‚‚ã£ã¨å…·ä½“çš„ã«ã—ã¾ã—ã‚‡ã†ã€‚ã€Œç–²ã‚ŒãŸã‚‰ã€ã‚ˆã‚Šã‚‚ã€Œå¸°å®…ã—ã¦ã‚½ãƒ•ã‚¡ã‚’è¦‹ãŸçž¬é–“ã€ã®æ–¹ãŒè„³ã¯åå¿œã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ã€Œé ‘å¼µã‚‹ã€ã§ã¯ãªãã€Œ5åˆ†ã ã‘ã‚„ã‚‹ã€ãªã©ãƒãƒ¼ãƒ‰ãƒ«ã‚’æ¥µé™ã¾ã§ä¸‹ã’ã¦ã¿ã¦ãã ã•ã„ã€‚"}]},{id:"backward",title:"Backward Design (é€†ç®—æ€è€ƒ)",subTitle:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰ç¾åœ¨åœ°ã¸ã®æž¶ã‘æ©‹",color:"purple",icon:"ðŸ—ºï¸",concept:{summary:"ã€Œã‚ã‚ŠãŸã„å§¿ï¼ˆã‚´ãƒ¼ãƒ«ï¼‰ã€ã‹ã‚‰æ™‚é–“ã‚’å·»ãæˆ»ã—ã¦ã€ä»Šã‚„ã‚‹ã¹ãã“ã¨ã‚’æ±ºå®šã™ã‚‹ã€‚",detail:"ç¾åœ¨ã‹ã‚‰ã®ç©ã¿ä¸Šã’ï¼ˆForecastingï¼‰ã§ã¯ãªãã€æœªæ¥ã‹ã‚‰ã®é€†ç®—ï¼ˆBackcastingï¼‰ã‚’è¡Œã†ã“ã¨ã§ã€ç¾çŠ¶ã®å»¶é•·ç·šä¸Šã«ã¯ãªã„é£›èºçš„ãªæˆæžœã‚„ã€ç„¡é§„ã®ãªã„æœ€çŸ­ãƒ«ãƒ¼ãƒˆãŒè¦‹ãˆã¦ãã¾ã™ã€‚é•·æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…é ˆã®è¦–ç‚¹ã§ã™ã€‚"},useCases:[{title:"åŠå¹´å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆä¸»å‚¬",before:"ã¨ã‚Šã‚ãˆãšä¼šå ´ã ã‘æŠ¼ã•ãˆã¦ã€é›†å®¢ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç›´å‰ã«ãªã£ã¦æ…Œã¦ã¦æº–å‚™ã™ã‚‹ã€‚",after:"Goal:ã€Œã‚¤ãƒ™ãƒ³ãƒˆæˆåŠŸã€â†’ 1ãƒ¶æœˆå‰:ã€Œæº€å¸­ã€â†’ 3ãƒ¶æœˆå‰:ã€Œå‘ŠçŸ¥é–‹å§‹ãƒ»LPå®Œæˆã€â†’ ä»Š:ã€Œã‚³ãƒ³ã‚»ãƒ—ãƒˆæ±ºå®šãƒ»ç™»å£‡è€…ã‚ªãƒ•ã‚¡ãƒ¼ã€ã¨ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ç½®ãã€ä»Šæœˆã®å¿…é ˆã‚¿ã‚¹ã‚¯ã‚’æ´—ã„å‡ºã—ãŸã€‚"},{title:"ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸",before:"ä»Šã®ä»•äº‹ãŒå«Œã§è»¢è·ã‚µã‚¤ãƒˆã‚’çœºã‚ã‚‹ãŒã€ç‰¹ã«ã‚¹ã‚­ãƒ«ã‚‚ãªãå‹•ã‘ãªã„ã€‚",after:"Goal:ã€Œ3å¹´å¾Œã«ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ç‹¬ç«‹ã€â†’ 2å¹´å¾Œ:ã€Œå‰¯æ¥­æœˆåŽ20ä¸‡ã€â†’ 1å¹´å¾Œ:ã€Œã‚¹ã‚­ãƒ«ç¿’å¾—ãƒ»ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå®Œæˆã€â†’ ä»Š:ã€Œã‚¹ã‚¯ãƒ¼ãƒ«é¸ã³ãƒ»å­¦ç¿’æ™‚é–“ã®ç¢ºä¿ã€ã¨é€†ç®—ã—ã€å…·ä½“çš„ãªä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸã€‚"}],tips:[{q:"é ã„æœªæ¥ã™ãŽã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãã¾ã›ã‚“ã€‚",a:"ç„¡ç†ã«è©³ç´°ã‚’æ±ºã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ã€Œçµ¶å¯¾ã«ã“ã†ãªã£ã¦ã„ãŸã„ã€ã¨ã„ã†çŠ¶æ…‹ï¼ˆKGIï¼‰ã¨æœŸé™ã‚’æ±ºã‚ã€ãã“ã‹ã‚‰ã€Œãã®ç›´å‰ã¯ã©ã†ãªã£ã¦ã„ã‚‹ã¯ãšã‹ï¼Ÿã€ã¨1ã‚¹ãƒ†ãƒƒãƒ—ãšã¤æˆ»ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ç›´è¿‘ã®ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã ã‘è©³ç´°ã§ã‚ã‚Œã°OKã§ã™ã€‚"},{q:"è¨ˆç”»é€šã‚Šã«é€²ã¾ãªã„æ™‚ã¯ï¼Ÿ",a:"é€†ç®—æ€è€ƒã§ä½œã£ãŸè¨ˆç”»ã¯ã€Œä»®èª¬ã€ã§ã™ã€‚çŠ¶æ³ãŒå¤‰ã‚ã‚Œã°ãƒªãƒ«ãƒ¼ãƒˆï¼ˆå†è¨ˆç®—ï¼‰ã™ã‚Œã°è‰¯ã„ã®ã§ã™ã€‚é‡è¦ãªã®ã¯ã€Œã‚´ãƒ¼ãƒ«ã‚’è¦‹å¤±ã‚ãªã„ã“ã¨ã€ã€‚ç¾åœ¨åœ°ãŒå¤‰ã‚ã£ã¦ã‚‚ã€ãƒŠãƒ“ãŒç›®çš„åœ°ã¸ã®ãƒ«ãƒ¼ãƒˆã‚’å¼•ãç›´ã™ã‚ˆã†ã«ã€è¨ˆç”»ã‚’ä¿®æ­£ã—ç¶šã‘ã¾ã—ã‚‡ã†ã€‚"}]}],So=[{id:"okr",title:"OKR (Objectives and Key Results)",subTitle:"Ambitious Goals and Measurable Outcomes",color:"blue",icon:"ðŸŽ¯",concept:{summary:"A goal-setting framework for defining and tracking objectives and their outcomes.",detail:'Adopted by companies like Google and Intel. Characterized by "Moonshot" goals where 60-70% achievement is considered success, encouraging leap-forward growth rather than just the status quo.'},useCases:[{title:"Individual Skill Development",before:'Vaguely thinking "I want to improve my tech skills" and reading books without a focus.',after:`O: "Become a lead in team's Rust migration" KR: "Implement one microservice in Rust", "Hold 3 internal study sessions". Learning focus became crystal clear.`},{title:"Side Projects",before:'Wishing to release an app "someday" but continuing development without a deadline.',after:'O: "Release a MVP loved by users" KR: "App store release by March", "Gain 100 initial users", "Achieve 30% weekly active rate". Committed with dates and numbers.'}],tips:[{q:"The goals are too high and I lose motivation.",a:'OKR assumes "no penalty for falling short". Consider 60% a success and value the challenge itself. Check progress weekly (Win sessions) to celebrate small wins.'},{q:"How should I determine KR numbers?",a:'Aim for a line between "Achievable with effort (50%)" and "Impossible without extreme luck (100%)", approx the "70% stretch" line. Avoid unmeasurable descriptors like "Try hard".'}]},{id:"woop",title:"WOOP (Wish, Outcome, Obstacle, Plan)",subTitle:"A Scientific Method for Goal Realization",color:"amber",icon:"âœ¨",concept:{summary:'Mental Contrasting: Contrast your "best future" with "inner obstacles" to engage the brain.',detail:'Instead of just positive thinking, directly face your inner obstacles and prepare "If-Then Plans" in advance to dramatically increase execution rates.'},useCases:[{title:"Daily Exercise Habit",before:'Thinking "I want to lose weight" but skipping it when tired from work.',after:'W: "Run 30 mins daily" O: "Feel lighter and gain confidence" Obs: "Fatigue after work" Plan: "IF I feel tired, THEN at least change into workout clothes." Started acting automatically.'},{title:"Studying for Certifications",before:"Losing focus due to smartphone notifications.",after:'Obs: "Habit of checking phone" Plan: "IF I start studying, THEN place the phone in another room." Secured focused time.'}],tips:[{q:"What should I write for Obstacles?",a:'Avoid external factors like "no time". Look for emotions or habits within yourself, like "procrastinating" or "fear of failure". These are the true controllable obstacles.'},{q:"My Plan doesn't seem to work.",a:'Make the trigger more specific. Instead of "when tired", use "the moment I see the sofa after returning home". Keep the action extremely simple, like "do it for just 5 minutes".'}]},{id:"backward",title:"Backward Design",subTitle:"Bridging the Gap from Goal to Today",color:"purple",icon:"ðŸ—ºï¸",concept:{summary:'Determine what to do now by rewinding time from your "Ideal State (Goal)".',detail:"By using Backcasting (from future to present) instead of Forecasting (from present to future), you find shortcuts and results beyond the status quo. Essential for long-term projects."},useCases:[{title:"Organizing a Large Event",before:"Booking a venue first, then scrambling for speakers and content at the last minute.",after:'Goal: "Successful Event" -> 1mo before: "Tickets Sold out" -> 3mo before: "Start Promotion/LP Ready" -> Now: "Define Concept/Offer Speakers". Identified must-have tasks for this month.'},{title:"Career Change",before:"Disliking current job but just browsing sites without acting due to lack of skills.",after:'Goal: "Freelance in 3 years" -> 2yrs later: "200k/mo from side work" -> 1yr later: "Complete portfolio" -> Now: "Choose a school/Save study time". Started with concrete steps.'}],tips:[{q:"The future feels too distant to imagine.",a:'No need to decide every detail. Start with your KGI and deadline, then ask "What should have happened just before that?". Only the nearest milestones need full detail.'},{q:"What if I can't follow the plan?",a:`The backward plan is a hypothesis. Re-route when situations change. The important thing is "don't lose sight of the goal". Recalculate your route just like a GPS navigator.`}]}],Ao=(e="ja")=>e==="ja"?Eo:So,Mo=D.memo(({framework:e,onClick:t})=>{const{t:s}=A();return r.jsxs("div",{className:"cursor-pointer bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 transition-colors hover:border-purple-400 dark:hover:border-purple-500 group",onClick:()=>t(e),role:"button",tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(e)},children:[r.jsx("div",{className:"text-2xl mb-2",children:e.icon}),r.jsx("h2",{className:"text-base font-bold text-gray-900 dark:text-white mb-1",children:e.title}),r.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:e.concept.summary}),r.jsxs("div",{className:"mt-3 flex items-center text-xs text-purple-600 dark:text-purple-400 font-medium opacity-70 group-hover:opacity-100 transition-opacity",children:[r.jsx("span",{children:s("wiki.view_details")}),r.jsx(Me,{className:"w-3 h-3 ml-1 transform transition-transform group-hover:translate-x-0.5"})]})]})}),Ro=()=>{const{openModal:e}=oe(),{t}=A(),{language:s}=$(),a=Ao(s);return r.jsx("div",{className:"h-full bg-gray-50 dark:bg-gray-900 overflow-y-auto custom-scrollbar",children:r.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 animate-fade-in",children:[r.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center",children:[r.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-500 mr-3",children:r.jsx(sr,{className:"w-8 h-8 text-blue-500"})}),r.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-gray-800 to-gray-600 dark:from-white dark:to-gray-300",children:t("sidebar.framework_wiki")})]}),r.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(n=>r.jsx(Mo,{framework:n,onClick:o=>e("wiki-framework",o)},n.id))})]})})},Fo={backward:{id:"backward",label:"Backward Design",description:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰é€†ç®—ã—ã¦ã€ç€å®Ÿãªã‚¿ã‚¹ã‚¯ã‚’è¨­è¨ˆã—ã¾ã™ã€‚é•·æœŸçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã™ã€‚",steps:[{title:"Goal / KGI",description:"æœ€çµ‚ã‚´ãƒ¼ãƒ«ã®æ—¥ä»˜ã¨çŠ¶æ…‹ï¼ˆKGIï¼‰ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼š2025å¹´3æœˆ31æ—¥ã¾ã§ã«ã€æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼1ä¸‡äººã‚’é”æˆã™ã‚‹ã€‚",key:"goal_kgi"}]},{title:"Milestone",description:"ã‚´ãƒ¼ãƒ«ã®1ãƒ¶æœˆå‰ã«åˆ°é”ã™ã¹ãçŠ¶æ…‹ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…ãŒå®Œäº†ã—ã€ãƒ™ãƒ¼ã‚¿ç‰ˆã‚’100äººã«é…å¸ƒæ¸ˆã¿ã§ã‚ã‚‹ã€‚",key:"milestone_minus_1mo"}]},{title:"First Action",description:"ä»Šã™ãå§‹ã‚ã‚‹ã¹ãæœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šç«¶åˆã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åˆ†æžã—ã¦æ©Ÿèƒ½ãƒªã‚¹ãƒˆã‚’ä½œã‚‹ã€‚",key:"first_action"}]}]},woop:{id:"woop",label:"WOOP",description:"é¡˜æœ›ã¨éšœå®³ã‚’å¯¾æ¯”ã•ã›ã€å®Ÿè¡Œè¨ˆç”»ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ç¿’æ…£åŒ–ã‚„å›°é›£ãªç›®æ¨™ã«æœ‰åŠ¹ã§ã™ã€‚",steps:[{title:"Wish (é¡˜æœ›)",description:"é”æˆã—ãŸã„ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆæŒ‘æˆ¦çš„ã ãŒé”æˆå¯èƒ½ãªã‚‚ã®ï¼‰",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šæ¯Žæ—¥30åˆ†ã€è‹±èªžã®å‹‰å¼·ã‚’ã™ã‚‹ã€‚",key:"wish"}]},{title:"Outcome (çµæžœ)",description:"ãã‚ŒãŒé”æˆã§ããŸæ™‚ã®ã€Œæœ€é«˜ã®ãƒ¡ãƒªãƒƒãƒˆã€ã‚„æ„Ÿæƒ…ã‚’è©³ã—ãã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šå­—å¹•ãªã—ã§æµ·å¤–ãƒ‰ãƒ©ãƒžã‚’æ¥½ã—ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã€è‡ªä¿¡ãŒã¤ãã€‚",key:"outcome"}]},{title:"Obstacle (éšœå®³)",description:"ãã‚Œã‚’é‚ªé­”ã™ã‚‹ã€ã‚ãªãŸè‡ªèº«ã®ã€Œå†…é¢ã®éšœå®³ã€ï¼ˆæ„Ÿæƒ…ãƒ»ç™–ãƒ»æ€ã„è¾¼ã¿ï¼‰ã¯ä½•ã§ã™ã‹ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä»•äº‹ã§ç–²ã‚Œã¦å¸°ã£ã¦ãã‚‹ã¨ã€ã¤ã„ã‚¹ãƒžãƒ›ã§SNSã‚’è¦‹ã¦ã—ã¾ã†ã€‚",key:"obstacle"}]},{title:"Plan (è¨ˆç”»)",description:"ã€Œã‚‚ã—ï¼ˆéšœå®³ï¼‰ãŒèµ·ããŸã‚‰ã€ï¼ˆè¡Œå‹•ï¼‰ã™ã‚‹ã€ã¨ã„ã†å½¢ã§è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚‚ã—ã€Œç–²ã‚Œã¦ã‚½ãƒ•ã‚¡ã«åº§ã‚Šãã†ã€ã«ãªã£ãŸã‚‰ã€ã€Œã™ãã«ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹ãã€ã¨ã™ã‚‹ã€‚",key:"plan"}]}]},okr:{id:"okr",label:"OKR",description:"é‡Žå¿ƒçš„ãªç›®æ¨™(O)ã¨ã€æ¸¬å®šå¯èƒ½ãªæˆæžœ(KR)ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚çµ„ç¹”ã‚„ãƒãƒ¼ãƒ ã€é«˜ã„æˆé•·ã‚’ç›®æŒ‡ã™å€‹äººã«ã€‚",steps:[{title:"Objective",description:"å®šæ€§çš„ã§ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ã‚ˆã†ãªç›®æ¨™ã‚’1ã¤æ±ºã‚ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä¸–ç•Œä¸­ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«æ„›ã•ã‚Œã‚‹é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹ï¼",key:"objective"}]},{title:"Key Results",description:"ç›®æ¨™é”æˆã‚’æ¸¬ã‚‹ãŸã‚ã®ã€3ã¤ã®å…·ä½“çš„ãªæ•°å­—ï¼ˆæŒ‡æ¨™ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"text",placeholder:"KR 1 (ä¾‹: GitHubã‚¹ã‚¿ãƒ¼æ•° 1,000åˆ°é”)",key:"kr_1"},{type:"text",placeholder:"KR 2 (ä¾‹: é€±é–“ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•° 500å›ž)",key:"kr_2"},{type:"text",placeholder:"KR 3 (ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¶™ç¶šçŽ‡ 40%ç¶­æŒ)",key:"kr_3"}]}]}},Lo={backward:{id:"backward",label:"Backward Design",description:"Design solid tasks by rewinding from your goal. Best for long-term projects.",steps:[{title:"Goal / KGI",description:"Define the date and state (KGI) of your final goal.",inputs:[{type:"textarea",placeholder:"e.g., Reach 10,000 monthly active users by March 31, 2025.",key:"goal_kgi"}]},{title:"Milestone",description:"What should be the state one month before the goal?",inputs:[{type:"textarea",placeholder:"e.g., Core features implemented and beta distributed to 100 users.",key:"milestone_minus_1mo"}]},{title:"First Action",description:"What is the very first action you should start right now?",inputs:[{type:"textarea",placeholder:"e.g., Analyze competitor reviews and create a feature list.",key:"first_action"}]}]},woop:{id:"woop",label:"WOOP",description:"Contrast wishes and obstacles to automate your execution plan. Effective for habits and tough goals.",steps:[{title:"Wish",description:"What do you want to achieve? (Challenging but achievable)",inputs:[{type:"textarea",placeholder:"e.g., Study English for 30 minutes every day.",key:"wish"}]},{title:"Outcome",description:`Imagine the "best benefit" or feeling when it's achieved.`,inputs:[{type:"textarea",placeholder:"e.g., Enjoy foreign dramas without subtitles and gain confidence.",key:"outcome"}]},{title:"Obstacle",description:'What is your "inner obstacle" (emotion, habit, belief) that gets in the way?',inputs:[{type:"textarea",placeholder:"e.g., Checking SNS on the phone when returning home tired from work.",key:"obstacle"}]},{title:"Plan",description:'Make a plan in the form of "IF (obstacle) happens, THEN (action)".',inputs:[{type:"textarea",placeholder:"e.g., IF I am about to sit on the sofa tired, THEN I will open the textbook immediately.",key:"plan"}]}]},okr:{id:"okr",label:"OKR",description:"Combine ambitious objectives (O) with measurable key results (KR). For organizations, teams, or high-growth individuals.",steps:[{title:"Objective",description:"Decide on one qualitative and exciting objective.",inputs:[{type:"textarea",placeholder:"e.g., Build a development tool loved by engineers worldwide!",key:"objective"}]},{title:"Key Results",description:"Set three specific metrics (indices) to measure goal achievement.",inputs:[{type:"text",placeholder:"KR 1 (e.g., Reach 1,000 GitHub stars)",key:"kr_1"},{type:"text",placeholder:"KR 2 (e.g., 500 downloads per week)",key:"kr_2"},{type:"text",placeholder:"KR 3 (e.g., Maintain 40% user retention rate)",key:"kr_3"}]}]}},Ze=(e="ja")=>e==="ja"?Fo:Lo,_r=k.forwardRef(({className:e,label:t,error:s,containerClassName:a,id:n,...o},i)=>r.jsxs("div",{className:I("flex flex-col gap-1.5 h-full",a),children:[t&&r.jsx("label",{htmlFor:n,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),r.jsx("textarea",{ref:i,id:n,className:I("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-3 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600 resize-none","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",e),"aria-invalid":!!s,"aria-describedby":s&&n?`${n}-error`:void 0,...o}),s&&r.jsx("p",{id:n?`${n}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]}));_r.displayName="Textarea";const Po=({mode:e,currentStep:t})=>{const{language:s}=$(),a=Ze(s)[e],n=a.steps.length;return r.jsx("div",{className:"flex items-center justify-between mb-8 max-w-2xl mx-auto",children:r.jsx("div",{className:"flex items-center space-x-1 mx-auto w-full justify-center",children:a.steps.map((o,i)=>{const l=i+1,c=t>l,d=t===l,g=t<l;return r.jsxs(D.Fragment,{children:[r.jsxs("div",{className:"flex flex-col items-center relative z-10 w-16",children:[r.jsx("div",{className:I("w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 font-bold",d&&"bg-blue-600 text-white ring-4 ring-blue-100 dark:ring-blue-900",c&&"bg-green-500 text-white",g&&"bg-gray-200 dark:bg-gray-700 text-gray-500"),children:c?"âœ“":l}),r.jsx("div",{className:I("text-[10px] mt-1 font-medium text-center w-20 truncate",d?"text-blue-600 dark:text-blue-400":"text-gray-400"),children:o.title})]}),i<n-1&&r.jsx("div",{className:I("h-1 flex-1 mx-[-10px] mt-[-14px] z-0 transition-all duration-500 rounded-full",t>l?"bg-green-500":"bg-gray-200 dark:bg-gray-700")})]},i)})})})},Oo=({mode:e,step:t,onBack:s,onNext:a,onFinish:n})=>{const{t:o}=A(),{language:i}=$(),l=Ze(i)[e],c=t-1,d=l.steps[c],g=l.steps.length,[u,p]=k.useState({}),y=(h,w)=>{p(_=>({..._,[h]:w}))},x=()=>{const h=(d.inputs??[]).reduce((w,_,m)=>{const f=u[m]||"";return _.key&&(w[_.key]=f),w},{});t<g?a(h):n(h)};return r.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[r.jsxs("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-900 dark:text-white",children:[l.label," Mode"]}),r.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8 min-h-[500px] flex flex-col",children:[r.jsx(Po,{mode:e,currentStep:t}),r.jsxs("div",{className:"flex-1 animate-fade-in",children:[r.jsxs("h3",{className:"text-xl font-bold mb-2 text-gray-800 dark:text-gray-100",children:["Q",t,". ",d.title]}),r.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-400",children:d.description}),r.jsx("div",{className:"mb-8 space-y-4",children:(d.inputs??[]).map((h,w)=>r.jsx("div",{children:h.type==="textarea"?r.jsx(_r,{name:h.key||`textarea-${w}`,id:h.key||`textarea-${w}`,className:"text-base",rows:5,placeholder:h.placeholder,value:u[w]||"",onChange:_=>y(w,_.target.value),"aria-label":h.placeholder}):r.jsx(Dt,{name:h.key||`input-${w}`,id:h.key||`input-${w}`,className:"text-base",placeholder:h.placeholder,value:u[w]||"",onChange:_=>y(w,_.target.value),"aria-label":h.placeholder})},h.key||w))})]}),r.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[r.jsx(ue,{onClick:s,variant:"ghost",className:"text-gray-600 dark:text-gray-400 font-medium",children:o("wizard.back")}),t<g?r.jsx(ue,{onClick:x,variant:"primary",className:"bg-blue-600 hover:bg-blue-700 shadow-md",rightIcon:r.jsx(Me,{className:"w-4 h-4 ml-2"}),children:o("wizard.next")}):r.jsx(ue,{onClick:x,variant:"primary",className:"bg-green-600 hover:bg-green-700 shadow-lg transform hover:scale-105",leftIcon:r.jsx(Pe,{className:"w-5 h-5 mr-2"}),children:o("wizard.finish")})]})]})]})},Bo=({currentMode:e,onModeChange:t,onStart:s})=>{const{t:a}=A(),{language:n}=$(),o=Ze(n),i=o[e],l=(a(`wizard.features.${e}`)||"").split(",");return r.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-full max-h-[700px] flex flex-col py-6",children:[r.jsx("div",{className:"mb-4 flex-shrink-0",children:r.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[r.jsx(rr,{className:"w-3 h-3 mr-1.5"}),r.jsx("span",{className:"font-medium",children:a("sidebar.target_wizard")}),r.jsx(Me,{className:"w-3 h-3 mx-1.5"}),r.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-semibold",children:a("wizard.select_method")})]})}),r.jsxs("div",{className:"mb-6 flex-shrink-0",children:[r.jsx("h2",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:a("wizard.select_framework")}),r.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:Object.keys(o).map(c=>r.jsx("button",{onClick:()=>t(c),className:I("flex-1 py-2 text-xs font-bold rounded-lg transition-all",e===c?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"),children:o[c].label},c))})]}),r.jsx("div",{className:"flex-1 mb-6 min-h-0",children:r.jsx("div",{className:"h-full bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl border-2 border-gray-200 dark:border-gray-700 overflow-hidden shadow-xl",children:r.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[r.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mb-4 shadow-lg flex-shrink-0",children:r.jsx(Pe,{className:"w-8 h-8 text-white"})}),r.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 text-xl",children:i.label}),r.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-2xl leading-relaxed",children:i.description}),r.jsx("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:l.map(c=>r.jsx("span",{className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full text-xs font-medium text-gray-700 dark:text-gray-300 shadow-sm",children:c.trim()},c))})]})})}),r.jsx("div",{className:"flex justify-center pb-4 flex-shrink-0",children:r.jsx(ue,{variant:"premium",size:"lg",onClick:s,className:"shadow-xl",rightIcon:r.jsx(Me,{className:"w-4 h-4"}),children:a("wizard.start_mode")})})]})},$o=()=>{const[e,t]=k.useState("backward"),[s,a]=k.useState(0),[n,o]=k.useState({}),{setView:i,viewData:l}=te(),{workspaceId:c}=le(),{t:d}=A(),{language:g}=$(),u=Ze(g);k.useEffect(()=>{l!=null&&l.mode&&(t(l.mode),a(0))},[l]);const p=h=>{o(w=>({...w,...h})),a(w=>w+1)},y=async h=>{const w={...n,...h};if(!c){C.error(d("wizard.alert_no_workspace"));return}try{await wn(c,{mode:e,data:w}),console.log("Wizard Completed, Saved to Firestore",w),C.success(d("wizard.alert_create_success",{label:u[e].label})),a(0),o({}),i("target-dashboard")}catch(_){console.error("Failed to save wizard target:",_),C.error(d("wizard.alert_save_fail"))}},x=()=>{a(h=>Math.max(0,h-1))};return s===0?r.jsx(Bo,{currentMode:e,onModeChange:t,onStart:()=>a(1)}):r.jsx(Oo,{mode:e,step:s,onBack:x,onNext:p,onFinish:y})},Wo=(e,t)=>{const s=$t(We(Wt,{activationConstraint:{distance:5}}),We($r,{activationConstraint:{delay:v.DND.TOUCH_DELAY,tolerance:5}})),{t:a}=A(),n=k.useRef(e),o=k.useCallback(()=>{n.current=e},[e]),i=k.useCallback(async l=>{var y,x,h,w,_;const{active:c,over:d}=l;if(!d)return;const g=String(c.id),u=String(d.id);let p=null;if(c.data.current&&c.data.current.type==="task"&&(p=((y=c.data.current.task)==null?void 0:y.id)||g.replace(v.DND.PREFIX_TASK,"")),p){const m=d.data.current,f=m==null?void 0:m.type,S=m==null?void 0:m.value;if(f&&zo(f)){const R={};if(f===v.DND.TYPE_PROJECT)R.projectId=S;else if(f===v.DND.TYPE_INBOX)R.projectId=null;else if(f===v.DND.TYPE_TIMEBLOCK)R.timeBlockId=S==="unassigned"?null:S;else if(f===v.DND.TYPE_LABEL){const F=(x=c.data.current)==null?void 0:x.task,P=(F==null?void 0:F.labelIds)??[];S&&(P.includes(S)?R.labelIds=P.filter(U=>U!==S):R.labelIds=[...P,S])}if(Object.keys(R).length>0){try{await ct(p,R)}catch(F){console.error("Failed to update task via dnd",F),C.error(a("msg.dnd.reorderFailed")||a("error"))}return}}if(g!==u&&u.startsWith(v.DND.PREFIX_TASK)){const R=u.replace(v.DND.PREFIX_TASK,"");(h=t==null?void 0:t.onTasksReorder)==null||h.call(t,p,R);return}}if(g!==u&&g.startsWith(v.DND.PREFIX_PROJECT)&&u.startsWith(v.DND.PREFIX_PROJECT)){const m=n.current,f=g.replace(v.DND.PREFIX_PROJECT,""),S=u.replace(v.DND.PREFIX_PROJECT,""),R=m.findIndex(P=>P.id===f),F=m.findIndex(P=>P.id===S);if(R!==-1&&F!==-1){const P=ft(m,R,F);(w=t==null?void 0:t.onOptimisticReorder)==null||w.call(t,P);try{await un(P.map(U=>U.id))}catch(U){console.error("Failed to update project order",U),C.error(a("msg.dnd.reorderFailed")||a("error")),(_=t==null?void 0:t.onRevertReorder)==null||_.call(t,m)}}}},[e,t,a]);return{sensors:s,handleDragEnd:i,handleDragStart:o}};function zo(e){return[v.DND.TYPE_PROJECT,v.DND.TYPE_INBOX,v.DND.TYPE_TIMEBLOCK,v.DND.TYPE_LABEL].includes(e)}const qo=()=>{const{workspaceId:e,userId:t,loading:s}=le(),a=k.useCallback(c=>!e||!t?()=>{}:Va(e,c),[e,t]),n=e?Ka(e):!1,{data:o,isPending:i}=Ne(["labels",t||void 0,e||void 0],a,e&&n?Ua(e):void 0);return{labels:o||[],loading:s||!!e&&i}},Uo=()=>{const{fontEn:e,fontJp:t,fontSize:s,density:a,themeMode:n}=$(),{setSidebarDensity:o}=yt();k.useEffect(()=>{const i=document.documentElement,l=document.body;n==="dark"?i.classList.add("dark"):n==="light"?i.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?i.classList.add("dark"):i.classList.remove("dark"),i.style.setProperty("--font-en",e),i.style.setProperty("--font-jp",t);const c=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];l.classList.remove(...c),l.classList.add(`font-app-${s}`);const d=["app-density-compact","app-density-normal","app-density-comfortable","app-density-spacious"];l.classList.remove(...d),l.classList.add(`app-density-${a}`),o(a);const g=window.matchMedia("(prefers-color-scheme: dark)"),u=()=>{n==="system"&&(g.matches?i.classList.add("dark"):i.classList.remove("dark"))};return g.addEventListener("change",u),()=>g.removeEventListener("change",u)},[n,e,t,s,a,o])};function Ot(e){const t=String(e);return t.startsWith("project:")||t==="inbox"||t.startsWith("timeblock:")||t.startsWith("duration:")||t.startsWith("label:")}const Ko=e=>{const s=Wr(e).filter(n=>Ot(n.id));if(s.length>0)return s;const a=e.droppableContainers.filter(n=>Ot(n.id));if(a.length>0){const n={...e,droppableContainers:a},o=zr(n);if(o.length>0)return o}return qt(e)},Vo=()=>{Uo();const{filterType:e,targetId:t,query:s}=ee(),{currentView:a,setView:n}=te(),{setFilter:o}=ee(),{projects:i,setProjectsOverride:l}=Ct(),{labels:c}=qo(),[d,g]=D.useState({user:T.currentUser,loading:!T.currentUser}),u=k.useCallback(_=>{const m=_.target,f=["INPUT","TEXTAREA"].includes(m.tagName)||m.closest("[contenteditable]"),S=document.querySelector('[role="dialog"]');_.key==="/"&&!f&&!S&&(_.preventDefault(),o("search"),n("search"))},[o,n]);D.useEffect(()=>{const _=Vt(T,m=>{g({user:m,loading:!1})});return document.addEventListener("keydown",u),()=>{_(),document.removeEventListener("keydown",u)}},[u]);const{onTasksReorder:p}=wr(),{sensors:y,handleDragEnd:x,handleDragStart:h}=Wo(i,{onOptimisticReorder:l,onRevertReorder:l,onTasksReorder:p||void 0}),w=k.useMemo(()=>{var _,m;if(a==="wizard")return"Goal Wizard";if(a==="target-dashboard")return"Target Dashboard";if(a==="wiki")return"Framework Wiki";if(a==="search")return s?`"${s}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";if(e==="project")return((_=i.find(f=>f.id===t))==null?void 0:_.name)||"Project";if(e==="label")return((m=c.find(f=>f.id===t))==null?void 0:m.name)||"Label";if(e==="search")return s?`"${s}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";switch(e){case"inbox":return"Inbox";case"today":return"Today";case"upcoming":return"Upcoming";case"important":return"Important";case"custom":return"All Tasks";default:return"TaskMg"}},[a,s,e,t,i,c]);return d.loading?r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:r.jsxs("div",{className:"flex flex-col items-center gap-4",children:[r.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),r.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"èª­ã¿è¾¼ã¿ä¸­..."})]})}):d.user?r.jsxs(zt,{sensors:y,collisionDetection:Ko,onDragEnd:x,onDragStart:h,children:[r.jsx(ms,{}),r.jsx(da,{}),r.jsx(ea,{sidebarContent:r.jsx(ko,{}),title:w,children:a==="wizard"?r.jsx($o,{}):a==="target-dashboard"?r.jsx(To,{}):a==="wiki"?r.jsx(Ro,{}):a==="search"?r.jsx(vo,{}):a==="dashboard"?r.jsx(jo,{}):r.jsx(Nr,{})})]}):r.jsx(us,{})};class Ho extends k.Component{constructor(s){super(s);se(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,a){Gs(s,a.componentStack??void 0)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const s=$.getState().language,{t:a}=Ee(s);return r.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:r.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[r.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:r.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),r.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:a("error_boundary.title")}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:a("error_boundary.description")}),r.jsxs("div",{className:"flex gap-3 justify-center",children:[r.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:a("error_boundary.retry")}),r.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:a("error_boundary.reload")})]}),!1]})})}return this.props.children}}const Go=new os({defaultOptions:{queries:{staleTime:1/0,refetchOnWindowFocus:!1,retry:!1}}});ne(()=>Promise.resolve().then(()=>Yo),void 0);Hs();Zr();const Ir=document.getElementById("app");if(!Ir)throw new Error("Failed to find the root element");const Xo=r.jsx(Ho,{children:r.jsx(Pr,{client:Go,children:r.jsx(Vo,{})})});Lr.createRoot(Ir).render(Xo);const Yo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Qt as $,Qe as A,ue as B,ps as C,Ai as D,Ni as E,vi as F,br as G,O as H,Dt as I,ki as J,Ei as K,ct as L,An as M,kt as N,ys as O,li as P,ci as Q,di as R,ui as S,gi as T,v as U,hi as V,_r as W,bi as X,yi as Y,jr as Z,uo as _,oe as a,ai as a0,Gn as a1,Si as a2,T as a3,N as a4,j as a5,Pe as a6,Ve as a7,ur as a8,ii as a9,oi as aa,C as ab,$e as ac,wi as ad,ji as ae,le as b,Ii as c,_i as d,Ci as e,I as f,Ke as g,He as h,Ti as i,Di as j,dn as k,ni as l,zs as m,pi as n,fi as o,mi as p,xi as q,Ao as r,Us as s,te as t,A as u,ks as v,Me as w,rr as x,er as y,Ct as z};
