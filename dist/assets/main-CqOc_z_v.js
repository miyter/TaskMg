var Hc=Object.defineProperty;var zc=(n,t,e)=>t in n?Hc(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var w=(n,t,e)=>zc(n,typeof t!="symbol"?t+"":t,e);import{getAuth as jc,signInWithEmailAndPassword as Vc,updatePassword as Uc,onAuthStateChanged as Wc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as qc,updateDoc as Mn,doc as pt,addDoc as zi,collection as dt,serverTimestamp as Oe,deleteDoc as An,query as ye,orderBy as nr,onSnapshot as Pe,getDocs as li,limit as Yc,Timestamp as ir,getDoc as Gc,setDoc as Kc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as Xc}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const Cr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let ci,R,Y,wi=!1;function Jc(){if(wi)return;const n=Zc();if(n!=null&&n.apiKey)try{ci=Xc(n),R=jc(ci),Y=qc(ci),wi=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function Zc(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&Cr){const n=Cr,t={apiKey:n.VITE_FIREBASE_API_KEY,authDomain:n.VITE_FIREBASE_AUTH_DOMAIN,projectId:n.VITE_FIREBASE_PROJECT_ID,storageBucket:n.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:n.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:n.VITE_FIREBASE_APP_ID,measurementId:n.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(n){return console.error("[Firebase] Config parse failed (legacy):",n),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function $a(){if(!wi)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:ci,auth:R,db:Y}}function Qc(n,t,e){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${e?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${n.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${n.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function td(n){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!n.title)switch(n.type){case"error":n.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":n.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":n.title="確認",t="bg-red-600 hover:bg-red-700";break;default:n.title="通知";break}const e=n.type==="confirm";!e&&n.okText==="OK"&&(n.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",Qc(n,t,e));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),r=document.getElementById("msg-modal-body"),o=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=n.title,r.textContent=n.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!e&&l()};document.addEventListener("keydown",c),o.onclick=()=>{n.onConfirm&&n.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!e&&l()},o.focus()}function T(n,t=null){let e={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof n=="object"&&n!==null?e={...e,...n}:(e.message=String(n),typeof t=="function"?(e.type="confirm",e.onConfirm=t):typeof t=="string"&&(e.type=t)),td(e)}async function ed(n,t){if(!wi)throw new Error("Firebaseが初期化されていないぞ。");try{return await Vc(R,n,t)}catch(e){let i="ログインに失敗した。";switch(e.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function nd(n){const t=R.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await Uc(t,n),T({message:"パスワードを変更したぞ",type:"success"})}catch(e){let i="変更に失敗した: "+e.message;throw e.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),T({message:i,type:"error"}),e}}function id(){const n=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),e=document.getElementById("password-input");if(!n||!t||!e)return;const i=async()=>{const s=t.value.trim(),r=e.value.trim();if(!s||!r)return T({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await ed(s,r)}catch(o){T({message:o.message,type:"error"})}};n.onclick=i,e.addEventListener("keydown",s=>{s.key==="Enter"&&!s.isComposing&&i()})}function sd(n){const t={loginForm:document.getElementById("login-form-container"),userInfo:document.getElementById("user-info"),userEmailDisplay:document.getElementById("user-email-display"),emailInput:document.getElementById("email-input"),passInput:document.getElementById("password-input")};!t.loginForm||!t.userInfo||(n?(n.uid,t.loginForm.classList.add("hidden"),t.userInfo.classList.remove("hidden"),t.userInfo.classList.add("flex"),t.userEmailDisplay&&(t.userEmailDisplay.textContent=n.email||"ユーザー")):(t.loginForm.classList.remove("hidden"),t.userInfo.classList.add("hidden"),t.userInfo.classList.remove("flex"),t.emailInput&&(t.emailInput.value=""),t.passInput&&(t.passInput.value=""),t.userEmailDisplay&&(t.userEmailDisplay.textContent="")))}const rd={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},H={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,CLASSES:{COMPACT_PY:"py-0.5",NORMAL_PY:"py-1.5",CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},STORAGE_KEYS:{WIDTH:"sidebarWidth",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:"},LIST_IDS:{PROJECTS:"project-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function od(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function Ee(n){return`artifacts/${od()}/users/${n}`}function Dr(n,t){return`${Ee(n)}/workspaces/${t}`}const j={users:n=>Ee(n),filters:n=>`${Ee(n)}/filters`,labels:n=>`${Ee(n)}/labels`,workspaces:n=>`${Ee(n)}/workspaces`,timeblocks:n=>`${Ee(n)}/timeblocks`,tasks:(n,t)=>`${Dr(n,t)}/tasks`,projects:(n,t)=>`${Dr(n,t)}/projects`},Si="currentWorkspaceId",ad="workspace-changed";let Fn=null,sr=[];function As(){return sr}function ld(n,t){if(!n)return typeof t=="function"&&t([]),()=>{};Fn&&Fn();const e=j.workspaces(n),i=ye(dt(Y,e),nr("createdAt","asc"));return Fn=Pe(i,s=>{const r=s.docs.map(o=>({id:o.id,...o.data()}));if(sr=r,r.length===0&&!s.metadata.hasPendingWrites)typeof t=="function"&&t([]),cd().catch(o=>console.error("[Workspace] Default creation error:",o));else{const o=dd(r);typeof t=="function"&&t(r),Ha(o,r)}},s=>{console.error("[Workspace] Subscription error:",s),typeof t=="function"&&t([])}),Fn}async function cd(){try{const n=R.currentUser;if(!n)return;const t=j.workspaces(n.uid);(await li(ye(dt(Y,t),Yc(1)))).empty&&await za("メイン")}catch(n){console.error("[Workspace] Failed to ensure default workspace:",n)}}function dd(n){if(n.length===0)return null;let t=$t();const e=n.some(i=>i.id===t);return(!t||!e)&&(t=n[0].id,localStorage.setItem(Si,t)),t}function $t(){return localStorage.getItem(Si)}function rr(n){!n||localStorage.getItem(Si)===n||(localStorage.setItem(Si,n),Ha(n,sr))}function Ha(n,t){const e=new CustomEvent(ad,{detail:{workspaceId:n,workspaces:t}});document.dispatchEvent(e)}async function za(n){try{const t=R.currentUser;if(!t)throw new Error("Authentication required");const e=j.workspaces(t.uid);return{id:(await zi(dt(Y,e),{name:n,createdAt:Oe()})).id,name:n}}catch(t){throw console.error("[Workspace] Add error:",t),T("ワークスペースの作成に失敗した。"),t}}async function ud(n,t){try{const e=R.currentUser;if(!e)throw new Error("Authentication required");const i=j.workspaces(e.uid);await Mn(pt(Y,i,n),{name:t})}catch(e){console.error("[Workspace] Update error:",e),T("名前の更新に失敗した。")}}async function hd(n){try{const t=R.currentUser;if(!t)throw new Error("Authentication required");const e=j.workspaces(t.uid);await An(pt(Y,e,n))}catch(t){console.error("[Workspace] Delete error:",t),T("削除に失敗した。")}}let ts=null;function ji(){return ts||(ts=$a().db),ts}let di=[];function fd(n,t,e){di=[];const i=j.projects(n,t),s=ji(),r=ye(dt(s,i),nr("createdAt","asc"));return Pe(r,o=>{const a=o.docs.map(l=>({id:l.id,...l.data()}));di=a,e(a)},o=>{console.error("Error subscribing to projects:",o),di=[],e([])})}function gd(){return di}async function pd(n,t,e){const i=j.projects(n,t),s=ji();await zi(dt(s,i),{name:e,ownerId:n,createdAt:Oe()})}async function md(n,t,e,i){const s=j.projects(n,t),r=ji(),o=pt(r,s,e);return Mn(o,i)}async function bd(n,t,e){const i=j.projects(n,t),s=ji();await An(pt(s,i,e))}function ja(){var e;const n=(e=R.currentUser)==null?void 0:e.uid,t=$t();if(!n||!t)throw new Error("Authentication or Workspace required.");return{userId:n,workspaceId:t}}const Va=gd,yd=(n,t)=>{const e=typeof n=="function"?n:t,i=typeof n=="string"?n:$t(),s=R.currentUser;return s&&i&&typeof e=="function"?fd(s.uid,i,e):(typeof e=="function"&&e([]),()=>{})},xd=async(n,t=null)=>{const e=R.currentUser;if(!e)throw new Error("Authentication required.");const i=t||$t();if(!i)throw new Error("Workspace selection required.");return pd(e.uid,i,n)},vd=async(n,t)=>{const{userId:e,workspaceId:i}=ja();return md(e,i,n,t)},Ua=async n=>{const{userId:t,workspaceId:e}=ja();return bd(t,e,n)},Wa=()=>window.innerWidth>=H.BREAKPOINT_MD,Tn=(n,t=!0)=>{const e=localStorage.getItem(n);return e===null?t:e==="true"},_d=()=>Tn(H.STORAGE_KEYS.COMPACT,!1),Ei=(n,t)=>Array.isArray(n)?n.filter(e=>e.status!=="completed"&&t(e)).length:0;function qa(n,t){if(!t||!n)return;const e=localStorage.getItem(H.STORAGE_KEYS.WIDTH),i=e?parseInt(e,10):H.DEFAULT_WIDTH;n.classList.contains(H.CLASSES.CLOSED)||(n.style.width=`${i}px`);let s=!1;const r=l=>{if(!s)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=H,u=Math.max(c,Math.min(d,l.clientX));n.style.width=`${u}px`},o=()=>{if(!s)return;s=!1,document.body.style.cursor="",document.body.classList.remove("select-none"),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",o);const l=parseInt(n.style.width,10);isNaN(l)||localStorage.setItem(H.STORAGE_KEYS.WIDTH,l)},a=l=>{n.classList.contains(H.CLASSES.CLOSED)||(s=!0,document.body.style.cursor="col-resize",document.body.classList.add("select-none"),document.addEventListener("mousemove",r),document.addEventListener("mouseup",o),l.preventDefault())};t.onmousedown=a}const Fe={NONE:"none",TEXTURE:"haikei"},se={SMALL:"sm",MEDIUM:"md",LARGE:"lg"};function Mt(n,t,e,i,s=""){return`
        <label class="flex items-center cursor-pointer p-2 border border-gray-200 dark:border-gray-700 rounded-md hover:bg-gray-50 dark:hover:bg-gray-700/50 transition-colors">
            <input type="radio" name="${n}" value="${t}" class="form-radio text-blue-600 w-4 h-4 focus:ring-blue-500" ${i?"checked":""}>
            <div class="ml-2 flex items-center gap-1.5">
                ${s}
                <span class="text-sm text-gray-900 dark:text-white">${e}</span>
            </div>
        </label>
    `}function es(n,t,e=!1){return`
        <details class="group border border-gray-200 dark:border-gray-700 rounded-md bg-white dark:bg-gray-800 overflow-hidden transition-all" ${e?"open":""}>
            <summary class="flex justify-between items-center px-3 py-2.5 cursor-pointer bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700/50 transition-colors select-none">
                <h4 class="text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider">${n}</h4>
                <span class="transform group-open:rotate-180 transition-transform duration-200 text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </span>
            </summary>
            <div class="p-3 border-t border-gray-100 dark:border-gray-700 space-y-4">
                ${t}
            </div>
        </details>
    `}function kd(n,t,e){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||se.MEDIUM,r=localStorage.getItem("background")||Fe.NONE,o=n||"?",a=`
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">テーマ</label>
            <div class="grid grid-cols-2 gap-3">
                ${Mt("app-theme","light","ライト",i==="light",'<svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                ${Mt("app-theme","dark","ダーク",i==="dark",'<svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">文字サイズ</label>
            <div class="grid grid-cols-3 gap-3">
                ${Mt("font-size",se.LARGE,"大",s===se.LARGE)}
                ${Mt("font-size",se.MEDIUM,"中",s===se.MEDIUM)}
                ${Mt("font-size",se.SMALL,"小",s===se.SMALL)}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークのみ)</label>
            <div class="grid grid-cols-2 gap-3">
                ${Mt("bg-pattern",Fe.NONE,"無地",r===Fe.NONE)}
                ${Mt("bg-pattern",Fe.TEXTURE,"テクスチャ",r===Fe.TEXTURE)}
            </div>
        </div>
        <div>
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300 mb-2">サイドバーの密度</label>
            <div class="grid grid-cols-2 gap-3">
                ${Mt("sidebar-density","normal","通常",!e)}
                ${Mt("sidebar-density","compact","コンパクト",e)}
            </div>
        </div>
    `,l=`
        <button id="export-data-btn-new" class="w-full text-left px-3 py-2.5 bg-gray-50 dark:bg-gray-700/30 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-md transition-colors flex justify-between items-center group border border-gray-100 dark:border-gray-700">
            <div>
                <div class="text-sm font-medium text-gray-800 dark:text-gray-200">バックアップを作成 (JSON)</div>
                <div class="text-xs text-gray-500 mt-0.5">タスク・プロジェクト等の全データをDL</div>
            </div>
            <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
        </button>
    `,c=`
        <div class="flex items-center gap-3 mb-4 p-3 bg-blue-50 dark:bg-blue-900/20 rounded-md">
            <div class="w-10 h-10 rounded-full bg-blue-100 dark:bg-blue-800 flex items-center justify-center text-blue-600 dark:text-blue-200 font-bold text-lg shadow-sm">
                ${o}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-600 dark:text-gray-300 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <label class="block text-xs font-semibold text-gray-700 dark:text-gray-300">パスワードの変更</label>
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新パスワード (6文字以上)" class="flex-1 px-3 py-1.5 bg-white dark:bg-gray-900 border border-gray-300 dark:border-gray-600 rounded-md text-sm outline-none">
                <button id="update-password-btn-new" class="px-3 py-1.5 bg-gray-800 hover:bg-gray-700 text-white text-sm font-medium rounded-md transition-colors whitespace-nowrap">変更</button>
            </div>
        </div>
        <div class="mt-4 pt-4 border-t border-gray-100 dark:border-gray-700">
            <button id="logout-btn-settings" class="w-full py-2 bg-red-50 hover:bg-red-100 dark:bg-red-900/20 text-red-600 dark:text-red-400 font-bold rounded-md border border-red-200 dark:border-red-800 flex items-center justify-center gap-2 group text-sm">
                <svg class="w-4 h-4 group-hover:-translate-x-1 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `;return`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-lg overflow-hidden flex flex-col max-h-[85vh]">
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50">
                <h3 class="text-base font-bold text-gray-800 dark:text-white flex items-center gap-2">設定</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-700"><svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="p-4 overflow-y-auto custom-scrollbar flex-1 space-y-3">
                ${es("表示設定",a,!0)}
                ${es("データ管理",l)}
                ${es("アカウント",c)}
            </div>

            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/50 flex justify-end">
                <button id="close-settings-footer" class="px-4 py-1.5 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-600 text-gray-700 dark:text-gray-200 rounded-md font-bold text-xs">閉じる</button>
            </div>
        </div>
    `}var Lr={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ya=function(n){const t=[];let e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},wd=function(n){const t=[];let e=0,i=0;for(;e<n.length;){const s=n[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[e++];t[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[e++],o=n[e++],a=n[e++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const r=n[e++],o=n[e++];t[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return t.join("")},Ga={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,c=l?n[s+2]:0,d=r>>2,u=(r&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,o||(h=64)),i.push(e[d],e[u],e[h],e[f])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(Ya(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):wd(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=e[n.charAt(s++)],a=s<n.length?e[n.charAt(s)]:0;++s;const c=s<n.length?e[n.charAt(s)]:64;++s;const u=s<n.length?e[n.charAt(s)]:64;if(++s,r==null||a==null||c==null||u==null)throw new Sd;const h=r<<2|a>>4;if(i.push(h),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const g=c<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Sd extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ed=function(n){const t=Ya(n);return Ga.encodeByteArray(t,!0)},Ka=function(n){return Ed(n).replace(/\./g,"")},Xa=function(n){try{return Ga.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Id(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Md=()=>Id().__FIREBASE_DEFAULTS__,Ad=()=>{if(typeof process>"u"||typeof Lr>"u")return;const n=Lr.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},Td=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Xa(n[1]);return t&&JSON.parse(t)},Cd=()=>{try{return Md()||Ad()||Td()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Dd=n=>{var t;return(t=Cd())===null||t===void 0?void 0:t[`_${n}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function It(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Ld(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(It())}function Od(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Pd(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function Rd(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Bd(){try{return typeof indexedDB=="object"}catch{return!1}}function Nd(){return new Promise((n,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{var r;t(((r=s.error)===null||r===void 0?void 0:r.message)||"")}}catch(e){t(e)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fd="FirebaseError";class xe extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=Fd,Object.setPrototypeOf(this,xe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Cn.prototype.create)}}class Cn{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],o=r?$d(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new xe(s,a,i)}}function $d(n,t){return n.replace(Hd,(e,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const Hd=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ja(n){const t=[];for(const[e,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function zd(n,t){const e=new jd(n,t);return e.subscribe.bind(e)}class jd{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,i){let s;if(t===void 0&&e===void 0&&i===void 0)throw new Error("Missing Observer.");Vd(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:i},s.next===void 0&&(s.next=ns),s.error===void 0&&(s.error=ns),s.complete===void 0&&(s.complete=ns);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Vd(n,t){if(typeof n!="object"||n===null)return!1;for(const e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function ns(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dn(n){return n&&n._delegate?n._delegate:n}class fn{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var $;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})($||($={}));const Ud={debug:$.DEBUG,verbose:$.VERBOSE,info:$.INFO,warn:$.WARN,error:$.ERROR,silent:$.SILENT},Wd=$.INFO,qd={[$.DEBUG]:"log",[$.VERBOSE]:"log",[$.INFO]:"info",[$.WARN]:"warn",[$.ERROR]:"error"},Yd=(n,t,...e)=>{if(t<n.logLevel)return;const i=new Date().toISOString(),s=qd[t];if(s)console[s](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Za{constructor(t){this.name=t,this._logLevel=Wd,this._logHandler=Yd,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in $))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Ud[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,$.DEBUG,...t),this._logHandler(this,$.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,$.VERBOSE,...t),this._logHandler(this,$.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,$.INFO,...t),this._logHandler(this,$.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,$.WARN,...t),this._logHandler(this,$.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,$.ERROR,...t),this._logHandler(this,$.ERROR,...t)}}const Gd=(n,t)=>t.some(e=>n instanceof e);let Or,Pr;function Kd(){return Or||(Or=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Xd(){return Pr||(Pr=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Qa=new WeakMap,Ts=new WeakMap,tl=new WeakMap,is=new WeakMap,or=new WeakMap;function Jd(n){const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(Jt(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&Qa.set(e,n)}).catch(()=>{}),or.set(t,n),t}function Zd(n){if(Ts.has(n))return;const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});Ts.set(n,t)}let Cs={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return Ts.get(n);if(t==="objectStoreNames")return n.objectStoreNames||tl.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return Jt(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function Qd(n){Cs=n(Cs)}function tu(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=n.call(ss(this),t,...e);return tl.set(i,t.sort?t.sort():[t]),Jt(i)}:Xd().includes(n)?function(...t){return n.apply(ss(this),t),Jt(Qa.get(this))}:function(...t){return Jt(n.apply(ss(this),t))}}function eu(n){return typeof n=="function"?tu(n):(n instanceof IDBTransaction&&Zd(n),Gd(n,Kd())?new Proxy(n,Cs):n)}function Jt(n){if(n instanceof IDBRequest)return Jd(n);if(is.has(n))return is.get(n);const t=eu(n);return t!==n&&(is.set(n,t),or.set(t,n)),t}const ss=n=>or.get(n);function nu(n,t,{blocked:e,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,t),a=Jt(o);return i&&o.addEventListener("upgradeneeded",l=>{i(Jt(o.result),l.oldVersion,l.newVersion,Jt(o.transaction),l)}),e&&o.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const iu=["get","getKey","getAll","getAllKeys","count"],su=["put","add","delete","clear"],rs=new Map;function Rr(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(rs.get(t))return rs.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,s=su.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||iu.includes(e)))return;const r=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[e](...a),s&&l.done]))[0]};return rs.set(t,r),r}Qd(n=>({...n,get:(t,e,i)=>Rr(t,e)||n.get(t,e,i),has:(t,e)=>!!Rr(t,e)||n.has(t,e)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ru{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(ou(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function ou(n){const t=n.getComponent();return(t==null?void 0:t.type)==="VERSION"}const Ds="@firebase/app",Br="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ft=new Za("@firebase/app"),au="@firebase/app-compat",lu="@firebase/analytics-compat",cu="@firebase/analytics",du="@firebase/app-check-compat",uu="@firebase/app-check",hu="@firebase/auth",fu="@firebase/auth-compat",gu="@firebase/database",pu="@firebase/data-connect",mu="@firebase/database-compat",bu="@firebase/functions",yu="@firebase/functions-compat",xu="@firebase/installations",vu="@firebase/installations-compat",_u="@firebase/messaging",ku="@firebase/messaging-compat",wu="@firebase/performance",Su="@firebase/performance-compat",Eu="@firebase/remote-config",Iu="@firebase/remote-config-compat",Mu="@firebase/storage",Au="@firebase/storage-compat",Tu="@firebase/firestore",Cu="@firebase/vertexai-preview",Du="@firebase/firestore-compat",Lu="firebase",Ou="10.14.1",Pu={[Ds]:"fire-core",[au]:"fire-core-compat",[cu]:"fire-analytics",[lu]:"fire-analytics-compat",[uu]:"fire-app-check",[du]:"fire-app-check-compat",[hu]:"fire-auth",[fu]:"fire-auth-compat",[gu]:"fire-rtdb",[pu]:"fire-data-connect",[mu]:"fire-rtdb-compat",[bu]:"fire-fn",[yu]:"fire-fn-compat",[xu]:"fire-iid",[vu]:"fire-iid-compat",[_u]:"fire-fcm",[ku]:"fire-fcm-compat",[wu]:"fire-perf",[Su]:"fire-perf-compat",[Eu]:"fire-rc",[Iu]:"fire-rc-compat",[Mu]:"fire-gcs",[Au]:"fire-gcs-compat",[Tu]:"fire-fst",[Du]:"fire-fst-compat",[Cu]:"fire-vertex","fire-js":"fire-js",[Lu]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ru=new Map,Bu=new Map,Nr=new Map;function Fr(n,t){try{n.container.addComponent(t)}catch(e){Ft.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function gn(n){const t=n.name;if(Nr.has(t))return Ft.debug(`There were multiple attempts to register component ${t}.`),!1;Nr.set(t,n);for(const e of Ru.values())Fr(e,n);for(const e of Bu.values())Fr(e,n);return!0}function qe(n){return n.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nu={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},ar=new Cn("app","Firebase",Nu);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const lr=Ou;function tn(n,t,e){var i;let s=(i=Pu[n])!==null&&i!==void 0?i:n;e&&(s+=`-${e}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const a=[`Unable to register library "${s}" with version "${t}":`];r&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&a.push("and"),o&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Ft.warn(a.join(" "));return}gn(new fn(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fu="firebase-heartbeat-database",$u=1,pn="firebase-heartbeat-store";let os=null;function el(){return os||(os=nu(Fu,$u,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(pn)}catch(e){console.warn(e)}}}}).catch(n=>{throw ar.create("idb-open",{originalErrorMessage:n.message})})),os}async function Hu(n){try{const e=(await el()).transaction(pn),i=await e.objectStore(pn).get(nl(n));return await e.done,i}catch(t){if(t instanceof xe)Ft.warn(t.message);else{const e=ar.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});Ft.warn(e.message)}}}async function $r(n,t){try{const i=(await el()).transaction(pn,"readwrite");await i.objectStore(pn).put(t,nl(n)),await i.done}catch(e){if(e instanceof xe)Ft.warn(e.message);else{const i=ar.create("idb-set",{originalErrorMessage:e==null?void 0:e.message});Ft.warn(i.message)}}}function nl(n){return`${n.name}!${n.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zu=1024,ju=30*24*60*60*1e3;class Vu{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Wu(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,e;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=Hr();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((e=this._heartbeatsCache)===null||e===void 0?void 0:e.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===r||this._heartbeatsCache.heartbeats.some(o=>o.date===r)?void 0:(this._heartbeatsCache.heartbeats.push({date:r,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(o=>{const a=new Date(o.date).valueOf();return Date.now()-a<=ju}),this._storage.overwrite(this._heartbeatsCache))}catch(i){Ft.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const e=Hr(),{heartbeatsToSend:i,unsentEntries:s}=Uu(this._heartbeatsCache.heartbeats),r=Ka(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=e,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),r}catch(e){return Ft.warn(e),""}}}function Hr(){return new Date().toISOString().substring(0,10)}function Uu(n,t=zu){const e=[];let i=n.slice();for(const s of n){const r=e.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),zr(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),zr(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class Wu{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Bd()?Nd().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Hu(this.app);return e!=null&&e.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return $r(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var e;if(await this._canUseIndexedDBPromise){const s=await this.read();return $r(this.app,{lastSentHeartbeatDate:(e=t.lastSentHeartbeatDate)!==null&&e!==void 0?e:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function zr(n){return Ka(JSON.stringify({version:2,heartbeats:n})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function qu(n){gn(new fn("platform-logger",t=>new ru(t),"PRIVATE")),gn(new fn("heartbeat",t=>new Vu(t),"PRIVATE")),tn(Ds,Br,n),tn(Ds,Br,"esm2017"),tn("fire-js","")}qu("");function il(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(n);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(e[i[s]]=n[i[s]]);return e}function sl(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Yu=sl,rl=new Cn("auth","Firebase",sl());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ii=new Za("@firebase/auth");function Gu(n,...t){Ii.logLevel<=$.WARN&&Ii.warn(`Auth (${lr}): ${n}`,...t)}function ui(n,...t){Ii.logLevel<=$.ERROR&&Ii.error(`Auth (${lr}): ${n}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function jr(n,...t){throw cr(n,...t)}function ol(n,...t){return cr(n,...t)}function al(n,t,e){const i=Object.assign(Object.assign({},Yu()),{[t]:e});return new Cn("auth","Firebase",i).create(t,{appName:n.name})}function hi(n){return al(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function cr(n,...t){if(typeof n!="string"){const e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return rl.create(n,...t)}function B(n,t,...e){if(!n)throw cr(t,...e)}function en(n){const t="INTERNAL ASSERTION FAILED: "+n;throw ui(t),new Error(t)}function Mi(n,t){n||en(t)}function Ku(){return Vr()==="http:"||Vr()==="https:"}function Vr(){var n;return typeof self<"u"&&((n=self.location)===null||n===void 0?void 0:n.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Xu(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Ku()||Pd()||"connection"in navigator)?navigator.onLine:!0}function Ju(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ln{constructor(t,e){this.shortDelay=t,this.longDelay=e,Mi(e>t,"Short delay should be less than long delay!"),this.isMobile=Ld()||Rd()}get(){return Xu()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zu(n,t){Mi(n.emulator,"Emulator should always be set here");const{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ll{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;en("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;en("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;en("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Qu={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const th=new Ln(3e4,6e4);function cl(n,t){return n.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:n.tenantId}):t}async function Vi(n,t,e,i,s={}){return dl(n,s,async()=>{let r={},o={};i&&(t==="GET"?o=i:r={body:JSON.stringify(i)});const a=Ja(Object.assign({key:n.config.apiKey},o)).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const c=Object.assign({method:t,headers:l},r);return Od()||(c.referrerPolicy="no-referrer"),ll.fetch()(ul(n,n.config.apiHost,e,a),c)})}async function dl(n,t,e){n._canInitEmulator=!1;const i=Object.assign(Object.assign({},Qu),t);try{const s=new eh(n),r=await Promise.race([e(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw $n(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw $n(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw $n(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw $n(n,"user-disabled",o);const d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw al(n,d,c);jr(n,d)}}catch(s){if(s instanceof xe)throw s;jr(n,"network-request-failed",{message:String(s)})}}function ul(n,t,e,i){const s=`${t}${e}?${i}`;return n.config.emulator?Zu(n.config,s):`${n.config.apiScheme}://${s}`}class eh{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(ol(this.auth,"network-request-failed")),th.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $n(n,t,e){const i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);const s=ol(n,t,i);return s.customData._tokenResponse=e,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function nh(n,t){return Vi(n,"POST","/v1/accounts:delete",t)}async function hl(n,t){return Vi(n,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function nn(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function ih(n,t=!1){const e=Dn(n),i=await e.getIdToken(t),s=fl(i);B(s&&s.exp&&s.auth_time&&s.iat,e.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r==null?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:nn(as(s.auth_time)),issuedAtTime:nn(as(s.iat)),expirationTime:nn(as(s.exp)),signInProvider:o||null,signInSecondFactor:(r==null?void 0:r.sign_in_second_factor)||null}}function as(n){return Number(n)*1e3}function fl(n){const[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return ui("JWT malformed, contained fewer than 3 sections"),null;try{const s=Xa(e);return s?JSON.parse(s):(ui("Failed to decode base64 JWT payload"),null)}catch(s){return ui("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ur(n){const t=fl(n);return B(t,"internal-error"),B(typeof t.exp<"u","internal-error"),B(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ls(n,t,e=!1){if(e)return t;try{return await t}catch(i){throw i instanceof xe&&sh(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function sh({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class rh{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var e;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((e=this.user.stsTokenManager.expirationTime)!==null&&e!==void 0?e:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Os{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=nn(this.lastLoginAt),this.creationTime=nn(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Ai(n){var t;const e=n.auth,i=await n.getIdToken(),s=await Ls(n,hl(e,{idToken:i}));B(s==null?void 0:s.users.length,e,"internal-error");const r=s.users[0];n._notifyReloadListener(r);const o=!((t=r.providerUserInfo)===null||t===void 0)&&t.length?gl(r.providerUserInfo):[],a=ah(n.providerData,o),l=n.isAnonymous,c=!(n.email&&r.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,u={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Os(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(n,u)}async function oh(n){const t=Dn(n);await Ai(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function ah(n,t){return[...n.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function gl(n){return n.map(t=>{var{providerId:e}=t,i=il(t,["providerId"]);return{providerId:e,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function lh(n,t){const e=await dl(n,{},async()=>{const i=Ja({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=ul(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ll.fetch()(o,{method:"POST",headers:a,body:i})});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function ch(n,t){return Vi(n,"POST","/v2/accounts:revokeToken",cl(n,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ie{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){B(t.idToken,"internal-error"),B(typeof t.idToken<"u","internal-error"),B(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Ur(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){B(t.length!==0,"internal-error");const e=Ur(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(B(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:s,expiresIn:r}=await lh(t,e);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){const{refreshToken:i,accessToken:s,expirationTime:r}=e,o=new Ie;return i&&(B(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),s&&(B(typeof s=="string","internal-error",{appName:t}),o.accessToken=s),r&&(B(typeof r=="number","internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new Ie,this.toJSON())}_performRefresh(){return en("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function zt(n,t){B(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class Ut{constructor(t){var{uid:e,auth:i,stsTokenManager:s}=t,r=il(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new rh(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=e,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=r.displayName||null,this.email=r.email||null,this.emailVerified=r.emailVerified||!1,this.phoneNumber=r.phoneNumber||null,this.photoURL=r.photoURL||null,this.isAnonymous=r.isAnonymous||!1,this.tenantId=r.tenantId||null,this.providerData=r.providerData?[...r.providerData]:[],this.metadata=new Os(r.createdAt||void 0,r.lastLoginAt||void 0)}async getIdToken(t){const e=await Ls(this,this.stsTokenManager.getToken(this.auth,t));return B(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return ih(this,t)}reload(){return oh(this)}_assign(t){this!==t&&(B(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>Object.assign({},e)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new Ut(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return e.metadata._copy(this.metadata),e}_onReload(t){B(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await Ai(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(qe(this.auth.app))return Promise.reject(hi(this.auth));const t=await this.getIdToken();return await Ls(this,nh(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){var i,s,r,o,a,l,c,d;const u=(i=e.displayName)!==null&&i!==void 0?i:void 0,h=(s=e.email)!==null&&s!==void 0?s:void 0,f=(r=e.phoneNumber)!==null&&r!==void 0?r:void 0,g=(o=e.photoURL)!==null&&o!==void 0?o:void 0,p=(a=e.tenantId)!==null&&a!==void 0?a:void 0,m=(l=e._redirectEventId)!==null&&l!==void 0?l:void 0,b=(c=e.createdAt)!==null&&c!==void 0?c:void 0,y=(d=e.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:v,emailVerified:_,isAnonymous:x,providerData:k,stsTokenManager:S}=e;B(v&&S,t,"internal-error");const E=Ie.fromJSON(this.name,S);B(typeof v=="string",t,"internal-error"),zt(u,t.name),zt(h,t.name),B(typeof _=="boolean",t,"internal-error"),B(typeof x=="boolean",t,"internal-error"),zt(f,t.name),zt(g,t.name),zt(p,t.name),zt(m,t.name),zt(b,t.name),zt(y,t.name);const I=new Ut({uid:v,auth:t,email:h,emailVerified:_,displayName:u,isAnonymous:x,photoURL:g,phoneNumber:f,tenantId:p,stsTokenManager:E,createdAt:b,lastLoginAt:y});return k&&Array.isArray(k)&&(I.providerData=k.map(A=>Object.assign({},A))),m&&(I._redirectEventId=m),I}static async _fromIdTokenResponse(t,e,i=!1){const s=new Ie;s.updateFromServerResponse(e);const r=new Ut({uid:e.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await Ai(r),r}static async _fromGetAccountInfoResponse(t,e,i){const s=e.users[0];B(s.localId!==void 0,"internal-error");const r=s.providerUserInfo!==void 0?gl(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!(r!=null&&r.length),a=new Ie;a.updateFromIdToken(i);const l=new Ut({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:o}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new Os(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(r!=null&&r.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wr=new Map;function ue(n){Mi(n instanceof Function,"Expected a class definition");let t=Wr.get(n);return t?(Mi(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,Wr.set(n,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pl{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}pl.type="NONE";const qr=pl;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ls(n,t,e){return`firebase:${n}:${t}:${e}`}class Me{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=ls(this.userKey,s.apiKey,r),this.fullPersistenceKey=ls("persistence",s.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?Ut._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new Me(ue(qr),t,i);const s=(await Promise.all(e.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let r=s[0]||ue(qr);const o=ls(i,t.config.apiKey,t.name);let a=null;for(const c of e)try{const d=await c._get(o);if(d){const u=Ut._fromJSON(t,d);c!==r&&(a=u),r=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new Me(r,t,i):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(e.map(async c=>{if(c!==r)try{await c._remove(o)}catch{}})),new Me(r,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yr(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(fh(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(dh(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ph(t))return"Blackberry";if(mh(t))return"Webos";if(uh(t))return"Safari";if((t.includes("chrome/")||hh(t))&&!t.includes("edge/"))return"Chrome";if(gh(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function dh(n=It()){return/firefox\//i.test(n)}function uh(n=It()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function hh(n=It()){return/crios\//i.test(n)}function fh(n=It()){return/iemobile/i.test(n)}function gh(n=It()){return/android/i.test(n)}function ph(n=It()){return/blackberry/i.test(n)}function mh(n=It()){return/webos/i.test(n)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ml(n,t=[]){let e;switch(n){case"Browser":e=Yr(It());break;case"Worker":e=`${Yr(It())}-${n}`;break;default:e=n}const i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${lr}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class bh{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=r=>new Promise((o,a)=>{try{const l=t(r);o(l)}catch(l){a(l)}});i.onAbort=e,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const i of this.queue)await i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(const s of e)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yh(n,t={}){return Vi(n,"GET","/v2/passwordPolicy",cl(n,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xh=6;class vh{constructor(t){var e,i,s,r;const o=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(e=o.minPasswordLength)!==null&&e!==void 0?e:xh,o.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=o.maxPasswordLength),o.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=o.containsLowercaseCharacter),o.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=o.containsUppercaseCharacter),o.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=o.containsNumericCharacter),o.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=o.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(r=t.forceUpgradeOnSignin)!==null&&r!==void 0?r:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var e,i,s,r,o,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(e=l.meetsMinPasswordLength)!==null&&e!==void 0?e:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(r=l.containsUppercaseLetter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(o=l.containsNumericCharacter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),s&&(e.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class _h{constructor(t,e,i,s){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Gr(this),this.idTokenSubscription=new Gr(this),this.beforeStateQueue=new bh(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=rl,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=ue(e)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await Me.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await hl(this,{idToken:t}),i=await Ut._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var e;if(qe(this.app)){const o=this.app.settings.authIdToken;return o?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(o).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,r=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const o=(e=this.redirectUser)===null||e===void 0?void 0:e._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(t);(!o||o===a)&&(l!=null&&l.user)&&(s=l.user,r=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(r)try{await this.beforeStateQueue.runMiddleware(s)}catch(o){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(o))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return B(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await Ai(t)}catch(e){if((e==null?void 0:e.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Ju()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(qe(this.app))return Promise.reject(hi(this));const e=t?Dn(t):null;return e&&B(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&B(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return qe(this.app)?Promise.reject(hi(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return qe(this.app)?Promise.reject(hi(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(ue(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await yh(this),e=new vh(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Cn("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),await ch(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&ue(t)||this._popupRedirectResolver;B(e,this,"argument-error"),this.redirectPersistenceManager=await Me.create(this,[ue(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var e,i;return this._isInitialized&&await this.queue(async()=>{}),((e=this._currentUser)===null||e===void 0?void 0:e._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,e;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(e=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&e!==void 0?e:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,s){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(B(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof e=="function"){const l=t.addObserver(e,i,s);return()=>{o=!0,l()}}else{const l=t.addObserver(e);return()=>{o=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return B(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=ml(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const e={"X-Client-Version":this.clientVersion};this.app.options.appId&&(e["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(e["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(e["X-Firebase-AppCheck"]=s),e}async _getAppCheckToken(){var t;const e=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return e!=null&&e.error&&Gu(`Error while retrieving App Check token: ${e.error}`),e==null?void 0:e.token}}function kh(n){return Dn(n)}class Gr{constructor(t){this.auth=t,this.observer=null,this.addObserver=zd(e=>this.observer=e)}get next(){return B(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function wh(n,t){const e=(t==null?void 0:t.persistence)||[],i=(Array.isArray(e)?e:[e]).map(ue);t!=null&&t.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t==null?void 0:t.popupRedirectResolver)}function Sh(n){return Dn(n).signOut()}new Ln(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ln(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ln(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ln(5e3,15e3);var Kr="@firebase/auth",Xr="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eh{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(i=>{t((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){B(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ih(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Mh(n){gn(new fn("auth",(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;B(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ml(n)},c=new _h(i,s,r,l);return wh(c,e),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),gn(new fn("auth-internal",t=>{const e=kh(t.getProvider("auth").getImmediate());return(i=>new Eh(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),tn(Kr,Xr,Ih(n)),tn(Kr,Xr,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ah=5*60;Dd("authIdTokenMaxAge");Mh("Browser");const Jr=n=>n instanceof ir?n.toDate():n,bl=n=>n instanceof Date?ir.fromDate(n):n;function yl(n,t){return{id:n,...t,createdAt:Jr(t.createdAt)||null,dueDate:Jr(t.dueDate)||null,recurrence:t.recurrence??null}}function Th(n,t,e){const i=o=>{typeof e=="function"&&e(o)};if(!n||!t)return i([]),()=>{};const s=j.tasks(n,t),r=ye(dt(Y,s));return Pe(r,o=>{const a=o.docs.map(l=>yl(l.id,l.data()));i(a)},o=>{console.error("[Tasks] Subscription error:",o),i([])})}async function Ch(n,t){if(!n||!t)throw new Error("Missing parameters for backup.");const e=dt(Y,j.tasks(n,t)),i=dt(Y,j.projects(n,t)),s=dt(Y,j.labels(n)),[r,o,a]=await Promise.all([li(e),li(i),li(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof ir?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:n,workspaceId:t,tasks:l(r),projects:l(o),labels:l(a)}}async function xl(n,t,e){const i=j.tasks(n,t),s={...e};return s.dueDate&&(s.dueDate=bl(s.dueDate)),await zi(dt(Y,i),{...s,ownerId:n,status:"todo",createdAt:Oe()})}async function Dh(n,t,e,i){const s=j.tasks(n,t);await Mn(pt(Y,s,e),{status:i})}async function Lh(n,t,e,i){const s=j.tasks(n,t),r={...i};r.dueDate!==void 0&&(r.dueDate=bl(r.dueDate)),await Mn(pt(Y,s,e),r)}async function Oh(n,t,e){const i=j.tasks(n,t);await An(pt(Y,i,e))}async function Ph(n,t,e){const i=j.tasks(n,t),s=await Gc(pt(Y,i,e));return s.exists()?yl(s.id,s.data()):null}function Ht(n){if(!n)return null;if(n.toDate&&typeof n.toDate=="function")return n.toDate();if(n instanceof Date)return n;const t=new Date(n);return isNaN(t.getTime())?null:t}function Re(n=new Date){const t=Ht(n)||new Date,e=new Date(t);return e.setHours(0,0,0,0),e}function Rh(n=new Date){const t=Ht(n)||new Date,e=new Date(t);return e.setHours(23,59,59,999),e}function vl(n=new Date){const t=Ht(n)||new Date,e=t.getDay(),i=t.getDate()-e+(e===0?-6:1),s=new Date(t.setDate(i));return Re(s)}function Bh(n=new Date){const t=Ht(n)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function Nh(n){const t=Ht(n);if(!t)return"";const e=new Date,i=Re(e),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const r=t.getFullYear(),o=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return r!==e.getFullYear()?`${r}/${o}/${a}`:`${o}/${a}`}function Fh(n){const t=Ht(n);if(!t)return"text-gray-500";const e=Re(new Date),i=Math.round((t.getTime()-e.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function $h(n,t){var i;if(!n||!(t!=null&&t.type))return null;const e=new Date(Ht(n));switch(t.type){case"daily":return e.setDate(e.getDate()+1),e;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=e.getDay();for(let r=1;r<=7;r++)if(t.days.includes((s+r)%7))return e.setDate(e.getDate()+r),e;return null;case"monthly":return e.setMonth(e.getMonth()+1),e;default:return null}}function _l(n){var e;const t=Re(new Date);if(!(n!=null&&n.type)||n.type==="daily"||n.type==="monthly")return t;if(n.type==="weekly"&&((e=n.days)==null?void 0:e.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(n.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}return t}function On(){var t;const n=(t=R.currentUser)==null?void 0:t.uid;if(!n)throw new Error("Authentication required.");return n}function Pn(){const n=$t();if(!n)throw new Error("Workspace required.");return n}async function Hh(n){var r;if(n.status!=="completed"||!n.recurrence)return;const{recurrence:t,dueDate:e}=n;if(!e||typeof t!="object"||!t.type)return;const i=$h(e,t);if(!i)return;const s={title:n.title,description:n.description||"",status:"todo",dueDate:i,projectId:n.projectId||null,labelIds:n.labelIds||[],recurrence:n.recurrence};try{const o=(r=R.currentUser)==null?void 0:r.uid,a=$t();o&&a&&await xl(o,a,s)}catch(o){console.error("[Recurring] Generation failed:",o)}}async function zh(n){const t=On(),e=Pn(),i={...n};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),xl(t,e,i)}async function jh(n,t){const e=On(),i=Pn();if(await Dh(e,i,n,t),t==="completed"){const s=await Ph(e,i,n);s&&Hh(s).catch(r=>console.error(r))}}async function kl(n,t){const e=On(),i=Pn();return Lh(e,i,n,t)}async function wl(n){const t=On(),e=Pn();return Oh(t,e,n)}async function Vh(){const n=On(),t=Pn();return Ch(n,t)}let sn=[];function Uh(){return sn}function Wh(){sn=[]}function qh(n,t){var o;const e=typeof n=="function"?n:t,i=(o=R.currentUser)==null?void 0:o.uid;if(!i||typeof e!="function")return sn=[],typeof e=="function"&&e([]),()=>{};const s=j.filters(i),r=ye(dt(Y,s));return Pe(r,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));sn=l,e(l)},a=>{console.error("Error subscribing to filters:",a),sn=[],e([])})}async function Yh(n){var r;const t=(r=R.currentUser)==null?void 0:r.uid;if(!t)throw new Error("Authentication required");const e=j.filters(t),{id:i,...s}=n;await zi(dt(Y,e),{...s,ownerId:t,createdAt:Oe()})}async function Gh(n,t){var o;const e=(o=R.currentUser)==null?void 0:o.uid;if(!e)throw new Error("Authentication required");const i=j.filters(e),{id:s,...r}=t;await Mn(pt(Y,i,n),{...r,updatedAt:Oe()})}async function Kh(n){var i;const t=(i=R.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const e=j.filters(t);await An(pt(Y,e,n))}function Xh(n,t){if(!n)return t([]),()=>{};const e=j.labels(n),{db:i}=$a(),s=ye(dt(i,e));return Pe(s,r=>{const o=r.docs.map(a=>({id:a.id,...a.data()}));t(o)},r=>{console.error("[Labels] Subscription error:",r),t([])})}function Jh(n,t){var s;const e=typeof n=="function"?n:t,i=(s=R.currentUser)==null?void 0:s.uid;return i&&typeof e=="function"?Xh(i,e):(typeof e=="function"&&e([]),()=>{})}let Wt=[];const Zh=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function Qh(n,t){var r;const e=(r=R.currentUser)==null?void 0:r.uid;if(!e)return Wt=[...Zh],typeof t=="function"&&t(Wt),()=>{};const i=j.timeblocks(e),s=ye(dt(Y,i),nr("order","asc"));return Pe(s,o=>{Wt=o.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(Wt)},o=>{console.error("[TimeBlocks] Subscription error:",o)})}function St(){return[...Wt]}function tf(n){return Wt.find(t=>t.id===n)}function ef(){Wt=[]}async function nf(n){var e;const t=(e=R.currentUser)==null?void 0:e.uid;if(!t){T("ログインが必要です");return}try{const i=j.timeblocks(t),s=n.id||crypto.randomUUID(),r=n.order!==void 0?n.order:Math.max(...Wt.map(a=>a.order),-1)+1,o={name:n.name,start:n.start,end:n.end,color:n.color,order:r,updatedAt:Oe()};return await Kc(pt(Y,i,s),o,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i),T("保存に失敗した。")}}async function sf(n){var e;const t=(e=R.currentUser)==null?void 0:e.uid;if(t)try{const i=j.timeblocks(t);return await An(pt(Y,i,n)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function rf(n,t){const e=R.currentUser;return!e||!n?(typeof t=="function"&&t([]),()=>{}):Th(e.uid,n,t)}function of(){const n=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",n);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),Ps()}function Ps(){const n=document.getElementById("main-content");if(!n)return;const t=localStorage.getItem("background")||"none";n.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(n.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}function af(n,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),n.addEventListener("click",i=>{i.target===n&&t()}),Hn("app-theme","theme",i=>{document.documentElement.classList.toggle("dark",i==="dark"),Ps()}),Hn("font-size","fontSize",i=>{const s=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...s),document.body.classList.add(`font-app-${i}`)}),Hn("bg-pattern","background",()=>Ps()),Hn("sidebar-density","sidebar_compact",i=>{const s=i==="compact";window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{compact:s}}))}),lf(),cf(),df(t)}function Hn(n,t,e){const i=document.querySelectorAll(`input[name="${n}"]`),s=localStorage.getItem(t);if(i.forEach(r=>{r.addEventListener("change",o=>{const a=o.target.value;localStorage.setItem(t,a),e(a)})}),s)e(s);else{const r=Array.from(i).find(o=>o.checked);r&&e(r.value)}}function lf(){const n=document.getElementById("export-data-btn-new");n&&(n.onclick=async()=>{const t=n.querySelector("div.font-medium"),e=t.textContent;n.disabled=!0,n.classList.add("opacity-70","cursor-wait"),t.textContent="バックアップ作成中...";try{const i=await Vh(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),r=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),o=URL.createObjectURL(r),a=document.createElement("a");a.href=o,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(o),T({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),T({message:"エクスポートに失敗した",type:"error"})}finally{n.disabled=!1,n.classList.remove("opacity-70","cursor-wait"),t.textContent=e}})}function cf(){const n=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!n||!t||(n.onclick=async()=>{const e=t.value.trim();if(e.length<6)return T({message:"6文字以上入力してくれ",type:"error"});try{await nd(e),t.value=""}catch{}})}function df(n){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Sh(R),n()}catch{T({message:"エラーが発生した",type:"error"})}})}let Zr=!1;function Qr(){var n;(n=document.getElementById(H.MODAL_IDS.SETTINGS))==null||n.remove()}function uf(){if(Zr)return;const n=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),Ui())};document.addEventListener("click",n),Zr=!0}function Ui(){Qr();const n=_d(),t=R.currentUser,e=(t==null?void 0:t.email)||"匿名ユーザー",i=(e[0]||"?").toUpperCase(),s=document.createElement("div");s.id=H.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=kd(i,e,n),document.body.appendChild(s),af(s,Qr)}function hf(n=null){const t=!!n,e={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${e.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(n==null?void 0:n.name)||""}" 
                        placeholder="${e.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${e.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${e.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function Sl(n=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.innerHTML=hf(n),document.body.appendChild(e),ff(e,n)}function ff(n,t){const e=n.querySelector("#save-workspace-btn"),i=n.querySelector("#modal-workspace-name"),s=n.querySelector("#cancel-modal-btn"),r=n.querySelector("#workspace-modal-overlay"),o=()=>{document.removeEventListener("keydown",a),n.remove()},a=c=>{c.key==="Escape"&&o()};document.addEventListener("keydown",a),r.onclick=c=>{c.target===r&&o()},s&&(s.onclick=o);const l=async()=>{if(e.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return T({message:"ワークスペース名を入力してくれ",type:"error"});if(As().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return T({message:"その名前は既に使われているぞ",type:"error"});e.disabled=!0,e.textContent=t?"更新中...":"作成中...";try{if(t)await ud(t.id,c);else{const u=await za(c);rr(u.id)}o()}catch(u){e.disabled=!1,e.textContent=t?"保存":"作成",T({message:`失敗した: ${u.message}`,type:"error"})}};e==null||e.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Ti="none",cs={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function El(n=null){const t=!!n,e=Va(),i=St(),s=[30,45,60,75,90],r=gf((n==null?void 0:n.query)||""),o=document.createElement("div");o.id="filter-creation-modal",o.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-fade-in",o.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog" aria-modal="true">
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-base font-bold text-gray-800 dark:text-white">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="text-gray-400 hover:text-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-4 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider">フィルター名</label>
                    <input type="text" id="filter-name" value="${(n==null?void 0:n.name)||""}" 
                           class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${Rs("プロジェクト",e,r.project,"filter-project-checkbox")}
                    ${pf(i,r.timeblock)}
                    ${Rs("所要時間",s,r.duration,"filter-duration-checkbox",a=>`${a} min`)}
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900 flex justify-end gap-3 border-t border-gray-100 dark:border-gray-700">
                <button id="cancel-filter-btn" class="text-sm font-medium text-gray-500 hover:text-gray-800 transition">キャンセル</button>
                <button id="save-filter-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all active:scale-95">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(o),mf(o,n)}function gf(n){const t={project:[],timeblock:[],duration:[]},e=/(\w+):([^ ]+)/g;let i;for(;(i=e.exec(n))!==null;){const[s,r,o]=i;t[r]&&(t[r]=o.split(",").map(a=>r==="timeblock"&&(a==="null"||a==="none")?Ti:a))}return t}function Rs(n,t,e,i,s=r=>r.name||r){return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${n}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map(r=>{const o=String(r.id||r);return`
                        <label class="flex items-center px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition">
                            <input type="checkbox" value="${o}" ${e.includes(o)?"checked":""} class="${i} h-4 w-4 text-blue-600 rounded">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate">${s(r)}</span>
                        </label>
                    `}).join("")}
            </div>
        </div>
    `}function pf(n,t){const e=[{id:Ti,name:"未定"},...n];return Rs("時間帯",e,t,"filter-timeblock-checkbox",i=>i.id===Ti?i.name:`${i.start}-${i.end}`)}function mf(n,t){const e=()=>{document.removeEventListener("keydown",i),n.remove()},i=s=>s.key==="Escape"&&e();document.addEventListener("keydown",i),n.querySelector("#close-filter-modal").onclick=e,n.querySelector("#cancel-filter-btn").onclick=e,n.onclick=s=>s.target===n&&e(),n.querySelector("#save-filter-btn").onclick=async()=>{const s=n.querySelector("#filter-name").value.trim();if(!s)return T({message:cs.NAME_REQUIRED,type:"error"});const r=c=>Array.from(n.querySelectorAll(`.${c}:checked`)).map(d=>d.value),o=r("filter-timeblock-checkbox").map(c=>c===Ti?"null":c),a={project:r("filter-project-checkbox"),timeblock:o,duration:r("filter-duration-checkbox")},l=Object.entries(a).filter(([c,d])=>d.length>0).map(([c,d])=>`${c}:${d.join(",")}`).join(" ");if(!l)return T({message:cs.CONDITION_REQUIRED,type:"error"});try{const c={name:s,query:l,type:"custom"};t?await Gh(t.id,c):await Yh(c),document.dispatchEvent(new CustomEvent("filters-updated")),e()}catch(c){T({message:cs.SAVE_ERROR+c.message,type:"error"})}}}function bf(n=null){const t=!!n,e={title:(n==null?void 0:n.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${e.title}" placeholder="${e.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${e.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${e.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Il(n=null){var i;const t="project-modal";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.innerHTML=bf(n),document.body.appendChild(e),yf(e,n)}function yf(n,t){const e=()=>n.remove(),i=n.querySelector("#modal-project-name"),s=n.querySelector("#save-project-btn"),r=n.querySelector("#delete-project-btn"),o=n.querySelector("#cancel-modal-btn");o&&(o.onclick=e),n.onclick=l=>{l.target===n&&e()};const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return T({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await vd(t.id,{name:l});else{const c=$t();if(!c)throw new Error("ワークスペースが選択されていないぞ");await xd(l,c)}e()}catch(c){T({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),r&&t&&(r.onclick=()=>{T({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await Ua(t.id),e()}catch{T({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function mn(n,t,e,i={},s=0,r=!1){const o=document.createElement("li"),{CLASSES:a,COLORS:l}=H;o.dataset.type=t,o.dataset.id=e,o.className=`group flex items-center justify-between px-3 ${r?a.COMPACT_PY:a.NORMAL_PY} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const d={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3 text-sm">⏱️</span>',filter:i.iconHtml||'<span class="mr-3 text-sm">🔍</span>'}[t]||'<span class="mr-3 text-sm">🔹</span>',u=s>0?`<span class="text-xs text-gray-400 font-light mr-2">${s}</span>`:"";return o.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${d}
            <span class="truncate">${n}</span>
        </div>
        <div class="flex items-center">${u}</div>
    `,o}function dr(n,t,e){var r;const i=xf(t,e);if(!i)return;(r=document.getElementById("sidebar-context-menu"))==null||r.remove();const s=vf(i);document.body.appendChild(s),_f(s,n),kf(s,i)}function ds(n,t=null){document.dispatchEvent(new CustomEvent("route-change",{detail:{page:n,id:t}}))}function xf(n,t){return{project:{editLabel:"編集",onEdit:()=>Il(t),onDelete:async()=>{await Ua(t.id),ds("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>El(t),onDelete:async()=>{await Kh(t.id),ds("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>Sl(t),onDelete:async()=>{if(As().length<=1)throw new Error("最後のワークスペースは削除できない。");await hd(t.id);const s=As().filter(r=>r.id!==t.id);s.length>0&&(rr(s[0].id),ds("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[n]}function vf(n){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${n.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function _f(n,t){const{clientX:i,clientY:s}=t,r=window.innerWidth,o=window.innerHeight;n.style.visibility="hidden";const{width:a,height:l}=n.getBoundingClientRect();let c=i,d=s;i+a>r&&(c=i-a),s+l>o&&(d=s-l),n.style.left=`${Math.max(8,c)}px`,n.style.top=`${Math.max(8,d)}px`,n.style.visibility="visible"}function kf(n,t){const e=()=>{n.remove(),document.removeEventListener("click",e),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&e();setTimeout(()=>{document.addEventListener("click",e),document.addEventListener("keydown",i)},0),n.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),e(),t.onEdit()},n.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),e(),T({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(r){T({message:"削除に失敗した: "+r.message,type:"error"})}}})}}const zn={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let wt=null,rn=null,to=!1;function on(n){wt&&(n?(wt.classList.remove(...zn.MENU_INVISIBLE),wt.classList.add(...zn.MENU_VISIBLE),document.addEventListener("click",eo,{capture:!0})):(wt.classList.remove(...zn.MENU_VISIBLE),wt.classList.add(...zn.MENU_INVISIBLE),document.removeEventListener("click",eo,{capture:!0})))}const eo=n=>{wt&&!wt.contains(n.target)&&rn&&!rn.contains(n.target)&&on(!1)};function Ml(){if(to)return;rn=document.getElementById("workspace-trigger"),wt=document.getElementById("workspace-menu");const n=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!rn||!wt||(rn.onclick=e=>{e.stopPropagation();const i=wt.classList.contains("opacity-100");on(!i)},n&&(n.onclick=()=>{on(!1),Sl(null)}),t&&(t.onclick=()=>{on(!1),Ui()}),document.addEventListener("workspace-changed",e=>{const{workspaceId:i,workspaces:s}=e.detail;Al(s,i)}),to=!0)}function Al(n,t=$t()){const e=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(e&&wf(n,e,t),i){const s=n.find(r=>r.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function wf(n,t,e){t.innerHTML="",n.forEach(i=>{const s=i.id===e,r=document.createElement("button");r.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const o=document.createElement("span");if(o.className="truncate pointer-events-none",o.textContent=i.name,r.appendChild(o),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,r.appendChild(a.firstElementChild)}r.onclick=()=>{s||rr(i.id),on(!1)},r.oncontextmenu=a=>{a.preventDefault(),dr(a,"workspace",i)},t.appendChild(r)})}const{Z_INDEX:Ae}=rd,Sf=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${Ae.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${Ae.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${H.DEFAULT_WIDTH}px;">
        ${Ef()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${Ae.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,Ef=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,If=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${Ae.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${Ae.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function Mf(){const n=document.getElementById("app");n&&(n.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${Sf()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${If()}
                <div id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar scroll-smooth">
                    <div class="w-full max-w-4xl mx-auto">
                        <div id="task-view" class="w-full animate-fade-in transition-opacity duration-150"></div>
                        <div id="search-view" class="hidden w-full animate-fade-in"></div>
                        <div id="dashboard-view" class="hidden w-full animate-fade-in"></div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${Ae.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{qa(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),Ml(),Tf(),Af()}))}function Af(){const n=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),e=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=r=>{const o=n.classList.contains("-translate-x-full"),a=r??!o;n.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};e==null||e.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function Tf(){document.addEventListener("keydown",n=>{const t=["INPUT","TEXTAREA"].includes(n.target.tagName)||n.target.closest("[contenteditable]"),e=document.querySelector('[role="dialog"]');if(n.key==="/"&&!t&&!e){const i=document.getElementById("page-search-input");i&&(n.preventDefault(),i.focus())}})}function Cf(n){return n?(n.toDate?n.toDate():new Date(n)).toISOString().split("T")[0]:""}function Df(n=[]){return["日","月","火","水","木","金","土"].map((e,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer">
            <input type="checkbox" data-day-index="${i}" ${n.includes(i)?"checked":""} 
                   class="form-checkbox h-4 w-4 text-blue-600 dark:text-blue-400 bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded">
            <span class="text-xs text-gray-700 dark:text-gray-300">${e}</span>
        </label>
    `).join("")}function no(n,t,e){return n.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${e(i)}
        </option>
    `).join("")}function Lf(n){let t=n.dueDate;const e=n.recurrence||{type:"none",days:[]};e.type!=="none"&&!t&&(t=_l(e));const i=t?Cf(t.toDate?t.toDate():new Date(t)):"",s=no(St(),n.timeBlockId,a=>`${a.start} - ${a.end}`),r=no([30,45,60,75,90],n.duration,a=>`${a} min`),o=i||e.type!=="none"||n.timeBlockId||n.duration;return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-task-title" value="${n.title}" placeholder="タスクのタイトル"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition ml-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ -->
                <div class="px-6 py-4 space-y-5 overflow-y-auto flex-1 min-h-0">
                    
                    <!-- スケジュール設定（アコーディオン） -->
                    <details class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-gray-50 dark:bg-gray-900/30" ${o?"":"open"}>
                        <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none">
                            <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                スケジュール設定
                            </span>
                            <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                            </span>
                        </summary>
                        
                        <div class="p-4 border-t border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-900/10 grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                <input type="date" id="modal-task-date" value="${i}"
                                    class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm">
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="none" ${e.type==="none"?"selected":""}>なし</option>
                                    <option value="daily" ${e.type==="daily"?"selected":""}>毎日</option>
                                    <option value="weekly" ${e.type==="weekly"?"selected":""}>毎週</option>
                                    <option value="monthly" ${e.type==="monthly"?"selected":""}>毎月</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="">未定</option>
                                    ${s}
                                </select>
                            </div>
                            <div>
                                <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                    <option value="">指定なし</option>
                                    ${r}
                                </select>
                            </div>
                            <div id="recurrence-days-container" class="${e.type!=="weekly"?"hidden":""} col-span-2 pt-2 border-t border-gray-100 dark:border-gray-700">
                                <label class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</label>
                                <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                    ${Df(e.days)}
                                </div>
                            </div>
                        </div>
                    </details>

                    <!-- メモ -->
                    <div class="flex flex-col flex-1">
                        <label class="text-xs font-semibold text-gray-500 mb-1.5 flex justify-between items-center uppercase">
                            <span>メモ (Markdown)</span>
                            <button id="toggle-memo-view" class="text-blue-500 hover:underline font-normal">プレビュー</button>
                        </label>
                        <textarea id="modal-task-desc" rows="5" placeholder="詳細を入力..."
                            class="w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg outline-none text-sm transition-all resize-none leading-relaxed">${n.description||""}</textarea>
                        <div id="modal-task-desc-preview" class="hidden w-full px-4 py-3 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output"></div>
                    </div>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                    </div>
                </div>
            </div>
        </div>
    `}function Of(n){return n.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function io(n){if(!n)return"";const t=n.split(`
`);let e=[],i=!1;return t.forEach(s=>{const r=s.trimStart(),o=r.startsWith("* ")||r.startsWith("- ");if(o&&!i?(e.push('<ul class="list-disc ml-5 space-y-1">'),i=!0):!o&&i&&(e.push("</ul>"),i=!1),o){const a=so(r.substring(2));e.push(`<li>${a}</li>`)}else s.trim()?e.push(`<p class="mb-2">${so(s)}</p>`):i&&(e.push("</ul>"),i=!1)}),i&&e.push("</ul>"),e.join(`
`)}function so(n){return Of(n).replace(/\[(.*?)\]\((.*?)\)/g,(e,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}const us={EDIT:"編集",PREVIEW:"プレビュー"};function Pf(n,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>n(...i),t)}}function Rf(){const n=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),e=document.getElementById("toggle-memo-view");if(!n||!t||!e)return;let i=!0;const s=Pf(()=>{t.innerHTML=io(n.value)},300);e.addEventListener("click",()=>{i=!i,i?(n.classList.remove("hidden"),t.classList.add("hidden"),e.textContent=us.PREVIEW):(t.innerHTML=io(n.value),n.classList.add("hidden"),t.classList.remove("hidden"),e.textContent=us.EDIT)}),n.addEventListener("input",()=>{i||s()}),n.classList.remove("hidden"),t.classList.add("hidden"),e.textContent=us.PREVIEW}function Bf(){const n=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),e=document.getElementById("modal-task-date");if(!n||!t||!e)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(o,a=[])=>{if(o==="weekly"&&a.length===0)return;const l=_l({type:o,days:a});e.value=l.toISOString().substring(0,10)},r=()=>Array.from(i).filter(o=>o.checked).map(o=>parseInt(o.dataset.dayIndex??"0",10));n.addEventListener("change",o=>{const a=o.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?r():[];s(a,c)}}),i.forEach(o=>{o.addEventListener("change",()=>{const a=r();s("weekly",a)})})}let jt={};function Nf(n){jt={title:n.querySelector("#modal-task-title"),desc:n.querySelector("#modal-task-desc"),date:n.querySelector("#modal-task-date"),recurrence:n.querySelector("#modal-task-recurrence"),timeblock:n.querySelector("#modal-task-timeblock"),duration:n.querySelector("#modal-task-duration"),saveBtn:n.querySelector("#save-task-modal-btn"),deleteBtn:n.querySelector("#delete-task-modal-btn"),closeBtn:n.querySelector("#close-modal-btn"),cancelBtn:n.querySelector("#cancel-modal-btn"),overlay:n.querySelector("div.fixed")}}function Ff(n,t,e){Nf(n);const{closeBtn:i,cancelBtn:s,overlay:r,saveBtn:o,deleteBtn:a}=jt;[i,s].forEach(l=>l==null?void 0:l.addEventListener("click",e)),r==null||r.addEventListener("click",l=>{l.target===l.currentTarget&&e()}),o==null||o.addEventListener("click",async()=>{await $f(t,e)}),a==null||a.addEventListener("click",()=>{T({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await wl(t.id),e()}catch{T({message:"削除に失敗した",type:"error"})}}})}),Bf(),Rf()}async function $f(n,t){var d,u,h,f,g,p,m,b;const e=(u=(d=jt.title)==null?void 0:d.value)==null?void 0:u.trim();if(!e){T({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=jt.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){T({message:"無効な日付だ",type:"error"});return}const r=(f=jt.recurrence)==null?void 0:f.value;let o=null;if(r!=="none"&&(o={type:r},r==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(v=>parseInt(v.dataset.dayIndex??"",10)).filter(v=>!isNaN(v)).sort((v,_)=>v-_);if(y.length===0){T({message:"曜日を選択してくれ",type:"error"});return}o.days=y}const a=parseInt((g=jt.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:e,description:((m=(p=jt.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:o,timeBlockId:((b=jt.timeblock)==null?void 0:b.value)||null,duration:l};try{await kl(n.id,c),t()}catch(y){console.error("Failed to update task:",y),T({message:"保存に失敗した",type:"error"})}}const Tl=n=>{n.key==="Escape"&&Cl()};function Hf(n){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=Lf(n),Ff(t,n,Cl),document.addEventListener("keydown",Tl)}function Cl(){const n=document.getElementById("modal-container");n&&(n.innerHTML="",document.removeEventListener("keydown",Tl))}const Wi=n=>`${H.STORAGE_KEYS.SECTION_PREFIX}${n}`;function $e(n,t,e=!1,i=""){const s=Tn(Wi(t),!0),r=s?"rotate-0":"-rotate-90",o=e?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${n}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${r}" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${n}</h3>
            </div>
            ${o}
        </div>
    `}function jn(n){const t=Tn(Wi(n),!0);return`<ul id="${n}" class="space-y-0.5 mb-4 pl-1 ${t?"":"hidden"}"></ul>`}function Vn(n,t,e,i=""){return`
        <li>
            <a href="#" id="${n}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${e}</span>
                ${i}
            </a>
        </li>
    `}function zf(){return`
        <div class="mt-2 select-none">
            ${$e("基本項目","basic-list")}
            <ul id="basic-list" class="space-y-0.5 mb-4 pl-1 ${Tn(Wi("basic-list"))?"":"hidden"}">
                ${Vn("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${Vn("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${Vn("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${Vn("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            </ul>

            ${$e("プロジェクト","project-list",!0,"add-project-btn")}
            ${jn("project-list")}

            ${$e("時間帯","timeblock-list",!0,"edit-timeblocks-btn")}
            ${jn("timeblock-list")}

            ${$e("所要時間","duration-list")}
            ${jn("duration-list")}

            ${$e("フィルター","filter-list",!0,"add-filter-btn")}
            ${jn("filter-list")}
        </div>
    `}function jf(){document.querySelectorAll(".sidebar-section-header").forEach(n=>{const t=n.dataset.target,e=document.getElementById(t),i=n.querySelector("svg");!e||!i||(n.onclick=s=>{if(s.target.closest("button"))return;const o=!e.classList.toggle(H.CLASSES.HIDDEN);i.classList.toggle("rotate-0",o),i.classList.toggle("-rotate-90",!o),n.setAttribute("aria-expanded",o),localStorage.setItem(Wi(t),o)})})}function bn(n,t,e=null){if(!n)return;let i=0;const s=H.CLASSES.DRAG_OVER;n.addEventListener("dragenter",r=>{r.preventDefault(),i++,n.classList.add(...s)}),n.addEventListener("dragover",r=>{r.preventDefault(),n.classList.contains("ring-2")||n.classList.add(...s)}),n.addEventListener("dragleave",r=>{r.preventDefault(),i--,i<=0&&(n.classList.remove(...s),i=0)}),n.addEventListener("drop",async r=>{r.preventDefault(),i=0,n.classList.remove(...s);const o=r.dataTransfer.getData("text/plain");o&&await Vf(o,t,e)})}async function Vf(n,t,e){const i={},{DURATION_LIMITS:s}=H;switch(t){case"inbox":i.projectId=null;break;case"project":e&&(i.projectId=e);break;case"timeblock":i.timeBlockId=e==="unassigned"||!e?null:e;break;case"duration":{const r=parseInt(e,10);if(!isNaN(r)&&r>=s.MIN&&r<=s.MAX)i.duration=r;else{T({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),T({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await kl(n,i)}catch(r){console.error(`[Drop Error] Type: ${t}, Task: ${n}`,r),T({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const ro=Array.from({length:24},(n,t)=>String(t).padStart(2,"0")),oo=["00","15","30","45"],Un=(n,t)=>n.map(e=>`<option value="${e}" ${e===t?"selected":""}>${e}</option>`).join("");function Uf(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh]">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-gray-50/50 dark:bg-gray-800/50">
                <h3 class="text-lg font-bold text-gray-800 dark:text-white">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-6 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div id="tb-list" class="divide-y divide-gray-100 dark:divide-gray-700"></div>
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-lg text-gray-400 hover:border-blue-500 hover:text-blue-500 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed"></button>
                <div class="p-4 bg-gray-50 dark:bg-gray-900/50 rounded-lg border border-gray-100 dark:border-gray-800 flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-3 h-3 rounded-full bg-gray-400 mr-3"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs">デフォルトのゾーンです（削除不可）</span>
                </div>
            </div>
            <div class="px-6 py-4 border-t border-gray-100 dark:border-gray-700 bg-gray-50/50 dark:bg-900/50 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-lg font-bold text-sm transition-all active:scale-95">完了</button>
            </div>
        </div>
    `}function Wf(n){const[t,e]=n.start.split(":"),[i,s]=n.end.split(":");return`
        <div class="flex-shrink-0 relative">
            <input type="color" class="w-8 h-8 rounded cursor-pointer border-none p-0 bg-transparent focus:ring-2 focus:ring-blue-500 outline-none" value="${n.color}">
            <div class="absolute inset-0 pointer-events-none rounded border border-gray-200 dark:border-gray-600"></div>
        </div>
        <div class="flex-1 flex items-center gap-2">
            <div class="flex items-center gap-1 bg-gray-50 dark:bg-gray-900 px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700">
                <select class="start-h bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${Un(ro,t)}</select>
                <span class="text-gray-400">:</span>
                <select class="start-m bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${Un(oo,e)}</select>
            </div>
            <span class="text-gray-300 font-bold">~</span>
            <div class="flex items-center gap-1 bg-gray-50 dark:bg-gray-900 px-2 py-1 rounded-md border border-gray-200 dark:border-gray-700">
                <select class="end-h bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${Un(ro,i)}</select>
                <span class="text-gray-400">:</span>
                <select class="end-m bg-transparent outline-none text-sm text-gray-800 dark:text-gray-200 cursor-pointer">${Un(oo,s)}</select>
            </div>
        </div>
        <div class="flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity">
            <button class="save-btn p-2 text-blue-600 hover:bg-blue-50 dark:hover:bg-blue-900/30 rounded-lg transition-colors" title="保存">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </button>
            <button class="delete-btn p-2 text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/30 rounded-lg transition-colors" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const Ci=5,ao={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${Ci}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${Ci}個)</span>`};function Di(n){if(!n)return 0;const[t,e]=n.split(":").map(Number);return t*60+e}function qf(n,t,e){const s=St().filter(r=>r.id!==n);for(const r of s){const o=Di(r.start),a=Di(r.end);if(Math.max(t,o)<Math.min(e,a))return!0}return!1}function an(n,t){if(!n)return;const e=t>=Ci;n.disabled=e,n.innerHTML=e?ao.LIMIT:ao.ADD}const Yf={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function Dl(n=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const e=document.createElement("div");e.id=t,e.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",e.innerHTML=Uf(),document.body.appendChild(e),Gf(n),Jf(e)}function Gf(n){const t=document.getElementById("tb-list"),e=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=St(),s=document.createDocumentFragment();i.forEach(r=>s.appendChild(Ll(r))),t.appendChild(s),an(e,i.length),n!=null&&n.id&&requestAnimationFrame(()=>{const r=t.querySelector(`.tb-row[data-id="${n.id}"]`);r&&(r.scrollIntoView({behavior:"smooth",block:"center"}),r.classList.add("bg-blue-50","dark:bg-blue-900/20","ring-2","ring-blue-400","ring-inset","rounded-lg"),setTimeout(()=>r.classList.remove("ring-2","ring-blue-400","ring-inset"),2e3))})}function Ll(n=null){const t=n||{...Yf},e=document.createElement("div");return e.className="tb-row flex items-center gap-4 py-4 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg",t.id&&(e.dataset.id=t.id),e.innerHTML=Wf(t),Xf(e),e}function Kf(n){const t=`${n.querySelector(".start-h").value}:${n.querySelector(".start-m").value}`,e=`${n.querySelector(".end-h").value}:${n.querySelector(".end-m").value}`,i=n.querySelector('input[type="color"]').value;return{start:t,end:e,color:i}}function Xf(n){const t=n.querySelector(".save-btn"),e=n.querySelector(".delete-btn");t.onclick=async()=>{const{start:i,end:s,color:r}=Kf(n),o=n.dataset.id||null,a=Di(i),l=Di(s);if(a>=l)return T({message:"終了時間は開始時間より後にしてください",type:"error"});if(qf(o,a,l))return T({message:"他の時間帯と重複しています。",type:"error"});t.disabled=!0;try{const c=await nf({id:o,name:`${i}-${s}`,start:i,end:s,color:r});c!=null&&c.id&&(n.dataset.id=c.id),n.classList.add("bg-green-50","dark:bg-green-900/20"),setTimeout(()=>n.classList.remove("bg-green-50","dark:bg-green-900/20"),1e3),document.dispatchEvent(new CustomEvent("timeblocks-updated")),an(document.getElementById("add-tb-btn"),St().length)}catch(c){T({message:c.message||"保存に失敗しました",type:"error"})}finally{t.disabled=!1}},e.onclick=()=>{const i=n.dataset.id;if(!i){n.remove(),an(document.getElementById("add-tb-btn"),St().length);return}T({message:"削除しますか？関連タスクは「未定」になります。",type:"confirm",onConfirm:async()=>{try{await sf(i),n.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),an(document.getElementById("add-tb-btn"),St().length)}catch{T({message:"削除に失敗しました",type:"error"})}}})}}function Jf(n){const t=n.querySelector("#add-tb-btn"),e=s=>{s.key==="Escape"&&i()},i=()=>{n.remove(),document.removeEventListener("keydown",e)};n.querySelector("#close-tb-modal").onclick=i,n.querySelector("#close-tb-footer").onclick=i,n.onclick=s=>{s.target===n&&i()},document.addEventListener("keydown",e),t.onclick=()=>{const s=document.getElementById("tb-list"),r=s.querySelectorAll(".tb-row").length;if(r<Ci){const o=Ll();s.appendChild(o),an(t,r+1),o.scrollIntoView({behavior:"smooth"}),setTimeout(()=>{var a;return(a=o.querySelector("select"))==null?void 0:a.focus()},100)}}}function Zf(n){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",e=>{e.stopPropagation(),Il()})}function Qf(n,t=[]){const e=document.getElementById("project-list");if(e){if(e.innerHTML="",n.length===0){e.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}n.forEach(i=>{const s=t.filter(o=>o.projectId===i.id&&!o.completed).length,r=mn(i.name,"project",i.id,i.color,s);r.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},r.oncontextmenu=o=>{o.preventDefault(),o.stopPropagation(),dr(o,"project",i)},bn(r,"project",i.id),e.appendChild(r)})}}function tg(n,t){let e=Li(n,t);return eg(e,t.sortCriteria)}function Li(n,t){const{keyword:e,projectId:i,labelId:s,showCompleted:r,timeBlockId:o,duration:a}=t;return n.filter(l=>{if(!r&&l.status==="completed"||i&&l.projectId!==i||s&&(!l.labelIds||!l.labelIds.includes(s)))return!1;if(o){if(o==="unassigned"){if(l.timeBlockId&&l.timeBlockId!=="null")return!1}else if(String(l.timeBlockId)!==String(o))return!1}if(a&&Number(l.duration)!==Number(a))return!1;if(e){const c=e.toLowerCase(),d=l.title.toLowerCase().includes(c),u=(l.description||"").toLowerCase().includes(c);if(!d&&!u)return!1}return!0})}function eg(n,t="createdAt_desc"){return[...n].sort((e,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(e.createdAt||0);case"createdAt_asc":return(e.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return e.dueDate?i.dueDate?e.dueDate-i.dueDate:-1:1;case"project_asc":return(e.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function ng(n){const t=document.getElementById("inbox-count");if(!t)return;const e=Ei(n,i=>!i.projectId);t.textContent=e,t.classList.toggle("hidden",e===0)}function ig(n,t=[]){Qf(n,t)}function sg(n=[]){const t=document.getElementById(H.LIST_IDS.TIMEBLOCKS);if(!t)return;t.innerHTML="";const e=document.createDocumentFragment();St().forEach(o=>{const a=Ei(n,d=>String(d.timeBlockId)===String(o.id)),l=`${o.start} - ${o.end}`,c=mn(l,"timeblock",o.id,{color:o.color},a);c.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:o.id}})),c.oncontextmenu=d=>{d.preventDefault(),Dl(o)},bn(c,"timeblock",o.id),e.appendChild(c)});const s=Ei(n,o=>!o.timeBlockId||o.timeBlockId==="null"),r=mn("未定","timeblock","unassigned",{color:"#a0aec0"},s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),bn(r,"timeblock","unassigned"),e.appendChild(r),t.appendChild(e)}function rg(n=[]){const t=document.getElementById(H.LIST_IDS.DURATIONS);if(!t)return;t.innerHTML="";const e=document.createDocumentFragment(),i='<span class="mr-3 text-sm">⏱️</span>';H.DURATIONS.forEach(s=>{const r=Ei(n,a=>Number(a.duration)===s),o=mn(`${s} min`,"duration",s.toString(),{iconHtml:i},r);o.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:s.toString()}})),bn(o,"duration",s.toString()),e.appendChild(o)}),t.appendChild(e)}function og(n=[],t=[]){const e=document.getElementById(H.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const i=document.createDocumentFragment(),s='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';n.forEach(r=>{let o=0;try{typeof Li=="function"&&(o=Li(t,{savedFilter:r,showCompleted:!1}).length)}catch(l){console.warn("[Sidebar] Filter count error:",l)}const a=mn(r.name,"filter",r.id,{iconHtml:s},o);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),a.oncontextmenu=l=>{l.preventDefault(),dr(l,"filter",r)},i.appendChild(a)}),e.appendChild(i)}function ag(n,t,e,i,s=[]){document.getElementById(H.LIST_IDS.PROJECTS)&&(ig(e,t),sg(t),rg(t),og(s,t),ng(t))}let Ol=[],Pl=[],Bs=[],Ns=[],Wn=null,qn=null,lt={};function Rl({tasks:n,labels:t,projects:e,filters:i}){n!==void 0&&(Ol=n||[]),t!==void 0&&(Pl=t||[]),e!==void 0&&(Bs=e||[]),i!==void 0&&(Ns=i||[])}function lo(){lt={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function lg(){if(lo(),!lt.container)return;lt.container.innerHTML=zf(),lo(),qa(lt.sidebar,lt.resizer),dg(),jf(),cg(),lt.inbox&&bn(lt.inbox,"inbox"),Zf(lt.container),qn&&window.removeEventListener("resize",qn),qn=()=>Fs(),window.addEventListener("resize",qn),Fs();const n=Tn(H.STORAGE_KEYS.COMPACT,!1);Bl(n),ug()}function cg(){const n=["timeblocks-updated","projects-updated","labels-updated","filters-updated","tasks-updated"];Wn&&n.forEach(t=>window.removeEventListener(t,Wn)),Wn=()=>{const t=Bs.length>0?Bs:Va(),e=Ns.length>0?Ns:Uh();ag(lt.sidebar,Ol,t,Pl,e)},n.forEach(t=>window.addEventListener(t,Wn))}function dg(){var t,e;const n=(i,s=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:i,id:s}}));lt.container.addEventListener("click",i=>{const s=i.target.closest("a"),r=i.target.closest("button");if(s){i.preventDefault();const o=s.id;o==="nav-dashboard"&&n("dashboard"),o==="nav-inbox"&&n("inbox"),o==="nav-search"&&n("search"),o==="nav-settings"&&Ui();return}if(r){const o=r.id;o==="add-filter-btn"&&El(),o==="edit-timeblocks-btn"&&Dl()}}),(t=lt.openBtn)==null||t.addEventListener("click",()=>co(!0)),(e=lt.closeBtn)==null||e.addEventListener("click",()=>co(!1))}function Bl(n){const t=document.querySelectorAll(".sidebar-item-row"),{COMPACT_PY:e,NORMAL_PY:i}=H.CLASSES;t.forEach(s=>{s.classList.toggle(e,n),s.classList.toggle(i,!n)})}function co(n){const{sidebar:t,resizer:e}=lt,{CLOSED:i,HIDDEN:s}=H.CLASSES;if(t){if(t.classList.toggle(i,!n),t.classList.toggle(s,!n),Wa())if(e&&e.classList.toggle(s,!n),n){const r=localStorage.getItem(H.STORAGE_KEYS.WIDTH)||H.DEFAULT_WIDTH;t.style.width=`${r}px`}else t.style.width="0";Fs()}}function Fs(){const{sidebar:n,openBtn:t,closeBtn:e}=lt,{CLOSED:i,HIDDEN:s}=H.CLASSES;if(!n||!t||!e)return;const r=n.classList.contains(i)||n.classList.contains(s);Wa()?(t.classList.toggle(s,!r),e.classList.toggle(s,r),r||n.classList.remove(s)):(t.classList.remove(s),e.classList.remove(s),n.classList.remove(s))}function ug(){window.addEventListener("sidebar-settings-updated",n=>{Bl(!!n.detail.compact)})}const hg={FAVICON:"/images/favicon-96x96.png"},fg={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},Ye={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},ur={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:Ot,HEADER_IDS:uo,DATA_ATTRS:gg}=ur;function fi(n,t){t.forEach(e=>{e.classList.add(Ot.HIDDEN),e.classList.remove(Ot.FADE_IN)}),n.classList.remove(Ot.HIDDEN),n.classList.add(Ot.FADE_IN)}function Nl(){document.querySelectorAll(".sidebar-item-row").forEach(n=>{n.classList.remove(...Ot.HIGHLIGHT),n.classList.add(...Ot.NORMAL);const t=n.querySelector("svg, span:not(.truncate)");if(t){const e=Array.from(t.classList).filter(s=>s.startsWith("text-"));t.classList.remove(...e);const i=n.getAttribute(gg.DEFAULT_COLOR);i&&t.classList.add(i)}})}function pg(n){Nl();const t=mg(n);if(t){t.classList.remove(...Ot.NORMAL),t.classList.add(...Ot.HIGHLIGHT);const e=t.querySelector("svg, span:not(.truncate)");if(e){const i=Array.from(e.classList).filter(s=>s.startsWith("text-"));e.classList.remove(...i),e.classList.add("text-white")}}}function mg(n){if(!n)return null;const{type:t,id:e}=n;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?Ye.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${e}"]`)}function Fl(n,t=[],e=[]){var c;const i=document.getElementById(uo.TITLE),s=document.getElementById(uo.COUNT);if(!i)return;let r="インボックス";const{type:o,id:a,name:l}=n;if(l)r=l;else switch(o){case Ye.PROJECT:r=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case Ye.LABEL:const d=e.find(u=>u.id===a);r=d?`ラベル: ${d.name}`:"ラベル";break;case Ye.TIMEBLOCK:if(a==="unassigned")r="時間帯: 未定";else{const u=tf(a);r=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case Ye.DURATION:r=`所要時間: ${a}分`;break;case"search":r="タスク検索";break;case"dashboard":r="ダッシュボード";break}i.textContent=r,s&&["dashboard","search"].includes(o)&&(s.textContent="")}function bg(){const{VIEW_IDS:n}=ur;Object.values(n).forEach(t=>{const e=document.getElementById(t);if(e)if(t===n.TASK){e.innerHTML="";const i=document.createElement("div");i.className="p-20 text-center text-gray-400 font-medium",i.textContent="ログインしてください",e.appendChild(i)}else e.classList.add(Ot.HIDDEN)})}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Rn(n){return n+.5|0}const qt=(n,t,e)=>Math.max(Math.min(n,e),t);function Ge(n){return qt(Rn(n*2.55),0,255)}function Zt(n){return qt(Rn(n*255),0,255)}function Dt(n){return qt(Rn(n/2.55)/100,0,1)}function ho(n){return qt(Rn(n*100),0,100)}const ft={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},$s=[..."0123456789ABCDEF"],yg=n=>$s[n&15],xg=n=>$s[(n&240)>>4]+$s[n&15],Yn=n=>(n&240)>>4===(n&15),vg=n=>Yn(n.r)&&Yn(n.g)&&Yn(n.b)&&Yn(n.a);function _g(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ft[n[1]]*17,g:255&ft[n[2]]*17,b:255&ft[n[3]]*17,a:t===5?ft[n[4]]*17:255}:(t===7||t===9)&&(e={r:ft[n[1]]<<4|ft[n[2]],g:ft[n[3]]<<4|ft[n[4]],b:ft[n[5]]<<4|ft[n[6]],a:t===9?ft[n[7]]<<4|ft[n[8]]:255})),e}const kg=(n,t)=>n<255?t(n):"";function wg(n){var t=vg(n)?yg:xg;return n?"#"+t(n.r)+t(n.g)+t(n.b)+kg(n.a,t):void 0}const Sg=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function $l(n,t,e){const i=t*Math.min(e,1-e),s=(r,o=(r+n/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[s(0),s(8),s(4)]}function Eg(n,t,e){const i=(s,r=(s+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function Ig(n,t,e){const i=$l(n,1,.5);let s;for(t+e>1&&(s=1/(t+e),t*=s,e*=s),s=0;s<3;s++)i[s]*=1-t-e,i[s]+=t;return i}function Mg(n,t,e,i,s){return n===s?(t-e)/i+(t<e?6:0):t===s?(e-n)/i+2:(n-t)/i+4}function hr(n){const e=n.r/255,i=n.g/255,s=n.b/255,r=Math.max(e,i,s),o=Math.min(e,i,s),a=(r+o)/2;let l,c,d;return r!==o&&(d=r-o,c=a>.5?d/(2-r-o):d/(r+o),l=Mg(e,i,s,d,r),l=l*60+.5),[l|0,c||0,a]}function fr(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(Zt)}function gr(n,t,e){return fr($l,n,t,e)}function Ag(n,t,e){return fr(Ig,n,t,e)}function Tg(n,t,e){return fr(Eg,n,t,e)}function Hl(n){return(n%360+360)%360}function Cg(n){const t=Sg.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?Ge(+t[5]):Zt(+t[5]));const s=Hl(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=Ag(s,r,o):t[1]==="hsv"?i=Tg(s,r,o):i=gr(s,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function Dg(n,t){var e=hr(n);e[0]=Hl(e[0]+t),e=gr(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Lg(n){if(!n)return;const t=hr(n),e=t[0],i=ho(t[1]),s=ho(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${s}%, ${Dt(n.a)})`:`hsl(${e}, ${i}%, ${s}%)`}const fo={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},go={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Og(){const n={},t=Object.keys(go),e=Object.keys(fo);let i,s,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],s=0;s<e.length;s++)r=e[s],a=a.replace(r,fo[r]);r=parseInt(go[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let Gn;function Pg(n){Gn||(Gn=Og(),Gn.transparent=[0,0,0,0]);const t=Gn[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Rg=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Bg(n){const t=Rg.exec(n);let e=255,i,s,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?Ge(o):qt(o*255,0,255)}return i=+t[1],s=+t[3],r=+t[5],i=255&(t[2]?Ge(i):qt(i,0,255)),s=255&(t[4]?Ge(s):qt(s,0,255)),r=255&(t[6]?Ge(r):qt(r,0,255)),{r:i,g:s,b:r,a:e}}}function Ng(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${Dt(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const hs=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,we=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Fg(n,t,e){const i=we(Dt(n.r)),s=we(Dt(n.g)),r=we(Dt(n.b));return{r:Zt(hs(i+e*(we(Dt(t.r))-i))),g:Zt(hs(s+e*(we(Dt(t.g))-s))),b:Zt(hs(r+e*(we(Dt(t.b))-r))),a:n.a+e*(t.a-n.a)}}function Kn(n,t,e){if(n){let i=hr(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=gr(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function zl(n,t){return n&&Object.assign(t||{},n)}function po(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=Zt(n[3]))):(t=zl(n,{r:0,g:0,b:0,a:1}),t.a=Zt(t.a)),t}function $g(n){return n.charAt(0)==="r"?Bg(n):Cg(n)}class yn{constructor(t){if(t instanceof yn)return t;const e=typeof t;let i;e==="object"?i=po(t):e==="string"&&(i=_g(t)||Pg(t)||$g(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=zl(this._rgb);return t&&(t.a=Dt(t.a)),t}set rgb(t){this._rgb=po(t)}rgbString(){return this._valid?Ng(this._rgb):void 0}hexString(){return this._valid?wg(this._rgb):void 0}hslString(){return this._valid?Lg(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-c,i.r=255&c*i.r+r*s.r+.5,i.g=255&c*i.g+r*s.g+.5,i.b=255&c*i.b+r*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Fg(this._rgb,t._rgb,e)),this}clone(){return new yn(this.rgb)}alpha(t){return this._rgb.a=Zt(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=Rn(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Kn(this._rgb,2,t),this}darken(t){return Kn(this._rgb,2,-t),this}saturate(t){return Kn(this._rgb,1,t),this}desaturate(t){return Kn(this._rgb,1,-t),this}rotate(t){return Dg(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function At(){}const Hg=(()=>{let n=0;return()=>n++})();function D(n){return n==null}function W(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function L(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function G(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function ht(n,t){return G(n)?n:t}function M(n,t){return typeof n>"u"?t:n}const zg=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,jl=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function z(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function N(n,t,e,i){let s,r,o;if(W(n))for(r=n.length,s=0;s<r;s++)t.call(e,n[s],s);else if(L(n))for(o=Object.keys(n),r=o.length,s=0;s<r;s++)t.call(e,n[o[s]],o[s])}function Oi(n,t){let e,i,s,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(s=n[e],r=t[e],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function Pi(n){if(W(n))return n.map(Pi);if(L(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let s=0;for(;s<i;++s)t[e[s]]=Pi(n[e[s]]);return t}return n}function Vl(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function jg(n,t,e,i){if(!Vl(n))return;const s=t[n],r=e[n];L(s)&&L(r)?xn(s,r,i):t[n]=Pi(r)}function xn(n,t,e){const i=W(t)?t:[t],s=i.length;if(!L(n))return n;e=e||{};const r=e.merger||jg;let o;for(let a=0;a<s;++a){if(o=i[a],!L(o))continue;const l=Object.keys(o);for(let c=0,d=l.length;c<d;++c)r(l[c],n,o,e)}return n}function ln(n,t){return xn(n,t,{merger:Vg})}function Vg(n,t,e){if(!Vl(n))return;const i=t[n],s=e[n];L(i)&&L(s)?ln(i,s):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=Pi(s))}const mo={"":n=>n,x:n=>n.x,y:n=>n.y};function Ug(n){const t=n.split("."),e=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function Wg(n){const t=Ug(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function Qt(n,t){return(mo[t]||(mo[t]=Wg(t)))(n)}function pr(n){return n.charAt(0).toUpperCase()+n.slice(1)}const vn=n=>typeof n<"u",te=n=>typeof n=="function",bo=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function qg(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const P=Math.PI,V=2*P,Yg=V+P,Ri=Number.POSITIVE_INFINITY,Gg=P/180,X=P/2,re=P/4,yo=P*2/3,Yt=Math.log10,Et=Math.sign;function cn(n,t,e){return Math.abs(n-t)<e}function xo(n){const t=Math.round(n);n=cn(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(Yt(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function Kg(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((s,r)=>s-r).pop(),t}function Xg(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Ce(n){return!Xg(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function Jg(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Ul(n,t,e){let i,s,r;for(i=0,s=n.length;i<s;i++)r=n[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function yt(n){return n*(P/180)}function mr(n){return n*(180/P)}function vo(n){if(!G(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function Wl(n,t){const e=t.x-n.x,i=t.y-n.y,s=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*P&&(r+=V),{angle:r,distance:s}}function Hs(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function Zg(n,t){return(n-t+Yg)%V-P}function it(n){return(n%V+V)%V}function _n(n,t,e,i){const s=it(n),r=it(t),o=it(e),a=it(r-s),l=it(o-s),c=it(s-r),d=it(s-o);return s===r||s===o||i&&r===o||a>l&&c<d}function Z(n,t,e){return Math.max(t,Math.min(e,n))}function Qg(n){return Z(n,-32768,32767)}function Pt(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function br(n,t,e){e=e||(o=>n[o]<t);let i=n.length-1,s=0,r;for(;i-s>1;)r=s+i>>1,e(r)?s=r:i=r;return{lo:s,hi:i}}const Rt=(n,t,e,i)=>br(n,e,i?s=>{const r=n[s][t];return r<e||r===e&&n[s+1][t]===e}:s=>n[s][t]<e),tp=(n,t,e)=>br(n,e,i=>n[i][t]>=e);function ep(n,t,e){let i=0,s=n.length;for(;i<s&&n[i]<t;)i++;for(;s>i&&n[s-1]>e;)s--;return i>0||s<n.length?n.slice(i,s):n}const ql=["push","pop","shift","splice","unshift"];function np(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),ql.forEach(e=>{const i="_onData"+pr(e),s=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=s.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function _o(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(ql.forEach(r=>{delete n[r]}),delete n._chartjs)}function Yl(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Gl=function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame}();function Kl(n,t){let e=[],i=!1;return function(...s){e=s,i||(i=!0,Gl.call(window,()=>{i=!1,n.apply(t,e)}))}}function ip(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const yr=n=>n==="start"?"left":n==="end"?"right":"center",nt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,sp=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Xl(n,t,e){const i=t.length;let s=0,r=i;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,c=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,d=o.axis,{min:u,max:h,minDefined:f,maxDefined:g}=o.getUserBounds();if(f){if(s=Math.min(Rt(l,d,u).lo,e?i:Rt(t,d,o.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!D(m[a.axis]));s-=Math.max(0,p)}s=Z(s,0,i-1)}if(g){let p=Math.max(Rt(l,o.axis,h,!0).hi+1,e?0:Rt(t,d,o.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!D(b[a.axis]));p+=Math.max(0,m)}r=Z(p,s,i)-s}else r=i-s}return{start:s,count:r}}function Jl(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,s={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,s),r}const Xn=n=>n===0||n===1,ko=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*V/e)),wo=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*V/e)+1,dn={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*X)+1,easeOutSine:n=>Math.sin(n*X),easeInOutSine:n=>-.5*(Math.cos(P*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Xn(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Xn(n)?n:ko(n,.075,.3),easeOutElastic:n=>Xn(n)?n:wo(n,.075,.3),easeInOutElastic(n){return Xn(n)?n:n<.5?.5*ko(n*2,.1125,.45):.5+.5*wo(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-dn.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?dn.easeInBounce(n*2)*.5:dn.easeOutBounce(n*2-1)*.5+.5};function xr(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function So(n){return xr(n)?n:new yn(n)}function fs(n){return xr(n)?n:new yn(n).saturate(.5).darken(.1).hexString()}const rp=["x","y","borderWidth","radius","tension"],op=["color","borderColor","backgroundColor"];function ap(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:op},numbers:{type:"number",properties:rp}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function lp(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Eo=new Map;function cp(n,t){t=t||{};const e=n+JSON.stringify(t);let i=Eo.get(e);return i||(i=new Intl.NumberFormat(n,t),Eo.set(e,i)),i}function Bn(n,t,e){return cp(t,e).format(n)}const Zl={values(n){return W(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let s,r=n;if(e.length>1){const c=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),r=dp(n,e)}const o=Yt(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Bn(n,i,l)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(Yt(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?Zl.numeric.call(this,n,t,e):""}};function dp(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var qi={formatters:Zl};function up(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:qi.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const me=Object.create(null),zs=Object.create(null);function un(n,t){if(!t)return n;const e=t.split(".");for(let i=0,s=e.length;i<s;++i){const r=e[i];n=n[r]||(n[r]=Object.create(null))}return n}function gs(n,t,e){return typeof t=="string"?xn(un(n,t),e):xn(un(n,""),t)}class hp{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>fs(s.backgroundColor),this.hoverBorderColor=(i,s)=>fs(s.borderColor),this.hoverColor=(i,s)=>fs(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return gs(this,t,e)}get(t){return un(this,t)}describe(t,e){return gs(zs,t,e)}override(t,e){return gs(me,t,e)}route(t,e,i,s){const r=un(this,t),o=un(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],c=o[s];return L(l)?Object.assign({},c,l):M(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var q=new hp({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[ap,lp,up]);function fp(n){return!n||D(n.size)||D(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function Bi(n,t,e,i,s){let r=t[s];return r||(r=t[s]=n.measureText(s).width,e.push(s)),r>i&&(i=r),i}function gp(n,t,e,i){i=i||{};let s=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},r=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=e[l],u!=null&&!W(u))o=Bi(n,s,r,o,u);else if(W(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!W(h)&&(o=Bi(n,s,r,o,h));n.restore();const f=r.length/2;if(f>e.length){for(l=0;l<f;l++)delete s[r[l]];r.splice(0,f)}return o}function oe(n,t,e){const i=n.currentDevicePixelRatio,s=e!==0?Math.max(e/2,.5):0;return Math.round((t-s)*i)/i+s}function Io(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function js(n,t,e,i){Ql(n,t,e,i,null)}function Ql(n,t,e,i,s){let r,o,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Gg;if(f&&typeof f=="object"&&(r=f.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(m),n.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),n.restore();return}if(!(isNaN(p)||p<=0)){switch(n.beginPath(),f){default:s?n.ellipse(e,i,s/2,p,0,0,V):n.arc(e,i,p,0,V),n.closePath();break;case"triangle":d=s?s/2:p,n.moveTo(e+Math.sin(m)*d,i-Math.cos(m)*p),m+=yo,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*p),m+=yo,n.lineTo(e+Math.sin(m)*d,i-Math.cos(m)*p),n.closePath();break;case"rectRounded":c=p*.516,l=p-c,o=Math.cos(m+re)*l,u=Math.cos(m+re)*(s?s/2-c:l),a=Math.sin(m+re)*l,h=Math.sin(m+re)*(s?s/2-c:l),n.arc(e-u,i-a,c,m-P,m-X),n.arc(e+h,i-o,c,m-X,m),n.arc(e+u,i+a,c,m,m+X),n.arc(e-h,i+o,c,m+X,m+P),n.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,n.rect(e-d,i-l,2*d,2*l);break}m+=re;case"rectRot":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+h,i-o),n.lineTo(e+u,i+a),n.lineTo(e-h,i+o),n.closePath();break;case"crossRot":m+=re;case"cross":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o);break;case"star":u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o),m+=re,u=Math.cos(m)*(s?s/2:p),o=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),n.moveTo(e-u,i-a),n.lineTo(e+u,i+a),n.moveTo(e+h,i-o),n.lineTo(e-h,i+o);break;case"line":o=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,n.moveTo(e-o,i-a),n.lineTo(e+o,i+a);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Bt(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function Yi(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Gi(n){n.restore()}function pp(n,t,e,i,s){if(!t)return n.lineTo(e.x,e.y);if(s==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else s==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function mp(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function bp(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),D(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function yp(n,t,e,i,s){if(s.strikethrough||s.underline){const r=n.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,c=e+r.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(o,d),n.lineTo(a,d),n.stroke()}}function xp(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function be(n,t,e,i,s,r={}){const o=W(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,c;for(n.save(),n.font=s.string,bp(n,r),l=0;l<o.length;++l)c=o[l],r.backdrop&&xp(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),D(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(c,e,i,r.maxWidth)),n.fillText(c,e,i,r.maxWidth),yp(n,e,i,c,r),i+=Number(s.lineHeight);n.restore()}function kn(n,t){const{x:e,y:i,w:s,h:r,radius:o}=t;n.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*P,P,!0),n.lineTo(e,i+r-o.bottomLeft),n.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,P,X,!0),n.lineTo(e+s-o.bottomRight,i+r),n.arc(e+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,X,0,!0),n.lineTo(e+s,i+o.topRight),n.arc(e+s-o.topRight,i+o.topRight,o.topRight,0,-X,!0),n.lineTo(e+o.topLeft,i)}const vp=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,_p=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function kp(n,t){const e=(""+n).match(vp);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const wp=n=>+n||0;function vr(n,t){const e={},i=L(t),s=i?Object.keys(t):t,r=L(n)?i?o=>M(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of s)e[o]=wp(r(o));return e}function tc(n){return vr(n,{top:"y",right:"x",bottom:"y",left:"x"})}function ge(n){return vr(n,["topLeft","topRight","bottomLeft","bottomRight"])}function rt(n){const t=tc(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function J(n,t){n=n||{},t=t||q.font;let e=M(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=M(n.style,t.style);i&&!(""+i).match(_p)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:M(n.family,t.family),lineHeight:kp(M(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:M(n.weight,t.weight),string:""};return s.string=fp(s),s}function Ke(n,t,e,i){let s,r,o;for(s=0,r=n.length;s<r;++s)if(o=n[s],o!==void 0&&o!==void 0)return o}function Sp(n,t,e){const{min:i,max:s}=n,r=jl(t,(s-i)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(i,-Math.abs(r)),max:o(s,r)}}function ee(n,t){return Object.assign(Object.create(n),t)}function _r(n,t=[""],e,i,s=()=>n[0]){const r=e||n;typeof i>"u"&&(i=sc("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:i,_getTarget:s,override:a=>_r([a,...n],t,r,i)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return nc(a,l,()=>Lp(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Ao(a).includes(l)},ownKeys(a){return Ao(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function De(n,t,e,i){const s={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:ec(n,i),setContext:r=>De(n,r,e,i),override:r=>De(n.override(r),t,e,i)};return new Proxy(s,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return nc(r,o,()=>Ip(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function ec(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=n;return{allKeys:s,scriptable:e,indexable:i,isScriptable:te(e)?e:()=>e,isIndexable:te(i)?i:()=>i}}const Ep=(n,t)=>n?n+pr(t):t,kr=(n,t)=>L(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function nc(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function Ip(n,t,e){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=n;let a=i[t];return te(a)&&o.isScriptable(t)&&(a=Mp(t,a,n,e)),W(a)&&a.length&&(a=Ap(t,a,n,o.isIndexable)),kr(t,a)&&(a=De(a,s,r&&r[t],o)),a}function Mp(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||i);return a.delete(n),kr(n,l)&&(l=wr(s._scopes,s,n,l)),l}function Ap(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&i(n))return t[r.index%t.length];if(L(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=wr(c,s,n,d);t.push(De(u,r,o&&o[n],a))}}return t}function ic(n,t,e){return te(n)?n(t,e):n}const Tp=(n,t)=>n===!0?t:typeof n=="string"?Qt(t,n):void 0;function Cp(n,t,e,i,s){for(const r of t){const o=Tp(e,r);if(o){n.add(o);const a=ic(o._fallback,e,s);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function wr(n,t,e,i){const s=t._rootScopes,r=ic(t._fallback,e,i),o=[...n,...s],a=new Set;a.add(i);let l=Mo(a,o,e,r||e,i);return l===null||typeof r<"u"&&r!==e&&(l=Mo(a,o,r,l,i),l===null)?!1:_r(Array.from(a),[""],s,r,()=>Dp(t,e,i))}function Mo(n,t,e,i,s){for(;e;)e=Cp(n,t,e,i,s);return e}function Dp(n,t,e){const i=n._getTarget();t in i||(i[t]={});const s=i[t];return W(s)&&L(e)?e:s||{}}function Lp(n,t,e,i){let s;for(const r of t)if(s=sc(Ep(r,n),e),typeof s<"u")return kr(n,s)?wr(e,i,n,s):s}function sc(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function Ao(n){let t=n._keys;return t||(t=n._keys=Op(n._scopes)),t}function Op(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function rc(n,t,e,i){const{iScale:s}=n,{key:r="r"}=this._parsing,o=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+e,d=t[c],o[a]={r:s.parse(Qt(d,r),c)};return o}const Pp=Number.EPSILON||1e-14,Le=(n,t)=>t<n.length&&!n[t].skip&&n[t],oc=n=>n==="x"?"y":"x";function Rp(n,t,e,i){const s=n.skip?t:n,r=t,o=e.skip?t:e,a=Hs(r,s),l=Hs(o,r);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:r.x-u*(o.x-s.x),y:r.y-u*(o.y-s.y)},next:{x:r.x+h*(o.x-s.x),y:r.y+h*(o.y-s.y)}}}function Bp(n,t,e){const i=n.length;let s,r,o,a,l,c=Le(n,0);for(let d=0;d<i-1;++d)if(l=c,c=Le(n,d+1),!(!l||!c)){if(cn(t[d],0,Pp)){e[d]=e[d+1]=0;continue}s=e[d]/t[d],r=e[d+1]/t[d],a=Math.pow(s,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[d]=s*o*t[d],e[d+1]=r*o*t[d])}}function Np(n,t,e="x"){const i=oc(e),s=n.length;let r,o,a,l=Le(n,0);for(let c=0;c<s;++c){if(o=a,a=l,l=Le(n,c+1),!a)continue;const d=a[e],u=a[i];o&&(r=(d-o[e])/3,a[`cp1${e}`]=d-r,a[`cp1${i}`]=u-r*t[c]),l&&(r=(l[e]-d)/3,a[`cp2${e}`]=d+r,a[`cp2${i}`]=u+r*t[c])}}function Fp(n,t="x"){const e=oc(t),i=n.length,s=Array(i).fill(0),r=Array(i);let o,a,l,c=Le(n,0);for(o=0;o<i;++o)if(a=l,l=c,c=Le(n,o+1),!!l){if(c){const d=c[t]-l[t];s[o]=d!==0?(c[e]-l[e])/d:0}r[o]=a?c?Et(s[o-1])!==Et(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}Bp(n,s,r),Np(n,r,t)}function Jn(n,t,e){return Math.max(Math.min(n,e),t)}function $p(n,t){let e,i,s,r,o,a=Bt(n[0],t);for(e=0,i=n.length;e<i;++e)o=r,r=a,a=e<i-1&&Bt(n[e+1],t),r&&(s=n[e],o&&(s.cp1x=Jn(s.cp1x,t.left,t.right),s.cp1y=Jn(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=Jn(s.cp2x,t.left,t.right),s.cp2y=Jn(s.cp2y,t.top,t.bottom)))}function Hp(n,t,e,i,s){let r,o,a,l;if(t.spanGaps&&(n=n.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Fp(n,s);else{let c=i?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=Rp(c,a,n[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&$p(n,e)}function Sr(){return typeof window<"u"&&typeof document<"u"}function Er(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Ni(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const Ki=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function zp(n,t){return Ki(n).getPropertyValue(t)}const jp=["top","right","bottom","left"];function pe(n,t,e){const i={};e=e?"-"+e:"";for(let s=0;s<4;s++){const r=jp[s];i[r]=parseFloat(n[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Vp=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function Up(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:s,offsetY:r}=i;let o=!1,a,l;if(Vp(s,r,n.target))a=s,l=r;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,o=!0}return{x:a,y:l,box:o}}function ce(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,s=Ki(e),r=s.boxSizing==="border-box",o=pe(s,"padding"),a=pe(s,"border","width"),{x:l,y:c,box:d}=Up(n,e),u=o.left+(d&&a.left),h=o.top+(d&&a.top);let{width:f,height:g}=t;return r&&(f-=o.width+a.width,g-=o.height+a.height),{x:Math.round((l-u)/f*e.width/i),y:Math.round((c-h)/g*e.height/i)}}function Wp(n,t,e){let i,s;if(t===void 0||e===void 0){const r=n&&Er(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Ki(r),l=pe(a,"border","width"),c=pe(a,"padding");t=o.width-c.width-l.width,e=o.height-c.height-l.height,i=Ni(a.maxWidth,r,"clientWidth"),s=Ni(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||Ri,maxHeight:s||Ri}}const Gt=n=>Math.round(n*10)/10;function qp(n,t,e,i){const s=Ki(n),r=pe(s,"margin"),o=Ni(s.maxWidth,n,"clientWidth")||Ri,a=Ni(s.maxHeight,n,"clientHeight")||Ri,l=Wp(n,t,e);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=pe(s,"border","width"),f=pe(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-r.width),d=Math.max(0,i?c/i:d-r.height),c=Gt(Math.min(c,o,l.maxWidth)),d=Gt(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Gt(c/2)),(t!==void 0||e!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Gt(Math.floor(d*i))),{width:c,height:d}}function To(n,t,e){const i=t||1,s=Gt(n.height*i),r=Gt(n.width*i);n.height=Gt(n.height),n.width=Gt(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||o.height!==s||o.width!==r?(n.currentDevicePixelRatio=i,o.height=s,o.width=r,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Yp=function(){let n=!1;try{const t={get passive(){return n=!0,!1}};Sr()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n}();function Co(n,t){const e=zp(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function de(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function Gp(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function Kp(n,t,e,i){const s={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=de(n,s,e),a=de(s,r,e),l=de(r,t,e),c=de(o,a,e),d=de(a,l,e);return de(c,d,e)}const Xp=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},Jp=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function Te(n,t,e){return n?Xp(t,e):Jp()}function ac(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function lc(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function cc(n){return n==="angle"?{between:_n,compare:Zg,normalize:it}:{between:Pt,compare:(t,e)=>t-e,normalize:t=>t}}function Do({start:n,end:t,count:e,loop:i,style:s}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:s}}function Zp(n,t,e){const{property:i,start:s,end:r}=e,{between:o,normalize:a}=cc(i),l=t.length;let{start:c,end:d,loop:u}=n,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&o(a(t[c%l][i]),s,r);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:n.style}}function dc(n,t,e){if(!e)return[n];const{property:i,start:s,end:r}=e,o=t.length,{compare:a,between:l,normalize:c}=cc(i),{start:d,end:u,loop:h,style:f}=Zp(n,t,e),g=[];let p=!1,m=null,b,y,v;const _=()=>l(s,v,b)&&a(s,v)!==0,x=()=>a(r,b)===0||l(r,v,b),k=()=>p||_(),S=()=>!p||x();for(let E=d,I=d;E<=u;++E)y=t[E%o],!y.skip&&(b=c(y[i]),b!==v&&(p=l(b,s,r),m===null&&k()&&(m=a(b,s)===0?E:I),m!==null&&S()&&(g.push(Do({start:m,end:E,loop:h,count:o,style:f})),m=null),I=E,v=b));return m!==null&&g.push(Do({start:m,end:u,loop:h,count:o,style:f})),g}function uc(n,t){const e=[],i=n.segments;for(let s=0;s<i.length;s++){const r=dc(i[s],n.points,t);r.length&&e.push(...r)}return e}function Qp(n,t,e,i){let s=0,r=t-1;if(e&&!i)for(;s<t&&!n[s].skip;)s++;for(;s<t&&n[s].skip;)s++;for(s%=t,e&&(r+=s);r>s&&n[r%t].skip;)r--;return r%=t,{start:s,end:r}}function tm(n,t,e,i){const s=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const c=n[l%s];c.skip||c.stop?a.skip||(i=!1,r.push({start:t%s,end:(l-1)%s,loop:i}),t=o=c.stop?l:null):(o=l,a.skip&&(t=l)),a=c}return o!==null&&r.push({start:t%s,end:o%s,loop:i}),r}function em(n,t){const e=n.points,i=n.options.spanGaps,s=e.length;if(!s)return[];const r=!!n._loop,{start:o,end:a}=Qp(e,s,r,i);if(i===!0)return Lo(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+s:a,c=!!n._fullLoop&&o===0&&a===s-1;return Lo(n,tm(e,o,l,c),e,t)}function Lo(n,t,e,i){return!i||!i.setContext||!e?t:nm(n,t,e,i)}function nm(n,t,e,i){const s=n._chart.getContext(),r=Oo(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,c=[];let d=r,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;e[g%l].skip;)g-=y;for(;e[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=e[u%l],m;for(h=u+1;h<=g.end;h++){const b=e[h%l];m=Oo(i.setContext(ee(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:o}))),im(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Oo(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function im(n,t){if(!t)return!1;const e=[],i=function(s,r){return xr(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function Zn(n,t,e){return n.options.clip?n[e]:t[e]}function sm(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:Zn(e,t,"left"),right:Zn(e,t,"right"),top:Zn(i,t,"top"),bottom:Zn(i,t,"bottom")}:t}function hc(n,t){const e=t._clip;if(e.disabled)return!1;const i=sm(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class rm{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const r=e.listeners[s],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Gl.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),r.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Tt=new rm;const Po="transparent",om={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=So(n||Po),s=i.valid&&So(t||Po);return s&&s.valid?s.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class am{constructor(t,e,i,s){const r=e[i];s=Ke([t.to,s,r,t.from]);const o=Ke([t.from,r,s]);this._active=!0,this._fn=t.fn||om[t.type||typeof o],this._easing=dn[t.easing]||dn.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=Ke([t.to,e,s,t.from]),this._from=Ke([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<i),!this._active){this._target[s]=a,this._notify(!0);return}if(e<0){this._target[s]=r;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][e]()}}class fc{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!L(t))return;const e=Object.keys(q.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const r=t[s];if(!L(r))return;const o={};for(const a of e)o[a]=r[a];(W(r.properties)&&r.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,s=cm(t,i);if(!s)return[];const r=this._createAnimations(s,i);return i.$shared&&lm(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,s=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const c=o[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,e));continue}const d=e[c];let u=r[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}r[c]=u=new am(h,t,c,d),s.push(u)}return s}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Tt.add(this._chart,i),!0}}function lm(n,t){const e=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const r=n[i[s]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function cm(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Ro(n,t){const e=n&&n.options||{},i=e.reverse,s=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:s,end:i?s:r}}function dm(n,t,e){if(e===!1)return!1;const i=Ro(n,e),s=Ro(t,e);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function um(n){let t,e,i,s;return L(n)?(t=n.top,e=n.right,i=n.bottom,s=n.left):t=e=i=s=n,{top:t,right:e,bottom:i,left:s,disabled:n===!1}}function gc(n,t){const e=[],i=n._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)e.push(i[s].index);return e}function Bo(n,t,e,i={}){const s=n.keys,r=i.mode==="single";let o,a,l,c;if(t===null)return;let d=!1;for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===e){if(d=!0,i.all)continue;break}c=n.values[l],G(c)&&(r||t===0||Et(t)===Et(c))&&(t+=c)}return!d&&!i.all?0:t}function hm(n,t){const{iScale:e,vScale:i}=t,s=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,c,d;for(l=0,c=o.length;l<c;++l)d=o[l],a[l]={[s]:d,[r]:n[d]};return a}function ps(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function fm(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function gm(n){const{min:t,max:e,minDefined:i,maxDefined:s}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?e:Number.POSITIVE_INFINITY}}function pm(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function No(n,t,e,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const r=n[s.index];if(e&&r>0||!e&&r<0)return s.index}return null}function Fo(n,t){const{chart:e,_cachedMeta:i}=n,s=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,c=o.axis,d=fm(r,o,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=pm(s,d,p),h[a]=m,h._top=No(h,o,!0,i.type),h._bottom=No(h,o,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function ms(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function mm(n,t){return ee(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function bm(n,t,e){return ee(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function He(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const s of t){const r=s._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const bs=n=>n==="reset"||n==="none",$o=(n,t)=>t?n:Object.assign({},n),ym=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:gc(e,!0),values:null};class xt{constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ps(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&He(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,r=e.xAxisID=M(i.xAxisID,ms(t,"x")),o=e.yAxisID=M(i.yAxisID,ms(t,"y")),a=e.rAxisID=M(i.rAxisID,ms(t,"r")),l=e.indexAxis,c=e.iAxisID=s(l,r,o,a),d=e.vAxisID=s(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(c),e.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&_o(this._data,this),t._stacked&&He(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(L(e)){const s=this._cachedMeta;this._data=hm(e,s)}else if(i!==e){if(i){_o(i,this);const s=this._cachedMeta;He(s),s._parsed=[]}e&&Object.isExtensible(e)&&np(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const r=e._stacked;e._stacked=ps(e.vScale,e),e.stack!==i.stack&&(s=!0,He(e),e.stack=i.stack),this._resyncElements(t),(s||r!==e._stacked)&&(Fo(this,e._parsed),e._stacked=ps(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:r,_stacked:o}=i,a=r.axis;let l=t===0&&e===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{W(s[t])?h=this.parseArrayData(i,s,t,e):L(s[t])?h=this.parseObjectData(i,s,t,e):h=this.parsePrimitiveData(i,s,t,e);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<e;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}o&&Fo(this,h)}parsePrimitiveData(t,e,i,s){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,c=r.getLabels(),d=r===o,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||r.parse(c[g],g),[l]:o.parse(e[g],g)};return u}parseArrayData(t,e,i,s){const{xScale:r,yScale:o}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=e[d],a[l]={x:r.parse(u[0],d),y:o.parse(u[1],d)};return a}parseObjectData(t,e,i,s){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=e[h],c[d]={x:r.parse(Qt(f,a),h),y:o.parse(Qt(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:gc(s,!0),values:e._stacks[t.axis]._visualValues};return Bo(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const r=i[e.axis];let o=r===null?NaN:r;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Bo(s,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,r=i._sorted&&t===i.iScale,o=s.length,a=this._getOtherScale(t),l=ym(e,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=gm(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!G(f[t.axis])||d>p||u<p}for(h=0;h<o&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),r));++h);if(r){for(h=o-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,r,o;for(s=0,r=e.length;s<r;++s)o=e[s][t.axis],G(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:s?""+s.getLabelForValue(r[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=um(M(this.options.clip,dm(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,r,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?o.push(u):u.draw(t,r))}for(d=0;d<o.length;++d)o[d].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=bm(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=s.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=mm(this.chart.getContext(),this.index)),r.dataset=s,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&vn(i);if(a)return $o(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(q.elements[t]),g=()=>this.getContext(i,s,e),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,r[o]=Object.freeze($o(p,l))),p}_resolveAnimations(t,e,i){const s=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,e),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,e))}const c=new fc(s,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||bs(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==s;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,s){bs(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!bs(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const r=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,r=e.length,o=Math.min(r,s);o&&this.parse(0,o),r>s?this._insertElements(s,r-s,t):r<s&&this._removeElements(r,s-r)}_insertElements(t,e,i=!0){const s=this._cachedMeta,r=s.data,o=t+e;let a;const l=c=>{for(c.length+=e,a=c.length-1;a>=o;a--)c[a]=c[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&He(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}w(xt,"defaults",{}),w(xt,"datasetElementType",null),w(xt,"dataElementType",null);function xm(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let s=0,r=e.length;s<r;s++)i=i.concat(e[s].controller.getAllParsedValues(n));n._cache.$bar=Yl(i.sort((s,r)=>s-r))}return n._cache.$bar}function vm(n){const t=n.iScale,e=xm(t,n.type);let i=t._length,s,r,o,a;const l=()=>{o===32767||o===-32768||(vn(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(s=0,r=e.length;s<r;++s)o=t.getPixelForValue(e[s]),l();for(a=void 0,s=0,r=t.ticks.length;s<r;++s)o=t.getPixelForTick(s),l();return i}function _m(n,t,e,i){const s=e.barThickness;let r,o;return D(s)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[n]-r/2}}function km(n,t,e,i){const s=t.pixels,r=s[n];let o=n>0?s[n-1]:null,a=n<s.length-1?s[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const c=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:e.barPercentage,start:c}}function wm(n,t,e,i){const s=e.parse(n[0],i),r=e.parse(n[1],i),o=Math.min(s,r),a=Math.max(s,r);let l=o,c=a;Math.abs(o)>Math.abs(a)&&(l=a,c=o),t[e.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:r,min:o,max:a}}function pc(n,t,e,i){return W(n)?wm(n,t,e,i):t[e.axis]=e.parse(n,i),t}function Ho(n,t,e,i){const s=n.iScale,r=n.vScale,o=s.getLabels(),a=s===r,l=[];let c,d,u,h;for(c=e,d=e+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(o[c],c),l.push(pc(h,u,r,c));return l}function ys(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function Sm(n,t,e){return n!==0?Et(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function Em(n){let t,e,i,s,r;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(s="end",r="start"):(s="start",r="end"),{start:e,end:i,reverse:t,top:s,bottom:r}}function Im(n,t,e,i){let s=t.borderSkipped;const r={};if(!s){n.borderSkipped=r;return}if(s===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:c,bottom:d}=Em(n);s==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?s=c:(e._bottom||0)===i?s=d:(r[zo(d,o,a,l)]=!0,s=c)),r[zo(s,o,a,l)]=!0,n.borderSkipped=r}function zo(n,t,e,i){return i?(n=Mm(n,t,e),n=jo(n,e,t)):n=jo(n,t,e),n}function Mm(n,t,e){return n===t?e:n===e?t:n}function jo(n,t,e){return n==="start"?t:n==="end"?e:n}function Am(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class gi extends xt{parsePrimitiveData(t,e,i,s){return Ho(t,e,i,s)}parseArrayData(t,e,i,s){return Ho(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=r.axis==="x"?a:l,d=o.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=e[h],g={},g[r.axis]=r.parse(Qt(p,c),h),u.push(pc(Qt(p,d),g,o,h));return u}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,r=this.getParsed(t),o=r._custom,a=ys(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(r[s.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,s){const r=s==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(e,s);for(let f=e;f<e+i;f++){const g=this.getParsed(f),p=r||D(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||ys(g._custom)||o===b._top||o===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const v=y.options||t[f].options;Im(y,v,b,o),Am(y,v,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),r=i.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(D(h)||isNaN(h))return!0};for(const d of s)if(!(e!==void 0&&c(d))&&((r===!1||o.indexOf(d.stack)===-1||r===void 0&&d.stack===void 0)&&o.push(d.stack),d.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[M(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const s=this._getStacks(t,i),r=e!==void 0?s.indexOf(e):-1;return r===-1?s.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let r,o;for(r=0,o=e.data.length;r<o;++r)s.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||vm(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:s},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),c=l._custom,d=ys(c);let u=l[e.axis],h=0,f=i?this.applyStack(e,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Et(u)!==Et(c.barEnd)&&(h=0),h+=u);const m=!D(r)&&!d?r:h;let b=e.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=e.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<o){p=Sm(p,e,a)*o,u===a&&(b-=p/2);const y=e.getPixelForDecimal(0),v=e.getPixelForDecimal(1),_=Math.min(y,v),x=Math.max(y,v);b=Math.max(Math.min(b,x),_),g=b+p,i&&!d&&(l._stacks[e.axis]._visualValues[s]=e.getValueForPixel(g)-e.getValueForPixel(b))}if(b===e.getPixelForValue(a)){const y=Et(p)*e.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,e){const i=e.scale,s=this.options,r=s.skipNull,o=M(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(e.grouped){const d=r?this._getStackCount(t):e.stackCount,u=s.barThickness==="flex"?km(t,e,s,d*c):_m(t,e,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(M(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(o,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let r=0;for(;r<s;++r)this.getParsed(r)[e.axis]!==null&&!i[r].hidden&&i[r].draw(this._ctx)}}w(gi,"id","bar"),w(gi,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),w(gi,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class pi extends xt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const r=super.parsePrimitiveData(t,e,i,s);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,s){const r=super.parseArrayData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=M(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,s){const r=super.parseObjectData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=M(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y),c=o._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(e,s),d=o.axis,u=a.axis;for(let h=e;h<e+i;h++){const f=t[h],g=!r&&this.getParsed(h),p={},m=p[d]=r?o.getPixelForDecimal(.5):o.getPixelForValue(g[d]),b=p[u]=r?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),r&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const r=s.radius;return e!=="active"&&(s.radius=0),s.radius+=M(i&&i._custom,r),s}}w(pi,"id","bubble"),w(pi,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),w(pi,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Tm(n,t,e){let i=1,s=1,r=0,o=0;if(t<V){const a=n,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(v,_,x)=>_n(v,a,l,!0)?1:Math.max(_,_*e,x,x*e),g=(v,_,x)=>_n(v,a,l,!0)?-1:Math.min(_,_*e,x,x*e),p=f(0,c,u),m=f(X,d,h),b=g(P,c,u),y=g(P+X,d,h);i=(p-b)/2,s=(m-y)/2,r=-(p+b)/2,o=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}class he extends xt{constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let r=l=>+i[l];if(L(i[t])){const{key:l="value"}=this._parsing;r=c=>+Qt(i[c],l)}let o,a;for(o=t,a=t+e;o<a;++o)s._parsed[o]=r(o)}}_getRotation(){return yt(this.options.rotation-90)}_getCircumference(){return yt(this.options.circumference)}_getRotationExtents(){let t=V,e=-V;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,r=s._getRotation(),o=s._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,r=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min(zg(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Tm(u,d,l),m=(i.width-o)/h,b=(i.height-o)/f,y=Math.max(Math.min(m,b)/2,0),v=jl(this.options.radius,y),_=Math.max(v*l,0),x=(v-_)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=p*v,s.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*r/V)}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,a=o.chartArea,c=o.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=r&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(e,s);let b=this._getRotation(),y;for(y=0;y<e;++y)b+=this._circumference(y,r);for(y=e;y<e+i;++y){const v=this._circumference(y,r),_=t[y],x={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+v,circumference:v,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(y,_.active?"active":s)),b+=v,this.updateElement(_,y,x,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,s;for(s=0;s<e.length;s++){const r=t._parsed[s];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(s)&&!e[s].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?V*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=Bn(e._parsed[t],i.options.locale);return{label:s[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,r,o,a,l;if(!t){for(s=0,r=i.data.datasets.length;s<r;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}}if(!t)return 0;for(s=0,r=t.length;s<r;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(M(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}w(he,"id","doughnut"),w(he,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),w(he,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),w(he,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:o&&(a||u.borderRadius),index:c}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}});class mi extends xt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Xl(e,s,o);this._drawStart=a,this._drawCount=l,Jl(e)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(e,s),h=o.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Ce(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||r||s==="none",y=e+i,v=t.length;let _=e>0&&this.getParsed(e-1);for(let x=0;x<v;++x){const k=t[x],S=b?k:{};if(x<e||x>=y){S.skip=!0;continue}const E=this.getParsed(x),I=D(E[f]),A=S[h]=o.getPixelForValue(E[h],x),C=S[f]=r||I?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,E,l):E[f],x);S.skip=isNaN(A)||isNaN(C)||I,S.stop=x>0&&Math.abs(E[h]-_[h])>m,p&&(S.parsed=E,S.raw=c.data[x]),u&&(S.options=d||this.resolveDataElementOptions(x,k.active?"active":s)),b||this.updateElement(k,x,S,s),_=E}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const r=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}w(mi,"id","line"),w(mi,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),w(mi,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class hn extends xt{constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=Bn(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:r}}parseObjectData(t,e,i,s){return rc.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const r=this.getParsed(s).r;!isNaN(r)&&this.chart.getDataVisibility(s)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(s/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,l=o.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*P;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<e;++g)f+=this._computeAngle(g,s,p);for(g=e;g<e+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),v=o.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,r&&(l.animateScale&&(v=0),l.animateRotate&&(b=y=h));const _={x:d,y:u,innerRadius:0,outerRadius:v,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,_,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?yt(this.resolveDataElementOptions(t,e).angle||i):0}}w(hn,"id","polarArea"),w(hn,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),w(hn,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Vs extends he{}w(Vs,"id","pie"),w(Vs,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class bi extends xt{getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return rc.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],r=e.iScale.getLabels();if(i.points=s,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===s.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const r=this._cachedMeta.rScale,o=s==="reset";for(let a=e;a<e+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=r.getPointPositionForValue(a,this.getParsed(a).r),u=o?r.xCenter:d.x,h=o?r.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}w(bi,"id","radar"),w(bi,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),w(bi,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class yi extends xt{getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:r,count:o}=Xl(e,i,s);if(this._drawStart=r,this._drawCount=o,Jl(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(e,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=o.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=Ce(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||r||s==="none";let v=e>0&&this.getParsed(e-1);for(let _=e;_<e+i;++_){const x=t[_],k=this.getParsed(_),S=y?x:{},E=D(k[g]),I=S[f]=o.getPixelForValue(k[f],_),A=S[g]=r||E?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,k,l):k[g],_);S.skip=isNaN(I)||isNaN(A)||E,S.stop=_>0&&Math.abs(k[f]-v[f])>b,m&&(S.parsed=k,S.raw=c.data[_]),h&&(S.options=u||this.resolveDataElementOptions(_,x.active?"active":s)),y||this.updateElement(x,_,S,s),v=k}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,r,o)/2}}w(yi,"id","scatter"),w(yi,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),w(yi,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Cm=Object.freeze({__proto__:null,BarController:gi,BubbleController:pi,DoughnutController:he,LineController:mi,PieController:Vs,PolarAreaController:hn,RadarController:bi,ScatterController:yi});function ae(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ir{constructor(t){w(this,"options");this.options=t||{}}static override(t){Object.assign(Ir.prototype,t)}init(){}formats(){return ae()}parse(){return ae()}format(){return ae()}add(){return ae()}diff(){return ae()}startOf(){return ae()}endOf(){return ae()}}var Dm={_date:Ir};function Lm(n,t,e,i){const{controller:s,data:r,_sorted:o}=n,a=s._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const c=a._reversePixels?tp:Rt;if(i){if(s._sharedOptions){const d=r[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(r,t,e-u),f=c(r,t,e+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(r,t,e);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=n,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!D(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!D(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:r.length-1}}function Xi(n,t,e,i,s){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:c,data:d}=r[a],{lo:u,hi:h}=Lm(r[a],t,o,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Om(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,s){const r=t?Math.abs(i.x-s.x):0,o=e?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function xs(n,t,e,i,s){const r=[];return!s&&!n.isPointInArea(t)||Xi(n,e,t,function(a,l,c){!s&&!Bt(a,n.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:l,index:c})},!0),r}function Pm(n,t,e,i){let s=[];function r(o,a,l){const{startAngle:c,endAngle:d}=o.getProps(["startAngle","endAngle"],i),{angle:u}=Wl(o,{x:t.x,y:t.y});_n(u,c,d)&&s.push({element:o,datasetIndex:a,index:l})}return Xi(n,e,t,r),s}function Rm(n,t,e,i,s,r){let o=[];const a=Om(e);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!r||n.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(o=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&o.push({element:d,datasetIndex:u,index:h})}return Xi(n,e,t,c),o}function vs(n,t,e,i,s,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!i?Pm(n,t,e,s):Rm(n,t,e,i,s,r)}function Vo(n,t,e,i,s){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Xi(n,e,t,(l,c,d)=>{l[o]&&l[o](t[e],s)&&(r.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:r}var Bm={modes:{index(n,t,e,i){const s=ce(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?xs(n,s,r,i,o):vs(n,s,r,!1,i,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(n,t,e,i){const s=ce(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?xs(n,s,r,i,o):vs(n,s,r,!1,i,o);if(a.length>0){const l=a[0].datasetIndex,c=n.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(n,t,e,i){const s=ce(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return xs(n,s,r,i,o)},nearest(n,t,e,i){const s=ce(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return vs(n,s,r,e.intersect,i,o)},x(n,t,e,i){const s=ce(t,n);return Vo(n,s,"x",e.intersect,i)},y(n,t,e,i){const s=ce(t,n);return Vo(n,s,"y",e.intersect,i)}}};const mc=["left","top","right","bottom"];function ze(n,t){return n.filter(e=>e.pos===t)}function Uo(n,t){return n.filter(e=>mc.indexOf(e.pos)===-1&&e.box.axis===t)}function je(n,t){return n.sort((e,i)=>{const s=t?i:e,r=t?e:i;return s.weight===r.weight?s.index-r.index:s.weight-r.weight})}function Nm(n){const t=[];let e,i,s,r,o,a;for(e=0,i=(n||[]).length;e<i;++e)s=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=s,t.push({index:e,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return t}function Fm(n){const t={};for(const e of n){const{stack:i,pos:s,stackWeight:r}=e;if(!i||!mc.includes(s))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function $m(n,t){const e=Fm(n),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,c=e[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return e}function Hm(n){const t=Nm(n),e=je(t.filter(c=>c.box.fullSize),!0),i=je(ze(t,"left"),!0),s=je(ze(t,"right")),r=je(ze(t,"top"),!0),o=je(ze(t,"bottom")),a=Uo(t,"x"),l=Uo(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:ze(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}function Wo(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function bc(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function zm(n,t,e,i){const{pos:s,box:r}=e,o=n.maxPadding;if(!L(s)){e.size&&(n[s]-=e.size);const u=i[e.stack]||{size:0,count:1};u.size=Math.max(u.size,e.horizontal?r.height:r.width),e.size=u.size/u.count,n[s]+=e.size}r.getPadding&&bc(o,r.getPadding());const a=Math.max(0,t.outerWidth-Wo(o,n,"left","right")),l=Math.max(0,t.outerHeight-Wo(o,n,"top","bottom")),c=a!==n.w,d=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:c,other:d}:{same:d,other:c}}function jm(n){const t=n.maxPadding;function e(i){const s=Math.max(t[i]-n[i],0);return n[i]+=s,s}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function Vm(n,t){const e=t.maxPadding;function i(s){const r={left:0,top:0,right:0,bottom:0};return s.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(n?["left","right"]:["top","bottom"])}function Xe(n,t,e,i){const s=[];let r,o,a,l,c,d;for(r=0,o=n.length,c=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,Vm(a.horizontal,t));const{same:u,other:h}=zm(t,e,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&Xe(s,t,e,i)||d}function Qn(n,t,e,i,s){n.top=e,n.left=t,n.right=t+i,n.bottom=e+s,n.width=i,n.height=s}function qo(n,t,e,i){const s=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;vn(c.start)&&(o=c.start),l.fullSize?Qn(l,s.left,o,e.outerWidth-s.right-s.left,h):Qn(l,t.left+c.placed,o,u,h),c.start=o,c.placed+=u,o=l.bottom}else{const u=t.h*d,h=c.size||l.width;vn(c.start)&&(r=c.start),l.fullSize?Qn(l,r,s.top,h,e.outerHeight-s.bottom-s.top):Qn(l,r,t.top+c.placed,h,u),c.start=r,c.placed+=u,r=l.right}}t.x=r,t.y=o}var st={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const s=rt(n.options.layout.padding),r=Math.max(t-s.width,0),o=Math.max(e-s.height,0),a=Hm(n.boxes),l=a.vertical,c=a.horizontal;N(n.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:e,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/d,hBoxMaxHeight:o/2}),h=Object.assign({},s);bc(h,rt(i));const f=Object.assign({maxPadding:h,w:r,h:o,x:s.left,y:s.top},s),g=$m(l.concat(c),u);Xe(a.fullSize,f,u,g),Xe(l,f,u,g),Xe(c,f,u,g)&&Xe(l,f,u,g),jm(f),qo(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,qo(a.rightAndBottom,f,u,g),n.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},N(a.chartArea,p=>{const m=p.box;Object.assign(m,n.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class yc{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Um extends yc{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const xi="$chartjs",Wm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Yo=n=>n===null||n==="";function qm(n,t){const e=n.style,i=n.getAttribute("height"),s=n.getAttribute("width");if(n[xi]={initial:{height:i,width:s,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",Yo(s)){const r=Co(n,"width");r!==void 0&&(n.width=r)}if(Yo(i))if(n.style.height==="")n.height=n.width/(t||2);else{const r=Co(n,"height");r!==void 0&&(n.height=r)}return n}const xc=Yp?{passive:!0}:!1;function Ym(n,t,e){n&&n.addEventListener(t,e,xc)}function Gm(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,xc)}function Km(n,t){const e=Wm[n.type]||n.type,{x:i,y:s}=ce(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Fi(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function Xm(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Fi(a.addedNodes,i),o=o&&!Fi(a.removedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}function Jm(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Fi(a.removedNodes,i),o=o&&!Fi(a.addedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}const wn=new Map;let Go=0;function vc(){const n=window.devicePixelRatio;n!==Go&&(Go=n,wn.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function Zm(n,t){wn.size||window.addEventListener("resize",vc),wn.set(n,t)}function Qm(n){wn.delete(n),wn.size||window.removeEventListener("resize",vc)}function tb(n,t,e){const i=n.canvas,s=i&&Er(i);if(!s)return;const r=Kl((a,l)=>{const c=s.clientWidth;e(a,l),c<s.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||r(c,d)});return o.observe(s),Zm(n,r),o}function _s(n,t,e){e&&e.disconnect(),t==="resize"&&Qm(n)}function eb(n,t,e){const i=n.canvas,s=Kl(r=>{n.ctx!==null&&e(Km(r,n))},n);return Ym(i,t,s),s}class nb extends yc{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(qm(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[xi])return!1;const i=e[xi].initial;["height","width"].forEach(r=>{const o=i[r];D(o)?e.removeAttribute(r):e.setAttribute(r,o)});const s=i.style||{};return Object.keys(s).forEach(r=>{e.style[r]=s[r]}),e.width=e.width,delete e[xi],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),o={attach:Xm,detach:Jm,resize:tb}[e]||eb;s[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:_s,detach:_s,resize:_s}[e]||Gm)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return qp(t,e,i,s)}isAttached(t){const e=t&&Er(t);return!!(e&&e.isConnected)}}function ib(n){return!Sr()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?Um:nb}class vt{constructor(){w(this,"x");w(this,"y");w(this,"active",!1);w(this,"options");w(this,"$animations")}tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Ce(this.x)&&Ce(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach(r=>{s[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),s}}w(vt,"defaults",{}),w(vt,"defaultRoutes");function sb(n,t){const e=n.options.ticks,i=rb(n),s=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?ab(t):[],o=r.length,a=r[0],l=r[o-1],c=[];if(o>s)return lb(t,c,r,o/s),c;const d=ob(r,t,s);if(o>0){let u,h;const f=o>1?Math.round((l-a)/(o-1)):null;for(ti(t,c,d,D(f)?0:a-f,a),u=0,h=o-1;u<h;u++)ti(t,c,d,r[u],r[u+1]);return ti(t,c,d,l,D(f)?t.length:l+f),c}return ti(t,c,d),c}function rb(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),s=n._maxLength/e;return Math.floor(Math.min(i,s))}function ob(n,t,e){const i=cb(n),s=t.length/e;if(!i)return Math.max(s,1);const r=Kg(i);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>s)return l}return Math.max(s,1)}function ab(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function lb(n,t,e,i){let s=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<n.length;o++)o===r&&(t.push(n[o]),s++,r=e[s*i])}function ti(n,t,e,i,s){const r=M(i,0),o=Math.min(M(s,n.length),n.length);let a=0,l,c,d;for(e=Math.ceil(e),s&&(l=s-i,e=l/Math.floor(l/e)),d=r;d<0;)a++,d=Math.round(r+a*e);for(c=Math.max(r,0);c<o;c++)c===d&&(t.push(n[c]),a++,d=Math.round(r+a*e))}function cb(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const db=n=>n==="left"?"right":n==="right"?"left":n,Ko=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,Xo=(n,t)=>Math.min(t||n,n);function Jo(n,t){const e=[],i=n.length/t,s=n.length;let r=0;for(;r<s;r+=i)e.push(n[Math.floor(r)]);return e}function ub(n,t,e){const i=n.ticks.length,s=Math.min(t,i-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(s),c;if(!(e&&(i===1?c=Math.max(l-r,o-l):t===0?c=(n.getPixelForTick(1)-l)/2:c=(l-n.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<r-a||l>o+a)))return l}function hb(n,t){N(n,e=>{const i=e.gc,s=i.length/2;let r;if(s>t){for(r=0;r<s;++r)delete e.data[i[r]];i.splice(0,s)}})}function Ve(n){return n.drawTicks?n.tickLength:0}function Zo(n,t){if(!n.display)return 0;const e=J(n.font,t),i=rt(n.padding);return(W(n.text)?n.text.length:1)*e.lineHeight+i.height}function fb(n,t){return ee(n,{scale:t,type:"scale"})}function gb(n,t,e){return ee(n,{tick:e,index:t,type:"tick"})}function pb(n,t,e){let i=yr(n);return(e&&t!=="right"||!e&&t==="right")&&(i=db(i)),i}function mb(n,t,e,i){const{top:s,left:r,bottom:o,right:a,chart:l}=n,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=o-s,m=a-r;if(n.isHorizontal()){if(f=nt(i,r,a),L(e)){const b=Object.keys(e)[0],y=e[b];g=d[b].getPixelForValue(y)+p-t}else e==="center"?g=(c.bottom+c.top)/2+p-t:g=Ko(n,e,t);h=a-r}else{if(L(e)){const b=Object.keys(e)[0],y=e[b];f=d[b].getPixelForValue(y)-m+t}else e==="center"?f=(c.left+c.right)/2-m+t:f=Ko(n,e,t);g=nt(i,o,s),u=e==="left"?-X:X}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class ve extends vt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=ht(t,Number.POSITIVE_INFINITY),e=ht(e,Number.NEGATIVE_INFINITY),i=ht(i,Number.POSITIVE_INFINITY),s=ht(s,Number.NEGATIVE_INFINITY),{min:ht(t,i),max:ht(e,s),minDefined:G(t),maxDefined:G(e)}}getMinMax(t){let{min:e,max:i,minDefined:s,maxDefined:r}=this.getUserBounds(),o;if(s&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)o=a[l].controller.getMinMax(this,t),s||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=s&&e>i?e:i,{min:ht(e,ht(i,e)),max:ht(i,ht(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){z(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Sp(this,r,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?Jo(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=sb(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){z(this.options.afterUpdate,[this])}beforeSetDimensions(){z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i],r.label=z(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=Xo(this.ticks.length,t.ticks.maxTicksLimit),s=e.minRotation||0,r=e.maxRotation;let o=s,a,l,c;if(!this._isVisible()||!e.display||s>=r||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=Z(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Ve(t.grid)-e.padding-Zo(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),o=mr(Math.min(Math.asin(Z((d.highest.height+6)/a,-1,1)),Math.asin(Z(l/c,-1,1))-Math.asin(Z(h/c,-1,1)))),o=Math.max(s,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=Zo(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=Ve(r)+l):(t.height=this.maxHeight,t.width=Ve(r)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=yt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*e.height):(h=i*t.height,f=s*e.width):r==="start"?f=e.width:r==="end"?h=t.width:r!=="inner"&&(h=t.width/2,f=e.width/2),this.paddingLeft=Math.max((h-d+o)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+o)*this.width/(this.width-u),0)}else{let d=e.height/2,u=t.height/2;r==="start"?(d=0,u=t.height):r==="end"&&(d=e.height,u=0),this.paddingTop=d+o,this.paddingBottom=u+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)D(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=Jo(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:s,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/Xo(e,i));let c=0,d=0,u,h,f,g,p,m,b,y,v,_,x;for(u=0;u<e;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=r[m]=r[m]||{data:{},gc:[]},y=p.lineHeight,v=_=0,!D(g)&&!W(g))v=Bi(s,b.data,b.gc,v,g),_=y;else if(W(g))for(h=0,f=g.length;h<f;++h)x=g[h],!D(x)&&!W(x)&&(v=Bi(s,b.data,b.gc,v,x),_+=y);o.push(v),a.push(_),c=Math.max(v,c),d=Math.max(_,d)}hb(r,e);const k=o.indexOf(c),S=a.indexOf(d),E=I=>({width:o[I]||0,height:a[I]||0});return{first:E(0),last:E(e-1),widest:E(k),highest:E(S),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return Qg(this._alignToPixels?oe(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=gb(this.getContext(),t,i))}return this.$context||(this.$context=fb(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=yt(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:r,position:o,border:a}=s,l=r.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Ve(r),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(U){return oe(i,U,p)};let y,v,_,x,k,S,E,I,A,C,O,Q;if(o==="top")y=b(this.bottom),S=this.bottom-h,I=y-m,C=b(t.top)+m,Q=t.bottom;else if(o==="bottom")y=b(this.top),C=t.top,Q=b(t.bottom)-m,S=y+m,I=this.top+h;else if(o==="left")y=b(this.right),k=this.right-h,E=y-m,A=b(t.left)+m,O=t.right;else if(o==="right")y=b(this.left),A=t.left,O=b(t.right)-m,k=y+m,E=this.left+h;else if(e==="x"){if(o==="center")y=b((t.top+t.bottom)/2+.5);else if(L(o)){const U=Object.keys(o)[0],K=o[U];y=b(this.chart.scales[U].getPixelForValue(K))}C=t.top,Q=t.bottom,S=y+m,I=S+h}else if(e==="y"){if(o==="center")y=b((t.left+t.right)/2);else if(L(o)){const U=Object.keys(o)[0],K=o[U];y=b(this.chart.scales[U].getPixelForValue(K))}k=y-m,E=k-h,A=t.left,O=t.right}const ut=M(s.ticks.maxTicksLimit,u),F=Math.max(1,Math.ceil(u/ut));for(v=0;v<u;v+=F){const U=this.getContext(v),K=r.setContext(U),mt=a.setContext(U),et=K.lineWidth,_e=K.color,Nn=mt.dash||[],ke=mt.dashOffset,Be=K.tickWidth,ne=K.tickColor,Ne=K.tickBorderDash||[],ie=K.tickBorderDashOffset;_=ub(this,v,l),_!==void 0&&(x=oe(i,_,et),c?k=E=A=O=x:S=I=C=Q=x,f.push({tx1:k,ty1:S,tx2:E,ty2:I,x1:A,y1:C,x2:O,y2:Q,width:et,color:_e,borderDash:Nn,borderDashOffset:ke,tickWidth:Be,tickColor:ne,tickBorderDash:Ne,tickBorderDashOffset:ie}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=r,h=Ve(i.grid),f=h+d,g=u?-d:f,p=-yt(this.labelRotation),m=[];let b,y,v,_,x,k,S,E,I,A,C,O,Q="middle";if(s==="top")k=this.bottom-g,S=this._getXAxisLabelAlignment();else if(s==="bottom")k=this.top+g,S=this._getXAxisLabelAlignment();else if(s==="left"){const F=this._getYAxisLabelAlignment(h);S=F.textAlign,x=F.x}else if(s==="right"){const F=this._getYAxisLabelAlignment(h);S=F.textAlign,x=F.x}else if(e==="x"){if(s==="center")k=(t.top+t.bottom)/2+f;else if(L(s)){const F=Object.keys(s)[0],U=s[F];k=this.chart.scales[F].getPixelForValue(U)+f}S=this._getXAxisLabelAlignment()}else if(e==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if(L(s)){const F=Object.keys(s)[0],U=s[F];x=this.chart.scales[F].getPixelForValue(U)}S=this._getYAxisLabelAlignment(h).textAlign}e==="y"&&(l==="start"?Q="top":l==="end"&&(Q="bottom"));const ut=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){v=a[b],_=v.label;const F=r.setContext(this.getContext(b));E=this.getPixelForTick(b)+r.labelOffset,I=this._resolveTickFontOptions(b),A=I.lineHeight,C=W(_)?_.length:1;const U=C/2,K=F.color,mt=F.textStrokeColor,et=F.textStrokeWidth;let _e=S;o?(x=E,S==="inner"&&(b===y-1?_e=this.options.reverse?"left":"right":b===0?_e=this.options.reverse?"right":"left":_e="center"),s==="top"?c==="near"||p!==0?O=-C*A+A/2:c==="center"?O=-ut.highest.height/2-U*A+A:O=-ut.highest.height+A/2:c==="near"||p!==0?O=A/2:c==="center"?O=ut.highest.height/2-U*A:O=ut.highest.height-C*A,u&&(O*=-1),p!==0&&!F.showLabelBackdrop&&(x+=A/2*Math.sin(p))):(k=E,O=(1-C)*A/2);let Nn;if(F.showLabelBackdrop){const ke=rt(F.backdropPadding),Be=ut.heights[b],ne=ut.widths[b];let Ne=O-ke.top,ie=0-ke.left;switch(Q){case"middle":Ne-=Be/2;break;case"bottom":Ne-=Be;break}switch(S){case"center":ie-=ne/2;break;case"right":ie-=ne;break;case"inner":b===y-1?ie-=ne:b>0&&(ie-=ne/2);break}Nn={left:ie,top:Ne,width:ne+ke.width,height:Be+ke.height,color:F.backdropColor}}m.push({label:_,font:I,textOffset:O,options:{rotation:p,color:K,strokeColor:mt,strokeWidth:et,textAlign:_e,textBaseline:Q,translation:[x,k],backdrop:Nn}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-yt(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let c,d;return e==="left"?s?(d=this.right+r,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):e==="right"?s?(d=this.left+r,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(r=>r.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=s.length;r<o;++r){const l=s[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=oe(t,this.left,o)-o/2,d=oe(t,this.right,a)+a/2,u=h=l):(u=oe(t,this.top,o)-o/2,h=oe(t,this.bottom,a)+a/2,c=d=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(c,u),e.lineTo(d,h),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&Yi(i,s);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,c=o.label,d=o.textOffset;be(i,c,0,d,l,a)}s&&Gi(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const r=J(i.font),o=rt(i.padding),a=i.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||L(e)?(l+=o.bottom,W(i.text)&&(l+=r.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=mb(this,l,e,a);be(t,i.text,0,0,r,{color:i.color,maxWidth:u,rotation:h,textAlign:pb(a,e,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=M(t.grid&&t.grid.z,-1),s=M(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==ve.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return J(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ei{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;xb(e)&&(i=this.register(e));const s=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in s||(s[r]=t,bb(t,o,i),this.override&&q.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in q[s]&&(delete q[s][i],this.override&&delete me[i])}}function bb(n,t,e){const i=xn(Object.create(null),[e?q.get(e):{},q.get(t),n.defaults]);q.set(t,i),n.defaultRoutes&&yb(t,n.defaultRoutes),n.descriptors&&q.describe(t,n.descriptors)}function yb(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),s=i.pop(),r=[n].concat(i).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");q.route(r,s,l,a)})}function xb(n){return"id"in n&&"defaults"in n}class vb{constructor(){this.controllers=new ei(xt,"datasets",!0),this.elements=new ei(vt,"elements"),this.plugins=new ei(Object,"plugins"),this.scales=new ei(ve,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(s=>{const r=i||this._getRegistryForType(s);i||r.isForType(s)||r===this.plugins&&s.id?this._exec(t,r,s):N(s,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const s=pr(t);z(i["before"+s],[],i),e[t](i),z(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var kt=new vb;class _b{constructor(){this._init=void 0}notify(t,e,i,s){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,s){s=s||{};for(const r of t){const o=r.plugin,a=o[i],l=[e,s,r.options];if(z(a,l,o)===!1&&s.cancelable)return!1}return!0}invalidate(){D(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=M(i.options&&i.options.plugins,{}),r=kb(i);return s===!1&&!e?[]:Sb(t,r,s,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function kb(n){const t={},e=[],i=Object.keys(kt.plugins.items);for(let r=0;r<i.length;r++)e.push(kt.getPlugin(i[r]));const s=n.plugins||[];for(let r=0;r<s.length;r++){const o=s[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function wb(n,t){return!t&&n===!1?null:n===!0?{}:n}function Sb(n,{plugins:t,localIds:e},i,s){const r=[],o=n.getContext();for(const a of t){const l=a.id,c=wb(i[l],s);c!==null&&r.push({plugin:a,options:Eb(n.config,{plugin:a,local:e[l]},c,o)})}return r}function Eb(n,{plugin:t,local:e},i,s){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Us(n,t){const e=q.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function Ib(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function Mb(n,t){return n===t?"_index_":"_value_"}function Qo(n){if(n==="x"||n==="y"||n==="r")return n}function Ab(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Ws(n,...t){if(Qo(n))return n;for(const e of t){const i=e.axis||Ab(e.position)||n.length>1&&Qo(n[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function ta(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function Tb(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return ta(n,"x",e[0])||ta(n,"y",e[0])}return{}}function Cb(n,t){const e=me[n.type]||{scales:{}},i=t.scales||{},s=Us(n.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!L(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Ws(o,a,Tb(o,n),q.scales[a.type]),c=Mb(l,s),d=e.scales||{};r[o]=ln(Object.create(null),[{axis:l},a,d[l],d[c]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||Us(a,t),d=(me[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=Ib(u,l),f=o[h+"AxisID"]||h;r[f]=r[f]||Object.create(null),ln(r[f],[{axis:h},i[f],d[u]])})}),Object.keys(r).forEach(o=>{const a=r[o];ln(a,[q.scales[a.type],q.scale])}),r}function _c(n){const t=n.options||(n.options={});t.plugins=M(t.plugins,{}),t.scales=Cb(n,t)}function kc(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function Db(n){return n=n||{},n.data=kc(n.data),_c(n),n}const ea=new Map,wc=new Set;function ni(n,t){let e=ea.get(n);return e||(e=t(),ea.set(n,e),wc.add(e)),e}const Ue=(n,t,e)=>{const i=Qt(t,e);i!==void 0&&n.add(i)};class Lb{constructor(t){this._config=Db(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=kc(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),_c(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ni(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return ni(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return ni(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return ni(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return(!s||e)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const l=new Set;e.forEach(d=>{t&&(l.add(t),d.forEach(u=>Ue(l,t,u))),d.forEach(u=>Ue(l,s,u)),d.forEach(u=>Ue(l,me[r]||{},u)),d.forEach(u=>Ue(l,q,u)),d.forEach(u=>Ue(l,zs,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),wc.has(e)&&o.set(e,c),c}chartOptionScopes(){const{options:t,type:e}=this;return[t,me[e]||{},q.datasets[e]||{},{type:e},q,zs]}resolveNamedOptions(t,e,i,s=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=na(this._resolverCache,t,s);let l=o;if(Pb(o,e)){r.$shared=!1,i=te(i)?i():i;const c=this.createResolver(t,i,a);l=De(o,i,c)}for(const c of e)r[c]=l[c];return r}createResolver(t,e,i=[""],s){const{resolver:r}=na(this._resolverCache,t,i);return L(e)?De(r,e,void 0,s):r}}function na(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const s=e.join();let r=i.get(s);return r||(r={resolver:_r(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,r)),r}const Ob=n=>L(n)&&Object.getOwnPropertyNames(n).some(t=>te(n[t]));function Pb(n,t){const{isScriptable:e,isIndexable:i}=ec(n);for(const s of t){const r=e(s),o=i(s),a=(o||r)&&n[s];if(r&&(te(a)||Ob(a))||o&&W(a))return!0}return!1}var Rb="4.5.1";const Bb=["top","bottom","left","right","chartArea"];function ia(n,t){return n==="top"||n==="bottom"||Bb.indexOf(n)===-1&&t==="x"}function sa(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function ra(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),z(e&&e.onComplete,[n],t)}function Nb(n){const t=n.chart,e=t.options.animation;z(e&&e.onProgress,[n],t)}function Sc(n){return Sr()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const vi={},oa=n=>{const t=Sc(n);return Object.values(vi).filter(e=>e.canvas===t).pop()};function Fb(n,t,e){const i=Object.keys(n);for(const s of i){const r=+s;if(r>=t){const o=n[s];delete n[s],(e>0||r>t)&&(n[r+e]=o)}}}function $b(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}class Lt{static register(...t){kt.add(...t),aa()}static unregister(...t){kt.remove(...t),aa()}constructor(t,e){const i=this.config=new Lb(e),s=Sc(t),r=oa(s);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||ib(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,o.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Hg(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new _b,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=ip(u=>this.update(u),o.resizeDelay||0),this._dataChanges=[],vi[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Tt.listen(this,"complete",ra),Tt.listen(this,"progress",Nb),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:r}=this;return D(t)?e&&r?r:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return kt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():To(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Io(this.canvas,this.ctx),this}stop(){return Tt.stop(this),this}resize(t,e){Tt.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,To(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),z(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};N(e,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Ws(o,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),N(r,o=>{const a=o.options,l=a.id,c=Ws(l,a),d=M(a.type,o.dtype);(a.position===void 0||ia(a.position,c)!==ia(o.dposition))&&(a.position=o.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=kt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),N(s,(o,a)=>{o||delete i[a]}),N(i,o=>{st.configure(this,o,o.options),st.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((s,r)=>s.index-r.index),i>e){for(let s=e;s<i;++s)this._destroyDatasetMeta(s);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(sa("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,s)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||Us(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=kt.getController(a),{datasetElementType:c,dataElementType:d}=q.datasets[a];Object.assign(l,{dataElementType:kt.getElement(d),datasetElementType:c&&kt.getElement(c)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){N(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&r.indexOf(u)===-1;u.buildOrUpdateElements(h),o=Math.max(+u.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||N(r,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(sa("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){N(this.scales,t=>{st.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!bo(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:r}of e){const o=i==="_removeElements"?-r:r;Fb(t,s,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),s=i(0);for(let r=1;r<e;r++)if(!bo(s,i(r)))return;return Array.from(s).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;st.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],N(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,r)=>{s._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,te(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Tt.has(this)?this.attached&&!Tt.running(this)&&Tt.start(this):(this.draw(),ra({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,r;for(s=0,r=e.length;s<r;++s){const o=e[s];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=hc(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&Yi(e,s),t.controller.draw(),s&&Gi(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Bt(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const r=Bm.modes[e];return typeof r=="function"?r(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter(r=>r&&r._dataset===e).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=ee(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,s);vn(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Tt.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Io(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete vi[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},s=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};N(this.options.events,r=>i(r,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,c)=>{e.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(e.removeEventListener(this,l,c),delete t[l])},r=(l,c)=>{this.canvas&&this.resize(l,c)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,s("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){N(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},N(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const c=o&&this.getDatasetMeta(o.datasetIndex).controller;c&&c[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!Oi(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const s=this.options.hover,r=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:r}=this,o=e,a=this._getActiveElements(t,s,i,o),l=qg(t),c=$b(t,this._lastEvent,i,l);i&&(this._lastEvent=null,z(r.onHover,[t,a,this],this),l&&z(r.onClick,[t,a,this],this));const d=!Oi(a,s);return(d||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=c,d}_getActiveElements(t,e,i,s){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,s)}}w(Lt,"defaults",q),w(Lt,"instances",vi),w(Lt,"overrides",me),w(Lt,"registry",kt),w(Lt,"version",Rb),w(Lt,"getChart",oa);function aa(){return N(Lt.instances,n=>n._plugins.invalidate())}function Hb(n,t,e){const{startAngle:i,x:s,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/o,it(i-e));if(n.beginPath(),n.arc(s,r,o-c/2,i+u/2,e-u/2),a>0){const h=Math.min(c/a,it(i-e));n.arc(s,r,a+c/2,e-h/2,i+h/2,!0)}else{const h=Math.min(c/2,o*it(i-e));if(d==="round")n.arc(s,r,h,e-P/2,i+P/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(e+P/2)+s,p=-f*Math.sin(e+P/2)+r,m=f*Math.cos(i+P/2)+s,b=f*Math.sin(i+P/2)+r;n.lineTo(g,p),n.lineTo(m,b)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function zb(n,t,e){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=t;let c=s/a;n.beginPath(),n.arc(r,o,a,i-c,e+c),l>s?(c=s/l,n.arc(r,o,l,e+c,i-c,!0)):n.arc(r,o,s,e+X,i-X),n.closePath(),n.clip()}function jb(n){return vr(n,["outerStart","outerEnd","innerStart","innerEnd"])}function Vb(n,t,e,i){const s=jb(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=l=>{const c=(e-Math.min(r,l))*i/2;return Z(l,0,Math.min(r,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:Z(s.innerStart,0,o),innerEnd:Z(s.innerEnd,0,o)}}function Se(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function $i(n,t,e,i,s,r){const{x:o,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+e-c,0),h=d>0?d+i+e+c:0;let f=0;const g=s-l;if(i){const F=d>0?d-i:0,U=u>0?u-i:0,K=(F+U)/2,mt=K!==0?g*K/(K+i):g;f=(g-mt)/2}const p=Math.max(.001,g*u-e/P)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:v,outerEnd:_,innerStart:x,innerEnd:k}=Vb(t,h,u,y-b),S=u-v,E=u-_,I=b+v/S,A=y-_/E,C=h+x,O=h+k,Q=b+x/C,ut=y-k/O;if(n.beginPath(),r){const F=(I+A)/2;if(n.arc(o,a,u,I,F),n.arc(o,a,u,F,A),_>0){const et=Se(E,A,o,a);n.arc(et.x,et.y,_,A,y+X)}const U=Se(O,y,o,a);if(n.lineTo(U.x,U.y),k>0){const et=Se(O,ut,o,a);n.arc(et.x,et.y,k,y+X,ut+Math.PI)}const K=(y-k/h+(b+x/h))/2;if(n.arc(o,a,h,y-k/h,K,!0),n.arc(o,a,h,K,b+x/h,!0),x>0){const et=Se(C,Q,o,a);n.arc(et.x,et.y,x,Q+Math.PI,b-X)}const mt=Se(S,b,o,a);if(n.lineTo(mt.x,mt.y),v>0){const et=Se(S,I,o,a);n.arc(et.x,et.y,v,b-X,I)}}else{n.moveTo(o,a);const F=Math.cos(I)*u+o,U=Math.sin(I)*u+a;n.lineTo(F,U);const K=Math.cos(A)*u+o,mt=Math.sin(A)*u+a;n.lineTo(K,mt)}n.closePath()}function Ub(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){$i(n,t,e,i,l,s);for(let c=0;c<r;++c)n.fill();isNaN(a)||(l=o+(a%V||V))}return $i(n,t,e,i,l,s),n.fill(),l}function Wb(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;n.setLineDash(u||[]),n.lineDashOffset=h,g?(n.lineWidth=c*2,n.lineJoin=d||"round"):(n.lineWidth=c,n.lineJoin=d||"bevel");let p=t.endAngle;if(r){$i(n,t,e,i,p,s);for(let m=0;m<r;++m)n.stroke();isNaN(a)||(p=o+(a%V||V))}g&&zb(n,t,p),l.selfJoin&&p-o>=P&&f===0&&d!=="miter"&&Hb(n,t,p),r||($i(n,t,e,i,p,s),n.stroke())}class Je extends vt{constructor(e){super();w(this,"circumference");w(this,"endAngle");w(this,"fullCircles");w(this,"innerRadius");w(this,"outerRadius");w(this,"pixelMargin");w(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,e&&Object.assign(this,e)}inRange(e,i,s){const r=this.getProps(["x","y"],s),{angle:o,distance:a}=Wl(r,{x:e,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=M(h,c-l),p=_n(o,l,c)&&l!==c,m=g>=V||p,b=Pt(a,d+f,u+f);return m&&b}getCenterPoint(e){const{x:i,y:s,startAngle:r,endAngle:o,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],e),{offset:c,spacing:d}=this.options,u=(r+o)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(e){return this.getCenterPoint(e)}draw(e){const{options:i,circumference:s}=this,r=(i.offset||0)/4,o=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>V?Math.floor(s/V):0,s===0||this.innerRadius<0||this.outerRadius<0)return;e.save();const l=(this.startAngle+this.endAngle)/2;e.translate(Math.cos(l)*r,Math.sin(l)*r);const c=1-Math.sin(Math.min(P,s||0)),d=r*c;e.fillStyle=i.backgroundColor,e.strokeStyle=i.borderColor,Ub(e,this,d,o,a),Wb(e,this,d,o,a),e.restore()}}w(Je,"id","arc"),w(Je,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),w(Je,"defaultRoutes",{backgroundColor:"backgroundColor"}),w(Je,"descriptors",{_scriptable:!0,_indexable:e=>e!=="borderDash"});function Ec(n,t,e=t){n.lineCap=M(e.borderCapStyle,t.borderCapStyle),n.setLineDash(M(e.borderDash,t.borderDash)),n.lineDashOffset=M(e.borderDashOffset,t.borderDashOffset),n.lineJoin=M(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=M(e.borderWidth,t.borderWidth),n.strokeStyle=M(e.borderColor,t.borderColor)}function qb(n,t,e){n.lineTo(e.x,e.y)}function Yb(n){return n.stepped?pp:n.tension||n.cubicInterpolationMode==="monotone"?mp:qb}function Ic(n,t,e={}){const i=n.length,{start:s=0,end:r=i-1}=e,{start:o,end:a}=t,l=Math.max(s,o),c=Math.min(r,a),d=s<o&&r<o||s>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Gb(n,t,e,i){const{points:s,options:r}=t,{count:o,start:a,loop:l,ilen:c}=Ic(s,e,i),d=Yb(r);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%o],!g.skip&&(u?(n.moveTo(g.x,g.y),u=!1):d(n,p,g,h,r.stepped),p=g);return l&&(g=s[(a+(h?c:0))%o],d(n,p,g,h,r.stepped)),!!l}function Kb(n,t,e,i){const s=t.points,{count:r,start:o,ilen:a}=Ic(s,e,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=_=>(o+(c?a-_:_))%r,v=()=>{p!==m&&(n.lineTo(d,m),n.lineTo(d,p),n.lineTo(d,b))};for(l&&(f=s[y(0)],n.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const _=f.x,x=f.y,k=_|0;k===g?(x<p?p=x:x>m&&(m=x),d=(u*d+_)/++u):(v(),n.lineTo(_,x),g=k,u=0,p=m=x),b=x}v()}function qs(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?Kb:Gb}function Xb(n){return n.stepped?Gp:n.tension||n.cubicInterpolationMode==="monotone"?Kp:de}function Jb(n,t,e,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,e,i)&&s.closePath()),Ec(n,t.options),n.stroke(s)}function Zb(n,t,e,i){const{segments:s,options:r}=t,o=qs(t);for(const a of s)Ec(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const Qb=typeof Path2D=="function";function t0(n,t,e,i){Qb&&!t.options.segment?Jb(n,t,e,i):Zb(n,t,e,i)}class Kt extends vt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;Hp(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=em(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],r=this.points,o=uc(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],l=Xb(i);let c,d;for(c=0,d=o.length;c<d;++c){const{start:u,end:h}=o[c],f=r[u],g=r[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[e])/(g[e]-f[e])),m=l(f,g,p,i.stepped);m[e]=t[e],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,e,i){return qs(this)(t,this,e,i)}path(t,e,i){const s=this.segments,r=qs(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),t0(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}w(Kt,"id","line"),w(Kt,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),w(Kt,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),w(Kt,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function la(n,t,e,i){const s=n.options,{[e]:r}=n.getProps([e],i);return Math.abs(t-r)<s.radius+s.hitRadius}class _i extends vt{constructor(e){super();w(this,"parsed");w(this,"skip");w(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,i,s){const r=this.options,{x:o,y:a}=this.getProps(["x","y"],s);return Math.pow(e-o,2)+Math.pow(i-a,2)<Math.pow(r.hitRadius+r.radius,2)}inXRange(e,i){return la(this,e,"x",i)}inYRange(e,i){return la(this,e,"y",i)}getCenterPoint(e){const{x:i,y:s}=this.getProps(["x","y"],e);return{x:i,y:s}}size(e){e=e||this.options||{};let i=e.radius||0;i=Math.max(i,i&&e.hoverRadius||0);const s=i&&e.borderWidth||0;return(i+s)*2}draw(e,i){const s=this.options;this.skip||s.radius<.1||!Bt(this,i,this.size(s)/2)||(e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.fillStyle=s.backgroundColor,js(e,s,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}w(_i,"id","point"),w(_i,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),w(_i,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Mc(n,t){const{x:e,y:i,base:s,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return n.horizontal?(u=o/2,a=Math.min(e,s),l=Math.max(e,s),c=i-u,d=i+u):(u=r/2,a=e-u,l=e+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function Xt(n,t,e,i){return n?0:Z(t,e,i)}function e0(n,t,e){const i=n.options.borderWidth,s=n.borderSkipped,r=tc(i);return{t:Xt(s.top,r.top,0,e),r:Xt(s.right,r.right,0,t),b:Xt(s.bottom,r.bottom,0,e),l:Xt(s.left,r.left,0,t)}}function n0(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),s=n.options.borderRadius,r=ge(s),o=Math.min(t,e),a=n.borderSkipped,l=i||L(s);return{topLeft:Xt(!l||a.top||a.left,r.topLeft,0,o),topRight:Xt(!l||a.top||a.right,r.topRight,0,o),bottomLeft:Xt(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:Xt(!l||a.bottom||a.right,r.bottomRight,0,o)}}function i0(n){const t=Mc(n),e=t.right-t.left,i=t.bottom-t.top,s=e0(n,e/2,i/2),r=n0(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+s.l,y:t.top+s.t,w:e-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}function ks(n,t,e,i){const s=t===null,r=e===null,a=n&&!(s&&r)&&Mc(n,i);return a&&(s||Pt(t,a.left,a.right))&&(r||Pt(e,a.top,a.bottom))}function s0(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function r0(n,t){n.rect(t.x,t.y,t.w,t.h)}function ws(n,t,e={}){const i=n.x!==e.x?-t:0,s=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-i,o=(n.y+n.h!==e.y+e.h?t:0)-s;return{x:n.x+i,y:n.y+s,w:n.w+r,h:n.h+o,radius:n.radius}}class ki extends vt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:r,outer:o}=i0(this),a=s0(o.radius)?kn:r0;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,ws(o,e,r)),t.clip(),a(t,ws(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,ws(r,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return ks(this,t,e,i)}inXRange(t,e){return ks(this,t,null,e)}inYRange(t,e){return ks(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+s)/2:e,y:r?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}w(ki,"id","bar"),w(ki,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),w(ki,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var o0=Object.freeze({__proto__:null,ArcElement:Je,BarElement:ki,LineElement:Kt,PointElement:_i});const Ys=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],ca=Ys.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ac(n){return Ys[n%Ys.length]}function Tc(n){return ca[n%ca.length]}function a0(n,t){return n.borderColor=Ac(t),n.backgroundColor=Tc(t),++t}function l0(n,t){return n.backgroundColor=n.data.map(()=>Ac(t++)),t}function c0(n,t){return n.backgroundColor=n.data.map(()=>Tc(t++)),t}function d0(n){let t=0;return(e,i)=>{const s=n.getDatasetMeta(i).controller;s instanceof he?t=l0(e,t):s instanceof hn?t=c0(e,t):s&&(t=a0(e,t))}}function da(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function u0(n){return n&&(n.borderColor||n.backgroundColor)}function h0(){return q.borderColor!=="rgba(0,0,0,0.1)"||q.backgroundColor!=="rgba(0,0,0,0.1)"}var f0={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:s}=n.config,{elements:r}=s,o=da(i)||u0(s)||r&&da(r)||h0();if(!e.forceOverride&&o)return;const a=d0(n);i.forEach(a)}};function g0(n,t,e,i,s){const r=s.samples||i;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const c=t+e-1;let d=t,u,h,f,g,p;for(o[l++]=n[d],u=0;u<r-2;u++){let m=0,b=0,y;const v=Math.floor((u+1)*a)+1+t,_=Math.min(Math.floor((u+2)*a)+1,e)+t,x=_-v;for(y=v;y<_;y++)m+=n[y].x,b+=n[y].y;m/=x,b/=x;const k=Math.floor(u*a)+1+t,S=Math.min(Math.floor((u+1)*a)+1,e)+t,{x:E,y:I}=n[d];for(f=g=-1,y=k;y<S;y++)g=.5*Math.abs((E-m)*(n[y].y-I)-(E-n[y].x)*(b-I)),g>f&&(f=g,h=n[y],p=y);o[l++]=h,d=p}return o[l++]=n[c],o}function p0(n,t,e,i){let s=0,r=0,o,a,l,c,d,u,h,f,g,p;const m=[],b=t+e-1,y=n[t].x,_=n[b].x-y;for(o=t;o<t+e;++o){a=n[o],l=(a.x-y)/_*i,c=a.y;const x=l|0;if(x===d)c<g?(g=c,u=o):c>p&&(p=c,h=o),s=(r*s+a.x)/++r;else{const k=o-1;if(!D(u)&&!D(h)){const S=Math.min(u,h),E=Math.max(u,h);S!==f&&S!==k&&m.push({...n[S],x:s}),E!==f&&E!==k&&m.push({...n[E],x:s})}o>0&&k!==f&&m.push(n[k]),m.push(a),d=x,r=0,g=p=c,u=h=f=o}}return m}function Cc(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function ua(n){n.data.datasets.forEach(t=>{Cc(t)})}function m0(n,t){const e=t.length;let i=0,s;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:c}=r.getUserBounds();return l&&(i=Z(Rt(t,r.axis,o).lo,0,e-1)),c?s=Z(Rt(t,r.axis,a).hi+1,i,e)-i:s=e-i,{start:i,count:s}}var b0={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){ua(n);return}const i=n.width;n.data.datasets.forEach((s,r)=>{const{_data:o,indexAxis:a}=s,l=n.getDatasetMeta(r),c=o||s.data;if(Ke([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=n.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||n.options.parsing)return;let{start:u,count:h}=m0(l,c);const f=e.threshold||4*i;if(h<=f){Cc(s);return}D(o)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(e.algorithm){case"lttb":g=g0(c,u,h,i,e);break;case"min-max":g=p0(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}s._decimated=g})},destroy(n){ua(n)}};function y0(n,t,e){const i=n.segments,s=n.points,r=t.points,o=[];for(const a of i){let{start:l,end:c}=a;c=Ji(l,c,s);const d=Gs(e,s[l],s[c],a.loop);if(!t.segments){o.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=uc(t,d);for(const h of u){const f=Gs(e,r[h.start],r[h.end],h.loop),g=dc(a,s,f);for(const p of g)o.push({source:p,target:h,start:{[e]:ha(d,f,"start",Math.max)},end:{[e]:ha(d,f,"end",Math.min)}})}}return o}function Gs(n,t,e,i){if(i)return;let s=t[n],r=e[n];return n==="angle"&&(s=it(s),r=it(r)),{property:n,start:s,end:r}}function x0(n,t){const{x:e=null,y:i=null}=n||{},s=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Ji(o,a,s);const l=s[o],c=s[a];i!==null?(r.push({x:l.x,y:i}),r.push({x:c.x,y:i})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:c.y}))}),r}function Ji(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function ha(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function Dc(n,t){let e=[],i=!1;return W(n)?(i=!0,e=n):e=x0(n,t),e.length?new Kt({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function fa(n){return n&&n.fill!==!1}function v0(n,t,e){let s=n[t].fill;const r=[t];let o;if(!e)return s;for(;s!==!1&&r.indexOf(s)===-1;){if(!G(s))return s;if(o=n[s],!o)return!1;if(o.visible)return s;r.push(s),s=o.fill}return!1}function _0(n,t,e){const i=E0(n);if(L(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return G(s)&&Math.floor(s)===s?k0(i[0],t,s,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function k0(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function w0(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:L(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function S0(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:L(n)?i=n.value:i=t.getBaseValue(),i}function E0(n){const t=n.options,e=t.fill;let i=M(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function I0(n){const{scale:t,index:e,line:i}=n,s=[],r=i.segments,o=i.points,a=M0(t,e);a.push(Dc({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const c=r[l];for(let d=c.start;d<=c.end;d++)A0(s,o[d],a)}return new Kt({points:s,options:{}})}function M0(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const r=i[s];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function A0(n,t,e){const i=[];for(let s=0;s<e.length;s++){const r=e[s],{first:o,last:a,point:l}=T0(r,t,"x");if(!(!l||o&&a)){if(o)i.unshift(l);else if(n.push(l),!a)break}}n.push(...i)}function T0(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const s=i[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let c=0;c<r.length;c++){const d=r[c],u=o[d.start][e],h=o[d.end][e];if(Pt(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Lc{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:r,radius:o}=this;return e=e||{start:0,end:V},t.arc(s,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,r=t.angle;return{x:e+Math.cos(r)*s,y:i+Math.sin(r)*s,angle:r}}}function C0(n){const{chart:t,fill:e,line:i}=n;if(G(e))return D0(t,e);if(e==="stack")return I0(n);if(e==="shape")return!0;const s=L0(n);return s instanceof Lc?s:Dc(s,i)}function D0(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function L0(n){return(n.scale||{}).getPointPositionForValue?P0(n):O0(n)}function O0(n){const{scale:t={},fill:e}=n,i=w0(e,t);if(G(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function P0(n){const{scale:t,fill:e}=n,i=t.options,s=t.getLabels().length,r=i.reverse?t.max:t.min,o=S0(e,t,r),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,r);return new Lc({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,o));return a}function Ss(n,t,e){const i=C0(t),{chart:s,index:r,line:o,scale:a,axis:l}=t,c=o.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(r),p=hc(s,g);i&&o.points.length&&(Yi(n,e),R0(n,{line:o,target:i,above:h,below:f,area:e,scale:a,axis:l,clip:p}),Gi(n))}function R0(n,t){const{line:e,target:i,above:s,below:r,area:o,scale:a,clip:l}=t,c=e._loop?"angle":t.axis;n.save();let d=r;r!==s&&(c==="x"?(ga(n,i,o.top),Es(n,{line:e,target:i,color:s,scale:a,property:c,clip:l}),n.restore(),n.save(),ga(n,i,o.bottom)):c==="y"&&(pa(n,i,o.left),Es(n,{line:e,target:i,color:r,scale:a,property:c,clip:l}),n.restore(),n.save(),pa(n,i,o.right),d=s)),Es(n,{line:e,target:i,color:d,scale:a,property:c,clip:l}),n.restore()}function ga(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Ji(l,c,s)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(d.x,e),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(u.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function pa(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Ji(l,c,s)];r?(n.moveTo(d.x,d.y),r=!1):(n.lineTo(e,d.y),n.lineTo(d.x,d.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,u.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function Es(n,t){const{line:e,target:i,property:s,color:r,scale:o,clip:a}=t,l=y0(e,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=r}={}}=c,g=i!==!0;n.save(),n.fillStyle=f,B0(n,o,a,g&&Gs(s,u,h)),n.beginPath();const p=!!e.pathSegment(n,c);let m;if(g){p?n.closePath():ma(n,i,h,s);const b=!!i.pathSegment(n,d,{move:p,reverse:!0});m=p&&b,m||ma(n,i,u,s)}n.closePath(),n.fill(m?"evenodd":"nonzero"),n.restore()}}function B0(n,t,e,i){const s=t.chart.chartArea,{property:r,start:o,end:a}=i||{};if(r==="x"||r==="y"){let l,c,d,u;r==="x"?(l=o,c=s.top,d=a,u=s.bottom):(l=s.left,c=o,d=s.right,u=a),n.beginPath(),e&&(l=Math.max(l,e.left),d=Math.min(d,e.right),c=Math.max(c,e.top),u=Math.min(u,e.bottom)),n.rect(l,c,d-l,u-c),n.clip()}}function ma(n,t,e,i){const s=t.interpolate(e,i);s&&n.lineTo(s.x,s.y)}var N0={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,s=[];let r,o,a,l;for(o=0;o<i;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof Kt&&(l={visible:n.isDatasetVisible(o),index:o,fill:_0(a,o,i),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,s.push(l);for(o=0;o<i;++o)l=s[o],!(!l||l.fill===!1)&&(l.fill=v0(s,o,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",s=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=s.length-1;o>=0;--o){const a=s[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&Ss(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const r=i[s].$filler;fa(r)&&Ss(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!fa(i)||e.drawTime!=="beforeDatasetDraw"||Ss(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const ba=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},F0=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class ya extends vt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=z(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=J(i.font),r=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=ba(i,r);let c,d;e.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(o,r,a,l)+10):(d=this.maxHeight,c=this._fitCols(o,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;r.textAlign="left",r.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+e/2+r.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>o)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,e,i,s){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=o-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:v}=$0(i,e,r,m,s);b>0&&f+v+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:v},h=Math.max(h,y),f+=v+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:r}}=this,o=Te(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=nt(i,this.left+s,this.right-this.lineWidths[a]);for(const c of e)a!==c.row&&(a=c.row,l=nt(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=o.leftForLtr(o.x(l),c.width),l+=c.width+s}else{let a=0,l=nt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of e)c.col!==a&&(a=c.col,l=nt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=o.leftForLtr(o.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Yi(t,this),this._draw(),Gi(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:r,labels:o}=t,a=q.color,l=Te(t.rtl,this.left,this.width),c=J(o.font),{padding:d}=o,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=ba(o,u),b=function(k,S,E){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const I=M(E.lineWidth,1);if(s.fillStyle=M(E.fillStyle,a),s.lineCap=M(E.lineCap,"butt"),s.lineDashOffset=M(E.lineDashOffset,0),s.lineJoin=M(E.lineJoin,"miter"),s.lineWidth=I,s.strokeStyle=M(E.strokeStyle,a),s.setLineDash(M(E.lineDash,[])),o.usePointStyle){const A={radius:p*Math.SQRT2/2,pointStyle:E.pointStyle,rotation:E.rotation,borderWidth:I},C=l.xPlus(k,g/2),O=S+h;Ql(s,A,C,O,o.pointStyleWidth&&g)}else{const A=S+Math.max((u-p)/2,0),C=l.leftForLtr(k,g),O=ge(E.borderRadius);s.beginPath(),Object.values(O).some(Q=>Q!==0)?kn(s,{x:C,y:A,w:g,h:p,radius:O}):s.rect(C,A,g,p),s.fill(),I!==0&&s.stroke()}s.restore()},y=function(k,S,E){be(s,E.text,k,S+m/2,c,{strikethrough:E.hidden,textAlign:l.textAlign(E.textAlign)})},v=this.isHorizontal(),_=this._computeTitleHeight();v?f={x:nt(r,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:f={x:this.left+d,y:nt(r,this.top+_+d,this.bottom-e[0].height),line:0},ac(this.ctx,t.textDirection);const x=m+d;this.legendItems.forEach((k,S)=>{s.strokeStyle=k.fontColor,s.fillStyle=k.fontColor;const E=s.measureText(k.text).width,I=l.textAlign(k.textAlign||(k.textAlign=o.textAlign)),A=g+h+E;let C=f.x,O=f.y;l.setWidth(this.width),v?S>0&&C+A+d>this.right&&(O=f.y+=x,f.line++,C=f.x=nt(r,this.left+d,this.right-i[f.line])):S>0&&O+x>this.bottom&&(C=f.x=C+e[f.line].width+d,f.line++,O=f.y=nt(r,this.top+_+d,this.bottom-e[f.line].height));const Q=l.x(C);if(b(Q,O,k),C=sp(I,C+g+h,v?C+A:this.right,t.rtl),y(l.x(C),O,k),v)f.x+=A+d;else if(typeof k.text!="string"){const ut=c.lineHeight;f.y+=Oc(k,ut)+d}else f.y+=x}),lc(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=J(e.font),s=rt(e.padding);if(!e.display)return;const r=Te(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=nt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+nt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=nt(a,u,u+h);o.textAlign=r.textAlign(yr(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,be(o,e.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,e=J(t.font),i=rt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,r;if(Pt(t,this.left,this.right)&&Pt(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(s=r[i],Pt(t,s.left,s.left+s.width)&&Pt(e,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!j0(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,r=F0(s,i);s&&!r&&z(e.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!r&&z(e.onHover,[t,i,this],this)}else i&&z(e.onClick,[t,i,this],this)}}function $0(n,t,e,i,s){const r=H0(i,n,t,e),o=z0(s,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function H0(n,t,e,i){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(s).width}function z0(n,t,e){let i=n;return typeof t.text!="string"&&(i=Oc(t,e)),i}function Oc(n,t){const e=n.text?n.text.length:0;return t*e}function j0(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var V0={id:"legend",_element:ya,start(n,t,e){const i=n.legend=new ya({ctx:n.ctx,options:e,chart:n});st.configure(n,i,e),st.addBox(n,i)},stop(n){st.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;st.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,s=e.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(e?0:void 0),d=rt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:o&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Mr extends vt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const s=W(i.text)?i.text.length:1;this._padding=rt(i.padding);const r=s*J(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:s,right:r,options:o}=this,a=o.align;let l=0,c,d,u;return this.isHorizontal()?(d=nt(a,i,r),u=e+t,c=r-i):(o.position==="left"?(d=i+t,u=nt(a,s,e),l=P*-.5):(d=r-t,u=nt(a,e,s),l=P*.5),c=s-e),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=J(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(r);be(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:c,textAlign:yr(e.align),textBaseline:"middle",translation:[o,a]})}}function U0(n,t){const e=new Mr({ctx:n.ctx,options:t,chart:n});st.configure(n,e,t),st.addBox(n,e),n.titleBlock=e}var W0={id:"title",_element:Mr,start(n,t,e){U0(n,e)},stop(n){const t=n.titleBlock;st.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;st.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ii=new WeakMap;var q0={id:"subtitle",start(n,t,e){const i=new Mr({ctx:n.ctx,options:e,chart:n});st.configure(n,i,e),st.addBox(n,i),ii.set(n,i)},stop(n){st.removeBox(n,ii.get(n)),ii.delete(n)},beforeUpdate(n,t,e){const i=ii.get(n);st.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ze={average(n){if(!n.length)return!1;let t,e,i=new Set,s=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,s=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=Hs(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function _t(n,t){return t&&(W(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Ct(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function Y0(n,t){const{element:e,datasetIndex:i,index:s}=t,r=n.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:n,label:o,parsed:r.getParsed(s),raw:n.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:e}}function xa(n,t){const e=n.chart.ctx,{body:i,footer:s,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=J(t.bodyFont),c=J(t.titleFont),d=J(t.footerFont),u=r.length,h=s.length,f=i.length,g=rt(t.padding);let p=g.height,m=0,b=i.reduce((_,x)=>_+x.before.length+x.lines.length+x.after.length,0);if(b+=n.beforeBody.length+n.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*_+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(_){m=Math.max(m,e.measureText(_).width+y)};return e.save(),e.font=c.string,N(n.title,v),e.font=l.string,N(n.beforeBody.concat(n.afterBody),v),y=t.displayColors?o+2+t.boxPadding:0,N(i,_=>{N(_.before,v),N(_.lines,v),N(_.after,v)}),y=0,e.font=d.string,N(n.footer,v),e.restore(),m+=g.width,{width:m,height:p}}function G0(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function K0(n,t,e,i){const{x:s,width:r}=i,o=e.caretSize+e.caretPadding;if(n==="left"&&s+r+o>t.width||n==="right"&&s-r-o<0)return!0}function X0(n,t,e,i){const{x:s,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=r/2?c="left":s>=o-r/2&&(c="right"),K0(c,n,t,e)&&(c="center"),c}function va(n,t,e){const i=e.yAlign||t.yAlign||G0(n,e);return{xAlign:e.xAlign||t.xAlign||X0(n,t,e,i),yAlign:i}}function J0(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function Z0(n,t,e){let{y:i,height:s}=n;return t==="top"?i+=e:t==="bottom"?i-=s+e:i-=s/2,i}function _a(n,t,e,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,c=s+r,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=ge(o);let g=J0(t,a);const p=Z0(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:Z(g,0,i.width-t.width),y:Z(p,0,i.height-t.height)}}function si(n,t,e){const i=rt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function ka(n){return _t([],Ct(n))}function Q0(n,t,e){return ee(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function wa(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const Pc={beforeTitle:At,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:At,beforeBody:At,beforeLabel:At,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return D(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:At,afterBody:At,beforeFooter:At,footer:At,afterFooter:At};function ot(n,t,e,i){const s=n[t].call(e,i);return typeof s>"u"?Pc[t].call(e,i):s}class Ks extends vt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,r=new fc(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=Q0(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,s=ot(i,"beforeTitle",this,t),r=ot(i,"title",this,t),o=ot(i,"afterTitle",this,t);let a=[];return a=_t(a,Ct(s)),a=_t(a,Ct(r)),a=_t(a,Ct(o)),a}getBeforeBody(t,e){return ka(ot(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return N(t,r=>{const o={before:[],lines:[],after:[]},a=wa(i,r);_t(o.before,Ct(ot(a,"beforeLabel",this,r))),_t(o.lines,ot(a,"label",this,r)),_t(o.after,Ct(ot(a,"afterLabel",this,r))),s.push(o)}),s}getAfterBody(t,e){return ka(ot(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=ot(i,"beforeFooter",this,t),r=ot(i,"footer",this,t),o=ot(i,"afterFooter",this,t);let a=[];return a=_t(a,Ct(s)),a=_t(a,Ct(r)),a=_t(a,Ct(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],r=[],o=[];let a=[],l,c;for(l=0,c=e.length;l<c;++l)a.push(Y0(this.chart,e[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),N(a,d=>{const u=wa(t.callbacks,d);s.push(ot(u,"labelColor",this,d)),r.push(ot(u,"labelPointStyle",this,d)),o.push(ot(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let r,o=[];if(!s.length)this.opacity!==0&&(r={opacity:0});else{const a=Ze[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=xa(this,i),c=Object.assign({},a,l),d=va(this.chart,i,c),u=_a(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,r={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const r=this.getCaretPosition(t,i,s);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=ge(a),{x:h,y:f}=t,{width:g,height:p}=e;let m,b,y,v,_,x;return r==="center"?(_=f+p/2,s==="left"?(m=h,b=m-o,v=_+o,x=_-o):(m=h+g,b=m+o,v=_-o,x=_+o),y=m):(s==="left"?b=h+Math.max(l,d)+o:s==="right"?b=h+g-Math.max(c,u)-o:b=this.caretX,r==="top"?(v=f,_=v-o,m=b-o,y=b+o):(v=f+p,_=v+o,m=b+o,y=b-o),x=v),{x1:m,x2:b,x3:y,y1:v,y2:_,y3:x}}drawTitle(t,e,i){const s=this.title,r=s.length;let o,a,l;if(r){const c=Te(i.rtl,this.x,this.width);for(t.x=si(this,i.titleAlign,i),e.textAlign=c.textAlign(i.titleAlign),e.textBaseline="middle",o=J(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(s[l],c.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=r,d=J(r.bodyFont),u=si(this,"left",r),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=e.y+f;if(r.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,js(t,p,m,b),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,js(t,p,m,b)}else{t.lineWidth=L(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=ge(o.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,kn(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),kn(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=o.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=J(i.bodyFont);let h=u.lineHeight,f=0;const g=Te(i.rtl,this.x,this.width),p=function(E){e.fillText(E,g.x(t.x+f),t.y+h/2),t.y+=h+r},m=g.textAlign(o);let b,y,v,_,x,k,S;for(e.textAlign=o,e.textBaseline="middle",e.font=u.string,t.x=si(this,m,i),e.fillStyle=i.bodyColor,N(this.beforeBody,p),f=a&&m!=="right"?o==="center"?c/2+d:c+2+d:0,_=0,k=s.length;_<k;++_){for(b=s[_],y=this.labelTextColors[_],e.fillStyle=y,N(b.before,p),v=b.lines,a&&v.length&&(this._drawColorBox(e,t,_,g,i),h=Math.max(u.lineHeight,l)),x=0,S=v.length;x<S;++x)p(v[x]),h=u.lineHeight;N(b.after,p)}f=0,h=u.lineHeight,N(this.afterBody,p),t.y-=r}drawFooter(t,e,i){const s=this.footer,r=s.length;let o,a;if(r){const l=Te(i.rtl,this.x,this.width);for(t.x=si(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=J(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(s[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=ge(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+u,l),o==="top"&&this.drawCaret(t,e,i,s),e.lineTo(a+c-h,l),e.quadraticCurveTo(a+c,l,a+c,l+h),o==="center"&&r==="right"&&this.drawCaret(t,e,i,s),e.lineTo(a+c,l+d-g),e.quadraticCurveTo(a+c,l+d,a+c-g,l+d),o==="bottom"&&this.drawCaret(t,e,i,s),e.lineTo(a+f,l+d),e.quadraticCurveTo(a,l+d,a,l+d-f),o==="center"&&r==="left"&&this.drawCaret(t,e,i,s),e.lineTo(a,l+u),e.quadraticCurveTo(a,l,a+u,l),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,r=i&&i.y;if(s||r){const o=Ze[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=xa(this,t),l=Object.assign({},o,this._size),c=va(e,t,l),d=_a(t,l,c,e);(s._to!==d.x||r._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=rt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,s,e),ac(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),lc(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),r=!Oi(i,s),o=this._positionChanged(s,e);(r||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),l=e||!Oi(o,r)||a;return l&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,s){const r=this.options;if(t.type==="mouseout")return[];if(!s)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:r}=this,o=Ze[r.position].call(this,t,e);return o!==!1&&(i!==o.x||s!==o.y)}}w(Ks,"positioners",Ze);var ty={id:"tooltip",_element:Ks,positioners:Ze,afterInit(n,t,e){e&&(n.tooltip=new Ks({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Pc},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},ey=Object.freeze({__proto__:null,Colors:f0,Decimation:b0,Filler:N0,Legend:V0,SubTitle:q0,Title:W0,Tooltip:ty});const ny=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function iy(n,t,e,i){const s=n.indexOf(t);if(s===-1)return ny(n,t,e,i);const r=n.lastIndexOf(t);return s!==r?e:s}const sy=(n,t)=>n===null?null:Z(Math.round(n),0,t);function Sa(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class Xs extends ve{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:s,label:r}of e)i[s]===r&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(D(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:iy(i,t,M(e,t),this._addedLabels),sy(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)s.push({value:o});return s}getLabelForValue(t){return Sa.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}w(Xs,"id","category"),w(Xs,"defaults",{ticks:{callback:Sa}});function ry(n,t){const e=[],{bounds:s,step:r,min:o,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=n,f=r||1,g=d-1,{min:p,max:m}=t,b=!D(o),y=!D(a),v=!D(c),_=(m-p)/(u+1);let x=xo((m-p)/g/f)*f,k,S,E,I;if(x<1e-14&&!b&&!y)return[{value:p},{value:m}];I=Math.ceil(m/x)-Math.floor(p/x),I>g&&(x=xo(I*x/g/f)*f),D(l)||(k=Math.pow(10,l),x=Math.ceil(x*k)/k),s==="ticks"?(S=Math.floor(p/x)*x,E=Math.ceil(m/x)*x):(S=p,E=m),b&&y&&r&&Jg((a-o)/r,x/1e3)?(I=Math.round(Math.min((a-o)/x,d)),x=(a-o)/I,S=o,E=a):v?(S=b?o:S,E=y?a:E,I=c-1,x=(E-S)/I):(I=(E-S)/x,cn(I,Math.round(I),x/1e3)?I=Math.round(I):I=Math.ceil(I));const A=Math.max(vo(x),vo(S));k=Math.pow(10,D(l)?A:l),S=Math.round(S*k)/k,E=Math.round(E*k)/k;let C=0;for(b&&(h&&S!==o?(e.push({value:o}),S<o&&C++,cn(Math.round((S+C*x)*k)/k,o,Ea(o,_,n))&&C++):S<o&&C++);C<I;++C){const O=Math.round((S+C*x)*k)/k;if(y&&O>a)break;e.push({value:O})}return y&&h&&E!==a?e.length&&cn(e[e.length-1].value,a,Ea(a,_,n))?e[e.length-1].value=a:e.push({value:a}):(!y||E===a)&&e.push({value:E}),e}function Ea(n,t,{horizontal:e,minRotation:i}){const s=yt(i),r=(e?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class Hi extends ve{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return D(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:r}=this;const o=l=>s=e?s:l,a=l=>r=i?r:l;if(t){const l=Et(s),c=Et(r);l<0&&c<0?a(0):l>0&&c>0&&o(0)}if(s===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(s-l)}this.min=s,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),e=e||11),e&&(s=Math.min(e,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=ry(s,r);return t.bounds==="ticks"&&Ul(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return Bn(t,this.chart.options.locale,this.options.ticks.format)}}class Js extends Hi{determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=G(t)?t:0,this.max=G(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=yt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}w(Js,"id","linear"),w(Js,"defaults",{ticks:{callback:qi.formatters.numeric}});const Sn=n=>Math.floor(Yt(n)),le=(n,t)=>Math.pow(10,Sn(n)+t);function Ia(n){return n/Math.pow(10,Sn(n))===1}function Ma(n,t,e){const i=Math.pow(10,e),s=Math.floor(n/i);return Math.ceil(t/i)-s}function oy(n,t){const e=t-n;let i=Sn(e);for(;Ma(n,t,i)>10;)i++;for(;Ma(n,t,i)<10;)i--;return Math.min(i,Sn(n))}function ay(n,{min:t,max:e}){t=ht(n.min,t);const i=[],s=Sn(t);let r=oy(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=s>r?Math.pow(10,s):0,c=Math.round((t-l)*o)/o,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,r)),h=ht(n.min,Math.round((l+d+u*Math.pow(10,r))*o)/o);for(;h<e;)i.push({value:h,major:Ia(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(r++,u=2,o=r>=0?1:o),h=Math.round((l+d+u*Math.pow(10,r))*o)/o;const f=ht(n.max,h);return i.push({value:f,major:Ia(f),significand:u}),i}class Zs extends ve{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=Hi.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return G(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=G(t)?Math.max(0,t):null,this.max=G(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!G(this._userMin)&&(this.min=t===le(this.min,0)?le(this.min,-1):le(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const r=a=>i=t?i:a,o=a=>s=e?s:a;i===s&&(i<=0?(r(1),o(10)):(r(le(i,-1)),o(le(s,1)))),i<=0&&r(le(s,-1)),s<=0&&o(le(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=ay(e,this);return t.bounds==="ticks"&&Ul(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Bn(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Yt(t),this._valueRange=Yt(this.max)-Yt(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Yt(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}w(Zs,"id","logarithmic"),w(Zs,"defaults",{ticks:{callback:qi.formatters.logarithmic,major:{enabled:!0}}});function Qs(n){const t=n.ticks;if(t.display&&n.display){const e=rt(t.backdropPadding);return M(t.font&&t.font.size,q.font.size)+e.height}return 0}function ly(n,t,e){return e=W(e)?e:[e],{w:gp(n,t.string,e),h:e.length*t.lineHeight}}function Aa(n,t,e,i,s){return n===i||n===s?{start:t-e/2,end:t+e/2}:n<i||n>s?{start:t-e,end:t}:{start:t,end:t+e}}function cy(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],s=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?P/r:0;for(let l=0;l<r;l++){const c=o.setContext(n.getPointLabelContext(l));s[l]=c.padding;const d=n.getPointPosition(l,n.drawingArea+s[l],a),u=J(c.font),h=ly(n.ctx,u,n._pointLabels[l]);i[l]=h;const f=it(n.getIndexAngle(l)+a),g=Math.round(mr(f)),p=Aa(g,d.x,h.w,0,180),m=Aa(g,d.y,h.h,90,270);dy(e,t,f,p,m)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=fy(n,i,s)}function dy(n,t,e,i,s){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,n.l=Math.min(n.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/o,n.t=Math.min(n.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function uy(n,t,e){const i=n.drawingArea,{extra:s,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,i+s+o,r),c=Math.round(mr(it(l.angle+X))),d=my(l.y,a.h,c),u=gy(c),h=py(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function hy(n,t){if(!t)return!0;const{left:e,top:i,right:s,bottom:r}=n;return!(Bt({x:e,y:i},t)||Bt({x:e,y:r},t)||Bt({x:s,y:i},t)||Bt({x:s,y:r},t))}function fy(n,t,e){const i=[],s=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:Qs(r)/2,additionalAngle:o?P/s:0};let c;for(let d=0;d<s;d++){l.padding=e[d],l.size=t[d];const u=uy(n,d,l);i.push(u),a==="auto"&&(u.visible=hy(u,c),u.visible&&(c=u))}return i}function gy(n){return n===0||n===180?"center":n<180?"left":"right"}function py(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function my(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function by(n,t,e){const{left:i,top:s,right:r,bottom:o}=e,{backdropColor:a}=t;if(!D(a)){const l=ge(t.borderRadius),c=rt(t.backdropPadding);n.fillStyle=a;const d=i-c.left,u=s-c.top,h=r-i+c.width,f=o-s+c.height;Object.values(l).some(g=>g!==0)?(n.beginPath(),kn(n,{x:d,y:u,w:h,h:f,radius:l}),n.fill()):n.fillRect(d,u,h,f)}}function yy(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let s=t-1;s>=0;s--){const r=n._pointLabelItems[s];if(!r.visible)continue;const o=i.setContext(n.getPointLabelContext(s));by(e,o,r);const a=J(o.font),{x:l,y:c,textAlign:d}=r;be(e,n._pointLabels[s],l,c+a.lineHeight/2,a,{color:o.color,textAlign:d,textBaseline:"middle"})}}function Rc(n,t,e,i){const{ctx:s}=n;if(e)s.arc(n.xCenter,n.yCenter,t,0,V);else{let r=n.getPointPosition(0,t);s.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=n.getPointPosition(o,t),s.lineTo(r.x,r.y)}}function xy(n,t,e,i,s){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(s.dash||[]),r.lineDashOffset=s.dashOffset,r.beginPath(),Rc(n,e,o,i),r.closePath(),r.stroke(),r.restore())}function vy(n,t,e){return ee(n,{label:e,index:t,type:"pointLabel"})}class Qe extends Hi{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=rt(Qs(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=G(t)&&!isNaN(t)?t:0,this.max=G(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Qs(this.options))}generateTickLabels(t){Hi.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const s=z(this.options.pointLabels.callback,[e,i],this);return s||s===0?s:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?cy(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){const e=V/(this._pointLabels.length||1),i=this.options.startAngle||0;return it(t*e+yt(i))}getDistanceFromCenterForValue(t){if(D(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(D(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return vy(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-X+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Rc(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s,border:r}=e,o=this._pointLabels.length;let a,l,c;if(e.pointLabels.display&&yy(this,o),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=r.setContext(h);xy(this,f,l,o,g)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const c=i.setContext(this.getContext(l)),d=J(c.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,o=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=rt(c.backdropPadding);t.fillRect(-o/2-u.left,-r-d.size/2-u.top,o+u.width,d.size+u.height)}be(t,a.label,0,-r,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}w(Qe,"id","radialLinear"),w(Qe,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:qi.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),w(Qe,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),w(Qe,"descriptors",{angleLines:{_fallback:"grid"}});const Zi={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},ct=Object.keys(Zi);function Ta(n,t){return n-t}function Ca(n,t){if(D(t))return null;const e=n._adapter,{parser:i,round:s,isoWeekday:r}=n._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),G(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(s&&(o=s==="week"&&(Ce(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,s)),+o)}function Da(n,t,e,i){const s=ct.length;for(let r=ct.indexOf(n);r<s-1;++r){const o=Zi[ct[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return ct[r]}return ct[s-1]}function _y(n,t,e,i,s){for(let r=ct.length-1;r>=ct.indexOf(e);r--){const o=ct[r];if(Zi[o].common&&n._adapter.diff(s,i,o)>=t-1)return o}return ct[e?ct.indexOf(e):0]}function ky(n){for(let t=ct.indexOf(n)+1,e=ct.length;t<e;++t)if(Zi[ct[t]].common)return ct[t]}function La(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:s}=br(e,t),r=e[i]>=t?e[i]:e[s];n[r]=!0}}function wy(n,t,e,i){const s=n._adapter,r=+s.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,i))l=e[a],l>=0&&(t[l].major=!0);return t}function Oa(n,t,e){const i=[],s={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],s[a]=o,i.push({value:a,major:!1});return r===0||!e?i:wy(n,i,s,e)}class En extends ve{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new Dm._date(t.adapters.date);s.init(e),ln(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:Ca(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(c){!o&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(r=Math.max(r,c.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=G(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),r=G(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,r-1),this.max=Math.max(s+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const r=this.min,o=this.max,a=ep(s,r,o);return this._unit=e.unit||(i.autoSkip?Da(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):_y(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:ky(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Oa(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,s,r;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?e=1-s:e=(this.getDecimalForValue(t[1])-s)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Z(e,0,o),i=Z(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,r=s.time,o=r.unit||Da(r.minUnit,e,i,this._getLabelCapacity(e)),a=M(s.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,c=Ce(l)||l===!0,d={};let u=e,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,o),f++)La(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&La(d,h,g),Object.keys(d).sort(Ta).map(p=>+p)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,r=this._unit,o=e||s[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,s){const r=this.options,o=r.ticks.callback;if(o)return z(o,[t,e,i],this);const a=r.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[e],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=yt(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,Oa(this,[t],this._majorUnit),s),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(e=0,i=s.length;e<i;++e)t=t.concat(s[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(Ca(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Yl(t.sort(Ta))}}w(En,"id","time"),w(En,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function ri(n,t,e){let i=0,s=n.length-1,r,o,a,l;e?(t>=n[i].pos&&t<=n[s].pos&&({lo:i,hi:s}=Rt(n,"pos",t)),{pos:r,time:a}=n[i],{pos:o,time:l}=n[s]):(t>=n[i].time&&t<=n[s].time&&({lo:i,hi:s}=Rt(n,"time",t)),{time:r,pos:a}=n[i],{time:o,pos:l}=n[s]);const c=o-r;return c?a+(l-a)*(t-r)/c:a}class tr extends En{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=ri(e,this.min),this._tableRange=ri(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],r=[];let o,a,l,c,d;for(o=0,a=t.length;o<a;++o)c=t[o],c>=e&&c<=i&&s.push(c);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)d=s[o+1],l=s[o-1],c=s[o],Math.round((d+l)/2)!==c&&r.push({time:c,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((s,r)=>s-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(ri(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return ri(this._table,i*this._tableRange+this._minPos,!0)}}w(tr,"id","timeseries"),w(tr,"defaults",En.defaults);var Sy=Object.freeze({__proto__:null,CategoryScale:Xs,LinearScale:Js,LogarithmicScale:Zs,RadialLinearScale:Qe,TimeScale:En,TimeSeriesScale:tr});const Ey=[Cm,o0,ey,Sy];Lt.register(...Ey);function Qi(n,t=""){return`
        <div class="bg-white/70 dark:bg-gray-900/60 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-800/30 ${t}">
            ${n}
        </div>
    `}const Nt={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function In(n){if(!n)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return n.replace(/[&<>"']/g,e=>t[e])}function Iy(n,t,e,i){return Qi(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${In(n)}</span>
        <span id="${e}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${In(t)}</span>
    `,Nt.CLASSES.KPI_CARD)}function Bc(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${Nt.KPI_ITEMS.map(n=>Iy(n.label,"-",n.id,n.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${Nt.CHARTS.map(n=>Qi(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${n.dot}"></span> ${In(n.label)}
                    </h3>
                    <div class="${Nt.CLASSES.CHART_CONTAINER}">
                        <canvas id="${n.id}Chart"></canvas>
                    </div>
                `,`${Nt.CLASSES.CHART_CARD} ${n.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function My(n=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(n)?n:[]).map(s=>`<option value="${In(s.id)}">${In(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${Qi(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function Ay(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function Ty(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Pa=new WeakMap;function Cy(n){const t=document.getElementById("dashboard-view");if(!n||!t)return;t.innerHTML=Bc();const e=n.filter(s=>s.status==="completed"&&s.completedAt);Dy(e),[{id:"daily",color:Nt.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:Nt.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:Nt.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:r,data:o}=Ly(e,s.count,s.unit);Oy(s.id,r,o,s.color)})}function Dy(n){const t=new Date,e=Re(t).getTime(),i=vl(t).getTime(),s=Bh(t).getTime(),r=n.reduce((o,a)=>{const l=Ht(a.completedAt);if(!l)return o;const c=l.getTime();return c>=e&&o.today++,c>=i&&o.weekly++,c>=s&&o.monthly++,o},{today:0,weekly:0,monthly:0,total:n.length});Object.entries(r).forEach(([o,a])=>{const l=document.getElementById(`${o}-count`);l&&(l.textContent=a)})}function Ly(n,t,e){const i=[],s=[],r=new Date;for(let o=0;o<t;o++){let a,l,c;const d=new Date(r);e==="day"?(d.setDate(r.getDate()-(t-1-o)),a=Re(d),l=Rh(d),c=`${a.getMonth()+1}/${a.getDate()}`):e==="week"?(d.setDate(r.getDate()-(t-1-o)*7),a=vl(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(r.getFullYear(),r.getMonth()-(t-1-o),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=n.filter(h=>{const f=Ht(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function Oy(n,t,e,i){const s=document.getElementById(`${n}Chart`);if(!s)return;let r=Pa.get(s);r?(r.data.labels=t,r.data.datasets[0].data=e,r.update()):(r=new Lt(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:e,backgroundColor:i,borderRadius:4}]},options:Nt.CHART_DEFAULTS}),Pa.set(s,r))}function Py(n,t,e){var r;(r=document.getElementById("task-context-menu"))==null||r.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-50 animate-fade-in text-sm min-w-[150px]",i.style.left=`${t}px`,i.style.top=`${e}px`,i.innerHTML=`
        <button id="ctx-delete-task-btn" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,document.body.appendChild(i),i.querySelector("#ctx-delete-task-btn").addEventListener("click",()=>{i.remove(),T("削除しますか？",async()=>await wl(n.id))});const s=o=>{i.contains(o.target)||(i.remove(),document.removeEventListener("click",s))};setTimeout(()=>document.addEventListener("click",s),0)}function Ry(n){const t=document.createElement("li");t.setAttribute("data-id",n.id),t.setAttribute("draggable","true");const e=n.status==="completed",i=Nh(n.dueDate),s=Fh(n.dueDate),r=!!n.recurrence,o=!!n.dueDate&&!r,a=St(),l=n.timeBlockId?a.find(c=>c.id===n.timeBlockId):null;return t.className=`group flex items-start gap-2 sm:gap-3 py-2 px-2 rounded -mx-2 transition-all duration-200 cursor-default border border-transparent ${e?"opacity-60 bg-gray-50 dark:bg-gray-900/50":"hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700"}`,t.innerHTML=`
        <div class="task-drag-handle mt-1 text-gray-300 dark:text-gray-600 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing hidden sm:block mr-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
        </div>

        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 cursor-pointer ${e?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500"}">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center">
            <div class="col-span-1 sm:col-span-7 flex flex-col justify-center">
                <div class="leading-snug truncate font-medium transition-colors ${e?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"}">${n.title}</div>
                ${n.description?`<div class="text-xs text-gray-400 truncate mt-0.5 font-light">${n.description}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-5 flex items-center sm:justify-end space-x-2 text-xs h-full mt-1 sm:mt-0 overflow-hidden">
                ${r?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${o?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${l?`
                    <div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${l.start} - ${l.end}">
                        <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${l.color}"></span>
                        <span class="truncate font-mono text-[11px]">${l.start} - ${l.end}</span>
                    </div>
                `:""}

                ${n.duration?`
                    <div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${n.duration}分">
                        <span class="mr-0.5 text-[10px]">⏱️</span>${n.duration}m
                    </div>
                `:""}

                ${i?`<div class="flex items-center ${s} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${i}</div>`:""}
            </div>
        </div>
    `,t.addEventListener("dragstart",c=>{t.classList.add("opacity-50"),c.dataTransfer.setData("text/plain",n.id),c.dataTransfer.effectAllowed="move"}),t.addEventListener("dragend",()=>t.classList.remove("opacity-50")),t.querySelector(".task-checkbox").addEventListener("click",async c=>{c.stopPropagation(),await jh(n.id,e?"todo":"completed")}),t.addEventListener("click",c=>{!c.target.closest(".task-checkbox")&&!c.target.closest(".task-drag-handle")&&Hf(n)}),t.addEventListener("contextmenu",c=>{c.preventDefault(),c.stopPropagation(),Py(n,c.clientX,c.clientY)}),t}function Nc(n,t){if(!n)return;const e=document.createElement("ul");if(e.id="task-list-ul",e.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2",!t||t.length===0)e.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none">
                タスクがありません
            </li>
        `;else{const i=document.createDocumentFragment();t.forEach(s=>{i.appendChild(Ry(s))}),e.appendChild(i)}n.innerHTML="",n.appendChild(e)}function Ar(n,t,e){if(!(n.dataset.expanded==="true")){n.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,n.querySelector("#show-input-btn").onclick=()=>{n.dataset.expanded="true",Ar(n,t,e)};return}const r=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer">
                    <option value="">時間帯 (未定)</option>
                    ${St().map(o=>`<option value="${o.id}">${o.start} - ${o.end}</option>`).join("")}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition">キャンセル</button>
                    <button id="submit-task-btn" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm">タスクを追加</button>
                </div>
            </div>
        </div>
    `;n.innerHTML=Qi(r,"p-3 animate-fade-in-down"),By(n,t,e)}function By(n,t,e){const i=n.querySelector("#inline-title-input"),s=n.querySelector("#submit-task-btn"),r=n.querySelector("#cancel-input-btn"),o=n.querySelector("#inline-desc-input"),a=n.querySelector("#inline-timeblock-select");i.focus(),r.onclick=()=>{n.dataset.expanded="false",Ar(n,t,e)};const l=async()=>{const c=i.value.trim();c&&(s.disabled=!0,await Ny({title:c,description:o.value.trim(),projectId:t,labelIds:e?[e]:[],timeBlockId:a.value||null}),i.value="",o.value="",i.focus(),s.disabled=!1)};s.onclick=l,i.onkeydown=c=>{c.key==="Enter"&&!c.isComposing&&l()}}async function Ny(n){try{await zh(n)}catch(t){console.error(t),T({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function Fy(n,t="createdAt_desc"){return Array.isArray(n)?[...n].sort((e,i)=>{switch(t){case"createdAt_asc":return Is(e.createdAt,i.createdAt);case"createdAt_desc":return Is(i.createdAt,e.createdAt);case"dueDate_asc":return oi(e.dueDate,i.dueDate,(s,r)=>Is(s,r));case"timeBlockId_asc":return oi(e.timeBlockId,i.timeBlockId,(s,r)=>String(s).localeCompare(String(r)));case"projectId_asc":return oi(e.projectId,i.projectId,(s,r)=>String(s).localeCompare(String(r)));case"duration_asc":return oi(e.duration,i.duration,(s,r)=>Number(s)-Number(r));case"title_asc":return(e.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function Is(n,t){const e=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return e(n)-e(t)}function oi(n,t,e){return n===t?0:n==null||n==="null"?1:t==null||t==="null"?-1:e(n,t)}function $y(n,t,e=[],i=null,s=null){const r=document.getElementById("task-view");if(!r)return;Hy(n.length,i,s,t,e);const o=document.getElementById("sort-select"),a=document.getElementById("sort-trigger");let l="createdAt_desc";o?l=o.value:a&&a.dataset.value&&(l=a.dataset.value);const c=Fy(n,l);r.innerHTML="";const d=document.createElement("div");d.id="task-list-container",r.appendChild(d),Nc(d,c);const u=document.createElement("div");u.id="inline-input-container",u.className="mt-2 pb-10",r.appendChild(u),Ar(u,i,s)}function Hy(n,t,e,i,s){const r=document.getElementById("header-title"),o=document.getElementById("header-count");if(r){let a="インボックス";if(t){const l=i.find(c=>c.id===t);a=l?l.name:"プロジェクト"}else if(e){const l=s.find(c=>c.id===e);a=l?`${l.name}`:"ラベル"}r.textContent=a}o&&(o.textContent=`${n}件`)}let gt={};function zy(n,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>n(...i),t)}}function jy(n){gt={input:n.querySelector("#page-search-input"),select:n.querySelector("#page-search-project"),results:n.querySelector("#search-results-container")}}function Vy(n,t,e,i,s){var o;if(fi(n,t),n.innerHTML=My(i),jy(n),!gt.input||!gt.results)return;const r=zy(()=>Ra(e),300);gt.input.addEventListener("input",r),(o=gt.select)==null||o.addEventListener("change",()=>Ra(e)),Fl({type:"search"}),Nl(),requestAnimationFrame(()=>gt.input.focus())}function Ra(n){var s;const t=gt.input.value.trim().toLowerCase(),e=((s=gt.select)==null?void 0:s.value)||null;if(!t){gt.results.innerHTML=Ay();return}const i=Li(n,{keyword:t,projectId:e,showCompleted:!0});i.length===0?gt.results.innerHTML=Ty():(gt.results.innerHTML="",Nc(gt.results,i))}let at={type:"inbox",id:null},tt=null;const Ba={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function Uy(){if(tt)return;const{VIEW_IDS:n}=ur;tt={task:document.getElementById(n.TASK),dashboard:document.getElementById(n.DASHBOARD),search:document.getElementById(n.SEARCH),settings:document.getElementById(n.SETTINGS)}}function ai(n,t=[],e=[]){if(n.type==="settings"){Ui();return}at=n,pg(at),Fl(at,t,e)}function Wy(n,t,e){var c;if(Uy(),!tt.task||!tt.dashboard||!tt.search)return;const i=document.getElementById(Ba.SORT),s=(i==null?void 0:i.dataset.value)||"createdAt_desc",r=[tt.task,tt.dashboard,tt.search,tt.settings];if(at.type==="dashboard"){fi(tt.dashboard,r.filter(d=>d!==tt.dashboard)),tt.dashboard.innerHTML=Bc(),Cy(n);return}if(at.type==="search"){fi(tt.search,r.filter(d=>d!==tt.search)),Vy(tt.search,n,t,at);return}fi(tt.task,r.filter(d=>d!==tt.task));const a={keyword:"",showCompleted:((c=document.getElementById(Ba.COMPLETED_TOGGLE))==null?void 0:c.classList.contains("text-blue-500"))||!1,projectId:at.type==="project"?at.id:null,labelId:at.type==="label"?at.id:null,timeBlockId:at.type==="timeblock"?at.id:null,duration:at.type==="duration"?at.id:null,sortCriteria:s},l=tg(n,a);$y(l,t,e,a.projectId,a.labelId)}let Vt={tasks:[],projects:[],labels:[],timeBlocks:[],filters:[]},bt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null},er=!1,Ms=null;function fe(){Ms||(Ms=requestAnimationFrame(()=>{const{tasks:n,projects:t,labels:e,filters:i}=Vt;Rl({tasks:n,labels:e,projects:t,filters:i}),Wy(n,t,e),Ms=null}))}function We(n){document.dispatchEvent(new CustomEvent(n)),fe()}function qy(n){if(!(R!=null&&R.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}Tr(!1);const t=$t();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}er=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),bt.tasks=rf(t,e=>{Vt.tasks=e,We("tasks-updated")}),bt.projects=yd(t,e=>{Vt.projects=e,We("projects-updated")}),bt.labels=Jh(t,e=>{Vt.labels=e,We("labels-updated")}),bt.timeBlocks=Qh(t,e=>{Vt.timeBlocks=e,We("timeblocks-updated")}),bt.filters=qh(t,e=>{Vt.filters=e,We("filters-updated")})}function Tr(n=!1){(er||n)&&console.log("[DataSync] Stopping data sync..."),Object.keys(bt).forEach(t=>{t==="workspaces"&&!n||typeof bt[t]=="function"&&(bt[t](),bt[t]=null)}),ef(),Wh(),Vt={tasks:[],projects:[],labels:[],timeBlocks:[],filters:[]},er=!1,Rl(Vt),fe()}function Fc(){return bt.workspaces}function $c(n){bt.workspaces=n}function Yy(){const n=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),e=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!n||!t||!e)return;const s=o=>{o?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",r)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",r))},r=o=>{o&&(t.contains(o.target)||n.contains(o.target))||s(!1)};n.addEventListener("click",o=>{o.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(o=>{o.addEventListener("click",a=>{const l=o.dataset.value,c=o.textContent;e.textContent=c,n.dataset.value=l,fe(),s(!1)})}),n.dataset.value||(n.dataset.value="createdAt_desc",e.textContent="作成日(新しい順)")}function Gy(n,t){let e;return(...i)=>{clearTimeout(e),e=setTimeout(()=>n(...i),t)}}function Ky(){var e,i;let n=!0;document.addEventListener("workspace-changed",s=>{const{workspaceId:r}=s.detail;console.log("[EventManager] Workspace changed to:",r);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),R!=null&&R.currentUser){if(n){n=!1;try{const a=JSON.parse(localStorage.getItem("lastPage"));ai(a?{type:a.page,id:a.id||null}:{type:"inbox"})}catch{ai({type:"inbox"})}}else ai({type:"inbox",id:null});Tr(!1),qy(),fe()}}),document.addEventListener("route-change",s=>{const{page:r,id:o}=s.detail;ai({type:r,id:o||null}),localStorage.setItem("lastPage",JSON.stringify({page:r,id:o||null})),fe()});const t=Gy(()=>fe(),300);(e=document.getElementById("search-input"))==null||e.addEventListener("input",t),(i=document.getElementById("toggle-completed-btn"))==null||i.addEventListener("click",s=>{s.currentTarget.classList.toggle("text-blue-500"),fe()}),Yy()}function Xy(){try{Jc()}catch(n){console.error("Firebase Initialization Failed",n);return}of(),Mf(),uf(),Ml(),id(),Ky(),Jy()}function Jy(){R&&Wc(R,n=>{sd(n),n?Zy(n):Qy()})}function Zy(n){lg();const t=Fc();typeof t=="function"&&t();const e=ld(n.uid,i=>{Al(i)});$c(e)}function Qy(){const n=Fc();typeof n=="function"&&(n(),$c(null)),Tr(!0),bg()}function tx(){Xy()}let Na=!1;function ex(n){const t=document.createElement("div");t.id=fg.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const e=t.querySelector("#error-code-box");e&&(e.textContent=n.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function nx(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const n=document.createElement("link");n.rel="icon",n.type="image/png",n.href=hg.FAVICON,document.head.appendChild(n)}async function Fa(){if(!Na){Na=!0;try{nx(),await tx()}catch(n){console.error("[Main] Critical Initialization Error:",n),ex(n)}}}(()=>{if(document.readyState==="loading"){const n=()=>{document.removeEventListener("DOMContentLoaded",n),Fa()};document.addEventListener("DOMContentLoaded",n)}else Fa()})();
