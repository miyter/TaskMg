var rh=Object.defineProperty;var ah=(e,t,n)=>t in e?rh(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>ah(e,typeof t!="symbol"?t+"":t,n);import{getAuth as lh,signInAnonymously as ch,signInWithEmailAndPassword as dh,updatePassword as uh,onAuthStateChanged as hh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as fh,updateDoc as Oi,doc as Ht,addDoc as Ke,collection as gt,serverTimestamp as en,deleteDoc as Pi,query as nn,orderBy as Pr,onSnapshot as Dn,getDocs as ei,limit as gh,Timestamp as Rr,getDoc as ph,setDoc as mh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as bh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const yh="modulepreload",vh=function(e){return"/"+e},va={},xh=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let r=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=r(n.map(c=>{if(c=vh(c),c in va)return;va[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":yh,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return s.then(r=>{for(const a of r||[])a.status==="rejected"&&o(a.reason);return t().catch(o)})},xa={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let fs,U,K,Ps=!1;function _h(){if(Ps)return;const e=wh();if(e!=null&&e.apiKey)try{fs=bh(e),U=lh(fs),K=fh(fs),Ps=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function wh(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&xa){const e=xa,t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function Vc(){if(!Ps)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:fs,auth:U,db:K}}function kh(e,t,n){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${n?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${e.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${e.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function Sh(e){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",t="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const n=e.type==="confirm";!n&&e.okText==="OK"&&(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",kh(e,t,n));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),o=document.getElementById("msg-modal-body"),r=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=e.title,o.textContent=e.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!n&&l()};document.addEventListener("keydown",c),r.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!n&&l()},r.focus()}function P(e,t=null){let n={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof e=="object"&&e!==null?n={...n,...e}:(n.message=String(e),typeof t=="function"?(n.type="confirm",n.onConfirm=t):typeof t=="string"&&(n.type=t)),Sh(n)}async function Eh(e,t){if(!Ps)throw new Error("Firebaseが初期化されていないぞ。");try{return await dh(U,e,t)}catch(n){let i="ログインに失敗した。";switch(n.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function Ih(e){const t=U.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await uh(t,e),P({message:"パスワードを変更したぞ",type:"success"})}catch(n){let i="変更に失敗した: "+n.message;throw n.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),P({message:i,type:"error"}),n}}function Wc(){const e=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),n=document.getElementById("password-input"),i=document.getElementById("guest-login-btn");if(e&&t&&n){const s=async()=>{const o=t.value.trim(),r=n.value.trim();if(!o||!r)return P({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await Eh(o,r)}catch(a){P({message:a.message,type:"error"})}};e.onclick=s,n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&s()})}i&&(i.onclick=async()=>{try{await ch(U),P({message:"ゲストとしてログインしたぞ。データは一時的に保持される。",type:"success"})}catch(s){console.error(s),P({message:"ゲストログインに失敗した: "+s.message,type:"error"})}})}function Dh(e){const t=document.getElementById("login-form-container")||document.getElementById("login-container-wrapper"),n=document.getElementById("user-info"),i=document.getElementById("user-email-display"),s=document.getElementById("email-input"),o=document.getElementById("password-input");e?(e.uid,t&&t.classList.add("hidden"),n&&(n.classList.remove("hidden"),n.classList.add("flex")),i&&(i.textContent=e.isAnonymous?"ゲストユーザー":e.email||"ユーザー")):(t&&t.classList.remove("hidden"),n&&(n.classList.add("hidden"),n.classList.remove("flex")),s&&(s.value=""),o&&(o.value=""),i&&(i.textContent=""))}const Th={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},B={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DENSITY_LEVELS:{COMPACT:"compact",NORMAL:"normal",COMFORTABLE:"comfortable",SPACIOUS:"spacious"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},CLASSES:{CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},COLORS:{DEFAULT:"#CBD5E0"},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order"},LIST_IDS:{PROJECTS:"project-list",LABELS:"label-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list",BASIC:"basic-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function Yc(e,t){if(!t||!e)return;let n=!1,i=null,s=null;const o=()=>{i!==null&&e&&(e.style.width=`${i}px`),s=null},r=l=>{if(!n)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=B;i=Math.max(c,Math.min(d,l.clientX)),s||(s=requestAnimationFrame(o))},a=()=>{n&&(n=!1,document.body.classList.remove("cursor-col-resize","select-none"),e.style.transition="",s&&cancelAnimationFrame(s),s=null,o(),localStorage.setItem(B.STORAGE_KEYS.WIDTH,e.offsetWidth),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a))};t.addEventListener("mousedown",l=>{Br()&&(n=!0,document.body.classList.add("cursor-col-resize","select-none"),e.style.transition="none",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))})}function Br(){return window.innerWidth>=768}function Nr(e,t=!1){const n=localStorage.getItem(e);return n===null?t:n==="true"||n==="compact"}function Tn(){const e=localStorage.getItem(B.STORAGE_KEYS.DENSITY);return e&&Object.values(B.DENSITY_LEVELS).includes(e)?e:Nr(B.STORAGE_KEYS.COMPACT,!1)?B.DENSITY_LEVELS.COMPACT:B.DENSITY_LEVELS.NORMAL}function Mh(){return Tn()===B.DENSITY_LEVELS.COMPACT}function Rs(e,t){return Array.isArray(e)?e.filter(n=>n.status!=="completed"&&t(n)).length:0}function Ch(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function un(e){return`artifacts/${Ch()}/users/${e}`}function _a(e,t){return`${un(e)}/workspaces/${t}`}const Y={users:e=>un(e),filters:e=>`${un(e)}/filters`,labels:e=>`${un(e)}/labels`,workspaces:e=>`${un(e)}/workspaces`,timeblocks:e=>`${un(e)}/timeblocks`,tasks:(e,t)=>`${_a(e,t)}/tasks`,projects:(e,t)=>`${_a(e,t)}/projects`},Bs="currentWorkspaceId",Ah="workspace-changed";let zi=null,Fr=[];function nr(){return Fr}function Lh(e,t){const n=typeof t=="function"?t:()=>{};if(!e)return n([]),()=>{};zi&&zi();const i=Y.workspaces(e),s=nn(gt(K,i),Pr("createdAt","asc"));return zi=Dn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));if(Fr=r,r.length===0&&!o.metadata.hasPendingWrites)n([]),Oh().catch(a=>console.error("[Workspace] Default creation error:",a));else{const a=Ph(r);n(r),qc(a,r)}},o=>{console.error("[Workspace] Subscription error:",o),n([])}),zi}async function Oh(){try{const e=U.currentUser;if(!e)return;const t=Y.workspaces(e.uid);(await ei(nn(gt(K,t),gh(1)))).empty&&await Gc("メイン")}catch(e){console.error("[Workspace] Failed to ensure default workspace:",e)}}function Ph(e){if(e.length===0)return null;let t=ee();const n=e.some(i=>i.id===t);return(!t||!n)&&(t=e[0].id,localStorage.setItem(Bs,t)),t}function ee(){return localStorage.getItem(Bs)}function $r(e){!e||localStorage.getItem(Bs)===e||(localStorage.setItem(Bs,e),qc(e,Fr))}function qc(e,t){const n=new CustomEvent(Ah,{detail:{workspaceId:e,workspaces:t}});document.dispatchEvent(n)}async function Gc(e){try{const t=U.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);return{id:(await Ke(gt(K,n),{name:e,createdAt:en()})).id,name:e}}catch(t){throw console.error("[Workspace] Add error:",t),P("ワークスペースの作成に失敗した。"),t}}async function Rh(e,t){try{const n=U.currentUser;if(!n)throw new Error("Authentication required");const i=Y.workspaces(n.uid);await Oi(Ht(K,i,e),{name:t})}catch(n){console.error("[Workspace] Update error:",n),P("名前の更新に失敗した。")}}async function Bh(e){try{const t=U.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);await Pi(Ht(K,n,e))}catch(t){console.error("[Workspace] Delete error:",t),P("削除に失敗した。")}}const wa={EN:[{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Segoe UI",label:"Segoe UI"},{value:'-apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif',label:"San Francisco"},{value:'"Google Sans", "Open Sans"',label:"Google Sans"}],JP:[{value:'"Hiragino Kaku Gothic ProN", "Hiragino Sans"',label:"ヒラギノ角ゴ"},{value:'"Noto Sans JP"',label:"Noto Sans JP"},{value:'"LINE Seed JP"',label:"LINE Seed JP"},{value:'"M PLUS 2"',label:"M PLUS 2"},{value:'"BIZ UDPGothic"',label:"BIZ UDPゴシック"}]},wn={FONT_EN:"font_family_en",FONT_JP:"font_family_jp"},Ns={EN:"Inter",JP:"M PLUS 2"};function Xc(){const e=localStorage.getItem(wn.FONT_EN)||Ns.EN,t=localStorage.getItem(wn.FONT_JP)||Ns.JP,n=document.documentElement;n.style.setProperty("--font-en",`"${e}"`),n.style.setProperty("--font-jp",`"${t}"`)}function ka(e,t){const n=e==="EN"?wn.FONT_EN:wn.FONT_JP;localStorage.setItem(n,t),Xc()}function Nh(){return{en:localStorage.getItem(wn.FONT_EN)||Ns.EN,jp:localStorage.getItem(wn.FONT_JP)||Ns.JP}}function Fh(){const e=localStorage.getItem("fontSize")||"md",t=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e}`)}const Pn={NONE:"none",TEXTURE:"haikei"},jt={SMALL:"sm",BASE:"base",MEDIUM:"md",LARGE:"lg",XL:"xl"},$h=[{value:"Asia/Tokyo",label:"日本 (JST/UTC+9)"},{value:"America/Los_Angeles",label:"アメリカ・太平洋 (PST/UTC-8)"},{value:"America/New_York",label:"アメリカ・東部 (EST/UTC-5)"},{value:"Asia/Shanghai",label:"中国・台湾 (CST/UTC+8)"},{value:"Europe/London",label:"イギリス (GMT/UTC+0)"}];function Sa(e,t,n,i){const s=t.map(o=>`<option value="${o.value}" ${o.value===n?"selected":""}>${o.label}</option>`).join("");return`
        <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">${e}</label>
            <div class="relative">
                <select name="${i}" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                    ${s}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>
    `}function Hh(){const e=Nh();return`
        <div class="space-y-4">
            ${Sa("英数字フォント",wa.EN,e.en,"font-en-select")}
            ${Sa("日本語フォント",wa.JP,e.jp,"font-jp-select")}
        </div>
    `}function Ct(e,t,n,i,s=""){return`
        <label class="flex items-center justify-center gap-2 cursor-pointer p-3 border ${i?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300"} rounded-lg transition-all duration-200">
            <input type="radio" name="${e}" value="${t}" class="hidden" ${i?"checked":""}>
            ${s}
            <span class="text-sm font-medium">${n}</span>
        </label>
    `}function Rn(e,t,n,i,s=!1){return`
        <div class="settings-accordion border-b border-gray-100 dark:border-gray-700 last:border-0" data-section="${e}">
            <button class="accordion-header w-full flex items-center justify-between py-4 px-2 focus:outline-none group hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-lg transition-colors">
                <div class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest group-hover:text-blue-500 transition-colors">
                    ${n}
                    ${t}
                </div>
                <svg class="accordion-icon w-5 h-5 text-gray-400 transform transition-transform duration-300 ${s?"rotate-180":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div class="accordion-content overflow-hidden transition-all duration-300 ease-in-out ${s?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"}" style="${s?"":"max-height: 0px;"}">
                <div class="pt-2 pb-6 px-2">
                    ${i}
                </div>
            </div>
        </div>
    `}function jh(e,t,n){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||jt.MEDIUM,o=localStorage.getItem("background")||Pn.NONE,r=e||"?",a=localStorage.getItem("sidebar_density")||(n?"compact":"normal"),l=`
        <div class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">テーマ</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Ct("app-theme","light","ライト",i==="light",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                    ${Ct("app-theme","dark","ダーク",i==="dark",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークモード)</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Ct("bg-pattern",Pn.NONE,"無地",o===Pn.NONE)}
                    ${Ct("bg-pattern",Pn.TEXTURE,"テクスチャ",o===Pn.TEXTURE)}
                </div>
            </div>
            <div>
                 <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タイムゾーン</label>
                 <div class="relative">
                     ${(()=>{const g=localStorage.getItem("timezone")||"Asia/Tokyo";return`
                        <select name="timezone-select" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                            ${$h.map(p=>`<option value="${p.value}" ${p.value===g?"selected":""}>${p.label}</option>`).join("")}
                        </select>
                        `})()}
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">サイドバーとUI密度</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Ct("sidebar-density","compact","Compact",a==="compact")}
                    ${Ct("sidebar-density","normal","Standard",a==="normal")}
                    ${Ct("sidebar-density","comfortable","Comfortable",a==="comfortable")}
                    ${Ct("sidebar-density","spacious","Spacious",a==="spacious")}
                </div>
            </div>
        </div>
    `,c=Hh(),d=`
        <div class="grid grid-cols-5 gap-2">
            ${Ct("font-size",jt.SMALL,"Small",s===jt.SMALL)}
            ${Ct("font-size",jt.BASE,"Base",s===jt.BASE)}
            ${Ct("font-size",jt.MEDIUM,"Medium",s===jt.MEDIUM)}
            ${Ct("font-size",jt.LARGE,"Large",s===jt.LARGE)}
            ${Ct("font-size",jt.XL,"XL",s===jt.XL)}
        </div>
    `,u=`
         <div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-100 dark:border-gray-700">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                ${r}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-500 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新しいパスワード" class="flex-1 px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                <button id="update-password-btn-new" class="px-4 py-2 bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-bold rounded-lg transition-colors whitespace-nowrap">変更</button>
            </div>
            <button id="logout-btn-settings" class="w-full py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-medium rounded-lg transition-colors text-left flex items-center gap-2 px-2">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `;return`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-5xl overflow-hidden flex flex-col max-h-[90vh] h-full sm:h-auto animate-fade-in-up">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10 sticky top-0">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">Settings</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="overflow-y-auto custom-scrollbar flex-1 bg-white dark:bg-gray-800">
                <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- Left Column -->
                    <div class="space-y-0">
                        ${Rn("appearance","Appearance",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>',l,!0)}
                        ${Rn("data","Data Management",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>',`
        <div class="space-y-3">
            <button id="export-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">バックアップを作成</span>
                    <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">現在の全データをJSON形式でダウンロード</div>
            </button>
            
            <button id="import-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                 <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">データを復元</span>
                     <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">バックアップファイルからデータを読み込み</div>
            </button>
            <input type="file" id="import-file-input" accept=".json" class="hidden" />
        </div>
    `)}
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-0">
                        ${Rn("typography","Typography",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>',c)}
                        ${Rn("fontsize","Font Size",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',d)}
                        ${Rn("account","Account",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',u)}
                    </div>
                </div>
            </div>
        </div>
    `}var Ea={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Kc=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)===55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128)}return t},zh=function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=e[n++];t[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=e[n++],r=e[n++],a=e[n++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const o=e[n++],r=e[n++];t[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return t.join("")},Jc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const o=e[s],r=s+1<e.length,a=r?e[s+1]:0,l=s+2<e.length,c=l?e[s+2]:0,d=o>>2,u=(o&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,r||(h=64)),i.push(n[d],n[u],n[h],n[f])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(Kc(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):zh(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const o=n[e.charAt(s++)],a=s<e.length?n[e.charAt(s)]:0;++s;const c=s<e.length?n[e.charAt(s)]:64;++s;const u=s<e.length?n[e.charAt(s)]:64;if(++s,o==null||a==null||c==null||u==null)throw new Uh;const h=o<<2|a>>4;if(i.push(h),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const g=c<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Uh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Vh=function(e){const t=Kc(e);return Jc.encodeByteArray(t,!0)},Zc=function(e){return Vh(e).replace(/\./g,"")},Qc=function(e){try{return Jc.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Yh=()=>Wh().__FIREBASE_DEFAULTS__,qh=()=>{if(typeof process>"u"||typeof Ea>"u")return;const e=Ea.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Gh=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Qc(e[1]);return t&&JSON.parse(t)},Xh=()=>{try{return Yh()||qh()||Gh()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Kh=e=>{var t;return(t=Xh())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Qt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Jh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Qt())}function Zh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Qh(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function tf(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function ef(){try{return typeof indexedDB=="object"}catch{return!1}}function nf(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var o;t(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(n){t(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sf="FirebaseError";class sn extends Error{constructor(t,n,i){super(n),this.code=t,this.customData=i,this.name=sf,Object.setPrototypeOf(this,sn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ri.prototype.create)}}class Ri{constructor(t,n,i){this.service=t,this.serviceName=n,this.errors=i}create(t,...n){const i=n[0]||{},s=`${this.service}/${t}`,o=this.errors[t],r=o?of(o,i):"Error",a=`${this.serviceName}: ${r} (${s}).`;return new sn(s,a,i)}}function of(e,t){return e.replace(rf,(n,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const rf=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function td(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function af(e,t){const n=new lf(e,t);return n.subscribe.bind(n)}class lf{constructor(t,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(n=>{n.next(t)})}error(t){this.forEachObserver(n=>{n.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,n,i){let s;if(t===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");cf(t,["next","error","complete"])?s=t:s={next:t,error:n,complete:i},s.next===void 0&&(s.next=yo),s.error===void 0&&(s.error=yo),s.complete===void 0&&(s.complete=yo);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,t)}sendOne(t,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{n(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function cf(e,t){if(typeof e!="object"||e===null)return!1;for(const n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}function yo(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bi(e){return e&&e._delegate?e._delegate:e}class yi{constructor(t,n,i){this.name=t,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var X;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(X||(X={}));const df={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},uf=X.INFO,hf={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},ff=(e,t,...n)=>{if(t<e.logLevel)return;const i=new Date().toISOString(),s=hf[t];if(s)console[s](`[${i}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class ed{constructor(t){this.name=t,this._logLevel=uf,this._logHandler=ff,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in X))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?df[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...t),this._logHandler(this,X.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...t),this._logHandler(this,X.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,X.INFO,...t),this._logHandler(this,X.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,X.WARN,...t),this._logHandler(this,X.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...t),this._logHandler(this,X.ERROR,...t)}}const gf=(e,t)=>t.some(n=>e instanceof n);let Ia,Da;function pf(){return Ia||(Ia=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function mf(){return Da||(Da=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const nd=new WeakMap,ir=new WeakMap,id=new WeakMap,vo=new WeakMap,Hr=new WeakMap;function bf(e){const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{n(Ce(e.result)),s()},r=()=>{i(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",r)});return t.then(n=>{n instanceof IDBCursor&&nd.set(n,e)}).catch(()=>{}),Hr.set(t,e),t}function yf(e){if(ir.has(e))return;const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{n(),s()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)});ir.set(e,t)}let sr={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return ir.get(e);if(t==="objectStoreNames")return e.objectStoreNames||id.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Ce(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function vf(e){sr=e(sr)}function xf(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(xo(this),t,...n);return id.set(i,t.sort?t.sort():[t]),Ce(i)}:mf().includes(e)?function(...t){return e.apply(xo(this),t),Ce(nd.get(this))}:function(...t){return Ce(e.apply(xo(this),t))}}function _f(e){return typeof e=="function"?xf(e):(e instanceof IDBTransaction&&yf(e),gf(e,pf())?new Proxy(e,sr):e)}function Ce(e){if(e instanceof IDBRequest)return bf(e);if(vo.has(e))return vo.get(e);const t=_f(e);return t!==e&&(vo.set(e,t),Hr.set(t,e)),t}const xo=e=>Hr.get(e);function wf(e,t,{blocked:n,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(e,t),a=Ce(r);return i&&r.addEventListener("upgradeneeded",l=>{i(Ce(r.result),l.oldVersion,l.newVersion,Ce(r.transaction),l)}),n&&r.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const kf=["get","getKey","getAll","getAllKeys","count"],Sf=["put","add","delete","clear"],_o=new Map;function Ta(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(_o.get(t))return _o.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=Sf.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||kf.includes(n)))return;const o=async function(r,...a){const l=this.transaction(r,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return _o.set(t,o),o}vf(e=>({...e,get:(t,n,i)=>Ta(t,n)||e.get(t,n,i),has:(t,n)=>!!Ta(t,n)||e.has(t,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ef{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(If(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function If(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const or="@firebase/app",Ma="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const fe=new ed("@firebase/app"),Df="@firebase/app-compat",Tf="@firebase/analytics-compat",Mf="@firebase/analytics",Cf="@firebase/app-check-compat",Af="@firebase/app-check",Lf="@firebase/auth",Of="@firebase/auth-compat",Pf="@firebase/database",Rf="@firebase/data-connect",Bf="@firebase/database-compat",Nf="@firebase/functions",Ff="@firebase/functions-compat",$f="@firebase/installations",Hf="@firebase/installations-compat",jf="@firebase/messaging",zf="@firebase/messaging-compat",Uf="@firebase/performance",Vf="@firebase/performance-compat",Wf="@firebase/remote-config",Yf="@firebase/remote-config-compat",qf="@firebase/storage",Gf="@firebase/storage-compat",Xf="@firebase/firestore",Kf="@firebase/vertexai-preview",Jf="@firebase/firestore-compat",Zf="firebase",Qf="10.14.1",tg={[or]:"fire-core",[Df]:"fire-core-compat",[Mf]:"fire-analytics",[Tf]:"fire-analytics-compat",[Af]:"fire-app-check",[Cf]:"fire-app-check-compat",[Lf]:"fire-auth",[Of]:"fire-auth-compat",[Pf]:"fire-rtdb",[Rf]:"fire-data-connect",[Bf]:"fire-rtdb-compat",[Nf]:"fire-fn",[Ff]:"fire-fn-compat",[$f]:"fire-iid",[Hf]:"fire-iid-compat",[jf]:"fire-fcm",[zf]:"fire-fcm-compat",[Uf]:"fire-perf",[Vf]:"fire-perf-compat",[Wf]:"fire-rc",[Yf]:"fire-rc-compat",[qf]:"fire-gcs",[Gf]:"fire-gcs-compat",[Xf]:"fire-fst",[Jf]:"fire-fst-compat",[Kf]:"fire-vertex","fire-js":"fire-js",[Zf]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg=new Map,ng=new Map,Ca=new Map;function Aa(e,t){try{e.container.addComponent(t)}catch(n){fe.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function vi(e){const t=e.name;if(Ca.has(t))return fe.debug(`There were multiple attempts to register component ${t}.`),!1;Ca.set(t,e);for(const n of eg.values())Aa(n,e);for(const n of ng.values())Aa(n,e);return!0}function Vn(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ig={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},jr=new Ri("app","Firebase",ig);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const zr=Qf;function ni(e,t,n){var i;let s=(i=tg[e])!==null&&i!==void 0?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),r=t.match(/\s|\//);if(o||r){const a=[`Unable to register library "${s}" with version "${t}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&r&&a.push("and"),r&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),fe.warn(a.join(" "));return}vi(new yi(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const sg="firebase-heartbeat-database",og=1,xi="firebase-heartbeat-store";let wo=null;function sd(){return wo||(wo=wf(sg,og,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(xi)}catch(n){console.warn(n)}}}}).catch(e=>{throw jr.create("idb-open",{originalErrorMessage:e.message})})),wo}async function rg(e){try{const n=(await sd()).transaction(xi),i=await n.objectStore(xi).get(od(e));return await n.done,i}catch(t){if(t instanceof sn)fe.warn(t.message);else{const n=jr.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});fe.warn(n.message)}}}async function La(e,t){try{const i=(await sd()).transaction(xi,"readwrite");await i.objectStore(xi).put(t,od(e)),await i.done}catch(n){if(n instanceof sn)fe.warn(n.message);else{const i=jr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});fe.warn(i.message)}}}function od(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ag=1024,lg=720*60*60*1e3;class cg{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new ug(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Oa();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(r=>r.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const a=new Date(r.date).valueOf();return Date.now()-a<=lg}),this._storage.overwrite(this._heartbeatsCache))}catch(i){fe.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Oa(),{heartbeatsToSend:i,unsentEntries:s}=dg(this._heartbeatsCache.heartbeats),o=Zc(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return fe.warn(n),""}}}function Oa(){return new Date().toISOString().substring(0,10)}function dg(e,t=ag){const n=[];let i=e.slice();for(const s of e){const o=n.find(r=>r.agent===s.agent);if(o){if(o.dates.push(s.date),Pa(n)>t){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Pa(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class ug{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return ef()?nf().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await rg(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return La(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return La(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function Pa(e){return Zc(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function hg(e){vi(new yi("platform-logger",t=>new Ef(t),"PRIVATE")),vi(new yi("heartbeat",t=>new cg(t),"PRIVATE")),ni(or,Ma,e),ni(or,Ma,"esm2017"),ni("fire-js","")}hg("");function rd(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function ad(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const fg=ad,ld=new Ri("auth","Firebase",ad());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fs=new ed("@firebase/auth");function gg(e,...t){Fs.logLevel<=X.WARN&&Fs.warn(`Auth (${zr}): ${e}`,...t)}function gs(e,...t){Fs.logLevel<=X.ERROR&&Fs.error(`Auth (${zr}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ra(e,...t){throw Ur(e,...t)}function cd(e,...t){return Ur(e,...t)}function dd(e,t,n){const i=Object.assign(Object.assign({},fg()),{[t]:n});return new Ri("auth","Firebase",i).create(t,{appName:e.name})}function ps(e){return dd(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Ur(e,...t){if(typeof e!="string"){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return ld.create(e,...t)}function W(e,t,...n){if(!e)throw Ur(t,...n)}function ii(e){const t="INTERNAL ASSERTION FAILED: "+e;throw gs(t),new Error(t)}function $s(e,t){e||ii(t)}function pg(){return Ba()==="http:"||Ba()==="https:"}function Ba(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function mg(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(pg()||Qh()||"connection"in navigator)?navigator.onLine:!0}function bg(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ni{constructor(t,n){this.shortDelay=t,this.longDelay=n,$s(n>t,"Short delay should be less than long delay!"),this.isMobile=Jh()||tf()}get(){return mg()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function yg(e,t){$s(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ud{static initialize(t,n,i){this.fetchImpl=t,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;ii("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;ii("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;ii("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const vg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const xg=new Ni(3e4,6e4);function hd(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function oo(e,t,n,i,s={}){return fd(e,s,async()=>{let o={},r={};i&&(t==="GET"?r=i:o={body:JSON.stringify(i)});const a=td(Object.assign({key:e.config.apiKey},r)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:l},o);return Zh()||(c.referrerPolicy="no-referrer"),ud.fetch()(gd(e,e.config.apiHost,n,a),c)})}async function fd(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},vg),t);try{const s=new _g(e),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const r=await o.json();if("needConfirmation"in r)throw Ui(e,"account-exists-with-different-credential",r);if(o.ok&&!("errorMessage"in r))return r;{const a=o.ok?r.errorMessage:r.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ui(e,"credential-already-in-use",r);if(l==="EMAIL_EXISTS")throw Ui(e,"email-already-in-use",r);if(l==="USER_DISABLED")throw Ui(e,"user-disabled",r);const d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw dd(e,d,c);Ra(e,d)}}catch(s){if(s instanceof sn)throw s;Ra(e,"network-request-failed",{message:String(s)})}}function gd(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?yg(e.config,s):`${e.config.apiScheme}://${s}`}class _g{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(cd(this.auth,"network-request-failed")),xg.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ui(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=cd(e,t,i);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function wg(e,t){return oo(e,"POST","/v1/accounts:delete",t)}async function pd(e,t){return oo(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function si(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function kg(e,t=!1){const n=Bi(e),i=await n.getIdToken(t),s=md(i);W(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,r=o==null?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:si(ko(s.auth_time)),issuedAtTime:si(ko(s.iat)),expirationTime:si(ko(s.exp)),signInProvider:r||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function ko(e){return Number(e)*1e3}function md(e){const[t,n,i]=e.split(".");if(t===void 0||n===void 0||i===void 0)return gs("JWT malformed, contained fewer than 3 sections"),null;try{const s=Qc(n);return s?JSON.parse(s):(gs("Failed to decode base64 JWT payload"),null)}catch(s){return gs("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Na(e){const t=md(e);return W(t,"internal-error"),W(typeof t.exp<"u","internal-error"),W(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function rr(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof sn&&Sg(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}function Sg({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Eg{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var n;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const n=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ar{constructor(t,n){this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=si(this.lastLoginAt),this.creationTime=si(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Hs(e){var t;const n=e.auth,i=await e.getIdToken(),s=await rr(e,pd(n,{idToken:i}));W(s==null?void 0:s.users.length,n,"internal-error");const o=s.users[0];e._notifyReloadListener(o);const r=!((t=o.providerUserInfo)===null||t===void 0)&&t.length?bd(o.providerUserInfo):[],a=Dg(e.providerData,r),l=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,u={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new ar(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(e,u)}async function Ig(e){const t=Bi(e);await Hs(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function Dg(e,t){return[...e.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function bd(e){return e.map(t=>{var{providerId:n}=t,i=rd(t,["providerId"]);return{providerId:n,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tg(e,t){const n=await fd(e,{},async()=>{const i=td({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:o}=e.config,r=gd(e,s,"/v1/token",`key=${o}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ud.fetch()(r,{method:"POST",headers:a,body:i})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function Mg(e,t){return oo(e,"POST","/v2/accounts:revokeToken",hd(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class mn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){W(t.idToken,"internal-error"),W(typeof t.idToken<"u","internal-error"),W(typeof t.refreshToken<"u","internal-error");const n="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Na(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,n)}updateFromIdToken(t){W(t.length!==0,"internal-error");const n=Na(t);this.updateTokensAndExpiration(t,null,n)}async getToken(t,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(W(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,n){const{accessToken:i,refreshToken:s,expiresIn:o}=await Tg(t,n);this.updateTokensAndExpiration(i,s,Number(o))}updateTokensAndExpiration(t,n,i){this.refreshToken=n||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,n){const{refreshToken:i,accessToken:s,expirationTime:o}=n,r=new mn;return i&&(W(typeof i=="string","internal-error",{appName:t}),r.refreshToken=i),s&&(W(typeof s=="string","internal-error",{appName:t}),r.accessToken=s),o&&(W(typeof o=="number","internal-error",{appName:t}),r.expirationTime=o),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new mn,this.toJSON())}_performRefresh(){return ii("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ve(e,t){W(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class we{constructor(t){var{uid:n,auth:i,stsTokenManager:s}=t,o=rd(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Eg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new ar(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(t){const n=await rr(this,this.stsTokenManager.getToken(this.auth,t));return W(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(t){return kg(this,t)}reload(){return Ig(this)}_assign(t){this!==t&&(W(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(n=>Object.assign({},n)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const n=new we(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(t){W(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,n=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),n&&await Hs(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Vn(this.auth.app))return Promise.reject(ps(this.auth));const t=await this.getIdToken();return await rr(this,wg(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,n){var i,s,o,r,a,l,c,d;const u=(i=n.displayName)!==null&&i!==void 0?i:void 0,h=(s=n.email)!==null&&s!==void 0?s:void 0,f=(o=n.phoneNumber)!==null&&o!==void 0?o:void 0,g=(r=n.photoURL)!==null&&r!==void 0?r:void 0,p=(a=n.tenantId)!==null&&a!==void 0?a:void 0,m=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,b=(c=n.createdAt)!==null&&c!==void 0?c:void 0,y=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:v,emailVerified:_,isAnonymous:x,providerData:w,stsTokenManager:k}=n;W(v&&k,t,"internal-error");const S=mn.fromJSON(this.name,k);W(typeof v=="string",t,"internal-error"),ve(u,t.name),ve(h,t.name),W(typeof _=="boolean",t,"internal-error"),W(typeof x=="boolean",t,"internal-error"),ve(f,t.name),ve(g,t.name),ve(p,t.name),ve(m,t.name),ve(b,t.name),ve(y,t.name);const D=new we({uid:v,auth:t,email:h,emailVerified:_,displayName:u,isAnonymous:x,photoURL:g,phoneNumber:f,tenantId:p,stsTokenManager:S,createdAt:b,lastLoginAt:y});return w&&Array.isArray(w)&&(D.providerData=w.map(A=>Object.assign({},A))),m&&(D._redirectEventId=m),D}static async _fromIdTokenResponse(t,n,i=!1){const s=new mn;s.updateFromServerResponse(n);const o=new we({uid:n.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await Hs(o),o}static async _fromGetAccountInfoResponse(t,n,i){const s=n.users[0];W(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?bd(s.providerUserInfo):[],r=!(s.email&&s.passwordHash)&&!(o!=null&&o.length),a=new mn;a.updateFromIdToken(i);const l=new we({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:r}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new ar(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(o!=null&&o.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fa=new Map;function Ge(e){$s(e instanceof Function,"Expected a class definition");let t=Fa.get(e);return t?($s(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Fa.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class yd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,n){this.storage[t]=n}async _get(t){const n=this.storage[t];return n===void 0?null:n}async _remove(t){delete this.storage[t]}_addListener(t,n){}_removeListener(t,n){}}yd.type="NONE";const $a=yd;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function So(e,t,n){return`firebase:${e}:${t}:${n}`}class bn{constructor(t,n,i){this.persistence=t,this.auth=n,this.userKey=i;const{config:s,name:o}=this.auth;this.fullUserKey=So(this.userKey,s.apiKey,o),this.fullPersistenceKey=So("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?we._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,i="authUser"){if(!n.length)return new bn(Ge($a),t,i);const s=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let o=s[0]||Ge($a);const r=So(i,t.config.apiKey,t.name);let a=null;for(const c of n)try{const d=await c._get(r);if(d){const u=we._fromJSON(t,d);c!==o&&(a=u),o=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!o._shouldAllowMigration||!l.length?new bn(o,t,i):(o=l[0],a&&await o._set(r,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==o)try{await c._remove(r)}catch{}})),new bn(o,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ha(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(Og(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Cg(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Rg(t))return"Blackberry";if(Bg(t))return"Webos";if(Ag(t))return"Safari";if((t.includes("chrome/")||Lg(t))&&!t.includes("edge/"))return"Chrome";if(Pg(t))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=e.match(n);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function Cg(e=Qt()){return/firefox\//i.test(e)}function Ag(e=Qt()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function Lg(e=Qt()){return/crios\//i.test(e)}function Og(e=Qt()){return/iemobile/i.test(e)}function Pg(e=Qt()){return/android/i.test(e)}function Rg(e=Qt()){return/blackberry/i.test(e)}function Bg(e=Qt()){return/webos/i.test(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vd(e,t=[]){let n;switch(e){case"Browser":n=Ha(Qt());break;case"Worker":n=`${Ha(Qt())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${zr}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ng{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,n){const i=o=>new Promise((r,a)=>{try{const l=t(o);r(l)}catch(l){a(l)}});i.onAbort=n,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const n=[];try{for(const i of this.queue)await i(t),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Fg(e,t={}){return oo(e,"GET","/v2/passwordPolicy",hd(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $g=6;class Hg{constructor(t){var n,i,s,o;const r=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=r.minPasswordLength)!==null&&n!==void 0?n:$g,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),r.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),r.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),r.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),r.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(o=t.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var n,i,s,o,r,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsUppercaseLetter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(r=l.containsNumericCharacter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,n){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=t.length>=i),s&&(n.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,n,i,s,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class jg{constructor(t,n,i,s){this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ja(this),this.idTokenSubscription=new ja(this),this.beforeStateQueue=new Ng(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ld,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ge(n)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await bn.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const n=await pd(this,{idToken:t}),i=await we._fromGetAccountInfoResponse(this,n,t);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var n;if(Vn(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,o=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(t);(!r||r===a)&&(l!=null&&l.user)&&(s=l.user,o=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return W(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(t){try{await Hs(t)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=bg()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Vn(this.app))return Promise.reject(ps(this));const n=t?Bi(t):null;return n&&W(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(t,n=!1){if(!this._deleted)return t&&W(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Vn(this.app)?Promise.reject(ps(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Vn(this.app)?Promise.reject(ps(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ge(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Fg(this),n=new Hg(t);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Ri("auth","Firebase",t())}onAuthStateChanged(t,n,i){return this.registerStateListener(this.authStateSubscription,t,n,i)}beforeAuthStateChanged(t,n){return this.beforeStateQueue.pushCallback(t,n)}onIdTokenChanged(t,n,i){return this.registerStateListener(this.idTokenSubscription,t,n,i)}authStateReady(){return new Promise((t,n)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},n)}})}async revokeAccessToken(t){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await Mg(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,n){const i=await this.getOrInitRedirectPersistenceManager(n);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const n=t&&Ge(t)||this._popupRedirectResolver;W(n,this,"argument-error"),this.redirectPersistenceManager=await bn.create(this,[Ge(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var n,i;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(n=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,n,i,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(W(a,this,"internal-error"),a.then(()=>{r||o(this.currentUser)}),typeof n=="function"){const l=t.addObserver(n,i,s);return()=>{r=!0,l()}}else{const l=t.addObserver(n);return()=>{r=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return W(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=vd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(n["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var t;const n=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return n!=null&&n.error&&gg(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function zg(e){return Bi(e)}class ja{constructor(t){this.auth=t,this.observer=null,this.addObserver=af(n=>this.observer=n)}get next(){return W(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Ug(e,t){const n=(t==null?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Ge);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t==null?void 0:t.popupRedirectResolver)}function Vg(e){return Bi(e).signOut()}new Ni(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ni(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ni(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ni(5e3,15e3);var za="@firebase/auth",Ua="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Wg{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const n=this.auth.onIdTokenChanged(i=>{t((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,n),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const n=this.internalListeners.get(t);n&&(this.internalListeners.delete(t),n(),this.updateProactiveRefresh())}assertAuthConfigured(){W(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Yg(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function qg(e){vi(new yi("auth",(t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:r,authDomain:a}=i.options;W(r&&!r.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:r,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:vd(e)},c=new jg(i,s,o,l);return Ug(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,n,i)=>{t.getProvider("auth-internal").initialize()})),vi(new yi("auth-internal",t=>{const n=zg(t.getProvider("auth").getImmediate());return(i=>new Wg(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),ni(za,Ua,Yg(e)),ni(za,Ua,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gg=300;Kh("authIdTokenMaxAge");qg("Browser");const Eo=e=>e instanceof Rr?e.toDate():e,Vr=e=>e instanceof Date?Rr.fromDate(e):e;function xd(e,t){return{id:e,...t,createdAt:Eo(t.createdAt)||null,dueDate:Eo(t.dueDate)||null,recurrence:t.recurrence??null,completedAt:Eo(t.completedAt)||null}}let lr=[];function Mn(){return lr}function Xg(e,t,n){const i=r=>{typeof n=="function"&&n(r)};if(!e||!t)return i([]),()=>{};const s=Y.tasks(e,t),o=nn(gt(K,s));return Dn(o,r=>{const a=r.docs.map(l=>xd(l.id,l.data()));lr=a,i(a)},r=>{console.error("[Tasks] Subscription error:",r),lr=[],i([])})}async function Kg(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");const n=gt(K,Y.tasks(e,t)),i=gt(K,Y.projects(e,t)),s=gt(K,Y.labels(e)),[o,r,a]=await Promise.all([ei(n),ei(i),ei(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof Rr?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:l(o),projects:l(r),labels:l(a)}}async function _d(e,t,n){const i=Y.tasks(e,t),s={...n};return s.dueDate&&(s.dueDate=Vr(s.dueDate)),await Ke(gt(K,i),{...s,ownerId:e,status:"todo",createdAt:en()})}async function Jg(e,t,n,i){const s=Y.tasks(e,t),o={status:i};i==="completed"?o.completedAt=en():o.completedAt=null,await Oi(Ht(K,s,n),o)}async function Zg(e,t,n,i){const s=Y.tasks(e,t),o={...i};o.dueDate!==void 0&&(o.dueDate=Vr(o.dueDate)),await Oi(Ht(K,s,n),o)}async function Qg(e,t,n){const i=Y.tasks(e,t);await Pi(Ht(K,i,n))}async function tp(e,t,n){const i=Y.tasks(e,t),s=await ph(Ht(K,i,n));return s.exists()?xd(s.id,s.data()):null}async function ep(e,t,n){if(!e||!t||!n)throw new Error("Invalid import parameters.");const{tasks:i=[],projects:s=[],labels:o=[]}=n,r=new Map,a=new Map,l=await ei(gt(K,Y.labels(e))),c=new Map;l.forEach(u=>c.set(u.data().name,u.id));for(const u of o)if(u.name)if(c.has(u.name))a.set(u.id,c.get(u.name));else{const h={...u};delete h.id;const f=await Ke(gt(K,Y.labels(e)),h);a.set(u.id,f.id),c.set(u.name,f.id)}for(const u of s){const h={...u};delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt));const f=await Ke(gt(K,Y.projects(e,t)),h);r.set(u.id,f.id)}const d=i.map(async u=>{const h={...u};return delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt)),typeof h.dueDate=="string"&&(h.dueDate=new Date(h.dueDate)),h.dueDate&&(h.dueDate=Vr(h.dueDate)),h.projectId&&r.has(h.projectId)?h.projectId=r.get(h.projectId):h.projectId=null,Array.isArray(h.labelIds)&&(h.labelIds=h.labelIds.map(f=>a.get(f)).filter(f=>f)),h.ownerId=e,Ke(gt(K,Y.tasks(e,t)),h)});return await Promise.all(d),{tasksCount:i.length,projectsCount:s.length,labelsCount:o.length}}function me(e){if(!e)return null;if(e.toDate&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e;const t=new Date(e);return isNaN(t.getTime())?null:t}function Ft(e=new Date){const t=me(e)||new Date,n=new Date(t);return n.setHours(0,0,0,0),n}function np(e=new Date){const t=me(e)||new Date,n=new Date(t);return n.setHours(23,59,59,999),n}function wd(e=new Date){const t=me(e)||new Date,n=t.getDay(),i=t.getDate()-n+(n===0?-6:1),s=new Date(t.setDate(i));return Ft(s)}function ip(e=new Date){const t=me(e)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function sp(e){const t=me(e);if(!t)return"";const n=new Date,i=Ft(n),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return o!==n.getFullYear()?`${o}/${r}/${a}`:`${r}/${a}`}function op(e){const t=me(e);if(!t)return"text-gray-500";const n=Ft(new Date),i=Math.round((t.getTime()-n.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function rp(e,t){var i;if(!e||!(t!=null&&t.type))return null;const n=new Date(me(e));switch(t.type){case"daily":return n.setDate(n.getDate()+1),n;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=n.getDay();for(let o=1;o<=7;o++)if(t.days.includes((s+o)%7))return n.setDate(n.getDate()+o),n;return null;case"weekdays":do n.setDate(n.getDate()+1);while(n.getDay()===0||n.getDay()===6);return n;case"monthly":return n.setMonth(n.getMonth()+1),n;default:return null}}function kd(e){var n;const t=Ft(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&((n=e.days)==null?void 0:n.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(e.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function Cn(){var t;const e=(t=U.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function An(){const e=ee();if(!e)throw new Error("Workspace required.");return e}async function ap(e){var o;if(e.status!=="completed"||!e.recurrence)return;const{recurrence:t,dueDate:n}=e;if(!n||typeof t!="object"||!t.type)return;const i=rp(n,t);if(!i)return;const s={title:e.title,description:e.description||"",status:"todo",dueDate:i,projectId:e.projectId||null,labelIds:e.labelIds||[],timeBlockId:e.timeBlockId||null,duration:e.duration||null,recurrence:e.recurrence};try{const r=(o=U.currentUser)==null?void 0:o.uid,a=ee();r&&a&&await _d(r,a,s)}catch(r){console.error("[Recurring] Generation failed:",r)}}async function lp(e){const t=Cn(),n=An(),i={...e};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),_d(t,n,i)}async function cp(e,t){const n=Cn(),i=An();if(await Jg(n,i,e,t),t==="completed"){const s=await tp(n,i,e);s&&ap(s).catch(o=>console.error(o))}}async function fn(e,t){const n=Cn(),i=An();return Zg(n,i,e,t)}async function cr(e){const t=Cn(),n=An();return Qg(t,n,e)}async function dp(){const e=Cn(),t=An();return Kg(e,t)}async function up(e){const t=Cn(),n=An();return ep(t,n,e)}let oi=[];function Sd(){return oi}function hp(){oi=[]}function fp(e,t){var r;const n=typeof e=="function"?e:t,i=(r=U.currentUser)==null?void 0:r.uid;if(!i||typeof n!="function")return oi=[],typeof n=="function"&&n([]),()=>{};const s=Y.filters(i),o=nn(gt(K,s));return Dn(o,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));oi=l,n(l)},a=>{console.error("Error subscribing to filters:",a),oi=[],n([])})}async function gp(e){var o;const t=(o=U.currentUser)==null?void 0:o.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t),{id:i,...s}=e;await Ke(gt(K,n),{...s,ownerId:t,createdAt:en()})}async function pp(e,t){var r;const n=(r=U.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Authentication required");const i=Y.filters(n),{id:s,...o}=t;await Oi(Ht(K,i,e),{...o,updatedAt:en()})}async function mp(e){var i;const t=(i=U.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t);await Pi(Ht(K,n,e))}let dr=[];function bp(){return dr}function yp(e,t){if(!e)return t([]),()=>{};const n=Y.labels(e),{db:i}=Vc(),s=nn(gt(i,n));return Dn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));dr=r,t(r)},o=>{console.error("[Labels] Subscription error:",o),dr=[],t([])})}function vp(e,t){var s;const n=typeof e=="function"?e:t,i=(s=U.currentUser)==null?void 0:s.uid;return i&&typeof n=="function"?yp(i,n):(typeof n=="function"&&n([]),()=>{})}let Io=null;function ro(){return Io||(Io=Vc().db),Io}let ms=[];function xp(e,t,n){ms=[];const i=Y.projects(e,t),s=ro(),o=nn(gt(s,i),Pr("createdAt","asc"));return Dn(o,r=>{const a=r.docs.map(l=>({id:l.id,...l.data()}));ms=a,n(a)},r=>{console.error("Error subscribing to projects:",r),ms=[],n([])})}function Wr(){return ms}async function _p(e,t,n){const i=Y.projects(e,t),s=ro();await Ke(gt(s,i),{name:n,ownerId:e,createdAt:en()})}async function wp(e,t,n,i){const s=Y.projects(e,t),o=ro(),r=Ht(o,s,n);return Oi(r,i)}async function kp(e,t,n){const i=Y.projects(e,t),s=ro();await Pi(Ht(s,i,n))}function Ed(){var n;const e=(n=U.currentUser)==null?void 0:n.uid,t=ee();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const Sp=Wr,Ep=(e,t)=>{const n=typeof e=="function"?e:t,i=typeof e=="string"?e:ee(),s=U.currentUser;return s&&i&&typeof n=="function"?xp(s.uid,i,n):(typeof n=="function"&&n([]),()=>{})},Ip=async(e,t=null)=>{const n=U.currentUser;if(!n)throw new Error("Authentication required.");const i=t||ee();if(!i)throw new Error("Workspace selection required.");return _p(n.uid,i,e)},Dp=async(e,t)=>{const{userId:n,workspaceId:i}=Ed();return wp(n,i,e,t)},Id=async e=>{const{userId:t,workspaceId:n}=Ed();return kp(t,n,e)};let ke=[];const Tp=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function Mp(e,t){var o;const n=(o=U.currentUser)==null?void 0:o.uid;if(!n)return ke=[...Tp],typeof t=="function"&&t(ke),()=>{};const i=Y.timeblocks(n),s=nn(gt(K,i),Pr("order","asc"));return Dn(s,r=>{ke=r.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(ke)},r=>{console.error("[TimeBlocks] Subscription error:",r)})}function ge(){return[...ke]}function Dd(e){return ke.find(t=>t.id===e)}function Cp(){ke=[]}async function Ap(e){var n;const t=(n=U.currentUser)==null?void 0:n.uid;if(!t){P("ログインが必要です");return}try{const i=Y.timeblocks(t),s=e.id||crypto.randomUUID(),o=e.order!==void 0?e.order:Math.max(...ke.map(a=>a.order),-1)+1,r={name:e.name,start:e.start,end:e.end,color:e.color,order:o,updatedAt:en()};return await mh(Ht(K,i,s),r,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i)}}async function Lp(e){var n;const t=(n=U.currentUser)==null?void 0:n.uid;if(t)try{const i=Y.timeblocks(t);return await Pi(Ht(K,i,e)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function Op(e,t){const n=U.currentUser;return!n||!e?(typeof t=="function"&&t([]),()=>{}):Xg(n.uid,e,t)}function Td(){const e=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",e);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),js()}function js(){const e=document.getElementById("main-content");if(!e)return;const t=localStorage.getItem("background")||"none";e.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(e.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}const Pp=Object.freeze(Object.defineProperty({__proto__:null,applyBackground:js,initTheme:Td},Symbol.toStringTag,{value:"Module"}));function Rp(e,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),e.addEventListener("click",i=>{i.target===e&&t()}),Vi("app-theme","theme",i=>{document.documentElement.classList.toggle("dark",i==="dark"),js()}),Vi("font-size","fontSize",i=>{const s=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];document.body.classList.remove(...s),document.body.classList.add(`font-app-${i}`)}),Vi("bg-pattern","background",()=>js()),Vi("sidebar-density",B.STORAGE_KEYS.DENSITY,i=>{i==="compact"?localStorage.setItem(B.STORAGE_KEYS.COMPACT,"true"):localStorage.setItem(B.STORAGE_KEYS.COMPACT,"false");const o=["compact","normal","comfortable","spacious"].map(r=>`app-density-${r}`);document.body.classList.remove(...o),document.body.classList.add(`app-density-${i}`),window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{density:i}}))}),Np(),Fp(),$p(),Hp(),jp(),zp(t),Bp()}function Bp(){document.querySelectorAll(".accordion-header").forEach(t=>{t.addEventListener("click",()=>{const n=t.parentElement,i=n.querySelector(".accordion-content"),s=t.querySelector(".accordion-icon"),o=i.style.maxHeight!=="0px"&&i.style.maxHeight!=="";document.querySelectorAll(".settings-accordion").forEach(r=>{if(r!==n){const a=r.querySelector(".accordion-content"),l=r.querySelector(".accordion-icon");a.style.maxHeight="0px",a.classList.remove("opacity-100"),a.classList.add("opacity-0"),l.classList.remove("rotate-180")}}),o?(i.style.maxHeight="0px",i.classList.remove("opacity-100"),i.classList.add("opacity-0"),s.classList.remove("rotate-180")):(i.style.maxHeight=i.scrollHeight+"px",i.classList.remove("opacity-0"),i.classList.add("opacity-100"),s.classList.add("rotate-180"))})}),document.querySelectorAll(".settings-accordion").forEach(t=>{const n=t.querySelector(".accordion-content");n.style.maxHeight||n.classList.contains("opacity-100")&&(n.style.maxHeight=n.scrollHeight+"px")})}function Vi(e,t,n){const i=document.querySelectorAll(`input[name="${e}"]`),s=localStorage.getItem(t),o=["border-blue-500","bg-blue-50","dark:bg-blue-900/20","text-blue-700","dark:text-blue-300"],r=["border-gray-200","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-700/50","text-gray-600","dark:text-gray-300"],a=l=>{i.forEach(c=>{const d=c.parentElement;c===l?(d.classList.remove(...r),d.classList.add(...o)):(d.classList.remove(...o),d.classList.add(...r))})};if(i.forEach(l=>{l.addEventListener("change",c=>{const d=c.target.value;localStorage.setItem(t,d),a(c.target),n(d)})}),s)i.forEach(l=>{l.value===s&&(l.checked=!0)});else{const l=Array.from(i).find(c=>c.checked);l&&localStorage.setItem(t,l.value)}}function Np(){const e=document.querySelector('select[name="font-en-select"]'),t=document.querySelector('select[name="font-jp-select"]');e&&e.addEventListener("change",n=>{ka("EN",n.target.value)}),t&&t.addEventListener("change",n=>{ka("JP",n.target.value)})}function Fp(){const e=document.querySelector('select[name="timezone-select"]');e&&e.addEventListener("change",t=>{localStorage.setItem("timezone",t.target.value),window.dispatchEvent(new CustomEvent("timezone-changed",{detail:{timezone:t.target.value}}))})}function $p(){const e=document.getElementById("export-data-btn-new");e&&(e.onclick=async()=>{const t=e.querySelector("span.font-bold"),n=t?t.textContent:"バックアップを作成";e.disabled=!0,e.classList.add("opacity-70","cursor-wait"),t&&(t.textContent="バックアップ作成中...");try{const i=await dp(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(r),P({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),P({message:"エクスポートに失敗した",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait"),t&&(t.textContent=n)}})}function Hp(){const e=document.getElementById("import-data-btn-new"),t=document.getElementById("import-file-input");!e||!t||(e.onclick=()=>{t.value="",t.click()},t.onchange=n=>{const i=n.target.files[0];if(!i)return;const s=new FileReader;s.onload=async o=>{try{const r=JSON.parse(o.target.result);if(!r.tasks||!r.projects)throw new Error("Invalid backup format");e.disabled=!0,e.classList.add("opacity-70","cursor-wait");const a=await up(r);P({message:`インポート完了！
タスク: ${a.tasksCount}件
プロジェクト: ${a.projectsCount}件
ラベル: ${a.labelsCount}件`,type:"success"}),setTimeout(()=>window.location.reload(),1500)}catch(r){console.error(r),P({message:`インポートに失敗しました。
ファイルが破損している可能性があります。`,type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait")}},s.readAsText(i)})}function jp(){const e=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!e||!t||(e.onclick=async()=>{const n=t.value.trim();if(n.length<6)return P({message:"6文字以上入力してくれ",type:"error"});try{await Ih(n),t.value="",P({message:"パスワードを変更しました",type:"success"})}catch{}})}function zp(e){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Vg(U),e()}catch{P({message:"エラーが発生した",type:"error"})}})}let Va=!1;function Wa(){var e;(e=document.getElementById(B.MODAL_IDS.SETTINGS))==null||e.remove()}function Up(){if(Va)return;Xc(),Fh();const e=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),ao())};document.addEventListener("click",e),Va=!0}function ao(){Wa();const e=Mh(),t=U.currentUser,n=(t==null?void 0:t.email)||"匿名ユーザー",i=(n[0]||"?").toUpperCase(),s=document.createElement("div");s.id=B.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=jh(i,n,e),document.body.appendChild(s),Rp(s,Wa)}function Vp(e=null){const t=!!e,n={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${n.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(e==null?void 0:e.name)||""}" 
                        placeholder="${n.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${n.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function Md(e=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Vp(e),document.body.appendChild(n),Wp(n,e)}function Wp(e,t){const n=e.querySelector("#save-workspace-btn"),i=e.querySelector("#modal-workspace-name"),s=e.querySelector("#cancel-modal-btn"),o=e.querySelector("#workspace-modal-overlay"),r=()=>{document.removeEventListener("keydown",a),e.remove()},a=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",a),o.onclick=c=>{c.target===o&&r()},s&&(s.onclick=r);const l=async()=>{if(n.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return P({message:"ワークスペース名を入力してくれ",type:"error"});if(nr().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return P({message:"その名前は既に使われているぞ",type:"error"});n.disabled=!0,n.textContent=t?"更新中...":"作成中...";try{if(t)await Rh(t.id,c);else{const u=await Gc(c);$r(u.id)}r()}catch(u){n.disabled=!1,n.textContent=t?"保存":"作成",P({message:`失敗した: ${u.message}`,type:"error"})}};n==null||n.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const vt={CONTAINER:"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",DIALOG:"bg-white dark:bg-gray-800 w-full rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] transition-all",WIDTH:{DEFAULT:"max-w-4xl"},HEADER:"px-modal py-modal border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",BODY:"p-modal overflow-y-auto flex-1 min-h-0 custom-scrollbar",FOOTER:"px-modal py-modal bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center gap-modal border-t border-gray-100 dark:border-gray-700",TITLE:"text-lg font-bold text-gray-800 dark:text-white",CLOSE_BUTTON:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",CHECKBOX:"w-4 h-4 accent-blue-600 cursor-pointer"},zs="none",Do={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function Cd(e=null){const t=!!e,n=Sp(),i=ge(),s=[30,45,60,75,90],o=[{id:"today",name:"今日"},{id:"tomorrow",name:"明日"},{id:"week",name:"今週"},{id:"next-week",name:"来週"}],r=Yp((e==null?void 0:e.query)||""),a=document.createElement("div");a.id="filter-creation-modal",a.className=vt.CONTAINER,a.innerHTML=`
        <div class="${vt.DIALOG} ${vt.WIDTH.DEFAULT}" role="dialog" aria-modal="true">
            <div class="${vt.HEADER}">
                <h3 class="${vt.TITLE}">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="${vt.CLOSE_BUTTON}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="${vt.BODY}">
                <div class="space-y-6">
                    <div>
                        <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider">フィルター名</label>
                        <input type="text" id="filter-name" value="${(e==null?void 0:e.name)||""}" 
                               class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                        ${bs("プロジェクト",n,r.project,"filter-project-checkbox")}
                        ${qp(i,r.timeblock)}
                        ${bs("所要時間",s,r.duration,"filter-duration-checkbox",l=>`${l} min`)}
                        ${bs("日付",o,r.date,"filter-date-checkbox")}
                    </div>
                </div>
            </div>
            <div class="${vt.FOOTER}">
                <button id="cancel-filter-btn" class="text-sm font-medium text-gray-500 hover:text-gray-800 transition mr-auto">キャンセル</button>
                <button id="save-filter-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all active:scale-95">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(a),Gp(a,e)}function Yp(e){const t={project:[],timeblock:[],duration:[],date:[]},n=/(\w+):([^ ]+)/g;let i;for(;(i=n.exec(e))!==null;){const[s,o,r]=i;t[o]&&(t[o]=r.split(",").map(a=>o==="timeblock"&&(a==="null"||a==="none")?zs:a))}return t}function bs(e,t,n,i,s=o=>o.name||o){return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${e}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map(o=>{const r=String(o.id||o);return`
                        <label class="flex items-center px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition relative">
                            <input type="checkbox" value="${r}" ${n.includes(r)?"checked":""} class="${i} ${vt.CHECKBOX}">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate pointer-events-none">${s(o)}</span>
                        </label>
                    `}).join("")}
            </div>
        </div>
    `}function qp(e,t){const n=[...e,{id:zs,name:"未定"}];return bs("時間帯",n,t,"filter-timeblock-checkbox",i=>i.id===zs?i.name:`${i.start}-${i.end}`)}function Gp(e,t){const n=()=>{document.removeEventListener("keydown",i),e.remove()},i=s=>s.key==="Escape"&&n();document.addEventListener("keydown",i),e.querySelector("#close-filter-modal").onclick=n,e.querySelector("#cancel-filter-btn").onclick=n,e.onclick=s=>s.target===e&&n(),e.querySelector("#save-filter-btn").onclick=async()=>{const s=e.querySelector("#filter-name").value.trim();if(!s)return P({message:Do.NAME_REQUIRED,type:"error"});const o=c=>Array.from(e.querySelectorAll(`.${c}:checked`)).map(d=>d.value),r=o("filter-timeblock-checkbox").map(c=>c===zs?"null":c),a={project:o("filter-project-checkbox"),timeblock:r,duration:o("filter-duration-checkbox"),date:o("filter-date-checkbox")},l=Object.entries(a).filter(([c,d])=>d.length>0).map(([c,d])=>`${c}:${d.join(",")}`).join(" ");if(!l)return P({message:Do.CONDITION_REQUIRED,type:"error"});try{const c={name:s,query:l,type:"custom"};t?await pp(t.id,c):await gp(c),document.dispatchEvent(new CustomEvent("filters-updated")),n()}catch(c){P({message:Do.SAVE_ERROR+c.message,type:"error"})}}}function Xp(e=null){const t=!!e,n={title:(e==null?void 0:e.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${n.title}" placeholder="${n.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${n.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Ad(e=null){var i;const t="project-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Xp(e),document.body.appendChild(n),Kp(n,e)}function Kp(e,t){const n=()=>e.remove(),i=e.querySelector("#modal-project-name"),s=e.querySelector("#save-project-btn"),o=e.querySelector("#delete-project-btn"),r=e.querySelector("#cancel-modal-btn");r&&(r.onclick=n),e.onclick=l=>{l.target===e&&n()};const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return P({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await Dp(t.id,{name:l});else{const c=ee();if(!c)throw new Error("ワークスペースが選択されていないぞ");await Ip(l,c)}n()}catch(c){P({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),o&&t&&(o.onclick=()=>{P({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await Id(t.id),n()}catch{P({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function _i(e,t,n,i={},s=0,o="normal"){const r=document.createElement("li"),{DENSITY_CLASSES:a,COLORS:l}=B;r.dataset.type=t,r.dataset.id=n;const c=a[o]||a.normal;r.className=`group flex items-center justify-between px-3 ${c} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const u={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3">⏱️</span>',filter:i.iconHtml||'<span class="mr-3">🔍</span>'}[t]||'<span class="mr-3">🔹</span>',h=s>0?`<span class="text-gray-400 font-light mr-2" style="font-size: 0.85em;">${s}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${u}
            <span class="truncate">${e}</span>
        </div>
        <div class="flex items-center">${h}</div>
    `,r}function Yr(e,t,n){var o;const i=Jp(t,n);if(!i)return;(o=document.getElementById("sidebar-context-menu"))==null||o.remove();const s=Zp(i);document.body.appendChild(s),Qp(s,e),tm(s,i)}function To(e,t=null){document.dispatchEvent(new CustomEvent("route-change",{detail:{page:e,id:t}}))}function Jp(e,t){return{project:{editLabel:"編集",onEdit:()=>Ad(t),onDelete:async()=>{await Id(t.id),To("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>Cd(t),onDelete:async()=>{await mp(t.id),To("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>Md(t),onDelete:async()=>{if(nr().length<=1)throw new Error("最後のワークスペースは削除できない。");await Bh(t.id);const s=nr().filter(o=>o.id!==t.id);s.length>0&&($r(s[0].id),To("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[e]}function Zp(e){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${e.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function Qp(e,t){const{clientX:i,clientY:s}=t,o=window.innerWidth,r=window.innerHeight;e.style.visibility="hidden";const{width:a,height:l}=e.getBoundingClientRect();let c=i,d=s;i+a>o&&(c=i-a),s+l>r&&(d=s-l),e.style.left=`${Math.max(8,c)}px`,e.style.top=`${Math.max(8,d)}px`,e.style.visibility="visible"}function tm(e,t){const n=()=>{e.remove(),document.removeEventListener("click",n),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&n();setTimeout(()=>{document.addEventListener("click",n),document.addEventListener("keydown",i)},0),e.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),n(),t.onEdit()},e.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),n(),P({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(o){P({message:"削除に失敗した: "+o.message,type:"error"})}}})}}const Wi={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let Kt=null,ri=null,Ya=!1;function ai(e){Kt&&(e?(Kt.classList.remove(...Wi.MENU_INVISIBLE),Kt.classList.add(...Wi.MENU_VISIBLE),document.addEventListener("click",qa,{capture:!0})):(Kt.classList.remove(...Wi.MENU_VISIBLE),Kt.classList.add(...Wi.MENU_INVISIBLE),document.removeEventListener("click",qa,{capture:!0})))}const qa=e=>{Kt&&!Kt.contains(e.target)&&ri&&!ri.contains(e.target)&&ai(!1)};function Ld(){if(Ya)return;ri=document.getElementById("workspace-trigger"),Kt=document.getElementById("workspace-menu");const e=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!ri||!Kt||(ri.onclick=n=>{n.stopPropagation();const i=Kt.classList.contains("opacity-100");ai(!i)},e&&(e.onclick=()=>{ai(!1),Md(null)}),t&&(t.onclick=()=>{ai(!1),ao()}),document.addEventListener("workspace-changed",n=>{const{workspaceId:i,workspaces:s}=n.detail;Od(s,i)}),Ya=!0)}function Od(e,t=ee()){const n=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(n&&em(e,n,t),i){const s=e.find(o=>o.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function em(e,t,n){t.innerHTML="",e.forEach(i=>{const s=i.id===n,o=document.createElement("button");o.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const r=document.createElement("span");if(r.className="truncate pointer-events-none",r.textContent=i.name,o.appendChild(r),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,o.appendChild(a.firstElementChild)}o.onclick=()=>{s||$r(i.id),ai(!1)},o.oncontextmenu=a=>{a.preventDefault(),Yr(a,"workspace",i)},t.appendChild(o)})}const{Z_INDEX:yn}=Th,nm=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${yn.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${yn.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${B.DEFAULT_WIDTH}px;">
        ${im()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${yn.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,im=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,sm=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${yn.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${yn.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700 z-50">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar bg-white dark:bg-gray-800" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1 bg-white dark:bg-gray-800">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function om(){const e=document.getElementById("app");e&&(e.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${nm()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${sm()}
                <div id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar scroll-smooth">
                    <div class="w-full max-w-4xl mx-auto">
                        <div id="task-view" class="w-full animate-fade-in transition-opacity duration-150"></div>
                        <div id="search-view" class="hidden w-full animate-fade-in"></div>
                        <div id="dashboard-view" class="hidden w-full animate-fade-in"></div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${yn.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{Yc(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),Ld(),am(),rm()}))}function rm(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),n=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=o=>{const r=e.classList.contains("-translate-x-full"),a=o??!r;e.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};n==null||n.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function am(){document.addEventListener("keydown",e=>{const t=["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.closest("[contenteditable]"),n=document.querySelector('[role="dialog"]');if(e.key==="/"&&!t&&!n){const i=document.getElementById("page-search-input");i&&(e.preventDefault(),i.focus())}})}function lm(e){if(!e)return"";const t=e.toDate?e.toDate():new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${i}-${s}`}const cm="task_modal_schedule_open";function dm(e=[]){return["日","月","火","水","木","金","土"].map((n,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer">
            <input type="checkbox" data-day-index="${i}" ${e.includes(i)?"checked":""} 
                   class="${vt.CHECKBOX}">
            <span class="text-xs text-gray-700 dark:text-gray-300 pointer-events-none relative z-10">${n}</span>
        </label>
    `).join("")}function Ga(e,t,n){return e.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${n(i)}
        </option>
    `).join("")}function um(e){let t=e.dueDate;const n=e.recurrence||{type:"none",days:[]};n.type!=="none"&&!t&&(t=kd(n));const i=t?lm(t.toDate?t.toDate():new Date(t)):"",s=Ga(ge(),e.timeBlockId,c=>`${c.start} - ${c.end}`),o=Ga([30,45,60,75,90],e.duration,c=>`${c} min`),r=i||n.type!=="none"||e.timeBlockId||e.duration,a=localStorage.getItem(cm);let l=r;return a!==null?l=a==="true":r&&(l=!0),`
        <div class="${vt.CONTAINER}">
            <div class="${vt.DIALOG} ${vt.WIDTH.DEFAULT}" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="${vt.HEADER}">
                    <input type="text" id="modal-task-title" value="${e.title}" placeholder="タスクのタイトル"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="${vt.CLOSE_BUTTON}">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ (2カラムレイアウト) -->
                <div class="${vt.BODY} bg-gray-50/30 dark:bg-gray-900/10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
                        <!-- コンテンツ省略なしで維持 -->
                        <!-- 左カラム (8/12): メモ -->
                        <div class="md:col-span-8 flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    メモ (Markdown)
                                </label>
                                <div class="flex items-center gap-2">
                                    <div class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-md p-0.5">
                                        <button type="button" id="md-bold-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="太字 (Ctrl+B)">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6V4zm0 8h9a4 4 0 014 4 4 4 0 01-4 4H6v-8z"></path></svg>
                                        </button>
                                        <div class="w-px h-3 bg-gray-300 dark:bg-gray-600 mx-0.5"></div>
                                        <button type="button" id="md-list-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="箇条書き">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <button type="button" id="md-ordered-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="番号付きリスト">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7v.01M3 12v.01M3 17v.01"></path></svg>
                                        </button>
                                    </div>
                                    <button id="toggle-memo-view" class="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-2 py-0.5 rounded transition-colors text-xs font-medium ml-2">プレビュー</button>
                                </div>
                            </div>
                            <div class="flex-1 relative min-h-[200px]">
                                <textarea id="modal-task-desc" placeholder="詳細を入力..."
                                    class="w-full h-full p-3 bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg outline-none text-sm transition-all resize-y leading-relaxed focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono">${e.description||""}</textarea>
                                <div id="modal-task-desc-preview" class="hidden absolute inset-0 w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- 右カラム (4/12): スケジュール設定 -->
                        <div class="md:col-span-4 space-y-4">
                            <details id="modal-task-schedule-details" class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm" ${l?"open":""}>
                                <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50">
                                    <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        スケジュール
                                    </span>
                                    <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </span>
                                </summary>
                                
                                <div class="p-4 flex flex-col gap-4">
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                        <div class="relative">
                                            <input type="date" id="modal-task-date" value="${i}"
                                                class="w-full pl-3 pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:justify-end [&::-webkit-calendar-picker-indicator]:cursor-pointer">
                                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 dark:text-gray-400">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                        <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="none" ${n.type==="none"?"selected":""}>なし</option>
                                            <option value="daily" ${n.type==="daily"?"selected":""}>毎日</option>
                                            <option value="weekdays" ${n.type==="weekdays"?"selected":""}>平日</option>
                                            <option value="weekly" ${n.type==="weekly"?"selected":""}>毎週</option>
                                            <option value="monthly" ${n.type==="monthly"?"selected":""}>毎月</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                        <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">未定</option>
                                            ${s}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                        <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">指定なし</option>
                                            ${o}
                                        </select>
                                    </div>

                                    <div id="recurrence-days-container" class="${n.type!=="weekly"?"hidden":""} pt-2 border-t border-gray-100 dark:border-gray-700">
                                        <label class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</label>
                                        <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                            ${dm(n.days)}
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                    </div>
                </div>

                <!-- フッター -->
                <div class="${vt.FOOTER}">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition mr-auto">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                    <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                </div>
            </div>
        </div>
    `}function hm(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Pd(e){if(!e)return"";const t=e.split(`
`);let n=[],i=null;return t.forEach(s=>{const o=s.trimStart(),r=o.startsWith("* ")||o.startsWith("- "),a=/^\d+\.\s/.test(o),l=r||a;if(l){const c=a?"ol":"ul";if(i!==c){i&&n.push(`</${i}>`);const d=a?"list-decimal":"list-disc";n.push(`<${c} class="${d} ml-5 space-y-1">`),i=c}}else i&&(n.push(`</${i}>`),i=null);if(l){let c="";r?c=o.substring(2):c=o.replace(/^\d+\.\s/,"");const d=Xa(c);n.push(`<li>${d}</li>`)}else s.trim()?n.push(`<p class="mb-2">${Xa(s)}</p>`):i&&(n.push(`</${i}>`),i=null)}),i&&n.push(`</${i}>`),n.join(`
`)}function Xa(e){return hm(e).replace(/\[(.*?)\]\((.*?)\)/g,(n,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}function Ka(e,t,n=""){const i=e.selectionStart,s=e.selectionEnd,o=e.value,r=o.substring(i,s);let a=o.substring(0,i),l=o.substring(s),c="",d=0;if(n)c=a+t+r+n+l,d=s+t.length+n.length,i===s&&(d-=n.length);else if(i!==s){const h=r.split(`
`).map(f=>t+f).join(`
`);c=a+h+l,d=i+h.length}else c=a+t+l,d=i+t.length;e.value=c,e.focus(),e.selectionEnd=d,n&&i===s?(e.selectionStart=i+t.length,e.selectionEnd=i+t.length):n&&(e.selectionStart=i,e.selectionEnd=s+t.length+n.length),e.dispatchEvent(new Event("input"))}function Ja(e,t){const n=e.selectionStart,i=e.selectionEnd,s=e.value;let o=s.lastIndexOf(`
`,n-1)+1,r=s.indexOf(`
`,i);r===-1&&(r=s.length);const l=s.substring(o,r).split(`
`),c=/^(\s*)([-*]|\d+\.)(\s+)/,u=l.map(h=>{const f=h.match(c);if(f){const g=f[2],p=/^\d+\.\s*$/.test(t),m=/^\d+\.$/.test(g),b=/^[-*]$/.test(g);return p&&m||!p&&b?h.replace(c,"$1"):h.replace(c,`$1${t}`)}else return t+h}).join(`
`);e.setRangeText(u,o,r,"select"),e.dispatchEvent(new Event("input")),e.focus()}function fm(){const e=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),n=document.getElementById("toggle-memo-view"),i=document.getElementById("md-bold-btn"),s=document.getElementById("md-list-btn"),o=document.getElementById("md-ordered-btn");if(!e||!t)return;n&&n.classList.add("hidden");const r=()=>{e.classList.remove("hidden"),t.classList.add("hidden"),e.focus()},a=()=>{const c=Pd(e.value);t.innerHTML=c||'<span class="text-gray-400 cursor-text">メモを入力...</span>',e.classList.add("hidden"),t.classList.remove("hidden")};e.value.trim()?a():r(),t.addEventListener("click",r),e.addEventListener("blur",()=>{a()}),e.addEventListener("input",()=>{}),e.addEventListener("keydown",c=>{(c.ctrlKey||c.metaKey)&&c.key==="b"&&(c.preventDefault(),Ka(e,"**","**"))});const l=(c,d)=>{c&&(c.addEventListener("mousedown",u=>u.preventDefault()),c.addEventListener("click",d))};l(i,()=>Ka(e,"**","**")),l(s,()=>Ja(e,"- ")),l(o,()=>Ja(e,"1. "))}function gm(){const e=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),n=document.getElementById("modal-task-date");if(!e||!t||!n)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(r,a=[])=>{if(r==="weekly"&&a.length===0)return;const l=kd({type:r,days:a});n.value=l.toISOString().substring(0,10)},o=()=>Array.from(i).filter(r=>r.checked).map(r=>parseInt(r.dataset.dayIndex??"0",10));e.addEventListener("change",r=>{const a=r.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?o():[];s(a,c)}}),i.forEach(r=>{r.addEventListener("change",()=>{const a=o();s("weekly",a)})})}let oe={};function pm(e){oe={title:e.querySelector("#modal-task-title"),desc:e.querySelector("#modal-task-desc"),date:e.querySelector("#modal-task-date"),recurrence:e.querySelector("#modal-task-recurrence"),timeblock:e.querySelector("#modal-task-timeblock"),duration:e.querySelector("#modal-task-duration"),saveBtn:e.querySelector("#save-task-modal-btn"),deleteBtn:e.querySelector("#delete-task-modal-btn"),closeBtn:e.querySelector("#close-modal-btn"),cancelBtn:e.querySelector("#cancel-modal-btn"),overlay:e.querySelector("div.fixed")}}function mm(e,t,n){pm(e);const{closeBtn:i,cancelBtn:s,overlay:o,saveBtn:r,deleteBtn:a}=oe;[i,s].forEach(d=>d==null?void 0:d.addEventListener("click",n)),o==null||o.addEventListener("click",d=>{d.target===d.currentTarget&&n()});const l=e.querySelector("#modal-task-schedule-details");l&&l.addEventListener("toggle",()=>{localStorage.setItem("task_modal_schedule_open",l.open)}),r==null||r.addEventListener("click",async()=>{await bm(t,n)}),a==null||a.addEventListener("click",()=>{P({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await cr(t.id),n()}catch{P({message:"削除に失敗した",type:"error"})}}})});const c=oe.date;c&&c.addEventListener("click",d=>{if(typeof c.showPicker=="function")try{c.showPicker()}catch(u){console.debug("showPicker failed or already open",u)}}),gm(),fm()}async function bm(e,t){var d,u,h,f,g,p,m,b;const n=(u=(d=oe.title)==null?void 0:d.value)==null?void 0:u.trim();if(!n){P({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=oe.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){P({message:"無効な日付だ",type:"error"});return}const o=(f=oe.recurrence)==null?void 0:f.value;let r=null;if(o!=="none"&&(r={type:o},o==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(v=>parseInt(v.dataset.dayIndex??"",10)).filter(v=>!isNaN(v)).sort((v,_)=>v-_);if(y.length===0){P({message:"曜日を選択してくれ",type:"error"});return}r.days=y}const a=parseInt((g=oe.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:n,description:((m=(p=oe.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:r,timeBlockId:((b=oe.timeblock)==null?void 0:b.value)||null,duration:l};try{await fn(e.id,c),t()}catch(y){console.error("Failed to update task:",y),P({message:"保存に失敗した",type:"error"})}}const Rd=e=>{e.key==="Escape"&&Bd()};function ym(e){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=um(e),mm(t,e,Bd),document.addEventListener("keydown",Rd)}function Bd(){const e=document.getElementById("modal-container");e&&(e.innerHTML="",document.removeEventListener("keydown",Rd))}const qr=e=>`${B.STORAGE_KEYS.SECTION_PREFIX}${e}`,vm={basic:{title:"基本項目",listId:B.LIST_IDS.BASIC,renderContent:e=>`
                ${Yi("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${Yi("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${Yi("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${Yi("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            `},projects:{title:"プロジェクト",listId:B.LIST_IDS.PROJECTS,hasAddButton:!0,buttonId:"add-project-btn"},timeblocks:{title:"時間帯",listId:B.LIST_IDS.TIMEBLOCKS,hasAddButton:!0,buttonId:"edit-timeblocks-btn"},durations:{title:"所要時間",listId:B.LIST_IDS.DURATIONS},filters:{title:"フィルター",listId:B.LIST_IDS.FILTERS,hasAddButton:!0,buttonId:"add-filter-btn"}},Nd=["basic","projects","timeblocks","durations","filters"];function xm(){try{const e=localStorage.getItem(B.STORAGE_KEYS.SECTION_ORDER);if(e)return JSON.parse(e)}catch(e){console.error("Failed to parse section order",e)}return Nd}function _m(e,t,n=!1,i=""){const s=Nr(qr(t),!0),o=s?"rotate-0":"-rotate-90",r=n?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${e}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${o} section-arrow" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${e}</h3>
            </div>
            ${r}
        </div>
    `}function wm(e,t=""){const n=Nr(qr(e),!0);return`<ul id="${e}" class="space-y-0.5 mb-2 pl-1 ${n?"":"hidden"}">${t}</ul>`}function Yi(e,t,n,i=""){return`
        <li>
            <a href="#" id="${e}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${n}</span>
                ${i}
            </a>
        </li>
    `}function km(){const e=xm();return Nd.forEach(n=>{e.includes(n)||e.push(n)}),`<div class="mt-2 select-none" id="sidebar-sections-wrapper">${e.map(n=>{const i=vm[n];if(!i)return"";const s=i.renderContent?i.renderContent(i.listId):"";return`
            <div class="sidebar-section-container transition-all duration-200" draggable="true" data-section-key="${n}">
                ${_m(i.title,i.listId,i.hasAddButton,i.buttonId)}
                ${wm(i.listId,s)}
            </div>
        `}).join("")}</div>`}function Sm(){document.querySelectorAll(".sidebar-section-header").forEach(e=>{const t=e.dataset.target,n=document.getElementById(t),i=e.querySelector(".section-arrow");!n||!i||(e.onclick=s=>{if(s.target.closest("button"))return;const r=!n.classList.toggle(B.CLASSES.HIDDEN);i.classList.toggle("rotate-0",r),i.classList.toggle("-rotate-90",!r),e.setAttribute("aria-expanded",r),localStorage.setItem(qr(t),r)})})}function Em(){const e=document.getElementById("sidebar-sections-wrapper");if(!e)return;let t=null;e.querySelectorAll(".sidebar-section-container").forEach(i=>{i.addEventListener("dragstart",s=>{t=i,s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",i.dataset.sectionKey),i.classList.add("opacity-50","bg-gray-100","dark:bg-gray-800")}),i.addEventListener("dragend",s=>{i.classList.remove("opacity-50","bg-gray-100","dark:bg-gray-800"),e.querySelectorAll(".sidebar-section-container").forEach(o=>{o.classList.remove("border-t-2","border-blue-500")})}),i.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t!==i&&i.classList.add("border-t-2","border-blue-500")}),i.addEventListener("dragleave",s=>{i.classList.remove("border-t-2","border-blue-500")}),i.addEventListener("drop",s=>(s.stopPropagation(),s.preventDefault(),t!==i&&(e.insertBefore(t,i),Im(e)),!1))})}function Im(e){const t=e.querySelectorAll(".sidebar-section-container"),n=Array.from(t).map(i=>i.dataset.sectionKey);localStorage.setItem(B.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(n))}function wi(e,t,n=null){if(!e)return;let i=0;const s=B.CLASSES.DRAG_OVER;e.addEventListener("dragenter",o=>{o.preventDefault(),i++,e.classList.add(...s)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.contains("ring-2")||e.classList.add(...s)}),e.addEventListener("dragleave",o=>{o.preventDefault(),i--,i<=0&&(e.classList.remove(...s),i=0)}),e.addEventListener("drop",async o=>{o.preventDefault(),i=0,e.classList.remove(...s);const r=o.dataTransfer.getData("text/plain");r&&await Dm(r,t,n)})}async function Dm(e,t,n){const i={},{DURATION_LIMITS:s}=B;switch(t){case"inbox":i.projectId=null;break;case"project":n&&(i.projectId=n);break;case"timeblock":i.timeBlockId=n==="unassigned"||!n?null:n;break;case"duration":{const o=parseInt(n,10);if(!isNaN(o)&&o>=s.MIN&&o<=s.MAX)i.duration=o;else{P({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),P({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await fn(e,i)}catch(o){console.error(`[Drop Error] Type: ${t}, Task: ${e}`,o),P({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const Za=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),Qa=["00","15","30","45"];function Tm(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] relative animate-fade-in-up">
            <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition duration-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-8 overflow-y-auto flex-1 space-y-4 custom-scrollbar relative" id="tb-scroll-container">
                <div id="tb-list" class="space-y-2"></div> <!-- space-y-2 for tighter spacing -->
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed group">
                </button>

                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs opacity-80">デフォルトのゾーン</span>
                </div>
            </div>

            <div class="px-8 py-5 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none">完了</button>
            </div>

            <!-- Global Color Picker Popover (Hidden by default) -->
            <div id="tb-color-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 p-4 w-64 animate-fade-in-up">
                <div class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">プリセット</div>
                <div class="grid grid-cols-5 gap-3 mb-5" id="tb-color-presets">
                    <!-- Presets injected by JS -->
                </div>
                <div class="flex justify-between items-end mb-3">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">カスタム</div>
                    <button id="tb-custom-color-edit-btn" class="text-xs text-blue-500 hover:text-blue-600 font-medium transition-colors">編集</button>
                    <input type="color" id="tb-custom-color-input" class="invisible w-0 h-0 absolute">
                </div>
                <div class="grid grid-cols-5 gap-3" id="tb-color-customs">
                    <!-- Custom slots injected by JS -->
                </div>
            </div>
        </div>
    `}function qi(e,t,n){const i=e.map(s=>`<div class="tb-select-option px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer text-sm transition-colors ${s===t?"bg-blue-50 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}" data-value="${s}">${s}</div>`).join("");return`
        <div class="relative tb-custom-select group min-w-[64px]" data-type="${n}" data-value="${t}">
            <button type="button" class="tb-select-trigger w-full py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-center shadow-sm hover:border-gray-300 dark:hover:border-gray-500 hover:shadow-md focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-400 transition-all flex items-center justify-center font-mono font-medium text-gray-700 dark:text-gray-200">
                <span class="value-display">${t}</span>
            </button>
            <div class="hidden tb-select-options absolute top-full left-0 mt-2 w-full min-w-[70px] max-h-56 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-xl z-20 custom-scrollbar animate-fade-in-down origin-top-left">
                ${i}
            </div>
        </div>
    `}function Mm(e){const[t,n]=e.start.split(":"),[i,s]=e.end.split(":");return`
        <div class="flex-shrink-0 relative pl-2 cursor-grab active:cursor-grabbing handle p-1 rounded-md text-gray-400 hover:text-gray-600" title="移動">
             <div class="tb-color-trigger w-6 h-6 rounded-full shadow-sm hover:scale-110 active:scale-95 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900 cursor-pointer" 
                style="background-color: ${e.color}" data-color="${e.color}" title="色を変更"></div>
        </div>
        
        <div class="flex-1 flex items-center gap-4 px-2 handle cursor-grab active:cursor-grabbing">
            <div class="flex items-center gap-2">
                ${qi(Za,t,"start-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${qi(Qa,n,"start-m")}
            </div>
            
            <div class="w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
            
            <div class="flex items-center gap-2">
                ${qi(Za,i,"end-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${qi(Qa,s,"end-m")}
            </div>
        </div>

        <div class="flex items-center pr-2">
            <button class="delete-btn p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const Us=5,tl={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${Us}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${Us}個)</span>`};function el(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return t*60+n}function Vs(e,t){if(!e)return;const n=t>=Us;e.disabled=n,e.innerHTML=n?tl.LIMIT:tl.ADD}const Cm=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6"],Fd="timeblock_custom_colors";let ys=null,rn=-1;function nl(){try{const e=localStorage.getItem(Fd);return e?JSON.parse(e):["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}catch{return["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}}function Am(e){localStorage.setItem(Fd,JSON.stringify(e))}function Lm(e){const t=document.getElementById("tb-color-picker"),n=document.getElementById("tb-color-presets"),i=document.getElementById("tb-color-customs"),s=document.getElementById("tb-custom-color-input"),o=document.getElementById("tb-custom-color-edit-btn");if(!t||!n||!i)return;n.innerHTML=Cm.map(a=>`
        <button class="w-8 h-8 rounded-full shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400"
            style="background-color: ${a}" data-color="${a}"></button>
    `).join("");const r=()=>{const a=nl();i.innerHTML=a.map((l,c)=>`
            <button class="custom-color-slot w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 relative overflow-hidden"
                style="background-color: ${l}" data-index="${c}" data-color="${l}">
                <div class="absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"></div>
            </button>
        `).join("")};r(),t.addEventListener("click",a=>{const l=a.target.closest("button[data-color]");if(l&&!l.classList.contains("custom-color-slot")){const c=l.dataset.color;Mo(c,t)}else if(l&&l.classList.contains("custom-color-slot")){rn=parseInt(l.dataset.index),document.querySelectorAll(".custom-color-slot").forEach(d=>d.classList.remove("ring-offset-2","ring-2","ring-blue-500")),l.classList.add("ring-offset-2","ring-2","ring-blue-500");const c=l.dataset.color;c!=="#E5E7EB"&&Mo(c,t)}}),o.onclick=()=>{rn===-1&&(rn=0),s.click()},s.onchange=a=>{rn===-1&&(rn=0);const l=a.target.value,c=nl();c[rn]=l,Am(c),r(),Mo(l,t)}}function Mo(e,t){ys&&(ys.style.backgroundColor=e,ys.dataset.color=e,t.classList.add("hidden"))}function Om(e){var a;ys=e;const t=document.getElementById("tb-color-picker");if(!t)return;const n=e.getBoundingClientRect(),i=(a=document.getElementById("tb-scroll-container"))==null?void 0:a.parentElement;if(!i)return;const s=i.getBoundingClientRect();let o=n.bottom-s.top+10,r=n.left-s.left;r+280>s.width&&(r=s.width-290),t.style.top=`${o}px`,t.style.left=`${r}px`,t.classList.remove("hidden")}function Pm(){const e=document.getElementById("tb-color-picker");e&&e.classList.add("hidden")}function Rm(e,t){const n=e.querySelector('.tb-custom-select[data-type="start-h"]').dataset.value,i=e.querySelector('.tb-custom-select[data-type="start-m"]').dataset.value,s=e.querySelector('.tb-custom-select[data-type="end-h"]').dataset.value,o=e.querySelector('.tb-custom-select[data-type="end-m"]').dataset.value,r=e.querySelector(".tb-color-trigger").dataset.color;return{id:e.dataset.id||null,start:`${n}:${i}`,end:`${s}:${o}`,color:r,order:t}}function Bm(e){const t=e.dataset.id;if(!t){e.remove(),Vs(document.getElementById("add-tb-btn"),ge().length);return}e.style.opacity="0",e.style.transform="translateX(-20px)",setTimeout(()=>{P({message:`削除しますか？
（完了ボタンを押さなくても、削除は即時反映されます）`,type:"confirm",onConfirm:async()=>{try{await Lp(t),e.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),Vs(document.getElementById("add-tb-btn"),ge().length)}catch{P({message:"削除に失敗しました",type:"error"})}},onCancel:()=>{e.style.opacity="1",e.style.transform="translate(0)"}})},200)}async function Nm(e,t){const i=Array.from(document.querySelectorAll(".tb-row")).map((o,r)=>Rm(o,r));for(const o of i){const r=el(o.start),a=el(o.end);if(r>=a)return P({message:`時間設定が不正です: ${o.start} - ${o.end}
(終了時間は開始時間より後にしてください)`,type:"error"})}e.disabled=!0;const s=e.textContent;e.textContent="保存中...";try{const o=i.map(r=>Ap({id:r.id,name:`${r.start}-${r.end}`,start:r.start,end:r.end,color:r.color,order:r.order}));await Promise.all(o),document.dispatchEvent(new CustomEvent("timeblocks-updated")),t()}catch(o){console.error("Timeblock save error (suppressed):",o)}finally{e.disabled=!1,e.textContent=s}}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function il(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?il(Object(n),!0).forEach(function(i){Fm(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):il(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function vs(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?vs=function(t){return typeof t}:vs=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},vs(e)}function Fm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pe(){return pe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},pe.apply(this,arguments)}function $m(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Hm(e,t){if(e==null)return{};var n=$m(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var jm="1.15.6";function he(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var be=he(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Fi=he(/Edge/i),sl=he(/firefox/i),li=he(/safari/i)&&!he(/chrome/i)&&!he(/android/i),Gr=he(/iP(ad|od|hone)/i),$d=he(/chrome/i)&&he(/android/i),Hd={capture:!1,passive:!1};function H(e,t,n){e.addEventListener(t,n,!be&&Hd)}function F(e,t,n){e.removeEventListener(t,n,!be&&Hd)}function Ws(e,t){if(t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function jd(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Ut(e,t,n,i){if(e){n=n||document;do{if(t!=null&&(t[0]===">"?e.parentNode===n&&Ws(e,t):Ws(e,t))||i&&e===n)return e;if(e===n)break}while(e=jd(e))}return null}var ol=/\s+/g;function At(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(ol," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(ol," ")}}function M(e,t,n){var i=e&&e.style;if(i){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=n+(typeof n=="string"?"":"px")}}function vn(e,t){var n="";if(typeof e=="string")n=e;else do{var i=M(e,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(n)}function zd(e,t,n){if(e){var i=e.getElementsByTagName(t),s=0,o=i.length;if(n)for(;s<o;s++)n(i[s],s);return i}return[]}function Jt(){var e=document.scrollingElement;return e||document.documentElement}function dt(e,t,n,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var o,r,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==Jt()?(o=e.getBoundingClientRect(),r=o.top,a=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(r=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(s=s||e.parentNode,!be))do if(s&&s.getBoundingClientRect&&(M(s,"transform")!=="none"||n&&M(s,"position")!=="static")){var h=s.getBoundingClientRect();r-=h.top+parseInt(M(s,"border-top-width")),a-=h.left+parseInt(M(s,"border-left-width")),l=r+o.height,c=a+o.width;break}while(s=s.parentNode);if(i&&e!==window){var f=vn(s||e),g=f&&f.a,p=f&&f.d;f&&(r/=p,a/=g,u/=g,d/=p,l=r+d,c=a+u)}return{top:r,left:a,bottom:l,right:c,width:u,height:d}}}function rl(e,t,n){for(var i=Se(e,!0),s=dt(e)[t];i;){var o=dt(i)[n],r=void 0;if(r=s>=o,!r)return i;if(i===Jt())break;i=Se(i,!1)}return!1}function kn(e,t,n,i){for(var s=0,o=0,r=e.children;o<r.length;){if(r[o].style.display!=="none"&&r[o]!==C.ghost&&(i||r[o]!==C.dragged)&&Ut(r[o],n.draggable,e,!1)){if(s===t)return r[o];s++}o++}return null}function Xr(e,t){for(var n=e.lastElementChild;n&&(n===C.ghost||M(n,"display")==="none"||t&&!Ws(n,t));)n=n.previousElementSibling;return n||null}function Nt(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==C.clone&&(!t||Ws(e,t))&&n++;return n}function al(e){var t=0,n=0,i=Jt();if(e)do{var s=vn(e),o=s.a,r=s.d;t+=e.scrollLeft*o,n+=e.scrollTop*r}while(e!==i&&(e=e.parentNode));return[t,n]}function zm(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n)}return-1}function Se(e,t){if(!e||!e.getBoundingClientRect)return Jt();var n=e,i=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var s=M(n);if(n.clientWidth<n.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Jt();if(i||t)return n;i=!0}}while(n=n.parentNode);return Jt()}function Um(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function Co(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var ci;function Ud(e,t){return function(){if(!ci){var n=arguments,i=this;n.length===1?e.call(i,n[0]):e.apply(i,n),ci=setTimeout(function(){ci=void 0},t)}}}function Vm(){clearTimeout(ci),ci=void 0}function Vd(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function Wd(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function Yd(e,t,n){var i={};return Array.from(e.children).forEach(function(s){var o,r,a,l;if(!(!Ut(s,t.draggable,e,!1)||s.animated||s===n)){var c=dt(s);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,c.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,c.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,c.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Tt="Sortable"+new Date().getTime();function Wm(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(M(s,"display")==="none"||s===C.ghost)){e.push({target:s,rect:dt(s)});var o=te({},e[e.length-1].rect);if(s.thisAnimationDuration){var r=vn(s,!0);r&&(o.top-=r.f,o.left-=r.e)}s.fromRect=o}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(zm(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var o=!1,r=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,u=dt(c),h=c.prevFromRect,f=c.prevToRect,g=a.rect,p=vn(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&Co(h,u)&&!Co(d,u)&&(g.top-u.top)/(g.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(l=qm(g,h,f,s.options)),Co(u,d)||(c.prevFromRect=d,c.prevToRect=u,l||(l=s.options.animation),s.animate(c,g,u,l)),l&&(o=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),o?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),e=[]},animate:function(i,s,o,r){if(r){M(i,"transition",""),M(i,"transform","");var a=vn(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-o.left)/(l||1),u=(s.top-o.top)/(c||1);i.animatingX=!!d,i.animatingY=!!u,M(i,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=Ym(i),M(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),M(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){M(i,"transition",""),M(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Ym(e){return e.offsetWidth}function qm(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}var an=[],Ao={initializeByDefault:!0},$i={mount:function(t){for(var n in Ao)Ao.hasOwnProperty(n)&&!(n in t)&&(t[n]=Ao[n]);an.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),an.push(t)},pluginEvent:function(t,n,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";an.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][o]&&n[r.pluginName][o](te({sortable:n},i)),n.options[r.pluginName]&&n[r.pluginName][t]&&n[r.pluginName][t](te({sortable:n},i)))})},initializePlugins:function(t,n,i,s){an.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,n,t.options);c.sortable=t,c.options=t.options,t[l]=c,pe(i,c.defaults)}});for(var o in t.options)if(t.options.hasOwnProperty(o)){var r=this.modifyOption(t,o,t.options[o]);typeof r<"u"&&(t.options[o]=r)}},getEventProperties:function(t,n){var i={};return an.forEach(function(s){typeof s.eventProperties=="function"&&pe(i,s.eventProperties.call(n[s.pluginName],t))}),i},modifyOption:function(t,n,i){var s;return an.forEach(function(o){t[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[n]=="function"&&(s=o.optionListeners[n].call(t[o.pluginName],i))}),s}};function Gm(e){var t=e.sortable,n=e.rootEl,i=e.name,s=e.targetEl,o=e.cloneEl,r=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,f=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[Tt],!!t){var p,m=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!be&&!Fi?p=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(i,!0,!0)),p.to=r||n,p.from=a||n,p.item=s||n,p.clone=o,p.oldIndex=l,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=f?f.lastPutMode:void 0;var y=te(te({},g),$i.getEventProperties(i,t));for(var v in y)p[v]=y[v];n&&n.dispatchEvent(p),m[b]&&m[b].call(t,p)}}var Xm=["evt"],It=function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,o=Hm(i,Xm);$i.pluginEvent.bind(C)(t,n,te({dragEl:E,parentEl:ot,ghostEl:L,rootEl:et,nextEl:We,lastDownEl:xs,cloneEl:st,cloneHidden:_e,dragStarted:Wn,putSortable:bt,activeSortable:C.active,originalEvent:s,oldIndex:gn,oldDraggableIndex:di,newIndex:Lt,newDraggableIndex:xe,hideGhostForTarget:Kd,unhideGhostForTarget:Jd,cloneNowHidden:function(){_e=!0},cloneNowShown:function(){_e=!1},dispatchSortableEvent:function(a){Et({sortable:n,name:a,originalEvent:s})}},o))};function Et(e){Gm(te({putSortable:bt,cloneEl:st,targetEl:E,rootEl:et,oldIndex:gn,oldDraggableIndex:di,newIndex:Lt,newDraggableIndex:xe},e))}var E,ot,L,et,We,xs,st,_e,gn,Lt,di,xe,Gi,bt,hn=!1,Ys=!1,qs=[],$e,zt,Lo,Oo,ll,cl,Wn,ln,ui,hi=!1,Xi=!1,_s,xt,Po=[],ur=!1,Gs=[],lo=typeof document<"u",Ki=Gr,dl=Fi||be?"cssFloat":"float",Km=lo&&!$d&&!Gr&&"draggable"in document.createElement("div"),qd=(function(){if(lo){if(be)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),Gd=function(t,n){var i=M(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=kn(t,0,n),r=kn(t,1,n),a=o&&M(o),l=r&&M(r),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+dt(o).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+dt(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[dl]==="none"||r&&i[dl]==="none"&&c+d>s)?"vertical":"horizontal"},Jm=function(t,n,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,r=i?t.width:t.height,a=i?n.left:n.top,l=i?n.right:n.bottom,c=i?n.width:n.height;return s===a||o===l||s+r/2===a+c/2},Zm=function(t,n){var i;return qs.some(function(s){var o=s[Tt].options.emptyInsertThreshold;if(!(!o||Xr(s))){var r=dt(s),a=t>=r.left-o&&t<=r.right+o,l=n>=r.top-o&&n<=r.bottom+o;if(a&&l)return i=s}}),i},Xd=function(t){function n(o,r){return function(a,l,c,d){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(o==null&&(r||u))return!0;if(o==null||o===!1)return!1;if(r&&o==="clone")return o;if(typeof o=="function")return n(o(a,l,c,d),r)(a,l,c,d);var h=(r?a:l).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var i={},s=t.group;(!s||vs(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=n(s.pull,!0),i.checkPut=n(s.put),i.revertClone=s.revertClone,t.group=i},Kd=function(){!qd&&L&&M(L,"display","none")},Jd=function(){!qd&&L&&M(L,"display","")};lo&&!$d&&document.addEventListener("click",function(e){if(Ys)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ys=!1,!1},!0);var He=function(t){if(E){t=t.touches?t.touches[0]:t;var n=Zm(t.clientX,t.clientY);if(n){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=n,i.preventDefault=void 0,i.stopPropagation=void 0,n[Tt]._onDragOver(i)}}},Qm=function(t){E&&E.parentNode[Tt]._isOutsideThisEl(t.target)};function C(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=pe({},t),e[Tt]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Gd(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,a){r.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:C.supportPointer!==!1&&"PointerEvent"in window&&(!li||Gr),emptyInsertThreshold:5};$i.initializePlugins(this,e,n);for(var i in n)!(i in t)&&(t[i]=n[i]);Xd(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:Km,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?H(e,"pointerdown",this._onTapStart):(H(e,"mousedown",this._onTapStart),H(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(H(e,"dragover",this),H(e,"dragenter",this)),qs.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),pe(this,Wm())}C.prototype={constructor:C,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(ln=null)},_getDirection:function(t,n){return typeof this.options.direction=="function"?this.options.direction.call(this,t,n,E):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n=this,i=this.el,s=this.options,o=s.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(ab(i),!E&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&li&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Ut(l,s.draggable,i,!1),!(l&&l.animated)&&xs!==l)){if(gn=Nt(l),di=Nt(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){Et({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),It("filter",n,{evt:t}),o&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=Ut(c,u.trim(),i,!1),u)return Et({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),It("filter",n,{evt:t}),!0}),d)){o&&t.preventDefault();return}s.handle&&!Ut(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,n,i){var s=this,o=s.el,r=s.options,a=o.ownerDocument,l;if(i&&!E&&i.parentNode===o){var c=dt(i);if(et=o,E=i,ot=E.parentNode,We=E.nextSibling,xs=i,Gi=r.group,C.dragged=E,$e={target:E,clientX:(n||t).clientX,clientY:(n||t).clientY},ll=$e.clientX-c.left,cl=$e.clientY-c.top,this._lastX=(n||t).clientX,this._lastY=(n||t).clientY,E.style["will-change"]="all",l=function(){if(It("delayEnded",s,{evt:t}),C.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!sl&&s.nativeDraggable&&(E.draggable=!0),s._triggerDragStart(t,n),Et({sortable:s,name:"choose",originalEvent:t}),At(E,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){zd(E,d.trim(),Ro)}),H(a,"dragover",He),H(a,"mousemove",He),H(a,"touchmove",He),r.supportPointer?(H(a,"pointerup",s._onDrop),!this.nativeDraggable&&H(a,"pointercancel",s._onDrop)):(H(a,"mouseup",s._onDrop),H(a,"touchend",s._onDrop),H(a,"touchcancel",s._onDrop)),sl&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),It("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Fi||be))){if(C.eventCanceled){this._onDrop();return}r.supportPointer?(H(a,"pointerup",s._disableDelayedDrag),H(a,"pointercancel",s._disableDelayedDrag)):(H(a,"mouseup",s._disableDelayedDrag),H(a,"touchend",s._disableDelayedDrag),H(a,"touchcancel",s._disableDelayedDrag)),H(a,"mousemove",s._delayedDragTouchMoveHandler),H(a,"touchmove",s._delayedDragTouchMoveHandler),r.supportPointer&&H(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&Ro(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._disableDelayedDrag),F(t,"touchend",this._disableDelayedDrag),F(t,"touchcancel",this._disableDelayedDrag),F(t,"pointerup",this._disableDelayedDrag),F(t,"pointercancel",this._disableDelayedDrag),F(t,"mousemove",this._delayedDragTouchMoveHandler),F(t,"touchmove",this._delayedDragTouchMoveHandler),F(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||t.pointerType=="touch"&&t,!this.nativeDraggable||n?this.options.supportPointer?H(document,"pointermove",this._onTouchMove):n?H(document,"touchmove",this._onTouchMove):H(document,"mousemove",this._onTouchMove):(H(E,"dragend",this),H(et,"dragstart",this._onDragStart));try{document.selection?ws(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,n){if(hn=!1,et&&E){It("dragStarted",this,{evt:n}),this.nativeDraggable&&H(document,"dragover",Qm);var i=this.options;!t&&At(E,i.dragClass,!1),At(E,i.ghostClass,!0),C.active=this,t&&this._appendGhost(),Et({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(zt){this._lastX=zt.clientX,this._lastY=zt.clientY,Kd();for(var t=document.elementFromPoint(zt.clientX,zt.clientY),n=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(zt.clientX,zt.clientY),t!==n);)n=t;if(E.parentNode[Tt]._isOutsideThisEl(t),n)do{if(n[Tt]){var i=void 0;if(i=n[Tt]._onDragOver({clientX:zt.clientX,clientY:zt.clientY,target:t,rootEl:n}),i&&!this.options.dragoverBubble)break}t=n}while(n=jd(n));Jd()}},_onTouchMove:function(t){if($e){var n=this.options,i=n.fallbackTolerance,s=n.fallbackOffset,o=t.touches?t.touches[0]:t,r=L&&vn(L,!0),a=L&&r&&r.a,l=L&&r&&r.d,c=Ki&&xt&&al(xt),d=(o.clientX-$e.clientX+s.x)/(a||1)+(c?c[0]-Po[0]:0)/(a||1),u=(o.clientY-$e.clientY+s.y)/(l||1)+(c?c[1]-Po[1]:0)/(l||1);if(!C.active&&!hn){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(L){r?(r.e+=d-(Lo||0),r.f+=u-(Oo||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");M(L,"webkitTransform",h),M(L,"mozTransform",h),M(L,"msTransform",h),M(L,"transform",h),Lo=d,Oo=u,zt=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!L){var t=this.options.fallbackOnBody?document.body:et,n=dt(E,!0,Ki,!0,t),i=this.options;if(Ki){for(xt=t;M(xt,"position")==="static"&&M(xt,"transform")==="none"&&xt!==document;)xt=xt.parentNode;xt!==document.body&&xt!==document.documentElement?(xt===document&&(xt=Jt()),n.top+=xt.scrollTop,n.left+=xt.scrollLeft):xt=Jt(),Po=al(xt)}L=E.cloneNode(!0),At(L,i.ghostClass,!1),At(L,i.fallbackClass,!0),At(L,i.dragClass,!0),M(L,"transition",""),M(L,"transform",""),M(L,"box-sizing","border-box"),M(L,"margin",0),M(L,"top",n.top),M(L,"left",n.left),M(L,"width",n.width),M(L,"height",n.height),M(L,"opacity","0.8"),M(L,"position",Ki?"absolute":"fixed"),M(L,"zIndex","100000"),M(L,"pointerEvents","none"),C.ghost=L,t.appendChild(L),M(L,"transform-origin",ll/parseInt(L.style.width)*100+"% "+cl/parseInt(L.style.height)*100+"%")}},_onDragStart:function(t,n){var i=this,s=t.dataTransfer,o=i.options;if(It("dragStart",this,{evt:t}),C.eventCanceled){this._onDrop();return}It("setupClone",this),C.eventCanceled||(st=Wd(E),st.removeAttribute("id"),st.draggable=!1,st.style["will-change"]="",this._hideClone(),At(st,this.options.chosenClass,!1),C.clone=st),i.cloneId=ws(function(){It("clone",i),!C.eventCanceled&&(i.options.removeCloneOnHide||et.insertBefore(st,E),i._hideClone(),Et({sortable:i,name:"clone"}))}),!n&&At(E,o.dragClass,!0),n?(Ys=!0,i._loopId=setInterval(i._emulateDragOver,50)):(F(document,"mouseup",i._onDrop),F(document,"touchend",i._onDrop),F(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,E)),H(document,"drop",i),M(E,"transform","translateZ(0)")),hn=!0,i._dragStartId=ws(i._dragStarted.bind(i,n,t)),H(document,"selectstart",i),Wn=!0,window.getSelection().removeAllRanges(),li&&M(document.body,"user-select","none")},_onDragOver:function(t){var n=this.el,i=t.target,s,o,r,a=this.options,l=a.group,c=C.active,d=Gi===l,u=a.sort,h=bt||c,f,g=this,p=!1;if(ur)return;function m(mt,ht){It(mt,g,te({evt:t,isOwner:d,axis:f?"vertical":"horizontal",revert:r,dragRect:s,targetRect:o,canSort:u,fromSortable:h,target:i,completed:y,onMove:function(Be,ye){return Ji(et,n,E,s,Be,dt(Be),t,ye)},changed:v},ht))}function b(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==h&&h.captureAnimationState()}function y(mt){return m("dragOverCompleted",{insertion:mt}),mt&&(d?c._hideClone():c._showClone(g),g!==h&&(At(E,bt?bt.options.ghostClass:c.options.ghostClass,!1),At(E,a.ghostClass,!0)),bt!==g&&g!==C.active?bt=g:g===C.active&&bt&&(bt=null),h===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===n&&!i.animated)&&(ln=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(E.parentNode[Tt]._isOutsideThisEl(t.target),!mt&&He(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function v(){Lt=Nt(E),xe=Nt(E,a.draggable),Et({sortable:g,name:"change",toEl:n,newIndex:Lt,newDraggableIndex:xe,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=Ut(i,a.draggable,n,!0),m("dragOver"),C.eventCanceled)return p;if(E.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if(Ys=!1,c&&!a.disabled&&(d?u||(r=ot!==et):bt===this||(this.lastPutMode=Gi.checkPull(this,c,E,t))&&l.checkPut(this,c,E,t))){if(f=this._getDirection(t,i)==="vertical",s=dt(E),m("dragOverValid"),C.eventCanceled)return p;if(r)return ot=et,b(),this._hideClone(),m("revert"),C.eventCanceled||(We?et.insertBefore(E,We):et.appendChild(E)),y(!0);var _=Xr(n,a.draggable);if(!_||ib(t,f,this)&&!_.animated){if(_===E)return y(!1);if(_&&n===t.target&&(i=_),i&&(o=dt(i)),Ji(et,n,E,s,i,o,t,!!i)!==!1)return b(),_&&_.nextSibling?n.insertBefore(E,_.nextSibling):n.appendChild(E),ot=n,v(),y(!0)}else if(_&&nb(t,f,this)){var x=kn(n,0,a,!0);if(x===E)return y(!1);if(i=x,o=dt(i),Ji(et,n,E,s,i,o,t,!1)!==!1)return b(),n.insertBefore(E,x),ot=n,v(),y(!0)}else if(i.parentNode===n){o=dt(i);var w=0,k,S=E.parentNode!==n,D=!Jm(E.animated&&E.toRect||s,i.animated&&i.toRect||o,f),A=f?"top":"left",T=rl(i,"top","top")||rl(E,"top","top"),R=T?T.scrollTop:void 0;ln!==i&&(k=o[A],hi=!1,Xi=!D&&a.invertSwap||S),w=sb(t,i,o,f,D?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Xi,ln===i);var G;if(w!==0){var at=Nt(E);do at-=w,G=ot.children[at];while(G&&(M(G,"display")==="none"||G===L))}if(w===0||G===i)return y(!1);ln=i,ui=w;var j=i.nextElementSibling,z=!1;z=w===1;var J=Ji(et,n,E,s,i,o,t,z);if(J!==!1)return(J===1||J===-1)&&(z=J===1),ur=!0,setTimeout(eb,30),b(),z&&!j?n.appendChild(E):i.parentNode.insertBefore(E,z?j:i),T&&Vd(T,0,R-T.scrollTop),ot=E.parentNode,k!==void 0&&!Xi&&(_s=Math.abs(k-dt(i)[A])),v(),y(!0)}if(n.contains(E))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",He),F(document,"mousemove",He),F(document,"touchmove",He)},_offUpEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._onDrop),F(t,"touchend",this._onDrop),F(t,"pointerup",this._onDrop),F(t,"pointercancel",this._onDrop),F(t,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(t){var n=this.el,i=this.options;if(Lt=Nt(E),xe=Nt(E,i.draggable),It("drop",this,{evt:t}),ot=E&&E.parentNode,Lt=Nt(E),xe=Nt(E,i.draggable),C.eventCanceled){this._nulling();return}hn=!1,Xi=!1,hi=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),hr(this.cloneId),hr(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),li&&M(document.body,"user-select",""),M(E,"transform",""),t&&(Wn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),L&&L.parentNode&&L.parentNode.removeChild(L),(et===ot||bt&&bt.lastPutMode!=="clone")&&st&&st.parentNode&&st.parentNode.removeChild(st),E&&(this.nativeDraggable&&F(E,"dragend",this),Ro(E),E.style["will-change"]="",Wn&&!hn&&At(E,bt?bt.options.ghostClass:this.options.ghostClass,!1),At(E,this.options.chosenClass,!1),Et({sortable:this,name:"unchoose",toEl:ot,newIndex:null,newDraggableIndex:null,originalEvent:t}),et!==ot?(Lt>=0&&(Et({rootEl:ot,name:"add",toEl:ot,fromEl:et,originalEvent:t}),Et({sortable:this,name:"remove",toEl:ot,originalEvent:t}),Et({rootEl:ot,name:"sort",toEl:ot,fromEl:et,originalEvent:t}),Et({sortable:this,name:"sort",toEl:ot,originalEvent:t})),bt&&bt.save()):Lt!==gn&&Lt>=0&&(Et({sortable:this,name:"update",toEl:ot,originalEvent:t}),Et({sortable:this,name:"sort",toEl:ot,originalEvent:t})),C.active&&((Lt==null||Lt===-1)&&(Lt=gn,xe=di),Et({sortable:this,name:"end",toEl:ot,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){It("nulling",this),et=E=ot=L=We=st=xs=_e=$e=zt=Wn=Lt=xe=gn=di=ln=ui=bt=Gi=C.dragged=C.ghost=C.clone=C.active=null,Gs.forEach(function(t){t.checked=!0}),Gs.length=Lo=Oo=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":E&&(this._onDragOver(t),tb(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],n,i=this.el.children,s=0,o=i.length,r=this.options;s<o;s++)n=i[s],Ut(n,r.draggable,this.el,!1)&&t.push(n.getAttribute(r.dataIdAttr)||rb(n));return t},sort:function(t,n){var i={},s=this.el;this.toArray().forEach(function(o,r){var a=s.children[r];Ut(a,this.options.draggable,s,!1)&&(i[o]=a)},this),n&&this.captureAnimationState(),t.forEach(function(o){i[o]&&(s.removeChild(i[o]),s.appendChild(i[o]))}),n&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,n){return Ut(t,n||this.options.draggable,this.el,!1)},option:function(t,n){var i=this.options;if(n===void 0)return i[t];var s=$i.modifyOption(this,t,n);typeof s<"u"?i[t]=s:i[t]=n,t==="group"&&Xd(i)},destroy:function(){It("destroy",this);var t=this.el;t[Tt]=null,F(t,"mousedown",this._onTapStart),F(t,"touchstart",this._onTapStart),F(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(t,"dragover",this),F(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),qs.splice(qs.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!_e){if(It("hideClone",this),C.eventCanceled)return;M(st,"display","none"),this.options.removeCloneOnHide&&st.parentNode&&st.parentNode.removeChild(st),_e=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(_e){if(It("showClone",this),C.eventCanceled)return;E.parentNode==et&&!this.options.group.revertClone?et.insertBefore(st,E):We?et.insertBefore(st,We):et.appendChild(st),this.options.group.revertClone&&this.animate(E,st),M(st,"display",""),_e=!1}}};function tb(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Ji(e,t,n,i,s,o,r,a){var l,c=e[Tt],d=c.options.onMove,u;return window.CustomEvent&&!be&&!Fi?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=s||t,l.relatedRect=o||dt(t),l.willInsertAfter=a,l.originalEvent=r,e.dispatchEvent(l),d&&(u=d.call(c,l,r)),u}function Ro(e){e.draggable=!1}function eb(){ur=!1}function nb(e,t,n){var i=dt(kn(n.el,0,n.options,!0)),s=Yd(n.el,n.options,L),o=10;return t?e.clientX<s.left-o||e.clientY<i.top&&e.clientX<i.right:e.clientY<s.top-o||e.clientY<i.bottom&&e.clientX<i.left}function ib(e,t,n){var i=dt(Xr(n.el,n.options.draggable)),s=Yd(n.el,n.options,L),o=10;return t?e.clientX>s.right+o||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>s.bottom+o||e.clientX>i.right&&e.clientY>i.top}function sb(e,t,n,i,s,o,r,a){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,h=!1;if(!r){if(a&&_s<c*s){if(!hi&&(ui===1?l>d+c*o/2:l<u-c*o/2)&&(hi=!0),hi)h=!0;else if(ui===1?l<d+_s:l>u-_s)return-ui}else if(l>d+c*(1-s)/2&&l<u-c*(1-s)/2)return ob(t)}return h=h||r,h&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}function ob(e){return Nt(E)<Nt(e)?1:-1}function rb(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function ab(e){Gs.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&Gs.push(i)}}function ws(e){return setTimeout(e,0)}function hr(e){return clearTimeout(e)}lo&&H(document,"touchmove",function(e){(C.active||hn)&&e.cancelable&&e.preventDefault()});C.utils={on:H,off:F,css:M,find:zd,is:function(t,n){return!!Ut(t,n,t,!1)},extend:Um,throttle:Ud,closest:Ut,toggleClass:At,clone:Wd,index:Nt,nextTick:ws,cancelNextTick:hr,detectDirection:Gd,getChild:kn,expando:Tt};C.get=function(e){return e[Tt]};C.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(C.utils=te(te({},C.utils),i.utils)),$i.mount(i)})};C.create=function(e,t){return new C(e,t)};C.version=jm;var ct=[],Yn,fr,gr=!1,Bo,No,Xs,qn;function lb(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(n){var i=n.originalEvent;this.sortable.nativeDraggable?H(document,"dragover",this._handleAutoScroll):this.options.supportPointer?H(document,"pointermove",this._handleFallbackAutoScroll):i.touches?H(document,"touchmove",this._handleFallbackAutoScroll):H(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var i=n.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),ul(),ks(),Vm()},nulling:function(){Xs=fr=Yn=gr=qn=Bo=No=null,ct.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,i){var s=this,o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(o,r);if(Xs=n,i||this.options.forceAutoScrollFallback||Fi||be||li){Fo(n,this.options,a,i);var l=Se(a,!0);gr&&(!qn||o!==Bo||r!==No)&&(qn&&ul(),qn=setInterval(function(){var c=Se(document.elementFromPoint(o,r),!0);c!==l&&(l=c,ks()),Fo(n,s.options,c,i)},10),Bo=o,No=r)}else{if(!this.options.bubbleScroll||Se(a,!0)===Jt()){ks();return}Fo(n,this.options,Se(a,!1),!1)}}},pe(e,{pluginName:"scroll",initializeByDefault:!0})}function ks(){ct.forEach(function(e){clearInterval(e.pid)}),ct=[]}function ul(){clearInterval(qn)}var Fo=Ud(function(e,t,n,i){if(t.scroll){var s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,a=t.scrollSpeed,l=Jt(),c=!1,d;fr!==n&&(fr=n,ks(),Yn=t.scroll,d=t.scrollFn,Yn===!0&&(Yn=Se(n,!0)));var u=0,h=Yn;do{var f=h,g=dt(f),p=g.top,m=g.bottom,b=g.left,y=g.right,v=g.width,_=g.height,x=void 0,w=void 0,k=f.scrollWidth,S=f.scrollHeight,D=M(f),A=f.scrollLeft,T=f.scrollTop;f===l?(x=v<k&&(D.overflowX==="auto"||D.overflowX==="scroll"||D.overflowX==="visible"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"||D.overflowY==="visible")):(x=v<k&&(D.overflowX==="auto"||D.overflowX==="scroll"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"));var R=x&&(Math.abs(y-s)<=r&&A+v<k)-(Math.abs(b-s)<=r&&!!A),G=w&&(Math.abs(m-o)<=r&&T+_<S)-(Math.abs(p-o)<=r&&!!T);if(!ct[u])for(var at=0;at<=u;at++)ct[at]||(ct[at]={});(ct[u].vx!=R||ct[u].vy!=G||ct[u].el!==f)&&(ct[u].el=f,ct[u].vx=R,ct[u].vy=G,clearInterval(ct[u].pid),(R!=0||G!=0)&&(c=!0,ct[u].pid=setInterval((function(){i&&this.layer===0&&C.active._onTouchMove(Xs);var j=ct[this.layer].vy?ct[this.layer].vy*a:0,z=ct[this.layer].vx?ct[this.layer].vx*a:0;typeof d=="function"&&d.call(C.dragged.parentNode[Tt],z,j,e,Xs,ct[this.layer].el)!=="continue"||Vd(ct[this.layer].el,z,j)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==l&&(h=Se(h,!1)));gr=c}},30),Zd=function(t){var n=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(n){var c=i||o;a();var d=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Kr(){}Kr.prototype={startIndex:null,dragStart:function(t){var n=t.oldDraggableIndex;this.startIndex=n},onSpill:function(t){var n=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=kn(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(n,s):this.sortable.el.appendChild(n),this.sortable.animateAll(),i&&i.animateAll()},drop:Zd};pe(Kr,{pluginName:"revertOnSpill"});function Jr(){}Jr.prototype={onSpill:function(t){var n=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),s.animateAll()},drop:Zd};pe(Jr,{pluginName:"removeOnSpill"});C.mount(new lb);C.mount(Jr,Kr);const cb={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function Qd(e=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",n.innerHTML=Tm(),document.body.appendChild(n),db(e),Lm(),ub(n)}function db(e){const t=document.getElementById("tb-list"),n=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=ge(),s=document.createDocumentFragment();i.forEach(o=>s.appendChild(tu(o))),t.appendChild(s),Vs(n,i.length),new C(t,{animation:150,handle:".handle",ghostClass:"bg-blue-50",onEnd:function(o){}}),e!=null&&e.id&&requestAnimationFrame(()=>{const o=t.querySelector(`.tb-row[data-id="${e.id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("bg-blue-50","dark:bg-blue-900/20"))})}function tu(e=null){const t=e||{...cb},n=document.createElement("div");n.className="tb-row flex items-center gap-4 py-2 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg select-none",t.id&&(n.dataset.id=t.id),n.innerHTML=Mm(t);const i=n.querySelector(".delete-btn");return i.onclick=()=>Bm(n),n}function ub(e){const t=e.querySelector("#add-tb-btn"),n=e.querySelector("#close-tb-modal"),i=e.querySelector("#close-tb-footer"),s=()=>{e.remove(),document.removeEventListener("keydown",o),document.removeEventListener("click",handleOutsideClick),window.tbHandleOutsideClick&&(window.tbHandleOutsideClick=null)},o=r=>{r.key==="Escape"&&s()};n.onclick=s,i.onclick=async()=>await Nm(i,s),e.onclick=r=>{r.target===e&&s()},document.addEventListener("keydown",o),t.onclick=()=>{const r=document.getElementById("tb-list"),a=r.querySelectorAll(".tb-row").length;if(a<Us){const l=tu();r.appendChild(l),Vs(t,a+1),l.scrollIntoView({behavior:"smooth"})}},hb(e)}function hb(e){let t=null;const n=i=>{t&&!t.contains(i.target)&&(t.querySelector(".tb-select-options").classList.add("hidden"),t=null);const s=document.getElementById("tb-color-picker"),o=i.target.closest(".tb-color-trigger"),r=s&&s.contains(i.target);!o&&!r&&s&&!s.classList.contains("hidden")&&Pm()};setTimeout(()=>document.addEventListener("click",n),0),e.addEventListener("click",i=>{const s=i.target.closest(".tb-select-trigger");if(s){const a=s.closest(".tb-custom-select"),l=a.querySelector(".tb-select-options");document.querySelectorAll(".tb-select-options").forEach(c=>{c!==l&&c.classList.add("hidden")}),l.classList.toggle("hidden"),t=l.classList.contains("hidden")?null:a,i.stopPropagation();return}const o=i.target.closest(".tb-select-option");if(o){const a=o.closest(".tb-custom-select"),l=o.dataset.value;a.dataset.value=l,a.querySelector(".value-display").textContent=l,a.querySelectorAll(".tb-select-option").forEach(c=>{c.dataset.value===l?c.classList.add("bg-blue-50/50","font-bold"):c.classList.remove("bg-blue-50/50","font-bold")}),a.querySelector(".tb-select-options").classList.add("hidden"),t=null,i.stopPropagation();return}const r=i.target.closest(".tb-color-trigger");r&&(Om(r),i.stopPropagation())})}function fb(e){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",n=>{n.stopPropagation(),Ad()})}function gb(e,t=[]){const n=document.getElementById("project-list");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}e.forEach(i=>{const s=t.filter(r=>r.projectId===i.id&&!r.completed).length,o=_i(i.name,"project",i.id,i.color,s);o.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},o.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation(),Yr(r,"project",i)},wi(o,"project",i.id),n.appendChild(o)})}}function pb(e,t){let n=Ks(e,t);return mb(n,t.sortCriteria)}function Ks(e,t){const{keyword:n,projectId:i,labelId:s,showCompleted:o,timeBlockId:r,duration:a}=t;return e.filter(l=>{if(!o&&l.status==="completed")return!1;if(i){if(i==="unassigned"){if(l.projectId)return!1}else if(l.projectId!==i)return!1}if(s&&(!l.labelIds||!l.labelIds.includes(s)))return!1;if(r){if(r==="unassigned"){if(l.timeBlockId&&l.timeBlockId!=="null")return!1}else if(String(l.timeBlockId)!==String(r))return!1}if(a&&Number(l.duration)!==Number(a))return!1;if(n){const c=n.toLowerCase(),d=l.title.toLowerCase().includes(c),u=(l.description||"").toLowerCase().includes(c);if(!d&&!u)return!1}return!0})}function mb(e,t="createdAt_desc"){return[...e].sort((n,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(n.createdAt||0);case"createdAt_asc":return(n.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return n.dueDate?i.dueDate?n.dueDate-i.dueDate:-1:1;case"project_asc":return(n.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function bb(){const e=document.getElementById("inbox-count");if(!e)return;const t=Mn(),n=Rs(t,i=>!i.projectId);e.textContent=n,e.classList.toggle("hidden",n===0)}function yb(){if(!document.getElementById(B.LIST_IDS.PROJECTS))return;const t=Wr(),n=Mn();gb(t,n)}function vb(){const e=document.getElementById(B.LIST_IDS.TIMEBLOCKS);if(!e)return;e.innerHTML="";const t=document.createDocumentFragment(),n=ge().sort((a,l)=>(a.order||0)-(l.order||0)),i=Mn(),s=Tn();n.forEach(a=>{const l=Rs(i,u=>{const h=u.timeBlockId==="null"?null:u.timeBlockId,f=a.id;return h===f}),c=`${a.start} - ${a.end}`,d=_i(c,"timeblock",a.id,{color:a.color},l,s);d.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:a.id}})),d.oncontextmenu=u=>{u.preventDefault(),Qd(a)},wi(d,"timeblock",a.id),t.appendChild(d)});const o=Rs(i,a=>!a.timeBlockId||a.timeBlockId==="null"),r=_i("未定","timeblock","unassigned",{color:"#a0aec0"},o,s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),wi(r,"timeblock","unassigned"),t.appendChild(r),e.appendChild(t)}function xb(){const e=document.getElementById(B.LIST_IDS.DURATIONS);if(!e)return;e.innerHTML="";const t=Mn(),n=Tn(),i=document.createDocumentFragment(),s='<span class="mr-3 text-sm">⏱️</span>';B.DURATIONS.forEach(o=>{const r=Rs(t,l=>Number(l.duration)===o),a=_i(`${o} min`,"duration",o.toString(),{iconHtml:s},r,n);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:o.toString()}})),wi(a,"duration",o.toString()),i.appendChild(a)}),e.appendChild(i)}function _b(){const e=document.getElementById(B.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const t=Sd(),n=Mn(),i=Tn(),s=document.createDocumentFragment(),o='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';t.forEach(r=>{let a=0;try{typeof Ks=="function"&&(a=Ks(n,{savedFilter:r,showCompleted:!1}).length)}catch(c){console.warn("[Sidebar] Filter count error:",c)}const l=_i(r.name,"filter",r.id,{iconHtml:o},a,i);l.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),l.oncontextmenu=c=>{c.preventDefault(),Yr(c,"filter",r)},s.appendChild(l)}),e.appendChild(s)}function wb(){yb(),vb(),xb(),_b(),bb()}let pn=null,Zi=null,Pt={};function hl(){Pt={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function kb(){if(hl(),!Pt.container)return;Pt.container.innerHTML=km(),hl(),Yc(Pt.sidebar,Pt.resizer),Eb(),Sm(),Em(),Sb(),Pt.inbox&&wi(Pt.inbox,"inbox"),fb(Pt.container),Zi&&window.removeEventListener("resize",Zi),Zi=()=>pr(),window.addEventListener("resize",Zi),pr();const e=Tn();Zr(e),Ib(),pn&&pn()}function Sb(){const e=["timeblocks-updated","projects-updated","labels-updated","filters-updated","tasks-updated"];pn&&e.forEach(t=>document.removeEventListener(t,pn)),pn=()=>{wb();const t=Tn();Zr(t)},e.forEach(t=>document.addEventListener(t,pn))}function Eb(){var t,n;const e=(i,s=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:i,id:s}}));Pt.container.addEventListener("click",i=>{const s=i.target.closest("a"),o=i.target.closest("button");if(s){i.preventDefault();const r=s.id;r==="nav-dashboard"&&e("dashboard"),r==="nav-inbox"&&e("inbox"),r==="nav-search"&&e("search"),r==="nav-settings"&&ao();return}if(o){const r=o.id;r==="add-filter-btn"&&Cd(),r==="edit-timeblocks-btn"&&Qd()}}),(t=Pt.openBtn)==null||t.addEventListener("click",()=>fl(!0)),(n=Pt.closeBtn)==null||n.addEventListener("click",()=>fl(!1))}function Zr(e){const t=document.querySelectorAll(".sidebar-item-row"),n=Object.values(B.DENSITY_CLASSES),i=B.DENSITY_CLASSES[e]||B.DENSITY_CLASSES.normal;t.forEach(s=>{s.classList.remove(...n),s.classList.add(i)})}function fl(e){const{sidebar:t,resizer:n}=Pt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(t){if(t.classList.toggle(i,!e),t.classList.toggle(s,!e),Br())if(n&&n.classList.toggle(s,!e),e){const o=localStorage.getItem(B.STORAGE_KEYS.WIDTH)||B.DEFAULT_WIDTH;t.style.width=`${o}px`}else t.style.width="0";pr()}}function pr(){const{sidebar:e,openBtn:t,closeBtn:n}=Pt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(!e||!t||!n)return;const o=e.classList.contains(i)||e.classList.contains(s);Br()?(t.classList.toggle(s,!o),n.classList.toggle(s,o),o||e.classList.remove(s)):(t.classList.remove(s),n.classList.remove(s),e.classList.remove(s))}function Ib(){window.addEventListener("sidebar-settings-updated",e=>{Zr(e.detail.density)})}const Db={FAVICON:"/images/favicon-96x96.png"},Tb={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},Gn={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},Qr={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:ft,HEADER_IDS:gl,DATA_ATTRS:Mb}=Qr;function Ss(e,t){Array.isArray(t)&&t.forEach(n=>{var i,s;(i=n==null?void 0:n.classList)==null||i.add(ft.HIDDEN),(s=n==null?void 0:n.classList)==null||s.remove(ft.FADE_IN)}),e!=null&&e.classList&&(e.classList.remove(ft.HIDDEN),e.classList.add(ft.FADE_IN))}function eu(){document.querySelectorAll(".sidebar-item-row").forEach(e=>{e.classList.remove(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]),e.classList.add(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]);const t=e.querySelector("svg, span:not(.truncate)");if(t){const n=Array.from(t.classList).filter(s=>s.startsWith("text-"));n.length>0&&t.classList.remove(...n);const i=e.getAttribute(Mb.DEFAULT_COLOR);i&&t.classList.add(i)}})}function Cb(e){eu();const t=Ab(e);if(t!=null&&t.classList){t.classList.remove(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]),t.classList.add(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]);const n=t.querySelector("svg, span:not(.truncate)");if(n){const i=Array.from(n.classList).filter(s=>s.startsWith("text-"));i.length>0&&n.classList.remove(...i),n.classList.add("text-white")}}}function Ab(e){if(!e)return null;const{type:t,id:n}=e;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?Gn.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${n}"]`)}function nu(e,t=[],n=[]){var c;const i=document.getElementById(gl.TITLE),s=document.getElementById(gl.COUNT);if(!i)return;let o="インボックス";const{type:r,id:a,name:l}=e;if(l)o=l;else switch(r){case Gn.PROJECT:o=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case Gn.LABEL:const d=n.find(u=>u.id===a);o=d?`ラベル: ${d.name}`:"ラベル";break;case Gn.TIMEBLOCK:if(a==="unassigned")o="時間帯: 未定";else{const u=Dd(a);o=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case Gn.DURATION:o=`所要時間: ${a}分`;break;case"search":o="タスク検索";break;case"dashboard":o="ダッシュボード";break}i.textContent=o,s&&["dashboard","search"].includes(r)&&(s.textContent="")}function Lb(){const{VIEW_IDS:e}=Qr;Object.values(e).forEach(n=>{const i=document.getElementById(n);n!==e.TASK&&i&&i.classList.add(ft.HIDDEN)});const t=document.getElementById(e.TASK);t&&(t.classList.remove(ft.HIDDEN),t.innerHTML=`
        <div id="login-container-wrapper" class="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in">
            <div id="login-form-container" class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
                    <p class="text-gray-500 dark:text-gray-400">タスク管理をはじめよう</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">メールアドレス</label>
                        <input id="email-input" type="email" placeholder="name@example.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">パスワード</label>
                        <input id="password-input" type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                </div>
                
                <button id="email-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-0.5 mb-6">
                    ログイン
                </button>

                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">または</span>
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600 text-center">
                     <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">アカウント登録なしで試す</p>
                    <button id="guest-login-btn" class="w-full bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center gap-2">
                        <span>🚀</span> ゲストとして利用する
                    </button>
                    <p class="text-xs text-gray-400 mt-2">※ゲストデータはローカルに保存されます</p>
                </div>
            </div>
            
            <!-- ユーザー情報表示用（ロジック互換性のため残す、実際はヘッダー等で管理推奨） -->
            <div id="user-info" class="hidden">
                 <span id="user-email-display"></span>
            </div>
        </div>
    `)}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Hi(e){return e+.5|0}const Ee=(e,t,n)=>Math.max(Math.min(e,n),t);function Xn(e){return Ee(Hi(e*2.55),0,255)}function Ae(e){return Ee(Hi(e*255),0,255)}function re(e){return Ee(Hi(e/2.55)/100,0,1)}function pl(e){return Ee(Hi(e*100),0,100)}const Bt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},mr=[..."0123456789ABCDEF"],Ob=e=>mr[e&15],Pb=e=>mr[(e&240)>>4]+mr[e&15],Qi=e=>(e&240)>>4===(e&15),Rb=e=>Qi(e.r)&&Qi(e.g)&&Qi(e.b)&&Qi(e.a);function Bb(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Bt[e[1]]*17,g:255&Bt[e[2]]*17,b:255&Bt[e[3]]*17,a:t===5?Bt[e[4]]*17:255}:(t===7||t===9)&&(n={r:Bt[e[1]]<<4|Bt[e[2]],g:Bt[e[3]]<<4|Bt[e[4]],b:Bt[e[5]]<<4|Bt[e[6]],a:t===9?Bt[e[7]]<<4|Bt[e[8]]:255})),n}const Nb=(e,t)=>e<255?t(e):"";function Fb(e){var t=Rb(e)?Ob:Pb;return e?"#"+t(e.r)+t(e.g)+t(e.b)+Nb(e.a,t):void 0}const $b=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function iu(e,t,n){const i=t*Math.min(n,1-n),s=(o,r=(o+e/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[s(0),s(8),s(4)]}function Hb(e,t,n){const i=(s,o=(s+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function jb(e,t,n){const i=iu(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function zb(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}function ta(e){const n=e.r/255,i=e.g/255,s=e.b/255,o=Math.max(n,i,s),r=Math.min(n,i,s),a=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=a>.5?d/(2-o-r):d/(o+r),l=zb(n,i,s,d,o),l=l*60+.5),[l|0,c||0,a]}function ea(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Ae)}function na(e,t,n){return ea(iu,e,t,n)}function Ub(e,t,n){return ea(jb,e,t,n)}function Vb(e,t,n){return ea(Hb,e,t,n)}function su(e){return(e%360+360)%360}function Wb(e){const t=$b.exec(e);let n=255,i;if(!t)return;t[5]!==i&&(n=t[6]?Xn(+t[5]):Ae(+t[5]));const s=su(+t[2]),o=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=Ub(s,o,r):t[1]==="hsv"?i=Vb(s,o,r):i=na(s,o,r),{r:i[0],g:i[1],b:i[2],a:n}}function Yb(e,t){var n=ta(e);n[0]=su(n[0]+t),n=na(n),e.r=n[0],e.g=n[1],e.b=n[2]}function qb(e){if(!e)return;const t=ta(e),n=t[0],i=pl(t[1]),s=pl(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${s}%, ${re(e.a)})`:`hsl(${n}, ${i}%, ${s}%)`}const ml={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},bl={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Gb(){const e={},t=Object.keys(bl),n=Object.keys(ml);let i,s,o,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],s=0;s<n.length;s++)o=n[s],a=a.replace(o,ml[o]);o=parseInt(bl[r],16),e[a]=[o>>16&255,o>>8&255,o&255]}return e}let ts;function Xb(e){ts||(ts=Gb(),ts.transparent=[0,0,0,0]);const t=ts[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Kb=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Jb(e){const t=Kb.exec(e);let n=255,i,s,o;if(t){if(t[7]!==i){const r=+t[7];n=t[8]?Xn(r):Ee(r*255,0,255)}return i=+t[1],s=+t[3],o=+t[5],i=255&(t[2]?Xn(i):Ee(i,0,255)),s=255&(t[4]?Xn(s):Ee(s,0,255)),o=255&(t[6]?Xn(o):Ee(o,0,255)),{r:i,g:s,b:o,a:n}}}function Zb(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${re(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const $o=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,cn=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Qb(e,t,n){const i=cn(re(e.r)),s=cn(re(e.g)),o=cn(re(e.b));return{r:Ae($o(i+n*(cn(re(t.r))-i))),g:Ae($o(s+n*(cn(re(t.g))-s))),b:Ae($o(o+n*(cn(re(t.b))-o))),a:e.a+n*(t.a-e.a)}}function es(e,t,n){if(e){let i=ta(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,t===0?360:1)),i=na(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function ou(e,t){return e&&Object.assign(t||{},e)}function yl(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Ae(e[3]))):(t=ou(e,{r:0,g:0,b:0,a:1}),t.a=Ae(t.a)),t}function t0(e){return e.charAt(0)==="r"?Jb(e):Wb(e)}class ki{constructor(t){if(t instanceof ki)return t;const n=typeof t;let i;n==="object"?i=yl(t):n==="string"&&(i=Bb(t)||Xb(t)||t0(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=ou(this._rgb);return t&&(t.a=re(t.a)),t}set rgb(t){this._rgb=yl(t)}rgbString(){return this._valid?Zb(this._rgb):void 0}hexString(){return this._valid?Fb(this._rgb):void 0}hslString(){return this._valid?qb(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,s=t.rgb;let o;const r=n===o?.5:n,a=2*r-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-c,i.r=255&c*i.r+o*s.r+.5,i.g=255&c*i.g+o*s.g+.5,i.b=255&c*i.b+o*s.b+.5,i.a=r*i.a+(1-r)*s.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=Qb(this._rgb,t._rgb,n)),this}clone(){return new ki(this.rgb)}alpha(t){return this._rgb.a=Ae(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=Hi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return es(this._rgb,2,t),this}darken(t){return es(this._rgb,2,-t),this}saturate(t){return es(this._rgb,1,t),this}desaturate(t){return es(this._rgb,1,-t),this}rotate(t){return Yb(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function ne(){}const e0=(()=>{let e=0;return()=>e++})();function N(e){return e==null}function nt(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function $(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function rt(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function Ot(e,t){return rt(e)?e:t}function O(e,t){return typeof e>"u"?t:e}const n0=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,ru=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Z(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function q(e,t,n,i){let s,o,r;if(nt(e))for(o=e.length,s=0;s<o;s++)t.call(n,e[s],s);else if($(e))for(r=Object.keys(e),o=r.length,s=0;s<o;s++)t.call(n,e[r[s]],r[s])}function Js(e,t){let n,i,s,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],o=t[n],s.datasetIndex!==o.datasetIndex||s.index!==o.index)return!1;return!0}function Zs(e){if(nt(e))return e.map(Zs);if($(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=Zs(e[n[s]]);return t}return e}function au(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function i0(e,t,n,i){if(!au(e))return;const s=t[e],o=n[e];$(s)&&$(o)?Si(s,o,i):t[e]=Zs(o)}function Si(e,t,n){const i=nt(t)?t:[t],s=i.length;if(!$(e))return e;n=n||{};const o=n.merger||i0;let r;for(let a=0;a<s;++a){if(r=i[a],!$(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],e,r,n)}return e}function fi(e,t){return Si(e,t,{merger:s0})}function s0(e,t,n){if(!au(e))return;const i=t[e],s=n[e];$(i)&&$(s)?fi(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Zs(s))}const vl={"":e=>e,x:e=>e.x,y:e=>e.y};function o0(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}function r0(e){const t=o0(e);return n=>{for(const i of t){if(i==="")break;n=n&&n[i]}return n}}function Le(e,t){return(vl[t]||(vl[t]=r0(t)))(e)}function ia(e){return e.charAt(0).toUpperCase()+e.slice(1)}const Ei=e=>typeof e<"u",Oe=e=>typeof e=="function",xl=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function a0(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const V=Math.PI,tt=2*V,l0=tt+V,Qs=Number.POSITIVE_INFINITY,c0=V/180,lt=V/2,je=V/4,_l=V*2/3,Ie=Math.log10,Zt=Math.sign;function gi(e,t,n){return Math.abs(e-t)<n}function wl(e){const t=Math.round(e);e=gi(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(Ie(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function d0(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(n|0)&&t.push(n),t.sort((s,o)=>s-o).pop(),t}function u0(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function Sn(e){return!u0(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function h0(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function lu(e,t,n){let i,s,o;for(i=0,s=e.length;i<s;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function Wt(e){return e*(V/180)}function sa(e){return e*(180/V)}function kl(e){if(!rt(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function cu(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*V&&(o+=tt),{angle:o,distance:s}}function br(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function f0(e,t){return(e-t+l0)%tt-V}function wt(e){return(e%tt+tt)%tt}function Ii(e,t,n,i){const s=wt(e),o=wt(t),r=wt(n),a=wt(o-s),l=wt(r-s),c=wt(s-o),d=wt(s-r);return s===o||s===r||i&&o===r||a>l&&c<d}function pt(e,t,n){return Math.max(t,Math.min(n,e))}function g0(e){return pt(e,-32768,32767)}function le(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function oa(e,t,n){n=n||(r=>e[r]<t);let i=e.length-1,s=0,o;for(;i-s>1;)o=s+i>>1,n(o)?s=o:i=o;return{lo:s,hi:i}}const ce=(e,t,n,i)=>oa(e,n,i?s=>{const o=e[s][t];return o<n||o===n&&e[s+1][t]===n}:s=>e[s][t]<n),p0=(e,t,n)=>oa(e,n,i=>e[i][t]>=n);function m0(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}const du=["push","pop","shift","splice","unshift"];function b0(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),du.forEach(n=>{const i="_onData"+ia(n),s=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const r=s.apply(this,o);return e._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...o)}),r}})})}function Sl(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(du.forEach(o=>{delete e[o]}),delete e._chartjs)}function uu(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const hu=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function fu(e,t){let n=[],i=!1;return function(...s){n=s,i||(i=!0,hu.call(window,()=>{i=!1,e.apply(t,n)}))}}function y0(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}const ra=e=>e==="start"?"left":e==="end"?"right":"center",_t=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,v0=(e,t,n,i)=>e===(i?"left":"right")?n:e==="center"?(t+n)/2:t;function gu(e,t,n){const i=t.length;let s=0,o=i;if(e._sorted){const{iScale:r,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=r.axis,{min:u,max:h,minDefined:f,maxDefined:g}=r.getUserBounds();if(f){if(s=Math.min(ce(l,d,u).lo,n?i:ce(t,d,r.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!N(m[a.axis]));s-=Math.max(0,p)}s=pt(s,0,i-1)}if(g){let p=Math.max(ce(l,r.axis,h,!0).hi+1,n?0:ce(t,d,r.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!N(b[a.axis]));p+=Math.max(0,m)}o=pt(p,s,i)-s}else o=i-s}return{start:s,count:o}}function pu(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),o}const ns=e=>e===0||e===1,El=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*tt/n)),Il=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*tt/n)+1,pi={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*lt)+1,easeOutSine:e=>Math.sin(e*lt),easeInOutSine:e=>-.5*(Math.cos(V*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>ns(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>ns(e)?e:El(e,.075,.3),easeOutElastic:e=>ns(e)?e:Il(e,.075,.3),easeInOutElastic(e){return ns(e)?e:e<.5?.5*El(e*2,.1125,.45):.5+.5*Il(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-pi.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?pi.easeInBounce(e*2)*.5:pi.easeOutBounce(e*2-1)*.5+.5};function aa(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Dl(e){return aa(e)?e:new ki(e)}function Ho(e){return aa(e)?e:new ki(e).saturate(.5).darken(.1).hexString()}const x0=["x","y","borderWidth","radius","tension"],_0=["color","borderColor","backgroundColor"];function w0(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:_0},numbers:{type:"number",properties:x0}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function k0(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Tl=new Map;function S0(e,t){t=t||{};const n=e+JSON.stringify(t);let i=Tl.get(n);return i||(i=new Intl.NumberFormat(e,t),Tl.set(n,i)),i}function ji(e,t,n){return S0(t,n).format(e)}const mu={values(e){return nt(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const i=this.chart.options.locale;let s,o=e;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),o=E0(e,n)}const r=Ie(Math.abs(o)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),ji(e,i,l)},logarithmic(e,t,n){if(e===0)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(Ie(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?mu.numeric.call(this,e,t,n):""}};function E0(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var co={formatters:mu};function I0(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:co.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Qe=Object.create(null),yr=Object.create(null);function mi(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const o=n[i];e=e[o]||(e[o]=Object.create(null))}return e}function jo(e,t,n){return typeof t=="string"?Si(mi(e,t),n):Si(mi(e,""),t)}class D0{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Ho(s.backgroundColor),this.hoverBorderColor=(i,s)=>Ho(s.borderColor),this.hoverColor=(i,s)=>Ho(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return jo(this,t,n)}get(t){return mi(this,t)}describe(t,n){return jo(yr,t,n)}override(t,n){return jo(Qe,t,n)}route(t,n,i,s){const o=mi(this,t),r=mi(this,i),a="_"+n;Object.defineProperties(o,{[a]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=r[s];return $(l)?Object.assign({},c,l):O(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(n=>n(this))}}var it=new D0({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[w0,k0,I0]);function T0(e){return!e||N(e.size)||N(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function to(e,t,n,i,s){let o=t[s];return o||(o=t[s]=e.measureText(s).width,n.push(s)),o>i&&(i=o),i}function M0(e,t,n,i){i=i||{};let s=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},o=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let r=0;const a=n.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=n[l],u!=null&&!nt(u))r=to(e,s,o,r,u);else if(nt(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!nt(h)&&(r=to(e,s,o,r,h));e.restore();const f=o.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[o[l]];o.splice(0,f)}return r}function ze(e,t,n){const i=e.currentDevicePixelRatio,s=n!==0?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function Ml(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function vr(e,t,n,i){bu(e,t,n,i,null)}function bu(e,t,n,i,s){let o,r,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*c0;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,i),e.rotate(m),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!(isNaN(p)||p<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,p,0,0,tt):e.arc(n,i,p,0,tt),e.closePath();break;case"triangle":d=s?s/2:p,e.moveTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=_l,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=_l,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),e.closePath();break;case"rectRounded":c=p*.516,l=p-c,r=Math.cos(m+je)*l,u=Math.cos(m+je)*(s?s/2-c:l),a=Math.sin(m+je)*l,h=Math.sin(m+je)*(s?s/2-c:l),e.arc(n-u,i-a,c,m-V,m-lt),e.arc(n+h,i-r,c,m-lt,m),e.arc(n+u,i+a,c,m,m+lt),e.arc(n-h,i+r,c,m+lt,m+V),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,e.rect(n-d,i-l,2*d,2*l);break}m+=je;case"rectRot":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+h,i-r),e.lineTo(n+u,i+a),e.lineTo(n-h,i+r),e.closePath();break;case"crossRot":m+=je;case"cross":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"star":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r),m+=je,u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"line":r=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,e.moveTo(n-r,i-a),e.lineTo(n+r,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function de(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function uo(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function ho(e){e.restore()}function C0(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if(s==="middle"){const o=(t.x+n.x)/2;e.lineTo(o,t.y),e.lineTo(o,n.y)}else s==="after"!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function A0(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function L0(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),N(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function O0(e,t,n,i,s){if(s.strikethrough||s.underline){const o=e.measureText(i),r=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(r,d),e.lineTo(a,d),e.stroke()}}function P0(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function tn(e,t,n,i,s,o={}){const r=nt(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(e.save(),e.font=s.string,L0(e,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&P0(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),N(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),O0(e,n,i,c,o),i+=Number(s.lineHeight);e.restore()}function Di(e,t){const{x:n,y:i,w:s,h:o,radius:r}=t;e.arc(n+r.topLeft,i+r.topLeft,r.topLeft,1.5*V,V,!0),e.lineTo(n,i+o-r.bottomLeft),e.arc(n+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,V,lt,!0),e.lineTo(n+s-r.bottomRight,i+o),e.arc(n+s-r.bottomRight,i+o-r.bottomRight,r.bottomRight,lt,0,!0),e.lineTo(n+s,i+r.topRight),e.arc(n+s-r.topRight,i+r.topRight,r.topRight,0,-lt,!0),e.lineTo(n+r.topLeft,i)}const R0=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,B0=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function N0(e,t){const n=(""+e).match(R0);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const F0=e=>+e||0;function la(e,t){const n={},i=$(t),s=i?Object.keys(t):t,o=$(e)?i?r=>O(e[r],e[t[r]]):r=>e[r]:()=>e;for(const r of s)n[r]=F0(o(r));return n}function yu(e){return la(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Je(e){return la(e,["topLeft","topRight","bottomLeft","bottomRight"])}function St(e){const t=yu(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function ut(e,t){e=e||{},t=t||it.font;let n=O(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let i=O(e.style,t.style);i&&!(""+i).match(B0)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:O(e.family,t.family),lineHeight:N0(O(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:O(e.weight,t.weight),string:""};return s.string=T0(s),s}function Kn(e,t,n,i){let s,o,r;for(s=0,o=e.length;s<o;++s)if(r=e[s],r!==void 0&&r!==void 0)return r}function $0(e,t,n){const{min:i,max:s}=e,o=ru(t,(s-i)/2),r=(a,l)=>n&&a===0?0:a+l;return{min:r(i,-Math.abs(o)),max:r(s,o)}}function Pe(e,t){return Object.assign(Object.create(e),t)}function ca(e,t=[""],n,i,s=()=>e[0]){const o=n||e;typeof i>"u"&&(i=wu("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:i,_getTarget:s,override:a=>ca([a,...e],t,o,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete a._keys,delete e[0][l],!0},get(a,l){return xu(a,l,()=>q0(l,t,e,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(a,l){return Al(a).includes(l)},ownKeys(a){return Al(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function En(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:vu(e,i),setContext:o=>En(e,o,n,i),override:o=>En(e.override(o),t,n,i)};return new Proxy(s,{deleteProperty(o,r){return delete o[r],delete e[r],!0},get(o,r,a){return xu(o,r,()=>j0(o,r,a))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(e,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,r)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,r){return Reflect.has(e,r)},ownKeys(){return Reflect.ownKeys(e)},set(o,r,a){return e[r]=a,delete o[r],!0}})}function vu(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:Oe(n)?n:()=>n,isIndexable:Oe(i)?i:()=>i}}const H0=(e,t)=>e?e+ia(t):t,da=(e,t)=>$(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function xu(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const i=n();return e[t]=i,i}function j0(e,t,n){const{_proxy:i,_context:s,_subProxy:o,_descriptors:r}=e;let a=i[t];return Oe(a)&&r.isScriptable(t)&&(a=z0(t,a,e,n)),nt(a)&&a.length&&(a=U0(t,a,e,r.isIndexable)),da(t,a)&&(a=En(a,s,o&&o[t],r)),a}function z0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,r||i);return a.delete(e),da(e,l)&&(l=ua(s._scopes,s,e,l)),l}function U0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_descriptors:a}=n;if(typeof o.index<"u"&&i(e))return t[o.index%t.length];if($(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=ua(c,s,e,d);t.push(En(u,o,r&&r[e],a))}}return t}function _u(e,t,n){return Oe(e)?e(t,n):e}const V0=(e,t)=>e===!0?t:typeof e=="string"?Le(t,e):void 0;function W0(e,t,n,i,s){for(const o of t){const r=V0(n,o);if(r){e.add(r);const a=_u(r._fallback,n,s);if(typeof a<"u"&&a!==n&&a!==i)return a}else if(r===!1&&typeof i<"u"&&n!==i)return null}return!1}function ua(e,t,n,i){const s=t._rootScopes,o=_u(t._fallback,n,i),r=[...e,...s],a=new Set;a.add(i);let l=Cl(a,r,n,o||n,i);return l===null||typeof o<"u"&&o!==n&&(l=Cl(a,r,o,l,i),l===null)?!1:ca(Array.from(a),[""],s,o,()=>Y0(t,n,i))}function Cl(e,t,n,i,s){for(;n;)n=W0(e,t,n,i,s);return n}function Y0(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];return nt(s)&&$(n)?n:s||{}}function q0(e,t,n,i){let s;for(const o of t)if(s=wu(H0(o,e),n),typeof s<"u")return da(e,s)?ua(n,i,e,s):s}function wu(e,t){for(const n of t){if(!n)continue;const i=n[e];if(typeof i<"u")return i}}function Al(e){let t=e._keys;return t||(t=e._keys=G0(e._scopes)),t}function G0(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function ku(e,t,n,i){const{iScale:s}=e,{key:o="r"}=this._parsing,r=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+n,d=t[c],r[a]={r:s.parse(Le(d,o),c)};return r}const X0=Number.EPSILON||1e-14,In=(e,t)=>t<e.length&&!e[t].skip&&e[t],Su=e=>e==="x"?"y":"x";function K0(e,t,n,i){const s=e.skip?t:e,o=t,r=n.skip?t:n,a=br(o,s),l=br(r,o);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:o.x-u*(r.x-s.x),y:o.y-u*(r.y-s.y)},next:{x:o.x+h*(r.x-s.x),y:o.y+h*(r.y-s.y)}}}function J0(e,t,n){const i=e.length;let s,o,r,a,l,c=In(e,0);for(let d=0;d<i-1;++d)if(l=c,c=In(e,d+1),!(!l||!c)){if(gi(t[d],0,X0)){n[d]=n[d+1]=0;continue}s=n[d]/t[d],o=n[d+1]/t[d],a=Math.pow(s,2)+Math.pow(o,2),!(a<=9)&&(r=3/Math.sqrt(a),n[d]=s*r*t[d],n[d+1]=o*r*t[d])}}function Z0(e,t,n="x"){const i=Su(n),s=e.length;let o,r,a,l=In(e,0);for(let c=0;c<s;++c){if(r=a,a=l,l=In(e,c+1),!a)continue;const d=a[n],u=a[i];r&&(o=(d-r[n])/3,a[`cp1${n}`]=d-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-d)/3,a[`cp2${n}`]=d+o,a[`cp2${i}`]=u+o*t[c])}}function Q0(e,t="x"){const n=Su(t),i=e.length,s=Array(i).fill(0),o=Array(i);let r,a,l,c=In(e,0);for(r=0;r<i;++r)if(a=l,l=c,c=In(e,r+1),!!l){if(c){const d=c[t]-l[t];s[r]=d!==0?(c[n]-l[n])/d:0}o[r]=a?c?Zt(s[r-1])!==Zt(s[r])?0:(s[r-1]+s[r])/2:s[r-1]:s[r]}J0(e,s,o),Z0(e,o,t)}function is(e,t,n){return Math.max(Math.min(e,n),t)}function ty(e,t){let n,i,s,o,r,a=de(e[0],t);for(n=0,i=e.length;n<i;++n)r=o,o=a,a=n<i-1&&de(e[n+1],t),o&&(s=e[n],r&&(s.cp1x=is(s.cp1x,t.left,t.right),s.cp1y=is(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=is(s.cp2x,t.left,t.right),s.cp2y=is(s.cp2y,t.top,t.bottom)))}function ey(e,t,n,i,s){let o,r,a,l;if(t.spanGaps&&(e=e.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Q0(e,s);else{let c=i?e[e.length-1]:e[0];for(o=0,r=e.length;o<r;++o)a=e[o],l=K0(c,a,e[Math.min(o+1,r-(i?0:1))%r],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&ty(e,n)}function ha(){return typeof window<"u"&&typeof document<"u"}function fa(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function eo(e,t,n){let i;return typeof e=="string"?(i=parseInt(e,10),e.indexOf("%")!==-1&&(i=i/100*t.parentNode[n])):i=e,i}const fo=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function ny(e,t){return fo(e).getPropertyValue(t)}const iy=["top","right","bottom","left"];function Ze(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const o=iy[s];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const sy=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function oy(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:o}=i;let r=!1,a,l;if(sy(s,o,e.target))a=s,l=o;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:a,y:l,box:r}}function Ye(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=fo(n),o=s.boxSizing==="border-box",r=Ze(s,"padding"),a=Ze(s,"border","width"),{x:l,y:c,box:d}=oy(e,n),u=r.left+(d&&a.left),h=r.top+(d&&a.top);let{width:f,height:g}=t;return o&&(f-=r.width+a.width,g-=r.height+a.height),{x:Math.round((l-u)/f*n.width/i),y:Math.round((c-h)/g*n.height/i)}}function ry(e,t,n){let i,s;if(t===void 0||n===void 0){const o=e&&fa(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const r=o.getBoundingClientRect(),a=fo(o),l=Ze(a,"border","width"),c=Ze(a,"padding");t=r.width-c.width-l.width,n=r.height-c.height-l.height,i=eo(a.maxWidth,o,"clientWidth"),s=eo(a.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:i||Qs,maxHeight:s||Qs}}const De=e=>Math.round(e*10)/10;function ay(e,t,n,i){const s=fo(e),o=Ze(s,"margin"),r=eo(s.maxWidth,e,"clientWidth")||Qs,a=eo(s.maxHeight,e,"clientHeight")||Qs,l=ry(e,t,n);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=Ze(s,"border","width"),f=Ze(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=De(Math.min(c,r,l.maxWidth)),d=De(Math.min(d,a,l.maxHeight)),c&&!d&&(d=De(c/2)),(t!==void 0||n!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=De(Math.floor(d*i))),{width:c,height:d}}function Ll(e,t,n){const i=t||1,s=De(e.height*i),o=De(e.width*i);e.height=De(e.height),e.width=De(e.width);const r=e.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${e.height}px`,r.style.width=`${e.width}px`),e.currentDevicePixelRatio!==i||r.height!==s||r.width!==o?(e.currentDevicePixelRatio=i,r.height=s,r.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0):!1}const ly=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};ha()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function Ol(e,t){const n=ny(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function qe(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function cy(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:i==="middle"?n<.5?e.y:t.y:i==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function dy(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},r=qe(e,s,n),a=qe(s,o,n),l=qe(o,t,n),c=qe(r,a,n),d=qe(a,l,n);return qe(c,d,n)}const uy=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,i){return n-i},leftForLtr(n,i){return n-i}}},hy=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function xn(e,t,n){return e?uy(t,n):hy()}function Eu(e,t){let n,i;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function Iu(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function Du(e){return e==="angle"?{between:Ii,compare:f0,normalize:wt}:{between:le,compare:(t,n)=>t-n,normalize:t=>t}}function Pl({start:e,end:t,count:n,loop:i,style:s}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n===0,style:s}}function fy(e,t,n){const{property:i,start:s,end:o}=n,{between:r,normalize:a}=Du(i),l=t.length;let{start:c,end:d,loop:u}=e,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(a(t[c%l][i]),s,o);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:e.style}}function Tu(e,t,n){if(!n)return[e];const{property:i,start:s,end:o}=n,r=t.length,{compare:a,between:l,normalize:c}=Du(i),{start:d,end:u,loop:h,style:f}=fy(e,t,n),g=[];let p=!1,m=null,b,y,v;const _=()=>l(s,v,b)&&a(s,v)!==0,x=()=>a(o,b)===0||l(o,v,b),w=()=>p||_(),k=()=>!p||x();for(let S=d,D=d;S<=u;++S)y=t[S%r],!y.skip&&(b=c(y[i]),b!==v&&(p=l(b,s,o),m===null&&w()&&(m=a(b,s)===0?S:D),m!==null&&k()&&(g.push(Pl({start:m,end:S,loop:h,count:r,style:f})),m=null),D=S,v=b));return m!==null&&g.push(Pl({start:m,end:u,loop:h,count:r,style:f})),g}function Mu(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const o=Tu(i[s],e.points,t);o.length&&n.push(...o)}return n}function gy(e,t,n,i){let s=0,o=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(o+=s);o>s&&e[o%t].skip;)o--;return o%=t,{start:s,end:o}}function py(e,t,n,i){const s=e.length,o=[];let r=t,a=e[t],l;for(l=t+1;l<=n;++l){const c=e[l%s];c.skip||c.stop?a.skip||(i=!1,o.push({start:t%s,end:(l-1)%s,loop:i}),t=r=c.stop?l:null):(r=l,a.skip&&(t=l)),a=c}return r!==null&&o.push({start:t%s,end:r%s,loop:i}),o}function my(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const o=!!e._loop,{start:r,end:a}=gy(n,s,o,i);if(i===!0)return Rl(e,[{start:r,end:a,loop:o}],n,t);const l=a<r?a+s:a,c=!!e._fullLoop&&r===0&&a===s-1;return Rl(e,py(n,r,l,c),n,t)}function Rl(e,t,n,i){return!i||!i.setContext||!n?t:by(e,t,n,i)}function by(e,t,n,i){const s=e._chart.getContext(),o=Bl(e.options),{_datasetIndex:r,options:{spanGaps:a}}=e,l=n.length,c=[];let d=o,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;n[g%l].skip;)g-=y;for(;n[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=n[u%l],m;for(h=u+1;h<=g.end;h++){const b=n[h%l];m=Bl(i.setContext(Pe(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),yy(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Bl(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function yy(e,t){if(!t)return!1;const n=[],i=function(s,o){return aa(o)?(n.includes(o)||n.push(o),n.indexOf(o)):o};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function ss(e,t,n){return e.options.clip?e[n]:t[n]}function vy(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:ss(n,t,"left"),right:ss(n,t,"right"),top:ss(i,t,"top"),bottom:ss(i,t,"bottom")}:t}function Cu(e,t){const n=t._clip;if(n.disabled)return!1;const i=vy(t,e.chartArea);return{left:n.left===!1?0:i.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:i.right+(n.right===!0?0:n.right),top:n.top===!1?0:i.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:i.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class xy{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,s){const o=n.listeners[s],r=n.duration;o.forEach(a=>a({chart:t,initial:n.initial,numSteps:r,currentStep:Math.min(i-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=hu.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,a=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(o[r]=o[o.length-1],o.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),o.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var ie=new xy;const Nl="transparent",_y={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const i=Dl(e||Nl),s=i.valid&&Dl(t||Nl);return s&&s.valid?s.mix(i,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class wy{constructor(t,n,i,s){const o=n[i];s=Kn([t.to,s,o,t.from]);const r=Kn([t.from,o,s]);this._active=!0,this._fn=t.fn||_y[t.type||typeof r],this._easing=pi[t.easing]||pi.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=r,this._to=s,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const s=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=Kn([t.to,n,s,t.from]),this._from=Kn([t.from,s,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,s=this._prop,o=this._from,r=this._loop,a=this._to;let l;if(this._active=o!==a&&(r||n<i),!this._active){this._target[s]=a,this._notify(!0);return}if(n<0){this._target[s]=o;return}l=n/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(o,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][n]()}}class Au{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!$(t))return;const n=Object.keys(it.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const o=t[s];if(!$(o))return;const r={};for(const a of n)r[a]=o[a];(nt(o.properties)&&o.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,n){const i=n.options,s=Sy(t,i);if(!s)return[];const o=this._createAnimations(s,i);return i.$shared&&ky(t.options.$animations,i).then(()=>{t.options=i},()=>{}),o}_createAnimations(t,n){const i=this._properties,s=[],o=t.$animations||(t.$animations={}),r=Object.keys(n),a=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,n));continue}const d=n[c];let u=o[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}o[c]=u=new wy(h,t,c,d),s.push(u)}return s}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const i=this._createAnimations(t,n);if(i.length)return ie.add(this._chart,i),!0}}function ky(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const o=e[i[s]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function Sy(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Fl(e,t){const n=e&&e.options||{},i=n.reverse,s=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:i?o:s,end:i?s:o}}function Ey(e,t,n){if(n===!1)return!1;const i=Fl(e,n),s=Fl(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function Iy(e){let t,n,i,s;return $(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:e===!1}}function Lu(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,o;for(s=0,o=i.length;s<o;++s)n.push(i[s].index);return n}function $l(e,t,n,i={}){const s=e.keys,o=i.mode==="single";let r,a,l,c;if(t===null)return;let d=!1;for(r=0,a=s.length;r<a;++r){if(l=+s[r],l===n){if(d=!0,i.all)continue;break}c=e.values[l],rt(c)&&(o||t===0||Zt(t)===Zt(c))&&(t+=c)}return!d&&!i.all?0:t}function Dy(e,t){const{iScale:n,vScale:i}=t,s=n.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(e),a=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],a[l]={[s]:d,[o]:e[d]};return a}function zo(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function Ty(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function My(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}function Cy(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function Hl(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const o=e[s.index];if(n&&o>0||!n&&o<0)return s.index}return null}function jl(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:o,vScale:r,index:a}=i,l=o.axis,c=r.axis,d=Ty(o,r,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=Cy(s,d,p),h[a]=m,h._top=Hl(h,r,!0,i.type),h._bottom=Hl(h,r,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function Uo(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function Ay(e,t){return Pe(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Ly(e,t,n){return Pe(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function Bn(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const s of t){const o=s._stacks;if(!o||o[i]===void 0||o[i][n]===void 0)return;delete o[i][n],o[i]._visualValues!==void 0&&o[i]._visualValues[n]!==void 0&&delete o[i]._visualValues[n]}}}const Vo=e=>e==="reset"||e==="none",zl=(e,t)=>t?e:Object.assign({},e),Oy=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:Lu(n,!0),values:null};class Yt{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=zo(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Bn(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,o=n.xAxisID=O(i.xAxisID,Uo(t,"x")),r=n.yAxisID=O(i.yAxisID,Uo(t,"y")),a=n.rAxisID=O(i.rAxisID,Uo(t,"r")),l=n.indexAxis,c=n.iAxisID=s(l,o,r,a),d=n.vAxisID=s(l,r,o,a);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Sl(this._data,this),t._stacked&&Bn(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if($(n)){const s=this._cachedMeta;this._data=Dy(n,s)}else if(i!==n){if(i){Sl(i,this);const s=this._cachedMeta;Bn(s),s._parsed=[]}n&&Object.isExtensible(n)&&b0(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const o=n._stacked;n._stacked=zo(n.vScale,n),n.stack!==i.stack&&(s=!0,Bn(n),n.stack=i.stack),this._resyncElements(t),(s||o!==n._stacked)&&(jl(this,n._parsed),n._stacked=zo(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:i,_data:s}=this,{iScale:o,_stacked:r}=i,a=o.axis;let l=t===0&&n===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{nt(s[t])?h=this.parseArrayData(i,s,t,n):$(s[t])?h=this.parseObjectData(i,s,t,n):h=this.parsePrimitiveData(i,s,t,n);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<n;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}r&&jl(this,h)}parsePrimitiveData(t,n,i,s){const{iScale:o,vScale:r}=t,a=o.axis,l=r.axis,c=o.getLabels(),d=o===r,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||o.parse(c[g],g),[l]:r.parse(n[g],g)};return u}parseArrayData(t,n,i,s){const{xScale:o,yScale:r}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=n[d],a[l]={x:o.parse(u[0],d),y:r.parse(u[1],d)};return a}parseObjectData(t,n,i,s){const{xScale:o,yScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=n[h],c[d]={x:o.parse(Le(f,a),h),y:r.parse(Le(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){const s=this.chart,o=this._cachedMeta,r=n[t.axis],a={keys:Lu(s,!0),values:n._stacks[t.axis]._visualValues};return $l(a,r,o.index,{mode:i})}updateRangeFromParsed(t,n,i,s){const o=i[n.axis];let r=o===null?NaN:o;const a=s&&i._stacks[n.axis];s&&a&&(s.values=a,r=$l(s,o,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,n){const i=this._cachedMeta,s=i._parsed,o=i._sorted&&t===i.iScale,r=s.length,a=this._getOtherScale(t),l=Oy(n,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=My(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!rt(f[t.axis])||d>p||u<p}for(h=0;h<r&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),o));++h);if(o){for(h=r-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const n=this._cachedMeta._parsed,i=[];let s,o,r;for(s=0,o=n.length;s<o;++s)r=n[s][t.axis],rt(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,i=n.iScale,s=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:s?""+s.getLabelForValue(o[s.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=Iy(O(this.options.clip,Ey(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,i=this._cachedMeta,s=i.data||[],o=n.chartArea,r=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,o,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?r.push(u):u.draw(t,o))}for(d=0;d<r.length;++d)r[d].draw(t,o)}getStyle(t,n){const i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){const s=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];o=r.$context||(r.$context=Ly(this.getContext(),t,r)),o.parsed=this.getParsed(t),o.raw=s.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=Ay(this.chart.getContext(),this.index)),o.dataset=s,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){const s=n==="active",o=this._cachedDataOpts,r=t+"-"+n,a=o[r],l=this.enableOptionSharing&&Ei(i);if(a)return zl(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(it.elements[t]),g=()=>this.getContext(i,s,n),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,o[r]=Object.freeze(zl(p,l))),p}_resolveAnimations(t,n,i){const s=this.chart,o=this._cachedDataOpts,r=`animation-${n}`,a=o[r];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,n))}const c=new Au(s,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||Vo(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const i=this.resolveDataElementOptions(t,n),s=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(n,o)||o!==s;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:r}}updateElement(t,n,i,s){Vo(s)?Object.assign(t,i):this._resolveAnimations(n,s).update(t,i)}updateSharedOptions(t,n,i){t&&!Vo(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,s){t.active=s;const o=this.getStyle(n,s);this._resolveAnimations(n,i,s).update(t,{options:!s&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,o=n.length,r=Math.min(o,s);r&&this.parse(0,r),o>s?this._insertElements(s,o-s,t):o<s&&this._removeElements(o,s-o)}_insertElements(t,n,i=!0){const s=this._cachedMeta,o=s.data,r=t+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=r;a--)c[a]=c[a-n]};for(l(o),a=t;a<r;++a)o[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,s){}_removeElements(t,n){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,n);i._stacked&&Bn(i,s)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,i,s]=t;this[n](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}I(Yt,"defaults",{}),I(Yt,"datasetElementType",null),I(Yt,"dataElementType",null);function Py(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let s=0,o=n.length;s<o;s++)i=i.concat(n[s].controller.getAllParsedValues(e));e._cache.$bar=uu(i.sort((s,o)=>s-o))}return e._cache.$bar}function Ry(e){const t=e.iScale,n=Py(t,e.type);let i=t._length,s,o,r,a;const l=()=>{r===32767||r===-32768||(Ei(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(s=0,o=n.length;s<o;++s)r=t.getPixelForValue(n[s]),l();for(a=void 0,s=0,o=t.ticks.length;s<o;++s)r=t.getPixelForTick(s),l();return i}function By(e,t,n,i){const s=n.barThickness;let o,r;return N(s)?(o=t.min*n.categoryPercentage,r=n.barPercentage):(o=s*i,r=1),{chunk:o/i,ratio:r,start:t.pixels[e]-o/2}}function Ny(e,t,n,i){const s=t.pixels,o=s[e];let r=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;r===null&&(r=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-r);const c=o-(o-Math.min(r,a))/2*l;return{chunk:Math.abs(a-r)/2*l/i,ratio:n.barPercentage,start:c}}function Fy(e,t,n,i){const s=n.parse(e[0],i),o=n.parse(e[1],i),r=Math.min(s,o),a=Math.max(s,o);let l=r,c=a;Math.abs(r)>Math.abs(a)&&(l=a,c=r),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:o,min:r,max:a}}function Ou(e,t,n,i){return nt(e)?Fy(e,t,n,i):t[n.axis]=n.parse(e,i),t}function Ul(e,t,n,i){const s=e.iScale,o=e.vScale,r=s.getLabels(),a=s===o,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(r[c],c),l.push(Ou(h,u,o,c));return l}function Wo(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function $y(e,t,n){return e!==0?Zt(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function Hy(e){let t,n,i,s,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",o="start"):(s="start",o="end"),{start:n,end:i,reverse:t,top:s,bottom:o}}function jy(e,t,n,i){let s=t.borderSkipped;const o={};if(!s){e.borderSkipped=o;return}if(s===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:l,top:c,bottom:d}=Hy(e);s==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=d:(o[Vl(d,r,a,l)]=!0,s=c)),o[Vl(s,r,a,l)]=!0,e.borderSkipped=o}function Vl(e,t,n,i){return i?(e=zy(e,t,n),e=Wl(e,n,t)):e=Wl(e,t,n),e}function zy(e,t,n){return e===t?n:e===n?t:e}function Wl(e,t,n){return e==="start"?t:e==="end"?n:e}function Uy(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class Es extends Yt{parsePrimitiveData(t,n,i,s){return Ul(t,n,i,s)}parseArrayData(t,n,i,s){return Ul(t,n,i,s)}parseObjectData(t,n,i,s){const{iScale:o,vScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?a:l,d=r.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=n[h],g={},g[o.axis]=o.parse(Le(p,c),h),u.push(Ou(Le(p,d),g,r,h));return u}updateRangeFromParsed(t,n,i,s){super.updateRangeFromParsed(t,n,i,s);const o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:i,vScale:s}=n,o=this.getParsed(t),r=o._custom,a=Wo(r)?"["+r.start+", "+r.end+"]":""+s.getLabelForValue(o[s.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,s){const o=s==="reset",{index:r,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,s);for(let f=n;f<n+i;f++){const g=this.getParsed(f),p=o||N(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||Wo(g._custom)||r===b._top||r===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const v=y.options||t[f].options;jy(y,v,b,r),Uy(y,v,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,n){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(n),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(N(h)||isNaN(h))return!0};for(const d of s)if(!(n!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[O(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,i){const s=this._getStacks(t,i),o=n!==void 0?s.indexOf(n):-1;return o===-1?s.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,i=n.iScale,s=[];let o,r;for(o=0,r=n.data.length;o<r;++o)s.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const a=t.barThickness;return{min:a||Ry(n),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:i,index:s},options:{base:o,minBarLength:r}}=this,a=o||0,l=this.getParsed(t),c=l._custom,d=Wo(c);let u=l[n.axis],h=0,f=i?this.applyStack(n,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Zt(u)!==Zt(c.barEnd)&&(h=0),h+=u);const m=!N(o)&&!d?o:h;let b=n.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=n.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<r){p=$y(p,n,a)*r,u===a&&(b-=p/2);const y=n.getPixelForDecimal(0),v=n.getPixelForDecimal(1),_=Math.min(y,v),x=Math.max(y,v);b=Math.max(Math.min(b,x),_),g=b+p,i&&!d&&(l._stacks[n.axis]._visualValues[s]=n.getValueForPixel(g)-n.getValueForPixel(b))}if(b===n.getPixelForValue(a)){const y=Zt(p)*n.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,n){const i=n.scale,s=this.options,o=s.skipNull,r=O(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(n.grouped){const d=o?this._getStackCount(t):n.stackCount,u=s.barThickness==="flex"?Ny(t,n,s,d*c):By(t,n,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(O(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(r,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(r,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,i=t.data,s=i.length;let o=0;for(;o<s;++o)this.getParsed(o)[n.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}I(Es,"id","bar"),I(Es,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),I(Es,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class Is extends Yt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,s){const o=super.parsePrimitiveData(t,n,i,s);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(t,n,i,s){const o=super.parseArrayData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=O(a[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(t,n,i,s){const o=super.parseObjectData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=O(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,s),d=r.axis,u=a.axis;for(let h=n;h<n+i;h++){const f=t[h],g=!o&&this.getParsed(h),p={},m=p[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(g[d]),b=p[u]=o?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),o&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,n){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,n);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const o=s.radius;return n!=="active"&&(s.radius=0),s.radius+=O(i&&i._custom,o),s}}I(Is,"id","bubble"),I(Is,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),I(Is,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Vy(e,t,n){let i=1,s=1,o=0,r=0;if(t<tt){const a=e,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(v,_,x)=>Ii(v,a,l,!0)?1:Math.max(_,_*n,x,x*n),g=(v,_,x)=>Ii(v,a,l,!0)?-1:Math.min(_,_*n,x,x*n),p=f(0,c,u),m=f(lt,d,h),b=g(V,c,u),y=g(V+lt,d,h);i=(p-b)/2,s=(m-y)/2,o=-(p+b)/2,r=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:o,offsetY:r}}class Xe extends Yt{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let o=l=>+i[l];if($(i[t])){const{key:l="value"}=this._parsing;o=c=>+Le(i[c],l)}let r,a;for(r=t,a=t+n;r<a;++r)s._parsed[r]=o(r)}}_getRotation(){return Wt(this.options.rotation-90)}_getCircumference(){return Wt(this.options.circumference)}_getRotationExtents(){let t=tt,n=-tt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,o=s._getRotation(),r=s._getCircumference();t=Math.min(t,o),n=Math.max(n,o+r)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:i}=n,s=this._cachedMeta,o=s.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(n0(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Vy(u,d,l),m=(i.width-r)/h,b=(i.height-r)/f,y=Math.max(Math.min(m,b)/2,0),v=ru(this.options.radius,y),_=Math.max(v*l,0),x=(v-_)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=p*v,s.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const i=this.options,s=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*o/tt)}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,a=r.chartArea,c=r.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=o&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(n,s);let b=this._getRotation(),y;for(y=0;y<n;++y)b+=this._circumference(y,o);for(y=n;y<n+i;++y){const v=this._circumference(y,o),_=t[y],x={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+v,circumference:v,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(y,_.active?"active":s)),b+=v,this.updateElement(_,y,x,s)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let i=0,s;for(s=0;s<n.length;s++){const o=t._parsed[s];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(s)&&!n[s].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?tt*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=ji(n._parsed[t],i.options.locale);return{label:s[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const i=this.chart;let s,o,r,a,l;if(!t){for(s=0,o=i.data.datasets.length;s<o;++s)if(i.isDatasetVisible(s)){r=i.getDatasetMeta(s),t=r.data,a=r.controller;break}}if(!t)return 0;for(s=0,o=t.length;s<o;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,s=t.length;i<s;++i){const o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(O(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}I(Xe,"id","doughnut"),I(Xe,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),I(Xe,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),I(Xe,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data,{labels:{pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=t.legend.options;return n.labels.length&&n.datasets.length?n.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:r&&(a||u.borderRadius),index:c}}):[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}});class Ds extends Yt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:i,data:s=[],_dataset:o}=n,r=this.chart._animationsDisabled;let{start:a,count:l}=gu(n,s,r);this._drawStart=a,this._drawCount=l,pu(n)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,s),h=r.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=Sn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||s==="none",y=n+i,v=t.length;let _=n>0&&this.getParsed(n-1);for(let x=0;x<v;++x){const w=t[x],k=b?w:{};if(x<n||x>=y){k.skip=!0;continue}const S=this.getParsed(x),D=N(S[f]),A=k[h]=r.getPixelForValue(S[h],x),T=k[f]=o||D?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[f],x);k.skip=isNaN(A)||isNaN(T)||D,k.stop=x>0&&Math.abs(S[h]-_[h])>m,p&&(k.parsed=S,k.raw=c.data[x]),u&&(k.options=d||this.resolveDataElementOptions(x,w.active?"active":s)),b||this.updateElement(w,x,k,s),_=S}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const o=s[0].size(this.resolveDataElementOptions(0)),r=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,o,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}I(Ds,"id","line"),I(Ds,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),I(Ds,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class bi extends Yt{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=ji(n._parsed[t].r,i.options.locale);return{label:s[t]||"",value:o}}parseObjectData(t,n,i,s){return ku.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const o=this.getParsed(s).r;!isNaN(o)&&this.chart.getDataVisibility(s)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,i=t.options,s=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(s/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),a=(o-r)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*V;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<n;++g)f+=this._computeAngle(g,s,p);for(g=n;g<n+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),v=r.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,o&&(l.animateScale&&(v=0),l.animateRotate&&(b=y=h));const _={x:d,y:u,innerRadius:0,outerRadius:v,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,_,s)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?Wt(this.resolveDataElementOptions(t,n).angle||i):0}}I(bi,"id","polarArea"),I(bi,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),I(bi,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return n.labels.map((o,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class xr extends Xe{}I(xr,"id","pie"),I(xr,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Ts extends Yt{getLabelAndValue(t){const n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,s){return ku.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta,i=n.dataset,s=n.data||[],o=n.iScale.getLabels();if(i.points=s,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===s.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,n,i,s){const o=this._cachedMeta.rScale,r=s==="reset";for(let a=n;a<n+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=o.getPointPositionForValue(a,this.getParsed(a).r),u=r?o.xCenter:d.x,h=r?o.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}I(Ts,"id","radar"),I(Ts,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),I(Ts,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Ms extends Yt{getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const n=this._cachedMeta,{data:i=[]}=n,s=this.chart._animationsDisabled;let{start:o,count:r}=gu(n,i,s);if(this._drawStart=o,this._drawCount=r,pu(n)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=r.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=Sn(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||s==="none";let v=n>0&&this.getParsed(n-1);for(let _=n;_<n+i;++_){const x=t[_],w=this.getParsed(_),k=y?x:{},S=N(w[g]),D=k[f]=r.getPixelForValue(w[f],_),A=k[g]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,w,l):w[g],_);k.skip=isNaN(D)||isNaN(A)||S,k.stop=_>0&&Math.abs(w[f]-v[f])>b,m&&(k.parsed=w,k.raw=c.data[_]),h&&(k.options=u||this.resolveDataElementOptions(_,x.active?"active":s)),y||this.updateElement(x,_,k,s),v=w}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let a=0;for(let l=n.length-1;l>=0;--l)a=Math.max(a,n[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!n.length)return s;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,o,r)/2}}I(Ms,"id","scatter"),I(Ms,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),I(Ms,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Wy=Object.freeze({__proto__:null,BarController:Es,BubbleController:Is,DoughnutController:Xe,LineController:Ds,PieController:xr,PolarAreaController:bi,RadarController:Ts,ScatterController:Ms});function Ue(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class ga{constructor(t){I(this,"options");this.options=t||{}}static override(t){Object.assign(ga.prototype,t)}init(){}formats(){return Ue()}parse(){return Ue()}format(){return Ue()}add(){return Ue()}diff(){return Ue()}startOf(){return Ue()}endOf(){return Ue()}}var Yy={_date:ga};function qy(e,t,n,i){const{controller:s,data:o,_sorted:r}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&o.length){const c=a._reversePixels?p0:ce;if(i){if(s._sharedOptions){const d=o[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(o,t,n-u),f=c(o,t,n+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(o,t,n);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=e,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!N(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!N(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:o.length-1}}function go(e,t,n,i,s){const o=e.getSortedVisibleDatasetMetas(),r=n[t];for(let a=0,l=o.length;a<l;++a){const{index:c,data:d}=o[a],{lo:u,hi:h}=qy(o[a],t,r,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Gy(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(i,s){const o=t?Math.abs(i.x-s.x):0,r=n?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function Yo(e,t,n,i,s){const o=[];return!s&&!e.isPointInArea(t)||go(e,n,t,function(a,l,c){!s&&!de(a,e.chartArea,0)||a.inRange(t.x,t.y,i)&&o.push({element:a,datasetIndex:l,index:c})},!0),o}function Xy(e,t,n,i){let s=[];function o(r,a,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:u}=cu(r,{x:t.x,y:t.y});Ii(u,c,d)&&s.push({element:r,datasetIndex:a,index:l})}return go(e,n,t,o),s}function Ky(e,t,n,i,s,o){let r=[];const a=Gy(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!o||e.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return go(e,n,t,c),r}function qo(e,t,n,i,s,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!i?Xy(e,t,n,s):Ky(e,t,n,i,s,o)}function Yl(e,t,n,i,s){const o=[],r=n==="x"?"inXRange":"inYRange";let a=!1;return go(e,n,t,(l,c,d)=>{l[r]&&l[r](t[n],s)&&(o.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:o}var Jy={modes:{index(e,t,n,i){const s=Ye(t,e),o=n.axis||"x",r=n.includeInvisible||!1,a=n.intersect?Yo(e,s,o,i,r):qo(e,s,o,!1,i,r),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;let a=n.intersect?Yo(e,s,o,i,r):qo(e,s,o,!1,i,r);if(a.length>0){const l=a[0].datasetIndex,c=e.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return Yo(e,s,o,i,r)},nearest(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return qo(e,s,o,n.intersect,i,r)},x(e,t,n,i){const s=Ye(t,e);return Yl(e,s,"x",n.intersect,i)},y(e,t,n,i){const s=Ye(t,e);return Yl(e,s,"y",n.intersect,i)}}};const Pu=["left","top","right","bottom"];function Nn(e,t){return e.filter(n=>n.pos===t)}function ql(e,t){return e.filter(n=>Pu.indexOf(n.pos)===-1&&n.box.axis===t)}function Fn(e,t){return e.sort((n,i)=>{const s=t?i:n,o=t?n:i;return s.weight===o.weight?s.index-o.index:s.weight-o.weight})}function Zy(e){const t=[];let n,i,s,o,r,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],{position:o,options:{stack:r,stackWeight:a=1}}=s,t.push({index:n,box:s,pos:o,horizontal:s.isHorizontal(),weight:s.weight,stack:r&&o+r,stackWeight:a});return t}function Qy(e){const t={};for(const n of e){const{stack:i,pos:s,stackWeight:o}=n;if(!i||!Pu.includes(s))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}function tv(e,t){const n=Qy(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let o,r,a;for(o=0,r=e.length;o<r;++o){a=e[o];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return n}function ev(e){const t=Zy(e),n=Fn(t.filter(c=>c.box.fullSize),!0),i=Fn(Nn(t,"left"),!0),s=Fn(Nn(t,"right")),o=Fn(Nn(t,"top"),!0),r=Fn(Nn(t,"bottom")),a=ql(t,"x"),l=ql(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:s.concat(l).concat(r).concat(a),chartArea:Nn(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:o.concat(r).concat(a)}}function Gl(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function Ru(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function nv(e,t,n,i){const{pos:s,box:o}=n,r=e.maxPadding;if(!$(s)){n.size&&(e[s]-=n.size);const u=i[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?o.height:o.width),n.size=u.size/u.count,e[s]+=n.size}o.getPadding&&Ru(r,o.getPadding());const a=Math.max(0,t.outerWidth-Gl(r,e,"left","right")),l=Math.max(0,t.outerHeight-Gl(r,e,"top","bottom")),c=a!==e.w,d=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function iv(e){const t=e.maxPadding;function n(i){const s=Math.max(t[i]-e[i],0);return e[i]+=s,s}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function sv(e,t){const n=t.maxPadding;function i(s){const o={left:0,top:0,right:0,bottom:0};return s.forEach(r=>{o[r]=Math.max(t[r],n[r])}),o}return i(e?["left","right"]:["top","bottom"])}function Jn(e,t,n,i){const s=[];let o,r,a,l,c,d;for(o=0,r=e.length,c=0;o<r;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,sv(a.horizontal,t));const{same:u,other:h}=nv(t,n,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&Jn(s,t,n,i)||d}function os(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function Xl(e,t,n,i){const s=n.padding;let{x:o,y:r}=t;for(const a of e){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;Ei(c.start)&&(r=c.start),l.fullSize?os(l,s.left,r,n.outerWidth-s.right-s.left,h):os(l,t.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=t.h*d,h=c.size||l.width;Ei(c.start)&&(o=c.start),l.fullSize?os(l,o,s.top,h,n.outerHeight-s.bottom-s.top):os(l,o,t.top+c.placed,h,u),c.start=o,c.placed+=u,o=l.right}}t.x=o,t.y=r}var kt={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=St(e.options.layout.padding),o=Math.max(t-s.width,0),r=Math.max(n-s.height,0),a=ev(e.boxes),l=a.vertical,c=a.horizontal;q(e.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},s);Ru(h,St(i));const f=Object.assign({maxPadding:h,w:o,h:r,x:s.left,y:s.top},s),g=tv(l.concat(c),u);Jn(a.fullSize,f,u,g),Jn(l,f,u,g),Jn(c,f,u,g)&&Jn(l,f,u,g),iv(f),Xl(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,Xl(a.rightAndBottom,f,u,g),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},q(a.chartArea,p=>{const m=p.box;Object.assign(m,e.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Bu{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,s){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,s?Math.floor(n/s):i)}}isAttached(t){return!0}updateConfig(t){}}class ov extends Bu{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Cs="$chartjs",rv={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Kl=e=>e===null||e==="";function av(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[Cs]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Kl(s)){const o=Ol(e,"width");o!==void 0&&(e.width=o)}if(Kl(i))if(e.style.height==="")e.height=e.width/(t||2);else{const o=Ol(e,"height");o!==void 0&&(e.height=o)}return e}const Nu=ly?{passive:!0}:!1;function lv(e,t,n){e&&e.addEventListener(t,n,Nu)}function cv(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,Nu)}function dv(e,t){const n=rv[e.type]||e.type,{x:i,y:s}=Ye(e,t);return{type:n,chart:t,native:e,x:i!==void 0?i:null,y:s!==void 0?s:null}}function no(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function uv(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||no(a.addedNodes,i),r=r&&!no(a.removedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function hv(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||no(a.removedNodes,i),r=r&&!no(a.addedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const Ti=new Map;let Jl=0;function Fu(){const e=window.devicePixelRatio;e!==Jl&&(Jl=e,Ti.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function fv(e,t){Ti.size||window.addEventListener("resize",Fu),Ti.set(e,t)}function gv(e){Ti.delete(e),Ti.size||window.removeEventListener("resize",Fu)}function pv(e,t,n){const i=e.canvas,s=i&&fa(i);if(!s)return;const o=fu((a,l)=>{const c=s.clientWidth;n(a,l),c<s.clientWidth&&n()},window),r=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(s),fv(e,o),r}function Go(e,t,n){n&&n.disconnect(),t==="resize"&&gv(e)}function mv(e,t,n){const i=e.canvas,s=fu(o=>{e.ctx!==null&&n(dv(o,e))},e);return lv(i,t,s),s}class bv extends Bu{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(av(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[Cs])return!1;const i=n[Cs].initial;["height","width"].forEach(o=>{const r=i[o];N(r)?n.removeAttribute(o):n.setAttribute(o,r)});const s=i.style||{};return Object.keys(s).forEach(o=>{n.style[o]=s[o]}),n.width=n.width,delete n[Cs],!0}addEventListener(t,n,i){this.removeEventListener(t,n);const s=t.$proxies||(t.$proxies={}),r={attach:uv,detach:hv,resize:pv}[n]||mv;s[n]=r(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),s=i[n];if(!s)return;({attach:Go,detach:Go,resize:Go}[n]||cv)(t,n,s),i[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,s){return ay(t,n,i,s)}isAttached(t){const n=t&&fa(t);return!!(n&&n.isConnected)}}function yv(e){return!ha()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?ov:bv}class qt{constructor(){I(this,"x");I(this,"y");I(this,"active",!1);I(this,"options");I(this,"$animations")}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return Sn(this.x)&&Sn(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const s={};return t.forEach(o=>{s[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),s}}I(qt,"defaults",{}),I(qt,"defaultRoutes");function vv(e,t){const n=e.options.ticks,i=xv(e),s=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?wv(t):[],r=o.length,a=o[0],l=o[r-1],c=[];if(r>s)return kv(t,c,o,r/s),c;const d=_v(o,t,s);if(r>0){let u,h;const f=r>1?Math.round((l-a)/(r-1)):null;for(rs(t,c,d,N(f)?0:a-f,a),u=0,h=r-1;u<h;u++)rs(t,c,d,o[u],o[u+1]);return rs(t,c,d,l,N(f)?t.length:l+f),c}return rs(t,c,d),c}function xv(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}function _v(e,t,n){const i=Sv(e),s=t.length/n;if(!i)return Math.max(s,1);const o=d0(i);for(let r=0,a=o.length-1;r<a;r++){const l=o[r];if(l>s)return l}return Math.max(s,1)}function wv(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}function kv(e,t,n,i){let s=0,o=n[0],r;for(i=Math.ceil(i),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=n[s*i])}function rs(e,t,n,i,s){const o=O(i,0),r=Math.min(O(s,e.length),e.length);let a=0,l,c,d;for(n=Math.ceil(n),s&&(l=s-i,n=l/Math.floor(l/n)),d=o;d<0;)a++,d=Math.round(o+a*n);for(c=Math.max(o,0);c<r;c++)c===d&&(t.push(e[c]),a++,d=Math.round(o+a*n))}function Sv(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}const Ev=e=>e==="left"?"right":e==="right"?"left":e,Zl=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,Ql=(e,t)=>Math.min(t||e,e);function tc(e,t){const n=[],i=e.length/t,s=e.length;let o=0;for(;o<s;o+=i)n.push(e[Math.floor(o)]);return n}function Iv(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),o=e._startPixel,r=e._endPixel,a=1e-6;let l=e.getPixelForTick(s),c;if(!(n&&(i===1?c=Math.max(l-o,r-l):t===0?c=(e.getPixelForTick(1)-l)/2:c=(l-e.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<o-a||l>r+a)))return l}function Dv(e,t){q(e,n=>{const i=n.gc,s=i.length/2;let o;if(s>t){for(o=0;o<s;++o)delete n.data[i[o]];i.splice(0,s)}})}function $n(e){return e.drawTicks?e.tickLength:0}function ec(e,t){if(!e.display)return 0;const n=ut(e.font,t),i=St(e.padding);return(nt(e.text)?e.text.length:1)*n.lineHeight+i.height}function Tv(e,t){return Pe(e,{scale:t,type:"scale"})}function Mv(e,t,n){return Pe(e,{tick:n,index:t,type:"tick"})}function Cv(e,t,n){let i=ra(e);return(n&&t!=="right"||!n&&t==="right")&&(i=Ev(i)),i}function Av(e,t,n,i){const{top:s,left:o,bottom:r,right:a,chart:l}=e,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=r-s,m=a-o;if(e.isHorizontal()){if(f=_t(i,o,a),$(n)){const b=Object.keys(n)[0],y=n[b];g=d[b].getPixelForValue(y)+p-t}else n==="center"?g=(c.bottom+c.top)/2+p-t:g=Zl(e,n,t);h=a-o}else{if($(n)){const b=Object.keys(n)[0],y=n[b];f=d[b].getPixelForValue(y)-m+t}else n==="center"?f=(c.left+c.right)/2-m+t:f=Zl(e,n,t);g=_t(i,r,s),u=n==="left"?-lt:lt}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class on extends qt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:s}=this;return t=Ot(t,Number.POSITIVE_INFINITY),n=Ot(n,Number.NEGATIVE_INFINITY),i=Ot(i,Number.POSITIVE_INFINITY),s=Ot(s,Number.NEGATIVE_INFINITY),{min:Ot(t,i),max:Ot(n,s),minDefined:rt(t),maxDefined:rt(n)}}getMinMax(t){let{min:n,max:i,minDefined:s,maxDefined:o}=this.getUserBounds(),r;if(s&&o)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)r=a[l].controller.getMinMax(this,t),s||(n=Math.min(n,r.min)),o||(i=Math.max(i,r.max));return n=o&&n>i?i:n,i=s&&n>i?n:i,{min:Ot(n,Ot(i,n)),max:Ot(i,Ot(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Z(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:s,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=$0(this,o,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?tc(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=vv(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,i;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Z(this.options.afterUpdate,[this])}beforeSetDimensions(){Z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,s,o;for(i=0,s=t.length;i<s;i++)o=t[i],o.label=Z(n.callback,[o.value,i,t],this)}afterTickToLabelConversion(){Z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=Ql(this.ticks.length,t.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation;let r=s,a,l,c;if(!this._isVisible()||!n.display||s>=o||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=pt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-$n(t.grid)-n.padding-ec(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=sa(Math.min(Math.asin(pt((d.highest.height+6)/a,-1,1)),Math.asin(pt(l/c,-1,1))-Math.asin(pt(h/c,-1,1)))),r=Math.max(s,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){Z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:s,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const l=ec(s,n.options.font);if(a?(t.width=this.maxWidth,t.height=$n(o)+l):(t.height=this.maxHeight,t.width=$n(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=Wt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,s){const{ticks:{align:o,padding:r},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*n.height):(h=i*t.height,f=s*n.width):o==="start"?f=n.width:o==="end"?h=t.width:o!=="inner"&&(h=t.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=t.height/2;o==="start"?(d=0,u=t.height):o==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,i;for(n=0,i=t.length;n<i;n++)N(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=tc(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,i){const{ctx:s,_longestTextCache:o}=this,r=[],a=[],l=Math.floor(n/Ql(n,i));let c=0,d=0,u,h,f,g,p,m,b,y,v,_,x;for(u=0;u<n;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=o[m]=o[m]||{data:{},gc:[]},y=p.lineHeight,v=_=0,!N(g)&&!nt(g))v=to(s,b.data,b.gc,v,g),_=y;else if(nt(g))for(h=0,f=g.length;h<f;++h)x=g[h],!N(x)&&!nt(x)&&(v=to(s,b.data,b.gc,v,x),_+=y);r.push(v),a.push(_),c=Math.max(v,c),d=Math.max(_,d)}Dv(o,n);const w=r.indexOf(c),k=a.indexOf(d),S=D=>({width:r[D]||0,height:a[D]||0});return{first:S(0),last:S(n-1),widest:S(w),highest:S(k),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return g0(this._alignToPixels?ze(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=Mv(this.getContext(),t,i))}return this.$context||(this.$context=Tv(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=Wt(this.labelRotation),i=Math.abs(Math.cos(n)),s=Math.abs(Math.sin(n)),o=this._getLabelSizes(),r=t.autoSkipPadding||0,a=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,s=this.options,{grid:o,position:r,border:a}=s,l=o.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=$n(o),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(z){return ze(i,z,p)};let y,v,_,x,w,k,S,D,A,T,R,G;if(r==="top")y=b(this.bottom),k=this.bottom-h,D=y-m,T=b(t.top)+m,G=t.bottom;else if(r==="bottom")y=b(this.top),T=t.top,G=b(t.bottom)-m,k=y+m,D=this.top+h;else if(r==="left")y=b(this.right),w=this.right-h,S=y-m,A=b(t.left)+m,R=t.right;else if(r==="right")y=b(this.left),A=t.left,R=b(t.right)-m,w=y+m,S=this.left+h;else if(n==="x"){if(r==="center")y=b((t.top+t.bottom)/2+.5);else if($(r)){const z=Object.keys(r)[0],J=r[z];y=b(this.chart.scales[z].getPixelForValue(J))}T=t.top,G=t.bottom,k=y+m,D=k+h}else if(n==="y"){if(r==="center")y=b((t.left+t.right)/2);else if($(r)){const z=Object.keys(r)[0],J=r[z];y=b(this.chart.scales[z].getPixelForValue(J))}w=y-m,S=w-h,A=t.left,R=t.right}const at=O(s.ticks.maxTicksLimit,u),j=Math.max(1,Math.ceil(u/at));for(v=0;v<u;v+=j){const z=this.getContext(v),J=o.setContext(z),mt=a.setContext(z),ht=J.lineWidth,Re=J.color,Be=mt.dash||[],ye=mt.dashOffset,Ln=J.tickWidth,Ne=J.tickColor,On=J.tickBorderDash||[],Fe=J.tickBorderDashOffset;_=Iv(this,v,l),_!==void 0&&(x=ze(i,_,ht),c?w=S=A=R=x:k=D=T=G=x,f.push({tx1:w,ty1:k,tx2:S,ty2:D,x1:A,y1:T,x2:R,y2:G,width:ht,color:Re,borderDash:Be,borderDashOffset:ye,tickWidth:Ln,tickColor:Ne,tickBorderDash:On,tickBorderDashOffset:Fe}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const n=this.axis,i=this.options,{position:s,ticks:o}=i,r=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=o,h=$n(i.grid),f=h+d,g=u?-d:f,p=-Wt(this.labelRotation),m=[];let b,y,v,_,x,w,k,S,D,A,T,R,G="middle";if(s==="top")w=this.bottom-g,k=this._getXAxisLabelAlignment();else if(s==="bottom")w=this.top+g,k=this._getXAxisLabelAlignment();else if(s==="left"){const j=this._getYAxisLabelAlignment(h);k=j.textAlign,x=j.x}else if(s==="right"){const j=this._getYAxisLabelAlignment(h);k=j.textAlign,x=j.x}else if(n==="x"){if(s==="center")w=(t.top+t.bottom)/2+f;else if($(s)){const j=Object.keys(s)[0],z=s[j];w=this.chart.scales[j].getPixelForValue(z)+f}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if($(s)){const j=Object.keys(s)[0],z=s[j];x=this.chart.scales[j].getPixelForValue(z)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?G="top":l==="end"&&(G="bottom"));const at=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){v=a[b],_=v.label;const j=o.setContext(this.getContext(b));S=this.getPixelForTick(b)+o.labelOffset,D=this._resolveTickFontOptions(b),A=D.lineHeight,T=nt(_)?_.length:1;const z=T/2,J=j.color,mt=j.textStrokeColor,ht=j.textStrokeWidth;let Re=k;r?(x=S,k==="inner"&&(b===y-1?Re=this.options.reverse?"left":"right":b===0?Re=this.options.reverse?"right":"left":Re="center"),s==="top"?c==="near"||p!==0?R=-T*A+A/2:c==="center"?R=-at.highest.height/2-z*A+A:R=-at.highest.height+A/2:c==="near"||p!==0?R=A/2:c==="center"?R=at.highest.height/2-z*A:R=at.highest.height-T*A,u&&(R*=-1),p!==0&&!j.showLabelBackdrop&&(x+=A/2*Math.sin(p))):(w=S,R=(1-T)*A/2);let Be;if(j.showLabelBackdrop){const ye=St(j.backdropPadding),Ln=at.heights[b],Ne=at.widths[b];let On=R-ye.top,Fe=0-ye.left;switch(G){case"middle":On-=Ln/2;break;case"bottom":On-=Ln;break}switch(k){case"center":Fe-=Ne/2;break;case"right":Fe-=Ne;break;case"inner":b===y-1?Fe-=Ne:b>0&&(Fe-=Ne/2);break}Be={left:Fe,top:On,width:Ne+ye.width,height:Ln+ye.height,color:j.backdropColor}}m.push({label:_,font:D,textOffset:R,options:{rotation:p,color:J,strokeColor:mt,strokeWidth:ht,textAlign:Re,textBaseline:G,translation:[x,w],backdrop:Be}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-Wt(this.labelRotation))return t==="top"?"left":"right";let s="center";return n.align==="start"?s="left":n.align==="end"?s="right":n.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:s,padding:o}}=this.options,r=this._getLabelSizes(),a=t+o,l=r.widest.width;let c,d;return n==="left"?s?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?s?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:s,width:o,height:r}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,s,o,r),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const s=this.ticks.findIndex(o=>o.value===t);return s>=0?n.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,r;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(n.display)for(o=0,r=s.length;o<r;++o){const l=s[o];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:i,grid:s}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=ze(t,this.left,r)-r/2,d=ze(t,this.right,a)+a/2,u=h=l):(u=ze(t,this.top,r)-r/2,h=ze(t,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&uo(i,s);const o=this.getLabelItems(t);for(const r of o){const a=r.options,l=r.font,c=r.label,d=r.textOffset;tn(i,c,0,d,l,a)}s&&ho(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:s}}=this;if(!i.display)return;const o=ut(i.font),r=St(i.padding),a=i.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||$(n)?(l+=r.bottom,nt(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=Av(this,l,n,a);tn(t,i.text,0,0,o,{color:i.color,maxWidth:u,rotation:h,textAlign:Cv(a,n,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=O(t.grid&&t.grid.z,-1),s=O(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==on.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let o,r;for(o=0,r=n.length;o<r;++o){const a=n[o];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return ut(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class as{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;Pv(n)&&(i=this.register(n));const s=this.items,o=t.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in s||(s[o]=t,Lv(t,r,i),this.override&&it.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,s=this.scope;i in n&&delete n[i],s&&i in it[s]&&(delete it[s][i],this.override&&delete Qe[i])}}function Lv(e,t,n){const i=Si(Object.create(null),[n?it.get(n):{},it.get(t),e.defaults]);it.set(t,i),e.defaultRoutes&&Ov(t,e.defaultRoutes),e.descriptors&&it.describe(t,e.descriptors)}function Ov(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),o=[e].concat(i).join("."),r=t[n].split("."),a=r.pop(),l=r.join(".");it.route(o,s,l,a)})}function Pv(e){return"id"in e&&"defaults"in e}class Rv{constructor(){this.controllers=new as(Yt,"datasets",!0),this.elements=new as(qt,"elements"),this.plugins=new as(Object,"plugins"),this.scales=new as(on,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(s=>{const o=i||this._getRegistryForType(s);i||o.isForType(s)||o===this.plugins&&s.id?this._exec(t,o,s):q(s,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,n,i){const s=ia(t);Z(i["before"+s],[],i),n[t](i),Z(i["after"+s],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const s=n.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var Xt=new Rv;class Bv{constructor(){this._init=void 0}notify(t,n,i,s){if(n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=s?this._descriptors(t).filter(s):this._descriptors(t),r=this._notify(o,t,n,i);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,n,i,s){s=s||{};for(const o of t){const r=o.plugin,a=r[i],l=[n,s,o.options];if(Z(a,l,r)===!1&&s.cancelable)return!1}return!0}invalidate(){N(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,s=O(i.options&&i.options.plugins,{}),o=Nv(i);return s===!1&&!n?[]:$v(t,o,s,n)}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,s=(o,r)=>o.filter(a=>!r.some(l=>a.plugin.id===l.plugin.id));this._notify(s(n,i),t,"stop"),this._notify(s(i,n),t,"start")}}function Nv(e){const t={},n=[],i=Object.keys(Xt.plugins.items);for(let o=0;o<i.length;o++)n.push(Xt.getPlugin(i[o]));const s=e.plugins||[];for(let o=0;o<s.length;o++){const r=s[o];n.indexOf(r)===-1&&(n.push(r),t[r.id]=!0)}return{plugins:n,localIds:t}}function Fv(e,t){return!t&&e===!1?null:e===!0?{}:e}function $v(e,{plugins:t,localIds:n},i,s){const o=[],r=e.getContext();for(const a of t){const l=a.id,c=Fv(i[l],s);c!==null&&o.push({plugin:a,options:Hv(e.config,{plugin:a,local:n[l]},c,r)})}return o}function Hv(e,{plugin:t,local:n},i,s){const o=e.pluginScopeKeys(t),r=e.getOptionScopes(i,o);return n&&t.defaults&&r.push(t.defaults),e.createResolver(r,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function _r(e,t){const n=it.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function jv(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function zv(e,t){return e===t?"_index_":"_value_"}function nc(e){if(e==="x"||e==="y"||e==="r")return e}function Uv(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function wr(e,...t){if(nc(e))return e;for(const n of t){const i=n.axis||Uv(n.position)||e.length>1&&nc(e[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function ic(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function Vv(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(i=>i.xAxisID===e||i.yAxisID===e);if(n.length)return ic(e,"x",n[0])||ic(e,"y",n[0])}return{}}function Wv(e,t){const n=Qe[e.type]||{scales:{}},i=t.scales||{},s=_r(e.type,t),o=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!$(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=wr(r,a,Vv(r,e),it.scales[a.type]),c=zv(l,s),d=n.scales||{};o[r]=fi(Object.create(null),[{axis:l},a,d[l],d[c]])}),e.data.datasets.forEach(r=>{const a=r.type||e.type,l=r.indexAxis||_r(a,t),d=(Qe[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=jv(u,l),f=r[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),fi(o[f],[{axis:h},i[f],d[u]])})}),Object.keys(o).forEach(r=>{const a=o[r];fi(a,[it.scales[a.type],it.scale])}),o}function $u(e){const t=e.options||(e.options={});t.plugins=O(t.plugins,{}),t.scales=Wv(e,t)}function Hu(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function Yv(e){return e=e||{},e.data=Hu(e.data),$u(e),e}const sc=new Map,ju=new Set;function ls(e,t){let n=sc.get(e);return n||(n=t(),sc.set(e,n),ju.add(n)),n}const Hn=(e,t,n)=>{const i=Le(t,n);i!==void 0&&e.add(i)};class qv{constructor(t){this._config=Yv(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Hu(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),$u(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ls(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return ls(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return ls(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,i=this.type;return ls(`${i}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let s=i.get(t);return(!s||n)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,n,i){const{options:s,type:o}=this,r=this._cachedScopes(t,i),a=r.get(n);if(a)return a;const l=new Set;n.forEach(d=>{t&&(l.add(t),d.forEach(u=>Hn(l,t,u))),d.forEach(u=>Hn(l,s,u)),d.forEach(u=>Hn(l,Qe[o]||{},u)),d.forEach(u=>Hn(l,it,u)),d.forEach(u=>Hn(l,yr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),ju.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:t,type:n}=this;return[t,Qe[n]||{},it.datasets[n]||{},{type:n},it,yr]}resolveNamedOptions(t,n,i,s=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=oc(this._resolverCache,t,s);let l=r;if(Xv(r,n)){o.$shared=!1,i=Oe(i)?i():i;const c=this.createResolver(t,i,a);l=En(r,i,c)}for(const c of n)o[c]=l[c];return o}createResolver(t,n,i=[""],s){const{resolver:o}=oc(this._resolverCache,t,i);return $(n)?En(o,n,void 0,s):o}}function oc(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let o=i.get(s);return o||(o={resolver:ca(t,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,o)),o}const Gv=e=>$(e)&&Object.getOwnPropertyNames(e).some(t=>Oe(e[t]));function Xv(e,t){const{isScriptable:n,isIndexable:i}=vu(e);for(const s of t){const o=n(s),r=i(s),a=(r||o)&&e[s];if(o&&(Oe(a)||Gv(a))||r&&nt(a))return!0}return!1}var Kv="4.5.1";const Jv=["top","bottom","left","right","chartArea"];function rc(e,t){return e==="top"||e==="bottom"||Jv.indexOf(e)===-1&&t==="x"}function ac(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function lc(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Z(n&&n.onComplete,[e],t)}function Zv(e){const t=e.chart,n=t.options.animation;Z(n&&n.onProgress,[e],t)}function zu(e){return ha()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const As={},cc=e=>{const t=zu(e);return Object.values(As).filter(n=>n.canvas===t).pop()};function Qv(e,t,n){const i=Object.keys(e);for(const s of i){const o=+s;if(o>=t){const r=e[s];delete e[s],(n>0||o>t)&&(e[o+n]=r)}}}function tx(e,t,n,i){return!n||e.type==="mouseout"?null:i?t:e}class ae{static register(...t){Xt.add(...t),dc()}static unregister(...t){Xt.remove(...t),dc()}constructor(t,n){const i=this.config=new qv(n),s=zu(t),o=cc(s);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||yv(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,r.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=e0(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Bv,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=y0(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],As[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}ie.listen(this,"complete",lc),ie.listen(this,"progress",Zv),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:s,_aspectRatio:o}=this;return N(t)?n&&o?o:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Xt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ll(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Ml(this.canvas,this.ctx),this}stop(){return ie.stop(this),this}resize(t,n){ie.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,s=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,t,n,o),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Ll(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),Z(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};q(n,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,s=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let o=[];n&&(o=o.concat(Object.keys(n).map(r=>{const a=n[r],l=wr(r,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),q(o,r=>{const a=r.options,l=a.id,c=wr(l,a),d=O(a.type,r.dtype);(a.position===void 0||rc(a.position,c)!==rc(r.dposition))&&(a.position=r.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=Xt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),q(s,(r,a)=>{r||delete i[a]}),q(i,r=>{kt.configure(this,r,r.options),kt.addBox(this,r)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((s,o)=>s.index-o.index),i>n){for(let s=n;s<i;++s)this._destroyDatasetMeta(s);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(ac("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,s)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=n.length;i<s;i++){const o=n[i];let r=this.getDatasetMeta(i);const a=o.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=o.indexAxis||_r(a,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=Xt.getController(a),{datasetElementType:c,dataElementType:d}=it.datasets[a];Object.assign(l,{dataElementType:Xt.getElement(d),datasetElementType:c&&Xt.getElement(c)}),r.controller=new l(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){q(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&o.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),s||q(o,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(ac("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){q(this.scales,t=>{kt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!xl(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:o}of n){const r=i==="_removeElements"?-o:o;Qv(t,s,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=o=>new Set(t.filter(r=>r[0]===o).map((r,a)=>a+","+r.splice(1).join(","))),s=i(0);for(let o=1;o<n;o++)if(!xl(s,i(o)))return;return Array.from(s).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;kt.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],q(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,o)=>{s._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Oe(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(n),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(ie.has(this)?this.attached&&!ie.running(this)&&ie.start(this):(this.draw(),lc({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let s,o;for(s=0,o=n.length;s<o;++s){const r=n[s];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=Cu(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&uo(n,s),t.controller.draw(),s&&ho(n),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return de(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,s){const o=Jy.modes[n];return typeof o=="function"?o(this,t,i,s):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let s=i.filter(o=>o&&o._dataset===n).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Pe(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){const i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const s=i?"show":"hide",o=this.getDatasetMeta(t),r=o.controller._resolveAnimations(void 0,s);Ei(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(o,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),ie.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Ml(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete As[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(o,r)=>{n.addEventListener(this,o,r),t[o]=r},s=(o,r,a)=>{o.offsetX=r,o.offsetY=a,this._eventHandler(o)};q(this.options.events,o=>i(o,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(l,c)=>{n.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(n.removeEventListener(this,l,c),delete t[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,s("resize",o),this._stop(),this._resize(0,0),i("attach",a)},n.isAttached(this.canvas)?a():r()}unbindEvents(){q(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},q(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const s=i?"set":"remove";let o,r,a,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){r=t[a];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:o,index:r})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[r],index:r}});!Js(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){const s=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=o(n,t),a=i?t:o(t,n);r.length&&this.updateHoverStyle(r,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},s=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:s=[],options:o}=this,r=n,a=this._getActiveElements(t,s,i,r),l=a0(t),c=tx(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Z(o.onHover,[t,a,this],this),l&&Z(o.onClick,[t,a,this],this));const d=!Js(a,s);return(d||n)&&(this._active=a,this._updateHoverStyles(a,s,n)),this._lastEvent=c,d}_getActiveElements(t,n,i,s){if(t.type==="mouseout")return[];if(!i)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,s)}}I(ae,"defaults",it),I(ae,"instances",As),I(ae,"overrides",Qe),I(ae,"registry",Xt),I(ae,"version",Kv),I(ae,"getChart",cc);function dc(){return q(ae.instances,e=>e._plugins.invalidate())}function ex(e,t,n){const{startAngle:i,x:s,y:o,outerRadius:r,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/r,wt(i-n));if(e.beginPath(),e.arc(s,o,r-c/2,i+u/2,n-u/2),a>0){const h=Math.min(c/a,wt(i-n));e.arc(s,o,a+c/2,n-h/2,i+h/2,!0)}else{const h=Math.min(c/2,r*wt(i-n));if(d==="round")e.arc(s,o,h,n-V/2,i+V/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(n+V/2)+s,p=-f*Math.sin(n+V/2)+o,m=f*Math.cos(i+V/2)+s,b=f*Math.sin(i+V/2)+o;e.lineTo(g,p),e.lineTo(m,b)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function nx(e,t,n){const{startAngle:i,pixelMargin:s,x:o,y:r,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(o,r,a,i-c,n+c),l>s?(c=s/l,e.arc(o,r,l,n+c,i-c,!0)):e.arc(o,r,s,n+lt,i-lt),e.closePath(),e.clip()}function ix(e){return la(e,["outerStart","outerEnd","innerStart","innerEnd"])}function sx(e,t,n,i){const s=ix(e.options.borderRadius),o=(n-t)/2,r=Math.min(o,i*t/2),a=l=>{const c=(n-Math.min(o,l))*i/2;return pt(l,0,Math.min(o,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:pt(s.innerStart,0,r),innerEnd:pt(s.innerEnd,0,r)}}function dn(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function io(e,t,n,i,s,o){const{x:r,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let f=0;const g=s-l;if(i){const j=d>0?d-i:0,z=u>0?u-i:0,J=(j+z)/2,mt=J!==0?g*J/(J+i):g;f=(g-mt)/2}const p=Math.max(.001,g*u-n/V)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:v,outerEnd:_,innerStart:x,innerEnd:w}=sx(t,h,u,y-b),k=u-v,S=u-_,D=b+v/k,A=y-_/S,T=h+x,R=h+w,G=b+x/T,at=y-w/R;if(e.beginPath(),o){const j=(D+A)/2;if(e.arc(r,a,u,D,j),e.arc(r,a,u,j,A),_>0){const ht=dn(S,A,r,a);e.arc(ht.x,ht.y,_,A,y+lt)}const z=dn(R,y,r,a);if(e.lineTo(z.x,z.y),w>0){const ht=dn(R,at,r,a);e.arc(ht.x,ht.y,w,y+lt,at+Math.PI)}const J=(y-w/h+(b+x/h))/2;if(e.arc(r,a,h,y-w/h,J,!0),e.arc(r,a,h,J,b+x/h,!0),x>0){const ht=dn(T,G,r,a);e.arc(ht.x,ht.y,x,G+Math.PI,b-lt)}const mt=dn(k,b,r,a);if(e.lineTo(mt.x,mt.y),v>0){const ht=dn(k,D,r,a);e.arc(ht.x,ht.y,v,b-lt,D)}}else{e.moveTo(r,a);const j=Math.cos(D)*u+r,z=Math.sin(D)*u+a;e.lineTo(j,z);const J=Math.cos(A)*u+r,mt=Math.sin(A)*u+a;e.lineTo(J,mt)}e.closePath()}function ox(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a}=t;let l=t.endAngle;if(o){io(e,t,n,i,l,s);for(let c=0;c<o;++c)e.fill();isNaN(a)||(l=r+(a%tt||tt))}return io(e,t,n,i,l,s),e.fill(),l}function rx(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,g?(e.lineWidth=c*2,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let p=t.endAngle;if(o){io(e,t,n,i,p,s);for(let m=0;m<o;++m)e.stroke();isNaN(a)||(p=r+(a%tt||tt))}g&&nx(e,t,p),l.selfJoin&&p-r>=V&&f===0&&d!=="miter"&&ex(e,t,p),o||(io(e,t,n,i,p,s),e.stroke())}class Zn extends qt{constructor(n){super();I(this,"circumference");I(this,"endAngle");I(this,"fullCircles");I(this,"innerRadius");I(this,"outerRadius");I(this,"pixelMargin");I(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.getProps(["x","y"],s),{angle:r,distance:a}=cu(o,{x:n,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=O(h,c-l),p=Ii(r,l,c)&&l!==c,m=g>=tt||p,b=le(a,d+f,u+f);return m&&b}getCenterPoint(n){const{x:i,y:s,startAngle:o,endAngle:r,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(o+r)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:i,circumference:s}=this,o=(i.offset||0)/4,r=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>tt?Math.floor(s/tt):0,s===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const c=1-Math.sin(Math.min(V,s||0)),d=o*c;n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,ox(n,this,d,r,a),rx(n,this,d,r,a),n.restore()}}I(Zn,"id","arc"),I(Zn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),I(Zn,"defaultRoutes",{backgroundColor:"backgroundColor"}),I(Zn,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function Uu(e,t,n=t){e.lineCap=O(n.borderCapStyle,t.borderCapStyle),e.setLineDash(O(n.borderDash,t.borderDash)),e.lineDashOffset=O(n.borderDashOffset,t.borderDashOffset),e.lineJoin=O(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=O(n.borderWidth,t.borderWidth),e.strokeStyle=O(n.borderColor,t.borderColor)}function ax(e,t,n){e.lineTo(n.x,n.y)}function lx(e){return e.stepped?C0:e.tension||e.cubicInterpolationMode==="monotone"?A0:ax}function Vu(e,t,n={}){const i=e.length,{start:s=0,end:o=i-1}=n,{start:r,end:a}=t,l=Math.max(s,r),c=Math.min(o,a),d=s<r&&o<r||s>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function cx(e,t,n,i){const{points:s,options:o}=t,{count:r,start:a,loop:l,ilen:c}=Vu(s,n,i),d=lx(o);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%r],!g.skip&&(u?(e.moveTo(g.x,g.y),u=!1):d(e,p,g,h,o.stepped),p=g);return l&&(g=s[(a+(h?c:0))%r],d(e,p,g,h,o.stepped)),!!l}function dx(e,t,n,i){const s=t.points,{count:o,start:r,ilen:a}=Vu(s,n,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=_=>(r+(c?a-_:_))%o,v=()=>{p!==m&&(e.lineTo(d,m),e.lineTo(d,p),e.lineTo(d,b))};for(l&&(f=s[y(0)],e.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const _=f.x,x=f.y,w=_|0;w===g?(x<p?p=x:x>m&&(m=x),d=(u*d+_)/++u):(v(),e.lineTo(_,x),g=w,u=0,p=m=x),b=x}v()}function kr(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?dx:cx}function ux(e){return e.stepped?cy:e.tension||e.cubicInterpolationMode==="monotone"?dy:qe}function hx(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),Uu(e,t.options),e.stroke(s)}function fx(e,t,n,i){const{segments:s,options:o}=t,r=kr(t);for(const a of s)Uu(e,o,a.style),e.beginPath(),r(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}const gx=typeof Path2D=="function";function px(e,t,n,i){gx&&!t.options.segment?hx(e,t,n,i):fx(e,t,n,i)}class Te extends qt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;ey(this._points,i,t,s,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=my(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){const i=this.options,s=t[n],o=this.points,r=Mu(this,{property:n,start:s,end:s});if(!r.length)return;const a=[],l=ux(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=o[u],g=o[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[n])/(g[n]-f[n])),m=l(f,g,p,i.stepped);m[n]=t[n],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,n,i){return kr(this)(t,this,n,i)}path(t,n,i){const s=this.segments,o=kr(this);let r=this._loop;n=n||0,i=i||this.points.length-n;for(const a of s)r&=o(t,this,a,{start:n,end:n+i-1});return!!r}draw(t,n,i,s){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),px(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}I(Te,"id","line"),I(Te,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),I(Te,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),I(Te,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function uc(e,t,n,i){const s=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<s.radius+s.hitRadius}class Ls extends qt{constructor(n){super();I(this,"parsed");I(this,"skip");I(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.options,{x:r,y:a}=this.getProps(["x","y"],s);return Math.pow(n-r,2)+Math.pow(i-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(n,i){return uc(this,n,"x",i)}inYRange(n,i){return uc(this,n,"y",i)}getCenterPoint(n){const{x:i,y:s}=this.getProps(["x","y"],n);return{x:i,y:s}}size(n){n=n||this.options||{};let i=n.radius||0;i=Math.max(i,i&&n.hoverRadius||0);const s=i&&n.borderWidth||0;return(i+s)*2}draw(n,i){const s=this.options;this.skip||s.radius<.1||!de(this,i,this.size(s)/2)||(n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.fillStyle=s.backgroundColor,vr(n,s,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}I(Ls,"id","point"),I(Ls,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),I(Ls,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Wu(e,t){const{x:n,y:i,base:s,width:o,height:r}=e.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return e.horizontal?(u=r/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,d=i+u):(u=o/2,a=n-u,l=n+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function Me(e,t,n,i){return e?0:pt(t,n,i)}function mx(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,o=yu(i);return{t:Me(s.top,o.top,0,n),r:Me(s.right,o.right,0,t),b:Me(s.bottom,o.bottom,0,n),l:Me(s.left,o.left,0,t)}}function bx(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,o=Je(s),r=Math.min(t,n),a=e.borderSkipped,l=i||$(s);return{topLeft:Me(!l||a.top||a.left,o.topLeft,0,r),topRight:Me(!l||a.top||a.right,o.topRight,0,r),bottomLeft:Me(!l||a.bottom||a.left,o.bottomLeft,0,r),bottomRight:Me(!l||a.bottom||a.right,o.bottomRight,0,r)}}function yx(e){const t=Wu(e),n=t.right-t.left,i=t.bottom-t.top,s=mx(e,n/2,i/2),o=bx(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,o.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(s.b,s.r))}}}}function Xo(e,t,n,i){const s=t===null,o=n===null,a=e&&!(s&&o)&&Wu(e,i);return a&&(s||le(t,a.left,a.right))&&(o||le(n,a.top,a.bottom))}function vx(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function xx(e,t){e.rect(t.x,t.y,t.w,t.h)}function Ko(e,t,n={}){const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,r=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+o,h:e.h+r,radius:e.radius}}class Os extends qt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:s}}=this,{inner:o,outer:r}=yx(this),a=vx(r.radius)?Di:xx;t.save(),(r.w!==o.w||r.h!==o.h)&&(t.beginPath(),a(t,Ko(r,n,o)),t.clip(),a(t,Ko(o,-n,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Ko(o,n)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,n,i){return Xo(this,t,n,i)}inXRange(t,n){return Xo(this,t,null,n)}inYRange(t,n){return Xo(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:s,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+s)/2:n,y:o?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}I(Os,"id","bar"),I(Os,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),I(Os,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var _x=Object.freeze({__proto__:null,ArcElement:Zn,BarElement:Os,LineElement:Te,PointElement:Ls});const Sr=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],hc=Sr.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function Yu(e){return Sr[e%Sr.length]}function qu(e){return hc[e%hc.length]}function wx(e,t){return e.borderColor=Yu(t),e.backgroundColor=qu(t),++t}function kx(e,t){return e.backgroundColor=e.data.map(()=>Yu(t++)),t}function Sx(e,t){return e.backgroundColor=e.data.map(()=>qu(t++)),t}function Ex(e){let t=0;return(n,i)=>{const s=e.getDatasetMeta(i).controller;s instanceof Xe?t=kx(n,t):s instanceof bi?t=Sx(n,t):s&&(t=wx(n,t))}}function fc(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function Ix(e){return e&&(e.borderColor||e.backgroundColor)}function Dx(){return it.borderColor!=="rgba(0,0,0,0.1)"||it.backgroundColor!=="rgba(0,0,0,0.1)"}var Tx={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:s}=e.config,{elements:o}=s,r=fc(i)||Ix(s)||o&&fc(o)||Dx();if(!n.forceOverride&&r)return;const a=Ex(e);i.forEach(a)}};function Mx(e,t,n,i,s){const o=s.samples||i;if(o>=n)return e.slice(t,t+n);const r=[],a=(n-2)/(o-2);let l=0;const c=t+n-1;let d=t,u,h,f,g,p;for(r[l++]=e[d],u=0;u<o-2;u++){let m=0,b=0,y;const v=Math.floor((u+1)*a)+1+t,_=Math.min(Math.floor((u+2)*a)+1,n)+t,x=_-v;for(y=v;y<_;y++)m+=e[y].x,b+=e[y].y;m/=x,b/=x;const w=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,n)+t,{x:S,y:D}=e[d];for(f=g=-1,y=w;y<k;y++)g=.5*Math.abs((S-m)*(e[y].y-D)-(S-e[y].x)*(b-D)),g>f&&(f=g,h=e[y],p=y);r[l++]=h,d=p}return r[l++]=e[c],r}function Cx(e,t,n,i){let s=0,o=0,r,a,l,c,d,u,h,f,g,p;const m=[],b=t+n-1,y=e[t].x,_=e[b].x-y;for(r=t;r<t+n;++r){a=e[r],l=(a.x-y)/_*i,c=a.y;const x=l|0;if(x===d)c<g?(g=c,u=r):c>p&&(p=c,h=r),s=(o*s+a.x)/++o;else{const w=r-1;if(!N(u)&&!N(h)){const k=Math.min(u,h),S=Math.max(u,h);k!==f&&k!==w&&m.push({...e[k],x:s}),S!==f&&S!==w&&m.push({...e[S],x:s})}r>0&&w!==f&&m.push(e[w]),m.push(a),d=x,o=0,g=p=c,u=h=f=r}}return m}function Gu(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function gc(e){e.data.datasets.forEach(t=>{Gu(t)})}function Ax(e,t){const n=t.length;let i=0,s;const{iScale:o}=e,{min:r,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=pt(ce(t,o.axis,r).lo,0,n-1)),c?s=pt(ce(t,o.axis,a).hi+1,i,n)-i:s=n-i,{start:i,count:s}}var Lx={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){gc(e);return}const i=e.width;e.data.datasets.forEach((s,o)=>{const{_data:r,indexAxis:a}=s,l=e.getDatasetMeta(o),c=r||s.data;if(Kn([a,e.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=e.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||e.options.parsing)return;let{start:u,count:h}=Ax(l,c);const f=n.threshold||4*i;if(h<=f){Gu(s);return}N(r)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(n.algorithm){case"lttb":g=Mx(c,u,h,i,n);break;case"min-max":g=Cx(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}s._decimated=g})},destroy(e){gc(e)}};function Ox(e,t,n){const i=e.segments,s=e.points,o=t.points,r=[];for(const a of i){let{start:l,end:c}=a;c=po(l,c,s);const d=Er(n,s[l],s[c],a.loop);if(!t.segments){r.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=Mu(t,d);for(const h of u){const f=Er(n,o[h.start],o[h.end],h.loop),g=Tu(a,s,f);for(const p of g)r.push({source:p,target:h,start:{[n]:pc(d,f,"start",Math.max)},end:{[n]:pc(d,f,"end",Math.min)}})}}return r}function Er(e,t,n,i){if(i)return;let s=t[e],o=n[e];return e==="angle"&&(s=wt(s),o=wt(o)),{property:e,start:s,end:o}}function Px(e,t){const{x:n=null,y:i=null}=e||{},s=t.points,o=[];return t.segments.forEach(({start:r,end:a})=>{a=po(r,a,s);const l=s[r],c=s[a];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):n!==null&&(o.push({x:n,y:l.y}),o.push({x:n,y:c.y}))}),o}function po(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function pc(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function Xu(e,t){let n=[],i=!1;return nt(e)?(i=!0,n=e):n=Px(e,t),n.length?new Te({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function mc(e){return e&&e.fill!==!1}function Rx(e,t,n){let s=e[t].fill;const o=[t];let r;if(!n)return s;for(;s!==!1&&o.indexOf(s)===-1;){if(!rt(s))return s;if(r=e[s],!r)return!1;if(r.visible)return s;o.push(s),s=r.fill}return!1}function Bx(e,t,n){const i=Hx(e);if($(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return rt(s)&&Math.floor(s)===s?Nx(i[0],t,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Nx(e,t,n,i){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=i?!1:n}function Fx(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:$(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function $x(e,t,n){let i;return e==="start"?i=n:e==="end"?i=t.options.reverse?t.min:t.max:$(e)?i=e.value:i=t.getBaseValue(),i}function Hx(e){const t=e.options,n=t.fill;let i=O(n&&n.target,n);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function jx(e){const{scale:t,index:n,line:i}=e,s=[],o=i.segments,r=i.points,a=zx(t,n);a.push(Xu({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)Ux(s,r[d],a)}return new Te({points:s,options:{}})}function zx(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const o=i[s];if(o.index===t)break;o.hidden||n.unshift(o.dataset)}return n}function Ux(e,t,n){const i=[];for(let s=0;s<n.length;s++){const o=n[s],{first:r,last:a,point:l}=Vx(o,t,"x");if(!(!l||r&&a)){if(r)i.unshift(l);else if(e.push(l),!a)break}}e.push(...i)}function Vx(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const s=i[n],o=e.segments,r=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],u=r[d.start][n],h=r[d.end][n];if(le(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Ku{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:s,y:o,radius:r}=this;return n=n||{start:0,end:tt},t.arc(s,o,r,n.end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:s}=this,o=t.angle;return{x:n+Math.cos(o)*s,y:i+Math.sin(o)*s,angle:o}}}function Wx(e){const{chart:t,fill:n,line:i}=e;if(rt(n))return Yx(t,n);if(n==="stack")return jx(e);if(n==="shape")return!0;const s=qx(e);return s instanceof Ku?s:Xu(s,i)}function Yx(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function qx(e){return(e.scale||{}).getPointPositionForValue?Xx(e):Gx(e)}function Gx(e){const{scale:t={},fill:n}=e,i=Fx(n,t);if(rt(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function Xx(e){const{scale:t,fill:n}=e,i=t.options,s=t.getLabels().length,o=i.reverse?t.max:t.min,r=$x(n,t,o),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,o);return new Ku({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(r)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,r));return a}function Jo(e,t,n){const i=Wx(t),{chart:s,index:o,line:r,scale:a,axis:l}=t,c=r.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(o),p=Cu(s,g);i&&r.points.length&&(uo(e,n),Kx(e,{line:r,target:i,above:h,below:f,area:n,scale:a,axis:l,clip:p}),ho(e))}function Kx(e,t){const{line:n,target:i,above:s,below:o,area:r,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let d=o;o!==s&&(c==="x"?(bc(e,i,r.top),Zo(e,{line:n,target:i,color:s,scale:a,property:c,clip:l}),e.restore(),e.save(),bc(e,i,r.bottom)):c==="y"&&(yc(e,i,r.left),Zo(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),yc(e,i,r.right),d=s)),Zo(e,{line:n,target:i,color:d,scale:a,property:c,clip:l}),e.restore()}function bc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[po(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(d.x,n),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function yc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[po(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(n,d.y),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function Zo(e,t){const{line:n,target:i,property:s,color:o,scale:r,clip:a}=t,l=Ox(n,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=o}={}}=c,g=i!==!0;e.save(),e.fillStyle=f,Jx(e,r,a,g&&Er(s,u,h)),e.beginPath();const p=!!n.pathSegment(e,c);let m;if(g){p?e.closePath():vc(e,i,h,s);const b=!!i.pathSegment(e,d,{move:p,reverse:!0});m=p&&b,m||vc(e,i,u,s)}e.closePath(),e.fill(m?"evenodd":"nonzero"),e.restore()}}function Jx(e,t,n,i){const s=t.chart.chartArea,{property:o,start:r,end:a}=i||{};if(o==="x"||o==="y"){let l,c,d,u;o==="x"?(l=r,c=s.top,d=a,u=s.bottom):(l=s.left,c=r,d=s.right,u=a),e.beginPath(),n&&(l=Math.max(l,n.left),d=Math.min(d,n.right),c=Math.max(c,n.top),u=Math.min(u,n.bottom)),e.rect(l,c,d-l,u-c),e.clip()}}function vc(e,t,n,i){const s=t.interpolate(n,i);s&&e.lineTo(s.x,s.y)}var Zx={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,s=[];let o,r,a,l;for(r=0;r<i;++r)o=e.getDatasetMeta(r),a=o.dataset,l=null,a&&a.options&&a instanceof Te&&(l={visible:e.isDatasetVisible(r),index:r,fill:Bx(a,r,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,s.push(l);for(r=0;r<i;++r)l=s[r],!(!l||l.fill===!1)&&(l.fill=Rx(s,r,n.propagate))},beforeDraw(e,t,n){const i=n.drawTime==="beforeDraw",s=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let r=s.length-1;r>=0;--r){const a=s[r].$filler;a&&(a.line.updateControlPoints(o,a.axis),i&&a.fill&&Jo(e.ctx,a,o))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const i=e.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const o=i[s].$filler;mc(o)&&Jo(e.ctx,o,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!mc(i)||n.drawTime!=="beforeDatasetDraw"||Jo(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const xc=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}},Qx=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class _c extends qt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Z(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=ut(i.font),o=s.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=xc(i,o);let c,d;n.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,a,l)+10):(d=this.maxHeight,c=this._fitCols(r,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,s){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+n/2+o.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>r)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,n,i,s){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:v}=t_(i,n,o,m,s);b>0&&f+v+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:v},h=Math.max(h,y),f+=v+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:s},rtl:o}}=this,r=xn(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=_t(i,this.left+s,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=_t(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+s}else{let a=0,l=_t(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=_t(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;uo(t,this),this._draw(),ho(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:s}=this,{align:o,labels:r}=t,a=it.color,l=xn(t.rtl,this.left,this.width),c=ut(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=xc(r,u),b=function(w,k,S){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const D=O(S.lineWidth,1);if(s.fillStyle=O(S.fillStyle,a),s.lineCap=O(S.lineCap,"butt"),s.lineDashOffset=O(S.lineDashOffset,0),s.lineJoin=O(S.lineJoin,"miter"),s.lineWidth=D,s.strokeStyle=O(S.strokeStyle,a),s.setLineDash(O(S.lineDash,[])),r.usePointStyle){const A={radius:p*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:D},T=l.xPlus(w,g/2),R=k+h;bu(s,A,T,R,r.pointStyleWidth&&g)}else{const A=k+Math.max((u-p)/2,0),T=l.leftForLtr(w,g),R=Je(S.borderRadius);s.beginPath(),Object.values(R).some(G=>G!==0)?Di(s,{x:T,y:A,w:g,h:p,radius:R}):s.rect(T,A,g,p),s.fill(),D!==0&&s.stroke()}s.restore()},y=function(w,k,S){tn(s,S.text,w,k+m/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},v=this.isHorizontal(),_=this._computeTitleHeight();v?f={x:_t(o,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:f={x:this.left+d,y:_t(o,this.top+_+d,this.bottom-n[0].height),line:0},Eu(this.ctx,t.textDirection);const x=m+d;this.legendItems.forEach((w,k)=>{s.strokeStyle=w.fontColor,s.fillStyle=w.fontColor;const S=s.measureText(w.text).width,D=l.textAlign(w.textAlign||(w.textAlign=r.textAlign)),A=g+h+S;let T=f.x,R=f.y;l.setWidth(this.width),v?k>0&&T+A+d>this.right&&(R=f.y+=x,f.line++,T=f.x=_t(o,this.left+d,this.right-i[f.line])):k>0&&R+x>this.bottom&&(T=f.x=T+n[f.line].width+d,f.line++,R=f.y=_t(o,this.top+_+d,this.bottom-n[f.line].height));const G=l.x(T);if(b(G,R,w),T=v0(D,T+g+h,v?T+A:this.right,t.rtl),y(l.x(T),R,w),v)f.x+=A+d;else if(typeof w.text!="string"){const at=c.lineHeight;f.y+=Ju(w,at)+d}else f.y+=x}),Iu(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=ut(n.font),s=St(n.padding);if(!n.display)return;const o=xn(t.rtl,this.left,this.width),r=this.ctx,a=n.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=_t(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+_t(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=_t(a,u,u+h);r.textAlign=o.textAlign(ra(a)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=i.string,tn(r,n.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,n=ut(t.font),i=St(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,s,o;if(le(t,this.left,this.right)&&le(n,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(s=o[i],le(t,s.left,s.left+s.width)&&le(n,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const n=this.options;if(!i_(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,o=Qx(s,i);s&&!o&&Z(n.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!o&&Z(n.onHover,[t,i,this],this)}else i&&Z(n.onClick,[t,i,this],this)}}function t_(e,t,n,i,s){const o=e_(i,e,t,n),r=n_(s,i,t.lineHeight);return{itemWidth:o,itemHeight:r}}function e_(e,t,n,i){let s=e.text;return s&&typeof s!="string"&&(s=s.reduce((o,r)=>o.length>r.length?o:r)),t+n.size/2+i.measureText(s).width}function n_(e,t,n){let i=e;return typeof t.text!="string"&&(i=Ju(t,n)),i}function Ju(e,t){const n=e.text?e.text.length:0;return t*n}function i_(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var s_={id:"legend",_element:_c,start(e,t,n){const i=e.legend=new _c({ctx:e.ctx,options:n,chart:e});kt.configure(e,i,n),kt.addBox(e,i)},stop(e){kt.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;kt.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=St(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:r&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class pa extends qt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const s=nt(i.text)?i.text.length:1;this._padding=St(i.padding);const o=s*ut(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:i,bottom:s,right:o,options:r}=this,a=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=_t(a,i,o),u=n+t,c=o-i):(r.position==="left"?(d=i+t,u=_t(a,s,n),l=V*-.5):(d=o-t,u=_t(a,n,s),l=V*.5),c=s-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=ut(n.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(o);tn(t,n.text,0,0,i,{color:n.color,maxWidth:l,rotation:c,textAlign:ra(n.align),textBaseline:"middle",translation:[r,a]})}}function o_(e,t){const n=new pa({ctx:e.ctx,options:t,chart:e});kt.configure(e,n,t),kt.addBox(e,n),e.titleBlock=n}var r_={id:"title",_element:pa,start(e,t,n){o_(e,n)},stop(e){const t=e.titleBlock;kt.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;kt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const cs=new WeakMap;var a_={id:"subtitle",start(e,t,n){const i=new pa({ctx:e.ctx,options:n,chart:e});kt.configure(e,i,n),kt.addBox(e,i),cs.set(e,i)},stop(e){kt.removeBox(e,cs.get(e)),cs.delete(e)},beforeUpdate(e,t,n){const i=cs.get(e);kt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Qn={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,o=0;for(t=0,n=e.length;t<n;++t){const a=e[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,i=t.y,s=Number.POSITIVE_INFINITY,o,r,a;for(o=0,r=e.length;o<r;++o){const l=e[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=br(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,i=l.y}return{x:n,y:i}}};function Gt(e,t){return t&&(nt(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function se(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function l_(e,t){const{element:n,datasetIndex:i,index:s}=t,o=e.getDatasetMeta(i).controller,{label:r,value:a}=o.getLabelAndValue(s);return{chart:e,label:r,parsed:o.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:o.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function wc(e,t){const n=e.chart.ctx,{body:i,footer:s,title:o}=e,{boxWidth:r,boxHeight:a}=t,l=ut(t.bodyFont),c=ut(t.titleFont),d=ut(t.footerFont),u=o.length,h=s.length,f=i.length,g=St(t.padding);let p=g.height,m=0,b=i.reduce((_,x)=>_+x.before.length+x.lines.length+x.after.length,0);if(b+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*_+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(_){m=Math.max(m,n.measureText(_).width+y)};return n.save(),n.font=c.string,q(e.title,v),n.font=l.string,q(e.beforeBody.concat(e.afterBody),v),y=t.displayColors?r+2+t.boxPadding:0,q(i,_=>{q(_.before,v),q(_.lines,v),q(_.after,v)}),y=0,n.font=d.string,q(e.footer,v),n.restore(),m+=g.width,{width:m,height:p}}function c_(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}function d_(e,t,n,i){const{x:s,width:o}=i,r=n.caretSize+n.caretPadding;if(e==="left"&&s+o+r>t.width||e==="right"&&s-o-r<0)return!0}function u_(e,t,n,i){const{x:s,width:o}=n,{width:r,chartArea:{left:a,right:l}}=e;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=o/2?c="left":s>=r-o/2&&(c="right"),d_(c,e,t,n)&&(c="center"),c}function kc(e,t,n){const i=n.yAlign||t.yAlign||c_(e,n);return{xAlign:n.xAlign||t.xAlign||u_(e,t,n,i),yAlign:i}}function h_(e,t){let{x:n,width:i}=e;return t==="right"?n-=i:t==="center"&&(n-=i/2),n}function f_(e,t,n){let{y:i,height:s}=e;return t==="top"?i+=n:t==="bottom"?i-=s+n:i-=s/2,i}function Sc(e,t,n,i){const{caretSize:s,caretPadding:o,cornerRadius:r}=e,{xAlign:a,yAlign:l}=n,c=s+o,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=Je(r);let g=h_(t,a);const p=f_(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:pt(g,0,i.width-t.width),y:pt(p,0,i.height-t.height)}}function ds(e,t,n){const i=St(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-i.right:e.x+i.left}function Ec(e){return Gt([],se(e))}function g_(e,t,n){return Pe(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function Ic(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Zu={beforeTitle:ne,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:ne,beforeBody:ne,beforeLabel:ne,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return N(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:ne,afterBody:ne,beforeFooter:ne,footer:ne,afterFooter:ne};function Dt(e,t,n,i){const s=e[t].call(n,i);return typeof s>"u"?Zu[t].call(n,i):s}class Ir extends qt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&n.options.animation&&i.animations,o=new Au(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=g_(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:i}=n,s=Dt(i,"beforeTitle",this,t),o=Dt(i,"title",this,t),r=Dt(i,"afterTitle",this,t);let a=[];return a=Gt(a,se(s)),a=Gt(a,se(o)),a=Gt(a,se(r)),a}getBeforeBody(t,n){return Ec(Dt(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:i}=n,s=[];return q(t,o=>{const r={before:[],lines:[],after:[]},a=Ic(i,o);Gt(r.before,se(Dt(a,"beforeLabel",this,o))),Gt(r.lines,Dt(a,"label",this,o)),Gt(r.after,se(Dt(a,"afterLabel",this,o))),s.push(r)}),s}getAfterBody(t,n){return Ec(Dt(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:i}=n,s=Dt(i,"beforeFooter",this,t),o=Dt(i,"footer",this,t),r=Dt(i,"afterFooter",this,t);let a=[];return a=Gt(a,se(s)),a=Gt(a,se(o)),a=Gt(a,se(r)),a}_createItems(t){const n=this._active,i=this.chart.data,s=[],o=[],r=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(l_(this.chart,n[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),q(a,d=>{const u=Ic(t.callbacks,d);s.push(Dt(u,"labelColor",this,d)),o.push(Dt(u,"labelPointStyle",this,d)),r.push(Dt(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=a,a}update(t,n){const i=this.options.setContext(this.getContext()),s=this._active;let o,r=[];if(!s.length)this.opacity!==0&&(o={opacity:0});else{const a=Qn[i.position].call(this,s,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=wc(this,i),c=Object.assign({},a,l),d=kc(this.chart,i,c),u=Sc(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,s){const o=this.getCaretPosition(t,i,s);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){const{xAlign:s,yAlign:o}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=Je(a),{x:h,y:f}=t,{width:g,height:p}=n;let m,b,y,v,_,x;return o==="center"?(_=f+p/2,s==="left"?(m=h,b=m-r,v=_+r,x=_-r):(m=h+g,b=m+r,v=_-r,x=_+r),y=m):(s==="left"?b=h+Math.max(l,d)+r:s==="right"?b=h+g-Math.max(c,u)-r:b=this.caretX,o==="top"?(v=f,_=v-r,m=b-r,y=b+r):(v=f+p,_=v+r,m=b+r,y=b-r),x=v),{x1:m,x2:b,x3:y,y1:v,y2:_,y3:x}}drawTitle(t,n,i){const s=this.title,o=s.length;let r,a,l;if(o){const c=xn(i.rtl,this.x,this.width);for(t.x=ds(this,i.titleAlign,i),n.textAlign=c.textAlign(i.titleAlign),n.textBaseline="middle",r=ut(i.titleFont),a=i.titleSpacing,n.fillStyle=i.titleColor,n.font=r.string,l=0;l<o;++l)n.fillText(s[l],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,l+1===o&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,n,i,s,o){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=ut(o.bodyFont),u=ds(this,"left",o),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=n.y+f;if(o.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,vr(t,p,m,b),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,vr(t,p,m,b)}else{t.lineWidth=$(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=Je(r.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,Di(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),Di(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=r.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){const{body:s}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=ut(i.bodyFont);let h=u.lineHeight,f=0;const g=xn(i.rtl,this.x,this.width),p=function(S){n.fillText(S,g.x(t.x+f),t.y+h/2),t.y+=h+o},m=g.textAlign(r);let b,y,v,_,x,w,k;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,t.x=ds(this,m,i),n.fillStyle=i.bodyColor,q(this.beforeBody,p),f=a&&m!=="right"?r==="center"?c/2+d:c+2+d:0,_=0,w=s.length;_<w;++_){for(b=s[_],y=this.labelTextColors[_],n.fillStyle=y,q(b.before,p),v=b.lines,a&&v.length&&(this._drawColorBox(n,t,_,g,i),h=Math.max(u.lineHeight,l)),x=0,k=v.length;x<k;++x)p(v[x]),h=u.lineHeight;q(b.after,p)}f=0,h=u.lineHeight,q(this.afterBody,p),t.y-=o}drawFooter(t,n,i){const s=this.footer,o=s.length;let r,a;if(o){const l=xn(i.rtl,this.x,this.width);for(t.x=ds(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=l.textAlign(i.footerAlign),n.textBaseline="middle",r=ut(i.footerFont),n.fillStyle=i.footerColor,n.font=r.string,a=0;a<o;++a)n.fillText(s[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,n,i,s){const{xAlign:o,yAlign:r}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=Je(s.cornerRadius);n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.beginPath(),n.moveTo(a+u,l),r==="top"&&this.drawCaret(t,n,i,s),n.lineTo(a+c-h,l),n.quadraticCurveTo(a+c,l,a+c,l+h),r==="center"&&o==="right"&&this.drawCaret(t,n,i,s),n.lineTo(a+c,l+d-g),n.quadraticCurveTo(a+c,l+d,a+c-g,l+d),r==="bottom"&&this.drawCaret(t,n,i,s),n.lineTo(a+f,l+d),n.quadraticCurveTo(a,l+d,a,l+d-f),r==="center"&&o==="left"&&this.drawCaret(t,n,i,s),n.lineTo(a,l+u),n.quadraticCurveTo(a,l,a+u,l),n.closePath(),n.fill(),s.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,i=this.$animations,s=i&&i.x,o=i&&i.y;if(s||o){const r=Qn[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=wc(this,t),l=Object.assign({},r,this._size),c=kc(n,t,l),d=Sc(t,l,c,n);(s._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(n);const s={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=St(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,s,n),Eu(t,n.textDirection),o.y+=r.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),Iu(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),o=!Js(i,s),r=this._positionChanged(s,n);(o||r)&&(this._active=s,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,o=this._active||[],r=this._getActiveElements(t,o,n,i),a=this._positionChanged(r,t),l=n||!Js(r,o)||a;return l&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,i,s){const o=this.options;if(t.type==="mouseout")return[];if(!s)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(t,n){const{caretX:i,caretY:s,options:o}=this,r=Qn[o.position].call(this,t,n);return r!==!1&&(i!==r.x||s!==r.y)}}I(Ir,"positioners",Qn);var p_={id:"tooltip",_element:Ir,positioners:Qn,afterInit(e,t,n){n&&(e.tooltip=new Ir({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Zu},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},m_=Object.freeze({__proto__:null,Colors:Tx,Decimation:Lx,Filler:Zx,Legend:s_,SubTitle:a_,Title:r_,Tooltip:p_});const b_=(e,t,n,i)=>(typeof t=="string"?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function y_(e,t,n,i){const s=e.indexOf(t);if(s===-1)return b_(e,t,n,i);const o=e.lastIndexOf(t);return s!==o?n:s}const v_=(e,t)=>e===null?null:pt(Math.round(e),0,t);function Dc(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Dr extends on{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:s,label:o}of n)i[s]===o&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(N(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:y_(i,t,O(n,t),this._addedLabels),v_(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,s=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=n;r++)s.push({value:r});return s}getLabelForValue(t){return Dc.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}I(Dr,"id","category"),I(Dr,"defaults",{ticks:{callback:Dc}});function x_(e,t){const n=[],{bounds:s,step:o,min:r,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=e,f=o||1,g=d-1,{min:p,max:m}=t,b=!N(r),y=!N(a),v=!N(c),_=(m-p)/(u+1);let x=wl((m-p)/g/f)*f,w,k,S,D;if(x<1e-14&&!b&&!y)return[{value:p},{value:m}];D=Math.ceil(m/x)-Math.floor(p/x),D>g&&(x=wl(D*x/g/f)*f),N(l)||(w=Math.pow(10,l),x=Math.ceil(x*w)/w),s==="ticks"?(k=Math.floor(p/x)*x,S=Math.ceil(m/x)*x):(k=p,S=m),b&&y&&o&&h0((a-r)/o,x/1e3)?(D=Math.round(Math.min((a-r)/x,d)),x=(a-r)/D,k=r,S=a):v?(k=b?r:k,S=y?a:S,D=c-1,x=(S-k)/D):(D=(S-k)/x,gi(D,Math.round(D),x/1e3)?D=Math.round(D):D=Math.ceil(D));const A=Math.max(kl(x),kl(k));w=Math.pow(10,N(l)?A:l),k=Math.round(k*w)/w,S=Math.round(S*w)/w;let T=0;for(b&&(h&&k!==r?(n.push({value:r}),k<r&&T++,gi(Math.round((k+T*x)*w)/w,r,Tc(r,_,e))&&T++):k<r&&T++);T<D;++T){const R=Math.round((k+T*x)*w)/w;if(y&&R>a)break;n.push({value:R})}return y&&h&&S!==a?n.length&&gi(n[n.length-1].value,a,Tc(a,_,e))?n[n.length-1].value=a:n.push({value:a}):(!y||S===a)&&n.push({value:S}),n}function Tc(e,t,{horizontal:n,minRotation:i}){const s=Wt(i),o=(n?Math.sin(s):Math.cos(s))||.001,r=.75*t*(""+e).length;return Math.min(t/o,r)}class so extends on{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return N(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:s,max:o}=this;const r=l=>s=n?s:l,a=l=>o=i?o:l;if(t){const l=Zt(s),c=Zt(o);l<0&&c<0?a(0):l>0&&c>0&&r(0)}if(s===o){let l=o===0?1:Math.abs(o*.05);a(o+l),t||r(s-l)}this.min=s,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),n=n||11),n&&(s=Math.min(n,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,r=x_(s,o);return t.bounds==="ticks"&&lu(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-n)/Math.max(t.length-1,1)/2;n-=s,i+=s}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return ji(t,this.chart.options.locale,this.options.ticks.format)}}class Tr extends so{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=rt(t)?t:0,this.max=rt(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=Wt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}I(Tr,"id","linear"),I(Tr,"defaults",{ticks:{callback:co.formatters.numeric}});const Mi=e=>Math.floor(Ie(e)),Ve=(e,t)=>Math.pow(10,Mi(e)+t);function Mc(e){return e/Math.pow(10,Mi(e))===1}function Cc(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function __(e,t){const n=t-e;let i=Mi(n);for(;Cc(e,t,i)>10;)i++;for(;Cc(e,t,i)<10;)i--;return Math.min(i,Mi(e))}function w_(e,{min:t,max:n}){t=Ot(e.min,t);const i=[],s=Mi(t);let o=__(t,n),r=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=s>o?Math.pow(10,s):0,c=Math.round((t-l)*r)/r,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,o)),h=Ot(e.min,Math.round((l+d+u*Math.pow(10,o))*r)/r);for(;h<n;)i.push({value:h,major:Mc(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,r=o>=0?1:r),h=Math.round((l+d+u*Math.pow(10,o))*r)/r;const f=Ot(e.max,h);return i.push({value:f,major:Mc(f),significand:u}),i}class Mr extends on{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=so.prototype.parse.apply(this,[t,n]);if(i===0){this._zero=!0;return}return rt(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=rt(t)?Math.max(0,t):null,this.max=rt(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!rt(this._userMin)&&(this.min=t===Ve(this.min,0)?Ve(this.min,-1):Ve(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,s=this.max;const o=a=>i=t?i:a,r=a=>s=n?s:a;i===s&&(i<=0?(o(1),r(10)):(o(Ve(i,-1)),r(Ve(s,1)))),i<=0&&o(Ve(s,-1)),s<=0&&r(Ve(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},i=w_(n,this);return t.bounds==="ticks"&&lu(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":ji(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Ie(t),this._valueRange=Ie(this.max)-Ie(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Ie(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}I(Mr,"id","logarithmic"),I(Mr,"defaults",{ticks:{callback:co.formatters.logarithmic,major:{enabled:!0}}});function Cr(e){const t=e.ticks;if(t.display&&e.display){const n=St(t.backdropPadding);return O(t.font&&t.font.size,it.font.size)+n.height}return 0}function k_(e,t,n){return n=nt(n)?n:[n],{w:M0(e,t.string,n),h:n.length*t.lineHeight}}function Ac(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function S_(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],o=e._pointLabels.length,r=e.options.pointLabels,a=r.centerPointLabels?V/o:0;for(let l=0;l<o;l++){const c=r.setContext(e.getPointLabelContext(l));s[l]=c.padding;const d=e.getPointPosition(l,e.drawingArea+s[l],a),u=ut(c.font),h=k_(e.ctx,u,e._pointLabels[l]);i[l]=h;const f=wt(e.getIndexAngle(l)+a),g=Math.round(sa(f)),p=Ac(g,d.x,h.w,0,180),m=Ac(g,d.y,h.h,90,270);E_(n,t,f,p,m)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=T_(e,i,s)}function E_(e,t,n,i,s){const o=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/o,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/r,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/r,e.b=Math.max(e.b,t.b+l))}function I_(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:o,padding:r,size:a}=n,l=e.getPointPosition(t,i+s+r,o),c=Math.round(sa(wt(l.angle+lt))),d=A_(l.y,a.h,c),u=M_(c),h=C_(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function D_(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:o}=e;return!(de({x:n,y:i},t)||de({x:n,y:o},t)||de({x:s,y:i},t)||de({x:s,y:o},t))}function T_(e,t,n){const i=[],s=e._pointLabels.length,o=e.options,{centerPointLabels:r,display:a}=o.pointLabels,l={extra:Cr(o)/2,additionalAngle:r?V/s:0};let c;for(let d=0;d<s;d++){l.padding=n[d],l.size=t[d];const u=I_(e,d,l);i.push(u),a==="auto"&&(u.visible=D_(u,c),u.visible&&(c=u))}return i}function M_(e){return e===0||e===180?"center":e<180?"left":"right"}function C_(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function A_(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function L_(e,t,n){const{left:i,top:s,right:o,bottom:r}=n,{backdropColor:a}=t;if(!N(a)){const l=Je(t.borderRadius),c=St(t.backdropPadding);e.fillStyle=a;const d=i-c.left,u=s-c.top,h=o-i+c.width,f=r-s+c.height;Object.values(l).some(g=>g!==0)?(e.beginPath(),Di(e,{x:d,y:u,w:h,h:f,radius:l}),e.fill()):e.fillRect(d,u,h,f)}}function O_(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const o=e._pointLabelItems[s];if(!o.visible)continue;const r=i.setContext(e.getPointLabelContext(s));L_(n,r,o);const a=ut(r.font),{x:l,y:c,textAlign:d}=o;tn(n,e._pointLabels[s],l,c+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function Qu(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,tt);else{let o=e.getPointPosition(0,t);s.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=e.getPointPosition(r,t),s.lineTo(o.x,o.y)}}function P_(e,t,n,i,s){const o=e.ctx,r=t.circular,{color:a,lineWidth:l}=t;!r&&!i||!a||!l||n<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(s.dash||[]),o.lineDashOffset=s.dashOffset,o.beginPath(),Qu(e,n,r,i),o.closePath(),o.stroke(),o.restore())}function R_(e,t,n){return Pe(e,{label:n,index:t,type:"pointLabel"})}class ti extends so{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=St(Cr(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=rt(t)&&!isNaN(t)?t:0,this.max=rt(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Cr(this.options))}generateTickLabels(t){so.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const s=Z(this.options.pointLabels.callback,[n,i],this);return s||s===0?s:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?S_(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,s){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,s))}getIndexAngle(t){const n=tt/(this._pointLabels.length||1),i=this.options.startAngle||0;return wt(t*n+Wt(i))}getDistanceFromCenterForValue(t){if(N(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(N(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return R_(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const s=this.getIndexAngle(t)-lt+i;return{x:Math.cos(s)*n+this.xCenter,y:Math.sin(s)*n+this.yCenter,angle:s}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:s,bottom:o}=this._pointLabelItems[t];return{left:n,top:i,right:s,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Qu(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:s,border:o}=n,r=this._pointLabels.length;let a,l,c;if(n.pointLabels.display&&O_(this,r),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=o.setContext(h);P_(this,f,l,r,g)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let o,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const c=i.setContext(this.getContext(l)),d=ut(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=St(c.backdropPadding);t.fillRect(-r/2-u.left,-o-d.size/2-u.top,r+u.width,d.size+u.height)}tn(t,a.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}I(ti,"id","radialLinear"),I(ti,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:co.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),I(ti,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),I(ti,"descriptors",{angleLines:{_fallback:"grid"}});const mo={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Mt=Object.keys(mo);function Lc(e,t){return e-t}function Oc(e,t){if(N(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:o}=e._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),rt(r)||(r=typeof i=="string"?n.parse(r,i):n.parse(r)),r===null?null:(s&&(r=s==="week"&&(Sn(o)||o===!0)?n.startOf(r,"isoWeek",o):n.startOf(r,s)),+r)}function Pc(e,t,n,i){const s=Mt.length;for(let o=Mt.indexOf(e);o<s-1;++o){const r=mo[Mt[o]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-t)/(a*r.size))<=i)return Mt[o]}return Mt[s-1]}function B_(e,t,n,i,s){for(let o=Mt.length-1;o>=Mt.indexOf(n);o--){const r=Mt[o];if(mo[r].common&&e._adapter.diff(s,i,r)>=t-1)return r}return Mt[n?Mt.indexOf(n):0]}function N_(e){for(let t=Mt.indexOf(e)+1,n=Mt.length;t<n;++t)if(mo[Mt[t]].common)return Mt[t]}function Rc(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:i,hi:s}=oa(n,t),o=n[i]>=t?n[i]:n[s];e[o]=!0}}function F_(e,t,n,i){const s=e._adapter,o=+s.startOf(t[0].value,i),r=t[t.length-1].value;let a,l;for(a=o;a<=r;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}function Bc(e,t,n){const i=[],s={},o=t.length;let r,a;for(r=0;r<o;++r)a=t[r],s[a]=r,i.push({value:a,major:!1});return o===0||!n?i:F_(e,i,s,n)}class Ci extends on{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const i=t.time||(t.time={}),s=this._adapter=new Yy._date(t.adapters.date);s.init(n),fi(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Oc(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,i=t.time.unit||"day";let{min:s,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=rt(s)&&!isNaN(s)?s:+n.startOf(Date.now(),i),o=rt(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(s,o-1),this.max=Math.max(s+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){const t=this.options,n=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const o=this.min,r=this.max,a=m0(s,o,r);return this._unit=n.unit||(i.autoSkip?Pc(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):B_(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:N_(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Bc(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,s,o;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?n=1-s:n=(this.getDecimalForValue(t[1])-s)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=pt(n,0,r),i=pt(i,0,r),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){const t=this._adapter,n=this.min,i=this.max,s=this.options,o=s.time,r=o.unit||Pc(o.minUnit,n,i,this._getLabelCapacity(n)),a=O(s.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=Sn(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":r),t.diff(i,n,r)>1e5*a)throw new Error(n+" and "+i+" are too far apart with stepSize of "+a+" "+r);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,r),f++)Rc(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Rc(d,h,g),Object.keys(d).sort(Lc).map(p=>+p)}getLabelForValue(t){const n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){const s=this.options.time.displayFormats,o=this._unit,r=n||s[o];return this._adapter.format(t,r)}_tickFormatFunction(t,n,i,s){const o=this.options,r=o.ticks.callback;if(r)return Z(r,[t,n,i],this);const a=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[n],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let n,i,s;for(n=0,i=t.length;n<i;++n)s=t[n],s.label=this._tickFormatFunction(s.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,i=this.ctx.measureText(t).width,s=Wt(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(s),r=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*o+a*r,h:i*r+a*o}}_getLabelCapacity(t){const n=this.options.time,i=n.displayFormats,s=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,Bc(this,[t],this._majorUnit),s),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(n=0,i=s.length;n<i;++n)t=t.concat(s[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,i;if(t.length)return t;const s=this.getLabels();for(n=0,i=s.length;n<i;++n)t.push(Oc(this,s[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return uu(t.sort(Lc))}}I(Ci,"id","time"),I(Ci,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function us(e,t,n){let i=0,s=e.length-1,o,r,a,l;n?(t>=e[i].pos&&t<=e[s].pos&&({lo:i,hi:s}=ce(e,"pos",t)),{pos:o,time:a}=e[i],{pos:r,time:l}=e[s]):(t>=e[i].time&&t<=e[s].time&&({lo:i,hi:s}=ce(e,"time",t)),{time:o,pos:a}=e[i],{time:r,pos:l}=e[s]);const c=r-o;return c?a+(l-a)*(t-o)/c:a}class Ar extends Ci{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=us(n,this.min),this._tableRange=us(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,s=[],o=[];let r,a,l,c,d;for(r=0,a=t.length;r<a;++r)c=t[r],c>=n&&c<=i&&s.push(c);if(s.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(r=0,a=s.length;r<a;++r)d=s[r+1],l=s[r-1],c=s[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(a-1)});return o}_generate(){const t=this.min,n=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(n)||i.length===1)&&i.push(n),i.sort((s,o)=>s-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return n.length&&i.length?t=this.normalize(n.concat(i)):t=n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(us(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return us(this._table,i*this._tableRange+this._minPos,!0)}}I(Ar,"id","timeseries"),I(Ar,"defaults",Ci.defaults);var $_=Object.freeze({__proto__:null,CategoryScale:Dr,LinearScale:Tr,LogarithmicScale:Mr,RadialLinearScale:ti,TimeScale:Ci,TimeSeriesScale:Ar});const H_=[Wy,_x,m_,$_];ae.register(...H_);function bo(e,t=""){return`
        <div class="bg-white/70 dark:bg-gray-900/60 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-800/30 ${t}">
            ${e}
        </div>
    `}const ue={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function Ai(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,n=>t[n])}function j_(e,t,n,i){return bo(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${Ai(e)}</span>
        <span id="${n}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${Ai(t)}</span>
    `,ue.CLASSES.KPI_CARD)}function th(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${ue.KPI_ITEMS.map(e=>j_(e.label,"-",e.id,e.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${ue.CHARTS.map(e=>bo(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${e.dot}"></span> ${Ai(e.label)}
                    </h3>
                    <div class="${ue.CLASSES.CHART_CONTAINER}">
                        <canvas id="${e.id}Chart"></canvas>
                    </div>
                `,`${ue.CLASSES.CHART_CARD} ${e.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function z_(e=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label for="page-search-input" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label for="page-search-project" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(e)?e:[]).map(s=>`<option value="${Ai(s.id)}">${Ai(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${bo(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function U_(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function V_(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Nc=new WeakMap;function W_(e){const t=document.getElementById("dashboard-view");if(!e||!t)return;t.innerHTML=th();const n=e.filter(s=>s.status==="completed"&&s.completedAt);Y_(n),[{id:"daily",color:ue.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:ue.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:ue.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:o,data:r}=q_(n,s.count,s.unit);G_(s.id,o,r,s.color)})}function Y_(e){const t=new Date,n=Ft(t).getTime(),i=wd(t).getTime(),s=ip(t).getTime(),o=e.reduce((r,a)=>{const l=me(a.completedAt);if(!l)return r;const c=l.getTime();return c>=n&&r.today++,c>=i&&r.weekly++,c>=s&&r.monthly++,r},{today:0,weekly:0,monthly:0,total:e.length});Object.entries(o).forEach(([r,a])=>{const l=document.getElementById(`${r}-count`);l&&(l.textContent=a)})}function q_(e,t,n){const i=[],s=[],o=new Date;for(let r=0;r<t;r++){let a,l,c;const d=new Date(o);n==="day"?(d.setDate(o.getDate()-(t-1-r)),a=Ft(d),l=np(d),c=`${a.getMonth()+1}/${a.getDate()}`):n==="week"?(d.setDate(o.getDate()-(t-1-r)*7),a=wd(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(o.getFullYear(),o.getMonth()-(t-1-r),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=e.filter(h=>{const f=me(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function G_(e,t,n,i){const s=document.getElementById(`${e}Chart`);if(!s)return;let o=Nc.get(s);o?(o.data.labels=t,o.data.datasets[0].data=n,o.update()):(o=new ae(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:n,backgroundColor:i,borderRadius:4}]},options:ue.CHART_DEFAULTS}),Nc.set(s,o))}const Rt={isSelectionMode:!1,selectedIds:new Set},Lr=new Set;function X_(e){return Lr.add(e),()=>Lr.delete(e)}function eh(){Lr.forEach(e=>e({isSelectionMode:Rt.isSelectionMode,selectedIds:Rt.selectedIds}))}function Fc(e){Rt.isSelectionMode=e,e||Rt.selectedIds.clear(),eh()}function Qo(e){Rt.selectedIds.has(e)?Rt.selectedIds.delete(e):Rt.selectedIds.add(e),eh()}function nh(e,t,n){var u;(u=document.getElementById("task-context-menu"))==null||u.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[180px] font-sans user-select-none text-gray-700 dark:text-gray-200",i.style.left=`${t}px`,i.style.top=`${n}px`;const s=h=>{i.remove(),h&&h()},o=Rt.isSelectionMode,r=e&&Rt.selectedIds.has(e.id),a=Rt.selectedIds.size;let l="";o&&r&&a>0?l+=`
            <div class="px-3 py-1 text-xs text-gray-500 font-bold border-b border-gray-100 dark:border-gray-700 mb-1">
                ${a}件を選択中
            </div>
            <button id="ctx-bulk-today" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                今日にする
            </button>
            <button id="ctx-bulk-tomorrow" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                明日にする
            </button>
            <button id="ctx-bulk-next-week" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                来週にする
            </button>
            <div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>
            <button id="ctx-bulk-delete" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
                一括削除
            </button>
            <div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>
        `:e&&(l+=`
            <div class="border-b border-gray-100 dark:border-gray-700 pb-1 mb-1">
                 <button id="ctx-today" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                    今日
                </button>
                <button id="ctx-tomorrow" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    <svg class="w-4 h-4 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    明日
                </button>
                <button id="ctx-next-week" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                    <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                    来週
                </button>
            </div>
            <button id="ctx-delete-task-btn" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
                <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                削除
            </button>
            <div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>
        `),l+=`
        <button id="ctx-add-task" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            タスクを追加
        </button>
        <div class="relative group">
            <button class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition justify-between w-full">
                <span class="flex items-center"><svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4h13M3 8h9m-9 4h6m4 0l4-4m0 0l4 4m-4-4v12"></path></svg>並び替え</span>
                <svg class="w-3 h-3 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>
            </button>
            <!-- サブメニュー -->
            <div class="absolute left-full top-0 ml-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 hidden group-hover:block min-w-[120px]">
                 <button id="ctx-sort-name" class="flex w-full items-center px-3 py-2 text-left text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">名前順</button>
                 <button id="ctx-sort-date" class="flex w-full items-center px-3 py-2 text-left text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700">日付順</button>
            </div>
        </div>
        <button id="ctx-select-mode" class="flex w-full items-center px-3 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 transition">
            <svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
            ${o?"複数選択を終了":"複数選択を開始"}
        </button>
    `,i.innerHTML=l,document.body.appendChild(i);const c=(h,f)=>{const g=i.querySelector("#"+h);g&&g.addEventListener("click",f)};if(e&&!r&&(c("ctx-today",()=>s(()=>fn(e.id,{dueDate:Ft(new Date)}))),c("ctx-tomorrow",()=>{const h=Ft(new Date);h.setDate(h.getDate()+1),s(()=>fn(e.id,{dueDate:h}))}),c("ctx-next-week",()=>{const h=Ft(new Date);h.setDate(h.getDate()+(8-h.getDay())),s(()=>fn(e.id,{dueDate:h}))}),c("ctx-delete-task-btn",()=>{s(()=>P("削除しますか？",async()=>await cr(e.id)))})),o&&r&&a>0){const h=f=>{s(async()=>{const g=Array.from(Rt.selectedIds).map(p=>fn(p,f));await Promise.all(g)})};c("ctx-bulk-today",()=>h({dueDate:Ft(new Date)})),c("ctx-bulk-tomorrow",()=>{const f=Ft(new Date);f.setDate(f.getDate()+1),h({dueDate:f})}),c("ctx-bulk-next-week",()=>{const f=Ft(new Date);f.setDate(f.getDate()+(8-f.getDay())),h({dueDate:f})}),c("ctx-bulk-delete",()=>{s(()=>{P(`${a}件のタスクを削除しますか？`,async()=>{const f=Array.from(Rt.selectedIds).map(g=>cr(g));await Promise.all(f),Fc(!1)})})})}c("ctx-add-task",()=>{s(()=>{const h=document.getElementById("task-input-fld");h&&h.focus()})}),c("ctx-sort-name",()=>s(()=>$c("title_asc"))),c("ctx-sort-date",()=>s(()=>$c("dueDate_asc"))),c("ctx-select-mode",()=>{s(()=>{Fc(!o)})});const d=h=>{i.contains(h.target)||(i.remove(),document.removeEventListener("click",d))};setTimeout(()=>document.addEventListener("click",d),0)}function $c(e){const t=document.getElementById("sort-select");t?(t.value=e,t.dispatchEvent(new Event("change"))):document.getElementById("sort-trigger")&&document.dispatchEvent(new CustomEvent("request-sort-change",{detail:{sort:e}}))}function K_(e,t,n={isSelectionMode:!1,selectedIds:new Set},i={}){const{isSelectionMode:s,selectedIds:o}=n,r=o.has(e.id),a=document.createElement("li");a.setAttribute("data-id",e.id),a.setAttribute("draggable",s?"false":"true");const l=e.status==="completed",c=sp(e.dueDate),d=op(e.dueDate),u=!!e.recurrence,h=!!e.dueDate&&!u,f=ge(),g=e.timeBlockId?f.find(w=>w.id===e.timeBlockId):null,p=i.timeBlockId===null||i.timeBlockId===void 0,m=i.duration===null||i.duration===void 0;let b="group flex items-start gap-2 sm:gap-3 py-2 px-2 rounded -mx-2 transition-all duration-200 border border-transparent",y="";s?r?y="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 cursor-pointer":y="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-pointer":l?y="opacity-60 bg-gray-50 dark:bg-gray-900/50 cursor-grab active:cursor-grabbing":y="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-grab active:cursor-grabbing",a.className=`${b} ${y}`;let v="",_="";return s?(v=r?"bg-blue-600 border-blue-600 text-white":"border-gray-300 dark:border-gray-600 bg-white dark:bg-transparent hover:border-blue-500",_='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',r||(v+=" text-transparent")):(v=l?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500 cursor-pointer",_='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'),a.innerHTML=`
        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 ${v}">
            ${_}
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center pointer-events-none">
            <div class="col-span-1 sm:col-span-7 flex flex-col justify-center pointer-events-auto">
                <div class="leading-snug truncate font-medium transition-colors ${l&&!s?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"}">${e.title}</div>
                ${e.description?`<div class="text-xs text-gray-400 mt-0.5 font-light truncate markdown-summary">${Pd(e.description.split(`
`)[0]).replace(/<\/?p[^>]*>/g,"")}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-5 flex items-center sm:justify-end space-x-2 text-xs h-full mt-1 sm:mt-0 overflow-hidden pointer-events-auto">
                ${u?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${h?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${p?`<div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${g?`${g.start} - ${g.end}`:"時間帯未定"}">
                    <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${g?g.color:"#cbd5e1"}"></span>
                    <span class="truncate font-mono text-[11px]">${g?`${g.start} - ${g.end}`:"未定"}</span>
                </div>`:""}

                ${m?`<div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${e.duration||0}分">
                    <span class="mr-0.5 text-[10px]">⏱️</span>${e.duration||0}m
                </div>`:""}

                ${c?`<div class="flex items-center ${d} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${c}</div>`:""}
            </div>
        </div>
    `,s||(a.addEventListener("dragstart",w=>{if(w.target.closest(".task-checkbox")){w.preventDefault();return}a.classList.add("opacity-50"),w.dataTransfer.setData("text/plain",e.id),w.dataTransfer.effectAllowed="move"}),a.addEventListener("dragend",()=>a.classList.remove("opacity-50"))),a.querySelector(".task-checkbox").addEventListener("click",async w=>{w.stopPropagation(),s?Qo(e.id):await cp(e.id,l?"todo":"completed")}),a.addEventListener("click",w=>{w.target.closest(".task-checkbox")||(s?Qo(e.id):ym(e))}),a.addEventListener("contextmenu",w=>{w.preventDefault(),w.stopPropagation(),s&&!r&&Qo(e.id),nh(e,w.clientX,w.clientY)}),a}function ih(e,t,n,i={isSelectionMode:!1,selectedIds:new Set},s={}){if(!e)return;const o=document.createElement("ul");if(o.id="task-list-ul",o.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2 min-h-[50px]",o.addEventListener("contextmenu",r=>{(r.target===o||r.target.closest("li")===null)&&(r.preventDefault(),nh(null,r.clientX,r.clientY))}),!t||t.length===0)o.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none select-none">
                タスクがありません
                <div class="text-xs mt-2 opacity-70">右クリックでタスク追加・並び替え</div>
            </li>
        `;else{const r=document.createDocumentFragment();t.forEach(a=>{r.appendChild(K_(a,n,i,s))}),o.appendChild(r)}e.innerHTML="",e.appendChild(o)}function ma(e,t,n,i={}){if(!(i.forceExpand||e.dataset.expanded==="true")){e.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,e.querySelector("#show-input-btn").onclick=()=>{e.dataset.expanded="true",ma(e,t,n,i)};return}const r=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer">
                    <option value="">時間帯 (未定)</option>
                    ${ge().map(a=>`<option value="${a.id}">${a.start} - ${a.end}</option>`).join("")}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition">キャンセル</button>
                    <button id="submit-task-btn" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm">タスクを追加</button>
                </div>
            </div>
        </div>
    `;e.innerHTML=bo(r,"p-3 animate-fade-in-down"),Z_(e,t,n,i)}function J_(e,t,n,i){e.innerHTML=`
        <div id="fixed-add-task-btn" class="w-full h-full flex items-center px-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group">
            <div class="w-6 h-6 mr-3 rounded-full text-red-500 bg-red-50 dark:bg-red-900/20 flex items-center justify-center transition-transform group-hover:scale-110 shadow-sm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            </div>
            <span class="text-sm font-medium text-gray-600 dark:text-gray-300">タスクを追加</span>
        </div>
    `,e.querySelector("#fixed-add-task-btn").onclick=()=>{e.classList.add("hidden"),t.innerHTML="",t.classList.remove("hidden"),ma(t,n,i,{forceExpand:!0,onClose:()=>{t.innerHTML="",t.classList.add("hidden"),e.classList.remove("hidden")}}),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},100)}}function Z_(e,t,n,i={}){const s=e.querySelector("#inline-title-input"),o=e.querySelector("#submit-task-btn"),r=e.querySelector("#cancel-input-btn"),a=e.querySelector("#inline-desc-input"),l=e.querySelector("#inline-timeblock-select");s.focus();const c=()=>{e.dataset.expanded="false",i.onClose?i.onClose():ma(e,t,n)};r.onclick=c;const d=async()=>{const u=s.value.trim();u&&(o.disabled=!0,await Q_({title:u,description:a.value.trim(),projectId:t,labelIds:n?[n]:[],timeBlockId:l.value||null}),s.value="",a.value="",s.focus(),o.disabled=!1)};o.onclick=d,s.onkeydown=u=>{u.key==="Enter"&&!u.isComposing&&d()}}async function Q_(e){try{await lp(e)}catch(t){console.error(t),P({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function tw(e,t="createdAt_desc"){return Array.isArray(e)?[...e].sort((n,i)=>{switch(t){case"createdAt_asc":return tr(n.createdAt,i.createdAt);case"createdAt_desc":return tr(i.createdAt,n.createdAt);case"dueDate_asc":return hs(n.dueDate,i.dueDate,(s,o)=>tr(s,o));case"timeBlockId_asc":return hs(n.timeBlockId,i.timeBlockId,(s,o)=>String(s).localeCompare(String(o)));case"projectId_asc":return hs(n.projectId,i.projectId,(s,o)=>String(s).localeCompare(String(o)));case"duration_asc":return hs(n.duration,i.duration,(s,o)=>Number(s)-Number(o));case"title_asc":return(n.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function tr(e,t){const n=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return n(e)-n(t)}function hs(e,t,n){return e===t?0:e==null||e==="null"?1:t==null||t==="null"?-1:n(e,t)}function ew(e,t,n){const i=Dd(n);if(!i||!i.start||!i.end)return;const s=nw(i.start,i.end);if(s<=0)return;const o=t.reduce((x,w)=>{const k=parseInt(w.duration,10);return x+(isNaN(k)?0:k)},0),r=(s/60).toFixed(2),a=(o/60).toFixed(2),l=Math.min(o/s*100,100),c=o/s*100,d=s-o,u=d<0,f=(Math.abs(d)/60).toFixed(2),g=c>100,p=g?"bg-red-500":"bg-gradient-to-r from-blue-500 to-indigo-500",m=g?"100%":`${l}%`,b=u?"text-red-500":"text-green-500",y=u?"超過":"残り",v=`
        <div class="mt-4 mb-4 py-2 px-4 bg-gray-50/50 dark:bg-[#1e1e1e]/30 rounded-lg flex items-center justify-between gap-4 text-sm animate-fade-in border border-gray-100 dark:border-gray-800/50">
            
            <!-- Left: 時間帯名 -->
            <div class="flex-shrink-0 text-xs text-gray-400 font-mono">
                ${i.name}
            </div>

            <!-- Center: 数字とプログレスバー -->
            <div class="flex-1 flex flex-col justify-center gap-1 mx-2">
                <div class="text-xs text-center text-gray-500 dark:text-gray-400">
                    <span class="font-bold text-gray-700 dark:text-gray-300">${a}</span> <span class="text-[10px] text-gray-400">/</span> ${r} <span class="text-[10px]">h</span>
                </div>
                <div class="relative h-1.5 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden w-full">
                     <div class="${p} h-full rounded-full transition-all duration-500 ease-out"
                         style="width: ${m}">
                    </div>
                </div>
            </div>

            <!-- Right: %と過不足 -->
            <div class="flex-shrink-0 text-right min-w-[80px]">
                <div class="text-xl font-bold ${g?"text-red-500":"text-blue-500"} leading-none">
                    ${Math.round(c)}<span class="text-xs font-normal opacity-70">%</span>
                </div>
                <div class="text-[10px] font-medium ${b} mt-0.5">
                    ${y} ${f}h
                </div>
            </div>
        </div>
    `,_=document.createElement("div");_.innerHTML=v,e.appendChild(_)}function nw(e,t){const[n,i]=e.split(":").map(Number),[s,o]=t.split(":").map(Number);let r=n*60+i,a=s*60+o;return a<r&&(a+=1440),a-r}let Li=null;document.addEventListener("request-sort-change",e=>{const{sort:t}=e.detail,n=document.getElementById("sort-select");n&&(n.value=t);const i=document.getElementById("sort-trigger");if(i){i.dataset.value=t;const s=document.getElementById("sort-label");s&&(t==="title_asc"&&(s.textContent="名前順"),t==="dueDate_asc"&&(s.textContent="日付順"))}Li&&ba(...Li)});X_(()=>{Li&&ba(...Li)});function ba(e,t,n=[],i={}){const{projectId:s=null,labelId:o=null,timeBlockId:r=null,title:a=""}=i;Li=[e,t,n,i];const l=document.getElementById("task-view");if(!l)return;iw(e.length,a);const c=document.getElementById("sort-select"),d=document.getElementById("sort-trigger");let u="createdAt_desc";c?u=c.value:d&&d.dataset.value&&(u=d.dataset.value);const h=tw(e,u);l.innerHTML="",l.className="flex flex-col h-full bg-transparent overflow-hidden";const f=document.createElement("div");f.className="w-full px-4 sm:px-6 h-full flex flex-col pt-2",l.appendChild(f);const g=document.createElement("div");if(g.id="task-list-container",g.className="flex-1 overflow-y-auto custom-scrollbar pr-2 mb-2 scroll-smooth min-h-0",f.appendChild(g),ih(g,h,t,Rt,i),r){const m=document.createElement("div");m.id="timeblock-stats-container",m.className="flex-none mb-4 animate-fade-in",f.appendChild(m),ew(m,e,r)}const p=document.createElement("div");p.id="inline-input-container",p.className="flex-none pb-4",f.appendChild(p),J_(p,p,s,o)}function iw(e,t){const n=document.getElementById("header-title"),i=document.getElementById("header-count");n&&(n.textContent=t||"インボックス"),i&&(i.textContent=`${e}件`)}let $t={};function sw(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function ow(e){$t={input:e.querySelector("#page-search-input"),select:e.querySelector("#page-search-project"),results:e.querySelector("#search-results-container")}}function rw(e,t,n,i,s){var r;if(Ss(e,t),e.innerHTML=z_(i),ow(e),!$t.input||!$t.results)return;const o=sw(()=>Hc(n),300);$t.input.addEventListener("input",o),(r=$t.select)==null||r.addEventListener("change",()=>Hc(n)),nu({type:"search"}),eu(),requestAnimationFrame(()=>$t.input.focus())}function Hc(e){var s;const t=$t.input.value.trim().toLowerCase(),n=((s=$t.select)==null?void 0:s.value)||null;if(!t){$t.results.innerHTML=U_();return}const i=Ks(e,{keyword:t,projectId:n,showCompleted:!0});i.length===0?$t.results.innerHTML=V_():($t.results.innerHTML="",ih($t.results,i))}let Q={type:"inbox",id:null},yt=null;const jc={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function aw(){if(yt)return;const{VIEW_IDS:e}=Qr;yt={task:document.getElementById(e.TASK),dashboard:document.getElementById(e.DASHBOARD),search:document.getElementById(e.SEARCH),settings:document.getElementById(e.SETTINGS)}}function jn(e,t=[],n=[]){if(e.type==="settings"){ao();return}Q=e,Cb(Q),nu(Q,t,n)}function lw(e,t,n,i=[],s=[]){if(aw(),!yt.task||!yt.dashboard||!yt.search)return;const o=document.getElementById(jc.SORT),r=(o==null?void 0:o.dataset.value)||"createdAt_desc",a=[yt.task,yt.dashboard,yt.search,yt.settings];if(Q.type==="dashboard"){Ss(yt.dashboard,a.filter(f=>f!==yt.dashboard)),yt.dashboard.innerHTML=th(),W_(e);return}if(Q.type==="search"){Ss(yt.search,a.filter(f=>f!==yt.search)),rw(yt.search,e,t,Q);return}Ss(yt.task,a.filter(f=>f!==yt.task));const l=document.getElementById(jc.COMPLETED_TOGGLE),c=l?l.classList.contains("text-blue-500"):!1,d=()=>{var f,g,p,m;switch(Q.type){case"inbox":return"インボックス";case"project":return((f=t.find(b=>b.id===Q.id))==null?void 0:f.name)||"プロジェクト";case"label":return((g=n.find(b=>b.id===Q.id))==null?void 0:g.name)||"ラベル";case"timeblock":return Q.id==="unassigned"||Q.id==="none"?"未定":((p=i.find(b=>b.id===Q.id))==null?void 0:p.name)||"時間帯";case"duration":return`${Q.id}分`;case"filter":return((m=s.find(b=>b.id===Q.id))==null?void 0:m.name)||"フィルター";case"today":return"今日";case"upcoming":return"今後";default:return Q.id?Q.id:"タスク"}},u={keyword:"",showCompleted:c,projectId:Q.type==="inbox"?"unassigned":Q.type==="project"?Q.id:null,labelId:Q.type==="label"?Q.id:null,timeBlockId:Q.type==="timeblock"?Q.id:null,duration:Q.type==="duration"?Q.id:null,sortCriteria:r,title:d()},h=pb(e,u);ba(h,t,n,u)}const Vt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null};let Or=!1,er=null;function _n(){er||(er=requestAnimationFrame(()=>{const e=Un.tasks(),t=Un.projects(),n=Un.labels(),i=Un.timeBlocks(),s=Un.filters();lw(e,t,n,i,s),er=null}))}function zn(e){document.dispatchEvent(new CustomEvent(e)),_n()}function cw(e){if(!(U!=null&&U.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}ya(!1);const t=ee();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}Or=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),Vt.tasks=Op(t,()=>zn("tasks-updated")),Vt.projects=Ep(t,()=>zn("projects-updated")),Vt.labels=vp(t,()=>zn("labels-updated")),Vt.timeBlocks=Mp(t,()=>zn("timeblocks-updated")),Vt.filters=fp(t,()=>zn("filters-updated"))}function ya(e=!1){(Or||e)&&console.log("[DataSync] Stopping data sync..."),Object.keys(Vt).forEach(t=>{t==="workspaces"&&!e||typeof Vt[t]=="function"&&(Vt[t](),Vt[t]=null)}),Cp(),hp(),Or=!1,_n()}const Un={tasks:Mn,projects:Wr,labels:bp,timeBlocks:ge,filters:Sd,workspaceId:()=>ee()};function sh(){return Vt.workspaces}function oh(e){Vt.workspaces=e}function dw(){const e=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),n=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!e||!t||!n)return;const s=r=>{r?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",o)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",o))},o=r=>{r&&(t.contains(r.target)||e.contains(r.target))||s(!1)};e.addEventListener("click",r=>{r.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(r=>{r.addEventListener("click",a=>{const l=r.dataset.value,c=r.textContent;n.textContent=c,e.dataset.value=l,_n(),s(!1)})}),e.dataset.value||(e.dataset.value="createdAt_desc",n.textContent="作成日(新しい順)")}function uw(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function hw(){var n;let e=!0;document.addEventListener("workspace-changed",i=>{const{workspaceId:s}=i.detail;console.log("[EventManager] Workspace changed to:",s);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),U!=null&&U.currentUser){if(e){e=!1;try{const r=JSON.parse(localStorage.getItem("lastPage"));r&&r.page==="settings"?jn({type:"inbox"}):jn(r?{type:r.page,id:r.id||null}:{type:"inbox"})}catch{jn({type:"inbox"})}}else jn({type:"inbox",id:null});ya(!1),cw(),_n()}}),document.addEventListener("route-change",i=>{const{page:s,id:o}=i.detail;jn({type:s,id:o||null}),s!=="settings"&&localStorage.setItem("lastPage",JSON.stringify({page:s,id:o||null})),_n()});const t=uw(()=>_n(),300);(n=document.getElementById("search-input"))==null||n.addEventListener("input",t),dw()}function fw(){try{_h()}catch(e){console.error("Firebase Initialization Failed",e);return}Td(),om(),xh(async()=>{const{applyBackground:e}=await Promise.resolve().then(()=>Pp);return{applyBackground:e}},void 0).then(({applyBackground:e})=>e()),Up(),Ld(),Wc(),hw(),gw()}function gw(){U&&hh(U,e=>{Dh(e),e?pw(e):mw()})}function pw(e){kb();const t=sh();typeof t=="function"&&t();const n=Lh(e.uid,i=>{Od(i)});oh(n)}function mw(){const e=sh();typeof e=="function"&&(e(),oh(null)),ya(!0),Lb(),Wc()}function bw(){fw()}let zc=!1;function yw(e){const t=document.createElement("div");t.id=Tb.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const n=t.querySelector("#error-code-box");n&&(n.textContent=e.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function vw(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const e=document.createElement("link");e.rel="icon",e.type="image/png",e.href=Db.FAVICON,document.head.appendChild(e)}async function Uc(){if(!zc){zc=!0;try{vw(),await bw()}catch(e){console.error("[Main] Critical Initialization Error:",e),yw(e)}}}(()=>{if(document.readyState==="loading"){const e=()=>{document.removeEventListener("DOMContentLoaded",e),Uc()};document.addEventListener("DOMContentLoaded",e)}else Uc()})();
