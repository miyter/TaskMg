var cs=Object.defineProperty;var ds=(t,r,s)=>r in t?cs(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s;var P=(t,r,s)=>ds(t,typeof r!="symbol"?r+"":r,s);import{r as p,j as e,c as Be,t as us,a as gs,p as nt,R as U,u as mr,d as ms,b as hs,s as w,e as te,f as pe,n as he,g as pt,h as hr,i as xr,k as pr,l as xs,m as ps,q as fs,v as $t,w as Ot,C as Pt,x as Wt,y as Ue,z as fr,K as br,P as zt,D as qt,A as Ut,S as bt,B as yt,E as bs,F as kt,G as ot,H as ys,T as ks,Q as vs,I as js,J as ws}from"./vendor-KrB6h8KG.js";import{g as ar,i as Ns,a as _s,b as Cs,s as yr,c as Ss,T as Ve,q as Se,o as Kt,d as W,e as Re,f as Q,u as He,h as oe,j as ue,k as be,l as Ds,m as Ts,n as kr,p as vr,r as Ms,w as vt,t as it,v as jr,E as Es,x as Is}from"./firebase-BP0Lk9aK.js";import{g as fe}from"./i18n-BTZnJBkn.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function s(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerPolicy&&(o.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?o.credentials="include":a.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(a){if(a.ep)return;a.ep=!0;const o=s(a);fetch(a.href,o)}})();const Ls={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function As(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return window.GLOBAL_FIREBASE_CONFIG;try{const t=Ls;if(t&&t.VITE_FIREBASE_API_KEY)return{apiKey:t.VITE_FIREBASE_API_KEY,authDomain:t.VITE_FIREBASE_AUTH_DOMAIN,projectId:t.VITE_FIREBASE_PROJECT_ID,storageBucket:t.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:t.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:t.VITE_FIREBASE_APP_ID,measurementId:t.VITE_FIREBASE_MEASUREMENT_ID}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(t){return console.error("[Firebase] Config parse failed (legacy):",t),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}const we=As();if(!(we!=null&&we.apiKey)||!(we!=null&&we.projectId)){const t="[Firebase] Configuration is missing required fields (apiKey, projectId). Application cannot start.";throw console.error(t,we),new Error(t)}let Et;ar().length>0?Et=ar()[0]:Et=Ns(we);const wr=Et,R=_s(wr),I=Cs(wr),Fs=()=>{const[t,r]=p.useState(""),[s,n]=p.useState(""),[a,o]=p.useState(!1),[i,l]=p.useState(null),c=async u=>{u.preventDefault(),l(null),o(!0);try{await yr(R,t,s)}catch(g){let f="Login failed.";switch(g.code){case"auth/invalid-email":f="Invalid email format.";break;case"auth/user-disabled":f="User disabled.";break;case"auth/user-not-found":f="User not found.";break;case"auth/wrong-password":f="Wrong password.";break;case"auth/too-many-requests":f="Too many requests. Try again later.";break;case"auth/network-request-failed":f="Network error.";break}l(f)}finally{o(!1)}},d=async()=>{l(null),o(!0);try{await Ss(R)}catch(u){l("Guest login failed: "+u.message)}finally{o(!1)}};return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-premium-gradient p-4 antialiased",children:e.jsxs("div",{className:"max-w-md w-full p-6 sm:p-8 bg-white/70 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/30 rounded-[2rem] shadow-2xl transition-all duration-300",children:[e.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[e.jsx("div",{className:"inline-flex items-center justify-center p-4 bg-white dark:bg-gray-700 rounded-3xl shadow-lg mb-6 animate-float",children:e.jsx("img",{src:"/images/web-app-manifest-512x512.png",alt:"Logo",className:"h-12 w-12"})}),e.jsxs("h1",{className:"text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight",children:["Task",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:"ç©¶æ¥µã®ã‚¿ã‚¹ã‚¯ç®¡ç†ã‚¨ã‚¯ã‚¹ãƒšãƒªã‚¨ãƒ³ã‚¹"})]}),e.jsxs("form",{onSubmit:c,className:"space-y-5 sm:space-y-6",children:[i&&e.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-xl font-medium animate-in fade-in slide-in-from-top-4 duration-300 shadow-sm",children:i}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-email",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:"Email"}),e.jsx("input",{id:"login-email",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:u=>r(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"mail@example.com"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"login-password",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:"Password"}),e.jsx("input",{id:"login-password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:s,onChange:u=>n(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),e.jsx("button",{type:"submit",disabled:a,className:"btn-premium w-full py-4 text-lg shadow-lg hover:shadow-xl active:scale-[0.98] transition-all",children:a?"ã‚µã‚¤ãƒ³ã‚¤ãƒ³ä¸­...":"ã‚µã‚¤ãƒ³ã‚¤ãƒ³"})]}),e.jsxs("div",{className:"mt-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 flex items-center",children:e.jsx("div",{className:"w-full border-t border-gray-200/50 dark:border-gray-700/50"})}),e.jsx("div",{className:"relative flex justify-center text-xs",children:e.jsx("span",{className:"px-3 bg-transparent text-gray-400 uppercase tracking-widest font-bold",children:"OR"})})]}),e.jsxs("button",{onClick:d,disabled:a,className:"mt-8 w-full py-3.5 bg-gray-100/50 hover:bg-gray-200/70 active:bg-gray-300 dark:bg-gray-700/30 dark:hover:bg-gray-600/50 dark:active:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-3 border border-transparent hover:border-gray-300 dark:hover:border-gray-600",children:[e.jsx("span",{className:"text-xl",children:"ðŸ•µï¸"})," ã‚²ã‚¹ãƒˆã¨ã—ã¦åˆ©ç”¨"]})]})]})})},Bs={success:3e3,info:4e3,error:6e3},dt=new Map,Rs=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,11),et=Be(t=>({toasts:[],addToast:(r,s="info")=>{const n=Rs();t(i=>({toasts:[...i.toasts,{id:n,message:r,type:s}]}));const a=Bs[s],o=setTimeout(()=>{t(i=>({toasts:i.toasts.filter(l=>l.id!==n)})),dt.delete(n)},a);dt.set(n,o)},removeToast:r=>{const s=dt.get(r);s&&(clearTimeout(s),dt.delete(r)),t(n=>({toasts:n.toasts.filter(a=>a.id!==r)}))}})),S={success:t=>et.getState().addToast(t,"success"),error:t=>et.getState().addToast(t,"error"),info:t=>et.getState().addToast(t,"info")};function _(...t){return us(gs(t))}const $s=()=>{const{toasts:t,removeToast:r}=et();return t.length===0?null:e.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:t.map(s=>e.jsx("div",{onClick:()=>r(s.id),className:_("pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-xl shadow border text-sm font-medium cursor-pointer hover:opacity-90",s.type==="success"&&"bg-white dark:bg-gray-800 text-green-600 dark:text-green-400 border-green-200 dark:border-green-900",s.type==="error"&&"bg-white dark:bg-gray-800 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900",s.type==="info"&&"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-700"),children:e.jsxs("div",{className:"flex items-start gap-3",children:[s.type==="success"&&e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),s.type==="error"&&e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.type==="info"&&e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),e.jsx("p",{className:"leading-5 flex-1",children:s.message}),e.jsx("button",{onClick:n=>{n.stopPropagation(),r(s.id)},className:"flex-shrink-0 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"é–‰ã˜ã‚‹",children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})},s.id))})},X=Be()(nt(t=>({themeMode:"system",fontEn:"Inter",fontJp:"M PLUS 2",fontSize:"md",density:"normal",language:"ja",customDurations:[15,30,45,60,75,90,120],setThemeMode:r=>t({themeMode:r}),setFontEn:r=>t({fontEn:r}),setFontJp:r=>t({fontJp:r}),setFontSize:r=>t({fontSize:r}),setDensity:r=>t({density:r}),setLanguage:r=>t({language:r}),setCustomDurations:r=>t({customDurations:r.sort((s,n)=>s-n)})}),{name:"app-settings",partialize:t=>({themeMode:t.themeMode,fontEn:t.fontEn,fontJp:t.fontJp,fontSize:t.fontSize,density:t.density,language:t.language,customDurations:t.customDurations})})),B=()=>{const t=X(s=>s.language);return p.useMemo(()=>fe(t),[t])},O={SIDEBAR_DENSITY:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},DND:{PREFIX_TASK:"task:",TYPE_PROJECT:"project",TYPE_INBOX:"inbox",TYPE_TIMEBLOCK:"timeblock",TOUCH_DELAY:250},STORAGE_KEYS:{SECTION_ORDER:"sidebar_section_order"},SIDEBAR:{MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,DURATIONS:[30,45,60,75,90]},LAYOUT:{CONTAINER_WIDTH_CLASS:"w-full max-w-full",MOBILE_SIDEBAR_WIDTH_PX:280},FONTS:{EU:[{label:"Google Sans",value:'"Google Sans", Inter, sans-serif'},{label:"Inter",value:"Inter, sans-serif"},{label:"Roboto",value:"Roboto, sans-serif"},{label:"System UI",value:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}],JP:[{label:"M PLUS 2",value:'"M PLUS 2", sans-serif'},{label:"Noto Sans JP",value:'"Noto Sans JP", sans-serif'},{label:"Hiragino / Yu Gothic",value:'"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif'}]}},ye=[{value:"#EF5350",key:"red"},{value:"#EC407A",key:"pink"},{value:"#AB47BC",key:"purple"},{value:"#7E57C2",key:"deep_purple"},{value:"#5C6BC0",key:"indigo"},{value:"#42A5F5",key:"blue"},{value:"#29B6F6",key:"light_blue"},{value:"#26C6DA",key:"cyan"},{value:"#26A69A",key:"teal"},{value:"#66BB6A",key:"green"},{value:"#9CCC65",key:"light_green"},{value:"#D4E157",key:"lime"},{value:"#FFEE58",key:"yellow"},{value:"#FFCA28",key:"amber"},{value:"#FFA726",key:"orange"},{value:"#FF7043",key:"deep_orange"},{value:"#8D6E63",key:"brown"},{value:"#BDBDBD",key:"grey"},{value:"#78909C",key:"blue_grey"}];ye.map(t=>t.value);const Os=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(t){const r=Math.random()*16|0;return(t==="x"?r:r&3|8).toString(16)}),G=Be(t=>({stack:[],openModal:(r,s=null)=>{if(!r)return;const a={id:Os(),type:r,data:s};t(o=>({stack:[...o.stack,a]}))},closeModal:()=>t(r=>r.stack.length===0?r:{stack:r.stack.slice(0,-1)}),closeAllModals:()=>t({stack:[]})})),Ps=1024,Vt=Be()(nt(t=>({sidebarWidth:O.SIDEBAR.DEFAULT_WIDTH,isSidebarOpen:!0,sidebarDensity:"normal",setSidebarWidth:r=>{const s=Math.max(O.SIDEBAR.MIN_WIDTH,Math.min(r,O.SIDEBAR.MAX_WIDTH));t({sidebarWidth:s})},toggleSidebar:()=>t(r=>({isSidebarOpen:!r.isSidebarOpen})),setSidebarOpen:r=>t({isSidebarOpen:r}),setSidebarDensity:r=>t({sidebarDensity:r})}),{name:"ui-storage",partialize:t=>({sidebarWidth:t.sidebarWidth,sidebarDensity:t.sidebarDensity,isSidebarOpen:t.isSidebarOpen}),onRehydrateStorage:()=>t=>{typeof window<"u"&&window.innerWidth<Ps&&(t==null||t.setSidebarOpen(!1))}})),K=(t,r="0 0 24 24")=>({className:s,size:n,strokeWidth:a=2,...o})=>e.jsx("svg",{className:_("w-4 h-4",s),width:n,height:n,fill:"none",stroke:"currentColor",viewBox:r,strokeWidth:a,strokeLinecap:"round",strokeLinejoin:"round",...o,children:t}),Ws=K(e.jsx("path",{d:"M4 6h16M4 12h16M4 18h16"})),zs=K(e.jsx("path",{d:"M18 6L6 18M6 6l12 12"})),tt=K(e.jsx("path",{d:"M12 5v14M5 12h14"})),De=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})]})),rt=K(e.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),"0 0 24 24"),qs=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),jt=K(e.jsx("path",{d:"M20 6L9 17l-5-5"})),Ht=K(e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"11",cy:"11",r:"8"}),e.jsx("path",{d:"M21 21l-4.35-4.35"})]})),Us=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),e.jsx("path",{d:"M12 9v4M12 17h.01"})]})),wt=K(e.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})),Nr=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),e.jsx("path",{d:"M14 2v6h6"}),e.jsx("path",{d:"M16 13H8"}),e.jsx("path",{d:"M16 17H8"}),e.jsx("path",{d:"M10 9H8"})]})),_r=K(e.jsx("path",{d:"M9 18l6-6-6-6"})),Gt=K(e.jsx("path",{d:"M6 9l6 6 6-6"})),Ks=K(e.jsx("path",{d:"M18 15l-6-6-6 6"})),Vs=K(e.jsx("path",{d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})),Cr=K(e.jsx("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})),Hs=K(e.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})),Gs=K(e.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})),st=K(e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})),Sr=K(e.jsxs(e.Fragment,{children:[e.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),e.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"}),e.jsx("path",{d:"M8 14h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 18h.01"}),e.jsx("path",{d:"M12 18h.01"}),e.jsx("path",{d:"M16 18h.01"})]})),Dr=K(e.jsxs(e.Fragment,{children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 6v6l4 2"})]})),Ys=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M17 1l4 4-4 4"}),e.jsx("path",{d:"M3 11V9a4 4 0 014-4h14"}),e.jsx("path",{d:"M7 23l-4-4 4-4"}),e.jsx("path",{d:"M21 13v2a4 4 0 01-4 4H3"})]})),Tr=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M4 11V4h16v7"}),e.jsx("path",{d:"M4 11h5.8a2.2 2.2 0 004.4 0H20v8a1 1 0 01-1 1H5a1 1 0 01-1-1v-8z"})]})),Xs=K(e.jsxs(e.Fragment,{children:[e.jsx("path",{d:"M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"}),e.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})),Js=({className:t,size:r,...s})=>e.jsxs("svg",{className:_("animate-spin",t),width:r||16,height:r||16,fill:"none",viewBox:"0 0 24 24",...s,children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),Qs="/assets/logo-BADOZ29k.png",ge=Be()(nt(t=>({filterType:"inbox",targetId:null,query:"",showCompleted:!1,sortCriteria:"createdAt_desc",setFilter:(r,s=null)=>t({filterType:r,targetId:s,query:""}),setSearchQuery:r=>t({query:r,filterType:"search"}),clearFilter:()=>t({filterType:"inbox",targetId:null,query:""}),setShowCompleted:r=>t({showCompleted:r}),setSortCriteria:r=>t({sortCriteria:r})}),{name:"filter-storage",partialize:t=>({filterType:t.filterType,targetId:t.targetId,query:t.query,showCompleted:t.showCompleted,sortCriteria:t.sortCriteria})})),ae=Be()(nt(t=>({currentView:"tasks",viewData:null,setView:(r,s=null)=>t({currentView:r,viewData:s})}),{name:"view-storage",partialize:t=>({currentView:t.currentView})})),Zs=()=>{const{t}=B(),{query:r,setFilter:s}=ge(),{currentView:n,setView:a}=ae(),o=n==="search",i=()=>{s("search"),a("search")};return e.jsxs("button",{onClick:i,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-all duration-200 group ${o?"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-400"}`,"aria-label":t("sidebar.search_placeholder"),children:[e.jsx(Ht,{className:`w-4 h-4 transition-colors ${o?"text-blue-600 dark:text-blue-400":"text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300"}`}),e.jsx("span",{className:"flex-1 text-sm font-medium",children:r?`"${r}"`:t("sidebar.search_placeholder")}),e.jsx("span",{className:"text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"/"})]})},ea=({children:t})=>{const{sidebarWidth:r,isSidebarOpen:s,sidebarDensity:n,toggleSidebar:a,setSidebarWidth:o}=Vt(),{t:i}=B(),l={compact:"p-1",normal:"p-2",comfortable:"p-4",spacious:"p-6"}[n];U.useEffect(()=>{const d=g=>{if(!document.body.classList.contains("resizing"))return;const f=Math.max(O.SIDEBAR.MIN_WIDTH,Math.min(O.SIDEBAR.MAX_WIDTH,g.clientX));o(f)},u=()=>{document.body.classList.remove("resizing"),document.body.style.cursor="default"};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",u),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",u)}},[o]);const c=()=>{document.body.classList.add("resizing"),document.body.style.cursor="col-resize"};return e.jsxs("aside",{className:_("h-full transition-all duration-300 flex flex-col group relative","bg-white dark:bg-gray-900 lg:bg-white/70 lg:dark:bg-gray-800/60","lg:backdrop-blur-xl","border-r border-gray-200/50 dark:border-gray-700/30",s?"translate-x-0":"-translate-x-full lg:translate-x-0","fixed lg:relative z-30 lg:z-0 shadow-2xl lg:shadow-none overflow-hidden","w-[var(--sidebar-mobile)] lg:w-[var(--sidebar-desktop)]"),style:{"--sidebar-desktop":`${r}px`,"--sidebar-mobile":s?`${O.LAYOUT.MOBILE_SIDEBAR_WIDTH_PX}px`:"0px",width:s?void 0:"0px"},children:[e.jsxs("div",{className:"h-14 flex items-center px-4 flex-shrink-0 justify-between border-b border-gray-100 dark:border-gray-800/50",children:[e.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/20",children:e.jsx("img",{src:Qs,alt:"L",className:"h-5 w-5 invert brightness-0"})}),e.jsxs("span",{className:"text-lg font-black text-gray-900 dark:text-white tracking-tight",children:["Task",e.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]})]}),e.jsx("button",{onClick:a,className:"text-gray-400 hover:text-gray-900 dark:hover:text-white p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all active:scale-90",title:i(s?"sidebar.toggle_collapse":"sidebar.toggle_expand"),"aria-label":i(s?"sidebar.toggle_collapse":"sidebar.toggle_expand"),children:e.jsx(Vs,{className:_("w-5 h-5 transition-transform duration-300",!s&&"rotate-180"),strokeWidth:2.5})})]}),e.jsx("div",{className:"px-3 pb-2 pt-2",children:e.jsx(Zs,{})}),e.jsx("div",{className:_("flex-1 overflow-y-auto custom-scrollbar pt-2",l),children:t}),e.jsx("div",{role:"separator","aria-orientation":"vertical","aria-label":i("sidebar.resizer_label"),"aria-valuenow":r,"aria-valuemin":O.SIDEBAR.MIN_WIDTH,"aria-valuemax":O.SIDEBAR.MAX_WIDTH,tabIndex:s?0:-1,onMouseDown:c,onKeyDown:d=>{d.key==="ArrowLeft"?o(Math.max(O.SIDEBAR.MIN_WIDTH,r-10)):d.key==="ArrowRight"&&o(Math.min(O.SIDEBAR.MAX_WIDTH,r+10))},className:_("absolute top-0 right-0 w-3 h-full cursor-col-resize z-40 transition-colors hidden lg:flex items-center justify-center outline-none focus:bg-blue-500","hover:bg-blue-500/30 active:bg-blue-600/50 group/resizer"),title:i("sidebar.resizer_hint"),children:e.jsx("div",{className:"absolute w-1 h-12 bg-gray-400 dark:bg-gray-500 rounded-full opacity-0 group-hover/resizer:opacity-100 group-focus/resizer:opacity-100 transition-opacity pointer-events-none"})}),e.jsx("div",{className:"absolute top-0 right-0 w-[1px] h-full bg-gray-200/50 dark:bg-gray-700/30 hidden lg:block"})]})},ke=mr([ms(),hs(Ve),w().datetime({offset:!0}).or(w().datetime())]).nullable().optional(),ta=te({type:pt(["none","daily","weekly","weekdays","monthly"]).default("none"),days:pe(he().min(0).max(6)).optional()}).nullable(),Yt=te({id:w().optional(),title:w().min(1,"ã‚¿ã‚¤ãƒˆãƒ«ã¯å¿…é ˆã§ã™"),description:w().nullable().optional(),status:pt(["todo","completed","archived"]).default("todo"),dueDate:ke,completedAt:ke,createdAt:ke,ownerId:w(),projectId:w().nullable().optional(),labelIds:pe(w()).optional(),timeBlockId:w().nullable().optional(),duration:he().min(0,"æ‰€è¦æ™‚é–“ã¯0ä»¥ä¸Šã®æ•°å€¤ã§æŒ‡å®šã—ã¦ãã ã•ã„").optional(),isImportant:hr().default(!1),recurrence:ta,order:he().optional()}),Mr=te({id:w().optional(),name:w().min(1,"ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã¯å¿…é ˆã§ã™"),color:w().optional(),ownerId:w(),createdAt:ke,order:he().optional()}),Er=te({id:w().optional(),name:w().min(1,"ãƒ©ãƒ™ãƒ«åã¯å¿…é ˆã§ã™"),color:w().optional(),ownerId:w(),workspaceId:w().optional(),createdAt:ke}),Xt=te({id:w().optional(),name:w().min(1,"ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åã¯å¿…é ˆã§ã™"),createdAt:ke}),Ir=te({id:w().optional(),name:w().min(1,"ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼åã¯å¿…é ˆã§ã™"),query:w(),workspaceId:w().optional(),ownerId:w().optional(),createdAt:ke}),nr=w().regex(/^([01]\d|2[0-3]):([0-5]\d)$/,"æ™‚åˆ»ã¯HH:mmå½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ï¼ˆä¾‹: 09:00, 14:30ï¼‰"),ra=te({id:w().optional(),name:w().min(1,"æ™‚é–“å¸¯ã®åå‰ã¯å¿…é ˆã§ã™"),start:nr,end:nr,color:w().optional(),order:he().optional()});te({id:w().optional(),mode:w(),data:xr(w(),w()),createdAt:ke,updatedAt:ke,ownerId:w(),workspaceId:w()});const Ge=Be()(nt(t=>({currentWorkspaceId:null,workspaces:[],setCurrentWorkspaceId:r=>t({currentWorkspaceId:r}),setWorkspaces:r=>{const s=r.filter(n=>{const a=Xt.safeParse(n);return a.success?!0:(console.error("Invalid workspace data:",n,a.error),!1)});t({workspaces:s})}}),{name:"workspace-storage",partialize:t=>({currentWorkspaceId:t.currentWorkspaceId})}));function sa(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function It(t){return`artifacts/${sa()}/users/${t}`}function We(t,r){return`${It(t)}/workspaces/${r}`}const L={users:t=>It(t),workspaces:t=>`${It(t)}/workspaces`,filters:(t,r)=>`${We(t,r)}/filters`,labels:(t,r)=>`${We(t,r)}/labels`,timeblocks:(t,r)=>`${We(t,r)}/timeblocks`,tasks:(t,r)=>`${We(t,r)}/tasks`,projects:(t,r)=>`${We(t,r)}/projects`,targets:(t,r)=>`${We(t,r)}/targets`},aa=["permission-denied","invalid-argument","unauthenticated","not-found","already-exists","failed-precondition"];async function H(t,r={}){const s=typeof r=="number"?{maxRetries:r}:r,{maxRetries:n=3,initialDelay:a=1e3,onError:o,onFinalFailure:i}=s;let l;for(let c=0;c<=n;c++)try{return await t()}catch(d){if(l=d,o&&o(d,c),c===n)break;const u=(d==null?void 0:d.code)||"";if(aa.some(y=>u.includes(y)))throw i&&i(d),d;const f=a*Math.pow(2,c);await new Promise(y=>setTimeout(y,f))}throw i&&i(l),l}class na{constructor(){P(this,"cachedWorkspacesMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}isInitialized(r){return this.cachedWorkspacesMap.has(r)}notifyListeners(r){const s=this.cachedWorkspacesMap.get(r)||[],n=this.listeners.get(r);if(n){const a=[...s];n.forEach(o=>o(a))}}setCache(r,s){this.cachedWorkspacesMap.set(r,s),this.notifyListeners(r)}getWorkspaces(r){return this.cachedWorkspacesMap.get(r)||[]}subscribe(r,s){this.listeners.has(r)||this.listeners.set(r,new Set);const n=this.listeners.get(r);n.add(s);const a=this.cachedWorkspacesMap.get(r);if(a&&queueMicrotask(()=>s([...a])),!this.unsubscribes.has(r)){const o=L.workspaces(r),i=Se(W(I,o),Kt("createdAt","asc"));console.log(`[WorkspaceCache] Subscribing to path: ${o}`);const l=Re(i,c=>{const d=c.docs.map(g=>({id:g.id,...g.data()}));console.log(`[WorkspaceCache] Received ${d.length} workspaces from Firestore`);const u=d.filter(g=>{const f=Xt.safeParse(g);return f.success?!0:(console.error("[WorkspaceCache] Invalid workspace data:",g,f.error),!1)});this.cachedWorkspacesMap.set(r,u),this.notifyListeners(r)},c=>{console.error("[WorkspaceCache] Subscription error:",c),this.cachedWorkspacesMap.set(r,[]),this.notifyListeners(r)});this.unsubscribes.set(r,l)}return()=>{var o;n.delete(s),n.size===0&&((o=this.unsubscribes.get(r))==null||o(),this.unsubscribes.delete(r),this.listeners.delete(r))}}clearCache(r){var s;this.cachedWorkspacesMap.delete(r),(s=this.unsubscribes.get(r))==null||s(),this.unsubscribes.delete(r),this.listeners.delete(r)}}const ve=new na,oa=t=>ve.isInitialized(t),ia=t=>ve.getWorkspaces(t);function la(t,r){return ve.subscribe(t,r)}async function Lr(t,r){const s=ve.getWorkspaces(t);Xt.pick({name:!0}).parse({name:r});const n="temp-"+Date.now(),a={id:n,name:r,createdAt:new Date};ve.setCache(t,[...s,a]);const o=L.workspaces(t);console.log(`[WorkspaceCache] Adding workspace to path: ${o}`);let i=n;return await H(async()=>{const l=await oe(W(I,o),{name:r,createdAt:ue()});i=l.id,console.log(`[WorkspaceCache] Successfully added workspace with ID: ${l.id}`)},{onFinalFailure:()=>{console.error(`[WorkspaceCache] Failed to add workspace: ${r}`),ve.setCache(t,s),S.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}}),{id:i,name:r}}async function ca(t,r,s){const n=ve.getWorkspaces(t),a=n.map(o=>o.id===r?{...o,...s}:o);ve.setCache(t,a),await H(async()=>{const o=L.workspaces(t),i=Q(I,o,r);await He(i,s)},{onFinalFailure:()=>{ve.setCache(t,n),S.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function da(t){try{const r=L.workspaces(t);(await be(Se(W(I,r),Ds(1)))).empty&&await Lr(t,"ãƒ¡ã‚¤ãƒ³")}catch(r){console.error("[WorkspaceCache] Failed to ensure default workspace:",r)}}function Ar(t){var s;const r=t||((s=R.currentUser)==null?void 0:s.uid);return r?ia(r):[]}function ua(t){var s;const r=t||((s=R.currentUser)==null?void 0:s.uid);return r?oa(r):!1}function xe(){return Ge.getState().currentWorkspaceId}function Fr(t){if(!t)return;const r=Ge.getState();r.currentWorkspaceId!==t&&r.setCurrentWorkspaceId(t)}function ga(t,r){var o;const s=typeof t=="function"?t:r,n=typeof t=="string"?t:(o=R.currentUser)==null?void 0:o.uid;return n?la(n,i=>{i.length===0?da(n).catch(l=>console.error("[Workspace] Default creation error:",l)):ma(i),typeof s=="function"&&s(i)}):(typeof s=="function"&&s([]),()=>{})}function ma(t){if(t.length===0)return null;const r=Ge.getState();let s=r.currentWorkspaceId;const n=s?t.some(a=>a.id===s):!1;return(!s||!n)&&(s=t[0].id,r.setCurrentWorkspaceId(s)),s}async function ha(t){const r=R.currentUser;if(!r)throw new Error("Authentication required");return Lr(r.uid,t)}async function xa(t,r){const s=R.currentUser;if(!s)throw new Error("Authentication required");return ca(s.uid,t,{name:r})}function at(t){const r=`[ErrorLogger] [${t.type.toUpperCase()}]`,s=t.stack?`
${t.stack}`:"";t.type==="warn"?console.warn(`${r} ${t.message}${s}`):console.error(`${r} ${t.message}${s}`)}function pa(){window.onerror=(t,r,s,n,a)=>(at({timestamp:new Date().toISOString(),type:"error",message:String(t),stack:a==null?void 0:a.stack}),!1),window.onunhandledrejection=t=>{const r=t.reason;at({timestamp:new Date().toISOString(),type:"unhandledrejection",message:(r==null?void 0:r.message)||String(r),stack:r==null?void 0:r.stack})},console.info("[ErrorLogger] Initialized")}function fa(t,r){at({timestamp:new Date().toISOString(),type:"react",message:t.message,stack:t.stack})}class ba{constructor(){P(this,"initialLoginPromise",null)}getCurrentUserId(){var r;return((r=R.currentUser)==null?void 0:r.uid)||null}hasInitialToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return!0;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return!0}catch{}return!1}getInitialAuthToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return window.GLOBAL_INITIAL_AUTH_TOKEN;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return __initial_auth_token}catch{}return null}async tryInitialTokenLogin(){if(this.initialLoginPromise)return this.initialLoginPromise;const r=this.getInitialAuthToken();if(!r){this.initialLoginPromise=Promise.resolve();return}return this.initialLoginPromise=(async()=>{try{await Ts(R,r),console.log("[Auth] Initial token login success")}catch(s){at({timestamp:new Date().toISOString(),type:"error",message:`Initial token login failed: ${s.message}`,stack:s.stack})}})(),this.initialLoginPromise}initAuthListener(r,s){return this.tryInitialTokenLogin(),kr(R,a=>{a?r(a):s()})}async loginWithEmail(r,s){return await yr(R,r,s)}async logout(){try{await vr(R)}catch(r){throw at({timestamp:new Date().toISOString(),type:"error",message:`Logout failed: ${r.message}`,stack:r.stack}),r}}async updateUserAuthPassword(r){const s=R.currentUser;if(!s)throw new Error("Authentication required: No current user.");await Ms(s,r)}}const Lt=new ba,ya=(t,r)=>Lt.initAuthListener(t,r),ht={TIMEOUT:{AUTH_LOADING:1e4},TIME_BLOCK:{MAX_COUNT:10}},Jt=()=>{var i;const[t,r]=p.useState(((i=R.currentUser)==null?void 0:i.uid)||null),[s,n]=p.useState(R.currentUser),[a,o]=p.useState(!0);return p.useEffect(()=>{const l=new AbortController;let c=()=>{},d=null;const u=async()=>{if(Lt.hasInitialToken())try{await Lt.tryInitialTokenLogin()}catch(g){console.error("[useAuth] Initial token login failed:",g)}l.signal.aborted||(c=ya(g=>{l.signal.aborted||(r(g.uid),n(g),o(!1),d&&clearTimeout(d))},()=>{l.signal.aborted||(r(null),n(null),o(!1),d&&clearTimeout(d))}))};return d=setTimeout(()=>{l.signal.aborted||(console.warn("[useAuth] Loading timeout reached, forcing loading=false"),o(!1))},ht.TIMEOUT.AUTH_LOADING),u(),()=>{l.abort(),c(),d&&clearTimeout(d)}},[]),{userId:t,user:s,loading:a}},ut=new Map;function $e(t,r,s,n){const a=pr(),o=JSON.stringify(t),i=15e3;return p.useEffect(()=>{if(t.some(c=>c==null))return;let l=ut.get(o);return l||(l={count:0,unsubscribe:r(d=>{a.setQueryData(t,d)})},ut.set(o,l)),l.count++,()=>{const c=ut.get(o);c&&(c.count--,c.count===0&&(c.unsubscribe(),ut.delete(o)))}},[o]),xs({queryKey:t,queryFn:()=>{const l=a.getQueryData(t);return l!==void 0?Promise.resolve(l):s!==void 0?Promise.resolve(s):new Promise(c=>{const d=setTimeout(()=>{const f=a.getQueryData(t);console.debug(`[FirestoreSub] Timeout waiting for data (monitor): ${o}`),c(f??s??null)},i),u=a.getQueryCache().subscribe(f=>{if(f.type==="updated"&&JSON.stringify(f.query.queryKey)===o){const y=f.query.state.data;y!==void 0&&(clearTimeout(d),u(),c(y))}}),g=a.getQueryData(t);g!==void 0&&(clearTimeout(d),u(),c(g))})},initialData:s,staleTime:1/0,gcTime:1e3*60*5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})}const ka=()=>{const{userId:t,loading:r}=Jt(),s=p.useCallback(c=>t?ga(t,c):()=>{},[t]),a=(t?ua(t):!1)&&t?Ar(t):void 0,{data:o,isPending:i}=$e(["workspaces",t||void 0],s,a);return{workspaces:o||[],loading:r||!!t&&i}},ne=()=>{const t=Ge(n=>n.currentWorkspaceId),{userId:r,loading:s}=Jt();return{workspaceId:t,userId:r,loading:s}},va=()=>{const{t}=B(),{workspaces:r,loading:s}=ka(),{openModal:n}=G(),[a,o]=p.useState(!1),i=p.useRef(null),{workspaceId:l}=ne(),c=r.find(d=>d.id===l);return p.useEffect(()=>{const d=g=>{i.current&&!i.current.contains(g.target)&&o(!1)},u=g=>{g.key==="Escape"&&o(!1)};return a&&(document.addEventListener("mousedown",d),document.addEventListener("keydown",u)),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",u)}},[a]),s?e.jsx("div",{className:"h-8 w-32 bg-gray-100 dark:bg-gray-800 animate-pulse rounded"}):e.jsxs("div",{className:"relative",ref:i,children:[e.jsxs("button",{onClick:()=>o(!a),className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 transition-colors group","aria-expanded":a,"aria-haspopup":"true",children:[e.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 truncate max-w-[120px] sm:max-w-[140px] md:max-w-[180px]",children:c?c.name:t("loading")}),e.jsx(Gt,{className:_("w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-transform duration-200",a?"rotate-180":"")})]}),a&&e.jsxs("div",{className:"absolute left-0 mt-2 w-60 sm:w-64 max-w-[calc(100vw-32px)] origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 z-50 border border-gray-100 dark:border-gray-700 overflow-hidden animate-scale-in custom-scrollbar",children:[e.jsx("div",{className:"p-1 border-b border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:e.jsxs("button",{onClick:()=>{o(!1),n("workspace-edit",null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors rounded-md",children:[e.jsx(tt,{className:"w-4 h-4 mr-2"}),t("sidebar.add_workspace")]})}),e.jsx("div",{className:"py-1 max-h-[300px] overflow-y-auto custom-scrollbar",children:r.map(d=>{const u=d.id===l;return e.jsxs("button",{onClick:()=>{d.id&&Fr(d.id),o(!1)},className:_("w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors",u?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"),children:[e.jsx("span",{className:"truncate block max-w-[140px] sm:max-w-[180px]",children:d.name}),u&&e.jsx(jt,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2"})]},d.id)})})]})]})},ja=({sidebarContent:t,title:r,children:s})=>{const{toggleSidebar:n,isSidebarOpen:a}=Vt(),{t:o}=B(),{openModal:i}=G();return e.jsxs("div",{className:"w-full h-full flex overflow-hidden bg-premium-gradient text-gray-800 dark:text-white antialiased",children:[a&&e.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm z-20 lg:hidden transition-opacity duration-300",onClick:n}),e.jsx(ea,{children:t}),e.jsxs("main",{className:"flex-1 flex flex-col relative overflow-hidden",id:"main-content",children:[e.jsxs("header",{className:"h-12 border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm z-10 sticky top-0",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[!a&&e.jsx("button",{onClick:n,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:o("sidebar.menu_open"),"aria-label":o("sidebar.menu_open"),children:e.jsx(Ws,{className:"w-5 h-5"})}),e.jsx(va,{}),e.jsx("h1",{className:"font-bold text-lg border-l border-gray-300 dark:border-gray-700 pl-3 ml-1 truncate",children:r})]}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsx("button",{onClick:()=>i("settings"),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Settings","aria-label":"Settings",children:e.jsx(qs,{className:"w-5 h-5"})})})]}),e.jsx("div",{className:"flex-1 overflow-hidden flex flex-col",children:e.jsx("div",{className:_("w-full h-full bg-white dark:bg-gray-900 relative flex-1",O.LAYOUT.CONTAINER_WIDTH_CLASS),children:s})})]})]})};function wa(t,r){return t===r?!0:!t||!r||t.length!==r.length?!1:JSON.stringify(t)===JSON.stringify(r)}function Na(t,r){if(t===r)return!0;if(!t||!r||t.length!==r.length)return!1;const s=[...t].sort((a,o)=>(a.id||"").localeCompare(o.id||"")),n=[...r].sort((a,o)=>(a.id||"").localeCompare(o.id||""));for(let a=0;a<s.length;a++){const o=s[a],i=n[a];if(o.id!==i.id||o.status!==i.status||o.title!==i.title||o.description!==i.description||o.projectId!==i.projectId||o.timeBlockId!==i.timeBlockId||o.duration!==i.duration||o.isImportant!==i.isImportant)return!1;const l=c=>c==null?c:c instanceof Date?c.getTime():typeof(c==null?void 0:c.toMillis)=="function"?c.toMillis():c;if(l(o.dueDate)!==l(i.dueDate))return!1}return!0}function _a(t,r){if(t===r)return!0;if(!t||!r||t.length!==r.length)return!1;for(let s=0;s<t.length;s++)if(t[s].id!==r[s].id||t[s].name!==r[s].name||t[s].color!==r[s].color)return!1;return!0}class Ca{constructor(){P(this,"cachedProjectsMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}isInitialized(r){return this.cachedProjectsMap.has(r)}notifyListeners(r){const s=this.cachedProjectsMap.get(r)||[],n=this.listeners.get(r);if(n){const a=[...s];n.forEach(o=>o(a))}}setCache(r,s){this.cachedProjectsMap.set(r,s),this.notifyListeners(r)}getProjects(r){return this.cachedProjectsMap.get(r)||[]}subscribe(r,s,n){this.listeners.has(s)||this.listeners.set(s,new Set);const a=this.listeners.get(s);a.add(n);const o=this.cachedProjectsMap.get(s);if(o&&queueMicrotask(()=>n([...o])),!this.unsubscribes.has(s)){const i=L.projects(r,s),l=Se(W(I,i));console.log(`[ProjectCache] Subscribing to path: ${i} for user: ${r}`);const c=Re(l,d=>{const u=d.docs.map(f=>({id:f.id,...f.data()}));console.log(`[ProjectCache] Received ${u.length} projects from Firestore for workspace: ${s}`);const g=this.cachedProjectsMap.get(s);if(g&&_a(g,u)){console.log("[ProjectCache] Data identical, skipping update");return}console.log("[ProjectCache] Updating cache and notifying listeners"),this.cachedProjectsMap.set(s,u),this.notifyListeners(s)},d=>{console.error("[ProjectCache] Subscription error:",d),this.cachedProjectsMap.set(s,[]),this.notifyListeners(s)});this.unsubscribes.set(s,c)}return()=>{var i;a.delete(n),a.size===0&&((i=this.unsubscribes.get(s))==null||i(),this.unsubscribes.delete(s),this.listeners.delete(s))}}}const ee=new Ca,Sa=t=>ee.isInitialized(t),Da=t=>ee.getProjects(t),Ta=(t,r)=>ee.setCache(t,r);function Ma(t,r,s){return ee.subscribe(t,r,s)}async function Ea(t,r,s,n){const a=ee.getProjects(r),i={id:"temp-"+Date.now(),name:s,color:n,ownerId:t,createdAt:new Date};ee.setCache(r,[...a,i]);const l=L.projects(t,r);return console.log(`[ProjectCache] Adding project to path: ${l}`),H(async()=>{const c=await oe(W(I,l),{name:s,color:n,ownerId:t,createdAt:ue()});console.log(`[ProjectCache] Successfully added project with ID: ${c.id}`)},{onFinalFailure:()=>{console.error(`[ProjectCache] Failed to add project: ${s}`),ee.setCache(r,a),S.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ia(t,r,s,n){const a=ee.getProjects(r),o=a.map(i=>i.id===s?{...i,...n}:i);return ee.setCache(r,o),H(async()=>{const i=L.projects(t,r),l=Q(I,i,s);await He(l,n)},{onFinalFailure:()=>{ee.setCache(r,a),S.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function La(t,r,s){const n=ee.getProjects(r),a=n.filter(o=>o.id!==s);return ee.setCache(r,a),H(async()=>{const o=L.projects(t,r);await it(Q(I,o,s))},{onFinalFailure:()=>{ee.setCache(r,n),S.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Aa(t,r,s){const n=ee.getProjects(r);return ee.setCache(r,s),H(async()=>{const a=vt(I),o=L.projects(t,r);s.forEach((i,l)=>{if(i.id&&!i.id.startsWith("temp-")){const c=Q(I,o,i.id);a.update(c,{order:l})}}),await a.commit()},{onFinalFailure:()=>{ee.setCache(r,n),S.error("ä¸¦ã³æ›¿ãˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Fe=()=>fe(X.getState().language).t;function Qt(){var s;const t=(s=R.currentUser)==null?void 0:s.uid,r=xe();if(!t||!r)throw new Error("Authentication or Workspace required.");return{userId:t,workspaceId:r}}const Fa=t=>{const r=t||xe();return r?Da(r):[]},Ba=t=>{const r=t||xe();return r?Sa(r):!1},Ra=(t,r)=>{const s=r||xe();s&&Ta(s,t)},$a=(t,r)=>{const s=typeof t=="function"?t:r,n=typeof t=="string"?t:xe(),a=R.currentUser;return a&&n&&typeof s=="function"?Ma(a.uid,n,s):(typeof s=="function"&&s([]),()=>{})},Oa=async(t,r=null,s)=>{const n=Fe();try{const a=R.currentUser;if(!a)throw new Error("Authentication required.");const o=r||xe();if(!o)throw new Error("Workspace selection required.");const i={name:t,color:s,ownerId:a.uid},l=Mr.pick({name:!0,color:!0,ownerId:!0}).safeParse(i);if(!l.success){const d=l.error.issues.map(u=>u.message).join(", ");throw S.error(`${n("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}return await Ea(a.uid,o,t,s)}catch(a){throw console.error("Failed to add project:",a),a.message.includes("Validation")||S.error(Fe()("msg.project.create_fail")),a}},Pa=async(t,r)=>{const s=Fe();try{const{userId:n,workspaceId:a}=Qt(),o=Mr.partial().safeParse(r);if(!o.success){const i=o.error.issues.map(l=>l.message).join(", ");throw S.error(`${s("validation.validation_error")}: ${i}`),new Error(`Validation failed: ${i}`)}await Ia(n,a,t,r)}catch(n){throw console.error("Failed to update project:",n),n.message.includes("Validation")||S.error(Fe()("msg.project.update_fail")),n}},Br=async t=>{try{const{userId:r,workspaceId:s}=Qt();await La(r,s,t),S.success(Fe()("msg.project.delete_success"))}catch(r){throw console.error("Failed to delete project:",r),S.error(Fe()("msg.project.delete_fail")),r}},Wa=async t=>{try{const{userId:r,workspaceId:s}=Qt();await Aa(r,s,t)}catch(r){throw console.error("Failed to reorder projects:",r),S.error(Fe()("msg.project.reorder_fail")),r}},lt=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=pr(),a=p.useCallback(g=>!t||!r?()=>{}:$a(t,g),[t,r]),i=(t?Ba(t):!1)&&t?Fa(t):void 0,{data:l,isPending:c}=$e(["projects",r||void 0,t||void 0],a,i);return{projects:l||[],loading:s||!!t&&c,setProjectsOverride:g=>{t&&(n.setQueryData(["projects",t],g),Ra(g,t))}}},za=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}],Ee=class Ee{constructor(){P(this,"cacheMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}static getInstance(){return Ee.instance||(Ee.instance=new Ee),Ee.instance}getBlocks(r){return this.cacheMap.get(r)||[]}isInitialized(r){return this.cacheMap.has(r)}setCache(r,s){this.cacheMap.set(r,s),this.notify(r)}notify(r){const s=this.getBlocks(r),n=this.listeners.get(r);n&&n.forEach(a=>a([...s]))}subscribe(r,s,n){if(!r||!s)return n([]),()=>{};this.listeners.has(s)||this.listeners.set(s,new Set),this.listeners.get(s).add(n);const a=this.cacheMap.get(s);if(a&&queueMicrotask(()=>n([...a])),!this.unsubscribes.has(s)){const o=L.timeblocks(r,s),i=Se(W(I,o),Kt("order","asc"));let l=!0;const c=Re(i,d=>{const u=d.docs.map(g=>({id:g.id,...g.data()}));if(l&&u.length===0&&!d.metadata.hasPendingWrites){l=!1,qa(r,s).catch(g=>console.error("[TimeBlocks] Failed to create defaults:",g));return}l=!1,this.cacheMap.set(s,u),this.notify(s)},d=>{console.error("[TimeBlocks] Subscription error:",d)});this.unsubscribes.set(s,c)}return()=>{const o=this.listeners.get(s);o&&o.delete(n)}}};P(Ee,"instance");let At=Ee;const le=At.getInstance();async function qa(t,r){const s=L.timeblocks(t,r),n=vt(I);za.forEach(a=>{const o=Q(I,s,a.id);n.set(o,{name:a.name,start:a.start,end:a.end,color:a.color,order:a.order,updatedAt:ue()})}),await n.commit()}function Ua(t,r,s){return le.subscribe(t,r,s)}function Ka(t){return le.getBlocks(t)}function Va(t){return le.isInitialized(t)}async function Ha(t,r,s){const n=le.getBlocks(r),a=[...n,s].sort((l,c)=>(l.order||0)-(c.order||0));le.setCache(r,a);const o=L.timeblocks(t,r),i=s.id||crypto.randomUUID();return H(async()=>{await jr(Q(I,o,i),{...s,updatedAt:ue()})},{onFinalFailure:()=>{le.setCache(r,n),S.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ga(t,r,s,n){const a=le.getBlocks(r),o=a.map(l=>l.id===s?{...l,...n}:l).sort((l,c)=>(l.order||0)-(c.order||0));le.setCache(r,o);const i=L.timeblocks(t,r);return H(async()=>{await jr(Q(I,i,s),{...n,updatedAt:ue()},{merge:!0})},{onFinalFailure:()=>{le.setCache(r,a),S.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ya(t,r,s){const n=le.getBlocks(r),a=n.filter(i=>i.id!==s);le.setCache(r,a);const o=L.timeblocks(t,r);return H(async()=>{await it(Q(I,o,s))},{onFinalFailure:()=>{le.setCache(r,n),S.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Xa=()=>fe(X.getState().language).t;function Rr(t){var s;const r=(s=R.currentUser)==null?void 0:s.uid;if(!r||!t)throw new Error("Authentication and Workspace are required.");return r}function Ja(t,r){var n;const s=(n=R.currentUser)==null?void 0:n.uid;return s?Ua(s,t,r):(r([]),()=>{})}function $r(t){return Ka(t)}function Qa(t){return Va(t)}async function Za(t,r){const s=Rr(t),n=Xa();try{const a=r.id||crypto.randomUUID(),o=$r(t),i=r.order!==void 0?r.order:Math.max(...o.map(u=>u.order||0),-1)+1,l={id:a,name:r.name||"",start:r.start||"09:00",end:r.end||"10:00",color:r.color||"#cccccc",order:i},c=ra.safeParse(l);if(!c.success){const u=c.error.issues.map(g=>g.message).join(", ");return console.error("[TimeBlocks] Validation error:",c.error),S.error(`${n("validation.validation_error")}: ${u}`),!1}return o.some(u=>u.id===a)?await Ga(s,t,a,l):await Ha(s,t,l),!0}catch(a){return console.error("[TimeBlocks] Save error:",a),!1}}async function Or(t,r){const s=Rr(t);try{return await Ya(s,t,r),!0}catch(n){return console.error("[TimeBlocks] Delete error:",n),!1}}const Oe=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=p.useCallback(c=>!t||!r?()=>{}:Ja(t,c),[t,r]),a=t?Qa(t):!1,{data:o,isPending:i}=$e(["timeblocks",r||void 0,t||void 0],n,t&&a?$r(t):void 0);return{timeBlocks:o||[],loading:s||!!t&&i}};function Zt(t){const r={keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(!t)return r;const s=/(?:-?[a-zA-Z]+:(?:"[^"]*"|[^\s]+))|(?:"[^"]*")|(?:-?[^\s]+)/g,n=t.match(s);if(!n)return r;const a=[];for(let o=0;o<n.length;o++){const i=n[o];if(i==="OR"){const l=a.length-1,c=a[l],d=n[o+1],u=c&&(typeof c=="string"?!c.includes(":"):!0),g=d&&!d.includes(":")&&d!=="OR";if(u&&g){const f=Array.isArray(c)?c:[c];f.push(d.toLowerCase().replace(/^"|"$/g,"")),a[l]=f,o++;continue}}a.push(i)}return a.forEach(o=>{if(Array.isArray(o)){r.keywords.push(o);return}const i=o;if(i.startsWith('"')&&i.endsWith('"')){const l=i.substring(1,i.length-1);l&&r.keywords.push(l.toLowerCase());return}if(i.startsWith("-")&&!i.includes(":")){const l=i.substring(1);l&&r.excludeKeywords.push(l.toLowerCase());return}if(i.includes(":")){let l=!1,c=i;c.startsWith("-")&&(l=!0,c=c.substring(1));const d=c.indexOf(":"),u=c.substring(0,d).toLowerCase();let g=c.substring(d+1);switch(g.startsWith('"')&&g.endsWith('"')&&(g=g.substring(1,g.length-1)),g.toLowerCase(),u){case"project":case"p":l?g.split(",").forEach(m=>r.excludeProjects.push(m)):g.split(",").forEach(m=>r.projects.push(m));break;case"label":case"l":l?g.split(",").forEach(m=>r.excludeLabels.push(m)):g.split(",").forEach(m=>r.labels.push(m));break;case"timeblock":case"tb":l?g.split(",").forEach(m=>r.excludeTimeBlocks.push(m)):g.split(",").forEach(m=>r.timeBlocks.push(m));break;case"duration":case"d":g.split(",").forEach(m=>{const h=parseInt(m,10);isNaN(h)||r.durations.push(h)});break;case"date":case"due":const f=["today","tomorrow","week","upcoming","overdue","next-week"];g.split(",").forEach(m=>{const h=m.toLowerCase();f.includes(h)&&r.dates.push(h)});break;case"status":case"is":const y=["completed","active","todo"];g.split(",").forEach(m=>{const h=m.toLowerCase();y.includes(h)&&(l?r.excludeStatus.push(h):r.status.push(h)),h==="important"&&(r.isImportant=!l),h==="unimportant"&&(r.isImportant=l)});break;default:l?r.excludeKeywords.push(c.toLowerCase()):r.keywords.push(c.toLowerCase());break}}else i!=="OR"&&r.keywords.push(i.toLowerCase())}),r}function en(t){var s,n,a,o,i,l,c,d,u,g,f,y;const r=[];return(s=t.keywords)!=null&&s.length&&r.push(...t.keywords.map(m=>Array.isArray(m)?m.join(" OR "):m.includes(" ")?`"${m}"`:m)),(n=t.excludeKeywords)!=null&&n.length&&r.push(...t.excludeKeywords.map(m=>`-${m}`)),(a=t.projects)!=null&&a.length&&r.push(`project:${t.projects.join(",")}`),(o=t.excludeProjects)!=null&&o.length&&r.push(`-project:${t.excludeProjects.join(",")}`),(i=t.labels)!=null&&i.length&&r.push(`label:${t.labels.join(",")}`),(l=t.excludeLabels)!=null&&l.length&&r.push(`-label:${t.excludeLabels.join(",")}`),(c=t.timeBlocks)!=null&&c.length&&r.push(`timeblock:${t.timeBlocks.join(",")}`),(d=t.excludeTimeBlocks)!=null&&d.length&&r.push(`-timeblock:${t.excludeTimeBlocks.join(",")}`),(u=t.durations)!=null&&u.length&&r.push(`duration:${t.durations.join(",")}`),(g=t.dates)!=null&&g.length&&r.push(`date:${t.dates.join(",")}`),(f=t.status)!=null&&f.length&&r.push(`status:${t.status.join(",")}`),(y=t.excludeStatus)!=null&&y.length&&r.push(`-status:${t.excludeStatus.join(",")}`),t.isImportant===!0&&r.push("is:important"),t.isImportant===!1&&r.push("is:unimportant"),r.join(" ")}const Ne=mr([he(),w(),ps(),fs()]),tn=te({id:w(),title:w().min(1),description:w().nullable().optional(),status:pt(["todo","completed","archived"]).optional(),dueDate:Ne,completedAt:Ne,createdAt:Ne,ownerId:w().optional(),projectId:w().nullable().optional(),labelIds:pe(w()).optional(),timeBlockId:w().nullable().optional(),duration:he().optional(),isImportant:hr().optional(),recurrence:te({type:pt(["none","daily","weekly","weekdays","monthly"]).optional(),days:pe(he()).optional()}).nullable().optional(),order:he().optional()}).passthrough(),rn=te({id:w(),name:w().min(1),color:w().optional(),ownerId:w().optional(),createdAt:Ne,order:he().optional()}).passthrough(),sn=te({id:w(),name:w().min(1),color:w().optional(),ownerId:w().optional(),createdAt:Ne}).passthrough(),an=te({id:w(),mode:w(),data:xr(w(),w()),createdAt:Ne,updatedAt:Ne,ownerId:w().optional(),workspaceId:w().optional()}).passthrough(),nn=te({id:w(),name:w().min(1),start:w(),end:w(),color:w().optional(),order:he().optional()}).passthrough(),on=te({id:w(),name:w().min(1),query:w(),createdAt:Ne}).passthrough(),ln=te({version:w().optional(),exportedAt:w().optional(),userId:w().optional(),workspaceId:w().optional(),tasks:pe(tn).default([]),projects:pe(rn).default([]),labels:pe(sn).default([]),targets:pe(an).default([]),timeBlocks:pe(nn).default([]),customFilters:pe(on).default([])}),cn=t=>t instanceof Date?Ve.fromDate(t):t,Me=t=>{if(t!=null){if(typeof t=="number")return new Date(t);if(typeof t=="string")return new Date(t)}};async function dn(t,r){if(!t||!r)throw new Error("Missing parameters for backup.");try{const s=W(I,L.tasks(t,r)),n=W(I,L.projects(t,r)),a=W(I,L.labels(t,r)),o=W(I,L.targets(t,r)),i=W(I,L.timeblocks(t,r)),l=W(I,L.filters(t,r)),[c,d,u,g,f,y]=await Promise.all([be(s),be(n),be(a),be(o),be(i),be(l)]),m=h=>h.docs.map(v=>{const j=v.data(),x={id:v.id};for(const k in j){const E=j[k];x[k]=E instanceof Ve?E.toMillis():E}return x});return{version:"1.4",exportedAt:new Date().toISOString(),userId:t,workspaceId:r,tasks:m(c),projects:m(d),labels:m(u),targets:m(g),timeBlocks:m(f),customFilters:m(y)}}catch(s){throw console.error("[Backup] createBackupData failed:",s),s}}async function un(t,r,s){var i;if(!t||!r)throw new Error("Invalid import parameters: userId and workspaceId are required.");if(!s)throw new Error("Invalid import parameters: backupData is required.");const n=ln.safeParse(s);if(!n.success)throw console.error("[Backup] Validation failed:",n.error.format()),new Error(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™: ${n.error.issues.map(l=>l.message).join(", ")}`);const a=n.data,o=[];try{const{tasks:l,projects:c,labels:d,targets:u,timeBlocks:g,customFilters:f}=a,y=new Map,m=new Map,h=await be(W(I,L.labels(t,r))),v=new Map;h.forEach(x=>v.set(x.data().name,x.id));for(const x of d)try{const k=(i=x.name)==null?void 0:i.trim();if(!k)continue;if(v.has(k))m.set(x.id,v.get(k));else{const E={...x,name:k};delete E.id;const D=await oe(W(I,L.labels(t,r)),E);m.set(x.id,D.id),v.set(k,D.id)}}catch(k){o.push(`ãƒ©ãƒ™ãƒ« "${x.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}for(const x of c)try{const k={...x};delete k.id,k.createdAt=Me(x.createdAt);const E=await oe(W(I,L.projects(t,r)),k);y.set(x.id,E.id)}catch(k){o.push(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ "${x.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}for(const x of g)try{const k={...x};delete k.id,await oe(W(I,L.timeblocks(t,r)),k)}catch(k){o.push(`ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ "${x.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}for(const x of f)try{const k={...x};delete k.id,k.createdAt=Me(x.createdAt),await oe(W(I,L.filters(t,r)),k)}catch(k){o.push(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ "${x.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}for(const x of u)try{const k={...x};delete k.id,k.createdAt=Me(x.createdAt),k.updatedAt=Me(x.updatedAt),k.ownerId=t,k.workspaceId=r,await oe(W(I,L.targets(t,r)),k)}catch(k){o.push(`ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (mode: ${x.mode}) ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}const j=l.map(async x=>{try{const k={...x};delete k.id,k.createdAt=Me(x.createdAt);const E=Me(x.dueDate);k.dueDate=E?cn(E):null,k.completedAt=Me(x.completedAt),x.projectId&&y.has(x.projectId)?k.projectId=y.get(x.projectId):k.projectId=null,Array.isArray(x.labelIds)&&(k.labelIds=x.labelIds.map(D=>m.get(D)).filter(D=>!!D)),k.ownerId=t,await oe(W(I,L.tasks(t,r)),k)}catch(k){o.push(`ã‚¿ã‚¹ã‚¯ "${x.title}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${k}`)}});return await Promise.all(j),{tasksCount:l.length,projectsCount:c.length,labelsCount:d.length,targetsCount:u.length,timeBlocksCount:g.length,filtersCount:f.length,errors:o}}catch(l){throw console.error("[Backup] importBackupData failed:",l),l}}const Ie=class Ie{constructor(){P(this,"cacheMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}static getInstance(){return Ie.instance||(Ie.instance=new Ie),Ie.instance}getFilters(r){return this.cacheMap.get(r)||[]}isInitialized(r){return this.cacheMap.has(r)}setCache(r,s){this.cacheMap.set(r,s),this.notify(r)}clearCache(r){r?(this.cacheMap.delete(r),this.notify(r)):this.cacheMap.clear()}notify(r){const s=this.getFilters(r),n=this.listeners.get(r);n&&n.forEach(a=>a([...s]))}subscribe(r,s,n){if(!r||!s)return n([]),()=>{};this.listeners.has(s)||this.listeners.set(s,new Set),this.listeners.get(s).add(n);const a=this.cacheMap.get(s);if(a&&queueMicrotask(()=>n([...a])),!this.unsubscribes.has(s)){const o=L.filters(r,s),i=Se(W(I,o)),l=Re(i,c=>{const d=c.docs.map(u=>({id:u.id,...u.data()}));this.cacheMap.set(s,d),this.notify(s)},c=>{console.error("[Filters] Subscription error:",c),this.cacheMap.set(s,[]),this.notify(s)});this.unsubscribes.set(s,l)}return()=>{const o=this.listeners.get(s);o&&o.delete(n)}}};P(Ie,"instance");let Ft=Ie;const ce=Ft.getInstance();function gn(t,r,s){return ce.subscribe(t,r,s)}function mn(t){return ce.getFilters(t)}function hn(t){return ce.isInitialized(t)}async function xn(t,r,s){const n=ce.getFilters(r),a="temp_"+Date.now(),o={...s,id:a,createdAt:new Date};ce.setCache(r,[...n,o]);const i=L.filters(t,r);return H(async()=>(await oe(W(I,i),{...s,createdAt:ue()})).id,{onFinalFailure:()=>{ce.setCache(r,n),S.error("ãƒ•ã‚£ãƒ«ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function pn(t,r,s,n){const a=ce.getFilters(r),o=a.map(l=>l.id===s?{...l,...n}:l);ce.setCache(r,o);const i=L.filters(t,r);return H(async()=>{await He(Q(I,i,s),{...n,updatedAt:ue()})},{onFinalFailure:()=>{ce.setCache(r,a),S.error("ãƒ•ã‚£ãƒ«ã‚¿ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function fn(t,r,s){const n=ce.getFilters(r),a=n.filter(i=>i.id!==s);ce.setCache(r,a);const o=L.filters(t,r);return H(async()=>{await it(Q(I,o,s))},{onFinalFailure:()=>{ce.setCache(r,n),S.error("ãƒ•ã‚£ãƒ«ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const er=()=>fe(X.getState().language).t;function bn(t){return t?mn(t):[]}function yn(t){return hn(t)}function kn(t,r){var n;const s=(n=R.currentUser)==null?void 0:n.uid;return!s||!t?(r([]),()=>{}):gn(s,t,r)}async function vn(t){var c;const r=er(),s=(c=R.currentUser)==null?void 0:c.uid;if(!s)throw S.error(r("validation.auth_required")),new Error("Authentication required");const{workspaceId:n,...a}=t;if(!n)throw S.error(r("validation.workspace_required")),new Error("Workspace ID required");const o=Ir.pick({name:!0,query:!0}).safeParse(a);if(!o.success){const d=o.error.issues.map(u=>u.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),S.error(`${r("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=a;await xn(s,n,{name:l.name,query:l.query,workspaceId:n,ownerId:s})}async function jn(t,r,s){var c;const n=er(),a=(c=R.currentUser)==null?void 0:c.uid;if(!a||!t)throw S.error(n("validation.auth_required")),new Error("Authentication required");const o=Ir.partial().safeParse(s);if(!o.success){const d=o.error.issues.map(u=>u.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),S.error(`${n("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=s;await pn(a,t,r,l)}async function wn(t,r){var a;const s=er(),n=(a=R.currentUser)==null?void 0:a.uid;if(!n||!t)throw S.error(s("validation.auth_required")),new Error("Authentication required");await fn(n,t,r)}class Nn{constructor(){P(this,"cachedLabelsMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}isInitialized(r){return this.cachedLabelsMap.has(r)}notifyListeners(r){const s=this.cachedLabelsMap.get(r)||[],n=this.listeners.get(r);if(n){const a=[...s];n.forEach(o=>o(a))}}setCache(r,s){this.cachedLabelsMap.set(r,s),this.notifyListeners(r)}getLabels(r){return this.cachedLabelsMap.get(r)||[]}subscribe(r,s,n){this.listeners.has(s)||this.listeners.set(s,new Set);const a=this.listeners.get(s);a.add(n);const o=this.cachedLabelsMap.get(s);if(o&&queueMicrotask(()=>n([...o])),!this.unsubscribes.has(s)){const i=L.labels(r,s),l=Se(W(I,i));console.log(`[LabelCache] Subscribing to path: ${i}`);const c=Re(l,d=>{const u=d.docs.map(g=>({id:g.id,...g.data()}));console.log(`[LabelCache] Received ${u.length} labels from Firestore for workspace: ${s}`),this.cachedLabelsMap.set(s,u),this.notifyListeners(s)},d=>{console.error("[LabelCache] Subscription error:",d),this.cachedLabelsMap.set(s,[]),this.notifyListeners(s)});this.unsubscribes.set(s,c)}return()=>{var i;a.delete(n),a.size===0&&((i=this.unsubscribes.get(s))==null||i(),this.unsubscribes.delete(s),this.listeners.delete(s))}}}const de=new Nn,_n=t=>de.isInitialized(t),Cn=t=>de.getLabels(t);function Sn(t,r,s){return!t||!r?(s([]),()=>{}):de.subscribe(t,r,s)}async function Dn(t,r,s,n){const a=de.getLabels(r),i={id:"temp-"+Date.now(),name:s,color:n,ownerId:t,createdAt:new Date};de.setCache(r,[...a,i]);const l=L.labels(t,r);return console.log(`[LabelCache] Adding label to path: ${l}`),H(async()=>{await oe(W(I,l),{name:s,color:n,ownerId:t,workspaceId:r,createdAt:ue()})},{onFinalFailure:()=>{console.error(`[LabelCache] Failed to add label: ${s}`),de.setCache(r,a),S.error("ãƒ©ãƒ™ãƒ«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Tn(t,r,s,n){const a=de.getLabels(r),o=a.map(i=>i.id===s?{...i,...n}:i);return de.setCache(r,o),H(async()=>{const i=L.labels(t,r),l=Q(I,i,s);await He(l,n)},{onFinalFailure:()=>{de.setCache(r,a),S.error("ãƒ©ãƒ™ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Mn(t,r,s){const n=de.getLabels(r),a=n.filter(o=>o.id!==s);return de.setCache(r,a),H(async()=>{const o=L.labels(t,r);await it(Q(I,o,s))},{onFinalFailure:()=>{de.setCache(r,n),S.error("ãƒ©ãƒ™ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const En=Cn,In=t=>t?_n(t):!1,Ke=()=>fe(X.getState().language).t;function tr(){var r;const t=(r=R.currentUser)==null?void 0:r.uid;if(!t)throw console.error("Authentication required for label operation."),new Error("Authentication required.");return t}function Ln(t,r){var n;const s=(n=R.currentUser)==null?void 0:n.uid;return s&&t?Sn(s,t,r):(r([]),()=>{})}async function An(t,r,s){const n=Ke();try{const a=tr();if(!t)throw new Error("Workspace ID required");const o={name:r,color:s,ownerId:a},i=Er.pick({name:!0,color:!0,ownerId:!0}).safeParse(o);if(!i.success){const c=i.error.issues.map(d=>d.message).join(", ");throw S.error(`${n("validation.validation_error")}: ${c}`),new Error(`Validation failed: ${c}`)}return await Dn(a,t,r,s)}catch(a){throw console.error("Failed to add label:",a),a.message.includes("Validation")||S.error(Ke()("msg.label.create_fail")),a}}async function Fn(t,r,s){const n=Ke();try{const a=tr();if(!t)throw new Error("Workspace ID required");const o=Er.partial().safeParse(s);if(!o.success){const l=o.error.issues.map(c=>c.message).join(", ");throw S.error(`${n("validation.validation_error")}: ${l}`),new Error(`Validation failed: ${l}`)}return await Tn(a,t,r,s)}catch(a){throw console.error("Failed to update label:",a),a.message.includes("Validation")||S.error(Ke()("msg.label.update_fail")),a}}async function Bn(t,r){try{const s=tr();if(!t)throw new Error("Workspace ID required");const n=await Mn(s,t,r);return S.success(Ke()("msg.label.delete_success")),n}catch(s){throw console.error("Failed to delete label:",s),S.error(Ke()("msg.label.delete_fail")),s}}async function Rn(t){const r=R.currentUser;if(!r)throw new Error("User not authenticated");const s=L.tasks(r.uid,t),a=(await be(W(I,s))).docs.map(l=>({id:l.id,...l.data()})),o=new Map;for(const l of a){if(!l.title)continue;const c=l.title.trim(),d=o.get(c)||[];d.push(l),o.set(c,d)}const i=[];for(const[l,c]of o.entries())if(c.length>1){c.sort((u,g)=>{const f=h=>{if(!h)return 0;if(typeof h=="object"&&"toDate"in h&&typeof h.toDate=="function")return h.toDate().getTime();const v=new Date(h);return isNaN(v.getTime())?0:v.getTime()},y=f(u.createdAt),m=f(g.createdAt);return y-m});const d=c.slice(1);for(const u of d)u.id&&i.push(u.id)}if(i.length>0)for(let l=0;l<i.length;l+=500){const c=vt(I),d=i.slice(l,l+500);for(const u of d)c.delete(Q(I,s,u));await c.commit()}return i.length}class $n{constructor(){P(this,"cachedTargetsMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map)}isInitialized(r){return this.cachedTargetsMap.has(r)}notifyListeners(r){const s=this.cachedTargetsMap.get(r)||[],n=this.listeners.get(r);if(n){const a=[...s];n.forEach(o=>o(a))}}setCache(r,s){this.cachedTargetsMap.set(r,s),this.notifyListeners(r)}getTargets(r){return this.cachedTargetsMap.get(r)||[]}subscribe(r,s,n){this.listeners.has(s)||this.listeners.set(s,new Set);const a=this.listeners.get(s);a.add(n);const o=this.cachedTargetsMap.get(s);if(o&&queueMicrotask(()=>n([...o])),!this.unsubscribes.has(s)){const i=L.targets(r,s),l=Se(W(I,i),Kt("createdAt","desc"));console.log(`[TargetCache] Subscribing to path: ${i}`);const c=Re(l,d=>{const u=d.docs.map(f=>({id:f.id,...f.data()})),g=this.cachedTargetsMap.get(s);g&&wa(g,u)||(console.log(`[TargetCache] Received ${u.length} targets from Firestore for workspace: ${s}`),this.cachedTargetsMap.set(s,u),this.notifyListeners(s))},d=>{console.error("[TargetCache] Subscription error:",d),this.cachedTargetsMap.set(s,[]),this.notifyListeners(s)});this.unsubscribes.set(s,c)}return()=>{var i;a.delete(n),a.size===0&&((i=this.unsubscribes.get(s))==null||i(),this.unsubscribes.delete(s),this.listeners.delete(s))}}}const ze=new $n,On=t=>ze.isInitialized(t),Pn=t=>ze.getTargets(t);function Wn(t,r,s,n){return!t||!r?(s([]),()=>{}):ze.subscribe(t,r,a=>{s(a)})}async function zn(t,r,s){const n=ze.getTargets(r),o={id:"temp-"+Date.now(),mode:s.mode||"",data:s.data||{},ownerId:t,workspaceId:r,createdAt:new Date,updatedAt:new Date,...s};return ze.setCache(r,[o,...n]),H(async()=>{const i=L.targets(t,r),l={...s,ownerId:t,workspaceId:r,createdAt:ue(),updatedAt:ue()};delete l.id,await oe(W(I,i),l)},{onFinalFailure:()=>{console.error("[TargetCache] Failed to add target"),ze.setCache(r,n),S.error("ç›®æ¨™ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}function qn(){var r;const t=(r=R.currentUser)==null?void 0:r.uid;if(!t)throw new Error("Authentication required.");return t}const Un=t=>{const r=t||xe();return r?Pn(r):[]},Kn=t=>{const r=t||xe();return r?On(r):!1},Vn=(t,r,s)=>{const n=R.currentUser;return n&&t&&typeof r=="function"?Wn(n.uid,t,r):(typeof r=="function"&&r([]),()=>{})},Hn=async(t,r)=>{const s=qn();if(!t)throw new Error("Workspace ID required.");return zn(s,t,r)};function Y(t){if(!t)return null;if(t instanceof Date)return t;if(t.toDate&&typeof t.toDate=="function")return t.toDate();const r=new Date(t);return isNaN(r.getTime())?null:r}const or=(t,r)=>{const s=Y(t),n=Y(r);return!s||!n?!1:s.getFullYear()===n.getFullYear()&&s.getMonth()===n.getMonth()&&s.getDate()===n.getDate()},Gn=t=>{const r=Y(t);if(!r)return!1;const s=new Date;return r.getFullYear()===s.getFullYear()&&r.getMonth()===s.getMonth()&&r.getDate()===s.getDate()},Yn=(t,r=7)=>{const s=Y(t);if(!s)return!1;const n=new Date;n.setHours(0,0,0,0);const a=new Date(n);a.setDate(n.getDate()+1);const o=new Date(n);return o.setDate(n.getDate()+r+1),s>=a&&s<o};function Nt(t=new Date){const r=Y(t)||new Date,s=new Date(r);return s.setHours(0,0,0,0),s}function Xn(t=new Date,r=1){const s=Y(t)||new Date,n=s.getDay(),a=s.getDate()-n+(n<r?r-7:r),o=new Date(s);return o.setDate(a),Nt(o)}function Jn(t){const r=Y(t);if(!r)return"";const s=new Date,n=Nt(s),a=Math.round((r.getTime()-n.getTime())/(1e3*60*60*24));if(a===0)return"ä»Šæ—¥";if(a===1)return"æ˜Žæ—¥";if(a===-1)return"æ˜¨æ—¥";const o=r.getFullYear(),i=String(r.getMonth()+1).padStart(2,"0"),l=String(r.getDate()).padStart(2,"0");return o!==s.getFullYear()?`${o}/${i}/${l}`:`${i}/${l}`}const Qn=t=>{const r=Y(t);if(!r)return"";const s=r.getFullYear(),n=String(r.getMonth()+1).padStart(2,"0"),a=String(r.getDate()).padStart(2,"0");return`${s}-${n}-${a}`},Zn=t=>{if(!t)return null;const r=new Date(t);return isNaN(r.getTime())?null:r};function eo(t){const r=Y(t);if(!r)return"text-gray-500";const s=Nt(new Date),n=Math.round((r.getTime()-s.getTime())/(1e3*60*60*24));return n<0?"text-red-500 font-bold":n===0?"text-green-600 dark:text-green-400 font-medium":n===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function to(t,r){var n;if(!t||!(r!=null&&r.type))return null;const s=new Date(Y(t));switch(r.type){case"daily":return s.setDate(s.getDate()+1),s;case"weekly":{if(!((n=r.days)!=null&&n.length))return null;const a=s.getDay();for(let o=1;o<=7;o++){const i=(a+o)%7;if(r.days.includes(i))return s.setDate(s.getDate()+o),s}return null}case"weekdays":do s.setDate(s.getDate()+1);while(s.getDay()===0||s.getDay()===6);return s;case"monthly":return s.setMonth(s.getMonth()+1),s;default:return null}}function ro(t){const r=Nt(new Date);if(!(t!=null&&t.type)||t.type==="daily"||t.type==="monthly")return r;if(t.type==="weekly"&&t.days&&t.days.length>0){const s=r.getDay();for(let n=0;n<=6;n++)if(t.days.includes((s+n)%7))return r.setDate(r.getDate()+n),r}if(t.type==="weekdays"){for(;r.getDay()===0||r.getDay()===6;)r.setDate(r.getDate()+1);return r}return r}function so(t,r){if(!t||!r)return 0;const[s,n]=t.split(":").map(Number),[a,o]=r.split(":").map(Number);if(isNaN(s)||isNaN(n)||isNaN(a)||isNaN(o))return 0;const i=s*60+n;let l=a*60+o;return l<i&&(l+=1440),l-i}const Dt=t=>t instanceof Ve?t.toDate():t instanceof Date?t:void 0,Pr=t=>t instanceof Date?Ve.fromDate(t):t;function ao(t,r){if(!r||typeof r!="object")return console.warn(`[deserializeTask] Invalid data for task ${t}:`,r),{id:t,title:"Invalid Task",status:"todo",ownerId:""};const s=r.recurrence||null,n={id:t,title:String(r.title||"Untitled"),description:r.description?String(r.description):null,status:r.status==="completed"||r.status==="todo"||r.status==="archived"?r.status:"todo",dueDate:Dt(r.dueDate)||void 0,createdAt:Dt(r.createdAt)||void 0,completedAt:Dt(r.completedAt)||void 0,ownerId:String(r.ownerId||""),projectId:r.projectId?String(r.projectId):null,labelIds:Array.isArray(r.labelIds)?r.labelIds.map(String):[],timeBlockId:r.timeBlockId?String(r.timeBlockId):null,duration:typeof r.duration=="number"?r.duration:null,isImportant:!!r.isImportant,recurrence:s};return Yt.safeParse(n).success,n}const Le=class Le{constructor(){P(this,"cachedTasksMap",new Map);P(this,"listeners",new Map);P(this,"unsubscribes",new Map);P(this,"currentWorkspaceId",null)}static getInstance(){return Le.instance||(Le.instance=new Le),Le.instance}notifyListeners(r){const s=this.cachedTasksMap.get(r)||[],n=this.listeners.get(r);if(n){const a=[...s];n.forEach(o=>o(a))}}reset(r){var s;r?((s=this.unsubscribes.get(r))==null||s(),this.unsubscribes.delete(r),this.listeners.delete(r),this.cachedTasksMap.delete(r)):(this.unsubscribes.forEach(n=>n()),this.unsubscribes.clear(),this.listeners.clear(),this.cachedTasksMap.clear()),this.currentWorkspaceId=null}getTask(r,s){const n=this.cachedTasksMap.get(r);return n==null?void 0:n.find(a=>a.id===s)}getTasks(r){return this.cachedTasksMap.get(r)||[]}isInitialized(r){return this.cachedTasksMap.has(r)}setCache(r,s){this.cachedTasksMap.set(r,s),this.notifyListeners(r)}subscribe(r,s,n,a){if(!r||!s)return n([]),()=>{};this.currentWorkspaceId=s,this.listeners.has(s)||this.listeners.set(s,new Set);const o=this.listeners.get(s);o.add(n);const i=this.cachedTasksMap.get(s);if(i&&queueMicrotask(()=>n([...i])),!this.unsubscribes.has(s)){const l=L.tasks(r,s),c=Se(W(I,l)),d=Re(c,u=>{const g=u.docs.map(y=>ao(y.id,y.data())),f=this.cachedTasksMap.get(s);f&&Na(f,g)||(this.cachedTasksMap.set(s,g),this.notifyListeners(s))},u=>{console.error("[Tasks] Subscription error:",u),a&&a(u)});this.unsubscribes.set(s,d)}return()=>{if(o.delete(n),o.size===0){const l=this.unsubscribes.get(s);l&&(l(),this.unsubscribes.delete(s))}}}};P(Le,"instance");let Bt=Le;const re=Bt.getInstance();function Wr(t,r){return re.getTask(t,r)}function no(t){return re.getTasks(t)}function oo(t){return re.isInitialized(t)}function io(t,r,s,n){return re.subscribe(t,r,s,n)}function zr(t){return Object.fromEntries(Object.entries(t).filter(([r,s])=>s!==void 0))}async function lo(t,r,s){const n=new Map;s.forEach((o,i)=>n.set(o,i));const a=re.getTasks(r);if(a&&a.length>0){const o=a.map(i=>{const l=n.get(i.id);return l!==void 0?{...i,order:l}:i});o.sort((i,l)=>{const c=i.order??Number.MAX_SAFE_INTEGER,d=l.order??Number.MAX_SAFE_INTEGER;return c-d}),re.setCache(r,o)}return H(async()=>{const o=L.tasks(t,r),i=[];for(let l=0;l<s.length;l+=500)i.push(s.slice(l,l+500));for(const l of i){const c=vt(I);l.forEach(d=>{const u=n.get(d),g=Q(I,o,d);c.update(g,{order:u})}),await c.commit()}})}async function qr(t,r,s){return H(async()=>{const n=L.tasks(t,r),a=zr({...s});return a.dueDate&&(a.dueDate=Pr(a.dueDate)),delete a.id,await oe(W(I,n),{...a,ownerId:t,status:"todo",createdAt:ue()})})}async function co(t,r,s,n){const a=re.getTasks(r);if(a==null||a.find(o=>o.id===s),a){const o=a.map(i=>i.id===s?{...i,status:n,completedAt:n==="completed"?new Date:void 0}:i);re.setCache(r,o)}return H(async()=>{const o=L.tasks(t,r),i={status:n};n==="completed"?i.completedAt=ue():i.completedAt=null,await He(Q(I,o,s),i)},{onFinalFailure:()=>{a&&re.setCache(r,a),S.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function uo(t,r,s,n){const a=re.getTasks(r);if(a){const o=a.map(i=>i.id===s?{...i,...n}:i);re.setCache(r,o)}return H(async()=>{const o=L.tasks(t,r),i=zr({...n});i.dueDate!==void 0&&(i.dueDate=Pr(i.dueDate)),await He(Q(I,o,s),i)},{onFinalFailure:()=>{a&&re.setCache(r,a),S.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function go(t,r,s){const n=re.getTasks(r);if(n){const a=n.filter(o=>o.id!==s);re.setCache(r,a)}return H(async()=>{const a=L.tasks(t,r);await it(Q(I,a,s))},{onFinalFailure:()=>{n&&re.setCache(r,n),S.error("ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const _e=()=>fe(X.getState().language).t;function Ye(){var s;const t=(s=R.currentUser)==null?void 0:s.uid,r=xe();if(!t||!r)throw new Error("Authentication or Workspace required.");return{userId:t,workspaceId:r}}async function Ur(t){try{const{userId:r,workspaceId:s}=Ye(),a=Yt.partial().required({title:!0}).safeParse(t);a.success||console.warn("[addTask] Validation warning:",a.error.flatten()),await qr(r,s,t)}catch(r){throw console.error("Failed to add task:",r),S.error(_e()("msg.task.create_fail")),r}}async function mo(t,r){try{const{userId:s,workspaceId:n}=Ye();if(r==="completed"){const a=Wr(n,t);if(a!=null&&a.recurrence&&a.recurrence.type!=="none"){const o=to(a.dueDate??null,a.recurrence);if(o){const i={title:a.title,description:a.description,projectId:a.projectId,labelIds:a.labelIds,timeBlockId:a.timeBlockId,duration:a.duration,isImportant:a.isImportant,recurrence:a.recurrence,dueDate:o,status:"todo"};qr(s,n,i).catch(l=>console.error("Failed to create recurring task:",l))}}}await co(s,n,t,r)}catch(s){throw console.error("Failed to update status:",s),S.error(_e()("msg.task.status_update_fail")),s}}async function ft(t,r){try{const{userId:s,workspaceId:n}=Ye(),a=Yt.partial().safeParse(r);a.success||console.warn("[updateTask] Validation warning:",a.error.flatten()),await uo(s,n,t,r)}catch(s){throw console.error("Failed to update task:",s),S.error(_e()("msg.task.update_fail")),s}}async function ho(t){try{const{userId:r,workspaceId:s}=Ye();await lo(r,s,t)}catch(r){throw console.error("Failed to reorder tasks:",r),S.error(_e()("msg.task.update_fail")),r}}async function Kr(t){try{const{userId:r,workspaceId:s}=Ye();await go(r,s,t),S.success(_e()("msg.task.delete_success"))}catch(r){throw console.error("Failed to delete task:",r),S.error(_e()("msg.task.delete_fail")),r}}async function xo(t,r){try{const{userId:s,workspaceId:n}=Ye(),a=Wr(n,t),i=((a==null?void 0:a.status)||r||"todo")==="completed"?"todo":"completed";await mo(t,i),i==="completed"&&S.success(_e()("msg.task.complete_success"))}catch(s){throw console.error("Failed to toggle status:",s),S.error(_e()("msg.task.status_update_fail")),s}}function po(t,r,s){const n=R.currentUser;return!n||!t?(typeof r=="function"&&r([]),()=>{}):io(n.uid,t,r,s)}const fo=t=>{const r=t||xe();return r?no(r):[]},bo=t=>{const r=t||xe();return r?oo(r):!1},Xe=({message:t,id:r,className:s})=>t?e.jsxs("div",{id:r,role:"alert",className:`p-3 bg-red-50 dark:bg-red-900/20 text-red-600 dark:text-red-400 text-sm rounded-lg flex items-center justify-center gap-2 ${s||""}`,children:[e.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})}),e.jsx("span",{children:t})]}):null,ir='button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])',je=({isOpen:t,onClose:r,title:s,children:n,className:a,overlayClassName:o,zIndex:i=100,size:l="md",variant:c="center"})=>{const{t:d}=B(),u=p.useRef(null),g={sm:"max-w-full sm:max-w-sm",md:"max-w-full sm:max-w-lg",lg:"max-w-full sm:max-w-3xl",xl:"max-w-full sm:max-w-5xl",full:"max-w-full m-0 sm:m-4 h-[100dvh] sm:h-[calc(100vh-2rem)]",none:""},f={sm:"sm:w-80",md:"sm:w-96",lg:"sm:w-[32rem]",xl:"sm:w-[48rem]",full:"sm:w-screen",none:""};return p.useEffect(()=>{const y=h=>{h.key==="Escape"&&r()},m=h=>{if(h.key!=="Tab"||!u.current)return;const v=u.current.querySelectorAll(ir);if(v.length===0){h.preventDefault();return}const j=v[0],x=v[v.length-1];h.shiftKey?document.activeElement===j&&(h.preventDefault(),x.focus()):document.activeElement===x&&(h.preventDefault(),j.focus())};if(t){window.addEventListener("keydown",y),window.addEventListener("keydown",m),document.body.style.overflow="hidden";const h=setTimeout(()=>{var j;const v=(j=u.current)==null?void 0:j.querySelectorAll(ir);v&&v.length>0?v[0].focus():u.current&&u.current.focus()},50);return()=>clearTimeout(h)}return()=>{window.removeEventListener("keydown",y),window.removeEventListener("keydown",m),document.body.style.overflow=""}},[t,r]),t?$t.createPortal(e.jsxs("div",{className:_("fixed inset-0 flex z-50",c==="center"?"items-center justify-center p-0 sm:p-4":"items-end sm:items-stretch justify-end p-0"),style:{zIndex:i},role:"dialog","aria-modal":"true","aria-labelledby":s?"modal-title":void 0,children:[e.jsx("div",{className:_("fixed inset-0 backdrop-blur-sm transition-opacity",o??"bg-black/50"),onClick:r,"aria-hidden":"true"}),e.jsxs("div",{ref:u,tabIndex:-1,className:_("relative bg-white dark:bg-gray-800 shadow-md outline-none overflow-hidden flex flex-col transition-all duration-300",c==="center"&&["rounded-none sm:rounded-xl w-full max-h-[100dvh] sm:max-h-[90vh]",g[l]],c==="side-right"&&["h-[100dvh] w-full","sm:h-full sm:max-h-screen","sm:rounded-l-2xl sm:rounded-r-none shadow-2xl border-l border-gray-200 dark:border-gray-700",f[l]],a),children:[s&&e.jsxs("div",{className:"px-3 py-2 sm:px-modal sm:py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center shrink-0",children:[e.jsx("h3",{id:"modal-title",className:"text-base sm:text-lg font-bold text-gray-900 dark:text-white truncate",children:s}),e.jsx("button",{onClick:r,className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-1.5 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 shrink-0","aria-label":d("close"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]}),e.jsx("div",{className:"flex-1 overflow-y-auto p-3 sm:p-modal custom-scrollbar",children:n})]})]}),document.body):null};function gt({title:t,items:r,selectedItems:s,onToggle:n,labelFn:a=o=>o.name??o.id??String(o)}){return e.jsxs("div",{className:"flex flex-col min-h-[10rem] max-h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900",children:[e.jsx("div",{className:"px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500 uppercase tracking-wider shrink-0",children:t}),e.jsx("div",{className:"p-2 overflow-y-auto space-y-1 custom-scrollbar flex-1",children:r.map(o=>{const i=o.id||o.toString(),l=s.includes(i),c=`filter-${t.replace(/ /g,"-")}-${i}`,d=a(o);return e.jsxs("div",{className:"flex items-center px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group",onClick:()=>n(i),children:[e.jsx("input",{id:c,type:"checkbox",checked:l,onChange:()=>{},className:"w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500 cursor-pointer","aria-label":`${t}: ${d}`}),e.jsx("label",{htmlFor:c,className:"ml-2 text-sm text-gray-700 dark:text-gray-300 truncate flex-1 cursor-pointer pointer-events-none",children:d})]},i)})})]})}const q=p.forwardRef(({className:t,variant:r="primary",size:s="md",isLoading:n,leftIcon:a,rightIcon:o,children:i,disabled:l,...c},d)=>{const u={primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg shadow-blue-500/30 border border-transparent",secondary:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 border border-transparent",danger:"bg-red-500 hover:bg-red-600 text-white shadow-md shadow-red-500/30 border border-transparent",ghost:"bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",outline:"bg-transparent border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",premium:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/40 border border-transparent"},g={sm:"text-xs px-3 py-1.5 rounded-lg gap-1.5",md:"text-sm px-4 py-2 rounded-lg gap-2",lg:"text-base px-6 py-3 rounded-xl gap-2.5",icon:"p-2 rounded-full aspect-square flex items-center justify-center"};return e.jsxs("button",{ref:d,className:_("flex items-center justify-center font-bold transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100",u[r],g[s],t),disabled:l||n,...c,children:[n&&e.jsx(Js,{className:"-ml-1 text-currentColor",size:16}),!n&&a,i,!n&&o]})});q.displayName="Button";const Ce=p.forwardRef(({className:t,label:r,error:s,leftIcon:n,rightIcon:a,containerClassName:o,id:i,...l},c)=>{const d=p.useId(),u=i||d;return e.jsxs("div",{className:_("flex flex-col gap-1.5",o),children:[r&&e.jsx("label",{htmlFor:u,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:r}),e.jsxs("div",{className:"relative group",children:[n&&e.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:n}),e.jsx("input",{ref:c,id:u,className:_("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-2.5 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 group-hover:border-gray-300 dark:group-hover:border-gray-600",n&&"pl-10",a&&"pr-10",t),"aria-invalid":!!s,"aria-describedby":s?`${u}-error`:void 0,...l}),a&&e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:a})]}),s&&e.jsx("p",{id:`${u}-error`,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]})});Ce.displayName="Input";const xt="none",yo=t=>{const r=Zt(t);return{project:r.projects,timeblock:r.timeBlocks.map(s=>s==="null"||s==="none"?xt:s),duration:r.durations.map(s=>s.toString()),date:r.dates}},ko=[30,45,60,75,90],vo=({isOpen:t,data:r,zIndex:s,overlayClassName:n})=>{const{t:a}=B(),{closeModal:o}=G(),i=!!t,l=r,c=!!(l!=null&&l.id),{projects:d}=lt(),{timeBlocks:u}=Oe(),{workspaceId:g}=ne(),[f,y]=p.useState(""),[m,h]=p.useState({project:[],timeblock:[],duration:[],date:[]}),[v,j]=p.useState(!1),[x,k]=p.useState(null),E=U.useRef(null);p.useEffect(()=>{i&&(y((l==null?void 0:l.name)||""),h(yo((l==null?void 0:l.query)||"")),k(null),j(!1))},[i,l]),p.useEffect(()=>{var T;x&&((T=E.current)==null||T.focus())},[x]);const D=(T,b)=>{h(A=>{const M=A[T],$=M.includes(b)?M.filter(V=>V!==b):[...M,b];return{...A,[T]:$}})},F=p.useCallback(async()=>{const T=f.trim();if(!T){k(a("validation.filter_name_required"));return}const b=en({projects:m.project,timeBlocks:m.timeblock.map(A=>A===xt?"null":A),durations:m.duration.map(Number),dates:m.date});if(!b){k(a("validation.filter_condition_required"));return}j(!0),k(null);try{if(!g){k(a("validation.workspace_required")),j(!1);return}const A={name:T,query:b,type:"custom"};c&&(l!=null&&l.id)?await jn(g,l.id,A):await vn({...A,workspaceId:g}),o()}catch(A){k(a("validation.save_fail")+": "+(A.message||"Error")),j(!1)}},[f,m,c,l,o,a]),C=T=>{T.key==="Enter"&&!T.nativeEvent.isComposing&&(!v&&f.trim()&&F(),T.preventDefault())};return i?e.jsx(je,{isOpen:i,onClose:o,title:a(c?"modal.edit":"modal.create"),size:"xl",className:"w-full h-[90vh] sm:h-auto",zIndex:s,overlayClassName:n,children:e.jsxs("div",{className:"space-y-6",children:[e.jsx("div",{children:e.jsx(Ce,{ref:E,id:"filter-name-input",name:"filterName",label:a("filter"),type:"text",value:f,onChange:T=>y(T.target.value),onKeyDown:C,placeholder:a("modal.filter_name_placeholder"),autoFocus:!0})}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[e.jsx(gt,{title:a("project"),items:d,selectedItems:m.project,onToggle:T=>D("project",T)}),e.jsx(gt,{title:a("timeblock"),items:[...u,{id:xt,name:a("sidebar.unassigned")}],selectedItems:m.timeblock,onToggle:T=>D("timeblock",T),labelFn:T=>T.id===xt||!T.start?T.name:`${T.start}-${T.end}`}),e.jsx(gt,{title:a("modal.duration"),items:ko.map(T=>({id:T.toString(),name:`${T} min`})),selectedItems:m.duration,onToggle:T=>D("duration",T)}),e.jsx(gt,{title:a("modal.due_date"),items:[{id:"today",name:a("date_options.today")},{id:"tomorrow",name:a("date_options.tomorrow")},{id:"week",name:a("date_options.week")},{id:"next-week",name:a("date_options.next_week")}],selectedItems:m.date,onToggle:T=>D("date",T)})]}),e.jsx(Xe,{message:x}),e.jsxs("div",{className:"flex justify-end gap-3 pt-4 border-t border-gray-100 dark:border-gray-700",children:[e.jsx(q,{onClick:o,disabled:v,variant:"ghost",className:"text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",children:a("modal.cancel")}),e.jsx(q,{onClick:F,disabled:v,isLoading:v,variant:"primary",children:v?"...":a(c?"modal.save":"modal.create")})]})]})}):null},jo=({isOpen:t,data:r,zIndex:s,overlayClassName:n})=>{const{t:a}=B(),{closeModal:o,openModal:i}=G(),l=!!t,c=r,d=!!(c!=null&&c.id),{workspaceId:u}=ne(),[g,f]=p.useState(""),[y,m]=p.useState("#42A5F5"),[h,v]=p.useState(!1),[j,x]=p.useState(null),k=U.useRef(null);p.useEffect(()=>{l&&(f((c==null?void 0:c.name)||""),m((c==null?void 0:c.color)||ye[Math.floor(Math.random()*ye.length)].value),x(null),v(!1))},[l,c]),p.useEffect(()=>{var C;j&&((C=k.current)==null||C.focus())},[j]);const E=p.useCallback(async()=>{const C=g.trim();if(!C){x(a("validation.label_name_required"));return}v(!0),x(null);try{if(!u){x(a("validation.label_workspace_required")),v(!1);return}d&&(c!=null&&c.id)?await Fn(u,c.id,{name:C,color:y}):await An(u,C,y),o()}catch(T){x(a("validation.save_fail")+": "+(T.message||"Error")),v(!1)}},[g,y,d,c,o,a]),D=p.useCallback(async()=>{c!=null&&c.id&&i("confirmation",{title:a("delete"),message:a("modal.label_delete_confirm").replace("{name}",c.name),confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{v(!0);try{u&&(c!=null&&c.id)&&await Bn(u,c.id),o()}catch{x(a("validation.delete_fail")),v(!1)}}})},[c,o,i,u,a]),F=C=>{C.key==="Enter"&&!C.nativeEvent.isComposing&&(!h&&g.trim()&&E(),C.preventDefault())};return l?e.jsx(je,{isOpen:l,onClose:o,className:"max-w-sm",zIndex:s,overlayClassName:n,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full flex-shrink-0 border-2 border-gray-100 dark:border-gray-700 shadow-sm",style:{backgroundColor:y}}),e.jsx("div",{className:"flex-1",children:e.jsx(Ce,{ref:k,id:"label-name-input",name:"labelName",type:"text",label:a("modal.label_name"),value:g,onChange:C=>f(C.target.value),onKeyDown:F,placeholder:a(d?"modal.label_name_placeholder":"modal.label_create_placeholder"),className:"bg-transparent border-none text-lg font-bold p-0 focus:ring-0 focus:border-transparent px-0 py-0 rounded-none h-auto",containerClassName:"gap-0",autoFocus:!0,"aria-invalid":!!j,"aria-describedby":j?"label-error-msg":void 0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2",children:a("modal.theme_color")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ye.map(C=>e.jsx("button",{type:"button",onClick:()=>m(C.value),className:_("w-6 h-6 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",y===C.value?"ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-gray-800":""),style:{backgroundColor:C.value},"aria-label":a(`colors.${C.key}`),"aria-pressed":y===C.value},C.value))})]}),e.jsx(Xe,{message:j}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center gap-2",children:d&&e.jsx(q,{onClick:D,disabled:h,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20","aria-label":a("modal.delete_label"),title:a("modal.delete_label"),children:e.jsx(De,{size:20})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{onClick:o,disabled:h,variant:"ghost",children:a("modal.cancel")}),e.jsx(q,{onClick:E,disabled:h||!g.trim(),isLoading:h,variant:"primary",children:a(d?"modal.save":"modal.create")})]})]})]})}):null},wo=({isOpen:t,data:r,zIndex:s,overlayClassName:n})=>{const{t:a}=B(),{closeModal:o,openModal:i}=G(),{currentWorkspaceId:l}=Ge(),c=!!t,d=r,u=!!(d!=null&&d.id),[g,f]=p.useState(""),[y,m]=p.useState("#7E57C2"),[h,v]=p.useState(!1),[j,x]=p.useState(null),k=U.useRef(null);p.useEffect(()=>{c&&(f((d==null?void 0:d.name)||""),m((d==null?void 0:d.color)||ye[3].value),x(null),v(!1))},[c,d]),p.useEffect(()=>{var C;j&&((C=k.current)==null||C.focus())},[j]);const E=p.useCallback(async()=>{const C=g.trim();if(!C){x(a("validation.project_name_required"));return}if(!l&&!u){x(a("validation.workspace_required"));return}v(!0),x(null);try{u&&(d!=null&&d.id)?await Pa(d.id,{name:C,color:y}):l&&await Oa(C,l,y),o()}catch(T){x(a("validation.save_fail")+": "+(T.message||"Error")),v(!1)}},[g,y,u,d,l,o,a]),D=p.useCallback(async()=>{d!=null&&d.id&&i("confirmation",{title:a("delete"),message:a("modal.project_delete_confirm").replace("{name}",d.name),confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{v(!0);try{await Br(d.id),o()}catch{x(a("validation.delete_fail")),v(!1)}}})},[d,o,i,a]),F=C=>{C.key==="Enter"&&!C.nativeEvent.isComposing&&(!h&&g.trim()&&E(),C.preventDefault())};return c?e.jsx(je,{isOpen:c,onClose:o,size:"sm",zIndex:s,overlayClassName:n,children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex items-center justify-center w-8 h-8 rounded-lg bg-gray-100 dark:bg-gray-800 text-gray-500 shrink-0",children:e.jsx(Nr,{size:20})}),e.jsx("div",{className:"flex-1",children:e.jsx(Ce,{ref:k,id:"project-name-input",name:"projectName",type:"text",label:a("modal.project_name"),value:g,onChange:C=>f(C.target.value),onKeyDown:F,placeholder:a("modal.project_name_placeholder"),className:"bg-transparent border-none text-lg font-bold p-0 focus:ring-0 focus:border-transparent px-0 py-0 rounded-none h-auto",containerClassName:"gap-0",autoFocus:!0,"aria-describedby":j?"project-error-msg":void 0})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2",children:a("modal.theme_color")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:ye.map(C=>e.jsx("button",{type:"button",onClick:()=>m(C.value),className:_("w-6 h-6 rounded-full focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 dark:focus:ring-offset-gray-800",y===C.value?"ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-gray-800":""),style:{backgroundColor:C.value},"aria-label":a(`colors.${C.key}`),"aria-pressed":y===C.value},C.value))})]}),e.jsx(Xe,{message:j,id:"project-error-msg"}),e.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700",children:[e.jsx("div",{className:"flex items-center gap-2",children:u&&e.jsx(q,{onClick:D,disabled:h,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20","aria-label":a("modal.delete_project"),title:a("modal.delete_project"),children:e.jsx(De,{size:20})})}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(q,{onClick:o,disabled:h,variant:"ghost",children:a("modal.cancel")}),e.jsx(q,{onClick:E,disabled:h,isLoading:h,variant:"primary",children:a(u?"modal.save":"modal.create")})]})]})]})}):null},Ze=({title:t,children:r,defaultOpen:s=!1,icon:n,className:a})=>{const[o,i]=p.useState(s);return e.jsxs("section",{className:_("border border-gray-200 dark:border-gray-700/50 rounded-xl overflow-hidden",a),children:[e.jsxs("button",{onClick:()=>i(!o),className:"w-full flex items-center justify-between p-4 bg-gray-50/50 dark:bg-gray-800/30 hover:bg-gray-50 dark:hover:bg-gray-800/50 transition-colors text-left",type:"button","aria-expanded":o,"aria-controls":`accordion-panel-${t.replace(/\s+/g,"-").toLowerCase()}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[n&&e.jsx("span",{className:"text-lg",children:n}),e.jsx("h4",{className:"font-bold text-sm text-gray-800 dark:text-gray-200",children:t})]}),e.jsx("svg",{className:_("w-4 h-4 text-gray-400 transition-transform duration-200",o&&"rotate-180"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 9l-7 7-7-7"})})]}),e.jsx("div",{id:`accordion-panel-${t.replace(/\s+/g,"-").toLowerCase()}`,className:_("transition-all duration-100 ease-in-out overflow-hidden bg-white dark:bg-transparent",o?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"),children:e.jsx("div",{className:"p-4 border-t border-gray-100 dark:border-gray-700/30",children:r})})]})},me=p.forwardRef(({className:t,label:r,error:s,containerClassName:n,options:a,children:o,id:i,...l},c)=>e.jsxs("div",{className:_("flex flex-col gap-1.5",n),children:[r&&e.jsx("label",{htmlFor:i,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:r}),e.jsxs("div",{className:"relative group",children:[e.jsx("select",{ref:c,id:i,className:_("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl pl-4 pr-10 py-2.5 outline-none transition-all appearance-none cursor-pointer placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 text-gray-500 hover:border-gray-300 dark:hover:border-gray-600",t),"aria-invalid":!!s,"aria-describedby":s&&i?`${i}-error`:void 0,...l,children:o||(a==null?void 0:a.map(d=>e.jsx("option",{value:d.value,children:d.label},d.value)))}),e.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",children:e.jsx(Gt,{size:16})})]}),s&&e.jsx("p",{id:i?`${i}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]}));me.displayName="Select";const No=()=>{const{t}=B(),{user:r}=Jt(),{openModal:s}=G(),[n,a]=p.useState(""),[o,i]=p.useState(""),[l,c]=p.useState(!1),[d,u]=p.useState(!1),[g,f]=p.useState(null);if(!r)return e.jsx("div",{className:"text-center text-gray-500",children:t("settings_modal.account.not_logged_in")});const y=r.isAnonymous,m=async v=>{v.preventDefault(),u(!0),f(null);try{const j=Es.credential(n,o);await Is(r,j),S.success(t("settings_modal.account.register_success"))}catch(j){console.error("Link account error:",j);let x=t("settings_modal.account.register_fail");j.code==="auth/email-already-in-use"&&(x=t("settings_modal.account.already_in_use")),j.code==="auth/weak-password"&&(x=t("settings_modal.account.weak_password")),f(x)}finally{u(!1)}},h=()=>{s("confirmation",{title:t("settings_modal.account.logout"),message:t("settings_modal.account.logout_confirm"),confirmLabel:t("settings_modal.account.logout"),variant:"danger",onConfirm:async()=>{await vr(R),window.location.reload()}})};return e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-800/50 rounded-2xl p-6 flex flex-col sm:flex-row items-center gap-8 sm:gap-6 border border-gray-100 dark:border-gray-700",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-blue-100 dark:bg-blue-900/50 flex items-center justify-center text-3xl shrink-0",children:y?"ðŸ•µï¸":"ðŸ‘¤"}),e.jsxs("div",{className:"flex-1 text-center sm:text-left",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900 dark:text-white mb-1",children:y?t("settings_modal.account.guest_user"):r.displayName||t("settings_modal.account.registered_user")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 font-mono mb-4 break-all",children:y?`ID: ${r.uid.slice(0,8)}...`:r.email}),!y&&e.jsx("button",{onClick:h,className:"text-red-500 hover:text-red-600 dark:text-red-400 dark:hover:text-red-300 text-sm font-bold px-4 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors border border-transparent hover:border-red-100 dark:hover:border-red-900/30",children:t("settings_modal.account.logout")})]})]}),y?e.jsxs("div",{className:"border border-blue-200 dark:border-blue-800 bg-blue-50/50 dark:bg-blue-900/10 rounded-2xl p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10",children:e.jsx("svg",{className:"w-32 h-32 text-blue-500",fill:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"})})}),e.jsxs("div",{className:"relative",children:[e.jsxs("h4",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ”"})," ",t("settings_modal.account.persist_account")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-6 leading-relaxed whitespace-pre-wrap",children:t("settings_modal.account.persist_desc")}),e.jsxs("form",{onSubmit:m,className:"space-y-4 max-w-md",children:[g&&e.jsx("div",{className:"p-3 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-lg font-medium",children:g}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"account-email",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1.5 uppercase tracking-wider",children:t("settings_modal.account.email_label")}),e.jsx("input",{id:"account-email",type:"email",required:!0,value:n,onChange:v=>a(v.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 outline-none transition-all",placeholder:"mail@example.com",autoComplete:"email"})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"account-password",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-1.5 uppercase tracking-wider",children:t("settings_modal.account.password_label")}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"account-password",type:l?"text":"password",required:!0,minLength:6,value:o,onChange:v=>i(v.target.value),className:"w-full px-4 py-3 rounded-xl border border-gray-200 dark:border-gray-700 bg-white dark:bg-gray-800 focus:ring-2 focus:ring-blue-500 outline-none transition-all pr-12",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",autoComplete:"new-password"}),e.jsx("button",{type:"button",onClick:()=>c(!l),className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 focus:outline-none p-1","aria-label":t(l?"settings_modal.account.hide_password":"settings_modal.account.show_password"),children:l?e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"})}):e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})]})})]})]}),e.jsx("button",{type:"submit",disabled:d,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-xl transition-colors flex items-center justify-center gap-2",children:d?t("settings_modal.account.registering"):e.jsxs(e.Fragment,{children:[t("settings_modal.account.register"),e.jsx("span",{children:"â†’"})]})})]})]})]}):e.jsx("div",{className:"text-center py-8 text-gray-400",children:e.jsx("p",{children:t("settings_modal.account.registered_msg")})})]})},mt=({active:t,onClick:r,label:s,icon:n})=>e.jsxs("button",{onClick:r,className:_("flex items-center gap-2 px-4 py-2 text-sm rounded-lg transition-all whitespace-nowrap min-w-0","md:w-full md:justify-start md:text-left md:py-2","flex-col w-full justify-center py-3 text-[10px] gap-1 rounded-none md:rounded-lg md:text-sm md:flex-row md:gap-3",t?"bg-white dark:bg-gray-800 shadow-sm text-blue-600 dark:text-blue-400 font-bold border-t-2 md:border-t-0 md:border md:border-gray-100 dark:md:border-gray-700 border-blue-500 md:border-transparent":"text-gray-600 dark:text-gray-400 hover:bg-gray-50 dark:hover:bg-gray-700/50 hover:text-gray-900 dark:hover:text-gray-200 border-t-2 md:border-t-0 border-transparent"),children:[e.jsx("span",{className:"text-lg md:text-base",children:n}),e.jsx("span",{className:"truncate font-medium",children:s})]}),_o=({isOpen:t,zIndex:r,overlayClassName:s})=>{const{t:n}=B(),{closeModal:a,openModal:o}=G(),{themeMode:i,setThemeMode:l,density:c,setDensity:d,fontSize:u,setFontSize:g,fontEn:f,setFontEn:y,fontJp:m,setFontJp:h,language:v,setLanguage:j}=X(),{currentWorkspaceId:x}=Ge(),{addToast:k}=et(),[E,D]=p.useState("appearance"),[F,C]=p.useState(!1),T=!!t;return e.jsx(je,{isOpen:T,onClose:a,title:n("settings_modal.title"),className:"w-full h-full p-0 overflow-hidden",zIndex:r,size:"xl",variant:"side-right",overlayClassName:s,children:e.jsxs("div",{className:"flex flex-col md:flex-row h-full",children:[e.jsx("div",{className:"order-last md:order-first w-full md:w-64 bg-white dark:bg-gray-900 md:bg-gray-50/50 md:dark:bg-gray-900/50 border-t md:border-t-0 md:border-r border-gray-200 dark:border-gray-700 shrink-0 z-10",children:e.jsxs("div",{className:"flex flex-row md:flex-col justify-around md:justify-start md:p-4 md:space-y-2 pb-safe md:pb-4",children:[e.jsx(mt,{active:E==="general",onClick:()=>D("general"),label:n("settings_modal.tabs.general"),icon:"âš™ï¸"}),e.jsx(mt,{active:E==="appearance",onClick:()=>D("appearance"),label:n("settings_modal.tabs.appearance"),icon:"ðŸŽ¨"}),e.jsx(mt,{active:E==="account",onClick:()=>D("account"),label:n("settings_modal.tabs.account"),icon:"ðŸ‘¤"}),e.jsx(mt,{active:E==="advanced",onClick:()=>D("advanced"),label:n("settings_modal.tabs.advanced"),icon:"âš¡"})]})}),e.jsxs("div",{className:"flex-1 p-4 md:p-8 overflow-y-auto custom-scrollbar bg-white dark:bg-gray-900 order-first md:order-last relative",children:[E==="appearance"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Ze,{title:n("settings_modal.appearance.theme"),icon:"ðŸŒ“",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-3 gap-3",children:["light","dark","system"].map(b=>e.jsx("button",{onClick:()=>l(b),className:_("p-3 border rounded-xl text-sm font-medium transition-all",i===b?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:e.jsx("span",{className:"capitalize",children:n(`settings_modal.options.theme.${b}`)})},b))})}),e.jsx(Ze,{title:n("settings_modal.appearance.density"),icon:"ðŸ“",defaultOpen:!1,children:e.jsx("div",{className:"space-y-3",children:["compact","normal","comfortable","spacious"].map(b=>e.jsxs("label",{htmlFor:`density-${b}`,className:_("flex items-center gap-3 p-3 rounded-lg border cursor-pointer transition-colors",c===b?"border-blue-500 bg-blue-50 dark:bg-blue-900/10":"border-transparent hover:bg-white dark:hover:bg-gray-800"),children:[e.jsx("div",{className:_("w-4 h-4 rounded-full border flex items-center justify-center",c===b?"border-blue-500 bg-blue-500":"border-gray-300"),children:c===b&&e.jsx("div",{className:"w-1.5 h-1.5 bg-white rounded-full"})}),e.jsx("input",{id:`density-${b}`,type:"radio",name:"density",checked:c===b,onChange:()=>d(b),className:"hidden"}),e.jsx("span",{className:"capitalize text-sm font-medium text-gray-700 dark:text-gray-300",children:n(`settings_modal.options.density.${b}`)})]},b))})}),e.jsx(Ze,{title:n("settings_modal.appearance.font_size"),icon:"Aa",defaultOpen:!1,children:e.jsx("div",{className:"flex items-center gap-2 bg-gray-100 dark:bg-gray-800 p-1 rounded-lg",children:["sm","base","md","lg","xl"].map(b=>e.jsx("button",{onClick:()=>g(b),className:_("flex-1 py-1.5 px-3 rounded text-sm font-medium transition-all",u===b?"bg-white dark:bg-gray-700 text-gray-900 dark:text-white shadow-sm":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300"),children:b},b))})}),e.jsxs(Ze,{title:n("settings_modal.appearance.fonts"),icon:"Tt",defaultOpen:!1,children:[e.jsx(me,{id:"settings-font-en",name:"fontEn",label:n("settings_modal.appearance.font_en"),value:f,onChange:b=>y(b.target.value),options:O.FONTS.EU}),e.jsx(me,{id:"settings-font-jp",name:"fontJp",label:n("settings_modal.appearance.font_jp"),value:m,onChange:b=>h(b.target.value),options:O.FONTS.JP})]})]}),E==="general"&&e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 p-4 rounded-xl border border-blue-100 dark:border-blue-800",children:[e.jsxs("h4",{className:"font-bold text-gray-900 dark:text-white mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ’¾"})," ",n("settings_modal.backup.title")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-300 mb-4",children:n("settings_modal.backup.description")}),e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center gap-3",children:[e.jsx(q,{onClick:async()=>{if(!(!R.currentUser||!x))try{const b=await dn(R.currentUser.uid,x),A=new Blob([JSON.stringify(b,null,2)],{type:"application/json"}),M=URL.createObjectURL(A),$=document.createElement("a");$.href=M,$.download=`taskmg-backup-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild($),$.click(),document.body.removeChild($),URL.revokeObjectURL(M),k(n("settings_modal.backup.create_success"),"success")}catch(b){console.error(b),k(n("settings_modal.backup.create_fail"),"error")}},variant:"premium",leftIcon:e.jsx(tt,{className:"w-4 h-4"}),className:"w-full sm:w-auto",children:n("settings_modal.backup.create")}),e.jsxs("div",{className:"relative w-full sm:w-auto",children:[e.jsx("input",{type:"file",accept:".json",className:"hidden",id:"backup-import-input",onChange:b=>{var M;const A=(M=b.target.files)==null?void 0:M[0];!A||!R.currentUser||!x||(b.target.value="",o("confirmation",{title:n("settings_modal.backup.import"),message:n("settings_modal.backup.import_confirm"),confirmLabel:n("modal.ok"),variant:"danger",onConfirm:()=>{const $=new FileReader;$.onload=async V=>{var Z;try{const J=JSON.parse((Z=V.target)==null?void 0:Z.result),Te=await un(R.currentUser.uid,x,J);k(n("settings_modal.backup.import_success").replace("{tasks}",String(Te.tasksCount)).replace("{projects}",String(Te.projectsCount)),"success"),setTimeout(()=>{window.location.reload()},1e3)}catch(J){console.error(J),k(n("settings_modal.backup.import_fail"),"error")}},$.readAsText(A)}}))}}),e.jsxs("label",{htmlFor:"backup-import-input",className:"w-full sm:w-auto px-4 py-2 bg-white dark:bg-gray-800 text-gray-700 dark:text-gray-300 font-bold rounded-xl border border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700 cursor-pointer shadow-sm text-sm flex items-center justify-center gap-2 transition-colors",children:[e.jsx(tt,{className:"w-4 h-4"}),n("settings_modal.backup.import")]})]})]})]}),e.jsx(Ze,{title:n("settings_modal.language.title"),icon:"ðŸŒ",defaultOpen:!1,children:e.jsx("div",{className:"grid grid-cols-2 gap-3",children:[{code:"ja",label:"æ—¥æœ¬èªž"},{code:"en",label:"English"}].map(b=>e.jsxs("button",{onClick:()=>j(b.code),className:_("p-3 border rounded-xl text-sm font-medium transition-all",v===b.code?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 ring-2 ring-blue-200 dark:ring-blue-800":"border-gray-200 dark:border-gray-700 hover:bg-white dark:hover:bg-gray-800 bg-white dark:bg-gray-900 text-gray-600 dark:text-gray-400"),children:[e.jsx("span",{className:"text-xl mr-2",children:b.code==="ja"?"ðŸ‡¯ðŸ‡µ":"ðŸ‡ºðŸ‡¸"}),b.label]},b.code))})})]}),E==="account"&&e.jsx(No,{}),E==="advanced"&&e.jsx("div",{className:"flex flex-col gap-4",children:e.jsxs("div",{className:"bg-red-50 dark:bg-red-900/10 p-4 rounded-xl border border-red-100 dark:border-red-900/30",children:[e.jsxs("h4",{className:"font-bold text-red-700 dark:text-red-400 mb-2 flex items-center gap-2",children:[e.jsx("span",{children:"ðŸ§¹"})," ",n("settings_modal.maintenance.title")]}),e.jsx("p",{className:"text-sm text-red-600/80 dark:text-red-400/80 mb-4",children:n("settings_modal.maintenance.description")}),e.jsxs("label",{htmlFor:"backup-confirm-checkbox",className:"flex items-center gap-2 mb-4 cursor-pointer",children:[e.jsx("input",{id:"backup-confirm-checkbox",name:"backupConfirmed",type:"checkbox",className:"w-4 h-4 text-red-600 rounded border-red-300 focus:ring-red-500",checked:F,onChange:b=>C(b.target.checked)}),e.jsx("span",{className:"text-sm font-bold text-red-700 dark:text-red-400",children:n("settings_modal.maintenance.confirm_backup")})]}),e.jsx(q,{onClick:()=>{x&&o("confirmation",{title:n("settings_modal.maintenance.title"),message:n("settings_modal.maintenance.confirm_final"),confirmLabel:n("settings_modal.maintenance.cleanup_duplicate"),variant:"danger",onConfirm:async()=>{try{const b=await Rn(x);k(n("settings_modal.maintenance.cleanup_success").replace("{count}",String(b)),"success"),b>0&&setTimeout(()=>{window.location.reload()},1e3)}catch(b){console.error(b),k(n("settings_modal.maintenance.cleanup_fail").replace("{error}",b.message),"error")}}})},disabled:!F,variant:"danger",children:n("settings_modal.maintenance.cleanup_duplicate")})]})})]})]})})},Co={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};function So(t){return t.replace(/[&<>"']/g,r=>Co[r]||r)}function Do(t){if(!t)return"";const r=t.split(`
`);let s=[],n=null;return r.forEach(a=>{const o=a.trimStart(),i=o.startsWith("* ")||o.startsWith("- "),l=/^\d+\.\s/.test(o),c=i||l;if(c){const d=l?"ol":"ul";if(n!==d){n&&s.push(`</${n}>`);const u=l?"list-decimal":"list-disc";s.push(`<${d} class="${u} ml-5 space-y-1">`),n=d}}else n&&(s.push(`</${n}>`),n=null);if(c){let d="";i?d=o.substring(2):d=o.replace(/^\d+\.\s/,"");const u=Tt(d);s.push(`<li>${u}</li>`)}else if(a.trim()){const d=a.match(/^(#{1,6})\s+(.+)$/);if(d){const u=d[1].length,g=Tt(d[2]),f={1:"text-2xl font-bold mb-3",2:"text-xl font-bold mb-2",3:"text-lg font-semibold mb-2",4:"text-base font-semibold mb-1",5:"text-sm font-semibold mb-1",6:"text-xs font-semibold mb-1"};s.push(`<h${u} class="${f[u]}">${g}</h${u}>`)}else s.push(`<p class="mb-2">${Tt(a)}</p>`)}else n&&(s.push(`</${n}>`),n=null)}),n&&s.push(`</${n}>`),s.join(`
`)}function Tt(t){return So(t).replace(/\[(.*?)\]\((.*?)\)/g,(s,n,a)=>`<a href="${a.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${n}</a>`)}const rr=p.forwardRef(({className:t,label:r,error:s,containerClassName:n,id:a,...o},i)=>e.jsxs("div",{className:_("flex flex-col gap-1.5 h-full",n),children:[r&&e.jsx("label",{htmlFor:a,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:r}),e.jsx("textarea",{ref:i,id:a,className:_("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-3 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600 resize-none","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",s?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",t),"aria-invalid":!!s,"aria-describedby":s&&a?`${a}-error`:void 0,...o}),s&&e.jsx("p",{id:a?`${a}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:s})]}));rr.displayName="Textarea";const lr={TODO:"todo"},To=({isOpen:t,data:r,zIndex:s,overlayClassName:n})=>{const{t:a}=B(),{closeModal:o,openModal:i}=G(),l=!!t,c=r,d=!(c!=null&&c.id)||c.id.startsWith("temp-"),{projects:u}=lt(),{timeBlocks:g}=Oe(),{customDurations:f}=X(),[y,m]=p.useState(""),[h,v]=p.useState(""),[j,x]=p.useState(null),[k,E]=p.useState(lr.TODO),[D,F]=p.useState(!1),[C,T]=p.useState(null),[b,A]=p.useState({type:"none",days:[]}),[M,$]=p.useState(null),[V,Z]=p.useState(null),[J,Te]=p.useState(!1),[ct,sr]=p.useState(!1),Zr=p.useMemo(()=>[{value:"none",label:a("recurrence.none")},{value:"daily",label:a("recurrence.daily")},{value:"weekdays",label:a("recurrence.weekdays")},{value:"weekly",label:a("recurrence.weekly")},{value:"monthly",label:a("recurrence.monthly")}],[a]),es=p.useMemo(()=>[a("days.sun"),a("days.mon"),a("days.tue"),a("days.wed"),a("days.thu"),a("days.fri"),a("days.sat")],[a]),[ts,Pe]=p.useState(null);p.useEffect(()=>{var N;if(c){m(c.title||""),v(c.description||""),x(c.projectId||null),E(c.status||lr.TODO),F(!!c.isImportant),$(c.timeBlockId||null),Z(c.duration||null);const z=Y(c.dueDate);T(z);const se=c.recurrence||{type:"none",days:[]};A(se),se!=null&&se.type&&se.type!=="none"&&!z&&T(ro(se));const Qe=!!(z||(se==null?void 0:se.type)!=="none"||c.timeBlockId||c.duration);sr(Qe||d),Te(!!((N=c.description)!=null&&N.trim()))}},[c,l]);const St=p.useCallback(async()=>{if(Pe(null),!y.trim()){Pe(a("validation.required"));return}if((b==null?void 0:b.type)==="weekly"&&(!b.days||b.days.length===0)){Pe(a("validation.select_days"));return}const N={title:y.trim(),description:h.trim()??null,projectId:j==="none"?null:j,status:k,isImportant:D,dueDate:C?Ve.fromDate(C):null,recurrence:(b==null?void 0:b.type)==="none"?null:b,timeBlockId:M??null,duration:V??void 0};try{d?await Ur(N):await ft(c.id,N),o()}catch(z){console.error("Failed to save task",z),Pe(a("validation.save_fail"))}},[y,h,j,k,D,C,b,M,V,d,c,o,a]),rs=p.useCallback(async N=>{N==null||N.preventDefault(),N==null||N.stopPropagation(),Pe(null),!(!(c!=null&&c.id)||d)&&(!(c!=null&&c.id)||d||i("confirmation",{title:a("delete"),message:a("modal.delete_confirm"),confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{try{await Kr(c.id),o()}catch(z){console.error("Failed to delete task",z),Pe(a("validation.delete_fail"))}}}))},[c==null?void 0:c.id,d,o,i,a]),ss=p.useCallback(N=>{let z=[];N==="weekly"?z=(b==null?void 0:b.days)||[]:N==="weekdays"&&(z=[1,2,3,4,5]),A({type:N,days:z})},[b==null?void 0:b.days]),as=p.useCallback(N=>{const z=(b==null?void 0:b.days)||[],se=z.includes(N)?z.filter(Qe=>Qe!==N):[...z,N].sort((Qe,ls)=>Qe-ls);A({type:"weekly",days:se})},[b==null?void 0:b.days]),ns=p.useMemo(()=>Do(h),[h]),os=N=>{N.key==="Enter"&&!N.nativeEvent.isComposing&&(N.preventDefault(),St())},is=N=>{(N.metaKey||N.ctrlKey)&&N.key==="Enter"&&(N.preventDefault(),St())};return l?e.jsx(je,{isOpen:l,onClose:o,zIndex:s,size:"xl",className:"h-[95vh] sm:h-[85vh] w-full mx-2 sm:mx-auto mt-4 sm:mt-0 pb-safe",overlayClassName:n,children:e.jsxs("div",{className:"flex flex-col h-full",onKeyDown:is,children:[e.jsxs("div",{className:"px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex items-center gap-3 shrink-0",children:[e.jsx("div",{className:"flex-1",children:e.jsx(Ce,{id:"task-title",name:"title",type:"text",value:y,onChange:N=>m(N.target.value),onKeyDown:os,placeholder:a("task_detail.title_placeholder"),className:"text-xl font-bold bg-transparent border-none focus:ring-0 px-0 py-0 shadow-none h-auto rounded-none",containerClassName:"gap-0",autoFocus:!0,"aria-label":a("task_detail.title_placeholder")})}),e.jsx(q,{onClick:()=>F(!D),variant:"ghost",size:"icon",className:_("transition-colors",D?"text-yellow-500 bg-yellow-50 dark:bg-yellow-900/20 hover:bg-yellow-100 dark:hover:bg-yellow-900/30":"text-gray-400"),title:D?"é‡è¦åº¦ã‚’è§£é™¤":"é‡è¦ã¨ã—ã¦ãƒžãƒ¼ã‚¯",children:e.jsx(wt,{className:"w-6 h-6",fill:D?"currentColor":"none"})}),e.jsx(q,{onClick:o,variant:"ghost",size:"icon",className:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300","aria-label":"é–‰ã˜ã‚‹",children:e.jsx(zs,{className:"w-6 h-6"})})]}),e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 custom-scrollbar",children:[e.jsx(Xe,{message:ts,className:"mb-3"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-12 gap-4 h-full",children:[e.jsxs("div",{className:"md:col-span-8 flex flex-col h-full min-h-[300px] bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsxs("label",{className:"text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase",children:[e.jsx(Nr,{size:16}),"ãƒ¡ãƒ¢ (Markdown)"]}),e.jsx(q,{type:"button",onClick:()=>Te(!J),size:"sm",variant:"ghost",className:"text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 font-medium h-auto py-1 px-3","aria-label":J?"ç·¨é›†ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ":"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ãˆ",children:J?"ç·¨é›†":"ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"})]}),e.jsx("div",{className:"flex-1 relative",children:J?e.jsx("div",{className:"w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm overflow-y-auto prose prose-sm dark:prose-invert max-w-none",dangerouslySetInnerHTML:{__html:ns||'<span class="text-gray-400">ãƒ¡ãƒ¢ãŒã‚ã‚Šã¾ã›ã‚“</span>'}}):e.jsx(rr,{id:"task-description",name:"description",value:h,onChange:N=>v(N.target.value),placeholder:"è©³ç´°ã‚’å…¥åŠ›...",className:"h-full bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono",containerClassName:"h-full",autoFocus:!h,"aria-label":"è©³ç´°ãƒ¡ãƒ¢"})})]}),e.jsxs("div",{className:"md:col-span-4 space-y-4",children:[e.jsxs("details",{open:ct,onToggle:N=>sr(N.currentTarget.open),className:"group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800",children:[e.jsxs("summary",{className:"flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50 focus:ring-2 focus:ring-inset focus:ring-blue-500",role:"button","aria-expanded":ct,children:[e.jsxs("span",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2",children:[e.jsx(st,{className:"text-blue-500",size:16}),a("task_detail.schedule_label")]}),e.jsx("span",{className:"transform group-open:rotate-180 transition-transform text-gray-400",children:e.jsx(Gt,{size:20})})]}),e.jsxs("div",{className:"p-4 flex flex-col gap-4",children:[e.jsx("div",{children:e.jsx("div",{className:"relative cursor-pointer",onClick:()=>{var z;const N=document.getElementById("task-due-date");(z=N==null?void 0:N.showPicker)==null||z.call(N)},children:e.jsx(Ce,{type:"date",id:"task-due-date",label:a("task_detail.due_date_label"),value:Qn(C),onChange:N=>T(Zn(N.target.value)),className:"cursor-pointer bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600"})})}),e.jsx("div",{children:e.jsx(me,{id:"task-recurrence",label:a("task_detail.recurrence_label"),value:(b==null?void 0:b.type)||"none",onChange:N=>ss(N.target.value),className:"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700",options:Zr})}),((b==null?void 0:b.type)==="weekly"||(b==null?void 0:b.type)==="weekdays")&&e.jsxs("div",{className:"pt-2 border-t border-gray-100 dark:border-gray-700 animate-in fade-in slide-in-from-top-1 duration-200",children:[e.jsx("span",{className:"block text-xs font-semibold text-gray-500 mb-2 uppercase",children:a("task_detail.recurrence_days")}),e.jsx("div",{className:"flex flex-wrap gap-2",children:es.map((N,z)=>{var se;return e.jsxs("label",{htmlFor:`recurrence-day-${z}`,className:"flex items-center gap-1 cursor-pointer select-none",children:[e.jsx("input",{id:`recurrence-day-${z}`,name:`recurrenceDay${z}`,type:"checkbox",checked:((se=b.days)==null?void 0:se.includes(z))||!1,onChange:()=>as(z),className:"w-4 h-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),e.jsx("span",{className:"text-xs text-gray-700 dark:text-gray-300",children:N})]},z)})})]}),e.jsx("div",{children:e.jsxs(me,{id:"task-timeblock",label:a("task_detail.time_block_label"),value:M||"",onChange:N=>$(N.target.value||null),className:"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700",children:[e.jsx("option",{value:"",children:a("task_detail.time_block_unspecified")}),g.map(N=>e.jsxs("option",{value:N.id,children:[N.start," - ",N.end]},N.id))]})}),e.jsx("div",{children:e.jsxs(me,{id:"task-duration",label:a("task_detail.duration_label"),value:V||"",onChange:N=>Z(N.target.value?parseInt(N.target.value,10):null),className:"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700",children:[e.jsx("option",{value:"",children:a("task_detail.duration_none")}),f.map(N=>e.jsxs("option",{value:N,children:[N," min"]},N))]})})]})]}),e.jsx("div",{className:"bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4",children:e.jsxs(me,{id:"task-project",label:a("task_detail.project_label"),value:j||"none",onChange:N=>x(N.target.value==="none"?null:N.target.value),className:"bg-gray-50 dark:bg-gray-900 border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",containerClassName:"gap-2",children:[e.jsx("option",{value:"none",children:a("task_detail.project_none")}),u.map(N=>e.jsx("option",{value:N.id,children:N.name},N.id))]})})]})]})]}),e.jsxs("div",{className:"px-4 py-3 border-t border-gray-200 dark:border-gray-700 flex justify-between items-center shrink-0",children:[!d&&e.jsx("div",{className:"flex items-center gap-2",children:e.jsx(q,{type:"button",onClick:rs,variant:"ghost",className:"text-red-600 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 px-4",leftIcon:e.jsx(De,{size:16}),children:a("task_detail.delete_button")})}),e.jsxs("div",{className:`flex gap-2 ${d?"ml-auto":""}`,children:[e.jsx(q,{type:"button",onClick:o,variant:"ghost",children:a("modal.cancel")}),e.jsx(q,{type:"button",onClick:St,variant:"primary",children:a(d?"modal.create":"modal.save")})]})]})]})}):null};class Mo extends p.Component{constructor(s){super(s);P(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(s){return{hasError:!0,error:s}}componentDidCatch(s,n){fa(s,n.componentStack??void 0)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const s=X.getState().language,{t:n}=fe(s);return e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:e.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[e.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:e.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),e.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:n("error_boundary.title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:n("error_boundary.description")}),e.jsxs("div",{className:"flex gap-3 justify-center",children:[e.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:n("error_boundary.retry")}),e.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:n("error_boundary.reload")})]}),!1]})})}return this.props.children}}const Eo=({children:t,containerId:r="portal-root"})=>{const s=document.getElementById(r)??document.body;return $t.createPortal(t,s)},Vr=()=>e.jsxs("div",{className:"space-y-2 p-2",children:[e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),e.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),Hr=({id:t,children:r})=>{const{attributes:s,listeners:n,setNodeRef:a,transform:o,transition:i,isDragging:l}=Ot({id:t}),c={transform:Pt.Transform.toString(o),transition:i,opacity:l?.5:1};return e.jsx("div",{ref:a,style:c,...s,...n,children:r})},cr=Array.from({length:24},(t,r)=>String(r).padStart(2,"0")).map(t=>({value:t,label:t})),dr=["00","15","30","45"].map(t=>({value:t,label:t})),Io=({isOpen:t,zIndex:r,overlayClassName:s})=>{const{t:n}=B(),{closeModal:a,openModal:o}=G(),i=!!t,{timeBlocks:l}=Oe(),{workspaceId:c}=ne(),[d,u]=p.useState([]),[g,f]=p.useState(!1),[y,m]=p.useState(null),[h,v]=p.useState(null),j=Wt(Ue(zt,{activationConstraint:{distance:5}}),Ue(br,{coordinateGetter:fr}));p.useEffect(()=>{i&&(u(l.sort((b,A)=>(b.order||0)-(A.order||0))),m(null),f(!1))},[i,l]);const x=()=>{if(d.length>=ht.TIME_BLOCK.MAX_COUNT)return;let b="09:00",A="10:00";if(d.length>0){const $=d[d.length-1];if($.end){const[V,Z]=$.end.split(":").map(Number);b=$.end;const J=(V+1)%24;A=`${String(J).padStart(2,"0")}:${String(Z).padStart(2,"0")}`}}const M={id:`new-${Date.now()}`,start:b,end:A,color:ye[d.length%ye.length].value,order:d.length};u([...d,M])},k=async b=>{if(!b.startsWith("new-")){o("confirmation",{title:n("delete"),message:n("time_block.delete_confirm"),confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{try{c&&(await Or(c,b),u(A=>A.filter(M=>M.id!==b)))}catch{m(n("validation.delete_fail"))}}});return}u(d.filter(A=>A.id!==b))},E=(b,A)=>{u(d.map(M=>M.id===b?{...M,...A}:M))},D=b=>{v(b.active.id)},F=b=>{const{active:A,over:M}=b;v(null),M&&A.id!==M.id&&u($=>{const V=$.findIndex(J=>J.id===A.id),Z=$.findIndex(J=>J.id===M.id);return kt($,V,Z)})},C=async()=>{f(!0),m(null);try{for(const M of d){if(!M.start||!M.end)continue;const[$,V]=M.start.split(":").map(Number),[Z,J]=M.end.split(":").map(Number);if($*60+V>=Z*60+J)throw new Error(n("time_block.error_invalid_time",{start:M.start,end:M.end}))}const b=[...d].sort((M,$)=>(M.start||"").localeCompare($.start||""));for(let M=0;M<b.length-1;M++){const $=b[M],V=b[M+1];if(!$.end||!V.start)continue;const[Z,J]=$.end.split(":").map(Number),[Te,ct]=V.start.split(":").map(Number);if(Te*60+ct<Z*60+J)throw new Error(n("time_block.error_overlap",{range1:`${$.start}-${$.end}`,range2:`${V.start}-${V.end}`}))}const A=d.map((M,$)=>{var Z;const V={...M,id:(Z=M.id)!=null&&Z.startsWith("new-")?null:M.id,order:$,name:`${M.start}-${M.end}`};if(!c)throw new Error("No workspace");return Za(c,V)});await Promise.all(A),await Promise.all(A),a()}catch(b){m(b.message||n("validation.save_fail")),f(!1)}};if(!i)return null;const T=h?d.find(b=>b.id===h):null;return e.jsx(je,{isOpen:i,onClose:a,title:n("time_block.settings_title"),size:"lg",className:"h-[600px]",zIndex:r,overlayClassName:s,children:e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-2 space-y-3 custom-scrollbar",children:[e.jsxs(qt,{sensors:j,collisionDetection:Ut,onDragStart:D,onDragEnd:F,children:[e.jsx(bt,{items:d.map(b=>b.id),strategy:yt,children:d.map(b=>e.jsx(Hr,{id:b.id,children:e.jsx(ur,{block:b,onDelete:()=>k(b.id),onUpdate:A=>E(b.id,A),isOverlay:!1})},b.id))}),e.jsx(bs,{dropAnimation:null,modifiers:[],children:T?e.jsx("div",{style:{opacity:.9},children:e.jsx(ur,{block:T,onDelete:()=>{},onUpdate:()=>{},isOverlay:!0})}):null})]}),d.length<ht.TIME_BLOCK.MAX_COUNT?e.jsx(q,{onClick:x,disabled:d.length>=ht.TIME_BLOCK.MAX_COUNT,variant:"ghost",className:"w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 group disabled:opacity-50 disabled:cursor-not-allowed shadow-none",leftIcon:e.jsx(tt,{className:"w-5 h-5"}),children:n("time_block.add_button")}):e.jsxs("div",{className:"p-3 bg-yellow-50 dark:bg-yellow-900/20 text-yellow-700 dark:text-yellow-400 text-sm rounded-lg flex items-center justify-center gap-2 border border-yellow-100 dark:border-yellow-900/30",children:[e.jsx(Us,{className:"w-5 h-5"}),n("time_block.max_limit")]}),e.jsxs("div",{className:"px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400",children:[e.jsx("span",{className:"w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"}),e.jsx("span",{className:"font-bold mr-2 text-gray-700 dark:text-gray-300",children:n("time_block.unspecified")}),e.jsx("span",{className:"text-xs opacity-80",children:n("time_block.default_zone_desc")})]})]}),e.jsx(Xe,{message:y,className:"mb-4"}),e.jsx("div",{className:"pt-4 border-t border-gray-100 dark:border-gray-700 flex justify-end",children:e.jsx(q,{onClick:C,disabled:g,isLoading:g,variant:"primary",className:"px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500",children:n(g?"saving":"done")})})]})})},ur=({block:t,onDelete:r,onUpdate:s,isOverlay:n})=>{const{t:a}=B(),[o,i]=p.useState(!1),l=t.start||"09:00",c=t.end||"10:00",[d,u]=l.split(":"),[g,f]=c.split(":"),y="w-auto py-1 pl-2 pr-6 h-8 text-sm font-mono font-medium min-w-[60px]";return e.jsxs("div",{className:`flex items-center gap-4 p-2 bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-sm group ${n?"shadow ring-2 ring-blue-500 opacity-90 cursor-grabbing":""}`,children:[e.jsxs("div",{className:"relative",children:[e.jsx("button",{onClick:()=>i(!o),className:"w-6 h-6 rounded-full shadow-sm ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900",style:{backgroundColor:t.color||"#3B82F6"},title:a("time_block.change_color")}),o&&e.jsxs(Eo,{children:[e.jsx("div",{className:"fixed inset-0 z-[9999] bg-transparent",onClick:()=>i(!1)}),e.jsxs("div",{className:"fixed z-[10000] bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-xl shadow p-4 w-[280px]",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},children:[e.jsx("h4",{className:"text-xs font-bold text-gray-400 dark:text-gray-500 uppercase mb-3 tracking-wider",children:a("modal.theme_color")}),e.jsx("div",{className:"flex flex-wrap gap-2 justify-center",children:ye.map(m=>e.jsx("button",{onClick:()=>{s({color:m.value}),i(!1)},className:_("w-8 h-8 rounded-full ring-2 ring-transparent hover:ring-blue-400 focus:outline-none",t.color===m.value&&"ring-2 ring-offset-2 ring-blue-500 dark:ring-offset-gray-800"),style:{backgroundColor:m.value},"aria-label":a(`colors.${m.key}`),"aria-pressed":t.color===m.value},m.value))})]})]})]}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{options:cr,value:d,onChange:m=>s({start:`${m.target.value}:${u}`}),className:y,containerClassName:"w-auto","aria-label":a("time_block.time_select")}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:":"}),e.jsx(me,{options:dr,value:u,onChange:m=>s({start:`${d}:${m.target.value}`}),className:y,containerClassName:"w-auto","aria-label":a("time_block.time_select")})]}),e.jsx("div",{className:"w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"}),e.jsxs("div",{className:"flex items-center gap-1.5",children:[e.jsx(me,{options:cr,value:g,onChange:m=>s({end:`${m.target.value}:${f}`}),className:y,containerClassName:"w-auto","aria-label":a("time_block.time_select")}),e.jsx("span",{className:"text-gray-300 dark:text-gray-600",children:":"}),e.jsx(me,{options:dr,value:f,onChange:m=>s({end:`${g}:${m.target.value}`}),className:y,containerClassName:"w-auto","aria-label":a("time_block.time_select")})]})]}),e.jsx(q,{onClick:r,variant:"ghost",size:"icon",className:"text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20",title:a("modal.delete"),children:e.jsx(De,{className:"w-5 h-5"})})]})},Lo=({isOpen:t,data:r,zIndex:s})=>{const{t:n}=B(),{closeModal:a,openModal:o}=G(),i=!!t,l=r,c=!!(l!=null&&l.id),[d,u]=p.useState(""),[g,f]=p.useState(!1),[y,m]=p.useState(null),h=U.useRef(null);p.useEffect(()=>{i&&(u((l==null?void 0:l.name)||""),m(null),f(!1))},[i,l]),p.useEffect(()=>{var x;y&&((x=h.current)==null||x.focus())},[y]);const v=p.useCallback(async()=>{const x=d.trim();if(!x){m(n("validation.workspace_name_required"));return}if(Ar().some(D=>D.name===x&&D.id!==(l==null?void 0:l.id))){m(n("validation.workspace_duplicate"));return}f(!0),m(null);try{if(c&&(l!=null&&l.id))await xa(l.id,x),a();else{const D=await ha(x);D!=null&&D.id?(a(),o("confirmation",{title:n("modal.workspace_create_title"),message:n("validation.workspace_confirm_switch"),confirmLabel:n("modal.ok"),onConfirm:()=>Fr(D.id)})):a()}}catch(D){m(n("validation.save_fail")+": "+(D.message||"Error")),f(!1)}},[d,c,l,a,o,n]),j=x=>{x.key==="Enter"&&!x.nativeEvent.isComposing&&v()};return i?e.jsx(je,{isOpen:i,onClose:a,className:"max-w-md",children:e.jsxs("div",{className:"flex flex-col gap-6 max-h-[85vh] overflow-y-auto p-1",children:[e.jsx("div",{children:e.jsx(Ce,{ref:h,id:"workspace-name-input",name:"workspaceName",label:n(c?"modal.workspace_edit_title":"modal.workspace_create_title"),type:"text",value:d,onChange:x=>u(x.target.value),onKeyDown:j,placeholder:n("modal.workspace_name_placeholder"),className:"w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600 px-0 py-0 h-auto focus:ring-0",autoFocus:!0})}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed",children:n(c?"modal.workspace_desc_edit":"modal.workspace_desc_create")}),e.jsx(Xe,{message:y}),e.jsxs("div",{className:"flex justify-end items-center pt-4 border-t border-gray-200 dark:border-gray-700 gap-3",children:[e.jsx(q,{onClick:a,disabled:g,variant:"ghost",className:"text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",children:n("modal.cancel")}),e.jsx(q,{onClick:v,disabled:g,isLoading:g,variant:"primary",children:n(c?"modal.save":"modal.create")})]})]})}):null},Ao=({isOpen:t,data:r,zIndex:s})=>{const{closeModal:n}=G(),{t:a}=B(),o=!!t,i=r,l=p.useCallback(()=>{ae.getState().setView("wizard",{mode:i.id}),n()},[i,n]);return!o||!i?null:e.jsx(je,{isOpen:o,onClose:n,className:"max-w-3xl max-h-[90vh] p-0 overflow-hidden bg-transparent shadow-none",children:e.jsxs("div",{className:"w-full bg-white dark:bg-gray-800 rounded-2xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]",children:[e.jsx("div",{className:"flex items-center justify-between p-6 border-b border-gray-200 dark:border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-4xl animate-bounce-slow",children:i.icon}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-bold text-gray-900 dark:text-white",children:i.title}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:i.subTitle})]})]})}),e.jsxs("div",{className:"p-6 overflow-y-auto flex-1 custom-scrollbar",children:[e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-sm font-bold text-blue-600 dark:text-blue-400 uppercase tracking-wider mb-3 flex items-center",children:[e.jsx("span",{className:"w-1 h-4 bg-blue-600 dark:bg-blue-400 mr-2 rounded-full"}),a("wiki.summary")]}),e.jsx("p",{className:"text-base text-gray-700 dark:text-gray-300 leading-relaxed bg-blue-50 dark:bg-blue-900/20 p-4 rounded-lg border border-blue-100 dark:border-blue-800",children:i.concept.summary})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 flex items-center",children:[e.jsx("span",{className:"w-1 h-4 bg-gray-400 mr-2 rounded-full"}),a("wiki.details")]}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 leading-relaxed mb-3",children:i.concept.detail})]}),Array.isArray(i.useCases)&&i.useCases.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 flex items-center",children:[e.jsx("span",{className:"w-1 h-4 bg-purple-500 mr-2 rounded-full"}),a("wiki.use_cases")]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:i.useCases.map((c,d)=>e.jsxs("div",{className:"bg-gray-50 dark:bg-gray-900/40 rounded-lg p-5 border border-gray-200 dark:border-gray-700 hover:border-purple-300 dark:hover:border-purple-700 transition-colors",children:[e.jsxs("h4",{className:"font-bold text-gray-800 dark:text-gray-200 mb-3 flex items-center",children:[e.jsx("span",{className:"text-purple-500 mr-2",children:"#"}),c.title]}),e.jsx("div",{className:"mb-3",children:e.jsxs("div",{className:"flex items-start mb-1",children:[e.jsx("span",{className:"text-[10px] font-bold text-red-600 bg-red-100 dark:bg-red-900/40 dark:text-red-300 px-1.5 py-0.5 rounded mr-2 mt-0.5 min-w-[40px] text-center",children:"Before"}),e.jsx("span",{className:"text-sm text-gray-600 dark:text-gray-400",children:c.before})]})}),e.jsx("div",{children:e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-[10px] font-bold text-blue-600 bg-blue-100 dark:bg-blue-900/40 dark:text-blue-300 px-1.5 py-0.5 rounded mr-2 mt-0.5 min-w-[40px] text-center",children:"After"}),e.jsx("span",{className:"text-sm text-gray-800 dark:text-gray-300 font-medium",children:c.after})]})})]},d))})]}),i.tips&&i.tips.length>0&&e.jsxs("div",{className:"mb-6",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3 flex items-center",children:[e.jsx("span",{className:"w-1 h-4 bg-amber-500 mr-2 rounded-full"}),a("wiki.tips")]}),e.jsx("div",{className:"space-y-3",children:i.tips.map((c,d)=>e.jsxs("div",{className:"bg-amber-50 dark:bg-amber-900/10 p-4 rounded-lg border border-amber-100 dark:border-amber-900/30",children:[e.jsxs("p",{className:"font-bold text-amber-800 dark:text-amber-400 mb-1",children:["Q. ",c.q]}),e.jsxs("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:["A. ",c.a]})]},d))})]})]}),e.jsxs("div",{className:"flex items-center justify-between p-6 border-t border-gray-200 dark:border-gray-700 bg-gray-50 dark:bg-gray-900/50",children:[e.jsx("button",{onClick:n,className:"px-5 py-2.5 text-sm font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-700 rounded-lg transition-colors",children:a("close")}),e.jsxs("button",{onClick:l,className:"group relative px-6 py-2.5 text-sm font-bold text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 rounded-lg shadow-md transition-all transform hover:scale-105 active:scale-95 overflow-hidden",children:[e.jsxs("span",{className:"relative z-10 flex items-center",children:[a("wiki.use_in_wizard"),e.jsx("svg",{className:"w-4 h-4 ml-2 animate-pulse",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})})]}),e.jsx("div",{className:"absolute inset-0 bg-white/20 translate-y-full group-hover:translate-y-0 transition-transform duration-300 skew-y-12"})]})]})]})})},Fo=({isOpen:t,data:r,zIndex:s,overlayClassName:n})=>{const{closeModal:a}=G(),{t:o}=B();if(!r)return null;const{title:i,message:l,onConfirm:c,confirmLabel:d=o("modal.create"),cancelLabel:u=o("modal.cancel"),variant:g="primary"}=r,f=()=>{c(),a()},y=g==="danger";return e.jsx(je,{isOpen:t,onClose:a,title:i,size:"sm",zIndex:s,overlayClassName:n,className:"animate-fade-in-up",children:e.jsxs("div",{className:"flex flex-col gap-6",children:[e.jsx("div",{className:"text-gray-700 dark:text-gray-300 whitespace-pre-wrap leading-relaxed",children:l}),e.jsxs("div",{className:"flex justify-end gap-3 pt-2",children:[e.jsx("button",{onClick:a,className:"px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors",children:u}),e.jsx("button",{onClick:f,className:`px-6 py-2 text-sm font-bold text-white rounded-lg shadow-md transition-transform active:scale-95 ${y?"bg-red-500 hover:bg-red-600 shadow-red-500/30":"bg-blue-600 hover:bg-blue-700 shadow-blue-500/30"}`,autoFocus:!0,children:d})]})]})})},Bo=()=>{const{stack:t}=G();return t.length===0?null:e.jsx(e.Fragment,{children:t.map((r,s)=>{const a=s===0?void 0:"bg-black/30",o={isOpen:!0,data:r.data,zIndex:100+s*10,overlayClassName:a};switch(r.type){case"settings":return e.jsx(_o,{...o},r.id);case"task-detail":return e.jsx(To,{...o},r.id);case"label-edit":return e.jsx(jo,{...o},r.id);case"project-edit":return e.jsx(wo,{...o},r.id);case"workspace-edit":return e.jsx(Lo,{...o},r.id);case"filter-edit":return e.jsx(vo,{...o},r.id);case"timeblock-edit":return e.jsx(Io,{...o},r.id);case"wiki-framework":return e.jsx(Ao,{...o},r.id);case"confirmation":return e.jsx(Fo,{...o},r.id);default:return null}})})},Je=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=p.useCallback(c=>!t||!r?()=>{}:po(t,d=>c(d),d=>console.error("Task subscription error:",d)),[t,r]),a=t?bo(t):!1,{data:o,isPending:i}=$e(["tasks",r||void 0,t||void 0],n,t&&a?fo(t):void 0);return{tasks:o||[],loading:s||!!t&&!a&&i}};function Gr(){const{tasks:t}=Je(),{showCompleted:r,query:s}=ge();return p.useMemo(()=>{var i,l;const a={inbox:0,today:0,upcoming:0,important:0,all:0,search:0},o=s?s.toLowerCase().trim():"";for(const c of t){if(o){const u=(i=c.title)==null?void 0:i.toLowerCase().includes(o),g=(l=c.description)==null?void 0:l.toLowerCase().includes(o);(u||g)&&a.search++}c.status==="archived"||c.status==="completed"||(a.all++,(!c.projectId||c.projectId==="unassigned"||c.projectId==="none")&&a.inbox++,c.isImportant&&a.important++,c.dueDate&&(Gn(c.dueDate)?a.today++:Yn(c.dueDate)&&a.upcoming++))}return a},[t,s])}const Ro=t=>t in O.SIDEBAR_DENSITY,_t=t=>Ro(t)?O.SIDEBAR_DENSITY[t]:O.SIDEBAR_DENSITY.normal,$o=[{id:"inbox",i18nKey:"inbox",Icon:Tr,color:"text-blue-500",droppable:!0},{id:"today",i18nKey:"today",Icon:st,color:"text-green-500"},{id:"upcoming",i18nKey:"upcoming",Icon:Sr,color:"text-purple-500"},{id:"important",i18nKey:"important",Icon:wt,color:"text-amber-400"},{id:"custom",i18nKey:"all_tasks",Icon:Xs,color:"text-gray-500"}],Oo=()=>{const{language:t,density:r}=X(),{t:s}=fe(t),n=Gr(),{setView:a,currentView:o}=ae(),i=o==="dashboard";return e.jsxs("ul",{className:"space-y-0.5",children:[e.jsx("li",{children:e.jsxs("button",{onClick:()=>a("dashboard"),className:_("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",_t(r),i?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[e.jsx(Cr,{className:"w-4 h-4 text-indigo-500"}),e.jsx("span",{className:"flex-1",children:s("dashboard")})]})}),$o.map(l=>e.jsx(Po,{item:l,label:s(l.i18nKey),count:n[l.id]||0},l.id))]})},Po=({item:t,label:r,count:s})=>{const{filterType:n,setFilter:a}=ge(),{setView:o}=ae(),{density:i}=X(),c=ae(y=>y.currentView)==="tasks"&&n===t.id,d=t.Icon,{setNodeRef:u,isOver:g}=ot({id:`filter:${t.id}`,disabled:!t.droppable,data:{type:t.id==="inbox"?"inbox":"filter",value:t.id}}),f=()=>{t.id==="search"?(o("tasks"),a("search")):(o("tasks"),a(t.id))};return e.jsx("li",{ref:u,children:e.jsxs("button",{onClick:f,className:_("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",_t(i),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",g&&t.droppable&&"bg-blue-50 dark:bg-blue-900/30"),children:[e.jsx(d,{className:_("w-4 h-4",t.color)}),e.jsx("span",{className:"flex-1",children:r}),t.id!=="search"&&s>0&&e.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:s})]})})},Wo=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=p.useCallback(c=>!t||!r?()=>{}:kn(t,c),[t,r]),a=t?yn(t):!1,{data:o,isPending:i}=$e(["filters",r||void 0,t||void 0],n,t&&a?bn(t):void 0);return{filters:o,loading:s||!!t&&i}};function zo(t,r="createdAt_desc"){if(!Array.isArray(t))return[];const[s,n]=r.split("_"),o=n==="desc"?-1:1;return[...t].sort((i,l)=>{var u,g,f,y,m,h;let c,d;switch(s){case"dueDate":c=(u=Y(i.dueDate))==null?void 0:u.getTime(),d=(g=Y(l.dueDate))==null?void 0:g.getTime();break;case"createdAt":c=(f=Y(i.createdAt))==null?void 0:f.getTime(),d=(y=Y(l.createdAt))==null?void 0:y.getTime();break;case"title":c=i.title.toLowerCase(),d=l.title.toLowerCase();break;case"duration":c=i.duration||0,d=l.duration||0;break;case"important":c=i.isImportant?1:0,d=l.isImportant?1:0;break;case"manual":c=i.order!==void 0?i.order:Number.MAX_SAFE_INTEGER,d=l.order!==void 0?l.order:Number.MAX_SAFE_INTEGER;break;default:c=(m=Y(i.createdAt))==null?void 0:m.getTime(),d=(h=Y(l.createdAt))==null?void 0:h.getTime()}return qo(c,d)*o})}function qo(t,r){return t===r?0:t==null?1:r==null?-1:t>r?1:t<r?-1:0}function Uo(){const t=new Date;t.setHours(0,0,0,0);const r=new Date(t);r.setDate(r.getDate()+1);const s=Xn(t),n=new Date(s);n.setDate(n.getDate()+7);const a=new Date(r);return a.setDate(a.getDate()+7),{now:t,tomorrow:r,weekStart:s,weekEnd:n,upcomingEnd:a}}function Ko(t,r,s,n){const{now:a,tomorrow:o,weekStart:i,weekEnd:l,upcomingEnd:c}=s;switch(r){case"today":return or(t,a);case"tomorrow":return or(t,o);case"week":return t>=i&&t<l;case"upcoming":return t>=o&&t<c;case"overdue":return t<a&&n!=="completed";default:return!1}}function gr(t,r){if(!r)return t;const s=typeof r=="string"?Zt(r):r,n=s.dates.length>0?Uo():null;return t.filter(a=>{if(s.status.length>0){const i=a.status||"todo";if(!s.status.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(s.excludeStatus.length>0){const i=a.status||"todo";if(s.excludeStatus.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(s.isImportant===!0&&!a.isImportant||s.isImportant===!1&&a.isImportant||s.projects.length>0&&!s.projects.some(l=>l==="unassigned"?!a.projectId||a.projectId==="unassigned"||a.projectId==="none":a.projectId===l)||s.excludeProjects.length>0&&s.excludeProjects.some(i=>a.projectId===i)||s.labels.length>0&&(!a.labelIds||!s.labels.some(i=>{var l;return(l=a.labelIds)==null?void 0:l.includes(i)}))||s.excludeLabels.length>0&&a.labelIds&&s.excludeLabels.some(i=>{var l;return(l=a.labelIds)==null?void 0:l.includes(i)})||s.timeBlocks.length>0&&!s.timeBlocks.some(l=>l==="unassigned"?!a.timeBlockId:a.timeBlockId===l)||s.excludeTimeBlocks.length>0&&s.excludeTimeBlocks.some(i=>a.timeBlockId===i))return!1;if(s.durations.length>0){const i=a.duration||0;if(!s.durations.includes(i))return!1}if(n&&s.dates.length>0){const i=Y(a.dueDate);if(!i||!s.dates.some(c=>Ko(i,c,n,a.status||"todo")))return!1}const o=`${a.title} ${a.description||""}`.toLowerCase();return!(s.keywords.length>0&&!s.keywords.every(l=>Array.isArray(l)?l.some(c=>o.includes(c)):o.includes(l))||s.excludeKeywords.length>0&&s.excludeKeywords.some(l=>o.includes(l)))})}function Vo(t){const{keyword:r,showCompleted:s,projectId:n,labelId:a,timeBlockId:o,duration:i,filterType:l}=t,c=r?Zt(r):{keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(n&&c.projects.push(n),a&&c.labels.push(a),o&&c.timeBlocks.push(o),i){const d=typeof i=="number"?i:parseInt(i,10);isNaN(d)||c.durations.push(d)}return l==="today"&&c.dates.push("today"),l==="upcoming"&&c.dates.push("upcoming"),l==="important"&&(c.isImportant=!0),s||c.status.length===0&&c.status.push("active"),c}function Yr(t,r){const{savedFilter:s,sortCriteria:n}=r,a=Vo(r);let o=gr(t,a);return s&&s.query&&(o=gr(o,s.query)),zo(o,n||"createdAt_desc")}const Ct=({x:t,y:r,onClose:s,children:n})=>{const a=p.useRef(null);return p.useEffect(()=>{const o=l=>{a.current&&!a.current.contains(l.target)&&s()},i=()=>s();return document.addEventListener("mousedown",o),window.addEventListener("scroll",i,!0),()=>{document.removeEventListener("mousedown",o),window.removeEventListener("scroll",i,!0)}},[s]),$t.createPortal(e.jsx("div",{ref:a,className:"fixed z-50 min-w-[160px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{top:r,left:t},onContextMenu:o=>o.preventDefault(),children:n}),document.body)},Ho=({label:t,icon:r,children:s})=>{const[n,a]=U.useState(!1);return e.jsxs("div",{className:"relative w-full",onMouseEnter:()=>a(!0),onMouseLeave:()=>a(!1),children:[e.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm flex items-center justify-between gap-2 transition-colors text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[r&&e.jsx("span",{className:"w-4 h-4 text-gray-400",children:r}),t]}),e.jsx(_r,{className:"w-3 h-3 text-gray-400"})]}),n&&e.jsx("div",{className:"absolute left-full top-0 ml-1 min-w-[140px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100 z-50",children:s})]})},ie=({onClick:t,children:r,className:s,icon:n,variant:a="default"})=>e.jsxs("button",{onClick:o=>{o.stopPropagation(),t()},className:_("w-full text-left px-3 py-2 text-sm flex items-center gap-2 transition-colors",a==="danger"?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",s),children:[n&&e.jsx("span",{className:_("w-4 h-4",a==="danger"?"text-red-500":"text-gray-400"),children:n}),r]}),Ae=({icon:t,label:r,count:s,isActive:n,isOver:a,onClick:o,onContextMenu:i,showZero:l=!1})=>{const{density:c}=X();return e.jsxs("button",{type:"button",onClick:o,onContextMenu:i,className:_("w-full text-left group flex items-center justify-between px-2 ml-1 rounded-md transition-colors select-none outline-none focus:ring-2 focus:ring-blue-500/50",_t(c),n?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",a&&"bg-blue-50 dark:bg-blue-900/30"),children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[t&&e.jsx("span",{className:"flex-shrink-0 w-5 flex justify-center text-sm",children:t}),e.jsx("span",{className:"text-sm truncate",children:r})]}),s!==void 0&&(s>0||l&&s===0)&&e.jsx("span",{className:_("text-[10px] font-bold px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700/50",n?"text-blue-700 dark:text-blue-300 bg-white":"text-gray-400"),children:s})]})},Go=()=>{const{filters:t,loading:r}=Wo(),{tasks:s}=Je(),{workspaceId:n}=ne();return r?null:e.jsx("div",{className:"space-y-0.5 py-1",children:t.map(a=>e.jsx(Yo,{filter:a,tasks:s,workspaceId:n},a.id))})},Yo=({filter:t,tasks:r,workspaceId:s})=>{const{t:n}=B(),{filterType:a,targetId:o,setFilter:i}=ge(),{openModal:l}=G(),c=a==="custom"&&o===t.id,[d,u]=p.useState(null),g=U.useMemo(()=>{try{return Yr(r,{savedFilter:t,showCompleted:!1}).length}catch(h){return console.warn("[CustomFilterItem] Count error:",h),0}},[r,t]),f=()=>{u(null),l("filter-edit",t)},y=()=>{u(null),l("confirmation",{title:n("delete"),message:`${n("filter")}: ${t.name}
${n("msg.confirm_delete")}`,confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{t.id&&s&&await wn(s,t.id)}})},m=h=>{h.preventDefault(),h.stopPropagation(),u({x:h.clientX,y:h.clientY})};return e.jsxs(e.Fragment,{children:[e.jsx("div",{onContextMenu:m,children:e.jsx(Ae,{label:t.name,icon:e.jsx(Ht,{size:16}),count:g,isActive:c,onClick:()=>i("custom",t.id)})}),d&&e.jsxs(Ct,{x:d.x,y:d.y,onClose:()=>u(null),children:[e.jsx(ie,{onClick:f,icon:e.jsx(rt,{size:16}),children:n("edit")}),e.jsx(ie,{onClick:y,variant:"danger",icon:e.jsx(De,{size:16}),children:n("delete")})]})]})},Xo=U.memo(({mins:t,count:r})=>{const{t:s}=B(),{filterType:n,targetId:a,setFilter:o}=ge(),{setView:i}=ae(),l=n==="duration"&&a===t.toString(),{setNodeRef:c,isOver:d}=ot({id:`duration:${t}`,data:{type:"duration",value:t.toString()}});return e.jsx("div",{ref:c,children:e.jsx(Ae,{label:s("sidebar.duration_format",{min:t}),icon:e.jsx(Dr,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),count:r,isActive:l,isOver:d,onClick:()=>{i("tasks"),o("duration",t.toString())}})})}),Jo=()=>{const{tasks:t}=Je(),{customDurations:r}=X(),s=(r==null?void 0:r.length)>0?r:O.SIDEBAR.DURATIONS,n=p.useMemo(()=>{const a=new Map;return t.forEach(o=>{if(o.status!=="completed"&&o.duration){const i=Number(o.duration);isNaN(i)||a.set(i,(a.get(i)||0)+1)}}),a},[t]);return e.jsx("div",{className:"space-y-0.5 py-1",children:s.map(a=>e.jsx(Xo,{mins:a,count:n.get(a)||0},a))})},Qo=U.memo(({project:t})=>{const{t:r}=B(),{filterType:s,targetId:n,setFilter:a}=ge(),{density:o}=X(),{openModal:i}=G(),{setView:l}=ae(),c=s==="project"&&n===t.id,[d,u]=p.useState(null),{setNodeRef:g,isOver:f}=ot({id:`project:${t.id}`,data:{type:"project",value:t.id}}),y=j=>{j==null||j.stopPropagation(),u(null),i("project-edit",t)},m=()=>{u(null),i("confirmation",{title:r("delete"),message:`${r("project")}: ${t.name}
${r("msg.confirm_delete")}`,confirmLabel:r("delete"),variant:"danger",onConfirm:async()=>{t.id&&await Br(t.id)}})},h=j=>{j.preventDefault(),j.stopPropagation(),u({x:j.clientX,y:j.clientY})},v=()=>{a("project",t.id),l("tasks")};return e.jsxs(e.Fragment,{children:[e.jsxs("div",{ref:g,onClick:v,onContextMenu:h,className:_("group flex items-center justify-between px-2 rounded-md cursor-pointer transition-colors select-none",_t(o),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",f&&"bg-blue-50 dark:bg-blue-900/30"),role:"button",tabIndex:0,"aria-selected":c,"aria-label":`${r("project")}: ${t.name}${c?` (${r("active")})`:""}`,children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e.jsx("span",{className:_("text-xs shrink-0 transition-colors",c?"text-blue-500":"text-gray-400 group-hover:text-gray-500"),children:e.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),e.jsx("span",{className:"text-sm truncate",children:t.name})]}),e.jsx("button",{onClick:y,className:_("p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-600 transition-opacity",c?"opacity-100":"opacity-0 sm:group-hover:opacity-100 focus:opacity-100"),"aria-label":r("edit"),title:r("edit"),children:e.jsx(rt,{className:"w-3.5 h-3.5 text-gray-500 dark:text-gray-400"})})]}),d&&e.jsxs(Ct,{x:d.x,y:d.y,onClose:()=>u(null),children:[e.jsx(ie,{onClick:y,icon:e.jsx(rt,{size:16}),children:r("edit")}),e.jsx(ie,{onClick:m,variant:"danger",icon:e.jsx(De,{size:16}),children:r("delete")})]})]})}),Zo=()=>{const{t}=B(),{projects:r,loading:s}=lt();return s?e.jsx(Vr,{}):r.length===0?e.jsx("div",{className:"p-4 text-xs text-gray-400",children:t("sidebar.no_projects")}):e.jsx(bt,{items:r.map(n=>n.id),strategy:yt,children:e.jsx("div",{className:"space-y-0.5 p-2",children:r.map(n=>e.jsx(Hr,{id:n.id,children:e.jsx(Qo,{project:n})},n.id))})})},ei=({title:t,children:r,defaultExpanded:s=!0,action:n,dragHandleProps:a})=>{const{t:o}=B(),[i,l]=p.useState(()=>typeof window<"u"&&window.innerWidth<768?!1:s),d=`section-${encodeURIComponent(t.replace(/\s+/g,"-").toLowerCase())}`;return e.jsxs("div",{className:"mb-2 group/section",children:[e.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[e.jsxs("button",{...a,onClick:()=>l(!i),"aria-expanded":i,"aria-controls":d,className:"flex items-center flex-1 text-xs font-semibold text-gray-500 uppercase hover:text-gray-700 dark:hover:text-gray-300 transition-colors text-left cursor-grab active:cursor-grabbing touch-none select-none",title:o("sidebar.reorder_section"),children:[e.jsx("svg",{className:_("w-3 h-3 mr-1 transition-transform",i?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),t]}),n&&e.jsx("div",{className:"opacity-100 transition-opacity",onClick:u=>u.stopPropagation(),children:n})]}),i&&e.jsx("div",{className:"mt-1",id:d,children:r})]})},ti=()=>{const{t}=B(),{currentView:r,setView:s}=ae();return e.jsxs("div",{className:"space-y-0.5 py-1",children:[e.jsx(Ae,{label:t("sidebar.target_wizard"),icon:e.jsx(Hs,{}),isActive:r==="wizard",onClick:()=>s("wizard")}),e.jsx(Ae,{label:t("sidebar.target_dashboard"),icon:e.jsx(Cr,{}),isActive:r==="target-dashboard",onClick:()=>s("target-dashboard")}),e.jsx(Ae,{label:t("sidebar.framework_wiki"),icon:e.jsx(Gs,{}),isActive:r==="wiki",onClick:()=>s("wiki")})]})},ri=()=>{const{timeBlocks:t,loading:r}=Oe(),{tasks:s}=Je(),{workspaceId:n}=ne(),a=U.useMemo(()=>{const o=new Map;let i=0;return s.forEach(l=>{l.status!=="completed"&&(!l.timeBlockId||l.timeBlockId==="unassigned"||l.timeBlockId==="null"?i++:o.set(l.timeBlockId,(o.get(l.timeBlockId)||0)+1))}),{map:o,unassignedCount:i}},[s]);return r?e.jsx(Vr,{}):e.jsxs("div",{className:"space-y-0.5 py-1",children:[t.map(o=>e.jsx(si,{block:o,count:a.map.get(o.id||"")||0,workspaceId:n},o.id)),e.jsx(ai,{count:a.unassignedCount})]})},si=({block:t,count:r,workspaceId:s})=>{const{t:n}=B(),{filterType:a,targetId:o,setFilter:i}=ge(),{openModal:l}=G(),c=a==="timeblock"&&o===t.id,{setView:d}=ae(),[u,g]=p.useState(null),{setNodeRef:f,isOver:y}=ot({id:`timeblock:${t.id}`,data:{type:"timeblock",value:t.id}}),m=()=>{g(null),l("timeblock-edit",t)},h=()=>{g(null),l("confirmation",{title:n("delete"),message:`${n("timeblock")}: ${t.start} - ${t.end}
${n("msg.confirm_delete")}`,confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{t.id&&s&&await Or(s,t.id)}})},v=x=>{x.preventDefault(),x.stopPropagation(),g({x:x.clientX,y:x.clientY})},j=()=>{i("timeblock",t.id||""),d("tasks")};return e.jsxs("div",{ref:f,onContextMenu:v,children:[e.jsx(Ae,{label:`${t.start} - ${t.end}`,icon:e.jsx("span",{className:"w-2 rounded-full aspect-square",style:{backgroundColor:t.color}}),count:r,isActive:c,isOver:y,onClick:j}),u&&e.jsxs(Ct,{x:u.x,y:u.y,onClose:()=>g(null),children:[e.jsx(ie,{onClick:m,icon:e.jsx(rt,{size:16}),children:n("edit")}),e.jsx(ie,{onClick:h,variant:"danger",icon:e.jsx(De,{size:16}),children:n("delete")})]})]})},ai=({count:t})=>{const{t:r}=B(),{filterType:s,targetId:n,setFilter:a}=ge(),{setView:o}=ae(),i=s==="timeblock"&&n==="unassigned",{setNodeRef:l,isOver:c}=ot({id:"timeblock:unassigned",data:{type:"timeblock",value:"unassigned"}}),d=()=>{a("timeblock","unassigned"),o("tasks")};return e.jsx("div",{ref:l,children:e.jsx(Ae,{label:r("sidebar.unassigned"),icon:e.jsx("span",{className:"w-2 rounded-full aspect-square bg-gray-400"}),count:t,isActive:i,isOver:c,onClick:d})})},ni=({id:t,section:r})=>{const{attributes:s,listeners:n,setNodeRef:a,transform:o,transition:i,isDragging:l}=Ot({id:t}),c={transform:Pt.Transform.toString(o),transition:i,opacity:l?.5:1};return e.jsx("div",{ref:a,style:c,...s,children:e.jsx(ei,{title:r.title,defaultExpanded:r.defaultExpanded,action:r.action,dragHandleProps:n,children:r.component})})},Mt=["general","projects","targets","timeblocks","durations","filters"],oi=()=>{const{t}=B(),{openModal:r}=G(),[s,n]=U.useState(()=>{const l=localStorage.getItem(O.STORAGE_KEYS.SECTION_ORDER);let c=Mt;if(l)try{const d=JSON.parse(l);if(Array.isArray(d)&&d.every(u=>typeof u=="string")){const u=[...d];Mt.forEach(g=>{u.includes(g)||(g==="general"?u.unshift(g):u.push(g))}),c=u.filter(g=>Mt.includes(g))}}catch{}return c});p.useEffect(()=>{localStorage.setItem(O.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(s))},[s]);const a=Wt(Ue(zt,{activationConstraint:{distance:8}}),Ue(br,{coordinateGetter:fr})),o=l=>{const{active:c,over:d}=l;d&&c.id!==d.id&&n(u=>{const g=u.indexOf(c.id),f=u.indexOf(d.id);return kt(u,g,f)})},i=U.useMemo(()=>({general:{id:"general",title:t("general"),component:e.jsx(e.Fragment,{children:e.jsx(Oo,{})}),defaultExpanded:!0},projects:{id:"projects",title:t("projects"),component:e.jsx(Zo,{}),defaultExpanded:!0,action:e.jsx("button",{onClick:()=>r("project-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:t("add"),"aria-label":t("add"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},targets:{id:"targets",title:t("targets"),component:e.jsx(ti,{}),defaultExpanded:!1,action:e.jsx("button",{onClick:()=>r("wiki-framework"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:t("add"),"aria-label":t("add"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},timeblocks:{id:"timeblocks",title:t("timeblocks"),component:e.jsx(ri,{}),defaultExpanded:!1,action:e.jsx("button",{onClick:()=>r("timeblock-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:t("add"),"aria-label":t("add"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},durations:{id:"durations",title:t("durations"),component:e.jsx(Jo,{}),defaultExpanded:!1},filters:{id:"filters",title:t("filters"),component:e.jsx(Go,{}),defaultExpanded:!1,action:e.jsx("button",{onClick:()=>r("filter-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:t("add"),"aria-label":t("add"),children:e.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})}}),[t,r]);return e.jsx(qt,{sensors:a,collisionDetection:Ut,onDragEnd:o,children:e.jsx(bt,{items:s,strategy:yt,children:e.jsx("div",{className:"flex flex-col gap-4",children:s.map(l=>{const c=i[l];return c?e.jsx(ni,{id:c.id,section:c},c.id):null})})})})},ii=({className:t,onCancel:r,onSuccess:s,placeholder:n,initialValue:a=""})=>{const{t:o}=B(),i=n||o("inline_input.placeholder"),[l,c]=p.useState(a),[d,u]=p.useState(!1),[g,f]=p.useState(!1),[y,m]=p.useState(!1),h=async x=>{if(!(!l.trim()||y)){m(!0);try{await Ur({title:l,isImportant:d,dueDate:g?new Date:void 0}),c(""),u(!1),f(!1),s==null||s()}catch(k){console.error(k),S.error(o("msg.task.create_fail"))}finally{m(!1)}}},v=x=>{x.key==="Enter"&&!x.shiftKey&&!x.nativeEvent.isComposing&&(x.preventDefault(),h()),x.key==="Escape"&&(r==null||r())},j=U.useRef(null);return U.useEffect(()=>{const x=E=>{j.current&&!j.current.contains(E.target)&&(l.trim()||r==null||r())},k=setTimeout(()=>{document.addEventListener("mousedown",x)},100);return()=>{clearTimeout(k),document.removeEventListener("mousedown",x)}},[r,l]),e.jsxs("div",{ref:j,className:_("glass-effect rounded-xl shadow-xl p-3 sm:p-4 border border-blue-500/30 dark:border-blue-400/30 animate-in slide-in-from-top-2 duration-300 w-full",t),children:[e.jsx("label",{htmlFor:"inline-task-input",className:"sr-only",children:o("inline_input.label")}),e.jsx("input",{id:"inline-task-input",type:"text",autoFocus:!0,className:"w-full bg-white/50 dark:bg-gray-800/50 text-base sm:text-lg font-medium text-gray-800 dark:text-gray-100 placeholder-gray-500 dark:placeholder-gray-400 outline-none mb-3 sm:mb-4 focus:bg-white/80 dark:focus:bg-gray-800/80 p-3 rounded-lg transition-all border border-transparent focus:border-blue-500/30 focus:ring-2 focus:ring-blue-500/20",placeholder:i,value:l,onChange:x=>c(x.target.value),onKeyDown:v,disabled:y}),e.jsxs("div",{className:"flex justify-between items-center pt-3 border-t border-gray-100 dark:border-gray-700/50",children:[e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[e.jsx("button",{type:"button",onClick:()=>f(!g),className:_("transition-colors p-2 rounded-lg",g?"text-blue-600 bg-blue-50 hover:bg-blue-100 dark:text-blue-400 dark:bg-blue-900/30 dark:hover:bg-blue-900/50":"text-gray-400 hover:text-blue-500 dark:hover:text-blue-400 hover:bg-gray-100 dark:hover:bg-gray-700"),"aria-label":o(g?"inline_input.aria_today_remove":"inline_input.aria_today"),title:o(g?"inline_input.tooltip_today_remove":"inline_input.tooltip_today"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:_("transition-colors p-2 rounded-lg",d?"text-amber-500 bg-amber-50 hover:bg-amber-100 dark:text-amber-400 dark:bg-amber-900/30 dark:hover:bg-amber-900/50":"text-gray-400 hover:text-amber-500 dark:hover:text-amber-400 hover:bg-gray-100 dark:hover:bg-gray-700"),"aria-label":o(d?"inline_input.aria_important_remove":"inline_input.aria_important"),title:o(d?"inline_input.tooltip_important_remove":"inline_input.tooltip_important"),children:e.jsx("svg",{className:_("w-5 h-5",d&&"fill-current"),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})})})]}),e.jsxs("div",{className:"flex gap-2 sm:gap-3",children:[r&&e.jsx("button",{type:"button",onClick:r,disabled:y,className:"px-3 py-2 sm:px-4 sm:py-2 text-sm font-bold text-gray-500 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-xl transition-all","aria-label":o("modal.cancel"),children:o("modal.cancel")}),e.jsx("button",{onClick:()=>h(),disabled:!l.trim()||y,className:"px-4 py-2 sm:px-5 sm:py-2 text-sm font-bold text-white bg-blue-600 hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed rounded-xl shadow-lg shadow-blue-500/20 transition-all active:scale-95 flex items-center gap-1","aria-label":o("add_task"),children:o(y?"inline_input.adding":"add")})]})]})]})},li=({initialValue:t=""})=>{const{t:r}=B(),[s,n]=p.useState(!1);if(U.useEffect(()=>{if(!s)return;const o=i=>{i.key==="Escape"&&n(!1)};return window.addEventListener("keydown",o),()=>window.removeEventListener("keydown",o)},[s]),s)return e.jsx("div",{className:"mb-2",children:e.jsx(ii,{onCancel:()=>n(!1),onSuccess:()=>n(!1),initialValue:t})});const a=t?r("add_task_button.add_with_title",{title:t}):r("add_task_button.add_task");return e.jsxs("button",{onClick:()=>n(!0),"aria-label":r("add_task_button.aria_label"),className:"group flex items-center gap-2 w-full text-left py-2 px-1 text-gray-500 dark:text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 transition-colors mb-2",children:[e.jsx("div",{className:"w-5 h-5 rounded-full flex items-center justify-center bg-transparent group-hover:bg-blue-100/50 dark:group-hover:bg-blue-900/30 transition-colors",children:e.jsx("svg",{className:"w-4 h-4 text-inherit",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})}),e.jsx("span",{className:"text-sm font-medium",children:a})]})},Xr=U.memo(({task:t,style:r,className:s,dragHandleProps:n})=>{const{t:a}=B(),o=t.status==="completed",i=!!t.isImportant,{openModal:l}=G(),{projects:c}=lt(),{timeBlocks:d}=Oe(),[u,g]=p.useState(null),f=async F=>{F.stopPropagation(),t.id&&await xo(t.id,t.status||"todo")},y=async F=>{F.stopPropagation(),t.id&&await ft(t.id,{isImportant:!i})},m=F=>{F.preventDefault(),F.stopPropagation(),g({x:F.clientX,y:F.clientY})},h=()=>{g(null),l("task-detail",t)},v=()=>{g(null),l("confirmation",{title:a("delete"),message:`${a("task")}: ${t.title}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{t.id&&await Kr(t.id)}})},j=async F=>{if(g(null),!t.id)return;let C=null;const T=new Date;switch(T.setHours(0,0,0,0),F){case"today":C=new Date;break;case"tomorrow":C=new Date(T),C.setDate(T.getDate()+1);break;case"next_week":C=new Date(T),C.setDate(T.getDate()+7);break;case"no_date":C=null;break}await ft(t.id,{dueDate:C})},x=t.projectId?c.find(F=>F.id===t.projectId):null,k=t.timeBlockId?d.find(F=>F.id===t.timeBlockId):null,E=!!(t.recurrence&&t.recurrence.type!=="none"),D=!!t.dueDate;return e.jsxs(e.Fragment,{children:[e.jsxs("li",{style:r,onClick:()=>l("task-detail",t),onContextMenu:m,className:_("group flex items-center gap-3 p-[var(--task-p)] bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700/50 rounded-xl hover:shadow-sm hover:border-blue-200 dark:hover:border-blue-800 transition-all duration-200 cursor-pointer hover-lift",s),...n,children:[e.jsx("button",{onClick:f,className:_("w-5 h-5 rounded-full border flex items-center justify-center transition-colors shrink-0",o?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-blue-400 text-transparent"),"aria-label":o?"Mark as incomplete":"Mark as complete",children:e.jsx(jt,{className:"w-3 h-3",strokeWidth:3})}),e.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[e.jsx("div",{className:_("text-sm text-gray-800 dark:text-gray-200 break-words",o&&"line-through text-gray-400 dark:text-gray-500"),children:t.title}),t.description&&e.jsx("div",{className:"text-xs text-gray-500 line-clamp-1 truncate",children:t.description})]}),e.jsxs("div",{className:"flex items-center gap-3 text-xs shrink-0",children:[x&&e.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-300",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:x.color||"#ccc"}}),e.jsx("span",{className:"max-w-[100px] truncate",children:x.name})]}),k&&e.jsxs("div",{className:"hidden sm:flex items-center gap-1 text-gray-500 dark:text-gray-400",children:[e.jsx(Dr,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"max-w-[120px] truncate",children:k.name})]}),e.jsx("div",{className:_("flex items-center gap-1",o?"text-gray-400":eo(t.dueDate||null)),children:E?e.jsx(Ys,{className:"w-3.5 h-3.5"}):D?e.jsxs(e.Fragment,{children:[e.jsx(st,{className:"w-3.5 h-3.5"}),e.jsx("span",{className:"hidden sm:inline",children:Jn(t.dueDate||null)})]}):null})]}),e.jsx("div",{className:_("flex items-center gap-1 transition-opacity shrink-0",i?"opacity-100":"opacity-0 group-hover:opacity-100 placeholder-opacity"),children:e.jsx("button",{onClick:y,className:_("p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",i?"text-yellow-500":"text-gray-400"),title:i?"é‡è¦åº¦ã‚’è§£é™¤":"é‡è¦ã¨ã—ã¦ãƒžãƒ¼ã‚¯",children:e.jsx(wt,{className:"w-4 h-4",fill:i?"currentColor":"none"})})})]}),u&&e.jsxs(Ct,{x:u.x,y:u.y,onClose:()=>g(null),children:[e.jsxs(Ho,{label:a("date_change")||"æ—¥ä»˜å¤‰æ›´",icon:e.jsx(st,{}),children:[e.jsx(ie,{onClick:()=>j("today"),children:a("today")}),e.jsx(ie,{onClick:()=>j("tomorrow"),children:a("tomorrow")}),e.jsx(ie,{onClick:()=>j("next_week"),children:a("next_week")||"æ¥é€±"}),e.jsx(ie,{onClick:()=>j("no_date"),children:a("no_date")||"æœŸé™ãªã—"})]}),e.jsx(ie,{onClick:h,icon:e.jsx(rt,{}),children:a("edit")}),e.jsx(ie,{onClick:v,variant:"danger",icon:e.jsx(De,{}),children:a("delete")})]})]})},(t,r)=>{const s=a=>a?a instanceof Date?a.getTime():typeof a.toDate=="function"?a.toDate().getTime():typeof a.getTime=="function"?a.getTime():null:null,n=(a,o)=>{const i=s(a),l=s(o);return i===l};return t.task.id===r.task.id&&t.task.status===r.task.status&&t.task.title===r.task.title&&t.task.description===r.task.description&&t.task.projectId===r.task.projectId&&t.task.timeBlockId===r.task.timeBlockId&&t.task.isImportant===r.task.isImportant&&t.task.recurrence===r.task.recurrence&&n(t.task.dueDate,r.task.dueDate)}),Rt=({tasks:t,timeBlockId:r})=>{const{t:s}=B(),{timeBlocks:n}=Oe(),a=t.reduce((g,f)=>{const y=f.duration,m=typeof y=="number"?y:Number(y);return g+(isNaN(m)?0:m)},0),o=g=>(g/60).toFixed(2)+"h",i=r?n.find(g=>g.id===r):null;if(i&&i.start&&i.end){const g=so(i.start,i.end);if(g<=0)return null;const f=(g/60).toFixed(2),y=(a/60).toFixed(2),m=a/g*100,h=Math.min(m,100),v=g-a,j=v<0,x=(Math.abs(v)/60).toFixed(2),k=m>100;return e.jsxs("div",{className:"glass-card flex items-center gap-4 py-3 px-4 my-2",children:[e.jsx("div",{className:"flex-shrink-0 w-24 truncate text-xs font-bold text-gray-500 dark:text-gray-400",title:i.name,children:i.name}),e.jsxs("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums",children:[e.jsxs("span",{className:"font-bold text-gray-700 dark:text-gray-300 w-[4.5ch] text-right inline-block",children:[y,"h"]}),e.jsx("span",{className:"text-gray-400 mx-0.5",children:"/"}),e.jsxs("span",{className:"w-[4.5ch] inline-block",children:[f,"h"]})]}),e.jsx("div",{className:"flex-1 relative h-3 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[100px]",children:e.jsx("div",{className:_("h-full rounded-full transition-all duration-500 ease-out shadow-sm",k?"bg-red-500":"bg-gradient-to-r from-blue-500 to-indigo-600"),style:{width:k?"100%":`${h}%`}})}),e.jsxs("div",{className:"flex-shrink-0 flex items-center justify-end gap-3 min-w-[140px]",children:[e.jsxs("div",{className:_("text-lg font-bold tabular-nums text-right w-[3.5ch]",k?"text-red-500":"text-blue-500"),children:[Math.round(m),e.jsx("span",{className:"text-xs font-normal opacity-70",children:"%"})]}),e.jsxs("div",{className:_("text-xs whitespace-nowrap text-right w-[100px]",j?"text-red-500":"text-green-500"),children:["(",s(j?"task_stats.over":"task_stats.remaining")," ",x,"h)"]})]})]})}const l=t.length,c=l>0?a/l:0,d=s("task_stats.count_unit"),u=s("task_stats.avg_unit");return e.jsxs("div",{className:"glass-card flex items-center justify-evenly py-3 px-4 my-2",children:[e.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.count_label")}),e.jsxs("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200",children:[l,d&&e.jsx("span",{className:"text-xs font-normal ml-0.5 text-gray-400",children:d})]})]}),e.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.total_label")}),e.jsx("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200 text-blue-600 dark:text-blue-400",children:o(a)})]}),e.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),e.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[e.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:s("task_stats.avg_label")}),e.jsxs("span",{className:"font-medium text-sm",children:[o(c),e.jsx("span",{className:"text-xs ml-0.5",children:u})]})]})]})},ci=({task:t,className:r})=>{const{attributes:s,listeners:n,setNodeRef:a,transform:o,transition:i,isDragging:l}=Ot({id:`${O.DND.PREFIX_TASK}${t.id||""}`,data:{type:"task",task:t}}),c={transform:Pt.Transform.toString(o),transition:i,zIndex:l?50:"auto",position:"relative"};return e.jsx("div",{ref:a,style:c,className:"touch-manipulation",children:e.jsx(Xr,{task:t,className:_(r,l&&"opacity-80 shadow-lg border-blue-400 bg-blue-50/50"),dragHandleProps:{...s,...n}})})},Jr=()=>{const{t}=B(),{tasks:r,loading:s}=Je(),{filterType:n,targetId:a,query:o,showCompleted:i,sortCriteria:l,setShowCompleted:c,setSortCriteria:d}=ge(),{density:u}=X(),{openModal:g}=G(),f=p.useMemo(()=>o&&o.trim().length>0?{keyword:o,showCompleted:i,projectId:null,labelId:null,timeBlockId:null,duration:null,filterType:"all_tasks",savedFilter:null,sortCriteria:l}:{keyword:o,showCompleted:i,projectId:n==="inbox"?"unassigned":n==="project"?a:null,labelId:n==="label"?a:null,timeBlockId:n==="timeblock"?a:null,duration:n==="duration"?a:null,filterType:n,savedFilter:null,sortCriteria:l},[n,a,o,i,l]),y=p.useMemo(()=>Yr(r,f),[r,f]),m={compact:"space-y-1",normal:"space-y-2",comfortable:"space-y-3",spacious:"space-y-4"}[u];ys({onDragEnd:async x=>{const{active:k,over:E}=x;if(!E||k.id===E.id)return;const D=String(k.id),F=String(E.id);if(!D.startsWith(O.DND.PREFIX_TASK)||!F.startsWith(O.DND.PREFIX_TASK))return;const C=D.replace(O.DND.PREFIX_TASK,""),T=F.replace(O.DND.PREFIX_TASK,"");if(l!=="manual")return;const b=y.findIndex(M=>M.id===C),A=y.findIndex(M=>M.id===T);if(b!==-1&&A!==-1){const $=kt(y,b,A).map(V=>V.id).filter(Boolean);await ho($)}}});const h=!!(o&&o.trim().length>0);if(s&&!h&&r.length===0)return e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("div",{className:"text-gray-400 text-sm animate-pulse",children:t("task_list.loading")})});const j=l==="manual";return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden relative",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-1 pb-24",children:[e.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm pt-2 pb-4 mb-4 flex items-center gap-2",children:[e.jsx("div",{className:"flex-1",children:h?e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[e.jsx(Ht,{className:"w-4 h-4"}),t("task_list.searching_results",{query:o||""})]}):e.jsx(li,{initialValue:""})}),e.jsx("div",{className:"flex items-center gap-2 px-1",children:e.jsxs("select",{name:"sortCriteria","aria-label":t("task_list.sort_options")||"Sort Options",value:l,onChange:x=>d(x.target.value),className:"text-xs bg-transparent border-none outline-none text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 cursor-pointer font-medium focus:ring-0",children:[e.jsx("option",{value:"manual",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:t("task_list.sort_manual")}),e.jsx("option",{value:"createdAt_desc",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:t("task_list.sort_created")}),e.jsx("option",{value:"dueDate_asc",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:t("task_list.sort_due")}),e.jsx("option",{value:"important_desc",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:t("task_list.sort_important")}),e.jsx("option",{value:"title_asc",className:"bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100",children:t("task_list.sort_title")})]})}),e.jsx("button",{onClick:()=>c(!i),className:_("px-3 py-2 rounded-lg text-xs font-medium border transition-colors shrink-0",i?"bg-blue-50 text-blue-600 border-blue-200 dark:bg-blue-900/20 dark:border-blue-800 dark:text-blue-300":"bg-white text-gray-500 border-gray-200 hover:bg-gray-50 dark:bg-gray-800 dark:border-gray-700 dark:text-gray-400"),title:t(i?"task_list.hide_completed":"task_list.show_completed"),children:t(i?"task_list.hide_completed":"task_list.show_completed")})]}),y.length===0?e.jsxs("div",{className:"text-center py-20 flex flex-col items-center justify-center min-h-[60vh]",children:[e.jsxs("div",{className:"relative mb-8",children:[e.jsx("div",{className:"absolute -inset-4 bg-blue-500/10 dark:bg-blue-400/10 blur-3xl rounded-full"}),e.jsx("div",{className:"relative",children:e.jsx(jt,{className:"w-24 h-24 text-blue-200 dark:text-blue-900/50",strokeWidth:1.5})})]}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:t("task_list.no_tasks_title")}),e.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs mb-8",children:t(i?"task_list.no_tasks_desc_showing":"task_list.no_tasks_desc_hiding")}),e.jsxs("button",{onClick:()=>g("task-detail",{title:""}),className:"btn-premium flex items-center gap-2",children:[e.jsx(tt,{className:"w-5 h-5"}),t("task_list.add_new_task")]})]}):j?e.jsx(bt,{items:y.map(x=>`${O.DND.PREFIX_TASK}${x.id||""}`),strategy:yt,children:e.jsx("div",{className:_("transition-all duration-200",m),children:y.map(x=>e.jsx(ci,{task:x},x.id))})}):e.jsx("ul",{className:_("transition-all duration-200",m),children:y.map(x=>e.jsx(Xr,{task:x},x.id))})]}),e.jsx("div",{className:"flex-none mt-auto pt-2 border-t border-gray-100 dark:border-gray-800 bg-white/50 dark:bg-gray-900/50 backdrop-blur pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:e.jsx(Rt,{tasks:y,timeBlockId:f.timeBlockId})})]})},di=()=>{const{t}=B(),{tasks:r}=Je(),{timeBlocks:s}=Oe(),n=Gr(),{density:a}=X();r.length,r.filter(i=>i.status==="completed").length;const o=[{id:"inbox",label:t("inbox"),count:n.inbox,icon:Tr,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{id:"today",label:t("today"),count:n.today,icon:st,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},{id:"upcoming",label:t("upcoming"),count:n.upcoming,icon:Sr,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},{id:"important",label:t("important"),count:n.important,icon:wt,color:"text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/20"}];return e.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar p-6 space-y-8",children:[e.jsxs("header",{className:"mb-4",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:t("dashboard")}),e.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:[t("task_list.sort_manual")," "]})]}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:o.map(i=>e.jsxs("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:i.label}),e.jsx("p",{className:"text-2xl font-black text-gray-800 dark:text-gray-100 tabular-nums",children:i.count})]}),e.jsx("div",{className:`p-3 rounded-lg ${i.bg}`,children:e.jsx(i.icon,{className:`w-6 h-6 ${i.color}`})})]},i.id))}),e.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded-xl p-4 border border-gray-100 dark:border-gray-800",children:[e.jsx("h2",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:"Overall Statistics"}),e.jsx(Rt,{tasks:r.filter(i=>i.status!=="completed"),timeBlockId:null})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:"Time Block Usage"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map(i=>{const l=r.filter(c=>c.timeBlockId===i.id&&c.status!=="completed");return l.length===0?null:e.jsx("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm",children:e.jsx(Rt,{tasks:l,timeBlockId:i.id||null})},i.id)})})]})]})},ui=()=>{const{t}=B(),{query:r,setSearchQuery:s,setFilter:n}=ge(),{setView:a}=ae(),[o,i]=p.useState(r),l=p.useRef(null);p.useEffect(()=>{var g;(g=l.current)==null||g.focus()},[]),p.useEffect(()=>{r!==o&&i(r)},[r]),p.useEffect(()=>{const g=setTimeout(()=>{o!==r&&s(o)},150);return()=>{clearTimeout(g)}},[o,r,s]);const c=g=>{i(g.target.value)},d=()=>{var g;i(""),s(""),(g=l.current)==null||g.focus()},u=()=>{s(""),n("inbox"),a("tasks")};return e.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-br from-slate-50 via-white to-blue-50/30 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800",children:[e.jsxs("div",{className:"relative p-4 sm:p-6 border-b border-gray-100 dark:border-gray-800",children:[e.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0"}),e.jsxs("div",{className:"relative z-10 max-w-3xl mx-auto",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("button",{onClick:u,className:"p-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-xl transition-all hover:scale-105 active:scale-95","aria-label":t("close"),children:e.jsx("svg",{className:"w-5 h-5 text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})})}),e.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:t("sidebar.search_placeholder")})]}),e.jsxs("div",{className:"relative group",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity duration-300"}),e.jsx("div",{className:"relative bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-lg shadow-gray-200/50 dark:shadow-black/20 overflow-hidden",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"pl-4 text-gray-400",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})}),e.jsx("input",{ref:l,id:"search-input",name:"search",type:"text",value:o,onChange:c,placeholder:t("sidebar.search_placeholder"),className:"w-full bg-transparent py-4 px-3 text-base text-gray-800 dark:text-gray-100 placeholder-gray-400 outline-none"}),o&&e.jsx("button",{type:"button",onClick:d,className:"p-2 mr-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors","aria-label":t("clear"),children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})})]}),!o&&e.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-400",children:[e.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 font-mono",children:"/"}),e.jsx("span",{children:t("search_view.tips")})]}),o&&e.jsxs("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),t("search_view.results_for",{query:o})]})]})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:o?e.jsx(Jr,{}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500 p-8",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full blur-2xl"}),e.jsx("div",{className:"relative w-24 h-24 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center mb-6",children:e.jsx("svg",{className:"w-12 h-12 text-gray-400 dark:text-gray-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"1.5",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})})})]}),e.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300 mb-2",children:t("search_view.empty_title")}),e.jsx("p",{className:"text-sm text-center max-w-xs opacity-75",dangerouslySetInnerHTML:{__html:t("search_view.empty_desc")}})]})})]})},gi=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=p.useCallback(c=>!t||!r?()=>{}:Vn(t,c),[t,r]),a=t?Kn(t):!1,{data:o,isPending:i}=$e(["targets",r||void 0,t||void 0],n,t&&a?Un(t):void 0);return{targets:o||[],loading:s||!!t&&i}},mi=U.memo(({kgi:t,currentTab:r,onTabChange:s,collapsed:n,onToggleCollapse:a})=>{const{language:o}=X(),{t:i}=fe(o),l={good:"text-emerald-500",warning:"text-amber-500",danger:"text-red-500"},c={good:"bg-emerald-500",warning:"bg-amber-500",danger:"bg-red-500"},d=l[t.status]||"text-gray-500",u=c[t.status]||"bg-gray-500",g=[{id:"backward",label:i("backward_map"),icon:"ðŸ—ºï¸"},{id:"woop",label:i("woop_board"),icon:"âœ¨"},{id:"okr",label:i("okr_tree"),icon:"ðŸŽ¯"}];return e.jsx("div",{className:`mb-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg transition-all duration-300 mx-4 mt-4 ${n?"py-2":"py-4"}`,children:e.jsxs("div",{className:"px-6 flex items-center justify-between gap-6",children:[e.jsx("div",{className:"flex-1 min-w-0",children:e.jsx("h1",{className:`font-bold text-gray-900 dark:text-white truncate transition-all duration-300 ${n?"text-sm opacity-50":"text-base"}`,children:t.title})}),e.jsx("div",{className:"flex-1 max-w-md hidden sm:block",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex-1",children:e.jsx("div",{className:"h-3 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",children:e.jsx("div",{style:{width:`${t.progress}%`},className:`h-full ${u} transition-all duration-1000 ease-out rounded-full`})})}),e.jsxs("span",{className:`font-black ${d} tabular-nums text-sm whitespace-nowrap`,children:[t.progress,"%"]})]})}),e.jsxs("div",{className:"flex items-center gap-6 flex-shrink-0",children:[e.jsxs("div",{className:"text-center hidden sm:block",children:[e.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:i("target_dashboard.days_left")}),e.jsxs("div",{className:`font-black ${d} tabular-nums`,children:[t.daysLeft,e.jsx("span",{className:"text-xs font-medium ml-0.5 text-gray-400",children:i("target_dashboard.days_unit")})]})]}),e.jsx("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-900/50 p-1 rounded-lg",children:g.map(f=>e.jsxs("button",{onClick:()=>s(f.id),className:`group px-3 py-1.5 rounded-md text-xs font-bold transition-all flex flex-col sm:flex-row items-center gap-1 sm:gap-2 ${r===f.id?"bg-white dark:bg-gray-700 shadow-sm text-gray-900 dark:text-white":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}`,title:f.label,children:[e.jsx("span",{className:"text-sm sm:text-base leading-none",children:f.icon}),e.jsx("span",{className:"text-[10px] sm:text-xs leading-none",children:f.label})]},f.id))}),e.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",title:i(n?"target_dashboard.header_expand":"target_dashboard.header_collapse"),children:e.jsx(Ks,{className:`w-4 h-4 text-gray-500 transition-transform duration-300 ${n?"rotate-180":""}`})})]})]})})}),hi=U.memo(({data:t})=>{const{t:r}=B();return!t||!t.milestones?e.jsx("div",{className:"p-4 text-center text-gray-500",children:r("target_dashboard.loading_error")}):e.jsxs("div",{className:"max-w-4xl mx-auto relative pb-10",children:[e.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700 -translate-x-1/2"}),t.milestones.map((s,n)=>{const a=s.type==="goal",o=s.type==="current",i=s.completed;let l,c="";return a?(l=e.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-400 text-white flex items-center justify-center text-base shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"ðŸ†"}),c="bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700"):o?(l=e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 animate-pulse relative",children:r("target_dashboard.backward.now_icon")}),c="border-blue-500 border-2 shadow-md"):i?(l=e.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs shadow ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"âœ“"}),c="bg-gray-50 dark:bg-gray-800 opacity-70"):(l=e.jsx("div",{className:"w-5 h-5 rounded-full bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative"}),c="bg-white dark:bg-gray-800"),e.jsxs("div",{className:"relative flex items-center mb-4 animate-fade-in group",style:{animationDelay:`${n*50}ms`},children:[e.jsx("div",{className:"w-16 flex-shrink-0 flex justify-center items-center z-10",children:l}),e.jsx("div",{className:"flex-1 pr-4 min-w-0",children:e.jsx("div",{className:`px-3 py-3 rounded-lg border ${o&&!c.includes("border-2")?"border-2 border-blue-500":o?"":"border-gray-200 dark:border-gray-700"} ${c} shadow-sm transition-all hover:shadow-md hover:translate-x-1 cursor-pointer`,children:e.jsxs("div",{className:"flex items-center justify-between gap-3",children:[e.jsx("span",{className:`text-xs font-bold ${o?"text-blue-600":"text-gray-500"} flex-shrink-0 font-mono`,children:s.date}),e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white flex-1 truncate text-sm md:text-base",children:s.title}),a&&e.jsx("span",{className:"text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-bold flex-shrink-0",children:r("target_dashboard.backward.target_label")}),o&&e.jsx("span",{className:"text-[10px] text-blue-500 font-bold flex-shrink-0",children:r("target_dashboard.backward.now_label")})]})})})]},s.id||`milestone-${n}`)})]})}),xi=U.memo(({data:t})=>{const{t:r}=B();if(!t||!t.keyResults)return e.jsx("div",{className:"p-4 text-center text-gray-500",children:r("target_dashboard.loading_error")});const s=n=>n==="high"?"bg-emerald-500":n==="medium"?"bg-amber-500":"bg-red-500";return e.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-2xl border-2 border-blue-100 dark:border-blue-900 shadow-lg text-center mb-12 relative z-10 transition-transform hover:scale-[1.01]",children:[e.jsx("div",{className:"absolute top-[-15px] left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-md",children:r("target_dashboard.okr.objective_label")}),e.jsxs("h2",{className:"font-black text-2xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 leading-tight",children:['"',t.objective,'"']}),e.jsx("div",{className:"absolute bottom-[-50px] left-1/2 w-1 h-[50px] bg-gray-200 dark:bg-gray-700 z-0"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 relative",children:[e.jsx("div",{className:"hidden md:block absolute top-[-25px] left-[16.66%] right-[16.66%] h-1 bg-gray-200 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700 rounded-t-xl z-0"}),t.keyResults.map(n=>{const a=n.target>0?Math.round(n.current/n.target*100):0,o=s(n.confidence);return e.jsxs("div",{className:"relative pt-6",children:[e.jsx("div",{className:"absolute top-[-25px] left-1/2 w-1 h-[25px] bg-gray-200 dark:bg-gray-700 md:block hidden"}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-700 transition-all group h-full flex flex-col",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[r("target_dashboard.okr.kr_prefix"),n.id]}),e.jsx("div",{className:`w-3 h-3 rounded-full ${o}`,title:`Confidence: ${n.confidence}`})]}),e.jsx("h4",{className:"font-bold text-gray-800 dark:text-gray-200 mb-4 h-12 line-clamp-2",children:n.text}),e.jsxs("div",{className:"space-y-1 mt-auto",children:[e.jsxs("div",{className:"flex justify-between text-xs font-bold text-gray-500 dark:text-gray-400",children:[e.jsx("span",{children:n.current}),e.jsx("span",{children:n.target})]}),e.jsx("div",{className:"h-2 w-full bg-gray-100 dark:bg-gray-900 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${a}%`}})}),e.jsxs("div",{className:"text-right text-sm font-black text-blue-600 mt-1",children:[a,"%"]})]})]})]},n.id)})]})]})}),pi=U.memo(({data:t})=>{const{t:r}=B();return!t||!t.obstacles?e.jsx("div",{className:"p-4 text-center text-gray-500",children:r("target_dashboard.loading_error")}):e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto animate-fade-in",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/30 dark:to-blue-900/30 p-6 rounded-2xl border border-indigo-100 dark:border-indigo-800 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-sm font-bold text-indigo-500 uppercase mb-2",children:r("target_dashboard.woop.wish_label")}),e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',t.wish,'"']})]}),e.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900/30 dark:to-rose-900/30 p-6 rounded-2xl border border-pink-100 dark:border-pink-800 shadow-sm hover:shadow-md transition-shadow",children:[e.jsx("h3",{className:"text-sm font-bold text-pink-500 uppercase mb-2",children:r("target_dashboard.woop.outcome_label")}),e.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',t.outcome,'"']})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-2 flex items-center",children:[e.jsx("span",{className:"mr-2",children:"ðŸš§"})," ",r("target_dashboard.woop.obstacles_header")]}),t.obstacles.map(s=>e.jsxs("div",{className:"group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all overflow-hidden relative",children:[e.jsx("div",{className:"p-5 border-l-4 border-gray-400 bg-gray-50 dark:bg-gray-800 relative z-10 transition-transform group-hover:translate-x-1",children:e.jsxs("h4",{className:"font-bold text-gray-700 dark:text-gray-300 flex items-center",children:[e.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 text-xs px-2 py-1 rounded mr-3 text-gray-600 dark:text-gray-400",children:r("target_dashboard.woop.obstacle_badge")}),s.text]})}),e.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-t border-gray-100 dark:border-gray-700 flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 mt-1",children:e.jsx("span",{className:"block w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs font-bold",children:r("target_dashboard.woop.if_badge")})}),e.jsx("div",{className:"ml-3 flex-1",children:e.jsxs("p",{className:"text-emerald-800 dark:text-emerald-300 font-bold text-sm",children:["â†’ ",s.plan]})}),e.jsxs("div",{className:"ml-2 flex flex-col items-center",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:r("target_dashboard.woop.score_label")}),e.jsx("span",{className:"text-lg font-black text-emerald-500 leading-none",children:s.overcomeCount})]})]})]},s.id)),e.jsx("button",{className:"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl text-gray-400 hover:border-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition flex items-center justify-center font-bold text-sm",children:r("target_dashboard.woop.add_obstacle")})]})]})}),fi=()=>{var m;const{t}=B(),{targets:r}=gi(),[s,n]=p.useState("backward"),[a,o]=p.useState(!1),i=r.filter(h=>{var v;return((v=h.mode)==null?void 0:v.toLowerCase())===s.toLowerCase()}),l=h=>({milestones:[{date:"Future",title:h.data.goal_kgi||"Undefined Goal",type:"goal",completed:!1},{date:"Milestone",title:h.data.milestone_minus_1mo||"",type:"milestone",completed:!1},{date:"Today",title:"Current Status",type:"current",completed:!0},{date:"Now",title:h.data.first_action||"",type:"action",completed:!1}]}),c=h=>({wish:h.data.wish||"",outcome:h.data.outcome||"",obstacles:[{id:1,text:h.data.obstacle||"",plan:h.data.plan||"",overcomeCount:0}]}),d=h=>({objective:h.data.objective||"",keyResults:[{id:1,text:h.data.kr_1||"KR 1",current:0,target:100,confidence:"medium"},{id:2,text:h.data.kr_2||"KR 2",current:0,target:100,confidence:"medium"},{id:3,text:h.data.kr_3||"KR 3",current:0,target:100,confidence:"medium"}]}),u=()=>i.length===0?e.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:e.jsx("p",{className:"mb-4",children:t("target_dashboard.no_targets",{mode:s.toUpperCase()})})}):e.jsx("div",{className:"space-y-12",children:i.map(h=>{var v;return e.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-12 last:border-0",children:[e.jsx("div",{className:"mb-4 text-xs text-gray-400 flex justify-end",children:t("target_dashboard.created_at",{date:((v=Y(h.createdAt))==null?void 0:v.toLocaleDateString())||"Unknown"})}),s==="backward"&&e.jsx(hi,{data:l(h)}),s==="woop"&&e.jsx(pi,{data:c(h)}),s==="okr"&&e.jsx(xi,{data:d(h)})]},h.id)})}),g=i[0],y={title:((h,v)=>h?v==="backward"?h.data.goal_kgi||t("target_dashboard.kgi_default"):v==="woop"?h.data.wish||t("target_dashboard.wish_default"):v==="okr"?h.data.objective||t("target_dashboard.obj_default"):t("target_dashboard.target_default"):t("target_dashboard.title_default"))(g,s),progress:Number(((m=g==null?void 0:g.data)==null?void 0:m.progress)||0),daysLeft:0,status:"good"};return e.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[e.jsx(mi,{kgi:y,currentTab:s,onTabChange:n,collapsed:a,onToggleCollapse:()=>o(!a)}),e.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-6 pb-6 pt-4",children:u()})]})},bi=[{id:"okr",title:"OKR (Objectives and Key Results)",subTitle:"é‡Žå¿ƒçš„ãªç›®æ¨™ã¨æˆæžœæŒ‡æ¨™",color:"blue",icon:"ðŸŽ¯",concept:{summary:"ã€Œä½•ã‚’é”æˆã—ãŸã„ã‹ï¼ˆObjectiveï¼‰ã€ã¨ã€Œã©ã†ã‚„ã£ã¦é”æˆã‚’æ¸¬ã‚‹ã‹ï¼ˆKey Resultsï¼‰ã€ã‚’ã‚»ãƒƒãƒˆã§ç®¡ç†ã™ã‚‹æ‰‹æ³•ã€‚",detail:"Googleã‚„Intelã‚‚æŽ¡ç”¨ã™ã‚‹ç›®æ¨™ç®¡ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚60-70%ã®é”æˆåº¦ã§æˆåŠŸã¨ã¿ãªã™ã€Œãƒ ãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãªç›®æ¨™è¨­å®šãŒç‰¹å¾´ã§ã€ç¾çŠ¶ç¶­æŒã§ã¯ãªãé£›èºçš„ãªæˆé•·ã‚’ä¿ƒã—ã¾ã™ã€‚"},useCases:[{title:"ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å€‹äººã®ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—",before:"æ¼ ç„¶ã¨ã€ŒæŠ€è¡“åŠ›ã‚’ä¸Šã’ãŸã„ã€ã¨è€ƒãˆã€æ‰‹å½“ãŸã‚Šæ¬¡ç¬¬ã«æœ¬ã‚’èª­ã‚€ãŒèº«ã«ã¤ã‹ãªã„ã€‚",after:"O:ã€Œãƒãƒ¼ãƒ ã®Rustç§»è¡Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹å­˜åœ¨ã«ãªã‚‹ã€ KR:ã€ŒRustã§ãƒžã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’1ã¤å®Ÿè£…ã™ã‚‹ã€ã€Œç¤¾å†…å‹‰å¼·ä¼šã‚’3å›žé–‹å‚¬ã™ã‚‹ã€ã¨è¨­å®šã—ã€å­¦ç¿’ã®ç„¦ç‚¹ãŒå®šã¾ã£ãŸã€‚"},{title:"å‰¯æ¥­ãƒ»å€‹äººé–‹ç™º",before:"ã€Œã„ã¤ã‹ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã„ã€ã¨æ€ã„ã¤ã¤ã€ãƒ€ãƒ©ãƒ€ãƒ©ã¨é–‹ç™ºã‚’ç¶šã‘ã¦ã—ã¾ã†ã€‚",after:"O:ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ„›ã•ã‚Œã‚‹MVPã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã€ KR:ã€Œ3æœˆæœ«ã¾ã§ã«ã‚¹ãƒˆã‚¢å…¬é–‹ã€ã€ŒåˆæœŸãƒ¦ãƒ¼ã‚¶ãƒ¼100äººç²å¾—ã€ã€Œé€±æ¬¡ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŽ‡30%é”æˆã€ã¨æœŸé™ã¨æ•°å­—ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸã€‚"}],tips:[{q:"ç›®æ¨™ãŒé«˜ã™ãŽã¦ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¶šãã¾ã›ã‚“ã€‚",a:"OKRã¯ã€Œé”æˆã§ããªãã¦ã‚‚ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒãªã„ã€ã®ãŒå‰æã§ã™ã€‚60%é”æˆã§ãã‚Œã°å¾¡ã®å­—ã¨è€ƒãˆã€å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨è‡ªä½“ã‚’è©•ä¾¡ã—ã¾ã—ã‚‡ã†ã€‚é€²æ—ã¯é€±æ¬¡ã§ãƒã‚§ãƒƒã‚¯ã—ï¼ˆWinã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã€å°ã•ãªå‰é€²ã‚’ç¥ã†ã“ã¨ãŒé‡è¦ã§ã™ã€‚"},{q:"KRï¼ˆæˆæžœæŒ‡æ¨™ï¼‰ã®æ•°å­—ã¯ã©ã†æ±ºã‚ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œé ‘å¼µã‚Œã°é”æˆã§ãã‚‹ï¼ˆ50%ï¼‰ã€ã¨ã€Œã‹ãªã‚Šé‹ãŒè‰¯ããªã„ã¨ç„¡ç†ï¼ˆ100%ï¼‰ã€ã®é–“ã€ã€Œå°‘ã—èƒŒä¼¸ã³ãŒå¿…è¦ï¼ˆ70%ï¼‰ã€ãªãƒ©ã‚¤ãƒ³ã‚’ç‹™ã„ã¾ã—ã‚‡ã†ã€‚è¨ˆæ¸¬ä¸å¯èƒ½ãªã€Œã€œã‚’é ‘å¼µã‚‹ã€ã¯NGã§ã™ã€‚"}]},{id:"woop",title:"WOOP (Wish, Outcome, Obstacle, Plan)",subTitle:"ç§‘å­¦çš„ãªé¡˜æœ›å®Ÿç¾ãƒ¡ã‚½ãƒƒãƒ‰",color:"amber",icon:"âœ¨",concept:{summary:"ã€Œæœ€é«˜ã®æœªæ¥ã€ã¨ã€Œç¾å®Ÿã®éšœå®³ã€ã‚’å¯¾æ¯”ã•ã›ã€è„³ã‚’æœ¬æ°—ã«ã•ã›ã‚‹ï¼ˆãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰ã€‚",detail:"ãŸã ãƒã‚¸ãƒ†ã‚£ãƒ–ã«è€ƒãˆã‚‹ã ã‘ã§ãªãã€ãã‚Œã‚’é˜»ã‚€è‡ªåˆ†ã®å†…é¢ã®éšœå®³ã‚’ç›´è¦–ã—ã€ã€ŒIf-Thenãƒ—ãƒ©ãƒ³ï¼ˆã‚‚ã—XãŒèµ·ããŸã‚‰Yã™ã‚‹ï¼‰ã€ã‚’äº‹å‰ã«ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€å®Ÿè¡ŒçŽ‡ã‚’é£›èºçš„ã«é«˜ã‚ã¾ã™ã€‚"},useCases:[{title:"æ¯Žæ—¥ã®é‹å‹•ç¿’æ…£",before:"ã€Œç—©ã›ãŸã„ã€ã¨æ€ã†ã ã‘ã§ã€ä»•äº‹ã§ç–²ã‚Œã‚‹ã¨ã€Œä»Šæ—¥ã¯ã„ã„ã‚„ã€ã¨ã‚µãƒœã£ã¦ã—ã¾ã†ã€‚",after:"W:ã€Œæ¯Žæ—¥30åˆ†èµ°ã‚‹ã€ O:ã€Œä½“ãŒè»½ããªã‚Šã€è‡ªä¿¡ãŒã¤ãã€ Obs:ã€Œä»•äº‹å¸°ã‚Šã®ç–²åŠ´æ„Ÿã€ Plan:ã€Œã‚‚ã—ã€Žç–²ã‚ŒãŸã€ã¨æ„Ÿã˜ãŸã‚‰ã€ã€Žã¨ã‚Šã‚ãˆãšã‚¦ã‚§ã‚¢ã«ç€æ›¿ãˆã‚‹ã€ã€ã¨æ±ºã‚ã¦ãŠãã“ã¨ã§ã€è‡ªå‹•çš„ã«è¡Œå‹•ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚"},{title:"è³‡æ ¼è©¦é¨“ã®å‹‰å¼·",before:"ã‚¹ãƒžãƒ›ã®é€šçŸ¥ãŒæ°—ã«ãªã£ã¦é›†ä¸­åŠ›ãŒé€”åˆ‡ã‚Œã¦ã—ã¾ã†ã€‚",after:"Obs:ã€Œã‚¹ãƒžãƒ›ã‚’è¦‹ã¦ã—ã¾ã†ç™–ã€ Plan:ã€Œã‚‚ã—ã€Žå‹‰å¼·ã‚’å§‹ã‚ã‚‹ã€æ™‚ã¯ã€ã€Žã‚¹ãƒžãƒ›ã‚’åˆ¥ã®éƒ¨å±‹ã«ç½®ãã€ã€ã¨ã„ã†ã‚»ãƒƒãƒˆè¡Œå‹•ã‚’å¾¹åº•ã—ã€é›†ä¸­æ™‚é–“ã‚’ç¢ºä¿ã—ãŸã€‚"}],tips:[{q:"éšœå®³ï¼ˆObstacleï¼‰ã«ã¯ä½•ã‚’æ›¸ã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œæ™‚é–“ãŒãªã„ã€ã€ŒãŠé‡‘ãŒãªã„ã€ã¨ã„ã£ãŸå¤–éƒ¨è¦å› ã§ã¯ãªãã€ã€Œã¤ã„ãƒ€ãƒ©ãƒ€ãƒ©ã—ã¦ã—ã¾ã†ã€ã€Œå¤±æ•—ã™ã‚‹ã®ãŒæ€–ã„ã€ã¨ã„ã£ãŸã€Žè‡ªåˆ†ã®å†…é¢ã«ã‚ã‚‹æ„Ÿæƒ…ã‚„ç™–ã€ã‚’æŽ¢ã‚Šã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã“ããŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å¯èƒ½ãªçœŸã®éšœå®³ã§ã™ã€‚"},{q:"è¨ˆç”»ï¼ˆPlanï¼‰ãŒã†ã¾ãæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚",a:"ã€Œã‚‚ã—ã€œãªã‚‰ã€ã®æ¡ä»¶ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰ã‚’ã‚‚ã£ã¨å…·ä½“çš„ã«ã—ã¾ã—ã‚‡ã†ã€‚ã€Œç–²ã‚ŒãŸã‚‰ã€ã‚ˆã‚Šã‚‚ã€Œå¸°å®…ã—ã¦ã‚½ãƒ•ã‚¡ã‚’è¦‹ãŸçž¬é–“ã€ã®æ–¹ãŒè„³ã¯åå¿œã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ã€Œé ‘å¼µã‚‹ã€ã§ã¯ãªãã€Œ5åˆ†ã ã‘ã‚„ã‚‹ã€ãªã©ãƒãƒ¼ãƒ‰ãƒ«ã‚’æ¥µé™ã¾ã§ä¸‹ã’ã¦ã¿ã¦ãã ã•ã„ã€‚"}]},{id:"backward",title:"Backward Design (é€†ç®—æ€è€ƒ)",subTitle:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰ç¾åœ¨åœ°ã¸ã®æž¶ã‘æ©‹",color:"purple",icon:"ðŸ—ºï¸",concept:{summary:"ã€Œã‚ã‚ŠãŸã„å§¿ï¼ˆã‚´ãƒ¼ãƒ«ï¼‰ã€ã‹ã‚‰æ™‚é–“ã‚’å·»ãæˆ»ã—ã¦ã€ä»Šã‚„ã‚‹ã¹ãã“ã¨ã‚’æ±ºå®šã™ã‚‹ã€‚",detail:"ç¾åœ¨ã‹ã‚‰ã®ç©ã¿ä¸Šã’ï¼ˆForecastingï¼‰ã§ã¯ãªãã€æœªæ¥ã‹ã‚‰ã®é€†ç®—ï¼ˆBackcastingï¼‰ã‚’è¡Œã†ã“ã¨ã§ã€ç¾çŠ¶ã®å»¶é•·ç·šä¸Šã«ã¯ãªã„é£›èºçš„ãªæˆæžœã‚„ã€ç„¡é§„ã®ãªã„æœ€çŸ­ãƒ«ãƒ¼ãƒˆãŒè¦‹ãˆã¦ãã¾ã™ã€‚é•·æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…é ˆã®è¦–ç‚¹ã§ã™ã€‚"},useCases:[{title:"åŠå¹´å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆä¸»å‚¬",before:"ã¨ã‚Šã‚ãˆãšä¼šå ´ã ã‘æŠ¼ã•ãˆã¦ã€é›†å®¢ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç›´å‰ã«ãªã£ã¦æ…Œã¦ã¦æº–å‚™ã™ã‚‹ã€‚",after:"Goal:ã€Œã‚¤ãƒ™ãƒ³ãƒˆæˆåŠŸã€â†’ 1ãƒ¶æœˆå‰:ã€Œæº€å¸­ã€â†’ 3ãƒ¶æœˆå‰:ã€Œå‘ŠçŸ¥é–‹å§‹ãƒ»LPå®Œæˆã€â†’ ä»Š:ã€Œã‚³ãƒ³ã‚»ãƒ—ãƒˆæ±ºå®šãƒ»ç™»å£‡è€…ã‚ªãƒ•ã‚¡ãƒ¼ã€ã¨ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ç½®ãã€ä»Šæœˆã®å¿…é ˆã‚¿ã‚¹ã‚¯ã‚’æ´—ã„å‡ºã—ãŸã€‚"},{title:"ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸",before:"ä»Šã®ä»•äº‹ãŒå«Œã§è»¢è·ã‚µã‚¤ãƒˆã‚’çœºã‚ã‚‹ãŒã€ç‰¹ã«ã‚¹ã‚­ãƒ«ã‚‚ãªãå‹•ã‘ãªã„ã€‚",after:"Goal:ã€Œ3å¹´å¾Œã«ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ç‹¬ç«‹ã€â†’ 2å¹´å¾Œ:ã€Œå‰¯æ¥­æœˆåŽ20ä¸‡ã€â†’ 1å¹´å¾Œ:ã€Œã‚¹ã‚­ãƒ«ç¿’å¾—ãƒ»ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå®Œæˆã€â†’ ä»Š:ã€Œã‚¹ã‚¯ãƒ¼ãƒ«é¸ã³ãƒ»å­¦ç¿’æ™‚é–“ã®ç¢ºä¿ã€ã¨é€†ç®—ã—ã€å…·ä½“çš„ãªä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸã€‚"}],tips:[{q:"é ã„æœªæ¥ã™ãŽã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãã¾ã›ã‚“ã€‚",a:"ç„¡ç†ã«è©³ç´°ã‚’æ±ºã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ã€Œçµ¶å¯¾ã«ã“ã†ãªã£ã¦ã„ãŸã„ã€ã¨ã„ã†çŠ¶æ…‹ï¼ˆKGIï¼‰ã¨æœŸé™ã‚’æ±ºã‚ã€ãã“ã‹ã‚‰ã€Œãã®ç›´å‰ã¯ã©ã†ãªã£ã¦ã„ã‚‹ã¯ãšã‹ï¼Ÿã€ã¨1ã‚¹ãƒ†ãƒƒãƒ—ãšã¤æˆ»ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ç›´è¿‘ã®ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã ã‘è©³ç´°ã§ã‚ã‚Œã°OKã§ã™ã€‚"},{q:"è¨ˆç”»é€šã‚Šã«é€²ã¾ãªã„æ™‚ã¯ï¼Ÿ",a:"é€†ç®—æ€è€ƒã§ä½œã£ãŸè¨ˆç”»ã¯ã€Œä»®èª¬ã€ã§ã™ã€‚çŠ¶æ³ãŒå¤‰ã‚ã‚Œã°ãƒªãƒ«ãƒ¼ãƒˆï¼ˆå†è¨ˆç®—ï¼‰ã™ã‚Œã°è‰¯ã„ã®ã§ã™ã€‚é‡è¦ãªã®ã¯ã€Œã‚´ãƒ¼ãƒ«ã‚’è¦‹å¤±ã‚ãªã„ã“ã¨ã€ã€‚ç¾åœ¨åœ°ãŒå¤‰ã‚ã£ã¦ã‚‚ã€ãƒŠãƒ“ãŒç›®çš„åœ°ã¸ã®ãƒ«ãƒ¼ãƒˆã‚’å¼•ãç›´ã™ã‚ˆã†ã«ã€è¨ˆç”»ã‚’ä¿®æ­£ã—ç¶šã‘ã¾ã—ã‚‡ã†ã€‚"}]}],yi=U.memo(({framework:t,onClick:r})=>{const{t:s}=B();return e.jsxs("div",{className:"framework-card cursor-pointer bg-white dark:bg-gray-800 rounded-xl border-2 border-gray-200 dark:border-gray-700 p-6 transition-all duration-300 hover:border-blue-500 hover:shadow-lg hover:scale-105 group",onClick:()=>r(t),role:"button",tabIndex:0,onKeyDown:n=>{(n.key==="Enter"||n.key===" ")&&r(t)},children:[e.jsx("div",{className:"text-4xl mb-3 transform transition-transform group-hover:scale-110 duration-300",children:t.icon}),e.jsx("h2",{className:"text-lg font-bold text-gray-900 dark:text-white mb-2",children:t.title}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 line-clamp-2 h-10",children:t.concept.summary}),e.jsxs("div",{className:"mt-4 flex items-center text-xs text-blue-600 dark:text-blue-400 font-medium opacity-80 group-hover:opacity-100 transition-opacity",children:[e.jsx("span",{children:s("wiki.view_details")}),e.jsx("svg",{className:"w-4 h-4 ml-1 transform transition-transform group-hover:translate-x-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})})]})]})}),ki=()=>{const{openModal:t}=G(),{t:r}=B();return e.jsx("div",{className:"h-full bg-gray-50 dark:bg-gray-900 overflow-y-auto custom-scrollbar",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 animate-fade-in",children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center",children:[e.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-500 mr-3",children:e.jsx("svg",{className:"w-8 h-8 text-blue-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})})}),e.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-gray-800 to-gray-600 dark:from-white dark:to-gray-300",children:r("sidebar.framework_wiki")})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:bi.map(s=>e.jsx(yi,{framework:s,onClick:n=>t("wiki-framework",n)},s.id))})]})})},qe={backward:{id:"backward",label:"Backward Design",description:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰é€†ç®—ã—ã¦ã€ç€å®Ÿãªã‚¿ã‚¹ã‚¯ã‚’è¨­è¨ˆã—ã¾ã™ã€‚é•·æœŸçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã™ã€‚",steps:[{title:"Goal / KGI",description:"æœ€çµ‚ã‚´ãƒ¼ãƒ«ã®æ—¥ä»˜ã¨çŠ¶æ…‹ï¼ˆKGIï¼‰ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼š2025å¹´3æœˆ31æ—¥ã¾ã§ã«ã€æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼1ä¸‡äººã‚’é”æˆã™ã‚‹ã€‚",key:"goal_kgi"}]},{title:"Milestone",description:"ã‚´ãƒ¼ãƒ«ã®1ãƒ¶æœˆå‰ã«åˆ°é”ã™ã¹ãçŠ¶æ…‹ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…ãŒå®Œäº†ã—ã€ãƒ™ãƒ¼ã‚¿ç‰ˆã‚’100äººã«é…å¸ƒæ¸ˆã¿ã§ã‚ã‚‹ã€‚",key:"milestone_minus_1mo"}]},{title:"First Action",description:"ä»Šã™ãå§‹ã‚ã‚‹ã¹ãæœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šç«¶åˆã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åˆ†æžã—ã¦æ©Ÿèƒ½ãƒªã‚¹ãƒˆã‚’ä½œã‚‹ã€‚",key:"first_action"}]}]},woop:{id:"woop",label:"WOOP",description:"é¡˜æœ›ã¨éšœå®³ã‚’å¯¾æ¯”ã•ã›ã€å®Ÿè¡Œè¨ˆç”»ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ç¿’æ…£åŒ–ã‚„å›°é›£ãªç›®æ¨™ã«æœ‰åŠ¹ã§ã™ã€‚",steps:[{title:"Wish (é¡˜æœ›)",description:"é”æˆã—ãŸã„ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆæŒ‘æˆ¦çš„ã ãŒé”æˆå¯èƒ½ãªã‚‚ã®ï¼‰",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šæ¯Žæ—¥30åˆ†ã€è‹±èªžã®å‹‰å¼·ã‚’ã™ã‚‹ã€‚",key:"wish"}]},{title:"Outcome (çµæžœ)",description:"ãã‚ŒãŒé”æˆã§ããŸæ™‚ã®ã€Œæœ€é«˜ã®ãƒ¡ãƒªãƒƒãƒˆã€ã‚„æ„Ÿæƒ…ã‚’è©³ã—ãã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šå­—å¹•ãªã—ã§æµ·å¤–ãƒ‰ãƒ©ãƒžã‚’æ¥½ã—ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã€è‡ªä¿¡ãŒã¤ãã€‚",key:"outcome"}]},{title:"Obstacle (éšœå®³)",description:"ãã‚Œã‚’é‚ªé­”ã™ã‚‹ã€ã‚ãªãŸè‡ªèº«ã®ã€Œå†…é¢ã®éšœå®³ã€ï¼ˆæ„Ÿæƒ…ãƒ»ç™–ãƒ»æ€ã„è¾¼ã¿ï¼‰ã¯ä½•ã§ã™ã‹ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä»•äº‹ã§ç–²ã‚Œã¦å¸°ã£ã¦ãã‚‹ã¨ã€ã¤ã„ã‚¹ãƒžãƒ›ã§SNSã‚’è¦‹ã¦ã—ã¾ã†ã€‚",key:"obstacle"}]},{title:"Plan (è¨ˆç”»)",description:"ã€Œã‚‚ã—ï¼ˆéšœå®³ï¼‰ãŒèµ·ããŸã‚‰ã€ï¼ˆè¡Œå‹•ï¼‰ã™ã‚‹ã€ã¨ã„ã†å½¢ã§è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚‚ã—ã€Œç–²ã‚Œã¦ã‚½ãƒ•ã‚¡ã«åº§ã‚Šãã†ã€ã«ãªã£ãŸã‚‰ã€ã€Œã™ãã«ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹ãã€ã¨ã™ã‚‹ã€‚",key:"plan"}]}]},okr:{id:"okr",label:"OKR",description:"é‡Žå¿ƒçš„ãªç›®æ¨™(O)ã¨ã€æ¸¬å®šå¯èƒ½ãªæˆæžœ(KR)ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚çµ„ç¹”ã‚„ãƒãƒ¼ãƒ ã€é«˜ã„æˆé•·ã‚’ç›®æŒ‡ã™å€‹äººã«ã€‚",steps:[{title:"Objective",description:"å®šæ€§çš„ã§ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ã‚ˆã†ãªç›®æ¨™ã‚’1ã¤æ±ºã‚ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä¸–ç•Œä¸­ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«æ„›ã•ã‚Œã‚‹é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹ï¼",key:"objective"}]},{title:"Key Results",description:"ç›®æ¨™é”æˆã‚’æ¸¬ã‚‹ãŸã‚ã®ã€3ã¤ã®å…·ä½“çš„ãªæ•°å­—ï¼ˆæŒ‡æ¨™ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"text",placeholder:"KR 1 (ä¾‹: GitHubã‚¹ã‚¿ãƒ¼æ•° 1,000åˆ°é”)",key:"kr_1"},{type:"text",placeholder:"KR 2 (ä¾‹: é€±é–“ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•° 500å›ž)",key:"kr_2"},{type:"text",placeholder:"KR 3 (ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¶™ç¶šçŽ‡ 40%ç¶­æŒ)",key:"kr_3"}]}]}},vi=({mode:t,currentStep:r})=>{const s=qe[t],n=s.steps.length;return e.jsx("div",{className:"flex items-center justify-between mb-8 max-w-2xl mx-auto",children:e.jsx("div",{className:"flex items-center space-x-1 mx-auto w-full justify-center",children:s.steps.map((a,o)=>{const i=o+1,l=r>i,c=r===i,d=r<i;return e.jsxs(U.Fragment,{children:[e.jsxs("div",{className:"flex flex-col items-center relative z-10 w-16",children:[e.jsx("div",{className:_("w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 font-bold",c&&"bg-blue-600 text-white ring-4 ring-blue-100 dark:ring-blue-900",l&&"bg-green-500 text-white",d&&"bg-gray-200 dark:bg-gray-700 text-gray-500"),children:l?"âœ“":i}),e.jsx("div",{className:_("text-[10px] mt-1 font-medium text-center w-20 truncate",c?"text-blue-600 dark:text-blue-400":"text-gray-400"),children:a.title})]}),o<n-1&&e.jsx("div",{className:_("h-1 flex-1 mx-[-10px] mt-[-14px] z-0 transition-all duration-500 rounded-full",r>i?"bg-green-500":"bg-gray-200 dark:bg-gray-700")})]},o)})})})},ji=({mode:t,step:r,onBack:s,onNext:n,onFinish:a})=>{const{t:o}=B(),i=qe[t],l=r-1,c=i.steps[l],d=i.steps.length,[u,g]=p.useState({}),f=(m,h)=>{g(v=>({...v,[m]:h}))},y=()=>{const m=c.inputs.reduce((h,v,j)=>{const x=u[j]||"";return v.key&&(h[v.key]=x),h},{});r<d?n(m):a(m)};return e.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[e.jsxs("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-900 dark:text-white",children:[i.label," Mode"]}),e.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8 min-h-[500px] flex flex-col",children:[e.jsx(vi,{mode:t,currentStep:r}),e.jsxs("div",{className:"flex-1 animate-fade-in",children:[e.jsxs("h3",{className:"text-xl font-bold mb-2 text-gray-800 dark:text-gray-100",children:["Q",r,". ",c.title]}),e.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-400",children:c.description}),e.jsx("div",{className:"mb-8 space-y-4",children:c.inputs.map((m,h)=>e.jsx("div",{children:m.type==="textarea"?e.jsx(rr,{name:m.key||`textarea-${h}`,id:m.key||`textarea-${h}`,className:"text-base",rows:5,placeholder:m.placeholder,value:u[h]||"",onChange:v=>f(h,v.target.value),"aria-label":m.placeholder}):e.jsx(Ce,{name:m.key||`input-${h}`,id:m.key||`input-${h}`,className:"text-base",placeholder:m.placeholder,value:u[h]||"",onChange:v=>f(h,v.target.value),"aria-label":m.placeholder})},m.key||h))})]}),e.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[e.jsx(q,{onClick:s,variant:"ghost",className:"text-gray-600 dark:text-gray-400 font-medium",children:o("wizard.back")}),r<d?e.jsx(q,{onClick:y,variant:"primary",className:"bg-blue-600 hover:bg-blue-700 shadow-md",rightIcon:e.jsx(_r,{className:"w-4 h-4 ml-2"}),children:o("wizard.next")}):e.jsx(q,{onClick:y,variant:"primary",className:"bg-green-600 hover:bg-green-700 shadow-lg transform hover:scale-105",leftIcon:e.jsx(jt,{className:"w-5 h-5 mr-2"}),children:o("wizard.finish")})]})]})]})},wi=({currentMode:t,onModeChange:r,onStart:s})=>{const{t:n}=B(),a=qe[t],o=(n(`wizard.features.${t}`)||"").split(",");return e.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-full max-h-[700px] flex flex-col py-6",children:[e.jsx("div",{className:"mb-4 flex-shrink-0",children:e.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[e.jsx("svg",{className:"w-3 h-3 mr-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 10V3L4 14h7v7l9-11h-7z"})}),e.jsx("span",{className:"font-medium",children:n("sidebar.target_wizard")}),e.jsx("svg",{className:"w-3 h-3 mx-1.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),e.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-semibold",children:n("wizard.select_method")})]})}),e.jsxs("div",{className:"mb-6 flex-shrink-0",children:[e.jsx("h2",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:n("wizard.select_framework")}),e.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:Object.keys(qe).map(i=>e.jsx("button",{onClick:()=>r(i),className:_("flex-1 py-2 text-xs font-bold rounded-lg transition-all",t===i?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"),children:qe[i].label},i))})]}),e.jsx("div",{className:"flex-1 mb-6 min-h-0",children:e.jsx("div",{className:"h-full bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl border-2 border-gray-200 dark:border-gray-700 overflow-hidden shadow-xl",children:e.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mb-4 shadow-lg flex-shrink-0",children:e.jsx("svg",{className:"w-8 h-8 text-white",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})}),e.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 text-xl",children:a.label}),e.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-2xl leading-relaxed",children:a.description}),e.jsx("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:o.map(i=>e.jsx("span",{className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full text-xs font-medium text-gray-700 dark:text-gray-300 shadow-sm",children:i.trim()},i))})]})})}),e.jsx("div",{className:"flex justify-center pb-4 flex-shrink-0",children:e.jsxs("button",{onClick:s,className:"group inline-flex items-center px-6 py-3 border-2 border-transparent shadow-xl font-bold rounded-xl text-white bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 focus:outline-none focus:ring-4 focus:ring-blue-500/50 transition-all transform hover:scale-105 active:scale-95",children:[e.jsx("span",{children:n("wizard.start_mode")}),e.jsx("svg",{className:"ml-2 w-4 h-4 group-hover:translate-x-1 transition-transform",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 7l5 5m0 0l-5 5m5-5H6"})})]})})]})},Ni=()=>{const[t,r]=p.useState("backward"),[s,n]=p.useState(0),[a,o]=p.useState({}),{setView:i,viewData:l}=ae(),{workspaceId:c}=ne(),{t:d}=B();p.useEffect(()=>{l!=null&&l.mode&&(r(l.mode),n(0))},[l]);const u=y=>{o(m=>({...m,...y})),n(m=>m+1)},g=async y=>{const m={...a,...y};if(!c){S.error(d("wizard.alert_no_workspace"));return}try{await Hn(c,{mode:t,data:m}),console.log("Wizard Completed, Saved to Firestore",m),S.success(d("wizard.alert_create_success",{label:qe[t].label})),n(0),o({}),i("target-dashboard")}catch(h){console.error("Failed to save wizard target:",h),S.error(d("wizard.alert_save_fail"))}},f=()=>{n(y=>Math.max(0,y-1))};return s===0?e.jsx(wi,{currentMode:t,onModeChange:r,onStart:()=>n(1)}):e.jsx(ji,{mode:t,step:s,onBack:f,onNext:u,onFinish:g})},_i=(t,r)=>{const s=Wt(Ue(zt,{activationConstraint:{distance:5}}),Ue(ks,{activationConstraint:{delay:O.DND.TOUCH_DELAY,tolerance:5}})),{language:n}=X(),{t:a}=fe(n),o=p.useRef(t),i=p.useCallback(()=>{o.current=t},[t]),l=p.useCallback(async c=>{var h,v,j,x;const{active:d,over:u}=c;if(!u)return;const g=String(d.id),f=String(u.id),m=(k=>k.startsWith(O.DND.PREFIX_TASK)?k.split(":")[1]:null)(g);if(m){const k=(h=u.data.current)==null?void 0:h.type,E=(v=u.data.current)==null?void 0:v.value,D={};if(k===O.DND.TYPE_PROJECT&&(D.projectId=E),k===O.DND.TYPE_INBOX&&(D.projectId=null),k===O.DND.TYPE_TIMEBLOCK&&(D.timeBlockId=E==="unassigned"?null:E),Object.keys(D).length>0)try{await ft(m,D)}catch(F){console.error("Failed to update task via dnd",F),S.error(a("msg.dnd.reorderFailed")||a("error"))}}if(g!==f&&!m){const k=o.current,E=k.findIndex(F=>F.id===g),D=k.findIndex(F=>F.id===f);if(E!==-1&&D!==-1){const F=kt(k,E,D);(j=r==null?void 0:r.onOptimisticReorder)==null||j.call(r,F);try{await Wa(F)}catch(C){console.error("Failed to update project order",C),S.error(a("msg.dnd.reorderFailed")||a("error")),(x=r==null?void 0:r.onRevertReorder)==null||x.call(r,k)}}}},[t,r,a]);return{sensors:s,handleDragEnd:l,handleDragStart:i}},Ci=()=>{const{workspaceId:t,userId:r,loading:s}=ne(),n=p.useCallback(c=>!t||!r?()=>{}:Ln(t,c),[t,r]),a=t?In(t):!1,{data:o,isPending:i}=$e(["labels",r||void 0,t||void 0],n,t&&a?En(t):void 0);return{labels:o||[],loading:s||!!t&&i}},Si=()=>{const{fontEn:t,fontJp:r,fontSize:s,density:n,themeMode:a}=X(),{setSidebarDensity:o}=Vt();p.useLayoutEffect(()=>{const i=document.documentElement,l=document.body;a==="dark"?i.classList.add("dark"):a==="light"?i.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?i.classList.add("dark"):i.classList.remove("dark"),i.style.setProperty("--font-en",`"${t}"`),i.style.setProperty("--font-jp",`"${r}"`);const c=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];l.classList.remove(...c),l.classList.add(`font-app-${s}`);const d=["app-density-compact","app-density-normal","app-density-comfortable","app-density-spacious"];l.classList.remove(...d),l.classList.add(`app-density-${n}`),o(n);const u=window.matchMedia("(prefers-color-scheme: dark)"),g=()=>{a==="system"&&(u.matches?i.classList.add("dark"):i.classList.remove("dark"))};return u.addEventListener("change",g),()=>u.removeEventListener("change",g)},[a,t,r,s,n,o])},Di=()=>{Si();const{filterType:t,targetId:r,query:s}=ge(),{currentView:n,setView:a}=ae(),{setFilter:o}=ge(),{projects:i,setProjectsOverride:l}=lt(),{labels:c}=Ci(),[d,u]=U.useState({user:R.currentUser,loading:!R.currentUser}),g=p.useCallback(v=>{const j=v.target,x=["INPUT","TEXTAREA"].includes(j.tagName)||j.closest("[contenteditable]"),k=document.querySelector('[role="dialog"]');v.key==="/"&&!x&&!k&&(v.preventDefault(),o("search"),a("search"))},[o,a]);U.useEffect(()=>{const v=kr(R,j=>{u({user:j,loading:!1})});return document.addEventListener("keydown",g),()=>{v(),document.removeEventListener("keydown",g)}},[g]);const{sensors:f,handleDragEnd:y,handleDragStart:m}=_i(i,{onOptimisticReorder:l,onRevertReorder:l}),h=p.useMemo(()=>{var v,j;if(n==="wizard")return"Goal Wizard";if(n==="target-dashboard")return"Target Dashboard";if(n==="wiki")return"Framework Wiki";if(n==="search")return s?`"${s}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";if(t==="project")return((v=i.find(x=>x.id===r))==null?void 0:v.name)||"Project";if(t==="label")return((j=c.find(x=>x.id===r))==null?void 0:j.name)||"Label";if(t==="search")return s?`"${s}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";switch(t){case"inbox":return"Inbox";case"today":return"Today";case"upcoming":return"Upcoming";case"important":return"Important";case"custom":return"All Tasks";default:return"TaskMg"}},[n,s,t,r,i,c]);return d.loading?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),e.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"èª­ã¿è¾¼ã¿ä¸­..."})]})}):d.user?e.jsxs(qt,{sensors:f,collisionDetection:Ut,onDragEnd:y,onDragStart:m,children:[e.jsx($s,{}),e.jsx(Bo,{}),e.jsx(ja,{sidebarContent:e.jsx(oi,{}),title:h,children:n==="wizard"?e.jsx(Ni,{}):n==="target-dashboard"?e.jsx(fi,{}):n==="wiki"?e.jsx(ki,{}):n==="search"?e.jsx(ui,{}):n==="dashboard"?e.jsx(di,{}):e.jsx(Jr,{})})]}):e.jsx(Fs,{})},Ti=new vs({defaultOptions:{queries:{staleTime:1/0,refetchOnWindowFocus:!1,retry:!1}}});pa();const Qr=document.getElementById("app");if(!Qr)throw new Error("Failed to find the root element");const Mi=e.jsx(Mo,{children:e.jsx(ws,{client:Ti,children:e.jsx(Di,{})})});js.createRoot(Qr).render(Mi);
