var Ku=Object.defineProperty;var Ju=(e,t,n)=>t in e?Ku(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>Ju(e,typeof t!="symbol"?t+"":t,n);import{getAuth as Zu,signInAnonymously as Qu,signInWithEmailAndPassword as th,updatePassword as eh,onAuthStateChanged as nh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as ih,updateDoc as Mi,doc as Nt,addDoc as Ge,collection as ft,serverTimestamp as kn,deleteDoc as Ci,query as Qe,orderBy as Dr,onSnapshot as Sn,getDocs as Jn,limit as sh,Timestamp as Tr,getDoc as oh,setDoc as rh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as ah}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const lh="modulepreload",ch=function(e){return"/"+e},ua={},dh=function(t,n,i){let s=Promise.resolve();if(n&&n.length>0){let r=function(c){return Promise.all(c.map(d=>Promise.resolve(d).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),l=(a==null?void 0:a.nonce)||(a==null?void 0:a.getAttribute("nonce"));s=r(n.map(c=>{if(c=ch(c),c in ua)return;ua[c]=!0;const d=c.endsWith(".css"),u=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const h=document.createElement("link");if(h.rel=d?"stylesheet":lh,d||(h.as="script"),h.crossOrigin="",h.href=c,l&&h.setAttribute("nonce",l),document.head.appendChild(h),d)return new Promise((f,g)=>{h.addEventListener("load",f),h.addEventListener("error",()=>g(new Error(`Unable to preload CSS for ${c}`)))})}))}function o(r){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=r,window.dispatchEvent(a),!a.defaultPrevented)throw r}return s.then(r=>{for(const a of r||[])a.status==="rejected"&&o(a.reason);return t().catch(o)})},ha={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let cs,U,K,Cs=!1;function uh(){if(Cs)return;const e=hh();if(e!=null&&e.apiKey)try{cs=ah(e),U=Zu(cs),K=ih(cs),Cs=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function hh(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&ha){const e=ha,t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function Rc(){if(!Cs)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:cs,auth:U,db:K}}function fh(e,t,n){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${n?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${e.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${e.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function gh(e){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",t="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const n=e.type==="confirm";!n&&e.okText==="OK"&&(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",fh(e,t,n));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),o=document.getElementById("msg-modal-body"),r=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=e.title,o.textContent=e.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!n&&l()};document.addEventListener("keydown",c),r.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!n&&l()},r.focus()}function P(e,t=null){let n={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof e=="object"&&e!==null?n={...n,...e}:(n.message=String(e),typeof t=="function"?(n.type="confirm",n.onConfirm=t):typeof t=="string"&&(n.type=t)),gh(n)}async function ph(e,t){if(!Cs)throw new Error("Firebaseが初期化されていないぞ。");try{return await th(U,e,t)}catch(n){let i="ログインに失敗した。";switch(n.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function mh(e){const t=U.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await eh(t,e),P({message:"パスワードを変更したぞ",type:"success"})}catch(n){let i="変更に失敗した: "+n.message;throw n.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),P({message:i,type:"error"}),n}}function Bc(){const e=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),n=document.getElementById("password-input"),i=document.getElementById("guest-login-btn");if(e&&t&&n){const s=async()=>{const o=t.value.trim(),r=n.value.trim();if(!o||!r)return P({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await ph(o,r)}catch(a){P({message:a.message,type:"error"})}};e.onclick=s,n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&s()})}i&&(i.onclick=async()=>{try{await Qu(U),P({message:"ゲストとしてログインしたぞ。データは一時的に保持される。",type:"success"})}catch(s){console.error(s),P({message:"ゲストログインに失敗した: "+s.message,type:"error"})}})}function bh(e){const t=document.getElementById("login-form-container")||document.getElementById("login-container-wrapper"),n=document.getElementById("user-info"),i=document.getElementById("user-email-display"),s=document.getElementById("email-input"),o=document.getElementById("password-input");e?(e.uid,t&&t.classList.add("hidden"),n&&(n.classList.remove("hidden"),n.classList.add("flex")),i&&(i.textContent=e.isAnonymous?"ゲストユーザー":e.email||"ユーザー")):(t&&t.classList.remove("hidden"),n&&(n.classList.add("hidden"),n.classList.remove("flex")),s&&(s.value=""),o&&(o.value=""),i&&(i.textContent=""))}const yh={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},B={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DENSITY_LEVELS:{COMPACT:"compact",NORMAL:"normal",COMFORTABLE:"comfortable",SPACIOUS:"spacious"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},CLASSES:{CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},COLORS:{DEFAULT:"#CBD5E0"},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order"},LIST_IDS:{PROJECTS:"project-list",LABELS:"label-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list",BASIC:"basic-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function Nc(e,t){if(!t||!e)return;let n=!1,i=null,s=null;const o=()=>{i!==null&&e&&(e.style.width=`${i}px`),s=null},r=l=>{if(!n)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=B;i=Math.max(c,Math.min(d,l.clientX)),s||(s=requestAnimationFrame(o))},a=()=>{n&&(n=!1,document.body.classList.remove("cursor-col-resize","select-none"),e.style.transition="",s&&cancelAnimationFrame(s),s=null,o(),localStorage.setItem(B.STORAGE_KEYS.WIDTH,e.offsetWidth),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a))};t.addEventListener("mousedown",l=>{Mr()&&(n=!0,document.body.classList.add("cursor-col-resize","select-none"),e.style.transition="none",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))})}function Mr(){return window.innerWidth>=768}function Cr(e,t=!1){const n=localStorage.getItem(e);return n===null?t:n==="true"||n==="compact"}function En(){const e=localStorage.getItem(B.STORAGE_KEYS.DENSITY);return e&&Object.values(B.DENSITY_LEVELS).includes(e)?e:Cr(B.STORAGE_KEYS.COMPACT,!1)?B.DENSITY_LEVELS.COMPACT:B.DENSITY_LEVELS.NORMAL}function vh(){return En()===B.DENSITY_LEVELS.COMPACT}function As(e,t){return Array.isArray(e)?e.filter(n=>!n.completed&&t(n)).length:0}function xh(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function ln(e){return`artifacts/${xh()}/users/${e}`}function fa(e,t){return`${ln(e)}/workspaces/${t}`}const Y={users:e=>ln(e),filters:e=>`${ln(e)}/filters`,labels:e=>`${ln(e)}/labels`,workspaces:e=>`${ln(e)}/workspaces`,timeblocks:e=>`${ln(e)}/timeblocks`,tasks:(e,t)=>`${fa(e,t)}/tasks`,projects:(e,t)=>`${fa(e,t)}/projects`},Ls="currentWorkspaceId",_h="workspace-changed";let Fi=null,Ar=[];function Jo(){return Ar}function wh(e,t){const n=typeof t=="function"?t:()=>{};if(!e)return n([]),()=>{};Fi&&Fi();const i=Y.workspaces(e),s=Qe(ft(K,i),Dr("createdAt","asc"));return Fi=Sn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));if(Ar=r,r.length===0&&!o.metadata.hasPendingWrites)n([]),kh().catch(a=>console.error("[Workspace] Default creation error:",a));else{const a=Sh(r);n(r),Fc(a,r)}},o=>{console.error("[Workspace] Subscription error:",o),n([])}),Fi}async function kh(){try{const e=U.currentUser;if(!e)return;const t=Y.workspaces(e.uid);(await Jn(Qe(ft(K,t),sh(1)))).empty&&await $c("メイン")}catch(e){console.error("[Workspace] Failed to ensure default workspace:",e)}}function Sh(e){if(e.length===0)return null;let t=Zt();const n=e.some(i=>i.id===t);return(!t||!n)&&(t=e[0].id,localStorage.setItem(Ls,t)),t}function Zt(){return localStorage.getItem(Ls)}function Lr(e){!e||localStorage.getItem(Ls)===e||(localStorage.setItem(Ls,e),Fc(e,Ar))}function Fc(e,t){const n=new CustomEvent(_h,{detail:{workspaceId:e,workspaces:t}});document.dispatchEvent(n)}async function $c(e){try{const t=U.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);return{id:(await Ge(ft(K,n),{name:e,createdAt:kn()})).id,name:e}}catch(t){throw console.error("[Workspace] Add error:",t),P("ワークスペースの作成に失敗した。"),t}}async function Eh(e,t){try{const n=U.currentUser;if(!n)throw new Error("Authentication required");const i=Y.workspaces(n.uid);await Mi(Nt(K,i,e),{name:t})}catch(n){console.error("[Workspace] Update error:",n),P("名前の更新に失敗した。")}}async function Ih(e){try{const t=U.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);await Ci(Nt(K,n,e))}catch(t){console.error("[Workspace] Delete error:",t),P("削除に失敗した。")}}const ga={EN:[{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Segoe UI",label:"Segoe UI"},{value:'-apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif',label:"San Francisco"},{value:'"Google Sans", "Open Sans"',label:"Google Sans"}],JP:[{value:'"Hiragino Kaku Gothic ProN", "Hiragino Sans"',label:"ヒラギノ角ゴ"},{value:'"Noto Sans JP"',label:"Noto Sans JP"},{value:'"LINE Seed JP"',label:"LINE Seed JP"},{value:'"M PLUS 2"',label:"M PLUS 2"},{value:'"BIZ UDPGothic"',label:"BIZ UDPゴシック"}]},yn={FONT_EN:"font_family_en",FONT_JP:"font_family_jp"},Os={EN:"Inter",JP:"M PLUS 2"};function Hc(){const e=localStorage.getItem(yn.FONT_EN)||Os.EN,t=localStorage.getItem(yn.FONT_JP)||Os.JP,n=document.documentElement;n.style.setProperty("--font-en",`"${e}"`),n.style.setProperty("--font-jp",`"${t}"`)}function pa(e,t){const n=e==="EN"?yn.FONT_EN:yn.FONT_JP;localStorage.setItem(n,t),Hc()}function Dh(){return{en:localStorage.getItem(yn.FONT_EN)||Os.EN,jp:localStorage.getItem(yn.FONT_JP)||Os.JP}}function Th(){const e=localStorage.getItem("fontSize")||"md",t=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e}`)}const An={NONE:"none",TEXTURE:"haikei"},Ft={SMALL:"sm",BASE:"base",MEDIUM:"md",LARGE:"lg",XL:"xl"},Mh=[{value:"Asia/Tokyo",label:"日本 (JST/UTC+9)"},{value:"America/Los_Angeles",label:"アメリカ・太平洋 (PST/UTC-8)"},{value:"America/New_York",label:"アメリカ・東部 (EST/UTC-5)"},{value:"Asia/Shanghai",label:"中国・台湾 (CST/UTC+8)"},{value:"Europe/London",label:"イギリス (GMT/UTC+0)"}];function ma(e,t,n,i){const s=t.map(o=>`<option value="${o.value}" ${o.value===n?"selected":""}>${o.label}</option>`).join("");return`
        <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">${e}</label>
            <div class="relative">
                <select name="${i}" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                    ${s}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>
    `}function Ch(){const e=Dh();return`
        <div class="space-y-4">
            ${ma("英数字フォント",ga.EN,e.en,"font-en-select")}
            ${ma("日本語フォント",ga.JP,e.jp,"font-jp-select")}
        </div>
    `}function Mt(e,t,n,i,s=""){return`
        <label class="flex items-center justify-center gap-2 cursor-pointer p-3 border ${i?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300"} rounded-lg transition-all duration-200">
            <input type="radio" name="${e}" value="${t}" class="hidden" ${i?"checked":""}>
            ${s}
            <span class="text-sm font-medium">${n}</span>
        </label>
    `}function Ln(e,t,n,i,s=!1){return`
        <div class="settings-accordion border-b border-gray-100 dark:border-gray-700 last:border-0" data-section="${e}">
            <button class="accordion-header w-full flex items-center justify-between py-4 px-2 focus:outline-none group hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-lg transition-colors">
                <div class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest group-hover:text-blue-500 transition-colors">
                    ${n}
                    ${t}
                </div>
                <svg class="accordion-icon w-5 h-5 text-gray-400 transform transition-transform duration-300 ${s?"rotate-180":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div class="accordion-content overflow-hidden transition-all duration-300 ease-in-out ${s?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"}" style="${s?"":"max-height: 0px;"}">
                <div class="pt-2 pb-6 px-2">
                    ${i}
                </div>
            </div>
        </div>
    `}function Ah(e,t,n){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||Ft.MEDIUM,o=localStorage.getItem("background")||An.NONE,r=e||"?",a=localStorage.getItem("sidebar_density")||(n?"compact":"normal"),l=`
        <div class="space-y-6">
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">テーマ</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Mt("app-theme","light","ライト",i==="light",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                    ${Mt("app-theme","dark","ダーク",i==="dark",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークモード)</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Mt("bg-pattern",An.NONE,"無地",o===An.NONE)}
                    ${Mt("bg-pattern",An.TEXTURE,"テクスチャ",o===An.TEXTURE)}
                </div>
            </div>
            <div>
                 <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タイムゾーン</label>
                 <div class="relative">
                     ${(()=>{const g=localStorage.getItem("timezone")||"Asia/Tokyo";return`
                        <select name="timezone-select" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                            ${Mh.map(p=>`<option value="${p.value}" ${p.value===g?"selected":""}>${p.label}</option>`).join("")}
                        </select>
                        `})()}
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
            </div>
            <div>
                <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">サイドバーとUI密度</label>
                <div class="grid grid-cols-2 gap-3">
                    ${Mt("sidebar-density","compact","Compact",a==="compact")}
                    ${Mt("sidebar-density","normal","Standard",a==="normal")}
                    ${Mt("sidebar-density","comfortable","Comfortable",a==="comfortable")}
                    ${Mt("sidebar-density","spacious","Spacious",a==="spacious")}
                </div>
            </div>
        </div>
    `,c=Ch(),d=`
        <div class="grid grid-cols-5 gap-2">
            ${Mt("font-size",Ft.SMALL,"Small",s===Ft.SMALL)}
            ${Mt("font-size",Ft.BASE,"Base",s===Ft.BASE)}
            ${Mt("font-size",Ft.MEDIUM,"Medium",s===Ft.MEDIUM)}
            ${Mt("font-size",Ft.LARGE,"Large",s===Ft.LARGE)}
            ${Mt("font-size",Ft.XL,"XL",s===Ft.XL)}
        </div>
    `,u=`
         <div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-100 dark:border-gray-700">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                ${r}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-500 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新しいパスワード" class="flex-1 px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                <button id="update-password-btn-new" class="px-4 py-2 bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-bold rounded-lg transition-colors whitespace-nowrap">変更</button>
            </div>
            <button id="logout-btn-settings" class="w-full py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-medium rounded-lg transition-colors text-left flex items-center gap-2 px-2">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `;return`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-5xl overflow-hidden flex flex-col max-h-[90vh] h-full sm:h-auto animate-fade-in-up">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10 sticky top-0">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">Settings</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="overflow-y-auto custom-scrollbar flex-1 bg-white dark:bg-gray-800">
                <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- Left Column -->
                    <div class="space-y-0">
                        ${Ln("appearance","Appearance",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>',l,!0)}
                        ${Ln("data","Data Management",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>',`
        <div class="space-y-3">
            <button id="export-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">バックアップを作成</span>
                    <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">現在の全データをJSON形式でダウンロード</div>
            </button>
            
            <button id="import-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                 <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">データを復元</span>
                     <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">バックアップファイルからデータを読み込み</div>
            </button>
            <input type="file" id="import-file-input" accept=".json" class="hidden" />
        </div>
    `)}
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-0">
                        ${Ln("typography","Typography",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>',c)}
                        ${Ln("fontsize","Font Size",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',d)}
                        ${Ln("account","Account",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',u)}
                    </div>
                </div>
            </div>
        </div>
    `}var ba={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const jc=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)===55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128)}return t},Lh=function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=e[n++];t[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=e[n++],r=e[n++],a=e[n++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const o=e[n++],r=e[n++];t[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return t.join("")},zc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const o=e[s],r=s+1<e.length,a=r?e[s+1]:0,l=s+2<e.length,c=l?e[s+2]:0,d=o>>2,u=(o&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,r||(h=64)),i.push(n[d],n[u],n[h],n[f])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(jc(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Lh(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const o=n[e.charAt(s++)],a=s<e.length?n[e.charAt(s)]:0;++s;const c=s<e.length?n[e.charAt(s)]:64;++s;const u=s<e.length?n[e.charAt(s)]:64;if(++s,o==null||a==null||c==null||u==null)throw new Oh;const h=o<<2|a>>4;if(i.push(h),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const g=c<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Oh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ph=function(e){const t=jc(e);return zc.encodeByteArray(t,!0)},Uc=function(e){return Ph(e).replace(/\./g,"")},Vc=function(e){try{return zc.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Rh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Bh=()=>Rh().__FIREBASE_DEFAULTS__,Nh=()=>{if(typeof process>"u"||typeof ba>"u")return;const e=ba.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Fh=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Vc(e[1]);return t&&JSON.parse(t)},$h=()=>{try{return Bh()||Nh()||Fh()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Hh=e=>{var t;return(t=$h())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function jh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kt())}function zh(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Uh(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Vh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Wh(){try{return typeof indexedDB=="object"}catch{return!1}}function Yh(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var o;t(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(n){t(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qh="FirebaseError";class tn extends Error{constructor(t,n,i){super(n),this.code=t,this.customData=i,this.name=qh,Object.setPrototypeOf(this,tn.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ai.prototype.create)}}class Ai{constructor(t,n,i){this.service=t,this.serviceName=n,this.errors=i}create(t,...n){const i=n[0]||{},s=`${this.service}/${t}`,o=this.errors[t],r=o?Gh(o,i):"Error",a=`${this.serviceName}: ${r} (${s}).`;return new tn(s,a,i)}}function Gh(e,t){return e.replace(Xh,(n,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const Xh=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Wc(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function Kh(e,t){const n=new Jh(e,t);return n.subscribe.bind(n)}class Jh{constructor(t,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(n=>{n.next(t)})}error(t){this.forEachObserver(n=>{n.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,n,i){let s;if(t===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");Zh(t,["next","error","complete"])?s=t:s={next:t,error:n,complete:i},s.next===void 0&&(s.next=go),s.error===void 0&&(s.error=go),s.complete===void 0&&(s.complete=go);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,t)}sendOne(t,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{n(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Zh(e,t){if(typeof e!="object"||e===null)return!1;for(const n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}function go(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Li(e){return e&&e._delegate?e._delegate:e}class pi{constructor(t,n,i){this.name=t,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var X;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(X||(X={}));const Qh={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},tf=X.INFO,ef={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},nf=(e,t,...n)=>{if(t<e.logLevel)return;const i=new Date().toISOString(),s=ef[t];if(s)console[s](`[${i}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Yc{constructor(t){this.name=t,this._logLevel=tf,this._logHandler=nf,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in X))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Qh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...t),this._logHandler(this,X.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...t),this._logHandler(this,X.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,X.INFO,...t),this._logHandler(this,X.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,X.WARN,...t),this._logHandler(this,X.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...t),this._logHandler(this,X.ERROR,...t)}}const sf=(e,t)=>t.some(n=>e instanceof n);let ya,va;function of(){return ya||(ya=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function rf(){return va||(va=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const qc=new WeakMap,Zo=new WeakMap,Gc=new WeakMap,po=new WeakMap,Or=new WeakMap;function af(e){const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{n(Te(e.result)),s()},r=()=>{i(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",r)});return t.then(n=>{n instanceof IDBCursor&&qc.set(n,e)}).catch(()=>{}),Or.set(t,e),t}function lf(e){if(Zo.has(e))return;const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{n(),s()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)});Zo.set(e,t)}let Qo={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Zo.get(e);if(t==="objectStoreNames")return e.objectStoreNames||Gc.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return Te(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function cf(e){Qo=e(Qo)}function df(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(mo(this),t,...n);return Gc.set(i,t.sort?t.sort():[t]),Te(i)}:rf().includes(e)?function(...t){return e.apply(mo(this),t),Te(qc.get(this))}:function(...t){return Te(e.apply(mo(this),t))}}function uf(e){return typeof e=="function"?df(e):(e instanceof IDBTransaction&&lf(e),sf(e,of())?new Proxy(e,Qo):e)}function Te(e){if(e instanceof IDBRequest)return af(e);if(po.has(e))return po.get(e);const t=uf(e);return t!==e&&(po.set(e,t),Or.set(t,e)),t}const mo=e=>Or.get(e);function hf(e,t,{blocked:n,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(e,t),a=Te(r);return i&&r.addEventListener("upgradeneeded",l=>{i(Te(r.result),l.oldVersion,l.newVersion,Te(r.transaction),l)}),n&&r.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const ff=["get","getKey","getAll","getAllKeys","count"],gf=["put","add","delete","clear"],bo=new Map;function xa(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(bo.get(t))return bo.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=gf.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||ff.includes(n)))return;const o=async function(r,...a){const l=this.transaction(r,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return bo.set(t,o),o}cf(e=>({...e,get:(t,n,i)=>xa(t,n)||e.get(t,n,i),has:(t,n)=>!!xa(t,n)||e.has(t,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pf{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(mf(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function mf(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const tr="@firebase/app",_a="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ue=new Yc("@firebase/app"),bf="@firebase/app-compat",yf="@firebase/analytics-compat",vf="@firebase/analytics",xf="@firebase/app-check-compat",_f="@firebase/app-check",wf="@firebase/auth",kf="@firebase/auth-compat",Sf="@firebase/database",Ef="@firebase/data-connect",If="@firebase/database-compat",Df="@firebase/functions",Tf="@firebase/functions-compat",Mf="@firebase/installations",Cf="@firebase/installations-compat",Af="@firebase/messaging",Lf="@firebase/messaging-compat",Of="@firebase/performance",Pf="@firebase/performance-compat",Rf="@firebase/remote-config",Bf="@firebase/remote-config-compat",Nf="@firebase/storage",Ff="@firebase/storage-compat",$f="@firebase/firestore",Hf="@firebase/vertexai-preview",jf="@firebase/firestore-compat",zf="firebase",Uf="10.14.1",Vf={[tr]:"fire-core",[bf]:"fire-core-compat",[vf]:"fire-analytics",[yf]:"fire-analytics-compat",[_f]:"fire-app-check",[xf]:"fire-app-check-compat",[wf]:"fire-auth",[kf]:"fire-auth-compat",[Sf]:"fire-rtdb",[Ef]:"fire-data-connect",[If]:"fire-rtdb-compat",[Df]:"fire-fn",[Tf]:"fire-fn-compat",[Mf]:"fire-iid",[Cf]:"fire-iid-compat",[Af]:"fire-fcm",[Lf]:"fire-fcm-compat",[Of]:"fire-perf",[Pf]:"fire-perf-compat",[Rf]:"fire-rc",[Bf]:"fire-rc-compat",[Nf]:"fire-gcs",[Ff]:"fire-gcs-compat",[$f]:"fire-fst",[jf]:"fire-fst-compat",[Hf]:"fire-vertex","fire-js":"fire-js",[zf]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Wf=new Map,Yf=new Map,wa=new Map;function ka(e,t){try{e.container.addComponent(t)}catch(n){ue.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function mi(e){const t=e.name;if(wa.has(t))return ue.debug(`There were multiple attempts to register component ${t}.`),!1;wa.set(t,e);for(const n of Wf.values())ka(n,e);for(const n of Yf.values())ka(n,e);return!0}function Hn(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const qf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Pr=new Ai("app","Firebase",qf);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Rr=Uf;function Zn(e,t,n){var i;let s=(i=Vf[e])!==null&&i!==void 0?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),r=t.match(/\s|\//);if(o||r){const a=[`Unable to register library "${s}" with version "${t}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&r&&a.push("and"),r&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),ue.warn(a.join(" "));return}mi(new pi(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Gf="firebase-heartbeat-database",Xf=1,bi="firebase-heartbeat-store";let yo=null;function Xc(){return yo||(yo=hf(Gf,Xf,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(bi)}catch(n){console.warn(n)}}}}).catch(e=>{throw Pr.create("idb-open",{originalErrorMessage:e.message})})),yo}async function Kf(e){try{const n=(await Xc()).transaction(bi),i=await n.objectStore(bi).get(Kc(e));return await n.done,i}catch(t){if(t instanceof tn)ue.warn(t.message);else{const n=Pr.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});ue.warn(n.message)}}}async function Sa(e,t){try{const i=(await Xc()).transaction(bi,"readwrite");await i.objectStore(bi).put(t,Kc(e)),await i.done}catch(n){if(n instanceof tn)ue.warn(n.message);else{const i=Pr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});ue.warn(i.message)}}}function Kc(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Jf=1024,Zf=720*60*60*1e3;class Qf{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new eg(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ea();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(r=>r.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const a=new Date(r.date).valueOf();return Date.now()-a<=Zf}),this._storage.overwrite(this._heartbeatsCache))}catch(i){ue.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Ea(),{heartbeatsToSend:i,unsentEntries:s}=tg(this._heartbeatsCache.heartbeats),o=Uc(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return ue.warn(n),""}}}function Ea(){return new Date().toISOString().substring(0,10)}function tg(e,t=Jf){const n=[];let i=e.slice();for(const s of e){const o=n.find(r=>r.agent===s.agent);if(o){if(o.dates.push(s.date),Ia(n)>t){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ia(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class eg{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Wh()?Yh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await Kf(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function Ia(e){return Uc(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ng(e){mi(new pi("platform-logger",t=>new pf(t),"PRIVATE")),mi(new pi("heartbeat",t=>new Qf(t),"PRIVATE")),Zn(tr,_a,e),Zn(tr,_a,"esm2017"),Zn("fire-js","")}ng("");function Jc(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function Zc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const ig=Zc,Qc=new Ai("auth","Firebase",Zc());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ps=new Yc("@firebase/auth");function sg(e,...t){Ps.logLevel<=X.WARN&&Ps.warn(`Auth (${Rr}): ${e}`,...t)}function ds(e,...t){Ps.logLevel<=X.ERROR&&Ps.error(`Auth (${Rr}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(e,...t){throw Br(e,...t)}function td(e,...t){return Br(e,...t)}function ed(e,t,n){const i=Object.assign(Object.assign({},ig()),{[t]:n});return new Ai("auth","Firebase",i).create(t,{appName:e.name})}function us(e){return ed(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Br(e,...t){if(typeof e!="string"){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Qc.create(e,...t)}function W(e,t,...n){if(!e)throw Br(t,...n)}function Qn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ds(t),new Error(t)}function Rs(e,t){e||Qn(t)}function og(){return Ta()==="http:"||Ta()==="https:"}function Ta(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function rg(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(og()||Uh()||"connection"in navigator)?navigator.onLine:!0}function ag(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Oi{constructor(t,n){this.shortDelay=t,this.longDelay=n,Rs(n>t,"Short delay should be less than long delay!"),this.isMobile=jh()||Vh()}get(){return rg()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function lg(e,t){Rs(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nd{static initialize(t,n,i){this.fetchImpl=t,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Qn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Qn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Qn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const cg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const dg=new Oi(3e4,6e4);function id(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function eo(e,t,n,i,s={}){return sd(e,s,async()=>{let o={},r={};i&&(t==="GET"?r=i:o={body:JSON.stringify(i)});const a=Wc(Object.assign({key:e.config.apiKey},r)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:l},o);return zh()||(c.referrerPolicy="no-referrer"),nd.fetch()(od(e,e.config.apiHost,n,a),c)})}async function sd(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},cg),t);try{const s=new ug(e),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const r=await o.json();if("needConfirmation"in r)throw $i(e,"account-exists-with-different-credential",r);if(o.ok&&!("errorMessage"in r))return r;{const a=o.ok?r.errorMessage:r.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw $i(e,"credential-already-in-use",r);if(l==="EMAIL_EXISTS")throw $i(e,"email-already-in-use",r);if(l==="USER_DISABLED")throw $i(e,"user-disabled",r);const d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw ed(e,d,c);Da(e,d)}}catch(s){if(s instanceof tn)throw s;Da(e,"network-request-failed",{message:String(s)})}}function od(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?lg(e.config,s):`${e.config.apiScheme}://${s}`}class ug{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(td(this.auth,"network-request-failed")),dg.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function $i(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=td(e,t,i);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function hg(e,t){return eo(e,"POST","/v1/accounts:delete",t)}async function rd(e,t){return eo(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function ti(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function fg(e,t=!1){const n=Li(e),i=await n.getIdToken(t),s=ad(i);W(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,r=o==null?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:ti(vo(s.auth_time)),issuedAtTime:ti(vo(s.iat)),expirationTime:ti(vo(s.exp)),signInProvider:r||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function vo(e){return Number(e)*1e3}function ad(e){const[t,n,i]=e.split(".");if(t===void 0||n===void 0||i===void 0)return ds("JWT malformed, contained fewer than 3 sections"),null;try{const s=Vc(n);return s?JSON.parse(s):(ds("Failed to decode base64 JWT payload"),null)}catch(s){return ds("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ma(e){const t=ad(e);return W(t,"internal-error"),W(typeof t.exp<"u","internal-error"),W(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function er(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof tn&&gg(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}function gg({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class pg{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var n;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const n=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(t,n){this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=ti(this.lastLoginAt),this.creationTime=ti(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Bs(e){var t;const n=e.auth,i=await e.getIdToken(),s=await er(e,rd(n,{idToken:i}));W(s==null?void 0:s.users.length,n,"internal-error");const o=s.users[0];e._notifyReloadListener(o);const r=!((t=o.providerUserInfo)===null||t===void 0)&&t.length?ld(o.providerUserInfo):[],a=bg(e.providerData,r),l=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,u={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new nr(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(e,u)}async function mg(e){const t=Li(e);await Bs(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function bg(e,t){return[...e.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function ld(e){return e.map(t=>{var{providerId:n}=t,i=Jc(t,["providerId"]);return{providerId:n,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function yg(e,t){const n=await sd(e,{},async()=>{const i=Wc({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:o}=e.config,r=od(e,s,"/v1/token",`key=${o}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",nd.fetch()(r,{method:"POST",headers:a,body:i})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function vg(e,t){return eo(e,"POST","/v2/accounts:revokeToken",id(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class hn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){W(t.idToken,"internal-error"),W(typeof t.idToken<"u","internal-error"),W(typeof t.refreshToken<"u","internal-error");const n="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Ma(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,n)}updateFromIdToken(t){W(t.length!==0,"internal-error");const n=Ma(t);this.updateTokensAndExpiration(t,null,n)}async getToken(t,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(W(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,n){const{accessToken:i,refreshToken:s,expiresIn:o}=await yg(t,n);this.updateTokensAndExpiration(i,s,Number(o))}updateTokensAndExpiration(t,n,i){this.refreshToken=n||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,n){const{refreshToken:i,accessToken:s,expirationTime:o}=n,r=new hn;return i&&(W(typeof i=="string","internal-error",{appName:t}),r.refreshToken=i),s&&(W(typeof s=="string","internal-error",{appName:t}),r.accessToken=s),o&&(W(typeof o=="number","internal-error",{appName:t}),r.expirationTime=o),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new hn,this.toJSON())}_performRefresh(){return Qn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function be(e,t){W(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class xe{constructor(t){var{uid:n,auth:i,stsTokenManager:s}=t,o=Jc(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new pg(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new nr(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(t){const n=await er(this,this.stsTokenManager.getToken(this.auth,t));return W(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(t){return fg(this,t)}reload(){return mg(this)}_assign(t){this!==t&&(W(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(n=>Object.assign({},n)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const n=new xe(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(t){W(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,n=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),n&&await Bs(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Hn(this.auth.app))return Promise.reject(us(this.auth));const t=await this.getIdToken();return await er(this,hg(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,n){var i,s,o,r,a,l,c,d;const u=(i=n.displayName)!==null&&i!==void 0?i:void 0,h=(s=n.email)!==null&&s!==void 0?s:void 0,f=(o=n.phoneNumber)!==null&&o!==void 0?o:void 0,g=(r=n.photoURL)!==null&&r!==void 0?r:void 0,p=(a=n.tenantId)!==null&&a!==void 0?a:void 0,m=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,b=(c=n.createdAt)!==null&&c!==void 0?c:void 0,y=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:x,emailVerified:_,isAnonymous:v,providerData:w,stsTokenManager:k}=n;W(x&&k,t,"internal-error");const S=hn.fromJSON(this.name,k);W(typeof x=="string",t,"internal-error"),be(u,t.name),be(h,t.name),W(typeof _=="boolean",t,"internal-error"),W(typeof v=="boolean",t,"internal-error"),be(f,t.name),be(g,t.name),be(p,t.name),be(m,t.name),be(b,t.name),be(y,t.name);const D=new xe({uid:x,auth:t,email:h,emailVerified:_,displayName:u,isAnonymous:v,photoURL:g,phoneNumber:f,tenantId:p,stsTokenManager:S,createdAt:b,lastLoginAt:y});return w&&Array.isArray(w)&&(D.providerData=w.map(A=>Object.assign({},A))),m&&(D._redirectEventId=m),D}static async _fromIdTokenResponse(t,n,i=!1){const s=new hn;s.updateFromServerResponse(n);const o=new xe({uid:n.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await Bs(o),o}static async _fromGetAccountInfoResponse(t,n,i){const s=n.users[0];W(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?ld(s.providerUserInfo):[],r=!(s.email&&s.passwordHash)&&!(o!=null&&o.length),a=new hn;a.updateFromIdToken(i);const l=new xe({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:r}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new nr(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(o!=null&&o.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca=new Map;function Ye(e){Rs(e instanceof Function,"Expected a class definition");let t=Ca.get(e);return t?(Rs(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Ca.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class cd{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,n){this.storage[t]=n}async _get(t){const n=this.storage[t];return n===void 0?null:n}async _remove(t){delete this.storage[t]}_addListener(t,n){}_removeListener(t,n){}}cd.type="NONE";const Aa=cd;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function xo(e,t,n){return`firebase:${e}:${t}:${n}`}class fn{constructor(t,n,i){this.persistence=t,this.auth=n,this.userKey=i;const{config:s,name:o}=this.auth;this.fullUserKey=xo(this.userKey,s.apiKey,o),this.fullPersistenceKey=xo("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?xe._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,i="authUser"){if(!n.length)return new fn(Ye(Aa),t,i);const s=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let o=s[0]||Ye(Aa);const r=xo(i,t.config.apiKey,t.name);let a=null;for(const c of n)try{const d=await c._get(r);if(d){const u=xe._fromJSON(t,d);c!==o&&(a=u),o=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!o._shouldAllowMigration||!l.length?new fn(o,t,i):(o=l[0],a&&await o._set(r,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==o)try{await c._remove(r)}catch{}})),new fn(o,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(kg(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(xg(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(Eg(t))return"Blackberry";if(Ig(t))return"Webos";if(_g(t))return"Safari";if((t.includes("chrome/")||wg(t))&&!t.includes("edge/"))return"Chrome";if(Sg(t))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=e.match(n);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function xg(e=Kt()){return/firefox\//i.test(e)}function _g(e=Kt()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function wg(e=Kt()){return/crios\//i.test(e)}function kg(e=Kt()){return/iemobile/i.test(e)}function Sg(e=Kt()){return/android/i.test(e)}function Eg(e=Kt()){return/blackberry/i.test(e)}function Ig(e=Kt()){return/webos/i.test(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function dd(e,t=[]){let n;switch(e){case"Browser":n=La(Kt());break;case"Worker":n=`${La(Kt())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Rr}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,n){const i=o=>new Promise((r,a)=>{try{const l=t(o);r(l)}catch(l){a(l)}});i.onAbort=n,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const n=[];try{for(const i of this.queue)await i(t),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Tg(e,t={}){return eo(e,"GET","/v2/passwordPolicy",id(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Mg=6;class Cg{constructor(t){var n,i,s,o;const r=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=r.minPasswordLength)!==null&&n!==void 0?n:Mg,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),r.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),r.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),r.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),r.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(o=t.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var n,i,s,o,r,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsUppercaseLetter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(r=l.containsNumericCharacter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,n){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=t.length>=i),s&&(n.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,n,i,s,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ag{constructor(t,n,i,s){this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Oa(this),this.idTokenSubscription=new Oa(this),this.beforeStateQueue=new Dg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Qc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=Ye(n)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await fn.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const n=await rd(this,{idToken:t}),i=await xe._fromGetAccountInfoResponse(this,n,t);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var n;if(Hn(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,o=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(t);(!r||r===a)&&(l!=null&&l.user)&&(s=l.user,o=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return W(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(t){try{await Bs(t)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=ag()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Hn(this.app))return Promise.reject(us(this));const n=t?Li(t):null;return n&&W(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(t,n=!1){if(!this._deleted)return t&&W(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Hn(this.app)?Promise.reject(us(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Hn(this.app)?Promise.reject(us(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ye(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Tg(this),n=new Cg(t);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Ai("auth","Firebase",t())}onAuthStateChanged(t,n,i){return this.registerStateListener(this.authStateSubscription,t,n,i)}beforeAuthStateChanged(t,n){return this.beforeStateQueue.pushCallback(t,n)}onIdTokenChanged(t,n,i){return this.registerStateListener(this.idTokenSubscription,t,n,i)}authStateReady(){return new Promise((t,n)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},n)}})}async revokeAccessToken(t){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await vg(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,n){const i=await this.getOrInitRedirectPersistenceManager(n);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const n=t&&Ye(t)||this._popupRedirectResolver;W(n,this,"argument-error"),this.redirectPersistenceManager=await fn.create(this,[Ye(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var n,i;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(n=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,n,i,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(W(a,this,"internal-error"),a.then(()=>{r||o(this.currentUser)}),typeof n=="function"){const l=t.addObserver(n,i,s);return()=>{r=!0,l()}}else{const l=t.addObserver(n);return()=>{r=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return W(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=dd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(n["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var t;const n=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return n!=null&&n.error&&sg(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Lg(e){return Li(e)}class Oa{constructor(t){this.auth=t,this.observer=null,this.addObserver=Kh(n=>this.observer=n)}get next(){return W(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Og(e,t){const n=(t==null?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(Ye);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t==null?void 0:t.popupRedirectResolver)}function Pg(e){return Li(e).signOut()}new Oi(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Oi(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Oi(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Oi(5e3,15e3);var Pa="@firebase/auth",Ra="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Rg{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const n=this.auth.onIdTokenChanged(i=>{t((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,n),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const n=this.internalListeners.get(t);n&&(this.internalListeners.delete(t),n(),this.updateProactiveRefresh())}assertAuthConfigured(){W(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Bg(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Ng(e){mi(new pi("auth",(t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:r,authDomain:a}=i.options;W(r&&!r.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:r,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:dd(e)},c=new Ag(i,s,o,l);return Og(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,n,i)=>{t.getProvider("auth-internal").initialize()})),mi(new pi("auth-internal",t=>{const n=Lg(t.getProvider("auth").getImmediate());return(i=>new Rg(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Zn(Pa,Ra,Bg(e)),Zn(Pa,Ra,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Fg=300;Hh("authIdTokenMaxAge");Ng("Browser");const Ba=e=>e instanceof Tr?e.toDate():e,Nr=e=>e instanceof Date?Tr.fromDate(e):e;function ud(e,t){return{id:e,...t,createdAt:Ba(t.createdAt)||null,dueDate:Ba(t.dueDate)||null,recurrence:t.recurrence??null}}let ir=[];function In(){return ir}function $g(e,t,n){const i=r=>{typeof n=="function"&&n(r)};if(!e||!t)return i([]),()=>{};const s=Y.tasks(e,t),o=Qe(ft(K,s));return Sn(o,r=>{const a=r.docs.map(l=>ud(l.id,l.data()));ir=a,i(a)},r=>{console.error("[Tasks] Subscription error:",r),ir=[],i([])})}async function Hg(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");const n=ft(K,Y.tasks(e,t)),i=ft(K,Y.projects(e,t)),s=ft(K,Y.labels(e)),[o,r,a]=await Promise.all([Jn(n),Jn(i),Jn(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof Tr?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:l(o),projects:l(r),labels:l(a)}}async function hd(e,t,n){const i=Y.tasks(e,t),s={...n};return s.dueDate&&(s.dueDate=Nr(s.dueDate)),await Ge(ft(K,i),{...s,ownerId:e,status:"todo",createdAt:kn()})}async function jg(e,t,n,i){const s=Y.tasks(e,t);await Mi(Nt(K,s,n),{status:i})}async function zg(e,t,n,i){const s=Y.tasks(e,t),o={...i};o.dueDate!==void 0&&(o.dueDate=Nr(o.dueDate)),await Mi(Nt(K,s,n),o)}async function Ug(e,t,n){const i=Y.tasks(e,t);await Ci(Nt(K,i,n))}async function Vg(e,t,n){const i=Y.tasks(e,t),s=await oh(Nt(K,i,n));return s.exists()?ud(s.id,s.data()):null}async function Wg(e,t,n){if(!e||!t||!n)throw new Error("Invalid import parameters.");const{tasks:i=[],projects:s=[],labels:o=[]}=n,r=new Map,a=new Map,l=await Jn(ft(K,Y.labels(e))),c=new Map;l.forEach(u=>c.set(u.data().name,u.id));for(const u of o)if(u.name)if(c.has(u.name))a.set(u.id,c.get(u.name));else{const h={...u};delete h.id;const f=await Ge(ft(K,Y.labels(e)),h);a.set(u.id,f.id),c.set(u.name,f.id)}for(const u of s){const h={...u};delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt));const f=await Ge(ft(K,Y.projects(e,t)),h);r.set(u.id,f.id)}const d=i.map(async u=>{const h={...u};return delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt)),typeof h.dueDate=="string"&&(h.dueDate=new Date(h.dueDate)),h.dueDate&&(h.dueDate=Nr(h.dueDate)),h.projectId&&r.has(h.projectId)?h.projectId=r.get(h.projectId):h.projectId=null,Array.isArray(h.labelIds)&&(h.labelIds=h.labelIds.map(f=>a.get(f)).filter(f=>f)),h.ownerId=e,Ge(ft(K,Y.tasks(e,t)),h)});return await Promise.all(d),{tasksCount:i.length,projectsCount:s.length,labelsCount:o.length}}function ge(e){if(!e)return null;if(e.toDate&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e;const t=new Date(e);return isNaN(t.getTime())?null:t}function ce(e=new Date){const t=ge(e)||new Date,n=new Date(t);return n.setHours(0,0,0,0),n}function Yg(e=new Date){const t=ge(e)||new Date,n=new Date(t);return n.setHours(23,59,59,999),n}function fd(e=new Date){const t=ge(e)||new Date,n=t.getDay(),i=t.getDate()-n+(n===0?-6:1),s=new Date(t.setDate(i));return ce(s)}function qg(e=new Date){const t=ge(e)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function Gg(e){const t=ge(e);if(!t)return"";const n=new Date,i=ce(n),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return o!==n.getFullYear()?`${o}/${r}/${a}`:`${r}/${a}`}function Xg(e){const t=ge(e);if(!t)return"text-gray-500";const n=ce(new Date),i=Math.round((t.getTime()-n.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function Kg(e,t){var i;if(!e||!(t!=null&&t.type))return null;const n=new Date(ge(e));switch(t.type){case"daily":return n.setDate(n.getDate()+1),n;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=n.getDay();for(let o=1;o<=7;o++)if(t.days.includes((s+o)%7))return n.setDate(n.getDate()+o),n;return null;case"weekdays":do n.setDate(n.getDate()+1);while(n.getDay()===0||n.getDay()===6);return n;case"monthly":return n.setMonth(n.getMonth()+1),n;default:return null}}function gd(e){var n;const t=ce(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&((n=e.days)==null?void 0:n.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(e.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function Dn(){var t;const e=(t=U.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function Tn(){const e=Zt();if(!e)throw new Error("Workspace required.");return e}async function Jg(e){var o;if(e.status!=="completed"||!e.recurrence)return;const{recurrence:t,dueDate:n}=e;if(!n||typeof t!="object"||!t.type)return;const i=Kg(n,t);if(!i)return;const s={title:e.title,description:e.description||"",status:"todo",dueDate:i,projectId:e.projectId||null,labelIds:e.labelIds||[],timeBlockId:e.timeBlockId||null,duration:e.duration||null,recurrence:e.recurrence};try{const r=(o=U.currentUser)==null?void 0:o.uid,a=Zt();r&&a&&await hd(r,a,s)}catch(r){console.error("[Recurring] Generation failed:",r)}}async function Zg(e){const t=Dn(),n=Tn(),i={...e};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),hd(t,n,i)}async function Qg(e,t){const n=Dn(),i=Tn();if(await jg(n,i,e,t),t==="completed"){const s=await Vg(n,i,e);s&&Jg(s).catch(o=>console.error(o))}}async function ei(e,t){const n=Dn(),i=Tn();return zg(n,i,e,t)}async function pd(e){const t=Dn(),n=Tn();return Ug(t,n,e)}async function tp(){const e=Dn(),t=Tn();return Hg(e,t)}async function ep(e){const t=Dn(),n=Tn();return Wg(t,n,e)}let ni=[];function md(){return ni}function np(){ni=[]}function ip(e,t){var r;const n=typeof e=="function"?e:t,i=(r=U.currentUser)==null?void 0:r.uid;if(!i||typeof n!="function")return ni=[],typeof n=="function"&&n([]),()=>{};const s=Y.filters(i),o=Qe(ft(K,s));return Sn(o,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));ni=l,n(l)},a=>{console.error("Error subscribing to filters:",a),ni=[],n([])})}async function sp(e){var o;const t=(o=U.currentUser)==null?void 0:o.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t),{id:i,...s}=e;await Ge(ft(K,n),{...s,ownerId:t,createdAt:kn()})}async function op(e,t){var r;const n=(r=U.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Authentication required");const i=Y.filters(n),{id:s,...o}=t;await Mi(Nt(K,i,e),{...o,updatedAt:kn()})}async function rp(e){var i;const t=(i=U.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t);await Ci(Nt(K,n,e))}let sr=[];function ap(){return sr}function lp(e,t){if(!e)return t([]),()=>{};const n=Y.labels(e),{db:i}=Rc(),s=Qe(ft(i,n));return Sn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));sr=r,t(r)},o=>{console.error("[Labels] Subscription error:",o),sr=[],t([])})}function cp(e,t){var s;const n=typeof e=="function"?e:t,i=(s=U.currentUser)==null?void 0:s.uid;return i&&typeof n=="function"?lp(i,n):(typeof n=="function"&&n([]),()=>{})}let _o=null;function no(){return _o||(_o=Rc().db),_o}let hs=[];function dp(e,t,n){hs=[];const i=Y.projects(e,t),s=no(),o=Qe(ft(s,i),Dr("createdAt","asc"));return Sn(o,r=>{const a=r.docs.map(l=>({id:l.id,...l.data()}));hs=a,n(a)},r=>{console.error("Error subscribing to projects:",r),hs=[],n([])})}function Fr(){return hs}async function up(e,t,n){const i=Y.projects(e,t),s=no();await Ge(ft(s,i),{name:n,ownerId:e,createdAt:kn()})}async function hp(e,t,n,i){const s=Y.projects(e,t),o=no(),r=Nt(o,s,n);return Mi(r,i)}async function fp(e,t,n){const i=Y.projects(e,t),s=no();await Ci(Nt(s,i,n))}function bd(){var n;const e=(n=U.currentUser)==null?void 0:n.uid,t=Zt();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const gp=Fr,pp=(e,t)=>{const n=typeof e=="function"?e:t,i=typeof e=="string"?e:Zt(),s=U.currentUser;return s&&i&&typeof n=="function"?dp(s.uid,i,n):(typeof n=="function"&&n([]),()=>{})},mp=async(e,t=null)=>{const n=U.currentUser;if(!n)throw new Error("Authentication required.");const i=t||Zt();if(!i)throw new Error("Workspace selection required.");return up(n.uid,i,e)},bp=async(e,t)=>{const{userId:n,workspaceId:i}=bd();return hp(n,i,e,t)},yd=async e=>{const{userId:t,workspaceId:n}=bd();return fp(t,n,e)};let _e=[];const yp=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function vp(e,t){var o;const n=(o=U.currentUser)==null?void 0:o.uid;if(!n)return _e=[...yp],typeof t=="function"&&t(_e),()=>{};const i=Y.timeblocks(n),s=Qe(ft(K,i),Dr("order","asc"));return Sn(s,r=>{_e=r.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(_e)},r=>{console.error("[TimeBlocks] Subscription error:",r)})}function he(){return[..._e]}function vd(e){return _e.find(t=>t.id===e)}function xp(){_e=[]}async function _p(e){var n;const t=(n=U.currentUser)==null?void 0:n.uid;if(!t){P("ログインが必要です");return}try{const i=Y.timeblocks(t),s=e.id||crypto.randomUUID(),o=e.order!==void 0?e.order:Math.max(..._e.map(a=>a.order),-1)+1,r={name:e.name,start:e.start,end:e.end,color:e.color,order:o,updatedAt:kn()};return await rh(Nt(K,i,s),r,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i)}}async function wp(e){var n;const t=(n=U.currentUser)==null?void 0:n.uid;if(t)try{const i=Y.timeblocks(t);return await Ci(Nt(K,i,e)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function kp(e,t){const n=U.currentUser;return!n||!e?(typeof t=="function"&&t([]),()=>{}):$g(n.uid,e,t)}function xd(){const e=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",e);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),Ns()}function Ns(){const e=document.getElementById("main-content");if(!e)return;const t=localStorage.getItem("background")||"none";e.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(e.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}const Sp=Object.freeze(Object.defineProperty({__proto__:null,applyBackground:Ns,initTheme:xd},Symbol.toStringTag,{value:"Module"}));function Ep(e,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),e.addEventListener("click",i=>{i.target===e&&t()}),Hi("app-theme","theme",i=>{document.documentElement.classList.toggle("dark",i==="dark"),Ns()}),Hi("font-size","fontSize",i=>{const s=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];document.body.classList.remove(...s),document.body.classList.add(`font-app-${i}`)}),Hi("bg-pattern","background",()=>Ns()),Hi("sidebar-density",B.STORAGE_KEYS.DENSITY,i=>{i==="compact"?localStorage.setItem(B.STORAGE_KEYS.COMPACT,"true"):localStorage.setItem(B.STORAGE_KEYS.COMPACT,"false"),window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{density:i}}))}),Dp(),Tp(),Mp(),Cp(),Ap(),Lp(t),Ip()}function Ip(){document.querySelectorAll(".accordion-header").forEach(t=>{t.addEventListener("click",()=>{const n=t.parentElement,i=n.querySelector(".accordion-content"),s=t.querySelector(".accordion-icon"),o=i.style.maxHeight!=="0px"&&i.style.maxHeight!=="";document.querySelectorAll(".settings-accordion").forEach(r=>{if(r!==n){const a=r.querySelector(".accordion-content"),l=r.querySelector(".accordion-icon");a.style.maxHeight="0px",a.classList.remove("opacity-100"),a.classList.add("opacity-0"),l.classList.remove("rotate-180")}}),o?(i.style.maxHeight="0px",i.classList.remove("opacity-100"),i.classList.add("opacity-0"),s.classList.remove("rotate-180")):(i.style.maxHeight=i.scrollHeight+"px",i.classList.remove("opacity-0"),i.classList.add("opacity-100"),s.classList.add("rotate-180"))})}),document.querySelectorAll(".settings-accordion").forEach(t=>{const n=t.querySelector(".accordion-content");n.style.maxHeight||n.classList.contains("opacity-100")&&(n.style.maxHeight=n.scrollHeight+"px")})}function Hi(e,t,n){const i=document.querySelectorAll(`input[name="${e}"]`),s=localStorage.getItem(t),o=["border-blue-500","bg-blue-50","dark:bg-blue-900/20","text-blue-700","dark:text-blue-300"],r=["border-gray-200","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-700/50","text-gray-600","dark:text-gray-300"],a=l=>{i.forEach(c=>{const d=c.parentElement;c===l?(d.classList.remove(...r),d.classList.add(...o)):(d.classList.remove(...o),d.classList.add(...r))})};if(i.forEach(l=>{l.addEventListener("change",c=>{const d=c.target.value;localStorage.setItem(t,d),a(c.target),n(d)})}),s)i.forEach(l=>{l.value===s&&(l.checked=!0)});else{const l=Array.from(i).find(c=>c.checked);l&&localStorage.setItem(t,l.value)}}function Dp(){const e=document.querySelector('select[name="font-en-select"]'),t=document.querySelector('select[name="font-jp-select"]');e&&e.addEventListener("change",n=>{pa("EN",n.target.value)}),t&&t.addEventListener("change",n=>{pa("JP",n.target.value)})}function Tp(){const e=document.querySelector('select[name="timezone-select"]');e&&e.addEventListener("change",t=>{localStorage.setItem("timezone",t.target.value),window.dispatchEvent(new CustomEvent("timezone-changed",{detail:{timezone:t.target.value}}))})}function Mp(){const e=document.getElementById("export-data-btn-new");e&&(e.onclick=async()=>{const t=e.querySelector("span.font-bold"),n=t?t.textContent:"バックアップを作成";e.disabled=!0,e.classList.add("opacity-70","cursor-wait"),t&&(t.textContent="バックアップ作成中...");try{const i=await tp(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(r),P({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),P({message:"エクスポートに失敗した",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait"),t&&(t.textContent=n)}})}function Cp(){const e=document.getElementById("import-data-btn-new"),t=document.getElementById("import-file-input");!e||!t||(e.onclick=()=>{t.value="",t.click()},t.onchange=n=>{const i=n.target.files[0];if(!i)return;const s=new FileReader;s.onload=async o=>{try{const r=JSON.parse(o.target.result);if(!r.tasks||!r.projects)throw new Error("Invalid backup format");e.disabled=!0,e.classList.add("opacity-70","cursor-wait");const a=await ep(r);P({message:`インポート完了！
タスク: ${a.tasksCount}件
プロジェクト: ${a.projectsCount}件
ラベル: ${a.labelsCount}件`,type:"success"}),setTimeout(()=>window.location.reload(),1500)}catch(r){console.error(r),P({message:`インポートに失敗しました。
ファイルが破損している可能性があります。`,type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait")}},s.readAsText(i)})}function Ap(){const e=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!e||!t||(e.onclick=async()=>{const n=t.value.trim();if(n.length<6)return P({message:"6文字以上入力してくれ",type:"error"});try{await mh(n),t.value="",P({message:"パスワードを変更しました",type:"success"})}catch{}})}function Lp(e){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Pg(U),e()}catch{P({message:"エラーが発生した",type:"error"})}})}let Na=!1;function Fa(){var e;(e=document.getElementById(B.MODAL_IDS.SETTINGS))==null||e.remove()}function Op(){if(Na)return;Hc(),Th();const e=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),io())};document.addEventListener("click",e),Na=!0}function io(){Fa();const e=vh(),t=U.currentUser,n=(t==null?void 0:t.email)||"匿名ユーザー",i=(n[0]||"?").toUpperCase(),s=document.createElement("div");s.id=B.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=Ah(i,n,e),document.body.appendChild(s),Ep(s,Fa)}function Pp(e=null){const t=!!e,n={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${n.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(e==null?void 0:e.name)||""}" 
                        placeholder="${n.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${n.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function _d(e=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Pp(e),document.body.appendChild(n),Rp(n,e)}function Rp(e,t){const n=e.querySelector("#save-workspace-btn"),i=e.querySelector("#modal-workspace-name"),s=e.querySelector("#cancel-modal-btn"),o=e.querySelector("#workspace-modal-overlay"),r=()=>{document.removeEventListener("keydown",a),e.remove()},a=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",a),o.onclick=c=>{c.target===o&&r()},s&&(s.onclick=r);const l=async()=>{if(n.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return P({message:"ワークスペース名を入力してくれ",type:"error"});if(Jo().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return P({message:"その名前は既に使われているぞ",type:"error"});n.disabled=!0,n.textContent=t?"更新中...":"作成中...";try{if(t)await Eh(t.id,c);else{const u=await $c(c);Lr(u.id)}r()}catch(u){n.disabled=!1,n.textContent=t?"保存":"作成",P({message:`失敗した: ${u.message}`,type:"error"})}};n==null||n.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Fs="none",wo={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function wd(e=null){const t=!!e,n=gp(),i=he(),s=[30,45,60,75,90],o=[{id:"today",name:"今日"},{id:"tomorrow",name:"明日"},{id:"week",name:"今週"},{id:"next-week",name:"来週"}],r=Bp((e==null?void 0:e.query)||""),a=document.createElement("div");a.id="filter-creation-modal",a.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-fade-in",a.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-6xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog" aria-modal="true">
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-base font-bold text-gray-800 dark:text-white">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="text-gray-400 hover:text-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-4 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider">フィルター名</label>
                    <input type="text" id="filter-name" value="${(e==null?void 0:e.name)||""}" 
                           class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
                    ${fs("プロジェクト",n,r.project,"filter-project-checkbox")}
                    ${Np(i,r.timeblock)}
                    ${fs("所要時間",s,r.duration,"filter-duration-checkbox",l=>`${l} min`)}
                    ${fs("日付",o,r.date,"filter-date-checkbox")}
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900 flex justify-end gap-3 border-t border-gray-100 dark:border-gray-700">
                <button id="cancel-filter-btn" class="text-sm font-medium text-gray-500 hover:text-gray-800 transition">キャンセル</button>
                <button id="save-filter-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all active:scale-95">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(a),Fp(a,e)}function Bp(e){const t={project:[],timeblock:[],duration:[],date:[]},n=/(\w+):([^ ]+)/g;let i;for(;(i=n.exec(e))!==null;){const[s,o,r]=i;t[o]&&(t[o]=r.split(",").map(a=>o==="timeblock"&&(a==="null"||a==="none")?Fs:a))}return t}function fs(e,t,n,i,s=o=>o.name||o){return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${e}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map(o=>{const r=String(o.id||o);return`
                        <label class="flex items-center px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition">
                            <input type="checkbox" value="${r}" ${n.includes(r)?"checked":""} class="${i} h-4 w-4 text-blue-600 rounded">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate">${s(o)}</span>
                        </label>
                    `}).join("")}
            </div>
        </div>
    `}function Np(e,t){const n=[{id:Fs,name:"未定"},...e];return fs("時間帯",n,t,"filter-timeblock-checkbox",i=>i.id===Fs?i.name:`${i.start}-${i.end}`)}function Fp(e,t){const n=()=>{document.removeEventListener("keydown",i),e.remove()},i=s=>s.key==="Escape"&&n();document.addEventListener("keydown",i),e.querySelector("#close-filter-modal").onclick=n,e.querySelector("#cancel-filter-btn").onclick=n,e.onclick=s=>s.target===e&&n(),e.querySelector("#save-filter-btn").onclick=async()=>{const s=e.querySelector("#filter-name").value.trim();if(!s)return P({message:wo.NAME_REQUIRED,type:"error"});const o=c=>Array.from(e.querySelectorAll(`.${c}:checked`)).map(d=>d.value),r=o("filter-timeblock-checkbox").map(c=>c===Fs?"null":c),a={project:o("filter-project-checkbox"),timeblock:r,duration:o("filter-duration-checkbox"),date:o("filter-date-checkbox")},l=Object.entries(a).filter(([c,d])=>d.length>0).map(([c,d])=>`${c}:${d.join(",")}`).join(" ");if(!l)return P({message:wo.CONDITION_REQUIRED,type:"error"});try{const c={name:s,query:l,type:"custom"};t?await op(t.id,c):await sp(c),document.dispatchEvent(new CustomEvent("filters-updated")),n()}catch(c){P({message:wo.SAVE_ERROR+c.message,type:"error"})}}}function $p(e=null){const t=!!e,n={title:(e==null?void 0:e.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${n.title}" placeholder="${n.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${n.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function kd(e=null){var i;const t="project-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=$p(e),document.body.appendChild(n),Hp(n,e)}function Hp(e,t){const n=()=>e.remove(),i=e.querySelector("#modal-project-name"),s=e.querySelector("#save-project-btn"),o=e.querySelector("#delete-project-btn"),r=e.querySelector("#cancel-modal-btn");r&&(r.onclick=n),e.onclick=l=>{l.target===e&&n()};const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return P({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await bp(t.id,{name:l});else{const c=Zt();if(!c)throw new Error("ワークスペースが選択されていないぞ");await mp(l,c)}n()}catch(c){P({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),o&&t&&(o.onclick=()=>{P({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await yd(t.id),n()}catch{P({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function yi(e,t,n,i={},s=0,o="normal"){const r=document.createElement("li"),{DENSITY_CLASSES:a,COLORS:l}=B;r.dataset.type=t,r.dataset.id=n;const c=a[o]||a.normal;r.className=`group flex items-center justify-between px-3 ${c} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const u={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3">⏱️</span>',filter:i.iconHtml||'<span class="mr-3">🔍</span>'}[t]||'<span class="mr-3">🔹</span>',h=s>0?`<span class="text-gray-400 font-light mr-2" style="font-size: 0.85em;">${s}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${u}
            <span class="truncate">${e}</span>
        </div>
        <div class="flex items-center">${h}</div>
    `,r}function $r(e,t,n){var o;const i=jp(t,n);if(!i)return;(o=document.getElementById("sidebar-context-menu"))==null||o.remove();const s=zp(i);document.body.appendChild(s),Up(s,e),Vp(s,i)}function ko(e,t=null){document.dispatchEvent(new CustomEvent("route-change",{detail:{page:e,id:t}}))}function jp(e,t){return{project:{editLabel:"編集",onEdit:()=>kd(t),onDelete:async()=>{await yd(t.id),ko("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>wd(t),onDelete:async()=>{await rp(t.id),ko("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>_d(t),onDelete:async()=>{if(Jo().length<=1)throw new Error("最後のワークスペースは削除できない。");await Ih(t.id);const s=Jo().filter(o=>o.id!==t.id);s.length>0&&(Lr(s[0].id),ko("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[e]}function zp(e){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${e.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function Up(e,t){const{clientX:i,clientY:s}=t,o=window.innerWidth,r=window.innerHeight;e.style.visibility="hidden";const{width:a,height:l}=e.getBoundingClientRect();let c=i,d=s;i+a>o&&(c=i-a),s+l>r&&(d=s-l),e.style.left=`${Math.max(8,c)}px`,e.style.top=`${Math.max(8,d)}px`,e.style.visibility="visible"}function Vp(e,t){const n=()=>{e.remove(),document.removeEventListener("click",n),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&n();setTimeout(()=>{document.addEventListener("click",n),document.addEventListener("keydown",i)},0),e.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),n(),t.onEdit()},e.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),n(),P({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(o){P({message:"削除に失敗した: "+o.message,type:"error"})}}})}}const ji={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let qt=null,ii=null,$a=!1;function si(e){qt&&(e?(qt.classList.remove(...ji.MENU_INVISIBLE),qt.classList.add(...ji.MENU_VISIBLE),document.addEventListener("click",Ha,{capture:!0})):(qt.classList.remove(...ji.MENU_VISIBLE),qt.classList.add(...ji.MENU_INVISIBLE),document.removeEventListener("click",Ha,{capture:!0})))}const Ha=e=>{qt&&!qt.contains(e.target)&&ii&&!ii.contains(e.target)&&si(!1)};function Sd(){if($a)return;ii=document.getElementById("workspace-trigger"),qt=document.getElementById("workspace-menu");const e=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!ii||!qt||(ii.onclick=n=>{n.stopPropagation();const i=qt.classList.contains("opacity-100");si(!i)},e&&(e.onclick=()=>{si(!1),_d(null)}),t&&(t.onclick=()=>{si(!1),io()}),document.addEventListener("workspace-changed",n=>{const{workspaceId:i,workspaces:s}=n.detail;Ed(s,i)}),$a=!0)}function Ed(e,t=Zt()){const n=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(n&&Wp(e,n,t),i){const s=e.find(o=>o.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function Wp(e,t,n){t.innerHTML="",e.forEach(i=>{const s=i.id===n,o=document.createElement("button");o.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const r=document.createElement("span");if(r.className="truncate pointer-events-none",r.textContent=i.name,o.appendChild(r),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,o.appendChild(a.firstElementChild)}o.onclick=()=>{s||Lr(i.id),si(!1)},o.oncontextmenu=a=>{a.preventDefault(),$r(a,"workspace",i)},t.appendChild(o)})}const{Z_INDEX:gn}=yh,Yp=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${gn.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${gn.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${B.DEFAULT_WIDTH}px;">
        ${qp()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${gn.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,qp=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,Gp=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${gn.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${gn.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700 z-50">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar bg-white dark:bg-gray-800" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1 bg-white dark:bg-gray-800">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function Xp(){const e=document.getElementById("app");e&&(e.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${Yp()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${Gp()}
                <div id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar scroll-smooth">
                    <div class="w-full max-w-4xl mx-auto">
                        <div id="task-view" class="w-full animate-fade-in transition-opacity duration-150"></div>
                        <div id="search-view" class="hidden w-full animate-fade-in"></div>
                        <div id="dashboard-view" class="hidden w-full animate-fade-in"></div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${gn.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{Nc(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),Sd(),Jp(),Kp()}))}function Kp(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),n=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=o=>{const r=e.classList.contains("-translate-x-full"),a=o??!r;e.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};n==null||n.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function Jp(){document.addEventListener("keydown",e=>{const t=["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.closest("[contenteditable]"),n=document.querySelector('[role="dialog"]');if(e.key==="/"&&!t&&!n){const i=document.getElementById("page-search-input");i&&(e.preventDefault(),i.focus())}})}function Zp(e){return e?(e.toDate?e.toDate():new Date(e)).toISOString().split("T")[0]:""}function Qp(e=[]){return["日","月","火","水","木","金","土"].map((n,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer">
            <input type="checkbox" data-day-index="${i}" ${e.includes(i)?"checked":""} 
                   class="form-checkbox h-4 w-4 text-blue-600 dark:text-blue-400 bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded">
            <span class="text-xs text-gray-700 dark:text-gray-300">${n}</span>
        </label>
    `).join("")}function ja(e,t,n){return e.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${n(i)}
        </option>
    `).join("")}const tm="task_modal_schedule_open";function em(e){let t=e.dueDate;const n=e.recurrence||{type:"none",days:[]};n.type!=="none"&&!t&&(t=gd(n));const i=t?Zp(t.toDate?t.toDate():new Date(t)):"",s=ja(he(),e.timeBlockId,c=>`${c.start} - ${c.end}`),o=ja([30,45,60,75,90],e.duration,c=>`${c} min`),r=i||n.type!=="none"||e.timeBlockId||e.duration,a=localStorage.getItem(tm);let l=r;return a!==null?l=a==="true":r&&(l=!0),`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
            <div class="bg-white dark:bg-gray-800 w-full max-w-4xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-task-title" value="${e.title}" placeholder="タスクのタイトル"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition ml-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ (2カラムレイアウト) -->
                <div class="px-6 py-6 overflow-y-auto flex-1 min-h-0 bg-gray-50/30 dark:bg-gray-900/10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
                        
                        <!-- 左カラム (8/12): メモ -->
                        <div class="md:col-span-8 flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    メモ (Markdown)
                                </label>
                                <div class="flex items-center gap-2">
                                    <div class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-md p-0.5">
                                        <button type="button" id="md-bold-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="太字 (Ctrl+B)">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6V4zm0 8h9a4 4 0 014 4 4 4 0 01-4 4H6v-8z"></path></svg>
                                        </button>
                                        <div class="w-px h-3 bg-gray-300 dark:bg-gray-600 mx-0.5"></div>
                                        <button type="button" id="md-list-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="箇条書き">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <button type="button" id="md-ordered-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="番号付きリスト">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7v.01M3 12v.01M3 17v.01"></path></svg>
                                        </button>
                                    </div>
                                    <button id="toggle-memo-view" class="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-2 py-0.5 rounded transition-colors text-xs font-medium ml-2">プレビュー</button>
                                </div>
                            </div>
                            <div class="flex-1 relative min-h-[200px]">
                                <textarea id="modal-task-desc" placeholder="詳細を入力..."
                                    class="w-full h-full p-3 bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg outline-none text-sm transition-all resize-y leading-relaxed focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono">${e.description||""}</textarea>
                                <div id="modal-task-desc-preview" class="hidden absolute inset-0 w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- 右カラム (4/12): スケジュール設定 -->
                        <div class="md:col-span-4 space-y-4">
                            <details id="modal-task-schedule-details" class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm" ${l?"open":""}>
                                <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50">
                                    <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        スケジュール
                                    </span>
                                    <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </span>
                                </summary>
                                
                                <div class="p-4 flex flex-col gap-4">
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                        <div class="relative">
                                            <input type="date" id="modal-task-date" value="${i}"
                                                class="w-full pl-3 pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:justify-end [&::-webkit-calendar-picker-indicator]:cursor-pointer">
                                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 dark:text-gray-400">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                        <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="none" ${n.type==="none"?"selected":""}>なし</option>
                                            <option value="daily" ${n.type==="daily"?"selected":""}>毎日</option>
                                            <option value="weekdays" ${n.type==="weekdays"?"selected":""}>平日</option>
                                            <option value="weekly" ${n.type==="weekly"?"selected":""}>毎週</option>
                                            <option value="monthly" ${n.type==="monthly"?"selected":""}>毎月</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                        <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">未定</option>
                                            ${s}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                        <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">指定なし</option>
                                            ${o}
                                        </select>
                                    </div>

                                    <div id="recurrence-days-container" class="${n.type!=="weekly"?"hidden":""} pt-2 border-t border-gray-100 dark:border-gray-700">
                                        <label class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</label>
                                        <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                            ${Qp(n.days)}
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                    </div>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                    </div>
                </div>
            </div>
        </div>
    `}function nm(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function Id(e){if(!e)return"";const t=e.split(`
`);let n=[],i=null;return t.forEach(s=>{const o=s.trimStart(),r=o.startsWith("* ")||o.startsWith("- "),a=/^\d+\.\s/.test(o),l=r||a;if(l){const c=a?"ol":"ul";if(i!==c){i&&n.push(`</${i}>`);const d=a?"list-decimal":"list-disc";n.push(`<${c} class="${d} ml-5 space-y-1">`),i=c}}else i&&(n.push(`</${i}>`),i=null);if(l){let c="";r?c=o.substring(2):c=o.replace(/^\d+\.\s/,"");const d=za(c);n.push(`<li>${d}</li>`)}else s.trim()?n.push(`<p class="mb-2">${za(s)}</p>`):i&&(n.push(`</${i}>`),i=null)}),i&&n.push(`</${i}>`),n.join(`
`)}function za(e){return nm(e).replace(/\[(.*?)\]\((.*?)\)/g,(n,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}function Ua(e,t,n=""){const i=e.selectionStart,s=e.selectionEnd,o=e.value,r=o.substring(i,s);let a=o.substring(0,i),l=o.substring(s),c="",d=0;if(n)c=a+t+r+n+l,d=s+t.length+n.length,i===s&&(d-=n.length);else if(i!==s){const h=r.split(`
`).map(f=>t+f).join(`
`);c=a+h+l,d=i+h.length}else c=a+t+l,d=i+t.length;e.value=c,e.focus(),e.selectionEnd=d,n&&i===s?(e.selectionStart=i+t.length,e.selectionEnd=i+t.length):n&&(e.selectionStart=i,e.selectionEnd=s+t.length+n.length),e.dispatchEvent(new Event("input"))}function Va(e,t){const n=e.selectionStart,i=e.selectionEnd,s=e.value;let o=s.lastIndexOf(`
`,n-1)+1,r=s.indexOf(`
`,i);r===-1&&(r=s.length);const l=s.substring(o,r).split(`
`),c=/^(\s*)([-*]|\d+\.)(\s+)/,u=l.map(h=>{const f=h.match(c);if(f){const g=f[2],p=/^\d+\.\s*$/.test(t),m=/^\d+\.$/.test(g),b=/^[-*]$/.test(g);return p&&m||!p&&b?h.replace(c,"$1"):h.replace(c,`$1${t}`)}else return t+h}).join(`
`);e.setRangeText(u,o,r,"select"),e.dispatchEvent(new Event("input")),e.focus()}function im(){const e=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),n=document.getElementById("toggle-memo-view"),i=document.getElementById("md-bold-btn"),s=document.getElementById("md-list-btn"),o=document.getElementById("md-ordered-btn");if(!e||!t)return;n&&n.classList.add("hidden");const r=()=>{e.classList.remove("hidden"),t.classList.add("hidden"),e.focus()},a=()=>{const c=Id(e.value);t.innerHTML=c||'<span class="text-gray-400 cursor-text">メモを入力...</span>',e.classList.add("hidden"),t.classList.remove("hidden")};e.value.trim()?a():r(),t.addEventListener("click",r),e.addEventListener("blur",()=>{a()}),e.addEventListener("input",()=>{}),e.addEventListener("keydown",c=>{(c.ctrlKey||c.metaKey)&&c.key==="b"&&(c.preventDefault(),Ua(e,"**","**"))});const l=(c,d)=>{c&&(c.addEventListener("mousedown",u=>u.preventDefault()),c.addEventListener("click",d))};l(i,()=>Ua(e,"**","**")),l(s,()=>Va(e,"- ")),l(o,()=>Va(e,"1. "))}function sm(){const e=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),n=document.getElementById("modal-task-date");if(!e||!t||!n)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(r,a=[])=>{if(r==="weekly"&&a.length===0)return;const l=gd({type:r,days:a});n.value=l.toISOString().substring(0,10)},o=()=>Array.from(i).filter(r=>r.checked).map(r=>parseInt(r.dataset.dayIndex??"0",10));e.addEventListener("change",r=>{const a=r.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?o():[];s(a,c)}}),i.forEach(r=>{r.addEventListener("change",()=>{const a=o();s("weekly",a)})})}let ne={};function om(e){ne={title:e.querySelector("#modal-task-title"),desc:e.querySelector("#modal-task-desc"),date:e.querySelector("#modal-task-date"),recurrence:e.querySelector("#modal-task-recurrence"),timeblock:e.querySelector("#modal-task-timeblock"),duration:e.querySelector("#modal-task-duration"),saveBtn:e.querySelector("#save-task-modal-btn"),deleteBtn:e.querySelector("#delete-task-modal-btn"),closeBtn:e.querySelector("#close-modal-btn"),cancelBtn:e.querySelector("#cancel-modal-btn"),overlay:e.querySelector("div.fixed")}}function rm(e,t,n){om(e);const{closeBtn:i,cancelBtn:s,overlay:o,saveBtn:r,deleteBtn:a}=ne;[i,s].forEach(d=>d==null?void 0:d.addEventListener("click",n)),o==null||o.addEventListener("click",d=>{d.target===d.currentTarget&&n()});const l=e.querySelector("#modal-task-schedule-details");l&&l.addEventListener("toggle",()=>{localStorage.setItem("task_modal_schedule_open",l.open)}),r==null||r.addEventListener("click",async()=>{await am(t,n)}),a==null||a.addEventListener("click",()=>{P({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await pd(t.id),n()}catch{P({message:"削除に失敗した",type:"error"})}}})});const c=ne.date;c&&c.addEventListener("click",d=>{if(typeof c.showPicker=="function")try{c.showPicker()}catch(u){console.debug("showPicker failed or already open",u)}}),sm(),im()}async function am(e,t){var d,u,h,f,g,p,m,b;const n=(u=(d=ne.title)==null?void 0:d.value)==null?void 0:u.trim();if(!n){P({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=ne.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){P({message:"無効な日付だ",type:"error"});return}const o=(f=ne.recurrence)==null?void 0:f.value;let r=null;if(o!=="none"&&(r={type:o},o==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(x=>parseInt(x.dataset.dayIndex??"",10)).filter(x=>!isNaN(x)).sort((x,_)=>x-_);if(y.length===0){P({message:"曜日を選択してくれ",type:"error"});return}r.days=y}const a=parseInt((g=ne.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:n,description:((m=(p=ne.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:r,timeBlockId:((b=ne.timeblock)==null?void 0:b.value)||null,duration:l};try{await ei(e.id,c),t()}catch(y){console.error("Failed to update task:",y),P({message:"保存に失敗した",type:"error"})}}const Dd=e=>{e.key==="Escape"&&Td()};function lm(e){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=em(e),rm(t,e,Td),document.addEventListener("keydown",Dd)}function Td(){const e=document.getElementById("modal-container");e&&(e.innerHTML="",document.removeEventListener("keydown",Dd))}const Hr=e=>`${B.STORAGE_KEYS.SECTION_PREFIX}${e}`,cm={basic:{title:"基本項目",listId:B.LIST_IDS.BASIC,renderContent:e=>`
                ${zi("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${zi("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${zi("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${zi("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            `},projects:{title:"プロジェクト",listId:B.LIST_IDS.PROJECTS,hasAddButton:!0,buttonId:"add-project-btn"},timeblocks:{title:"時間帯",listId:B.LIST_IDS.TIMEBLOCKS,hasAddButton:!0,buttonId:"edit-timeblocks-btn"},durations:{title:"所要時間",listId:B.LIST_IDS.DURATIONS},filters:{title:"フィルター",listId:B.LIST_IDS.FILTERS,hasAddButton:!0,buttonId:"add-filter-btn"}},Md=["basic","projects","timeblocks","durations","filters"];function dm(){try{const e=localStorage.getItem(B.STORAGE_KEYS.SECTION_ORDER);if(e)return JSON.parse(e)}catch(e){console.error("Failed to parse section order",e)}return Md}function um(e,t,n=!1,i=""){const s=Cr(Hr(t),!0),o=s?"rotate-0":"-rotate-90",r=n?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${e}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${o} section-arrow" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${e}</h3>
            </div>
            ${r}
        </div>
    `}function hm(e,t=""){const n=Cr(Hr(e),!0);return`<ul id="${e}" class="space-y-0.5 mb-2 pl-1 ${n?"":"hidden"}">${t}</ul>`}function zi(e,t,n,i=""){return`
        <li>
            <a href="#" id="${e}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${n}</span>
                ${i}
            </a>
        </li>
    `}function fm(){const e=dm();return Md.forEach(n=>{e.includes(n)||e.push(n)}),`<div class="mt-2 select-none" id="sidebar-sections-wrapper">${e.map(n=>{const i=cm[n];if(!i)return"";const s=i.renderContent?i.renderContent(i.listId):"";return`
            <div class="sidebar-section-container transition-all duration-200" draggable="true" data-section-key="${n}">
                ${um(i.title,i.listId,i.hasAddButton,i.buttonId)}
                ${hm(i.listId,s)}
            </div>
        `}).join("")}</div>`}function gm(){document.querySelectorAll(".sidebar-section-header").forEach(e=>{const t=e.dataset.target,n=document.getElementById(t),i=e.querySelector(".section-arrow");!n||!i||(e.onclick=s=>{if(s.target.closest("button"))return;const r=!n.classList.toggle(B.CLASSES.HIDDEN);i.classList.toggle("rotate-0",r),i.classList.toggle("-rotate-90",!r),e.setAttribute("aria-expanded",r),localStorage.setItem(Hr(t),r)})})}function pm(){const e=document.getElementById("sidebar-sections-wrapper");if(!e)return;let t=null;e.querySelectorAll(".sidebar-section-container").forEach(i=>{i.addEventListener("dragstart",s=>{t=i,s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",i.dataset.sectionKey),i.classList.add("opacity-50","bg-gray-100","dark:bg-gray-800")}),i.addEventListener("dragend",s=>{i.classList.remove("opacity-50","bg-gray-100","dark:bg-gray-800"),e.querySelectorAll(".sidebar-section-container").forEach(o=>{o.classList.remove("border-t-2","border-blue-500")})}),i.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t!==i&&i.classList.add("border-t-2","border-blue-500")}),i.addEventListener("dragleave",s=>{i.classList.remove("border-t-2","border-blue-500")}),i.addEventListener("drop",s=>(s.stopPropagation(),s.preventDefault(),t!==i&&(e.insertBefore(t,i),mm(e)),!1))})}function mm(e){const t=e.querySelectorAll(".sidebar-section-container"),n=Array.from(t).map(i=>i.dataset.sectionKey);localStorage.setItem(B.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(n))}function vi(e,t,n=null){if(!e)return;let i=0;const s=B.CLASSES.DRAG_OVER;e.addEventListener("dragenter",o=>{o.preventDefault(),i++,e.classList.add(...s)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.contains("ring-2")||e.classList.add(...s)}),e.addEventListener("dragleave",o=>{o.preventDefault(),i--,i<=0&&(e.classList.remove(...s),i=0)}),e.addEventListener("drop",async o=>{o.preventDefault(),i=0,e.classList.remove(...s);const r=o.dataTransfer.getData("text/plain");r&&await bm(r,t,n)})}async function bm(e,t,n){const i={},{DURATION_LIMITS:s}=B;switch(t){case"inbox":i.projectId=null;break;case"project":n&&(i.projectId=n);break;case"timeblock":i.timeBlockId=n==="unassigned"||!n?null:n;break;case"duration":{const o=parseInt(n,10);if(!isNaN(o)&&o>=s.MIN&&o<=s.MAX)i.duration=o;else{P({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),P({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await ei(e,i)}catch(o){console.error(`[Drop Error] Type: ${t}, Task: ${e}`,o),P({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const Wa=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),Ya=["00","15","30","45"];function ym(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] relative animate-fade-in-up">
            <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition duration-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-8 overflow-y-auto flex-1 space-y-4 custom-scrollbar relative" id="tb-scroll-container">
                <div id="tb-list" class="space-y-2"></div> <!-- space-y-2 for tighter spacing -->
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed group">
                </button>

                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs opacity-80">デフォルトのゾーン</span>
                </div>
            </div>

            <div class="px-8 py-5 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none">完了</button>
            </div>

            <!-- Global Color Picker Popover (Hidden by default) -->
            <div id="tb-color-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 p-4 w-64 animate-fade-in-up">
                <div class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">プリセット</div>
                <div class="grid grid-cols-5 gap-3 mb-5" id="tb-color-presets">
                    <!-- Presets injected by JS -->
                </div>
                <div class="flex justify-between items-end mb-3">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">カスタム</div>
                    <button id="tb-custom-color-edit-btn" class="text-xs text-blue-500 hover:text-blue-600 font-medium transition-colors">編集</button>
                    <input type="color" id="tb-custom-color-input" class="invisible w-0 h-0 absolute">
                </div>
                <div class="grid grid-cols-5 gap-3" id="tb-color-customs">
                    <!-- Custom slots injected by JS -->
                </div>
            </div>
        </div>
    `}function Ui(e,t,n){const i=e.map(s=>`<div class="tb-select-option px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer text-sm transition-colors ${s===t?"bg-blue-50 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}" data-value="${s}">${s}</div>`).join("");return`
        <div class="relative tb-custom-select group min-w-[64px]" data-type="${n}" data-value="${t}">
            <button type="button" class="tb-select-trigger w-full py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-center shadow-sm hover:border-gray-300 dark:hover:border-gray-500 hover:shadow-md focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-400 transition-all flex items-center justify-center font-mono font-medium text-gray-700 dark:text-gray-200">
                <span class="value-display">${t}</span>
            </button>
            <div class="hidden tb-select-options absolute top-full left-0 mt-2 w-full min-w-[70px] max-h-56 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-xl z-20 custom-scrollbar animate-fade-in-down origin-top-left">
                ${i}
            </div>
        </div>
    `}function vm(e){const[t,n]=e.start.split(":"),[i,s]=e.end.split(":");return`
        <div class="flex-shrink-0 relative pl-2 cursor-grab active:cursor-grabbing handle p-1 rounded-md text-gray-400 hover:text-gray-600" title="移動">
             <div class="tb-color-trigger w-6 h-6 rounded-full shadow-sm hover:scale-110 active:scale-95 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900 cursor-pointer" 
                style="background-color: ${e.color}" data-color="${e.color}" title="色を変更"></div>
        </div>
        
        <div class="flex-1 flex items-center gap-4 px-2 handle cursor-grab active:cursor-grabbing">
            <div class="flex items-center gap-2">
                ${Ui(Wa,t,"start-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ui(Ya,n,"start-m")}
            </div>
            
            <div class="w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
            
            <div class="flex items-center gap-2">
                ${Ui(Wa,i,"end-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ui(Ya,s,"end-m")}
            </div>
        </div>

        <div class="flex items-center pr-2">
            <button class="delete-btn p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const $s=5,qa={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${$s}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${$s}個)</span>`};function Ga(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return t*60+n}function Hs(e,t){if(!e)return;const n=t>=$s;e.disabled=n,e.innerHTML=n?qa.LIMIT:qa.ADD}const xm=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6"],Cd="timeblock_custom_colors";let gs=null,nn=-1;function Xa(){try{const e=localStorage.getItem(Cd);return e?JSON.parse(e):["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}catch{return["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}}function _m(e){localStorage.setItem(Cd,JSON.stringify(e))}function wm(e){const t=document.getElementById("tb-color-picker"),n=document.getElementById("tb-color-presets"),i=document.getElementById("tb-color-customs"),s=document.getElementById("tb-custom-color-input"),o=document.getElementById("tb-custom-color-edit-btn");if(!t||!n||!i)return;n.innerHTML=xm.map(a=>`
        <button class="w-8 h-8 rounded-full shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400"
            style="background-color: ${a}" data-color="${a}"></button>
    `).join("");const r=()=>{const a=Xa();i.innerHTML=a.map((l,c)=>`
            <button class="custom-color-slot w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 relative overflow-hidden"
                style="background-color: ${l}" data-index="${c}" data-color="${l}">
                <div class="absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"></div>
            </button>
        `).join("")};r(),t.addEventListener("click",a=>{const l=a.target.closest("button[data-color]");if(l&&!l.classList.contains("custom-color-slot")){const c=l.dataset.color;So(c,t)}else if(l&&l.classList.contains("custom-color-slot")){nn=parseInt(l.dataset.index),document.querySelectorAll(".custom-color-slot").forEach(d=>d.classList.remove("ring-offset-2","ring-2","ring-blue-500")),l.classList.add("ring-offset-2","ring-2","ring-blue-500");const c=l.dataset.color;c!=="#E5E7EB"&&So(c,t)}}),o.onclick=()=>{nn===-1&&(nn=0),s.click()},s.onchange=a=>{nn===-1&&(nn=0);const l=a.target.value,c=Xa();c[nn]=l,_m(c),r(),So(l,t)}}function So(e,t){gs&&(gs.style.backgroundColor=e,gs.dataset.color=e,t.classList.add("hidden"))}function km(e){var a;gs=e;const t=document.getElementById("tb-color-picker");if(!t)return;const n=e.getBoundingClientRect(),i=(a=document.getElementById("tb-scroll-container"))==null?void 0:a.parentElement;if(!i)return;const s=i.getBoundingClientRect();let o=n.bottom-s.top+10,r=n.left-s.left;r+280>s.width&&(r=s.width-290),t.style.top=`${o}px`,t.style.left=`${r}px`,t.classList.remove("hidden")}function Sm(){const e=document.getElementById("tb-color-picker");e&&e.classList.add("hidden")}function Em(e,t){const n=e.querySelector('.tb-custom-select[data-type="start-h"]').dataset.value,i=e.querySelector('.tb-custom-select[data-type="start-m"]').dataset.value,s=e.querySelector('.tb-custom-select[data-type="end-h"]').dataset.value,o=e.querySelector('.tb-custom-select[data-type="end-m"]').dataset.value,r=e.querySelector(".tb-color-trigger").dataset.color;return{id:e.dataset.id||null,start:`${n}:${i}`,end:`${s}:${o}`,color:r,order:t}}function Im(e){const t=e.dataset.id;if(!t){e.remove(),Hs(document.getElementById("add-tb-btn"),he().length);return}e.style.opacity="0",e.style.transform="translateX(-20px)",setTimeout(()=>{P({message:`削除しますか？
（完了ボタンを押さなくても、削除は即時反映されます）`,type:"confirm",onConfirm:async()=>{try{await wp(t),e.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),Hs(document.getElementById("add-tb-btn"),he().length)}catch{P({message:"削除に失敗しました",type:"error"})}},onCancel:()=>{e.style.opacity="1",e.style.transform="translate(0)"}})},200)}async function Dm(e,t){const i=Array.from(document.querySelectorAll(".tb-row")).map((o,r)=>Em(o,r));for(const o of i){const r=Ga(o.start),a=Ga(o.end);if(r>=a)return P({message:`時間設定が不正です: ${o.start} - ${o.end}
(終了時間は開始時間より後にしてください)`,type:"error"})}e.disabled=!0;const s=e.textContent;e.textContent="保存中...";try{const o=i.map(r=>_p({id:r.id,name:`${r.start}-${r.end}`,start:r.start,end:r.end,color:r.color,order:r.order}));await Promise.all(o),document.dispatchEvent(new CustomEvent("timeblocks-updated")),t()}catch(o){console.error("Timeblock save error (suppressed):",o)}finally{e.disabled=!1,e.textContent=s}}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Ka(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Ka(Object(n),!0).forEach(function(i){Tm(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ka(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ps(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ps=function(t){return typeof t}:ps=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ps(e)}function Tm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fe(){return fe=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},fe.apply(this,arguments)}function Mm(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Cm(e,t){if(e==null)return{};var n=Mm(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var Am="1.15.6";function de(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var pe=de(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Pi=de(/Edge/i),Ja=de(/firefox/i),oi=de(/safari/i)&&!de(/chrome/i)&&!de(/android/i),jr=de(/iP(ad|od|hone)/i),Ad=de(/chrome/i)&&de(/android/i),Ld={capture:!1,passive:!1};function H(e,t,n){e.addEventListener(t,n,!pe&&Ld)}function F(e,t,n){e.removeEventListener(t,n,!pe&&Ld)}function js(e,t){if(t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function Od(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function Ht(e,t,n,i){if(e){n=n||document;do{if(t!=null&&(t[0]===">"?e.parentNode===n&&js(e,t):js(e,t))||i&&e===n)return e;if(e===n)break}while(e=Od(e))}return null}var Za=/\s+/g;function Ct(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(Za," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(Za," ")}}function M(e,t,n){var i=e&&e.style;if(i){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=n+(typeof n=="string"?"":"px")}}function pn(e,t){var n="";if(typeof e=="string")n=e;else do{var i=M(e,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(n)}function Pd(e,t,n){if(e){var i=e.getElementsByTagName(t),s=0,o=i.length;if(n)for(;s<o;s++)n(i[s],s);return i}return[]}function Gt(){var e=document.scrollingElement;return e||document.documentElement}function ct(e,t,n,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var o,r,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==Gt()?(o=e.getBoundingClientRect(),r=o.top,a=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(r=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(s=s||e.parentNode,!pe))do if(s&&s.getBoundingClientRect&&(M(s,"transform")!=="none"||n&&M(s,"position")!=="static")){var h=s.getBoundingClientRect();r-=h.top+parseInt(M(s,"border-top-width")),a-=h.left+parseInt(M(s,"border-left-width")),l=r+o.height,c=a+o.width;break}while(s=s.parentNode);if(i&&e!==window){var f=pn(s||e),g=f&&f.a,p=f&&f.d;f&&(r/=p,a/=g,u/=g,d/=p,l=r+d,c=a+u)}return{top:r,left:a,bottom:l,right:c,width:u,height:d}}}function Qa(e,t,n){for(var i=we(e,!0),s=ct(e)[t];i;){var o=ct(i)[n],r=void 0;if(r=s>=o,!r)return i;if(i===Gt())break;i=we(i,!1)}return!1}function vn(e,t,n,i){for(var s=0,o=0,r=e.children;o<r.length;){if(r[o].style.display!=="none"&&r[o]!==C.ghost&&(i||r[o]!==C.dragged)&&Ht(r[o],n.draggable,e,!1)){if(s===t)return r[o];s++}o++}return null}function zr(e,t){for(var n=e.lastElementChild;n&&(n===C.ghost||M(n,"display")==="none"||t&&!js(n,t));)n=n.previousElementSibling;return n||null}function Rt(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==C.clone&&(!t||js(e,t))&&n++;return n}function tl(e){var t=0,n=0,i=Gt();if(e)do{var s=pn(e),o=s.a,r=s.d;t+=e.scrollLeft*o,n+=e.scrollTop*r}while(e!==i&&(e=e.parentNode));return[t,n]}function Lm(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n)}return-1}function we(e,t){if(!e||!e.getBoundingClientRect)return Gt();var n=e,i=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var s=M(n);if(n.clientWidth<n.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Gt();if(i||t)return n;i=!0}}while(n=n.parentNode);return Gt()}function Om(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function Eo(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var ri;function Rd(e,t){return function(){if(!ri){var n=arguments,i=this;n.length===1?e.call(i,n[0]):e.apply(i,n),ri=setTimeout(function(){ri=void 0},t)}}}function Pm(){clearTimeout(ri),ri=void 0}function Bd(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function Nd(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function Fd(e,t,n){var i={};return Array.from(e.children).forEach(function(s){var o,r,a,l;if(!(!Ht(s,t.draggable,e,!1)||s.animated||s===n)){var c=ct(s);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,c.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,c.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,c.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Dt="Sortable"+new Date().getTime();function Rm(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(M(s,"display")==="none"||s===C.ghost)){e.push({target:s,rect:ct(s)});var o=Jt({},e[e.length-1].rect);if(s.thisAnimationDuration){var r=pn(s,!0);r&&(o.top-=r.f,o.left-=r.e)}s.fromRect=o}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(Lm(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var o=!1,r=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,u=ct(c),h=c.prevFromRect,f=c.prevToRect,g=a.rect,p=pn(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&Eo(h,u)&&!Eo(d,u)&&(g.top-u.top)/(g.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(l=Nm(g,h,f,s.options)),Eo(u,d)||(c.prevFromRect=d,c.prevToRect=u,l||(l=s.options.animation),s.animate(c,g,u,l)),l&&(o=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),o?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),e=[]},animate:function(i,s,o,r){if(r){M(i,"transition",""),M(i,"transform","");var a=pn(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-o.left)/(l||1),u=(s.top-o.top)/(c||1);i.animatingX=!!d,i.animatingY=!!u,M(i,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=Bm(i),M(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),M(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){M(i,"transition",""),M(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Bm(e){return e.offsetWidth}function Nm(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}var sn=[],Io={initializeByDefault:!0},Ri={mount:function(t){for(var n in Io)Io.hasOwnProperty(n)&&!(n in t)&&(t[n]=Io[n]);sn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),sn.push(t)},pluginEvent:function(t,n,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";sn.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][o]&&n[r.pluginName][o](Jt({sortable:n},i)),n.options[r.pluginName]&&n[r.pluginName][t]&&n[r.pluginName][t](Jt({sortable:n},i)))})},initializePlugins:function(t,n,i,s){sn.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,n,t.options);c.sortable=t,c.options=t.options,t[l]=c,fe(i,c.defaults)}});for(var o in t.options)if(t.options.hasOwnProperty(o)){var r=this.modifyOption(t,o,t.options[o]);typeof r<"u"&&(t.options[o]=r)}},getEventProperties:function(t,n){var i={};return sn.forEach(function(s){typeof s.eventProperties=="function"&&fe(i,s.eventProperties.call(n[s.pluginName],t))}),i},modifyOption:function(t,n,i){var s;return sn.forEach(function(o){t[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[n]=="function"&&(s=o.optionListeners[n].call(t[o.pluginName],i))}),s}};function Fm(e){var t=e.sortable,n=e.rootEl,i=e.name,s=e.targetEl,o=e.cloneEl,r=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,f=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[Dt],!!t){var p,m=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!pe&&!Pi?p=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(i,!0,!0)),p.to=r||n,p.from=a||n,p.item=s||n,p.clone=o,p.oldIndex=l,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=f?f.lastPutMode:void 0;var y=Jt(Jt({},g),Ri.getEventProperties(i,t));for(var x in y)p[x]=y[x];n&&n.dispatchEvent(p),m[b]&&m[b].call(t,p)}}var $m=["evt"],St=function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,o=Cm(i,$m);Ri.pluginEvent.bind(C)(t,n,Jt({dragEl:E,parentEl:st,ghostEl:L,rootEl:tt,nextEl:Ue,lastDownEl:ms,cloneEl:it,cloneHidden:ve,dragStarted:jn,putSortable:mt,activeSortable:C.active,originalEvent:s,oldIndex:dn,oldDraggableIndex:ai,newIndex:At,newDraggableIndex:ye,hideGhostForTarget:zd,unhideGhostForTarget:Ud,cloneNowHidden:function(){ve=!0},cloneNowShown:function(){ve=!1},dispatchSortableEvent:function(a){kt({sortable:n,name:a,originalEvent:s})}},o))};function kt(e){Fm(Jt({putSortable:mt,cloneEl:it,targetEl:E,rootEl:tt,oldIndex:dn,oldDraggableIndex:ai,newIndex:At,newDraggableIndex:ye},e))}var E,st,L,tt,Ue,ms,it,ve,dn,At,ai,ye,Vi,mt,cn=!1,zs=!1,Us=[],Ne,$t,Do,To,el,nl,jn,on,li,ci=!1,Wi=!1,bs,yt,Mo=[],or=!1,Vs=[],so=typeof document<"u",Yi=jr,il=Pi||pe?"cssFloat":"float",Hm=so&&!Ad&&!jr&&"draggable"in document.createElement("div"),$d=(function(){if(so){if(pe)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),Hd=function(t,n){var i=M(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=vn(t,0,n),r=vn(t,1,n),a=o&&M(o),l=r&&M(r),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ct(o).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ct(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[il]==="none"||r&&i[il]==="none"&&c+d>s)?"vertical":"horizontal"},jm=function(t,n,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,r=i?t.width:t.height,a=i?n.left:n.top,l=i?n.right:n.bottom,c=i?n.width:n.height;return s===a||o===l||s+r/2===a+c/2},zm=function(t,n){var i;return Us.some(function(s){var o=s[Dt].options.emptyInsertThreshold;if(!(!o||zr(s))){var r=ct(s),a=t>=r.left-o&&t<=r.right+o,l=n>=r.top-o&&n<=r.bottom+o;if(a&&l)return i=s}}),i},jd=function(t){function n(o,r){return function(a,l,c,d){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(o==null&&(r||u))return!0;if(o==null||o===!1)return!1;if(r&&o==="clone")return o;if(typeof o=="function")return n(o(a,l,c,d),r)(a,l,c,d);var h=(r?a:l).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var i={},s=t.group;(!s||ps(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=n(s.pull,!0),i.checkPut=n(s.put),i.revertClone=s.revertClone,t.group=i},zd=function(){!$d&&L&&M(L,"display","none")},Ud=function(){!$d&&L&&M(L,"display","")};so&&!Ad&&document.addEventListener("click",function(e){if(zs)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),zs=!1,!1},!0);var Fe=function(t){if(E){t=t.touches?t.touches[0]:t;var n=zm(t.clientX,t.clientY);if(n){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=n,i.preventDefault=void 0,i.stopPropagation=void 0,n[Dt]._onDragOver(i)}}},Um=function(t){E&&E.parentNode[Dt]._isOutsideThisEl(t.target)};function C(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=fe({},t),e[Dt]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Hd(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,a){r.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:C.supportPointer!==!1&&"PointerEvent"in window&&(!oi||jr),emptyInsertThreshold:5};Ri.initializePlugins(this,e,n);for(var i in n)!(i in t)&&(t[i]=n[i]);jd(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:Hm,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?H(e,"pointerdown",this._onTapStart):(H(e,"mousedown",this._onTapStart),H(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(H(e,"dragover",this),H(e,"dragenter",this)),Us.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),fe(this,Rm())}C.prototype={constructor:C,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(on=null)},_getDirection:function(t,n){return typeof this.options.direction=="function"?this.options.direction.call(this,t,n,E):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n=this,i=this.el,s=this.options,o=s.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(Jm(i),!E&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&oi&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=Ht(l,s.draggable,i,!1),!(l&&l.animated)&&ms!==l)){if(dn=Rt(l),ai=Rt(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){kt({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),St("filter",n,{evt:t}),o&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=Ht(c,u.trim(),i,!1),u)return kt({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),St("filter",n,{evt:t}),!0}),d)){o&&t.preventDefault();return}s.handle&&!Ht(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,n,i){var s=this,o=s.el,r=s.options,a=o.ownerDocument,l;if(i&&!E&&i.parentNode===o){var c=ct(i);if(tt=o,E=i,st=E.parentNode,Ue=E.nextSibling,ms=i,Vi=r.group,C.dragged=E,Ne={target:E,clientX:(n||t).clientX,clientY:(n||t).clientY},el=Ne.clientX-c.left,nl=Ne.clientY-c.top,this._lastX=(n||t).clientX,this._lastY=(n||t).clientY,E.style["will-change"]="all",l=function(){if(St("delayEnded",s,{evt:t}),C.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!Ja&&s.nativeDraggable&&(E.draggable=!0),s._triggerDragStart(t,n),kt({sortable:s,name:"choose",originalEvent:t}),Ct(E,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){Pd(E,d.trim(),Co)}),H(a,"dragover",Fe),H(a,"mousemove",Fe),H(a,"touchmove",Fe),r.supportPointer?(H(a,"pointerup",s._onDrop),!this.nativeDraggable&&H(a,"pointercancel",s._onDrop)):(H(a,"mouseup",s._onDrop),H(a,"touchend",s._onDrop),H(a,"touchcancel",s._onDrop)),Ja&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),St("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Pi||pe))){if(C.eventCanceled){this._onDrop();return}r.supportPointer?(H(a,"pointerup",s._disableDelayedDrag),H(a,"pointercancel",s._disableDelayedDrag)):(H(a,"mouseup",s._disableDelayedDrag),H(a,"touchend",s._disableDelayedDrag),H(a,"touchcancel",s._disableDelayedDrag)),H(a,"mousemove",s._delayedDragTouchMoveHandler),H(a,"touchmove",s._delayedDragTouchMoveHandler),r.supportPointer&&H(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&Co(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._disableDelayedDrag),F(t,"touchend",this._disableDelayedDrag),F(t,"touchcancel",this._disableDelayedDrag),F(t,"pointerup",this._disableDelayedDrag),F(t,"pointercancel",this._disableDelayedDrag),F(t,"mousemove",this._delayedDragTouchMoveHandler),F(t,"touchmove",this._delayedDragTouchMoveHandler),F(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||t.pointerType=="touch"&&t,!this.nativeDraggable||n?this.options.supportPointer?H(document,"pointermove",this._onTouchMove):n?H(document,"touchmove",this._onTouchMove):H(document,"mousemove",this._onTouchMove):(H(E,"dragend",this),H(tt,"dragstart",this._onDragStart));try{document.selection?ys(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,n){if(cn=!1,tt&&E){St("dragStarted",this,{evt:n}),this.nativeDraggable&&H(document,"dragover",Um);var i=this.options;!t&&Ct(E,i.dragClass,!1),Ct(E,i.ghostClass,!0),C.active=this,t&&this._appendGhost(),kt({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if($t){this._lastX=$t.clientX,this._lastY=$t.clientY,zd();for(var t=document.elementFromPoint($t.clientX,$t.clientY),n=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint($t.clientX,$t.clientY),t!==n);)n=t;if(E.parentNode[Dt]._isOutsideThisEl(t),n)do{if(n[Dt]){var i=void 0;if(i=n[Dt]._onDragOver({clientX:$t.clientX,clientY:$t.clientY,target:t,rootEl:n}),i&&!this.options.dragoverBubble)break}t=n}while(n=Od(n));Ud()}},_onTouchMove:function(t){if(Ne){var n=this.options,i=n.fallbackTolerance,s=n.fallbackOffset,o=t.touches?t.touches[0]:t,r=L&&pn(L,!0),a=L&&r&&r.a,l=L&&r&&r.d,c=Yi&&yt&&tl(yt),d=(o.clientX-Ne.clientX+s.x)/(a||1)+(c?c[0]-Mo[0]:0)/(a||1),u=(o.clientY-Ne.clientY+s.y)/(l||1)+(c?c[1]-Mo[1]:0)/(l||1);if(!C.active&&!cn){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(L){r?(r.e+=d-(Do||0),r.f+=u-(To||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");M(L,"webkitTransform",h),M(L,"mozTransform",h),M(L,"msTransform",h),M(L,"transform",h),Do=d,To=u,$t=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!L){var t=this.options.fallbackOnBody?document.body:tt,n=ct(E,!0,Yi,!0,t),i=this.options;if(Yi){for(yt=t;M(yt,"position")==="static"&&M(yt,"transform")==="none"&&yt!==document;)yt=yt.parentNode;yt!==document.body&&yt!==document.documentElement?(yt===document&&(yt=Gt()),n.top+=yt.scrollTop,n.left+=yt.scrollLeft):yt=Gt(),Mo=tl(yt)}L=E.cloneNode(!0),Ct(L,i.ghostClass,!1),Ct(L,i.fallbackClass,!0),Ct(L,i.dragClass,!0),M(L,"transition",""),M(L,"transform",""),M(L,"box-sizing","border-box"),M(L,"margin",0),M(L,"top",n.top),M(L,"left",n.left),M(L,"width",n.width),M(L,"height",n.height),M(L,"opacity","0.8"),M(L,"position",Yi?"absolute":"fixed"),M(L,"zIndex","100000"),M(L,"pointerEvents","none"),C.ghost=L,t.appendChild(L),M(L,"transform-origin",el/parseInt(L.style.width)*100+"% "+nl/parseInt(L.style.height)*100+"%")}},_onDragStart:function(t,n){var i=this,s=t.dataTransfer,o=i.options;if(St("dragStart",this,{evt:t}),C.eventCanceled){this._onDrop();return}St("setupClone",this),C.eventCanceled||(it=Nd(E),it.removeAttribute("id"),it.draggable=!1,it.style["will-change"]="",this._hideClone(),Ct(it,this.options.chosenClass,!1),C.clone=it),i.cloneId=ys(function(){St("clone",i),!C.eventCanceled&&(i.options.removeCloneOnHide||tt.insertBefore(it,E),i._hideClone(),kt({sortable:i,name:"clone"}))}),!n&&Ct(E,o.dragClass,!0),n?(zs=!0,i._loopId=setInterval(i._emulateDragOver,50)):(F(document,"mouseup",i._onDrop),F(document,"touchend",i._onDrop),F(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,E)),H(document,"drop",i),M(E,"transform","translateZ(0)")),cn=!0,i._dragStartId=ys(i._dragStarted.bind(i,n,t)),H(document,"selectstart",i),jn=!0,window.getSelection().removeAllRanges(),oi&&M(document.body,"user-select","none")},_onDragOver:function(t){var n=this.el,i=t.target,s,o,r,a=this.options,l=a.group,c=C.active,d=Vi===l,u=a.sort,h=mt||c,f,g=this,p=!1;if(or)return;function m(pt,ut){St(pt,g,Jt({evt:t,isOwner:d,axis:f?"vertical":"horizontal",revert:r,dragRect:s,targetRect:o,canSort:u,fromSortable:h,target:i,completed:y,onMove:function(Pe,me){return qi(tt,n,E,s,Pe,ct(Pe),t,me)},changed:x},ut))}function b(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==h&&h.captureAnimationState()}function y(pt){return m("dragOverCompleted",{insertion:pt}),pt&&(d?c._hideClone():c._showClone(g),g!==h&&(Ct(E,mt?mt.options.ghostClass:c.options.ghostClass,!1),Ct(E,a.ghostClass,!0)),mt!==g&&g!==C.active?mt=g:g===C.active&&mt&&(mt=null),h===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===n&&!i.animated)&&(on=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(E.parentNode[Dt]._isOutsideThisEl(t.target),!pt&&Fe(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function x(){At=Rt(E),ye=Rt(E,a.draggable),kt({sortable:g,name:"change",toEl:n,newIndex:At,newDraggableIndex:ye,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=Ht(i,a.draggable,n,!0),m("dragOver"),C.eventCanceled)return p;if(E.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if(zs=!1,c&&!a.disabled&&(d?u||(r=st!==tt):mt===this||(this.lastPutMode=Vi.checkPull(this,c,E,t))&&l.checkPut(this,c,E,t))){if(f=this._getDirection(t,i)==="vertical",s=ct(E),m("dragOverValid"),C.eventCanceled)return p;if(r)return st=tt,b(),this._hideClone(),m("revert"),C.eventCanceled||(Ue?tt.insertBefore(E,Ue):tt.appendChild(E)),y(!0);var _=zr(n,a.draggable);if(!_||qm(t,f,this)&&!_.animated){if(_===E)return y(!1);if(_&&n===t.target&&(i=_),i&&(o=ct(i)),qi(tt,n,E,s,i,o,t,!!i)!==!1)return b(),_&&_.nextSibling?n.insertBefore(E,_.nextSibling):n.appendChild(E),st=n,x(),y(!0)}else if(_&&Ym(t,f,this)){var v=vn(n,0,a,!0);if(v===E)return y(!1);if(i=v,o=ct(i),qi(tt,n,E,s,i,o,t,!1)!==!1)return b(),n.insertBefore(E,v),st=n,x(),y(!0)}else if(i.parentNode===n){o=ct(i);var w=0,k,S=E.parentNode!==n,D=!jm(E.animated&&E.toRect||s,i.animated&&i.toRect||o,f),A=f?"top":"left",T=Qa(i,"top","top")||Qa(E,"top","top"),R=T?T.scrollTop:void 0;on!==i&&(k=o[A],ci=!1,Wi=!D&&a.invertSwap||S),w=Gm(t,i,o,f,D?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Wi,on===i);var G;if(w!==0){var rt=Rt(E);do rt-=w,G=st.children[rt];while(G&&(M(G,"display")==="none"||G===L))}if(w===0||G===i)return y(!1);on=i,li=w;var j=i.nextElementSibling,z=!1;z=w===1;var J=qi(tt,n,E,s,i,o,t,z);if(J!==!1)return(J===1||J===-1)&&(z=J===1),or=!0,setTimeout(Wm,30),b(),z&&!j?n.appendChild(E):i.parentNode.insertBefore(E,z?j:i),T&&Bd(T,0,R-T.scrollTop),st=E.parentNode,k!==void 0&&!Wi&&(bs=Math.abs(k-ct(i)[A])),x(),y(!0)}if(n.contains(E))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",Fe),F(document,"mousemove",Fe),F(document,"touchmove",Fe)},_offUpEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._onDrop),F(t,"touchend",this._onDrop),F(t,"pointerup",this._onDrop),F(t,"pointercancel",this._onDrop),F(t,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(t){var n=this.el,i=this.options;if(At=Rt(E),ye=Rt(E,i.draggable),St("drop",this,{evt:t}),st=E&&E.parentNode,At=Rt(E),ye=Rt(E,i.draggable),C.eventCanceled){this._nulling();return}cn=!1,Wi=!1,ci=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),rr(this.cloneId),rr(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),oi&&M(document.body,"user-select",""),M(E,"transform",""),t&&(jn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),L&&L.parentNode&&L.parentNode.removeChild(L),(tt===st||mt&&mt.lastPutMode!=="clone")&&it&&it.parentNode&&it.parentNode.removeChild(it),E&&(this.nativeDraggable&&F(E,"dragend",this),Co(E),E.style["will-change"]="",jn&&!cn&&Ct(E,mt?mt.options.ghostClass:this.options.ghostClass,!1),Ct(E,this.options.chosenClass,!1),kt({sortable:this,name:"unchoose",toEl:st,newIndex:null,newDraggableIndex:null,originalEvent:t}),tt!==st?(At>=0&&(kt({rootEl:st,name:"add",toEl:st,fromEl:tt,originalEvent:t}),kt({sortable:this,name:"remove",toEl:st,originalEvent:t}),kt({rootEl:st,name:"sort",toEl:st,fromEl:tt,originalEvent:t}),kt({sortable:this,name:"sort",toEl:st,originalEvent:t})),mt&&mt.save()):At!==dn&&At>=0&&(kt({sortable:this,name:"update",toEl:st,originalEvent:t}),kt({sortable:this,name:"sort",toEl:st,originalEvent:t})),C.active&&((At==null||At===-1)&&(At=dn,ye=ai),kt({sortable:this,name:"end",toEl:st,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){St("nulling",this),tt=E=st=L=Ue=it=ms=ve=Ne=$t=jn=At=ye=dn=ai=on=li=mt=Vi=C.dragged=C.ghost=C.clone=C.active=null,Vs.forEach(function(t){t.checked=!0}),Vs.length=Do=To=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":E&&(this._onDragOver(t),Vm(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],n,i=this.el.children,s=0,o=i.length,r=this.options;s<o;s++)n=i[s],Ht(n,r.draggable,this.el,!1)&&t.push(n.getAttribute(r.dataIdAttr)||Km(n));return t},sort:function(t,n){var i={},s=this.el;this.toArray().forEach(function(o,r){var a=s.children[r];Ht(a,this.options.draggable,s,!1)&&(i[o]=a)},this),n&&this.captureAnimationState(),t.forEach(function(o){i[o]&&(s.removeChild(i[o]),s.appendChild(i[o]))}),n&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,n){return Ht(t,n||this.options.draggable,this.el,!1)},option:function(t,n){var i=this.options;if(n===void 0)return i[t];var s=Ri.modifyOption(this,t,n);typeof s<"u"?i[t]=s:i[t]=n,t==="group"&&jd(i)},destroy:function(){St("destroy",this);var t=this.el;t[Dt]=null,F(t,"mousedown",this._onTapStart),F(t,"touchstart",this._onTapStart),F(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(t,"dragover",this),F(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Us.splice(Us.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!ve){if(St("hideClone",this),C.eventCanceled)return;M(it,"display","none"),this.options.removeCloneOnHide&&it.parentNode&&it.parentNode.removeChild(it),ve=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(ve){if(St("showClone",this),C.eventCanceled)return;E.parentNode==tt&&!this.options.group.revertClone?tt.insertBefore(it,E):Ue?tt.insertBefore(it,Ue):tt.appendChild(it),this.options.group.revertClone&&this.animate(E,it),M(it,"display",""),ve=!1}}};function Vm(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function qi(e,t,n,i,s,o,r,a){var l,c=e[Dt],d=c.options.onMove,u;return window.CustomEvent&&!pe&&!Pi?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=s||t,l.relatedRect=o||ct(t),l.willInsertAfter=a,l.originalEvent=r,e.dispatchEvent(l),d&&(u=d.call(c,l,r)),u}function Co(e){e.draggable=!1}function Wm(){or=!1}function Ym(e,t,n){var i=ct(vn(n.el,0,n.options,!0)),s=Fd(n.el,n.options,L),o=10;return t?e.clientX<s.left-o||e.clientY<i.top&&e.clientX<i.right:e.clientY<s.top-o||e.clientY<i.bottom&&e.clientX<i.left}function qm(e,t,n){var i=ct(zr(n.el,n.options.draggable)),s=Fd(n.el,n.options,L),o=10;return t?e.clientX>s.right+o||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>s.bottom+o||e.clientX>i.right&&e.clientY>i.top}function Gm(e,t,n,i,s,o,r,a){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,h=!1;if(!r){if(a&&bs<c*s){if(!ci&&(li===1?l>d+c*o/2:l<u-c*o/2)&&(ci=!0),ci)h=!0;else if(li===1?l<d+bs:l>u-bs)return-li}else if(l>d+c*(1-s)/2&&l<u-c*(1-s)/2)return Xm(t)}return h=h||r,h&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}function Xm(e){return Rt(E)<Rt(e)?1:-1}function Km(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function Jm(e){Vs.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&Vs.push(i)}}function ys(e){return setTimeout(e,0)}function rr(e){return clearTimeout(e)}so&&H(document,"touchmove",function(e){(C.active||cn)&&e.cancelable&&e.preventDefault()});C.utils={on:H,off:F,css:M,find:Pd,is:function(t,n){return!!Ht(t,n,t,!1)},extend:Om,throttle:Rd,closest:Ht,toggleClass:Ct,clone:Nd,index:Rt,nextTick:ys,cancelNextTick:rr,detectDirection:Hd,getChild:vn,expando:Dt};C.get=function(e){return e[Dt]};C.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(C.utils=Jt(Jt({},C.utils),i.utils)),Ri.mount(i)})};C.create=function(e,t){return new C(e,t)};C.version=Am;var lt=[],zn,ar,lr=!1,Ao,Lo,Ws,Un;function Zm(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(n){var i=n.originalEvent;this.sortable.nativeDraggable?H(document,"dragover",this._handleAutoScroll):this.options.supportPointer?H(document,"pointermove",this._handleFallbackAutoScroll):i.touches?H(document,"touchmove",this._handleFallbackAutoScroll):H(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var i=n.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),sl(),vs(),Pm()},nulling:function(){Ws=ar=zn=lr=Un=Ao=Lo=null,lt.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,i){var s=this,o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(o,r);if(Ws=n,i||this.options.forceAutoScrollFallback||Pi||pe||oi){Oo(n,this.options,a,i);var l=we(a,!0);lr&&(!Un||o!==Ao||r!==Lo)&&(Un&&sl(),Un=setInterval(function(){var c=we(document.elementFromPoint(o,r),!0);c!==l&&(l=c,vs()),Oo(n,s.options,c,i)},10),Ao=o,Lo=r)}else{if(!this.options.bubbleScroll||we(a,!0)===Gt()){vs();return}Oo(n,this.options,we(a,!1),!1)}}},fe(e,{pluginName:"scroll",initializeByDefault:!0})}function vs(){lt.forEach(function(e){clearInterval(e.pid)}),lt=[]}function sl(){clearInterval(Un)}var Oo=Rd(function(e,t,n,i){if(t.scroll){var s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,a=t.scrollSpeed,l=Gt(),c=!1,d;ar!==n&&(ar=n,vs(),zn=t.scroll,d=t.scrollFn,zn===!0&&(zn=we(n,!0)));var u=0,h=zn;do{var f=h,g=ct(f),p=g.top,m=g.bottom,b=g.left,y=g.right,x=g.width,_=g.height,v=void 0,w=void 0,k=f.scrollWidth,S=f.scrollHeight,D=M(f),A=f.scrollLeft,T=f.scrollTop;f===l?(v=x<k&&(D.overflowX==="auto"||D.overflowX==="scroll"||D.overflowX==="visible"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"||D.overflowY==="visible")):(v=x<k&&(D.overflowX==="auto"||D.overflowX==="scroll"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"));var R=v&&(Math.abs(y-s)<=r&&A+x<k)-(Math.abs(b-s)<=r&&!!A),G=w&&(Math.abs(m-o)<=r&&T+_<S)-(Math.abs(p-o)<=r&&!!T);if(!lt[u])for(var rt=0;rt<=u;rt++)lt[rt]||(lt[rt]={});(lt[u].vx!=R||lt[u].vy!=G||lt[u].el!==f)&&(lt[u].el=f,lt[u].vx=R,lt[u].vy=G,clearInterval(lt[u].pid),(R!=0||G!=0)&&(c=!0,lt[u].pid=setInterval((function(){i&&this.layer===0&&C.active._onTouchMove(Ws);var j=lt[this.layer].vy?lt[this.layer].vy*a:0,z=lt[this.layer].vx?lt[this.layer].vx*a:0;typeof d=="function"&&d.call(C.dragged.parentNode[Dt],z,j,e,Ws,lt[this.layer].el)!=="continue"||Bd(lt[this.layer].el,z,j)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==l&&(h=we(h,!1)));lr=c}},30),Vd=function(t){var n=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(n){var c=i||o;a();var d=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Ur(){}Ur.prototype={startIndex:null,dragStart:function(t){var n=t.oldDraggableIndex;this.startIndex=n},onSpill:function(t){var n=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=vn(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(n,s):this.sortable.el.appendChild(n),this.sortable.animateAll(),i&&i.animateAll()},drop:Vd};fe(Ur,{pluginName:"revertOnSpill"});function Vr(){}Vr.prototype={onSpill:function(t){var n=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),s.animateAll()},drop:Vd};fe(Vr,{pluginName:"removeOnSpill"});C.mount(new Zm);C.mount(Vr,Ur);const Qm={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function Wd(e=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",n.innerHTML=ym(),document.body.appendChild(n),tb(e),wm(),eb(n)}function tb(e){const t=document.getElementById("tb-list"),n=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=he(),s=document.createDocumentFragment();i.forEach(o=>s.appendChild(Yd(o))),t.appendChild(s),Hs(n,i.length),new C(t,{animation:150,handle:".handle",ghostClass:"bg-blue-50",onEnd:function(o){}}),e!=null&&e.id&&requestAnimationFrame(()=>{const o=t.querySelector(`.tb-row[data-id="${e.id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("bg-blue-50","dark:bg-blue-900/20"))})}function Yd(e=null){const t=e||{...Qm},n=document.createElement("div");n.className="tb-row flex items-center gap-4 py-2 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg select-none",t.id&&(n.dataset.id=t.id),n.innerHTML=vm(t);const i=n.querySelector(".delete-btn");return i.onclick=()=>Im(n),n}function eb(e){const t=e.querySelector("#add-tb-btn"),n=e.querySelector("#close-tb-modal"),i=e.querySelector("#close-tb-footer"),s=()=>{e.remove(),document.removeEventListener("keydown",o),document.removeEventListener("click",handleOutsideClick),window.tbHandleOutsideClick&&(window.tbHandleOutsideClick=null)},o=r=>{r.key==="Escape"&&s()};n.onclick=s,i.onclick=async()=>await Dm(i,s),e.onclick=r=>{r.target===e&&s()},document.addEventListener("keydown",o),t.onclick=()=>{const r=document.getElementById("tb-list"),a=r.querySelectorAll(".tb-row").length;if(a<$s){const l=Yd();r.appendChild(l),Hs(t,a+1),l.scrollIntoView({behavior:"smooth"})}},nb(e)}function nb(e){let t=null;const n=i=>{t&&!t.contains(i.target)&&(t.querySelector(".tb-select-options").classList.add("hidden"),t=null);const s=document.getElementById("tb-color-picker"),o=i.target.closest(".tb-color-trigger"),r=s&&s.contains(i.target);!o&&!r&&s&&!s.classList.contains("hidden")&&Sm()};setTimeout(()=>document.addEventListener("click",n),0),e.addEventListener("click",i=>{const s=i.target.closest(".tb-select-trigger");if(s){const a=s.closest(".tb-custom-select"),l=a.querySelector(".tb-select-options");document.querySelectorAll(".tb-select-options").forEach(c=>{c!==l&&c.classList.add("hidden")}),l.classList.toggle("hidden"),t=l.classList.contains("hidden")?null:a,i.stopPropagation();return}const o=i.target.closest(".tb-select-option");if(o){const a=o.closest(".tb-custom-select"),l=o.dataset.value;a.dataset.value=l,a.querySelector(".value-display").textContent=l,a.querySelectorAll(".tb-select-option").forEach(c=>{c.dataset.value===l?c.classList.add("bg-blue-50/50","font-bold"):c.classList.remove("bg-blue-50/50","font-bold")}),a.querySelector(".tb-select-options").classList.add("hidden"),t=null,i.stopPropagation();return}const r=i.target.closest(".tb-color-trigger");r&&(km(r),i.stopPropagation())})}function ib(e){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",n=>{n.stopPropagation(),kd()})}function sb(e,t=[]){const n=document.getElementById("project-list");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}e.forEach(i=>{const s=t.filter(r=>r.projectId===i.id&&!r.completed).length,o=yi(i.name,"project",i.id,i.color,s);o.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},o.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation(),$r(r,"project",i)},vi(o,"project",i.id),n.appendChild(o)})}}function ob(e,t){let n=Ys(e,t);return rb(n,t.sortCriteria)}function Ys(e,t){const{keyword:n,projectId:i,labelId:s,showCompleted:o,timeBlockId:r,duration:a}=t;return e.filter(l=>{if(!o&&l.status==="completed"||i&&l.projectId!==i||s&&(!l.labelIds||!l.labelIds.includes(s)))return!1;if(r){if(r==="unassigned"){if(l.timeBlockId&&l.timeBlockId!=="null")return!1}else if(String(l.timeBlockId)!==String(r))return!1}if(a&&Number(l.duration)!==Number(a))return!1;if(n){const c=n.toLowerCase(),d=l.title.toLowerCase().includes(c),u=(l.description||"").toLowerCase().includes(c);if(!d&&!u)return!1}return!0})}function rb(e,t="createdAt_desc"){return[...e].sort((n,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(n.createdAt||0);case"createdAt_asc":return(n.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return n.dueDate?i.dueDate?n.dueDate-i.dueDate:-1:1;case"project_asc":return(n.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function ab(){const e=document.getElementById("inbox-count");if(!e)return;const t=In(),n=As(t,i=>!i.projectId);e.textContent=n,e.classList.toggle("hidden",n===0)}function lb(){if(!document.getElementById(B.LIST_IDS.PROJECTS))return;const t=Fr(),n=In();sb(t,n)}function cb(){const e=document.getElementById(B.LIST_IDS.TIMEBLOCKS);if(!e)return;e.innerHTML="";const t=document.createDocumentFragment(),n=he().sort((a,l)=>(a.order||0)-(l.order||0)),i=In(),s=En();n.forEach(a=>{const l=As(i,u=>String(u.timeBlockId)===String(a.id)),c=`${a.start} - ${a.end}`,d=yi(c,"timeblock",a.id,{color:a.color},l,s);d.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:a.id}})),d.oncontextmenu=u=>{u.preventDefault(),Wd(a)},vi(d,"timeblock",a.id),t.appendChild(d)});const o=As(i,a=>!a.timeBlockId||a.timeBlockId==="null"),r=yi("未定","timeblock","unassigned",{color:"#a0aec0"},o,s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),vi(r,"timeblock","unassigned"),t.appendChild(r),e.appendChild(t)}function db(){const e=document.getElementById(B.LIST_IDS.DURATIONS);if(!e)return;e.innerHTML="";const t=In(),n=En(),i=document.createDocumentFragment(),s='<span class="mr-3 text-sm">⏱️</span>';B.DURATIONS.forEach(o=>{const r=As(t,l=>Number(l.duration)===o),a=yi(`${o} min`,"duration",o.toString(),{iconHtml:s},r,n);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:o.toString()}})),vi(a,"duration",o.toString()),i.appendChild(a)}),e.appendChild(i)}function ub(){const e=document.getElementById(B.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const t=md(),n=In(),i=En(),s=document.createDocumentFragment(),o='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';t.forEach(r=>{let a=0;try{typeof Ys=="function"&&(a=Ys(n,{savedFilter:r,showCompleted:!1}).length)}catch(c){console.warn("[Sidebar] Filter count error:",c)}const l=yi(r.name,"filter",r.id,{iconHtml:o},a,i);l.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),l.oncontextmenu=c=>{c.preventDefault(),$r(c,"filter",r)},s.appendChild(l)}),e.appendChild(s)}function hb(){lb(),cb(),db(),ub(),ab()}let un=null,Gi=null,Ot={};function ol(){Ot={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function fb(){if(ol(),!Ot.container)return;Ot.container.innerHTML=fm(),ol(),Nc(Ot.sidebar,Ot.resizer),pb(),gm(),pm(),gb(),Ot.inbox&&vi(Ot.inbox,"inbox"),ib(Ot.container),Gi&&window.removeEventListener("resize",Gi),Gi=()=>cr(),window.addEventListener("resize",Gi),cr();const e=En();Wr(e),mb(),un&&un()}function gb(){const e=["timeblocks-updated","projects-updated","labels-updated","filters-updated","tasks-updated"];un&&e.forEach(t=>document.removeEventListener(t,un)),un=()=>{hb();const t=En();Wr(t)},e.forEach(t=>document.addEventListener(t,un))}function pb(){var t,n;const e=(i,s=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:i,id:s}}));Ot.container.addEventListener("click",i=>{const s=i.target.closest("a"),o=i.target.closest("button");if(s){i.preventDefault();const r=s.id;r==="nav-dashboard"&&e("dashboard"),r==="nav-inbox"&&e("inbox"),r==="nav-search"&&e("search"),r==="nav-settings"&&io();return}if(o){const r=o.id;r==="add-filter-btn"&&wd(),r==="edit-timeblocks-btn"&&Wd()}}),(t=Ot.openBtn)==null||t.addEventListener("click",()=>rl(!0)),(n=Ot.closeBtn)==null||n.addEventListener("click",()=>rl(!1))}function Wr(e){const t=document.querySelectorAll(".sidebar-item-row"),n=Object.values(B.DENSITY_CLASSES),i=B.DENSITY_CLASSES[e]||B.DENSITY_CLASSES.normal;t.forEach(s=>{s.classList.remove(...n),s.classList.add(i)})}function rl(e){const{sidebar:t,resizer:n}=Ot,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(t){if(t.classList.toggle(i,!e),t.classList.toggle(s,!e),Mr())if(n&&n.classList.toggle(s,!e),e){const o=localStorage.getItem(B.STORAGE_KEYS.WIDTH)||B.DEFAULT_WIDTH;t.style.width=`${o}px`}else t.style.width="0";cr()}}function cr(){const{sidebar:e,openBtn:t,closeBtn:n}=Ot,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(!e||!t||!n)return;const o=e.classList.contains(i)||e.classList.contains(s);Mr()?(t.classList.toggle(s,!o),n.classList.toggle(s,o),o||e.classList.remove(s)):(t.classList.remove(s),n.classList.remove(s),e.classList.remove(s))}function mb(){window.addEventListener("sidebar-settings-updated",e=>{Wr(e.detail.density)})}const bb={FAVICON:"/images/favicon-96x96.png"},yb={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},Vn={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},Yr={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:ht,HEADER_IDS:al,DATA_ATTRS:vb}=Yr;function xs(e,t){Array.isArray(t)&&t.forEach(n=>{var i,s;(i=n==null?void 0:n.classList)==null||i.add(ht.HIDDEN),(s=n==null?void 0:n.classList)==null||s.remove(ht.FADE_IN)}),e!=null&&e.classList&&(e.classList.remove(ht.HIDDEN),e.classList.add(ht.FADE_IN))}function qd(){document.querySelectorAll(".sidebar-item-row").forEach(e=>{e.classList.remove(...Array.isArray(ht.HIGHLIGHT)?ht.HIGHLIGHT:[ht.HIGHLIGHT]),e.classList.add(...Array.isArray(ht.NORMAL)?ht.NORMAL:[ht.NORMAL]);const t=e.querySelector("svg, span:not(.truncate)");if(t){const n=Array.from(t.classList).filter(s=>s.startsWith("text-"));n.length>0&&t.classList.remove(...n);const i=e.getAttribute(vb.DEFAULT_COLOR);i&&t.classList.add(i)}})}function xb(e){qd();const t=_b(e);if(t!=null&&t.classList){t.classList.remove(...Array.isArray(ht.NORMAL)?ht.NORMAL:[ht.NORMAL]),t.classList.add(...Array.isArray(ht.HIGHLIGHT)?ht.HIGHLIGHT:[ht.HIGHLIGHT]);const n=t.querySelector("svg, span:not(.truncate)");if(n){const i=Array.from(n.classList).filter(s=>s.startsWith("text-"));i.length>0&&n.classList.remove(...i),n.classList.add("text-white")}}}function _b(e){if(!e)return null;const{type:t,id:n}=e;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?Vn.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${n}"]`)}function Gd(e,t=[],n=[]){var c;const i=document.getElementById(al.TITLE),s=document.getElementById(al.COUNT);if(!i)return;let o="インボックス";const{type:r,id:a,name:l}=e;if(l)o=l;else switch(r){case Vn.PROJECT:o=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case Vn.LABEL:const d=n.find(u=>u.id===a);o=d?`ラベル: ${d.name}`:"ラベル";break;case Vn.TIMEBLOCK:if(a==="unassigned")o="時間帯: 未定";else{const u=vd(a);o=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case Vn.DURATION:o=`所要時間: ${a}分`;break;case"search":o="タスク検索";break;case"dashboard":o="ダッシュボード";break}i.textContent=o,s&&["dashboard","search"].includes(r)&&(s.textContent="")}function wb(){const{VIEW_IDS:e}=Yr;Object.values(e).forEach(n=>{const i=document.getElementById(n);n!==e.TASK&&i&&i.classList.add(ht.HIDDEN)});const t=document.getElementById(e.TASK);t&&(t.classList.remove(ht.HIDDEN),t.innerHTML=`
        <div id="login-container-wrapper" class="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in">
            <div id="login-form-container" class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
                    <p class="text-gray-500 dark:text-gray-400">タスク管理をはじめよう</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">メールアドレス</label>
                        <input id="email-input" type="email" placeholder="name@example.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">パスワード</label>
                        <input id="password-input" type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                </div>
                
                <button id="email-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-0.5 mb-6">
                    ログイン
                </button>

                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">または</span>
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600 text-center">
                     <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">アカウント登録なしで試す</p>
                    <button id="guest-login-btn" class="w-full bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center gap-2">
                        <span>🚀</span> ゲストとして利用する
                    </button>
                    <p class="text-xs text-gray-400 mt-2">※ゲストデータはローカルに保存されます</p>
                </div>
            </div>
            
            <!-- ユーザー情報表示用（ロジック互換性のため残す、実際はヘッダー等で管理推奨） -->
            <div id="user-info" class="hidden">
                 <span id="user-email-display"></span>
            </div>
        </div>
    `)}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Bi(e){return e+.5|0}const ke=(e,t,n)=>Math.max(Math.min(e,n),t);function Wn(e){return ke(Bi(e*2.55),0,255)}function Me(e){return ke(Bi(e*255),0,255)}function ie(e){return ke(Bi(e/2.55)/100,0,1)}function ll(e){return ke(Bi(e*100),0,100)}const Pt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},dr=[..."0123456789ABCDEF"],kb=e=>dr[e&15],Sb=e=>dr[(e&240)>>4]+dr[e&15],Xi=e=>(e&240)>>4===(e&15),Eb=e=>Xi(e.r)&&Xi(e.g)&&Xi(e.b)&&Xi(e.a);function Ib(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Pt[e[1]]*17,g:255&Pt[e[2]]*17,b:255&Pt[e[3]]*17,a:t===5?Pt[e[4]]*17:255}:(t===7||t===9)&&(n={r:Pt[e[1]]<<4|Pt[e[2]],g:Pt[e[3]]<<4|Pt[e[4]],b:Pt[e[5]]<<4|Pt[e[6]],a:t===9?Pt[e[7]]<<4|Pt[e[8]]:255})),n}const Db=(e,t)=>e<255?t(e):"";function Tb(e){var t=Eb(e)?kb:Sb;return e?"#"+t(e.r)+t(e.g)+t(e.b)+Db(e.a,t):void 0}const Mb=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Xd(e,t,n){const i=t*Math.min(n,1-n),s=(o,r=(o+e/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[s(0),s(8),s(4)]}function Cb(e,t,n){const i=(s,o=(s+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function Ab(e,t,n){const i=Xd(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function Lb(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}function qr(e){const n=e.r/255,i=e.g/255,s=e.b/255,o=Math.max(n,i,s),r=Math.min(n,i,s),a=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=a>.5?d/(2-o-r):d/(o+r),l=Lb(n,i,s,d,o),l=l*60+.5),[l|0,c||0,a]}function Gr(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Me)}function Xr(e,t,n){return Gr(Xd,e,t,n)}function Ob(e,t,n){return Gr(Ab,e,t,n)}function Pb(e,t,n){return Gr(Cb,e,t,n)}function Kd(e){return(e%360+360)%360}function Rb(e){const t=Mb.exec(e);let n=255,i;if(!t)return;t[5]!==i&&(n=t[6]?Wn(+t[5]):Me(+t[5]));const s=Kd(+t[2]),o=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=Ob(s,o,r):t[1]==="hsv"?i=Pb(s,o,r):i=Xr(s,o,r),{r:i[0],g:i[1],b:i[2],a:n}}function Bb(e,t){var n=qr(e);n[0]=Kd(n[0]+t),n=Xr(n),e.r=n[0],e.g=n[1],e.b=n[2]}function Nb(e){if(!e)return;const t=qr(e),n=t[0],i=ll(t[1]),s=ll(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${s}%, ${ie(e.a)})`:`hsl(${n}, ${i}%, ${s}%)`}const cl={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},dl={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Fb(){const e={},t=Object.keys(dl),n=Object.keys(cl);let i,s,o,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],s=0;s<n.length;s++)o=n[s],a=a.replace(o,cl[o]);o=parseInt(dl[r],16),e[a]=[o>>16&255,o>>8&255,o&255]}return e}let Ki;function $b(e){Ki||(Ki=Fb(),Ki.transparent=[0,0,0,0]);const t=Ki[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Hb=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function jb(e){const t=Hb.exec(e);let n=255,i,s,o;if(t){if(t[7]!==i){const r=+t[7];n=t[8]?Wn(r):ke(r*255,0,255)}return i=+t[1],s=+t[3],o=+t[5],i=255&(t[2]?Wn(i):ke(i,0,255)),s=255&(t[4]?Wn(s):ke(s,0,255)),o=255&(t[6]?Wn(o):ke(o,0,255)),{r:i,g:s,b:o,a:n}}}function zb(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${ie(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const Po=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,rn=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Ub(e,t,n){const i=rn(ie(e.r)),s=rn(ie(e.g)),o=rn(ie(e.b));return{r:Me(Po(i+n*(rn(ie(t.r))-i))),g:Me(Po(s+n*(rn(ie(t.g))-s))),b:Me(Po(o+n*(rn(ie(t.b))-o))),a:e.a+n*(t.a-e.a)}}function Ji(e,t,n){if(e){let i=qr(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,t===0?360:1)),i=Xr(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function Jd(e,t){return e&&Object.assign(t||{},e)}function ul(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Me(e[3]))):(t=Jd(e,{r:0,g:0,b:0,a:1}),t.a=Me(t.a)),t}function Vb(e){return e.charAt(0)==="r"?jb(e):Rb(e)}class xi{constructor(t){if(t instanceof xi)return t;const n=typeof t;let i;n==="object"?i=ul(t):n==="string"&&(i=Ib(t)||$b(t)||Vb(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Jd(this._rgb);return t&&(t.a=ie(t.a)),t}set rgb(t){this._rgb=ul(t)}rgbString(){return this._valid?zb(this._rgb):void 0}hexString(){return this._valid?Tb(this._rgb):void 0}hslString(){return this._valid?Nb(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,s=t.rgb;let o;const r=n===o?.5:n,a=2*r-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-c,i.r=255&c*i.r+o*s.r+.5,i.g=255&c*i.g+o*s.g+.5,i.b=255&c*i.b+o*s.b+.5,i.a=r*i.a+(1-r)*s.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=Ub(this._rgb,t._rgb,n)),this}clone(){return new xi(this.rgb)}alpha(t){return this._rgb.a=Me(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=Bi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Ji(this._rgb,2,t),this}darken(t){return Ji(this._rgb,2,-t),this}saturate(t){return Ji(this._rgb,1,t),this}desaturate(t){return Ji(this._rgb,1,-t),this}rotate(t){return Bb(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Qt(){}const Wb=(()=>{let e=0;return()=>e++})();function N(e){return e==null}function et(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function $(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function ot(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function Lt(e,t){return ot(e)?e:t}function O(e,t){return typeof e>"u"?t:e}const Yb=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,Zd=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Z(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function q(e,t,n,i){let s,o,r;if(et(e))for(o=e.length,s=0;s<o;s++)t.call(n,e[s],s);else if($(e))for(r=Object.keys(e),o=r.length,s=0;s<o;s++)t.call(n,e[r[s]],r[s])}function qs(e,t){let n,i,s,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],o=t[n],s.datasetIndex!==o.datasetIndex||s.index!==o.index)return!1;return!0}function Gs(e){if(et(e))return e.map(Gs);if($(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=Gs(e[n[s]]);return t}return e}function Qd(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function qb(e,t,n,i){if(!Qd(e))return;const s=t[e],o=n[e];$(s)&&$(o)?_i(s,o,i):t[e]=Gs(o)}function _i(e,t,n){const i=et(t)?t:[t],s=i.length;if(!$(e))return e;n=n||{};const o=n.merger||qb;let r;for(let a=0;a<s;++a){if(r=i[a],!$(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],e,r,n)}return e}function di(e,t){return _i(e,t,{merger:Gb})}function Gb(e,t,n){if(!Qd(e))return;const i=t[e],s=n[e];$(i)&&$(s)?di(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Gs(s))}const hl={"":e=>e,x:e=>e.x,y:e=>e.y};function Xb(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}function Kb(e){const t=Xb(e);return n=>{for(const i of t){if(i==="")break;n=n&&n[i]}return n}}function Ce(e,t){return(hl[t]||(hl[t]=Kb(t)))(e)}function Kr(e){return e.charAt(0).toUpperCase()+e.slice(1)}const wi=e=>typeof e<"u",Ae=e=>typeof e=="function",fl=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function Jb(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const V=Math.PI,Q=2*V,Zb=Q+V,Xs=Number.POSITIVE_INFINITY,Qb=V/180,at=V/2,$e=V/4,gl=V*2/3,Se=Math.log10,Xt=Math.sign;function ui(e,t,n){return Math.abs(e-t)<n}function pl(e){const t=Math.round(e);e=ui(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(Se(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function t0(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(n|0)&&t.push(n),t.sort((s,o)=>s-o).pop(),t}function e0(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function xn(e){return!e0(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function n0(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function tu(e,t,n){let i,s,o;for(i=0,s=e.length;i<s;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function zt(e){return e*(V/180)}function Jr(e){return e*(180/V)}function ml(e){if(!ot(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function eu(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*V&&(o+=Q),{angle:o,distance:s}}function ur(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function i0(e,t){return(e-t+Zb)%Q-V}function xt(e){return(e%Q+Q)%Q}function ki(e,t,n,i){const s=xt(e),o=xt(t),r=xt(n),a=xt(o-s),l=xt(r-s),c=xt(s-o),d=xt(s-r);return s===o||s===r||i&&o===r||a>l&&c<d}function gt(e,t,n){return Math.max(t,Math.min(n,e))}function s0(e){return gt(e,-32768,32767)}function oe(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function Zr(e,t,n){n=n||(r=>e[r]<t);let i=e.length-1,s=0,o;for(;i-s>1;)o=s+i>>1,n(o)?s=o:i=o;return{lo:s,hi:i}}const re=(e,t,n,i)=>Zr(e,n,i?s=>{const o=e[s][t];return o<n||o===n&&e[s+1][t]===n}:s=>e[s][t]<n),o0=(e,t,n)=>Zr(e,n,i=>e[i][t]>=n);function r0(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}const nu=["push","pop","shift","splice","unshift"];function a0(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),nu.forEach(n=>{const i="_onData"+Kr(n),s=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const r=s.apply(this,o);return e._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...o)}),r}})})}function bl(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(nu.forEach(o=>{delete e[o]}),delete e._chartjs)}function iu(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const su=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function ou(e,t){let n=[],i=!1;return function(...s){n=s,i||(i=!0,su.call(window,()=>{i=!1,e.apply(t,n)}))}}function l0(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}const Qr=e=>e==="start"?"left":e==="end"?"right":"center",vt=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,c0=(e,t,n,i)=>e===(i?"left":"right")?n:e==="center"?(t+n)/2:t;function ru(e,t,n){const i=t.length;let s=0,o=i;if(e._sorted){const{iScale:r,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=r.axis,{min:u,max:h,minDefined:f,maxDefined:g}=r.getUserBounds();if(f){if(s=Math.min(re(l,d,u).lo,n?i:re(t,d,r.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!N(m[a.axis]));s-=Math.max(0,p)}s=gt(s,0,i-1)}if(g){let p=Math.max(re(l,r.axis,h,!0).hi+1,n?0:re(t,d,r.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!N(b[a.axis]));p+=Math.max(0,m)}o=gt(p,s,i)-s}else o=i-s}return{start:s,count:o}}function au(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),o}const Zi=e=>e===0||e===1,yl=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*Q/n)),vl=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*Q/n)+1,hi={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*at)+1,easeOutSine:e=>Math.sin(e*at),easeInOutSine:e=>-.5*(Math.cos(V*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>Zi(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Zi(e)?e:yl(e,.075,.3),easeOutElastic:e=>Zi(e)?e:vl(e,.075,.3),easeInOutElastic(e){return Zi(e)?e:e<.5?.5*yl(e*2,.1125,.45):.5+.5*vl(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-hi.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?hi.easeInBounce(e*2)*.5:hi.easeOutBounce(e*2-1)*.5+.5};function ta(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function xl(e){return ta(e)?e:new xi(e)}function Ro(e){return ta(e)?e:new xi(e).saturate(.5).darken(.1).hexString()}const d0=["x","y","borderWidth","radius","tension"],u0=["color","borderColor","backgroundColor"];function h0(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:u0},numbers:{type:"number",properties:d0}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function f0(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const _l=new Map;function g0(e,t){t=t||{};const n=e+JSON.stringify(t);let i=_l.get(n);return i||(i=new Intl.NumberFormat(e,t),_l.set(n,i)),i}function Ni(e,t,n){return g0(t,n).format(e)}const lu={values(e){return et(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const i=this.chart.options.locale;let s,o=e;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),o=p0(e,n)}const r=Se(Math.abs(o)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Ni(e,i,l)},logarithmic(e,t,n){if(e===0)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(Se(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?lu.numeric.call(this,e,t,n):""}};function p0(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var oo={formatters:lu};function m0(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:oo.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Je=Object.create(null),hr=Object.create(null);function fi(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const o=n[i];e=e[o]||(e[o]=Object.create(null))}return e}function Bo(e,t,n){return typeof t=="string"?_i(fi(e,t),n):_i(fi(e,""),t)}class b0{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Ro(s.backgroundColor),this.hoverBorderColor=(i,s)=>Ro(s.borderColor),this.hoverColor=(i,s)=>Ro(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return Bo(this,t,n)}get(t){return fi(this,t)}describe(t,n){return Bo(hr,t,n)}override(t,n){return Bo(Je,t,n)}route(t,n,i,s){const o=fi(this,t),r=fi(this,i),a="_"+n;Object.defineProperties(o,{[a]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=r[s];return $(l)?Object.assign({},c,l):O(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(n=>n(this))}}var nt=new b0({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[h0,f0,m0]);function y0(e){return!e||N(e.size)||N(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function Ks(e,t,n,i,s){let o=t[s];return o||(o=t[s]=e.measureText(s).width,n.push(s)),o>i&&(i=o),i}function v0(e,t,n,i){i=i||{};let s=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},o=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let r=0;const a=n.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=n[l],u!=null&&!et(u))r=Ks(e,s,o,r,u);else if(et(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!et(h)&&(r=Ks(e,s,o,r,h));e.restore();const f=o.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[o[l]];o.splice(0,f)}return r}function He(e,t,n){const i=e.currentDevicePixelRatio,s=n!==0?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function wl(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function fr(e,t,n,i){cu(e,t,n,i,null)}function cu(e,t,n,i,s){let o,r,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Qb;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,i),e.rotate(m),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!(isNaN(p)||p<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,p,0,0,Q):e.arc(n,i,p,0,Q),e.closePath();break;case"triangle":d=s?s/2:p,e.moveTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=gl,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=gl,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),e.closePath();break;case"rectRounded":c=p*.516,l=p-c,r=Math.cos(m+$e)*l,u=Math.cos(m+$e)*(s?s/2-c:l),a=Math.sin(m+$e)*l,h=Math.sin(m+$e)*(s?s/2-c:l),e.arc(n-u,i-a,c,m-V,m-at),e.arc(n+h,i-r,c,m-at,m),e.arc(n+u,i+a,c,m,m+at),e.arc(n-h,i+r,c,m+at,m+V),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,e.rect(n-d,i-l,2*d,2*l);break}m+=$e;case"rectRot":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+h,i-r),e.lineTo(n+u,i+a),e.lineTo(n-h,i+r),e.closePath();break;case"crossRot":m+=$e;case"cross":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"star":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r),m+=$e,u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"line":r=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,e.moveTo(n-r,i-a),e.lineTo(n+r,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function ae(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function ro(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function ao(e){e.restore()}function x0(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if(s==="middle"){const o=(t.x+n.x)/2;e.lineTo(o,t.y),e.lineTo(o,n.y)}else s==="after"!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function _0(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function w0(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),N(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function k0(e,t,n,i,s){if(s.strikethrough||s.underline){const o=e.measureText(i),r=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(r,d),e.lineTo(a,d),e.stroke()}}function S0(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function Ze(e,t,n,i,s,o={}){const r=et(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(e.save(),e.font=s.string,w0(e,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&S0(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),N(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),k0(e,n,i,c,o),i+=Number(s.lineHeight);e.restore()}function Si(e,t){const{x:n,y:i,w:s,h:o,radius:r}=t;e.arc(n+r.topLeft,i+r.topLeft,r.topLeft,1.5*V,V,!0),e.lineTo(n,i+o-r.bottomLeft),e.arc(n+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,V,at,!0),e.lineTo(n+s-r.bottomRight,i+o),e.arc(n+s-r.bottomRight,i+o-r.bottomRight,r.bottomRight,at,0,!0),e.lineTo(n+s,i+r.topRight),e.arc(n+s-r.topRight,i+r.topRight,r.topRight,0,-at,!0),e.lineTo(n+r.topLeft,i)}const E0=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,I0=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function D0(e,t){const n=(""+e).match(E0);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const T0=e=>+e||0;function ea(e,t){const n={},i=$(t),s=i?Object.keys(t):t,o=$(e)?i?r=>O(e[r],e[t[r]]):r=>e[r]:()=>e;for(const r of s)n[r]=T0(o(r));return n}function du(e){return ea(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Xe(e){return ea(e,["topLeft","topRight","bottomLeft","bottomRight"])}function wt(e){const t=du(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function dt(e,t){e=e||{},t=t||nt.font;let n=O(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let i=O(e.style,t.style);i&&!(""+i).match(I0)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:O(e.family,t.family),lineHeight:D0(O(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:O(e.weight,t.weight),string:""};return s.string=y0(s),s}function Yn(e,t,n,i){let s,o,r;for(s=0,o=e.length;s<o;++s)if(r=e[s],r!==void 0&&r!==void 0)return r}function M0(e,t,n){const{min:i,max:s}=e,o=Zd(t,(s-i)/2),r=(a,l)=>n&&a===0?0:a+l;return{min:r(i,-Math.abs(o)),max:r(s,o)}}function Le(e,t){return Object.assign(Object.create(e),t)}function na(e,t=[""],n,i,s=()=>e[0]){const o=n||e;typeof i>"u"&&(i=gu("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:i,_getTarget:s,override:a=>na([a,...e],t,o,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete a._keys,delete e[0][l],!0},get(a,l){return hu(a,l,()=>N0(l,t,e,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(a,l){return Sl(a).includes(l)},ownKeys(a){return Sl(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function _n(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:uu(e,i),setContext:o=>_n(e,o,n,i),override:o=>_n(e.override(o),t,n,i)};return new Proxy(s,{deleteProperty(o,r){return delete o[r],delete e[r],!0},get(o,r,a){return hu(o,r,()=>A0(o,r,a))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(e,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,r)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,r){return Reflect.has(e,r)},ownKeys(){return Reflect.ownKeys(e)},set(o,r,a){return e[r]=a,delete o[r],!0}})}function uu(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:Ae(n)?n:()=>n,isIndexable:Ae(i)?i:()=>i}}const C0=(e,t)=>e?e+Kr(t):t,ia=(e,t)=>$(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function hu(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const i=n();return e[t]=i,i}function A0(e,t,n){const{_proxy:i,_context:s,_subProxy:o,_descriptors:r}=e;let a=i[t];return Ae(a)&&r.isScriptable(t)&&(a=L0(t,a,e,n)),et(a)&&a.length&&(a=O0(t,a,e,r.isIndexable)),ia(t,a)&&(a=_n(a,s,o&&o[t],r)),a}function L0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,r||i);return a.delete(e),ia(e,l)&&(l=sa(s._scopes,s,e,l)),l}function O0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_descriptors:a}=n;if(typeof o.index<"u"&&i(e))return t[o.index%t.length];if($(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=sa(c,s,e,d);t.push(_n(u,o,r&&r[e],a))}}return t}function fu(e,t,n){return Ae(e)?e(t,n):e}const P0=(e,t)=>e===!0?t:typeof e=="string"?Ce(t,e):void 0;function R0(e,t,n,i,s){for(const o of t){const r=P0(n,o);if(r){e.add(r);const a=fu(r._fallback,n,s);if(typeof a<"u"&&a!==n&&a!==i)return a}else if(r===!1&&typeof i<"u"&&n!==i)return null}return!1}function sa(e,t,n,i){const s=t._rootScopes,o=fu(t._fallback,n,i),r=[...e,...s],a=new Set;a.add(i);let l=kl(a,r,n,o||n,i);return l===null||typeof o<"u"&&o!==n&&(l=kl(a,r,o,l,i),l===null)?!1:na(Array.from(a),[""],s,o,()=>B0(t,n,i))}function kl(e,t,n,i,s){for(;n;)n=R0(e,t,n,i,s);return n}function B0(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];return et(s)&&$(n)?n:s||{}}function N0(e,t,n,i){let s;for(const o of t)if(s=gu(C0(o,e),n),typeof s<"u")return ia(e,s)?sa(n,i,e,s):s}function gu(e,t){for(const n of t){if(!n)continue;const i=n[e];if(typeof i<"u")return i}}function Sl(e){let t=e._keys;return t||(t=e._keys=F0(e._scopes)),t}function F0(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function pu(e,t,n,i){const{iScale:s}=e,{key:o="r"}=this._parsing,r=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+n,d=t[c],r[a]={r:s.parse(Ce(d,o),c)};return r}const $0=Number.EPSILON||1e-14,wn=(e,t)=>t<e.length&&!e[t].skip&&e[t],mu=e=>e==="x"?"y":"x";function H0(e,t,n,i){const s=e.skip?t:e,o=t,r=n.skip?t:n,a=ur(o,s),l=ur(r,o);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:o.x-u*(r.x-s.x),y:o.y-u*(r.y-s.y)},next:{x:o.x+h*(r.x-s.x),y:o.y+h*(r.y-s.y)}}}function j0(e,t,n){const i=e.length;let s,o,r,a,l,c=wn(e,0);for(let d=0;d<i-1;++d)if(l=c,c=wn(e,d+1),!(!l||!c)){if(ui(t[d],0,$0)){n[d]=n[d+1]=0;continue}s=n[d]/t[d],o=n[d+1]/t[d],a=Math.pow(s,2)+Math.pow(o,2),!(a<=9)&&(r=3/Math.sqrt(a),n[d]=s*r*t[d],n[d+1]=o*r*t[d])}}function z0(e,t,n="x"){const i=mu(n),s=e.length;let o,r,a,l=wn(e,0);for(let c=0;c<s;++c){if(r=a,a=l,l=wn(e,c+1),!a)continue;const d=a[n],u=a[i];r&&(o=(d-r[n])/3,a[`cp1${n}`]=d-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-d)/3,a[`cp2${n}`]=d+o,a[`cp2${i}`]=u+o*t[c])}}function U0(e,t="x"){const n=mu(t),i=e.length,s=Array(i).fill(0),o=Array(i);let r,a,l,c=wn(e,0);for(r=0;r<i;++r)if(a=l,l=c,c=wn(e,r+1),!!l){if(c){const d=c[t]-l[t];s[r]=d!==0?(c[n]-l[n])/d:0}o[r]=a?c?Xt(s[r-1])!==Xt(s[r])?0:(s[r-1]+s[r])/2:s[r-1]:s[r]}j0(e,s,o),z0(e,o,t)}function Qi(e,t,n){return Math.max(Math.min(e,n),t)}function V0(e,t){let n,i,s,o,r,a=ae(e[0],t);for(n=0,i=e.length;n<i;++n)r=o,o=a,a=n<i-1&&ae(e[n+1],t),o&&(s=e[n],r&&(s.cp1x=Qi(s.cp1x,t.left,t.right),s.cp1y=Qi(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=Qi(s.cp2x,t.left,t.right),s.cp2y=Qi(s.cp2y,t.top,t.bottom)))}function W0(e,t,n,i,s){let o,r,a,l;if(t.spanGaps&&(e=e.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")U0(e,s);else{let c=i?e[e.length-1]:e[0];for(o=0,r=e.length;o<r;++o)a=e[o],l=H0(c,a,e[Math.min(o+1,r-(i?0:1))%r],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&V0(e,n)}function oa(){return typeof window<"u"&&typeof document<"u"}function ra(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Js(e,t,n){let i;return typeof e=="string"?(i=parseInt(e,10),e.indexOf("%")!==-1&&(i=i/100*t.parentNode[n])):i=e,i}const lo=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function Y0(e,t){return lo(e).getPropertyValue(t)}const q0=["top","right","bottom","left"];function Ke(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const o=q0[s];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const G0=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function X0(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:o}=i;let r=!1,a,l;if(G0(s,o,e.target))a=s,l=o;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:a,y:l,box:r}}function Ve(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=lo(n),o=s.boxSizing==="border-box",r=Ke(s,"padding"),a=Ke(s,"border","width"),{x:l,y:c,box:d}=X0(e,n),u=r.left+(d&&a.left),h=r.top+(d&&a.top);let{width:f,height:g}=t;return o&&(f-=r.width+a.width,g-=r.height+a.height),{x:Math.round((l-u)/f*n.width/i),y:Math.round((c-h)/g*n.height/i)}}function K0(e,t,n){let i,s;if(t===void 0||n===void 0){const o=e&&ra(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const r=o.getBoundingClientRect(),a=lo(o),l=Ke(a,"border","width"),c=Ke(a,"padding");t=r.width-c.width-l.width,n=r.height-c.height-l.height,i=Js(a.maxWidth,o,"clientWidth"),s=Js(a.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:i||Xs,maxHeight:s||Xs}}const Ee=e=>Math.round(e*10)/10;function J0(e,t,n,i){const s=lo(e),o=Ke(s,"margin"),r=Js(s.maxWidth,e,"clientWidth")||Xs,a=Js(s.maxHeight,e,"clientHeight")||Xs,l=K0(e,t,n);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=Ke(s,"border","width"),f=Ke(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=Ee(Math.min(c,r,l.maxWidth)),d=Ee(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Ee(c/2)),(t!==void 0||n!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Ee(Math.floor(d*i))),{width:c,height:d}}function El(e,t,n){const i=t||1,s=Ee(e.height*i),o=Ee(e.width*i);e.height=Ee(e.height),e.width=Ee(e.width);const r=e.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${e.height}px`,r.style.width=`${e.width}px`),e.currentDevicePixelRatio!==i||r.height!==s||r.width!==o?(e.currentDevicePixelRatio=i,r.height=s,r.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Z0=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};oa()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function Il(e,t){const n=Y0(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function We(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function Q0(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:i==="middle"?n<.5?e.y:t.y:i==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function ty(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},r=We(e,s,n),a=We(s,o,n),l=We(o,t,n),c=We(r,a,n),d=We(a,l,n);return We(c,d,n)}const ey=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,i){return n-i},leftForLtr(n,i){return n-i}}},ny=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function mn(e,t,n){return e?ey(t,n):ny()}function bu(e,t){let n,i;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function yu(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function vu(e){return e==="angle"?{between:ki,compare:i0,normalize:xt}:{between:oe,compare:(t,n)=>t-n,normalize:t=>t}}function Dl({start:e,end:t,count:n,loop:i,style:s}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n===0,style:s}}function iy(e,t,n){const{property:i,start:s,end:o}=n,{between:r,normalize:a}=vu(i),l=t.length;let{start:c,end:d,loop:u}=e,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(a(t[c%l][i]),s,o);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:e.style}}function xu(e,t,n){if(!n)return[e];const{property:i,start:s,end:o}=n,r=t.length,{compare:a,between:l,normalize:c}=vu(i),{start:d,end:u,loop:h,style:f}=iy(e,t,n),g=[];let p=!1,m=null,b,y,x;const _=()=>l(s,x,b)&&a(s,x)!==0,v=()=>a(o,b)===0||l(o,x,b),w=()=>p||_(),k=()=>!p||v();for(let S=d,D=d;S<=u;++S)y=t[S%r],!y.skip&&(b=c(y[i]),b!==x&&(p=l(b,s,o),m===null&&w()&&(m=a(b,s)===0?S:D),m!==null&&k()&&(g.push(Dl({start:m,end:S,loop:h,count:r,style:f})),m=null),D=S,x=b));return m!==null&&g.push(Dl({start:m,end:u,loop:h,count:r,style:f})),g}function _u(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const o=xu(i[s],e.points,t);o.length&&n.push(...o)}return n}function sy(e,t,n,i){let s=0,o=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(o+=s);o>s&&e[o%t].skip;)o--;return o%=t,{start:s,end:o}}function oy(e,t,n,i){const s=e.length,o=[];let r=t,a=e[t],l;for(l=t+1;l<=n;++l){const c=e[l%s];c.skip||c.stop?a.skip||(i=!1,o.push({start:t%s,end:(l-1)%s,loop:i}),t=r=c.stop?l:null):(r=l,a.skip&&(t=l)),a=c}return r!==null&&o.push({start:t%s,end:r%s,loop:i}),o}function ry(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const o=!!e._loop,{start:r,end:a}=sy(n,s,o,i);if(i===!0)return Tl(e,[{start:r,end:a,loop:o}],n,t);const l=a<r?a+s:a,c=!!e._fullLoop&&r===0&&a===s-1;return Tl(e,oy(n,r,l,c),n,t)}function Tl(e,t,n,i){return!i||!i.setContext||!n?t:ay(e,t,n,i)}function ay(e,t,n,i){const s=e._chart.getContext(),o=Ml(e.options),{_datasetIndex:r,options:{spanGaps:a}}=e,l=n.length,c=[];let d=o,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;n[g%l].skip;)g-=y;for(;n[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=n[u%l],m;for(h=u+1;h<=g.end;h++){const b=n[h%l];m=Ml(i.setContext(Le(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),ly(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Ml(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function ly(e,t){if(!t)return!1;const n=[],i=function(s,o){return ta(o)?(n.includes(o)||n.push(o),n.indexOf(o)):o};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function ts(e,t,n){return e.options.clip?e[n]:t[n]}function cy(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:ts(n,t,"left"),right:ts(n,t,"right"),top:ts(i,t,"top"),bottom:ts(i,t,"bottom")}:t}function wu(e,t){const n=t._clip;if(n.disabled)return!1;const i=cy(t,e.chartArea);return{left:n.left===!1?0:i.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:i.right+(n.right===!0?0:n.right),top:n.top===!1?0:i.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:i.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class dy{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,s){const o=n.listeners[s],r=n.duration;o.forEach(a=>a({chart:t,initial:n.initial,numSteps:r,currentStep:Math.min(i-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=su.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,a=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(o[r]=o[o.length-1],o.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),o.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var te=new dy;const Cl="transparent",uy={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const i=xl(e||Cl),s=i.valid&&xl(t||Cl);return s&&s.valid?s.mix(i,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class hy{constructor(t,n,i,s){const o=n[i];s=Yn([t.to,s,o,t.from]);const r=Yn([t.from,o,s]);this._active=!0,this._fn=t.fn||uy[t.type||typeof r],this._easing=hi[t.easing]||hi.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=r,this._to=s,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const s=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=Yn([t.to,n,s,t.from]),this._from=Yn([t.from,s,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,s=this._prop,o=this._from,r=this._loop,a=this._to;let l;if(this._active=o!==a&&(r||n<i),!this._active){this._target[s]=a,this._notify(!0);return}if(n<0){this._target[s]=o;return}l=n/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(o,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][n]()}}class ku{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!$(t))return;const n=Object.keys(nt.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const o=t[s];if(!$(o))return;const r={};for(const a of n)r[a]=o[a];(et(o.properties)&&o.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,n){const i=n.options,s=gy(t,i);if(!s)return[];const o=this._createAnimations(s,i);return i.$shared&&fy(t.options.$animations,i).then(()=>{t.options=i},()=>{}),o}_createAnimations(t,n){const i=this._properties,s=[],o=t.$animations||(t.$animations={}),r=Object.keys(n),a=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,n));continue}const d=n[c];let u=o[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}o[c]=u=new hy(h,t,c,d),s.push(u)}return s}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const i=this._createAnimations(t,n);if(i.length)return te.add(this._chart,i),!0}}function fy(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const o=e[i[s]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function gy(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Al(e,t){const n=e&&e.options||{},i=n.reverse,s=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:i?o:s,end:i?s:o}}function py(e,t,n){if(n===!1)return!1;const i=Al(e,n),s=Al(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function my(e){let t,n,i,s;return $(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:e===!1}}function Su(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,o;for(s=0,o=i.length;s<o;++s)n.push(i[s].index);return n}function Ll(e,t,n,i={}){const s=e.keys,o=i.mode==="single";let r,a,l,c;if(t===null)return;let d=!1;for(r=0,a=s.length;r<a;++r){if(l=+s[r],l===n){if(d=!0,i.all)continue;break}c=e.values[l],ot(c)&&(o||t===0||Xt(t)===Xt(c))&&(t+=c)}return!d&&!i.all?0:t}function by(e,t){const{iScale:n,vScale:i}=t,s=n.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(e),a=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],a[l]={[s]:d,[o]:e[d]};return a}function No(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function yy(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function vy(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}function xy(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function Ol(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const o=e[s.index];if(n&&o>0||!n&&o<0)return s.index}return null}function Pl(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:o,vScale:r,index:a}=i,l=o.axis,c=r.axis,d=yy(o,r,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=xy(s,d,p),h[a]=m,h._top=Ol(h,r,!0,i.type),h._bottom=Ol(h,r,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function Fo(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function _y(e,t){return Le(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function wy(e,t,n){return Le(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function On(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const s of t){const o=s._stacks;if(!o||o[i]===void 0||o[i][n]===void 0)return;delete o[i][n],o[i]._visualValues!==void 0&&o[i]._visualValues[n]!==void 0&&delete o[i]._visualValues[n]}}}const $o=e=>e==="reset"||e==="none",Rl=(e,t)=>t?e:Object.assign({},e),ky=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:Su(n,!0),values:null};class Ut{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=No(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&On(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,o=n.xAxisID=O(i.xAxisID,Fo(t,"x")),r=n.yAxisID=O(i.yAxisID,Fo(t,"y")),a=n.rAxisID=O(i.rAxisID,Fo(t,"r")),l=n.indexAxis,c=n.iAxisID=s(l,o,r,a),d=n.vAxisID=s(l,r,o,a);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&bl(this._data,this),t._stacked&&On(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if($(n)){const s=this._cachedMeta;this._data=by(n,s)}else if(i!==n){if(i){bl(i,this);const s=this._cachedMeta;On(s),s._parsed=[]}n&&Object.isExtensible(n)&&a0(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const o=n._stacked;n._stacked=No(n.vScale,n),n.stack!==i.stack&&(s=!0,On(n),n.stack=i.stack),this._resyncElements(t),(s||o!==n._stacked)&&(Pl(this,n._parsed),n._stacked=No(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:i,_data:s}=this,{iScale:o,_stacked:r}=i,a=o.axis;let l=t===0&&n===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{et(s[t])?h=this.parseArrayData(i,s,t,n):$(s[t])?h=this.parseObjectData(i,s,t,n):h=this.parsePrimitiveData(i,s,t,n);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<n;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}r&&Pl(this,h)}parsePrimitiveData(t,n,i,s){const{iScale:o,vScale:r}=t,a=o.axis,l=r.axis,c=o.getLabels(),d=o===r,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||o.parse(c[g],g),[l]:r.parse(n[g],g)};return u}parseArrayData(t,n,i,s){const{xScale:o,yScale:r}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=n[d],a[l]={x:o.parse(u[0],d),y:r.parse(u[1],d)};return a}parseObjectData(t,n,i,s){const{xScale:o,yScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=n[h],c[d]={x:o.parse(Ce(f,a),h),y:r.parse(Ce(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){const s=this.chart,o=this._cachedMeta,r=n[t.axis],a={keys:Su(s,!0),values:n._stacks[t.axis]._visualValues};return Ll(a,r,o.index,{mode:i})}updateRangeFromParsed(t,n,i,s){const o=i[n.axis];let r=o===null?NaN:o;const a=s&&i._stacks[n.axis];s&&a&&(s.values=a,r=Ll(s,o,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,n){const i=this._cachedMeta,s=i._parsed,o=i._sorted&&t===i.iScale,r=s.length,a=this._getOtherScale(t),l=ky(n,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=vy(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!ot(f[t.axis])||d>p||u<p}for(h=0;h<r&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),o));++h);if(o){for(h=r-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const n=this._cachedMeta._parsed,i=[];let s,o,r;for(s=0,o=n.length;s<o;++s)r=n[s][t.axis],ot(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,i=n.iScale,s=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:s?""+s.getLabelForValue(o[s.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=my(O(this.options.clip,py(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,i=this._cachedMeta,s=i.data||[],o=n.chartArea,r=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,o,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?r.push(u):u.draw(t,o))}for(d=0;d<r.length;++d)r[d].draw(t,o)}getStyle(t,n){const i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){const s=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];o=r.$context||(r.$context=wy(this.getContext(),t,r)),o.parsed=this.getParsed(t),o.raw=s.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=_y(this.chart.getContext(),this.index)),o.dataset=s,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){const s=n==="active",o=this._cachedDataOpts,r=t+"-"+n,a=o[r],l=this.enableOptionSharing&&wi(i);if(a)return Rl(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(nt.elements[t]),g=()=>this.getContext(i,s,n),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,o[r]=Object.freeze(Rl(p,l))),p}_resolveAnimations(t,n,i){const s=this.chart,o=this._cachedDataOpts,r=`animation-${n}`,a=o[r];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,n))}const c=new ku(s,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||$o(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const i=this.resolveDataElementOptions(t,n),s=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(n,o)||o!==s;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:r}}updateElement(t,n,i,s){$o(s)?Object.assign(t,i):this._resolveAnimations(n,s).update(t,i)}updateSharedOptions(t,n,i){t&&!$o(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,s){t.active=s;const o=this.getStyle(n,s);this._resolveAnimations(n,i,s).update(t,{options:!s&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,o=n.length,r=Math.min(o,s);r&&this.parse(0,r),o>s?this._insertElements(s,o-s,t):o<s&&this._removeElements(o,s-o)}_insertElements(t,n,i=!0){const s=this._cachedMeta,o=s.data,r=t+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=r;a--)c[a]=c[a-n]};for(l(o),a=t;a<r;++a)o[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,s){}_removeElements(t,n){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,n);i._stacked&&On(i,s)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,i,s]=t;this[n](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}I(Ut,"defaults",{}),I(Ut,"datasetElementType",null),I(Ut,"dataElementType",null);function Sy(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let s=0,o=n.length;s<o;s++)i=i.concat(n[s].controller.getAllParsedValues(e));e._cache.$bar=iu(i.sort((s,o)=>s-o))}return e._cache.$bar}function Ey(e){const t=e.iScale,n=Sy(t,e.type);let i=t._length,s,o,r,a;const l=()=>{r===32767||r===-32768||(wi(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(s=0,o=n.length;s<o;++s)r=t.getPixelForValue(n[s]),l();for(a=void 0,s=0,o=t.ticks.length;s<o;++s)r=t.getPixelForTick(s),l();return i}function Iy(e,t,n,i){const s=n.barThickness;let o,r;return N(s)?(o=t.min*n.categoryPercentage,r=n.barPercentage):(o=s*i,r=1),{chunk:o/i,ratio:r,start:t.pixels[e]-o/2}}function Dy(e,t,n,i){const s=t.pixels,o=s[e];let r=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;r===null&&(r=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-r);const c=o-(o-Math.min(r,a))/2*l;return{chunk:Math.abs(a-r)/2*l/i,ratio:n.barPercentage,start:c}}function Ty(e,t,n,i){const s=n.parse(e[0],i),o=n.parse(e[1],i),r=Math.min(s,o),a=Math.max(s,o);let l=r,c=a;Math.abs(r)>Math.abs(a)&&(l=a,c=r),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:o,min:r,max:a}}function Eu(e,t,n,i){return et(e)?Ty(e,t,n,i):t[n.axis]=n.parse(e,i),t}function Bl(e,t,n,i){const s=e.iScale,o=e.vScale,r=s.getLabels(),a=s===o,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(r[c],c),l.push(Eu(h,u,o,c));return l}function Ho(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function My(e,t,n){return e!==0?Xt(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function Cy(e){let t,n,i,s,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",o="start"):(s="start",o="end"),{start:n,end:i,reverse:t,top:s,bottom:o}}function Ay(e,t,n,i){let s=t.borderSkipped;const o={};if(!s){e.borderSkipped=o;return}if(s===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:l,top:c,bottom:d}=Cy(e);s==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=d:(o[Nl(d,r,a,l)]=!0,s=c)),o[Nl(s,r,a,l)]=!0,e.borderSkipped=o}function Nl(e,t,n,i){return i?(e=Ly(e,t,n),e=Fl(e,n,t)):e=Fl(e,t,n),e}function Ly(e,t,n){return e===t?n:e===n?t:e}function Fl(e,t,n){return e==="start"?t:e==="end"?n:e}function Oy(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class _s extends Ut{parsePrimitiveData(t,n,i,s){return Bl(t,n,i,s)}parseArrayData(t,n,i,s){return Bl(t,n,i,s)}parseObjectData(t,n,i,s){const{iScale:o,vScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?a:l,d=r.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=n[h],g={},g[o.axis]=o.parse(Ce(p,c),h),u.push(Eu(Ce(p,d),g,r,h));return u}updateRangeFromParsed(t,n,i,s){super.updateRangeFromParsed(t,n,i,s);const o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:i,vScale:s}=n,o=this.getParsed(t),r=o._custom,a=Ho(r)?"["+r.start+", "+r.end+"]":""+s.getLabelForValue(o[s.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,s){const o=s==="reset",{index:r,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,s);for(let f=n;f<n+i;f++){const g=this.getParsed(f),p=o||N(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||Ho(g._custom)||r===b._top||r===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const x=y.options||t[f].options;Ay(y,x,b,r),Oy(y,x,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,n){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(n),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(N(h)||isNaN(h))return!0};for(const d of s)if(!(n!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[O(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,i){const s=this._getStacks(t,i),o=n!==void 0?s.indexOf(n):-1;return o===-1?s.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,i=n.iScale,s=[];let o,r;for(o=0,r=n.data.length;o<r;++o)s.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const a=t.barThickness;return{min:a||Ey(n),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:i,index:s},options:{base:o,minBarLength:r}}=this,a=o||0,l=this.getParsed(t),c=l._custom,d=Ho(c);let u=l[n.axis],h=0,f=i?this.applyStack(n,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Xt(u)!==Xt(c.barEnd)&&(h=0),h+=u);const m=!N(o)&&!d?o:h;let b=n.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=n.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<r){p=My(p,n,a)*r,u===a&&(b-=p/2);const y=n.getPixelForDecimal(0),x=n.getPixelForDecimal(1),_=Math.min(y,x),v=Math.max(y,x);b=Math.max(Math.min(b,v),_),g=b+p,i&&!d&&(l._stacks[n.axis]._visualValues[s]=n.getValueForPixel(g)-n.getValueForPixel(b))}if(b===n.getPixelForValue(a)){const y=Xt(p)*n.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,n){const i=n.scale,s=this.options,o=s.skipNull,r=O(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(n.grouped){const d=o?this._getStackCount(t):n.stackCount,u=s.barThickness==="flex"?Dy(t,n,s,d*c):Iy(t,n,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(O(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(r,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(r,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,i=t.data,s=i.length;let o=0;for(;o<s;++o)this.getParsed(o)[n.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}I(_s,"id","bar"),I(_s,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),I(_s,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class ws extends Ut{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,s){const o=super.parsePrimitiveData(t,n,i,s);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(t,n,i,s){const o=super.parseArrayData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=O(a[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(t,n,i,s){const o=super.parseObjectData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=O(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,s),d=r.axis,u=a.axis;for(let h=n;h<n+i;h++){const f=t[h],g=!o&&this.getParsed(h),p={},m=p[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(g[d]),b=p[u]=o?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),o&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,n){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,n);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const o=s.radius;return n!=="active"&&(s.radius=0),s.radius+=O(i&&i._custom,o),s}}I(ws,"id","bubble"),I(ws,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),I(ws,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Py(e,t,n){let i=1,s=1,o=0,r=0;if(t<Q){const a=e,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(x,_,v)=>ki(x,a,l,!0)?1:Math.max(_,_*n,v,v*n),g=(x,_,v)=>ki(x,a,l,!0)?-1:Math.min(_,_*n,v,v*n),p=f(0,c,u),m=f(at,d,h),b=g(V,c,u),y=g(V+at,d,h);i=(p-b)/2,s=(m-y)/2,o=-(p+b)/2,r=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:o,offsetY:r}}class qe extends Ut{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let o=l=>+i[l];if($(i[t])){const{key:l="value"}=this._parsing;o=c=>+Ce(i[c],l)}let r,a;for(r=t,a=t+n;r<a;++r)s._parsed[r]=o(r)}}_getRotation(){return zt(this.options.rotation-90)}_getCircumference(){return zt(this.options.circumference)}_getRotationExtents(){let t=Q,n=-Q;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,o=s._getRotation(),r=s._getCircumference();t=Math.min(t,o),n=Math.max(n,o+r)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:i}=n,s=this._cachedMeta,o=s.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(Yb(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Py(u,d,l),m=(i.width-r)/h,b=(i.height-r)/f,y=Math.max(Math.min(m,b)/2,0),x=Zd(this.options.radius,y),_=Math.max(x*l,0),v=(x-_)/this._getVisibleDatasetWeightTotal();this.offsetX=g*x,this.offsetY=p*x,s.total=this.calculateTotal(),this.outerRadius=x-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const i=this.options,s=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*o/Q)}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,a=r.chartArea,c=r.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=o&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(n,s);let b=this._getRotation(),y;for(y=0;y<n;++y)b+=this._circumference(y,o);for(y=n;y<n+i;++y){const x=this._circumference(y,o),_=t[y],v={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+x,circumference:x,outerRadius:g,innerRadius:f};m&&(v.options=p||this.resolveDataElementOptions(y,_.active?"active":s)),b+=x,this.updateElement(_,y,v,s)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let i=0,s;for(s=0;s<n.length;s++){const o=t._parsed[s];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(s)&&!n[s].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?Q*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ni(n._parsed[t],i.options.locale);return{label:s[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const i=this.chart;let s,o,r,a,l;if(!t){for(s=0,o=i.data.datasets.length;s<o;++s)if(i.isDatasetVisible(s)){r=i.getDatasetMeta(s),t=r.data,a=r.controller;break}}if(!t)return 0;for(s=0,o=t.length;s<o;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,s=t.length;i<s;++i){const o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(O(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}I(qe,"id","doughnut"),I(qe,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),I(qe,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),I(qe,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data,{labels:{pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=t.legend.options;return n.labels.length&&n.datasets.length?n.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:r&&(a||u.borderRadius),index:c}}):[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}});class ks extends Ut{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:i,data:s=[],_dataset:o}=n,r=this.chart._animationsDisabled;let{start:a,count:l}=ru(n,s,r);this._drawStart=a,this._drawCount=l,au(n)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,s),h=r.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=xn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||s==="none",y=n+i,x=t.length;let _=n>0&&this.getParsed(n-1);for(let v=0;v<x;++v){const w=t[v],k=b?w:{};if(v<n||v>=y){k.skip=!0;continue}const S=this.getParsed(v),D=N(S[f]),A=k[h]=r.getPixelForValue(S[h],v),T=k[f]=o||D?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[f],v);k.skip=isNaN(A)||isNaN(T)||D,k.stop=v>0&&Math.abs(S[h]-_[h])>m,p&&(k.parsed=S,k.raw=c.data[v]),u&&(k.options=d||this.resolveDataElementOptions(v,w.active?"active":s)),b||this.updateElement(w,v,k,s),_=S}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const o=s[0].size(this.resolveDataElementOptions(0)),r=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,o,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}I(ks,"id","line"),I(ks,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),I(ks,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class gi extends Ut{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ni(n._parsed[t].r,i.options.locale);return{label:s[t]||"",value:o}}parseObjectData(t,n,i,s){return pu.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const o=this.getParsed(s).r;!isNaN(o)&&this.chart.getDataVisibility(s)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,i=t.options,s=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(s/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),a=(o-r)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*V;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<n;++g)f+=this._computeAngle(g,s,p);for(g=n;g<n+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),x=r.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,o&&(l.animateScale&&(x=0),l.animateRotate&&(b=y=h));const _={x:d,y:u,innerRadius:0,outerRadius:x,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,_,s)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?zt(this.resolveDataElementOptions(t,n).angle||i):0}}I(gi,"id","polarArea"),I(gi,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),I(gi,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return n.labels.map((o,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class gr extends qe{}I(gr,"id","pie"),I(gr,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class Ss extends Ut{getLabelAndValue(t){const n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,s){return pu.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta,i=n.dataset,s=n.data||[],o=n.iScale.getLabels();if(i.points=s,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===s.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,n,i,s){const o=this._cachedMeta.rScale,r=s==="reset";for(let a=n;a<n+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=o.getPointPositionForValue(a,this.getParsed(a).r),u=r?o.xCenter:d.x,h=r?o.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}I(Ss,"id","radar"),I(Ss,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),I(Ss,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Es extends Ut{getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const n=this._cachedMeta,{data:i=[]}=n,s=this.chart._animationsDisabled;let{start:o,count:r}=ru(n,i,s);if(this._drawStart=o,this._drawCount=r,au(n)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=r.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=xn(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||s==="none";let x=n>0&&this.getParsed(n-1);for(let _=n;_<n+i;++_){const v=t[_],w=this.getParsed(_),k=y?v:{},S=N(w[g]),D=k[f]=r.getPixelForValue(w[f],_),A=k[g]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,w,l):w[g],_);k.skip=isNaN(D)||isNaN(A)||S,k.stop=_>0&&Math.abs(w[f]-x[f])>b,m&&(k.parsed=w,k.raw=c.data[_]),h&&(k.options=u||this.resolveDataElementOptions(_,v.active?"active":s)),y||this.updateElement(v,_,k,s),x=w}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let a=0;for(let l=n.length-1;l>=0;--l)a=Math.max(a,n[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!n.length)return s;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,o,r)/2}}I(Es,"id","scatter"),I(Es,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),I(Es,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Ry=Object.freeze({__proto__:null,BarController:_s,BubbleController:ws,DoughnutController:qe,LineController:ks,PieController:gr,PolarAreaController:gi,RadarController:Ss,ScatterController:Es});function je(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class aa{constructor(t){I(this,"options");this.options=t||{}}static override(t){Object.assign(aa.prototype,t)}init(){}formats(){return je()}parse(){return je()}format(){return je()}add(){return je()}diff(){return je()}startOf(){return je()}endOf(){return je()}}var By={_date:aa};function Ny(e,t,n,i){const{controller:s,data:o,_sorted:r}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&o.length){const c=a._reversePixels?o0:re;if(i){if(s._sharedOptions){const d=o[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(o,t,n-u),f=c(o,t,n+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(o,t,n);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=e,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!N(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!N(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:o.length-1}}function co(e,t,n,i,s){const o=e.getSortedVisibleDatasetMetas(),r=n[t];for(let a=0,l=o.length;a<l;++a){const{index:c,data:d}=o[a],{lo:u,hi:h}=Ny(o[a],t,r,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Fy(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(i,s){const o=t?Math.abs(i.x-s.x):0,r=n?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function jo(e,t,n,i,s){const o=[];return!s&&!e.isPointInArea(t)||co(e,n,t,function(a,l,c){!s&&!ae(a,e.chartArea,0)||a.inRange(t.x,t.y,i)&&o.push({element:a,datasetIndex:l,index:c})},!0),o}function $y(e,t,n,i){let s=[];function o(r,a,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:u}=eu(r,{x:t.x,y:t.y});ki(u,c,d)&&s.push({element:r,datasetIndex:a,index:l})}return co(e,n,t,o),s}function Hy(e,t,n,i,s,o){let r=[];const a=Fy(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!o||e.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return co(e,n,t,c),r}function zo(e,t,n,i,s,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!i?$y(e,t,n,s):Hy(e,t,n,i,s,o)}function $l(e,t,n,i,s){const o=[],r=n==="x"?"inXRange":"inYRange";let a=!1;return co(e,n,t,(l,c,d)=>{l[r]&&l[r](t[n],s)&&(o.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:o}var jy={modes:{index(e,t,n,i){const s=Ve(t,e),o=n.axis||"x",r=n.includeInvisible||!1,a=n.intersect?jo(e,s,o,i,r):zo(e,s,o,!1,i,r),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;let a=n.intersect?jo(e,s,o,i,r):zo(e,s,o,!1,i,r);if(a.length>0){const l=a[0].datasetIndex,c=e.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return jo(e,s,o,i,r)},nearest(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return zo(e,s,o,n.intersect,i,r)},x(e,t,n,i){const s=Ve(t,e);return $l(e,s,"x",n.intersect,i)},y(e,t,n,i){const s=Ve(t,e);return $l(e,s,"y",n.intersect,i)}}};const Iu=["left","top","right","bottom"];function Pn(e,t){return e.filter(n=>n.pos===t)}function Hl(e,t){return e.filter(n=>Iu.indexOf(n.pos)===-1&&n.box.axis===t)}function Rn(e,t){return e.sort((n,i)=>{const s=t?i:n,o=t?n:i;return s.weight===o.weight?s.index-o.index:s.weight-o.weight})}function zy(e){const t=[];let n,i,s,o,r,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],{position:o,options:{stack:r,stackWeight:a=1}}=s,t.push({index:n,box:s,pos:o,horizontal:s.isHorizontal(),weight:s.weight,stack:r&&o+r,stackWeight:a});return t}function Uy(e){const t={};for(const n of e){const{stack:i,pos:s,stackWeight:o}=n;if(!i||!Iu.includes(s))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}function Vy(e,t){const n=Uy(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let o,r,a;for(o=0,r=e.length;o<r;++o){a=e[o];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return n}function Wy(e){const t=zy(e),n=Rn(t.filter(c=>c.box.fullSize),!0),i=Rn(Pn(t,"left"),!0),s=Rn(Pn(t,"right")),o=Rn(Pn(t,"top"),!0),r=Rn(Pn(t,"bottom")),a=Hl(t,"x"),l=Hl(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:s.concat(l).concat(r).concat(a),chartArea:Pn(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:o.concat(r).concat(a)}}function jl(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function Du(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Yy(e,t,n,i){const{pos:s,box:o}=n,r=e.maxPadding;if(!$(s)){n.size&&(e[s]-=n.size);const u=i[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?o.height:o.width),n.size=u.size/u.count,e[s]+=n.size}o.getPadding&&Du(r,o.getPadding());const a=Math.max(0,t.outerWidth-jl(r,e,"left","right")),l=Math.max(0,t.outerHeight-jl(r,e,"top","bottom")),c=a!==e.w,d=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function qy(e){const t=e.maxPadding;function n(i){const s=Math.max(t[i]-e[i],0);return e[i]+=s,s}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function Gy(e,t){const n=t.maxPadding;function i(s){const o={left:0,top:0,right:0,bottom:0};return s.forEach(r=>{o[r]=Math.max(t[r],n[r])}),o}return i(e?["left","right"]:["top","bottom"])}function qn(e,t,n,i){const s=[];let o,r,a,l,c,d;for(o=0,r=e.length,c=0;o<r;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,Gy(a.horizontal,t));const{same:u,other:h}=Yy(t,n,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&qn(s,t,n,i)||d}function es(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function zl(e,t,n,i){const s=n.padding;let{x:o,y:r}=t;for(const a of e){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;wi(c.start)&&(r=c.start),l.fullSize?es(l,s.left,r,n.outerWidth-s.right-s.left,h):es(l,t.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=t.h*d,h=c.size||l.width;wi(c.start)&&(o=c.start),l.fullSize?es(l,o,s.top,h,n.outerHeight-s.bottom-s.top):es(l,o,t.top+c.placed,h,u),c.start=o,c.placed+=u,o=l.right}}t.x=o,t.y=r}var _t={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=wt(e.options.layout.padding),o=Math.max(t-s.width,0),r=Math.max(n-s.height,0),a=Wy(e.boxes),l=a.vertical,c=a.horizontal;q(e.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},s);Du(h,wt(i));const f=Object.assign({maxPadding:h,w:o,h:r,x:s.left,y:s.top},s),g=Vy(l.concat(c),u);qn(a.fullSize,f,u,g),qn(l,f,u,g),qn(c,f,u,g)&&qn(l,f,u,g),qy(f),zl(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,zl(a.rightAndBottom,f,u,g),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},q(a.chartArea,p=>{const m=p.box;Object.assign(m,e.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Tu{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,s){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,s?Math.floor(n/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Xy extends Tu{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Is="$chartjs",Ky={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ul=e=>e===null||e==="";function Jy(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[Is]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Ul(s)){const o=Il(e,"width");o!==void 0&&(e.width=o)}if(Ul(i))if(e.style.height==="")e.height=e.width/(t||2);else{const o=Il(e,"height");o!==void 0&&(e.height=o)}return e}const Mu=Z0?{passive:!0}:!1;function Zy(e,t,n){e&&e.addEventListener(t,n,Mu)}function Qy(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,Mu)}function tv(e,t){const n=Ky[e.type]||e.type,{x:i,y:s}=Ve(e,t);return{type:n,chart:t,native:e,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Zs(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function ev(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Zs(a.addedNodes,i),r=r&&!Zs(a.removedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function nv(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Zs(a.removedNodes,i),r=r&&!Zs(a.addedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const Ei=new Map;let Vl=0;function Cu(){const e=window.devicePixelRatio;e!==Vl&&(Vl=e,Ei.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function iv(e,t){Ei.size||window.addEventListener("resize",Cu),Ei.set(e,t)}function sv(e){Ei.delete(e),Ei.size||window.removeEventListener("resize",Cu)}function ov(e,t,n){const i=e.canvas,s=i&&ra(i);if(!s)return;const o=ou((a,l)=>{const c=s.clientWidth;n(a,l),c<s.clientWidth&&n()},window),r=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(s),iv(e,o),r}function Uo(e,t,n){n&&n.disconnect(),t==="resize"&&sv(e)}function rv(e,t,n){const i=e.canvas,s=ou(o=>{e.ctx!==null&&n(tv(o,e))},e);return Zy(i,t,s),s}class av extends Tu{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Jy(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[Is])return!1;const i=n[Is].initial;["height","width"].forEach(o=>{const r=i[o];N(r)?n.removeAttribute(o):n.setAttribute(o,r)});const s=i.style||{};return Object.keys(s).forEach(o=>{n.style[o]=s[o]}),n.width=n.width,delete n[Is],!0}addEventListener(t,n,i){this.removeEventListener(t,n);const s=t.$proxies||(t.$proxies={}),r={attach:ev,detach:nv,resize:ov}[n]||rv;s[n]=r(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),s=i[n];if(!s)return;({attach:Uo,detach:Uo,resize:Uo}[n]||Qy)(t,n,s),i[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,s){return J0(t,n,i,s)}isAttached(t){const n=t&&ra(t);return!!(n&&n.isConnected)}}function lv(e){return!oa()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?Xy:av}class Vt{constructor(){I(this,"x");I(this,"y");I(this,"active",!1);I(this,"options");I(this,"$animations")}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return xn(this.x)&&xn(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const s={};return t.forEach(o=>{s[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),s}}I(Vt,"defaults",{}),I(Vt,"defaultRoutes");function cv(e,t){const n=e.options.ticks,i=dv(e),s=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?hv(t):[],r=o.length,a=o[0],l=o[r-1],c=[];if(r>s)return fv(t,c,o,r/s),c;const d=uv(o,t,s);if(r>0){let u,h;const f=r>1?Math.round((l-a)/(r-1)):null;for(ns(t,c,d,N(f)?0:a-f,a),u=0,h=r-1;u<h;u++)ns(t,c,d,o[u],o[u+1]);return ns(t,c,d,l,N(f)?t.length:l+f),c}return ns(t,c,d),c}function dv(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}function uv(e,t,n){const i=gv(e),s=t.length/n;if(!i)return Math.max(s,1);const o=t0(i);for(let r=0,a=o.length-1;r<a;r++){const l=o[r];if(l>s)return l}return Math.max(s,1)}function hv(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}function fv(e,t,n,i){let s=0,o=n[0],r;for(i=Math.ceil(i),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=n[s*i])}function ns(e,t,n,i,s){const o=O(i,0),r=Math.min(O(s,e.length),e.length);let a=0,l,c,d;for(n=Math.ceil(n),s&&(l=s-i,n=l/Math.floor(l/n)),d=o;d<0;)a++,d=Math.round(o+a*n);for(c=Math.max(o,0);c<r;c++)c===d&&(t.push(e[c]),a++,d=Math.round(o+a*n))}function gv(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}const pv=e=>e==="left"?"right":e==="right"?"left":e,Wl=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,Yl=(e,t)=>Math.min(t||e,e);function ql(e,t){const n=[],i=e.length/t,s=e.length;let o=0;for(;o<s;o+=i)n.push(e[Math.floor(o)]);return n}function mv(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),o=e._startPixel,r=e._endPixel,a=1e-6;let l=e.getPixelForTick(s),c;if(!(n&&(i===1?c=Math.max(l-o,r-l):t===0?c=(e.getPixelForTick(1)-l)/2:c=(l-e.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<o-a||l>r+a)))return l}function bv(e,t){q(e,n=>{const i=n.gc,s=i.length/2;let o;if(s>t){for(o=0;o<s;++o)delete n.data[i[o]];i.splice(0,s)}})}function Bn(e){return e.drawTicks?e.tickLength:0}function Gl(e,t){if(!e.display)return 0;const n=dt(e.font,t),i=wt(e.padding);return(et(e.text)?e.text.length:1)*n.lineHeight+i.height}function yv(e,t){return Le(e,{scale:t,type:"scale"})}function vv(e,t,n){return Le(e,{tick:n,index:t,type:"tick"})}function xv(e,t,n){let i=Qr(e);return(n&&t!=="right"||!n&&t==="right")&&(i=pv(i)),i}function _v(e,t,n,i){const{top:s,left:o,bottom:r,right:a,chart:l}=e,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=r-s,m=a-o;if(e.isHorizontal()){if(f=vt(i,o,a),$(n)){const b=Object.keys(n)[0],y=n[b];g=d[b].getPixelForValue(y)+p-t}else n==="center"?g=(c.bottom+c.top)/2+p-t:g=Wl(e,n,t);h=a-o}else{if($(n)){const b=Object.keys(n)[0],y=n[b];f=d[b].getPixelForValue(y)-m+t}else n==="center"?f=(c.left+c.right)/2-m+t:f=Wl(e,n,t);g=vt(i,r,s),u=n==="left"?-at:at}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class en extends Vt{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:s}=this;return t=Lt(t,Number.POSITIVE_INFINITY),n=Lt(n,Number.NEGATIVE_INFINITY),i=Lt(i,Number.POSITIVE_INFINITY),s=Lt(s,Number.NEGATIVE_INFINITY),{min:Lt(t,i),max:Lt(n,s),minDefined:ot(t),maxDefined:ot(n)}}getMinMax(t){let{min:n,max:i,minDefined:s,maxDefined:o}=this.getUserBounds(),r;if(s&&o)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)r=a[l].controller.getMinMax(this,t),s||(n=Math.min(n,r.min)),o||(i=Math.max(i,r.max));return n=o&&n>i?i:n,i=s&&n>i?n:i,{min:Lt(n,Lt(i,n)),max:Lt(i,Lt(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Z(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:s,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=M0(this,o,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?ql(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=cv(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,i;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Z(this.options.afterUpdate,[this])}beforeSetDimensions(){Z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,s,o;for(i=0,s=t.length;i<s;i++)o=t[i],o.label=Z(n.callback,[o.value,i,t],this)}afterTickToLabelConversion(){Z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=Yl(this.ticks.length,t.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation;let r=s,a,l,c;if(!this._isVisible()||!n.display||s>=o||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=gt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Bn(t.grid)-n.padding-Gl(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=Jr(Math.min(Math.asin(gt((d.highest.height+6)/a,-1,1)),Math.asin(gt(l/c,-1,1))-Math.asin(gt(h/c,-1,1)))),r=Math.max(s,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){Z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:s,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const l=Gl(s,n.options.font);if(a?(t.width=this.maxWidth,t.height=Bn(o)+l):(t.height=this.maxHeight,t.width=Bn(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=zt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,s){const{ticks:{align:o,padding:r},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*n.height):(h=i*t.height,f=s*n.width):o==="start"?f=n.width:o==="end"?h=t.width:o!=="inner"&&(h=t.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=t.height/2;o==="start"?(d=0,u=t.height):o==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,i;for(n=0,i=t.length;n<i;n++)N(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=ql(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,i){const{ctx:s,_longestTextCache:o}=this,r=[],a=[],l=Math.floor(n/Yl(n,i));let c=0,d=0,u,h,f,g,p,m,b,y,x,_,v;for(u=0;u<n;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=o[m]=o[m]||{data:{},gc:[]},y=p.lineHeight,x=_=0,!N(g)&&!et(g))x=Ks(s,b.data,b.gc,x,g),_=y;else if(et(g))for(h=0,f=g.length;h<f;++h)v=g[h],!N(v)&&!et(v)&&(x=Ks(s,b.data,b.gc,x,v),_+=y);r.push(x),a.push(_),c=Math.max(x,c),d=Math.max(_,d)}bv(o,n);const w=r.indexOf(c),k=a.indexOf(d),S=D=>({width:r[D]||0,height:a[D]||0});return{first:S(0),last:S(n-1),widest:S(w),highest:S(k),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return s0(this._alignToPixels?He(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=vv(this.getContext(),t,i))}return this.$context||(this.$context=yv(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=zt(this.labelRotation),i=Math.abs(Math.cos(n)),s=Math.abs(Math.sin(n)),o=this._getLabelSizes(),r=t.autoSkipPadding||0,a=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,s=this.options,{grid:o,position:r,border:a}=s,l=o.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Bn(o),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(z){return He(i,z,p)};let y,x,_,v,w,k,S,D,A,T,R,G;if(r==="top")y=b(this.bottom),k=this.bottom-h,D=y-m,T=b(t.top)+m,G=t.bottom;else if(r==="bottom")y=b(this.top),T=t.top,G=b(t.bottom)-m,k=y+m,D=this.top+h;else if(r==="left")y=b(this.right),w=this.right-h,S=y-m,A=b(t.left)+m,R=t.right;else if(r==="right")y=b(this.left),A=t.left,R=b(t.right)-m,w=y+m,S=this.left+h;else if(n==="x"){if(r==="center")y=b((t.top+t.bottom)/2+.5);else if($(r)){const z=Object.keys(r)[0],J=r[z];y=b(this.chart.scales[z].getPixelForValue(J))}T=t.top,G=t.bottom,k=y+m,D=k+h}else if(n==="y"){if(r==="center")y=b((t.left+t.right)/2);else if($(r)){const z=Object.keys(r)[0],J=r[z];y=b(this.chart.scales[z].getPixelForValue(J))}w=y-m,S=w-h,A=t.left,R=t.right}const rt=O(s.ticks.maxTicksLimit,u),j=Math.max(1,Math.ceil(u/rt));for(x=0;x<u;x+=j){const z=this.getContext(x),J=o.setContext(z),pt=a.setContext(z),ut=J.lineWidth,Oe=J.color,Pe=pt.dash||[],me=pt.dashOffset,Mn=J.tickWidth,Re=J.tickColor,Cn=J.tickBorderDash||[],Be=J.tickBorderDashOffset;_=mv(this,x,l),_!==void 0&&(v=He(i,_,ut),c?w=S=A=R=v:k=D=T=G=v,f.push({tx1:w,ty1:k,tx2:S,ty2:D,x1:A,y1:T,x2:R,y2:G,width:ut,color:Oe,borderDash:Pe,borderDashOffset:me,tickWidth:Mn,tickColor:Re,tickBorderDash:Cn,tickBorderDashOffset:Be}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const n=this.axis,i=this.options,{position:s,ticks:o}=i,r=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=o,h=Bn(i.grid),f=h+d,g=u?-d:f,p=-zt(this.labelRotation),m=[];let b,y,x,_,v,w,k,S,D,A,T,R,G="middle";if(s==="top")w=this.bottom-g,k=this._getXAxisLabelAlignment();else if(s==="bottom")w=this.top+g,k=this._getXAxisLabelAlignment();else if(s==="left"){const j=this._getYAxisLabelAlignment(h);k=j.textAlign,v=j.x}else if(s==="right"){const j=this._getYAxisLabelAlignment(h);k=j.textAlign,v=j.x}else if(n==="x"){if(s==="center")w=(t.top+t.bottom)/2+f;else if($(s)){const j=Object.keys(s)[0],z=s[j];w=this.chart.scales[j].getPixelForValue(z)+f}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(s==="center")v=(t.left+t.right)/2-f;else if($(s)){const j=Object.keys(s)[0],z=s[j];v=this.chart.scales[j].getPixelForValue(z)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?G="top":l==="end"&&(G="bottom"));const rt=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){x=a[b],_=x.label;const j=o.setContext(this.getContext(b));S=this.getPixelForTick(b)+o.labelOffset,D=this._resolveTickFontOptions(b),A=D.lineHeight,T=et(_)?_.length:1;const z=T/2,J=j.color,pt=j.textStrokeColor,ut=j.textStrokeWidth;let Oe=k;r?(v=S,k==="inner"&&(b===y-1?Oe=this.options.reverse?"left":"right":b===0?Oe=this.options.reverse?"right":"left":Oe="center"),s==="top"?c==="near"||p!==0?R=-T*A+A/2:c==="center"?R=-rt.highest.height/2-z*A+A:R=-rt.highest.height+A/2:c==="near"||p!==0?R=A/2:c==="center"?R=rt.highest.height/2-z*A:R=rt.highest.height-T*A,u&&(R*=-1),p!==0&&!j.showLabelBackdrop&&(v+=A/2*Math.sin(p))):(w=S,R=(1-T)*A/2);let Pe;if(j.showLabelBackdrop){const me=wt(j.backdropPadding),Mn=rt.heights[b],Re=rt.widths[b];let Cn=R-me.top,Be=0-me.left;switch(G){case"middle":Cn-=Mn/2;break;case"bottom":Cn-=Mn;break}switch(k){case"center":Be-=Re/2;break;case"right":Be-=Re;break;case"inner":b===y-1?Be-=Re:b>0&&(Be-=Re/2);break}Pe={left:Be,top:Cn,width:Re+me.width,height:Mn+me.height,color:j.backdropColor}}m.push({label:_,font:D,textOffset:R,options:{rotation:p,color:J,strokeColor:pt,strokeWidth:ut,textAlign:Oe,textBaseline:G,translation:[v,w],backdrop:Pe}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-zt(this.labelRotation))return t==="top"?"left":"right";let s="center";return n.align==="start"?s="left":n.align==="end"?s="right":n.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:s,padding:o}}=this.options,r=this._getLabelSizes(),a=t+o,l=r.widest.width;let c,d;return n==="left"?s?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?s?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:s,width:o,height:r}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,s,o,r),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const s=this.ticks.findIndex(o=>o.value===t);return s>=0?n.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,r;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(n.display)for(o=0,r=s.length;o<r;++o){const l=s[o];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:i,grid:s}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=He(t,this.left,r)-r/2,d=He(t,this.right,a)+a/2,u=h=l):(u=He(t,this.top,r)-r/2,h=He(t,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&ro(i,s);const o=this.getLabelItems(t);for(const r of o){const a=r.options,l=r.font,c=r.label,d=r.textOffset;Ze(i,c,0,d,l,a)}s&&ao(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:s}}=this;if(!i.display)return;const o=dt(i.font),r=wt(i.padding),a=i.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||$(n)?(l+=r.bottom,et(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=_v(this,l,n,a);Ze(t,i.text,0,0,o,{color:i.color,maxWidth:u,rotation:h,textAlign:xv(a,n,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=O(t.grid&&t.grid.z,-1),s=O(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==en.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let o,r;for(o=0,r=n.length;o<r;++o){const a=n[o];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return dt(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class is{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;Sv(n)&&(i=this.register(n));const s=this.items,o=t.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in s||(s[o]=t,wv(t,r,i),this.override&&nt.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,s=this.scope;i in n&&delete n[i],s&&i in nt[s]&&(delete nt[s][i],this.override&&delete Je[i])}}function wv(e,t,n){const i=_i(Object.create(null),[n?nt.get(n):{},nt.get(t),e.defaults]);nt.set(t,i),e.defaultRoutes&&kv(t,e.defaultRoutes),e.descriptors&&nt.describe(t,e.descriptors)}function kv(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),o=[e].concat(i).join("."),r=t[n].split("."),a=r.pop(),l=r.join(".");nt.route(o,s,l,a)})}function Sv(e){return"id"in e&&"defaults"in e}class Ev{constructor(){this.controllers=new is(Ut,"datasets",!0),this.elements=new is(Vt,"elements"),this.plugins=new is(Object,"plugins"),this.scales=new is(en,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(s=>{const o=i||this._getRegistryForType(s);i||o.isForType(s)||o===this.plugins&&s.id?this._exec(t,o,s):q(s,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,n,i){const s=Kr(t);Z(i["before"+s],[],i),n[t](i),Z(i["after"+s],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const s=n.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var Yt=new Ev;class Iv{constructor(){this._init=void 0}notify(t,n,i,s){if(n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=s?this._descriptors(t).filter(s):this._descriptors(t),r=this._notify(o,t,n,i);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,n,i,s){s=s||{};for(const o of t){const r=o.plugin,a=r[i],l=[n,s,o.options];if(Z(a,l,r)===!1&&s.cancelable)return!1}return!0}invalidate(){N(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,s=O(i.options&&i.options.plugins,{}),o=Dv(i);return s===!1&&!n?[]:Mv(t,o,s,n)}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,s=(o,r)=>o.filter(a=>!r.some(l=>a.plugin.id===l.plugin.id));this._notify(s(n,i),t,"stop"),this._notify(s(i,n),t,"start")}}function Dv(e){const t={},n=[],i=Object.keys(Yt.plugins.items);for(let o=0;o<i.length;o++)n.push(Yt.getPlugin(i[o]));const s=e.plugins||[];for(let o=0;o<s.length;o++){const r=s[o];n.indexOf(r)===-1&&(n.push(r),t[r.id]=!0)}return{plugins:n,localIds:t}}function Tv(e,t){return!t&&e===!1?null:e===!0?{}:e}function Mv(e,{plugins:t,localIds:n},i,s){const o=[],r=e.getContext();for(const a of t){const l=a.id,c=Tv(i[l],s);c!==null&&o.push({plugin:a,options:Cv(e.config,{plugin:a,local:n[l]},c,r)})}return o}function Cv(e,{plugin:t,local:n},i,s){const o=e.pluginScopeKeys(t),r=e.getOptionScopes(i,o);return n&&t.defaults&&r.push(t.defaults),e.createResolver(r,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function pr(e,t){const n=nt.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function Av(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function Lv(e,t){return e===t?"_index_":"_value_"}function Xl(e){if(e==="x"||e==="y"||e==="r")return e}function Ov(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function mr(e,...t){if(Xl(e))return e;for(const n of t){const i=n.axis||Ov(n.position)||e.length>1&&Xl(e[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function Kl(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function Pv(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(i=>i.xAxisID===e||i.yAxisID===e);if(n.length)return Kl(e,"x",n[0])||Kl(e,"y",n[0])}return{}}function Rv(e,t){const n=Je[e.type]||{scales:{}},i=t.scales||{},s=pr(e.type,t),o=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!$(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=mr(r,a,Pv(r,e),nt.scales[a.type]),c=Lv(l,s),d=n.scales||{};o[r]=di(Object.create(null),[{axis:l},a,d[l],d[c]])}),e.data.datasets.forEach(r=>{const a=r.type||e.type,l=r.indexAxis||pr(a,t),d=(Je[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=Av(u,l),f=r[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),di(o[f],[{axis:h},i[f],d[u]])})}),Object.keys(o).forEach(r=>{const a=o[r];di(a,[nt.scales[a.type],nt.scale])}),o}function Au(e){const t=e.options||(e.options={});t.plugins=O(t.plugins,{}),t.scales=Rv(e,t)}function Lu(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function Bv(e){return e=e||{},e.data=Lu(e.data),Au(e),e}const Jl=new Map,Ou=new Set;function ss(e,t){let n=Jl.get(e);return n||(n=t(),Jl.set(e,n),Ou.add(n)),n}const Nn=(e,t,n)=>{const i=Ce(t,n);i!==void 0&&e.add(i)};class Nv{constructor(t){this._config=Bv(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Lu(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Au(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return ss(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return ss(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return ss(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,i=this.type;return ss(`${i}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let s=i.get(t);return(!s||n)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,n,i){const{options:s,type:o}=this,r=this._cachedScopes(t,i),a=r.get(n);if(a)return a;const l=new Set;n.forEach(d=>{t&&(l.add(t),d.forEach(u=>Nn(l,t,u))),d.forEach(u=>Nn(l,s,u)),d.forEach(u=>Nn(l,Je[o]||{},u)),d.forEach(u=>Nn(l,nt,u)),d.forEach(u=>Nn(l,hr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Ou.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:t,type:n}=this;return[t,Je[n]||{},nt.datasets[n]||{},{type:n},nt,hr]}resolveNamedOptions(t,n,i,s=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=Zl(this._resolverCache,t,s);let l=r;if($v(r,n)){o.$shared=!1,i=Ae(i)?i():i;const c=this.createResolver(t,i,a);l=_n(r,i,c)}for(const c of n)o[c]=l[c];return o}createResolver(t,n,i=[""],s){const{resolver:o}=Zl(this._resolverCache,t,i);return $(n)?_n(o,n,void 0,s):o}}function Zl(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let o=i.get(s);return o||(o={resolver:na(t,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,o)),o}const Fv=e=>$(e)&&Object.getOwnPropertyNames(e).some(t=>Ae(e[t]));function $v(e,t){const{isScriptable:n,isIndexable:i}=uu(e);for(const s of t){const o=n(s),r=i(s),a=(r||o)&&e[s];if(o&&(Ae(a)||Fv(a))||r&&et(a))return!0}return!1}var Hv="4.5.1";const jv=["top","bottom","left","right","chartArea"];function Ql(e,t){return e==="top"||e==="bottom"||jv.indexOf(e)===-1&&t==="x"}function tc(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function ec(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Z(n&&n.onComplete,[e],t)}function zv(e){const t=e.chart,n=t.options.animation;Z(n&&n.onProgress,[e],t)}function Pu(e){return oa()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Ds={},nc=e=>{const t=Pu(e);return Object.values(Ds).filter(n=>n.canvas===t).pop()};function Uv(e,t,n){const i=Object.keys(e);for(const s of i){const o=+s;if(o>=t){const r=e[s];delete e[s],(n>0||o>t)&&(e[o+n]=r)}}}function Vv(e,t,n,i){return!n||e.type==="mouseout"?null:i?t:e}class se{static register(...t){Yt.add(...t),ic()}static unregister(...t){Yt.remove(...t),ic()}constructor(t,n){const i=this.config=new Nv(n),s=Pu(t),o=nc(s);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||lv(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,r.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Wb(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new Iv,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=l0(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],Ds[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}te.listen(this,"complete",ec),te.listen(this,"progress",zv),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:s,_aspectRatio:o}=this;return N(t)?n&&o?o:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Yt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():El(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return wl(this.canvas,this.ctx),this}stop(){return te.stop(this),this}resize(t,n){te.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,s=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,t,n,o),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,El(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),Z(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};q(n,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,s=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let o=[];n&&(o=o.concat(Object.keys(n).map(r=>{const a=n[r],l=mr(r,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),q(o,r=>{const a=r.options,l=a.id,c=mr(l,a),d=O(a.type,r.dtype);(a.position===void 0||Ql(a.position,c)!==Ql(r.dposition))&&(a.position=r.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=Yt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),q(s,(r,a)=>{r||delete i[a]}),q(i,r=>{_t.configure(this,r,r.options),_t.addBox(this,r)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((s,o)=>s.index-o.index),i>n){for(let s=n;s<i;++s)this._destroyDatasetMeta(s);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(tc("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,s)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=n.length;i<s;i++){const o=n[i];let r=this.getDatasetMeta(i);const a=o.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=o.indexAxis||pr(a,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=Yt.getController(a),{datasetElementType:c,dataElementType:d}=nt.datasets[a];Object.assign(l,{dataElementType:Yt.getElement(d),datasetElementType:c&&Yt.getElement(c)}),r.controller=new l(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){q(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&o.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),s||q(o,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(tc("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){q(this.scales,t=>{_t.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!fl(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:o}of n){const r=i==="_removeElements"?-o:o;Uv(t,s,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=o=>new Set(t.filter(r=>r[0]===o).map((r,a)=>a+","+r.splice(1).join(","))),s=i(0);for(let o=1;o<n;o++)if(!fl(s,i(o)))return;return Array.from(s).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;_t.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],q(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,o)=>{s._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Ae(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(n),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(te.has(this)?this.attached&&!te.running(this)&&te.start(this):(this.draw(),ec({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let s,o;for(s=0,o=n.length;s<o;++s){const r=n[s];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=wu(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&ro(n,s),t.controller.draw(),s&&ao(n),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return ae(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,s){const o=jy.modes[n];return typeof o=="function"?o(this,t,i,s):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let s=i.filter(o=>o&&o._dataset===n).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Le(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){const i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const s=i?"show":"hide",o=this.getDatasetMeta(t),r=o.controller._resolveAnimations(void 0,s);wi(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(o,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),te.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),wl(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete Ds[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(o,r)=>{n.addEventListener(this,o,r),t[o]=r},s=(o,r,a)=>{o.offsetX=r,o.offsetY=a,this._eventHandler(o)};q(this.options.events,o=>i(o,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(l,c)=>{n.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(n.removeEventListener(this,l,c),delete t[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,s("resize",o),this._stop(),this._resize(0,0),i("attach",a)},n.isAttached(this.canvas)?a():r()}unbindEvents(){q(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},q(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const s=i?"set":"remove";let o,r,a,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){r=t[a];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:o,index:r})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[r],index:r}});!qs(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){const s=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=o(n,t),a=i?t:o(t,n);r.length&&this.updateHoverStyle(r,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},s=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:s=[],options:o}=this,r=n,a=this._getActiveElements(t,s,i,r),l=Jb(t),c=Vv(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Z(o.onHover,[t,a,this],this),l&&Z(o.onClick,[t,a,this],this));const d=!qs(a,s);return(d||n)&&(this._active=a,this._updateHoverStyles(a,s,n)),this._lastEvent=c,d}_getActiveElements(t,n,i,s){if(t.type==="mouseout")return[];if(!i)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,s)}}I(se,"defaults",nt),I(se,"instances",Ds),I(se,"overrides",Je),I(se,"registry",Yt),I(se,"version",Hv),I(se,"getChart",nc);function ic(){return q(se.instances,e=>e._plugins.invalidate())}function Wv(e,t,n){const{startAngle:i,x:s,y:o,outerRadius:r,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/r,xt(i-n));if(e.beginPath(),e.arc(s,o,r-c/2,i+u/2,n-u/2),a>0){const h=Math.min(c/a,xt(i-n));e.arc(s,o,a+c/2,n-h/2,i+h/2,!0)}else{const h=Math.min(c/2,r*xt(i-n));if(d==="round")e.arc(s,o,h,n-V/2,i+V/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(n+V/2)+s,p=-f*Math.sin(n+V/2)+o,m=f*Math.cos(i+V/2)+s,b=f*Math.sin(i+V/2)+o;e.lineTo(g,p),e.lineTo(m,b)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function Yv(e,t,n){const{startAngle:i,pixelMargin:s,x:o,y:r,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(o,r,a,i-c,n+c),l>s?(c=s/l,e.arc(o,r,l,n+c,i-c,!0)):e.arc(o,r,s,n+at,i-at),e.closePath(),e.clip()}function qv(e){return ea(e,["outerStart","outerEnd","innerStart","innerEnd"])}function Gv(e,t,n,i){const s=qv(e.options.borderRadius),o=(n-t)/2,r=Math.min(o,i*t/2),a=l=>{const c=(n-Math.min(o,l))*i/2;return gt(l,0,Math.min(o,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:gt(s.innerStart,0,r),innerEnd:gt(s.innerEnd,0,r)}}function an(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function Qs(e,t,n,i,s,o){const{x:r,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let f=0;const g=s-l;if(i){const j=d>0?d-i:0,z=u>0?u-i:0,J=(j+z)/2,pt=J!==0?g*J/(J+i):g;f=(g-pt)/2}const p=Math.max(.001,g*u-n/V)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:x,outerEnd:_,innerStart:v,innerEnd:w}=Gv(t,h,u,y-b),k=u-x,S=u-_,D=b+x/k,A=y-_/S,T=h+v,R=h+w,G=b+v/T,rt=y-w/R;if(e.beginPath(),o){const j=(D+A)/2;if(e.arc(r,a,u,D,j),e.arc(r,a,u,j,A),_>0){const ut=an(S,A,r,a);e.arc(ut.x,ut.y,_,A,y+at)}const z=an(R,y,r,a);if(e.lineTo(z.x,z.y),w>0){const ut=an(R,rt,r,a);e.arc(ut.x,ut.y,w,y+at,rt+Math.PI)}const J=(y-w/h+(b+v/h))/2;if(e.arc(r,a,h,y-w/h,J,!0),e.arc(r,a,h,J,b+v/h,!0),v>0){const ut=an(T,G,r,a);e.arc(ut.x,ut.y,v,G+Math.PI,b-at)}const pt=an(k,b,r,a);if(e.lineTo(pt.x,pt.y),x>0){const ut=an(k,D,r,a);e.arc(ut.x,ut.y,x,b-at,D)}}else{e.moveTo(r,a);const j=Math.cos(D)*u+r,z=Math.sin(D)*u+a;e.lineTo(j,z);const J=Math.cos(A)*u+r,pt=Math.sin(A)*u+a;e.lineTo(J,pt)}e.closePath()}function Xv(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a}=t;let l=t.endAngle;if(o){Qs(e,t,n,i,l,s);for(let c=0;c<o;++c)e.fill();isNaN(a)||(l=r+(a%Q||Q))}return Qs(e,t,n,i,l,s),e.fill(),l}function Kv(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,g?(e.lineWidth=c*2,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let p=t.endAngle;if(o){Qs(e,t,n,i,p,s);for(let m=0;m<o;++m)e.stroke();isNaN(a)||(p=r+(a%Q||Q))}g&&Yv(e,t,p),l.selfJoin&&p-r>=V&&f===0&&d!=="miter"&&Wv(e,t,p),o||(Qs(e,t,n,i,p,s),e.stroke())}class Gn extends Vt{constructor(n){super();I(this,"circumference");I(this,"endAngle");I(this,"fullCircles");I(this,"innerRadius");I(this,"outerRadius");I(this,"pixelMargin");I(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.getProps(["x","y"],s),{angle:r,distance:a}=eu(o,{x:n,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=O(h,c-l),p=ki(r,l,c)&&l!==c,m=g>=Q||p,b=oe(a,d+f,u+f);return m&&b}getCenterPoint(n){const{x:i,y:s,startAngle:o,endAngle:r,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(o+r)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:i,circumference:s}=this,o=(i.offset||0)/4,r=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>Q?Math.floor(s/Q):0,s===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const c=1-Math.sin(Math.min(V,s||0)),d=o*c;n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,Xv(n,this,d,r,a),Kv(n,this,d,r,a),n.restore()}}I(Gn,"id","arc"),I(Gn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),I(Gn,"defaultRoutes",{backgroundColor:"backgroundColor"}),I(Gn,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function Ru(e,t,n=t){e.lineCap=O(n.borderCapStyle,t.borderCapStyle),e.setLineDash(O(n.borderDash,t.borderDash)),e.lineDashOffset=O(n.borderDashOffset,t.borderDashOffset),e.lineJoin=O(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=O(n.borderWidth,t.borderWidth),e.strokeStyle=O(n.borderColor,t.borderColor)}function Jv(e,t,n){e.lineTo(n.x,n.y)}function Zv(e){return e.stepped?x0:e.tension||e.cubicInterpolationMode==="monotone"?_0:Jv}function Bu(e,t,n={}){const i=e.length,{start:s=0,end:o=i-1}=n,{start:r,end:a}=t,l=Math.max(s,r),c=Math.min(o,a),d=s<r&&o<r||s>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Qv(e,t,n,i){const{points:s,options:o}=t,{count:r,start:a,loop:l,ilen:c}=Bu(s,n,i),d=Zv(o);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%r],!g.skip&&(u?(e.moveTo(g.x,g.y),u=!1):d(e,p,g,h,o.stepped),p=g);return l&&(g=s[(a+(h?c:0))%r],d(e,p,g,h,o.stepped)),!!l}function tx(e,t,n,i){const s=t.points,{count:o,start:r,ilen:a}=Bu(s,n,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=_=>(r+(c?a-_:_))%o,x=()=>{p!==m&&(e.lineTo(d,m),e.lineTo(d,p),e.lineTo(d,b))};for(l&&(f=s[y(0)],e.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const _=f.x,v=f.y,w=_|0;w===g?(v<p?p=v:v>m&&(m=v),d=(u*d+_)/++u):(x(),e.lineTo(_,v),g=w,u=0,p=m=v),b=v}x()}function br(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?tx:Qv}function ex(e){return e.stepped?Q0:e.tension||e.cubicInterpolationMode==="monotone"?ty:We}function nx(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),Ru(e,t.options),e.stroke(s)}function ix(e,t,n,i){const{segments:s,options:o}=t,r=br(t);for(const a of s)Ru(e,o,a.style),e.beginPath(),r(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}const sx=typeof Path2D=="function";function ox(e,t,n,i){sx&&!t.options.segment?nx(e,t,n,i):ix(e,t,n,i)}class Ie extends Vt{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;W0(this._points,i,t,s,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=ry(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){const i=this.options,s=t[n],o=this.points,r=_u(this,{property:n,start:s,end:s});if(!r.length)return;const a=[],l=ex(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=o[u],g=o[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[n])/(g[n]-f[n])),m=l(f,g,p,i.stepped);m[n]=t[n],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,n,i){return br(this)(t,this,n,i)}path(t,n,i){const s=this.segments,o=br(this);let r=this._loop;n=n||0,i=i||this.points.length-n;for(const a of s)r&=o(t,this,a,{start:n,end:n+i-1});return!!r}draw(t,n,i,s){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),ox(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}I(Ie,"id","line"),I(Ie,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),I(Ie,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),I(Ie,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function sc(e,t,n,i){const s=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<s.radius+s.hitRadius}class Ts extends Vt{constructor(n){super();I(this,"parsed");I(this,"skip");I(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.options,{x:r,y:a}=this.getProps(["x","y"],s);return Math.pow(n-r,2)+Math.pow(i-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(n,i){return sc(this,n,"x",i)}inYRange(n,i){return sc(this,n,"y",i)}getCenterPoint(n){const{x:i,y:s}=this.getProps(["x","y"],n);return{x:i,y:s}}size(n){n=n||this.options||{};let i=n.radius||0;i=Math.max(i,i&&n.hoverRadius||0);const s=i&&n.borderWidth||0;return(i+s)*2}draw(n,i){const s=this.options;this.skip||s.radius<.1||!ae(this,i,this.size(s)/2)||(n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.fillStyle=s.backgroundColor,fr(n,s,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}I(Ts,"id","point"),I(Ts,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),I(Ts,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Nu(e,t){const{x:n,y:i,base:s,width:o,height:r}=e.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return e.horizontal?(u=r/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,d=i+u):(u=o/2,a=n-u,l=n+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function De(e,t,n,i){return e?0:gt(t,n,i)}function rx(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,o=du(i);return{t:De(s.top,o.top,0,n),r:De(s.right,o.right,0,t),b:De(s.bottom,o.bottom,0,n),l:De(s.left,o.left,0,t)}}function ax(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,o=Xe(s),r=Math.min(t,n),a=e.borderSkipped,l=i||$(s);return{topLeft:De(!l||a.top||a.left,o.topLeft,0,r),topRight:De(!l||a.top||a.right,o.topRight,0,r),bottomLeft:De(!l||a.bottom||a.left,o.bottomLeft,0,r),bottomRight:De(!l||a.bottom||a.right,o.bottomRight,0,r)}}function lx(e){const t=Nu(e),n=t.right-t.left,i=t.bottom-t.top,s=rx(e,n/2,i/2),o=ax(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,o.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(s.b,s.r))}}}}function Vo(e,t,n,i){const s=t===null,o=n===null,a=e&&!(s&&o)&&Nu(e,i);return a&&(s||oe(t,a.left,a.right))&&(o||oe(n,a.top,a.bottom))}function cx(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function dx(e,t){e.rect(t.x,t.y,t.w,t.h)}function Wo(e,t,n={}){const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,r=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+o,h:e.h+r,radius:e.radius}}class Ms extends Vt{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:s}}=this,{inner:o,outer:r}=lx(this),a=cx(r.radius)?Si:dx;t.save(),(r.w!==o.w||r.h!==o.h)&&(t.beginPath(),a(t,Wo(r,n,o)),t.clip(),a(t,Wo(o,-n,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Wo(o,n)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,n,i){return Vo(this,t,n,i)}inXRange(t,n){return Vo(this,t,null,n)}inYRange(t,n){return Vo(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:s,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+s)/2:n,y:o?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}I(Ms,"id","bar"),I(Ms,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),I(Ms,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var ux=Object.freeze({__proto__:null,ArcElement:Gn,BarElement:Ms,LineElement:Ie,PointElement:Ts});const yr=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],oc=yr.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function Fu(e){return yr[e%yr.length]}function $u(e){return oc[e%oc.length]}function hx(e,t){return e.borderColor=Fu(t),e.backgroundColor=$u(t),++t}function fx(e,t){return e.backgroundColor=e.data.map(()=>Fu(t++)),t}function gx(e,t){return e.backgroundColor=e.data.map(()=>$u(t++)),t}function px(e){let t=0;return(n,i)=>{const s=e.getDatasetMeta(i).controller;s instanceof qe?t=fx(n,t):s instanceof gi?t=gx(n,t):s&&(t=hx(n,t))}}function rc(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function mx(e){return e&&(e.borderColor||e.backgroundColor)}function bx(){return nt.borderColor!=="rgba(0,0,0,0.1)"||nt.backgroundColor!=="rgba(0,0,0,0.1)"}var yx={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:s}=e.config,{elements:o}=s,r=rc(i)||mx(s)||o&&rc(o)||bx();if(!n.forceOverride&&r)return;const a=px(e);i.forEach(a)}};function vx(e,t,n,i,s){const o=s.samples||i;if(o>=n)return e.slice(t,t+n);const r=[],a=(n-2)/(o-2);let l=0;const c=t+n-1;let d=t,u,h,f,g,p;for(r[l++]=e[d],u=0;u<o-2;u++){let m=0,b=0,y;const x=Math.floor((u+1)*a)+1+t,_=Math.min(Math.floor((u+2)*a)+1,n)+t,v=_-x;for(y=x;y<_;y++)m+=e[y].x,b+=e[y].y;m/=v,b/=v;const w=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,n)+t,{x:S,y:D}=e[d];for(f=g=-1,y=w;y<k;y++)g=.5*Math.abs((S-m)*(e[y].y-D)-(S-e[y].x)*(b-D)),g>f&&(f=g,h=e[y],p=y);r[l++]=h,d=p}return r[l++]=e[c],r}function xx(e,t,n,i){let s=0,o=0,r,a,l,c,d,u,h,f,g,p;const m=[],b=t+n-1,y=e[t].x,_=e[b].x-y;for(r=t;r<t+n;++r){a=e[r],l=(a.x-y)/_*i,c=a.y;const v=l|0;if(v===d)c<g?(g=c,u=r):c>p&&(p=c,h=r),s=(o*s+a.x)/++o;else{const w=r-1;if(!N(u)&&!N(h)){const k=Math.min(u,h),S=Math.max(u,h);k!==f&&k!==w&&m.push({...e[k],x:s}),S!==f&&S!==w&&m.push({...e[S],x:s})}r>0&&w!==f&&m.push(e[w]),m.push(a),d=v,o=0,g=p=c,u=h=f=r}}return m}function Hu(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function ac(e){e.data.datasets.forEach(t=>{Hu(t)})}function _x(e,t){const n=t.length;let i=0,s;const{iScale:o}=e,{min:r,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=gt(re(t,o.axis,r).lo,0,n-1)),c?s=gt(re(t,o.axis,a).hi+1,i,n)-i:s=n-i,{start:i,count:s}}var wx={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){ac(e);return}const i=e.width;e.data.datasets.forEach((s,o)=>{const{_data:r,indexAxis:a}=s,l=e.getDatasetMeta(o),c=r||s.data;if(Yn([a,e.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=e.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||e.options.parsing)return;let{start:u,count:h}=_x(l,c);const f=n.threshold||4*i;if(h<=f){Hu(s);return}N(r)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(n.algorithm){case"lttb":g=vx(c,u,h,i,n);break;case"min-max":g=xx(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}s._decimated=g})},destroy(e){ac(e)}};function kx(e,t,n){const i=e.segments,s=e.points,o=t.points,r=[];for(const a of i){let{start:l,end:c}=a;c=uo(l,c,s);const d=vr(n,s[l],s[c],a.loop);if(!t.segments){r.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=_u(t,d);for(const h of u){const f=vr(n,o[h.start],o[h.end],h.loop),g=xu(a,s,f);for(const p of g)r.push({source:p,target:h,start:{[n]:lc(d,f,"start",Math.max)},end:{[n]:lc(d,f,"end",Math.min)}})}}return r}function vr(e,t,n,i){if(i)return;let s=t[e],o=n[e];return e==="angle"&&(s=xt(s),o=xt(o)),{property:e,start:s,end:o}}function Sx(e,t){const{x:n=null,y:i=null}=e||{},s=t.points,o=[];return t.segments.forEach(({start:r,end:a})=>{a=uo(r,a,s);const l=s[r],c=s[a];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):n!==null&&(o.push({x:n,y:l.y}),o.push({x:n,y:c.y}))}),o}function uo(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function lc(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function ju(e,t){let n=[],i=!1;return et(e)?(i=!0,n=e):n=Sx(e,t),n.length?new Ie({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function cc(e){return e&&e.fill!==!1}function Ex(e,t,n){let s=e[t].fill;const o=[t];let r;if(!n)return s;for(;s!==!1&&o.indexOf(s)===-1;){if(!ot(s))return s;if(r=e[s],!r)return!1;if(r.visible)return s;o.push(s),s=r.fill}return!1}function Ix(e,t,n){const i=Cx(e);if($(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return ot(s)&&Math.floor(s)===s?Dx(i[0],t,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Dx(e,t,n,i){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=i?!1:n}function Tx(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:$(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function Mx(e,t,n){let i;return e==="start"?i=n:e==="end"?i=t.options.reverse?t.min:t.max:$(e)?i=e.value:i=t.getBaseValue(),i}function Cx(e){const t=e.options,n=t.fill;let i=O(n&&n.target,n);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Ax(e){const{scale:t,index:n,line:i}=e,s=[],o=i.segments,r=i.points,a=Lx(t,n);a.push(ju({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)Ox(s,r[d],a)}return new Ie({points:s,options:{}})}function Lx(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const o=i[s];if(o.index===t)break;o.hidden||n.unshift(o.dataset)}return n}function Ox(e,t,n){const i=[];for(let s=0;s<n.length;s++){const o=n[s],{first:r,last:a,point:l}=Px(o,t,"x");if(!(!l||r&&a)){if(r)i.unshift(l);else if(e.push(l),!a)break}}e.push(...i)}function Px(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const s=i[n],o=e.segments,r=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],u=r[d.start][n],h=r[d.end][n];if(oe(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class zu{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:s,y:o,radius:r}=this;return n=n||{start:0,end:Q},t.arc(s,o,r,n.end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:s}=this,o=t.angle;return{x:n+Math.cos(o)*s,y:i+Math.sin(o)*s,angle:o}}}function Rx(e){const{chart:t,fill:n,line:i}=e;if(ot(n))return Bx(t,n);if(n==="stack")return Ax(e);if(n==="shape")return!0;const s=Nx(e);return s instanceof zu?s:ju(s,i)}function Bx(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function Nx(e){return(e.scale||{}).getPointPositionForValue?$x(e):Fx(e)}function Fx(e){const{scale:t={},fill:n}=e,i=Tx(n,t);if(ot(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function $x(e){const{scale:t,fill:n}=e,i=t.options,s=t.getLabels().length,o=i.reverse?t.max:t.min,r=Mx(n,t,o),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,o);return new zu({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(r)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,r));return a}function Yo(e,t,n){const i=Rx(t),{chart:s,index:o,line:r,scale:a,axis:l}=t,c=r.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(o),p=wu(s,g);i&&r.points.length&&(ro(e,n),Hx(e,{line:r,target:i,above:h,below:f,area:n,scale:a,axis:l,clip:p}),ao(e))}function Hx(e,t){const{line:n,target:i,above:s,below:o,area:r,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let d=o;o!==s&&(c==="x"?(dc(e,i,r.top),qo(e,{line:n,target:i,color:s,scale:a,property:c,clip:l}),e.restore(),e.save(),dc(e,i,r.bottom)):c==="y"&&(uc(e,i,r.left),qo(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),uc(e,i,r.right),d=s)),qo(e,{line:n,target:i,color:d,scale:a,property:c,clip:l}),e.restore()}function dc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[uo(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(d.x,n),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function uc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[uo(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(n,d.y),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function qo(e,t){const{line:n,target:i,property:s,color:o,scale:r,clip:a}=t,l=kx(n,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=o}={}}=c,g=i!==!0;e.save(),e.fillStyle=f,jx(e,r,a,g&&vr(s,u,h)),e.beginPath();const p=!!n.pathSegment(e,c);let m;if(g){p?e.closePath():hc(e,i,h,s);const b=!!i.pathSegment(e,d,{move:p,reverse:!0});m=p&&b,m||hc(e,i,u,s)}e.closePath(),e.fill(m?"evenodd":"nonzero"),e.restore()}}function jx(e,t,n,i){const s=t.chart.chartArea,{property:o,start:r,end:a}=i||{};if(o==="x"||o==="y"){let l,c,d,u;o==="x"?(l=r,c=s.top,d=a,u=s.bottom):(l=s.left,c=r,d=s.right,u=a),e.beginPath(),n&&(l=Math.max(l,n.left),d=Math.min(d,n.right),c=Math.max(c,n.top),u=Math.min(u,n.bottom)),e.rect(l,c,d-l,u-c),e.clip()}}function hc(e,t,n,i){const s=t.interpolate(n,i);s&&e.lineTo(s.x,s.y)}var zx={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,s=[];let o,r,a,l;for(r=0;r<i;++r)o=e.getDatasetMeta(r),a=o.dataset,l=null,a&&a.options&&a instanceof Ie&&(l={visible:e.isDatasetVisible(r),index:r,fill:Ix(a,r,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,s.push(l);for(r=0;r<i;++r)l=s[r],!(!l||l.fill===!1)&&(l.fill=Ex(s,r,n.propagate))},beforeDraw(e,t,n){const i=n.drawTime==="beforeDraw",s=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let r=s.length-1;r>=0;--r){const a=s[r].$filler;a&&(a.line.updateControlPoints(o,a.axis),i&&a.fill&&Yo(e.ctx,a,o))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const i=e.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const o=i[s].$filler;cc(o)&&Yo(e.ctx,o,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!cc(i)||n.drawTime!=="beforeDatasetDraw"||Yo(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const fc=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}},Ux=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class gc extends Vt{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Z(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=dt(i.font),o=s.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=fc(i,o);let c,d;n.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,a,l)+10):(d=this.maxHeight,c=this._fitCols(r,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,s){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+n/2+o.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>r)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,n,i,s){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:x}=Vx(i,n,o,m,s);b>0&&f+x+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:x},h=Math.max(h,y),f+=x+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:s},rtl:o}}=this,r=mn(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=vt(i,this.left+s,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=vt(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+s}else{let a=0,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;ro(t,this),this._draw(),ao(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:s}=this,{align:o,labels:r}=t,a=nt.color,l=mn(t.rtl,this.left,this.width),c=dt(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=fc(r,u),b=function(w,k,S){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const D=O(S.lineWidth,1);if(s.fillStyle=O(S.fillStyle,a),s.lineCap=O(S.lineCap,"butt"),s.lineDashOffset=O(S.lineDashOffset,0),s.lineJoin=O(S.lineJoin,"miter"),s.lineWidth=D,s.strokeStyle=O(S.strokeStyle,a),s.setLineDash(O(S.lineDash,[])),r.usePointStyle){const A={radius:p*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:D},T=l.xPlus(w,g/2),R=k+h;cu(s,A,T,R,r.pointStyleWidth&&g)}else{const A=k+Math.max((u-p)/2,0),T=l.leftForLtr(w,g),R=Xe(S.borderRadius);s.beginPath(),Object.values(R).some(G=>G!==0)?Si(s,{x:T,y:A,w:g,h:p,radius:R}):s.rect(T,A,g,p),s.fill(),D!==0&&s.stroke()}s.restore()},y=function(w,k,S){Ze(s,S.text,w,k+m/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},x=this.isHorizontal(),_=this._computeTitleHeight();x?f={x:vt(o,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:f={x:this.left+d,y:vt(o,this.top+_+d,this.bottom-n[0].height),line:0},bu(this.ctx,t.textDirection);const v=m+d;this.legendItems.forEach((w,k)=>{s.strokeStyle=w.fontColor,s.fillStyle=w.fontColor;const S=s.measureText(w.text).width,D=l.textAlign(w.textAlign||(w.textAlign=r.textAlign)),A=g+h+S;let T=f.x,R=f.y;l.setWidth(this.width),x?k>0&&T+A+d>this.right&&(R=f.y+=v,f.line++,T=f.x=vt(o,this.left+d,this.right-i[f.line])):k>0&&R+v>this.bottom&&(T=f.x=T+n[f.line].width+d,f.line++,R=f.y=vt(o,this.top+_+d,this.bottom-n[f.line].height));const G=l.x(T);if(b(G,R,w),T=c0(D,T+g+h,x?T+A:this.right,t.rtl),y(l.x(T),R,w),x)f.x+=A+d;else if(typeof w.text!="string"){const rt=c.lineHeight;f.y+=Uu(w,rt)+d}else f.y+=v}),yu(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=dt(n.font),s=wt(n.padding);if(!n.display)return;const o=mn(t.rtl,this.left,this.width),r=this.ctx,a=n.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=vt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+vt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=vt(a,u,u+h);r.textAlign=o.textAlign(Qr(a)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=i.string,Ze(r,n.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,n=dt(t.font),i=wt(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,s,o;if(oe(t,this.left,this.right)&&oe(n,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(s=o[i],oe(t,s.left,s.left+s.width)&&oe(n,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const n=this.options;if(!qx(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,o=Ux(s,i);s&&!o&&Z(n.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!o&&Z(n.onHover,[t,i,this],this)}else i&&Z(n.onClick,[t,i,this],this)}}function Vx(e,t,n,i,s){const o=Wx(i,e,t,n),r=Yx(s,i,t.lineHeight);return{itemWidth:o,itemHeight:r}}function Wx(e,t,n,i){let s=e.text;return s&&typeof s!="string"&&(s=s.reduce((o,r)=>o.length>r.length?o:r)),t+n.size/2+i.measureText(s).width}function Yx(e,t,n){let i=e;return typeof t.text!="string"&&(i=Uu(t,n)),i}function Uu(e,t){const n=e.text?e.text.length:0;return t*n}function qx(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var Gx={id:"legend",_element:gc,start(e,t,n){const i=e.legend=new gc({ctx:e.ctx,options:n,chart:e});_t.configure(e,i,n),_t.addBox(e,i)},stop(e){_t.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;_t.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=wt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:r&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class la extends Vt{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const s=et(i.text)?i.text.length:1;this._padding=wt(i.padding);const o=s*dt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:i,bottom:s,right:o,options:r}=this,a=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=vt(a,i,o),u=n+t,c=o-i):(r.position==="left"?(d=i+t,u=vt(a,s,n),l=V*-.5):(d=o-t,u=vt(a,n,s),l=V*.5),c=s-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=dt(n.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(o);Ze(t,n.text,0,0,i,{color:n.color,maxWidth:l,rotation:c,textAlign:Qr(n.align),textBaseline:"middle",translation:[r,a]})}}function Xx(e,t){const n=new la({ctx:e.ctx,options:t,chart:e});_t.configure(e,n,t),_t.addBox(e,n),e.titleBlock=n}var Kx={id:"title",_element:la,start(e,t,n){Xx(e,n)},stop(e){const t=e.titleBlock;_t.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;_t.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const os=new WeakMap;var Jx={id:"subtitle",start(e,t,n){const i=new la({ctx:e.ctx,options:n,chart:e});_t.configure(e,i,n),_t.addBox(e,i),os.set(e,i)},stop(e){_t.removeBox(e,os.get(e)),os.delete(e)},beforeUpdate(e,t,n){const i=os.get(e);_t.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Xn={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,o=0;for(t=0,n=e.length;t<n;++t){const a=e[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,i=t.y,s=Number.POSITIVE_INFINITY,o,r,a;for(o=0,r=e.length;o<r;++o){const l=e[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=ur(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,i=l.y}return{x:n,y:i}}};function Wt(e,t){return t&&(et(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function ee(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function Zx(e,t){const{element:n,datasetIndex:i,index:s}=t,o=e.getDatasetMeta(i).controller,{label:r,value:a}=o.getLabelAndValue(s);return{chart:e,label:r,parsed:o.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:o.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function pc(e,t){const n=e.chart.ctx,{body:i,footer:s,title:o}=e,{boxWidth:r,boxHeight:a}=t,l=dt(t.bodyFont),c=dt(t.titleFont),d=dt(t.footerFont),u=o.length,h=s.length,f=i.length,g=wt(t.padding);let p=g.height,m=0,b=i.reduce((_,v)=>_+v.before.length+v.lines.length+v.after.length,0);if(b+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*_+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const x=function(_){m=Math.max(m,n.measureText(_).width+y)};return n.save(),n.font=c.string,q(e.title,x),n.font=l.string,q(e.beforeBody.concat(e.afterBody),x),y=t.displayColors?r+2+t.boxPadding:0,q(i,_=>{q(_.before,x),q(_.lines,x),q(_.after,x)}),y=0,n.font=d.string,q(e.footer,x),n.restore(),m+=g.width,{width:m,height:p}}function Qx(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}function t_(e,t,n,i){const{x:s,width:o}=i,r=n.caretSize+n.caretPadding;if(e==="left"&&s+o+r>t.width||e==="right"&&s-o-r<0)return!0}function e_(e,t,n,i){const{x:s,width:o}=n,{width:r,chartArea:{left:a,right:l}}=e;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=o/2?c="left":s>=r-o/2&&(c="right"),t_(c,e,t,n)&&(c="center"),c}function mc(e,t,n){const i=n.yAlign||t.yAlign||Qx(e,n);return{xAlign:n.xAlign||t.xAlign||e_(e,t,n,i),yAlign:i}}function n_(e,t){let{x:n,width:i}=e;return t==="right"?n-=i:t==="center"&&(n-=i/2),n}function i_(e,t,n){let{y:i,height:s}=e;return t==="top"?i+=n:t==="bottom"?i-=s+n:i-=s/2,i}function bc(e,t,n,i){const{caretSize:s,caretPadding:o,cornerRadius:r}=e,{xAlign:a,yAlign:l}=n,c=s+o,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=Xe(r);let g=n_(t,a);const p=i_(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:gt(g,0,i.width-t.width),y:gt(p,0,i.height-t.height)}}function rs(e,t,n){const i=wt(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-i.right:e.x+i.left}function yc(e){return Wt([],ee(e))}function s_(e,t,n){return Le(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function vc(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Vu={beforeTitle:Qt,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Qt,beforeBody:Qt,beforeLabel:Qt,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return N(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Qt,afterBody:Qt,beforeFooter:Qt,footer:Qt,afterFooter:Qt};function Et(e,t,n,i){const s=e[t].call(n,i);return typeof s>"u"?Vu[t].call(n,i):s}class xr extends Vt{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&n.options.animation&&i.animations,o=new ku(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=s_(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:i}=n,s=Et(i,"beforeTitle",this,t),o=Et(i,"title",this,t),r=Et(i,"afterTitle",this,t);let a=[];return a=Wt(a,ee(s)),a=Wt(a,ee(o)),a=Wt(a,ee(r)),a}getBeforeBody(t,n){return yc(Et(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:i}=n,s=[];return q(t,o=>{const r={before:[],lines:[],after:[]},a=vc(i,o);Wt(r.before,ee(Et(a,"beforeLabel",this,o))),Wt(r.lines,Et(a,"label",this,o)),Wt(r.after,ee(Et(a,"afterLabel",this,o))),s.push(r)}),s}getAfterBody(t,n){return yc(Et(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:i}=n,s=Et(i,"beforeFooter",this,t),o=Et(i,"footer",this,t),r=Et(i,"afterFooter",this,t);let a=[];return a=Wt(a,ee(s)),a=Wt(a,ee(o)),a=Wt(a,ee(r)),a}_createItems(t){const n=this._active,i=this.chart.data,s=[],o=[],r=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(Zx(this.chart,n[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),q(a,d=>{const u=vc(t.callbacks,d);s.push(Et(u,"labelColor",this,d)),o.push(Et(u,"labelPointStyle",this,d)),r.push(Et(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=a,a}update(t,n){const i=this.options.setContext(this.getContext()),s=this._active;let o,r=[];if(!s.length)this.opacity!==0&&(o={opacity:0});else{const a=Xn[i.position].call(this,s,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=pc(this,i),c=Object.assign({},a,l),d=mc(this.chart,i,c),u=bc(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,s){const o=this.getCaretPosition(t,i,s);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){const{xAlign:s,yAlign:o}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=Xe(a),{x:h,y:f}=t,{width:g,height:p}=n;let m,b,y,x,_,v;return o==="center"?(_=f+p/2,s==="left"?(m=h,b=m-r,x=_+r,v=_-r):(m=h+g,b=m+r,x=_-r,v=_+r),y=m):(s==="left"?b=h+Math.max(l,d)+r:s==="right"?b=h+g-Math.max(c,u)-r:b=this.caretX,o==="top"?(x=f,_=x-r,m=b-r,y=b+r):(x=f+p,_=x+r,m=b+r,y=b-r),v=x),{x1:m,x2:b,x3:y,y1:x,y2:_,y3:v}}drawTitle(t,n,i){const s=this.title,o=s.length;let r,a,l;if(o){const c=mn(i.rtl,this.x,this.width);for(t.x=rs(this,i.titleAlign,i),n.textAlign=c.textAlign(i.titleAlign),n.textBaseline="middle",r=dt(i.titleFont),a=i.titleSpacing,n.fillStyle=i.titleColor,n.font=r.string,l=0;l<o;++l)n.fillText(s[l],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,l+1===o&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,n,i,s,o){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=dt(o.bodyFont),u=rs(this,"left",o),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=n.y+f;if(o.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,fr(t,p,m,b),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,fr(t,p,m,b)}else{t.lineWidth=$(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=Xe(r.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,Si(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),Si(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=r.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){const{body:s}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=dt(i.bodyFont);let h=u.lineHeight,f=0;const g=mn(i.rtl,this.x,this.width),p=function(S){n.fillText(S,g.x(t.x+f),t.y+h/2),t.y+=h+o},m=g.textAlign(r);let b,y,x,_,v,w,k;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,t.x=rs(this,m,i),n.fillStyle=i.bodyColor,q(this.beforeBody,p),f=a&&m!=="right"?r==="center"?c/2+d:c+2+d:0,_=0,w=s.length;_<w;++_){for(b=s[_],y=this.labelTextColors[_],n.fillStyle=y,q(b.before,p),x=b.lines,a&&x.length&&(this._drawColorBox(n,t,_,g,i),h=Math.max(u.lineHeight,l)),v=0,k=x.length;v<k;++v)p(x[v]),h=u.lineHeight;q(b.after,p)}f=0,h=u.lineHeight,q(this.afterBody,p),t.y-=o}drawFooter(t,n,i){const s=this.footer,o=s.length;let r,a;if(o){const l=mn(i.rtl,this.x,this.width);for(t.x=rs(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=l.textAlign(i.footerAlign),n.textBaseline="middle",r=dt(i.footerFont),n.fillStyle=i.footerColor,n.font=r.string,a=0;a<o;++a)n.fillText(s[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,n,i,s){const{xAlign:o,yAlign:r}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=Xe(s.cornerRadius);n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.beginPath(),n.moveTo(a+u,l),r==="top"&&this.drawCaret(t,n,i,s),n.lineTo(a+c-h,l),n.quadraticCurveTo(a+c,l,a+c,l+h),r==="center"&&o==="right"&&this.drawCaret(t,n,i,s),n.lineTo(a+c,l+d-g),n.quadraticCurveTo(a+c,l+d,a+c-g,l+d),r==="bottom"&&this.drawCaret(t,n,i,s),n.lineTo(a+f,l+d),n.quadraticCurveTo(a,l+d,a,l+d-f),r==="center"&&o==="left"&&this.drawCaret(t,n,i,s),n.lineTo(a,l+u),n.quadraticCurveTo(a,l,a+u,l),n.closePath(),n.fill(),s.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,i=this.$animations,s=i&&i.x,o=i&&i.y;if(s||o){const r=Xn[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=pc(this,t),l=Object.assign({},r,this._size),c=mc(n,t,l),d=bc(t,l,c,n);(s._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(n);const s={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=wt(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,s,n),bu(t,n.textDirection),o.y+=r.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),yu(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),o=!qs(i,s),r=this._positionChanged(s,n);(o||r)&&(this._active=s,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,o=this._active||[],r=this._getActiveElements(t,o,n,i),a=this._positionChanged(r,t),l=n||!qs(r,o)||a;return l&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,i,s){const o=this.options;if(t.type==="mouseout")return[];if(!s)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(t,n){const{caretX:i,caretY:s,options:o}=this,r=Xn[o.position].call(this,t,n);return r!==!1&&(i!==r.x||s!==r.y)}}I(xr,"positioners",Xn);var o_={id:"tooltip",_element:xr,positioners:Xn,afterInit(e,t,n){n&&(e.tooltip=new xr({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Vu},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},r_=Object.freeze({__proto__:null,Colors:yx,Decimation:wx,Filler:zx,Legend:Gx,SubTitle:Jx,Title:Kx,Tooltip:o_});const a_=(e,t,n,i)=>(typeof t=="string"?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function l_(e,t,n,i){const s=e.indexOf(t);if(s===-1)return a_(e,t,n,i);const o=e.lastIndexOf(t);return s!==o?n:s}const c_=(e,t)=>e===null?null:gt(Math.round(e),0,t);function xc(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class _r extends en{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:s,label:o}of n)i[s]===o&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(N(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:l_(i,t,O(n,t),this._addedLabels),c_(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,s=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=n;r++)s.push({value:r});return s}getLabelForValue(t){return xc.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}I(_r,"id","category"),I(_r,"defaults",{ticks:{callback:xc}});function d_(e,t){const n=[],{bounds:s,step:o,min:r,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=e,f=o||1,g=d-1,{min:p,max:m}=t,b=!N(r),y=!N(a),x=!N(c),_=(m-p)/(u+1);let v=pl((m-p)/g/f)*f,w,k,S,D;if(v<1e-14&&!b&&!y)return[{value:p},{value:m}];D=Math.ceil(m/v)-Math.floor(p/v),D>g&&(v=pl(D*v/g/f)*f),N(l)||(w=Math.pow(10,l),v=Math.ceil(v*w)/w),s==="ticks"?(k=Math.floor(p/v)*v,S=Math.ceil(m/v)*v):(k=p,S=m),b&&y&&o&&n0((a-r)/o,v/1e3)?(D=Math.round(Math.min((a-r)/v,d)),v=(a-r)/D,k=r,S=a):x?(k=b?r:k,S=y?a:S,D=c-1,v=(S-k)/D):(D=(S-k)/v,ui(D,Math.round(D),v/1e3)?D=Math.round(D):D=Math.ceil(D));const A=Math.max(ml(v),ml(k));w=Math.pow(10,N(l)?A:l),k=Math.round(k*w)/w,S=Math.round(S*w)/w;let T=0;for(b&&(h&&k!==r?(n.push({value:r}),k<r&&T++,ui(Math.round((k+T*v)*w)/w,r,_c(r,_,e))&&T++):k<r&&T++);T<D;++T){const R=Math.round((k+T*v)*w)/w;if(y&&R>a)break;n.push({value:R})}return y&&h&&S!==a?n.length&&ui(n[n.length-1].value,a,_c(a,_,e))?n[n.length-1].value=a:n.push({value:a}):(!y||S===a)&&n.push({value:S}),n}function _c(e,t,{horizontal:n,minRotation:i}){const s=zt(i),o=(n?Math.sin(s):Math.cos(s))||.001,r=.75*t*(""+e).length;return Math.min(t/o,r)}class to extends en{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return N(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:s,max:o}=this;const r=l=>s=n?s:l,a=l=>o=i?o:l;if(t){const l=Xt(s),c=Xt(o);l<0&&c<0?a(0):l>0&&c>0&&r(0)}if(s===o){let l=o===0?1:Math.abs(o*.05);a(o+l),t||r(s-l)}this.min=s,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),n=n||11),n&&(s=Math.min(n,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,r=d_(s,o);return t.bounds==="ticks"&&tu(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-n)/Math.max(t.length-1,1)/2;n-=s,i+=s}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return Ni(t,this.chart.options.locale,this.options.ticks.format)}}class wr extends to{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=ot(t)?t:0,this.max=ot(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=zt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}I(wr,"id","linear"),I(wr,"defaults",{ticks:{callback:oo.formatters.numeric}});const Ii=e=>Math.floor(Se(e)),ze=(e,t)=>Math.pow(10,Ii(e)+t);function wc(e){return e/Math.pow(10,Ii(e))===1}function kc(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function u_(e,t){const n=t-e;let i=Ii(n);for(;kc(e,t,i)>10;)i++;for(;kc(e,t,i)<10;)i--;return Math.min(i,Ii(e))}function h_(e,{min:t,max:n}){t=Lt(e.min,t);const i=[],s=Ii(t);let o=u_(t,n),r=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=s>o?Math.pow(10,s):0,c=Math.round((t-l)*r)/r,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,o)),h=Lt(e.min,Math.round((l+d+u*Math.pow(10,o))*r)/r);for(;h<n;)i.push({value:h,major:wc(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,r=o>=0?1:r),h=Math.round((l+d+u*Math.pow(10,o))*r)/r;const f=Lt(e.max,h);return i.push({value:f,major:wc(f),significand:u}),i}class kr extends en{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=to.prototype.parse.apply(this,[t,n]);if(i===0){this._zero=!0;return}return ot(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=ot(t)?Math.max(0,t):null,this.max=ot(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ot(this._userMin)&&(this.min=t===ze(this.min,0)?ze(this.min,-1):ze(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,s=this.max;const o=a=>i=t?i:a,r=a=>s=n?s:a;i===s&&(i<=0?(o(1),r(10)):(o(ze(i,-1)),r(ze(s,1)))),i<=0&&o(ze(s,-1)),s<=0&&r(ze(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},i=h_(n,this);return t.bounds==="ticks"&&tu(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Ni(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Se(t),this._valueRange=Se(this.max)-Se(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Se(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}I(kr,"id","logarithmic"),I(kr,"defaults",{ticks:{callback:oo.formatters.logarithmic,major:{enabled:!0}}});function Sr(e){const t=e.ticks;if(t.display&&e.display){const n=wt(t.backdropPadding);return O(t.font&&t.font.size,nt.font.size)+n.height}return 0}function f_(e,t,n){return n=et(n)?n:[n],{w:v0(e,t.string,n),h:n.length*t.lineHeight}}function Sc(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function g_(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],o=e._pointLabels.length,r=e.options.pointLabels,a=r.centerPointLabels?V/o:0;for(let l=0;l<o;l++){const c=r.setContext(e.getPointLabelContext(l));s[l]=c.padding;const d=e.getPointPosition(l,e.drawingArea+s[l],a),u=dt(c.font),h=f_(e.ctx,u,e._pointLabels[l]);i[l]=h;const f=xt(e.getIndexAngle(l)+a),g=Math.round(Jr(f)),p=Sc(g,d.x,h.w,0,180),m=Sc(g,d.y,h.h,90,270);p_(n,t,f,p,m)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=y_(e,i,s)}function p_(e,t,n,i,s){const o=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/o,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/r,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/r,e.b=Math.max(e.b,t.b+l))}function m_(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:o,padding:r,size:a}=n,l=e.getPointPosition(t,i+s+r,o),c=Math.round(Jr(xt(l.angle+at))),d=__(l.y,a.h,c),u=v_(c),h=x_(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function b_(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:o}=e;return!(ae({x:n,y:i},t)||ae({x:n,y:o},t)||ae({x:s,y:i},t)||ae({x:s,y:o},t))}function y_(e,t,n){const i=[],s=e._pointLabels.length,o=e.options,{centerPointLabels:r,display:a}=o.pointLabels,l={extra:Sr(o)/2,additionalAngle:r?V/s:0};let c;for(let d=0;d<s;d++){l.padding=n[d],l.size=t[d];const u=m_(e,d,l);i.push(u),a==="auto"&&(u.visible=b_(u,c),u.visible&&(c=u))}return i}function v_(e){return e===0||e===180?"center":e<180?"left":"right"}function x_(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function __(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function w_(e,t,n){const{left:i,top:s,right:o,bottom:r}=n,{backdropColor:a}=t;if(!N(a)){const l=Xe(t.borderRadius),c=wt(t.backdropPadding);e.fillStyle=a;const d=i-c.left,u=s-c.top,h=o-i+c.width,f=r-s+c.height;Object.values(l).some(g=>g!==0)?(e.beginPath(),Si(e,{x:d,y:u,w:h,h:f,radius:l}),e.fill()):e.fillRect(d,u,h,f)}}function k_(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const o=e._pointLabelItems[s];if(!o.visible)continue;const r=i.setContext(e.getPointLabelContext(s));w_(n,r,o);const a=dt(r.font),{x:l,y:c,textAlign:d}=o;Ze(n,e._pointLabels[s],l,c+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function Wu(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,Q);else{let o=e.getPointPosition(0,t);s.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=e.getPointPosition(r,t),s.lineTo(o.x,o.y)}}function S_(e,t,n,i,s){const o=e.ctx,r=t.circular,{color:a,lineWidth:l}=t;!r&&!i||!a||!l||n<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(s.dash||[]),o.lineDashOffset=s.dashOffset,o.beginPath(),Wu(e,n,r,i),o.closePath(),o.stroke(),o.restore())}function E_(e,t,n){return Le(e,{label:n,index:t,type:"pointLabel"})}class Kn extends to{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=wt(Sr(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=ot(t)&&!isNaN(t)?t:0,this.max=ot(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Sr(this.options))}generateTickLabels(t){to.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const s=Z(this.options.pointLabels.callback,[n,i],this);return s||s===0?s:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?g_(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,s){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,s))}getIndexAngle(t){const n=Q/(this._pointLabels.length||1),i=this.options.startAngle||0;return xt(t*n+zt(i))}getDistanceFromCenterForValue(t){if(N(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(N(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return E_(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const s=this.getIndexAngle(t)-at+i;return{x:Math.cos(s)*n+this.xCenter,y:Math.sin(s)*n+this.yCenter,angle:s}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:s,bottom:o}=this._pointLabelItems[t];return{left:n,top:i,right:s,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Wu(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:s,border:o}=n,r=this._pointLabels.length;let a,l,c;if(n.pointLabels.display&&k_(this,r),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=o.setContext(h);S_(this,f,l,r,g)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let o,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const c=i.setContext(this.getContext(l)),d=dt(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=wt(c.backdropPadding);t.fillRect(-r/2-u.left,-o-d.size/2-u.top,r+u.width,d.size+u.height)}Ze(t,a.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}I(Kn,"id","radialLinear"),I(Kn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:oo.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),I(Kn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),I(Kn,"descriptors",{angleLines:{_fallback:"grid"}});const ho={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Tt=Object.keys(ho);function Ec(e,t){return e-t}function Ic(e,t){if(N(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:o}=e._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),ot(r)||(r=typeof i=="string"?n.parse(r,i):n.parse(r)),r===null?null:(s&&(r=s==="week"&&(xn(o)||o===!0)?n.startOf(r,"isoWeek",o):n.startOf(r,s)),+r)}function Dc(e,t,n,i){const s=Tt.length;for(let o=Tt.indexOf(e);o<s-1;++o){const r=ho[Tt[o]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-t)/(a*r.size))<=i)return Tt[o]}return Tt[s-1]}function I_(e,t,n,i,s){for(let o=Tt.length-1;o>=Tt.indexOf(n);o--){const r=Tt[o];if(ho[r].common&&e._adapter.diff(s,i,r)>=t-1)return r}return Tt[n?Tt.indexOf(n):0]}function D_(e){for(let t=Tt.indexOf(e)+1,n=Tt.length;t<n;++t)if(ho[Tt[t]].common)return Tt[t]}function Tc(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:i,hi:s}=Zr(n,t),o=n[i]>=t?n[i]:n[s];e[o]=!0}}function T_(e,t,n,i){const s=e._adapter,o=+s.startOf(t[0].value,i),r=t[t.length-1].value;let a,l;for(a=o;a<=r;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}function Mc(e,t,n){const i=[],s={},o=t.length;let r,a;for(r=0;r<o;++r)a=t[r],s[a]=r,i.push({value:a,major:!1});return o===0||!n?i:T_(e,i,s,n)}class Di extends en{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const i=t.time||(t.time={}),s=this._adapter=new By._date(t.adapters.date);s.init(n),di(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Ic(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,i=t.time.unit||"day";let{min:s,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=ot(s)&&!isNaN(s)?s:+n.startOf(Date.now(),i),o=ot(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(s,o-1),this.max=Math.max(s+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){const t=this.options,n=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const o=this.min,r=this.max,a=r0(s,o,r);return this._unit=n.unit||(i.autoSkip?Dc(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):I_(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:D_(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Mc(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,s,o;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?n=1-s:n=(this.getDecimalForValue(t[1])-s)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=gt(n,0,r),i=gt(i,0,r),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){const t=this._adapter,n=this.min,i=this.max,s=this.options,o=s.time,r=o.unit||Dc(o.minUnit,n,i,this._getLabelCapacity(n)),a=O(s.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=xn(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":r),t.diff(i,n,r)>1e5*a)throw new Error(n+" and "+i+" are too far apart with stepSize of "+a+" "+r);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,r),f++)Tc(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Tc(d,h,g),Object.keys(d).sort(Ec).map(p=>+p)}getLabelForValue(t){const n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){const s=this.options.time.displayFormats,o=this._unit,r=n||s[o];return this._adapter.format(t,r)}_tickFormatFunction(t,n,i,s){const o=this.options,r=o.ticks.callback;if(r)return Z(r,[t,n,i],this);const a=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[n],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let n,i,s;for(n=0,i=t.length;n<i;++n)s=t[n],s.label=this._tickFormatFunction(s.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,i=this.ctx.measureText(t).width,s=zt(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(s),r=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*o+a*r,h:i*r+a*o}}_getLabelCapacity(t){const n=this.options.time,i=n.displayFormats,s=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,Mc(this,[t],this._majorUnit),s),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(n=0,i=s.length;n<i;++n)t=t.concat(s[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,i;if(t.length)return t;const s=this.getLabels();for(n=0,i=s.length;n<i;++n)t.push(Ic(this,s[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return iu(t.sort(Ec))}}I(Di,"id","time"),I(Di,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function as(e,t,n){let i=0,s=e.length-1,o,r,a,l;n?(t>=e[i].pos&&t<=e[s].pos&&({lo:i,hi:s}=re(e,"pos",t)),{pos:o,time:a}=e[i],{pos:r,time:l}=e[s]):(t>=e[i].time&&t<=e[s].time&&({lo:i,hi:s}=re(e,"time",t)),{time:o,pos:a}=e[i],{time:r,pos:l}=e[s]);const c=r-o;return c?a+(l-a)*(t-o)/c:a}class Er extends Di{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=as(n,this.min),this._tableRange=as(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,s=[],o=[];let r,a,l,c,d;for(r=0,a=t.length;r<a;++r)c=t[r],c>=n&&c<=i&&s.push(c);if(s.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(r=0,a=s.length;r<a;++r)d=s[r+1],l=s[r-1],c=s[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(a-1)});return o}_generate(){const t=this.min,n=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(n)||i.length===1)&&i.push(n),i.sort((s,o)=>s-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return n.length&&i.length?t=this.normalize(n.concat(i)):t=n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(as(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return as(this._table,i*this._tableRange+this._minPos,!0)}}I(Er,"id","timeseries"),I(Er,"defaults",Di.defaults);var M_=Object.freeze({__proto__:null,CategoryScale:_r,LinearScale:wr,LogarithmicScale:kr,RadialLinearScale:Kn,TimeScale:Di,TimeSeriesScale:Er});const C_=[Ry,ux,r_,M_];se.register(...C_);function fo(e,t=""){return`
        <div class="bg-white/70 dark:bg-gray-900/60 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-800/30 ${t}">
            ${e}
        </div>
    `}const le={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function Ti(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,n=>t[n])}function A_(e,t,n,i){return fo(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${Ti(e)}</span>
        <span id="${n}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${Ti(t)}</span>
    `,le.CLASSES.KPI_CARD)}function Yu(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${le.KPI_ITEMS.map(e=>A_(e.label,"-",e.id,e.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${le.CHARTS.map(e=>fo(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${e.dot}"></span> ${Ti(e.label)}
                    </h3>
                    <div class="${le.CLASSES.CHART_CONTAINER}">
                        <canvas id="${e.id}Chart"></canvas>
                    </div>
                `,`${le.CLASSES.CHART_CARD} ${e.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function L_(e=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(e)?e:[]).map(s=>`<option value="${Ti(s.id)}">${Ti(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${fo(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function O_(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function P_(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Cc=new WeakMap;function R_(e){const t=document.getElementById("dashboard-view");if(!e||!t)return;t.innerHTML=Yu();const n=e.filter(s=>s.status==="completed"&&s.completedAt);B_(n),[{id:"daily",color:le.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:le.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:le.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:o,data:r}=N_(n,s.count,s.unit);F_(s.id,o,r,s.color)})}function B_(e){const t=new Date,n=ce(t).getTime(),i=fd(t).getTime(),s=qg(t).getTime(),o=e.reduce((r,a)=>{const l=ge(a.completedAt);if(!l)return r;const c=l.getTime();return c>=n&&r.today++,c>=i&&r.weekly++,c>=s&&r.monthly++,r},{today:0,weekly:0,monthly:0,total:e.length});Object.entries(o).forEach(([r,a])=>{const l=document.getElementById(`${r}-count`);l&&(l.textContent=a)})}function N_(e,t,n){const i=[],s=[],o=new Date;for(let r=0;r<t;r++){let a,l,c;const d=new Date(o);n==="day"?(d.setDate(o.getDate()-(t-1-r)),a=ce(d),l=Yg(d),c=`${a.getMonth()+1}/${a.getDate()}`):n==="week"?(d.setDate(o.getDate()-(t-1-r)*7),a=fd(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(o.getFullYear(),o.getMonth()-(t-1-r),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=e.filter(h=>{const f=ge(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function F_(e,t,n,i){const s=document.getElementById(`${e}Chart`);if(!s)return;let o=Cc.get(s);o?(o.data.labels=t,o.data.datasets[0].data=n,o.update()):(o=new se(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:n,backgroundColor:i,borderRadius:4}]},options:le.CHART_DEFAULTS}),Cc.set(s,o))}function $_(e,t,n){var r;(r=document.getElementById("task-context-menu"))==null||r.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-50 animate-fade-in text-sm min-w-[150px]",i.style.left=`${t}px`,i.style.top=`${n}px`,i.innerHTML=`
        <div class="border-b border-gray-100 dark:border-gray-700 pb-1 mb-1">
             <button id="ctx-today" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                今日
            </button>
            <button id="ctx-tomorrow" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                明日
            </button>
            <button id="ctx-next-week" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                来週
            </button>
        </div>
        <button id="ctx-delete-task-btn" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,document.body.appendChild(i);const s=a=>{i.remove(),a()};i.querySelector("#ctx-today").addEventListener("click",()=>{s(()=>ei(e.id,{dueDate:ce(new Date)}))}),i.querySelector("#ctx-tomorrow").addEventListener("click",()=>{const a=ce(new Date);a.setDate(a.getDate()+1),s(()=>ei(e.id,{dueDate:a}))}),i.querySelector("#ctx-next-week").addEventListener("click",()=>{const a=ce(new Date);a.setDate(a.getDate()+(8-a.getDay())),s(()=>ei(e.id,{dueDate:a}))}),i.querySelector("#ctx-delete-task-btn").addEventListener("click",()=>{s(()=>P("削除しますか？",async()=>await pd(e.id)))});const o=a=>{i.contains(a.target)||(i.remove(),document.removeEventListener("click",o))};setTimeout(()=>document.addEventListener("click",o),0)}function H_(e){const t=document.createElement("li");t.setAttribute("data-id",e.id),t.setAttribute("draggable","true");const n=e.status==="completed",i=Gg(e.dueDate),s=Xg(e.dueDate),o=!!e.recurrence,r=!!e.dueDate&&!o,a=he(),l=e.timeBlockId?a.find(c=>c.id===e.timeBlockId):null;return t.className=`group flex items-start gap-2 sm:gap-3 py-2 px-2 rounded -mx-2 transition-all duration-200 cursor-default border border-transparent ${n?"opacity-60 bg-gray-50 dark:bg-gray-900/50":"hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700"}`,t.innerHTML=`
        <div class="task-drag-handle mt-1 text-gray-300 dark:text-gray-600 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing hidden sm:block mr-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
        </div>

        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 cursor-pointer ${n?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500"}">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center">
            <div class="col-span-1 sm:col-span-7 flex flex-col justify-center">
                <div class="leading-snug truncate font-medium transition-colors ${n?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"}">${e.title}</div>
                ${e.description?`<div class="text-xs text-gray-400 mt-0.5 font-light truncate markdown-summary">${Id(e.description.split(`
`)[0]).replace(/<\/?p[^>]*>/g,"")}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-5 flex items-center sm:justify-end space-x-2 text-xs h-full mt-1 sm:mt-0 overflow-hidden">
                ${o?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${r?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                <div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${l?`${l.start} - ${l.end}`:"時間帯未定"}">
                    <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${l?l.color:"#cbd5e1"}"></span>
                    <span class="truncate font-mono text-[11px]">${l?`${l.start} - ${l.end}`:"未定"}</span>
                </div>

                <div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${e.duration||0}分">
                    <span class="mr-0.5 text-[10px]">⏱️</span>${e.duration||0}m
                </div>

                ${i?`<div class="flex items-center ${s} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${i}</div>`:""}
            </div>
        </div>
    `,t.addEventListener("dragstart",c=>{t.classList.add("opacity-50"),c.dataTransfer.setData("text/plain",e.id),c.dataTransfer.effectAllowed="move"}),t.addEventListener("dragend",()=>t.classList.remove("opacity-50")),t.querySelector(".task-checkbox").addEventListener("click",async c=>{c.stopPropagation(),await Qg(e.id,n?"todo":"completed")}),t.addEventListener("click",c=>{!c.target.closest(".task-checkbox")&&!c.target.closest(".task-drag-handle")&&lm(e)}),t.addEventListener("contextmenu",c=>{c.preventDefault(),c.stopPropagation(),$_(e,c.clientX,c.clientY)}),t}function qu(e,t){if(!e)return;const n=document.createElement("ul");if(n.id="task-list-ul",n.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2",!t||t.length===0)n.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none">
                タスクがありません
            </li>
        `;else{const i=document.createDocumentFragment();t.forEach(s=>{i.appendChild(H_(s))}),n.appendChild(i)}e.innerHTML="",e.appendChild(n)}function ca(e,t,n){if(!(e.dataset.expanded==="true")){e.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,e.querySelector("#show-input-btn").onclick=()=>{e.dataset.expanded="true",ca(e,t,n)};return}const o=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer">
                    <option value="">時間帯 (未定)</option>
                    ${he().map(r=>`<option value="${r.id}">${r.start} - ${r.end}</option>`).join("")}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition">キャンセル</button>
                    <button id="submit-task-btn" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm">タスクを追加</button>
                </div>
            </div>
        </div>
    `;e.innerHTML=fo(o,"p-3 animate-fade-in-down"),j_(e,t,n)}function j_(e,t,n){const i=e.querySelector("#inline-title-input"),s=e.querySelector("#submit-task-btn"),o=e.querySelector("#cancel-input-btn"),r=e.querySelector("#inline-desc-input"),a=e.querySelector("#inline-timeblock-select");i.focus(),o.onclick=()=>{e.dataset.expanded="false",ca(e,t,n)};const l=async()=>{const c=i.value.trim();c&&(s.disabled=!0,await z_({title:c,description:r.value.trim(),projectId:t,labelIds:n?[n]:[],timeBlockId:a.value||null}),i.value="",r.value="",i.focus(),s.disabled=!1)};s.onclick=l,i.onkeydown=c=>{c.key==="Enter"&&!c.isComposing&&l()}}async function z_(e){try{await Zg(e)}catch(t){console.error(t),P({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function U_(e,t="createdAt_desc"){return Array.isArray(e)?[...e].sort((n,i)=>{switch(t){case"createdAt_asc":return Go(n.createdAt,i.createdAt);case"createdAt_desc":return Go(i.createdAt,n.createdAt);case"dueDate_asc":return ls(n.dueDate,i.dueDate,(s,o)=>Go(s,o));case"timeBlockId_asc":return ls(n.timeBlockId,i.timeBlockId,(s,o)=>String(s).localeCompare(String(o)));case"projectId_asc":return ls(n.projectId,i.projectId,(s,o)=>String(s).localeCompare(String(o)));case"duration_asc":return ls(n.duration,i.duration,(s,o)=>Number(s)-Number(o));case"title_asc":return(n.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function Go(e,t){const n=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return n(e)-n(t)}function ls(e,t,n){return e===t?0:e==null||e==="null"?1:t==null||t==="null"?-1:n(e,t)}function V_(e,t,n){const i=vd(n);if(!i||!i.start||!i.end)return;const s=W_(i.start,i.end);if(s<=0)return;const o=t.reduce((w,k)=>{const S=parseInt(k.duration,10);return w+(isNaN(S)?0:S)},0),r=(s/60).toFixed(2),a=(o/60).toFixed(2),l=Math.min(o/s*100,100),c=o/s*100,d=s-o,u=d<0,h=Math.abs(d),f=(h/60).toFixed(2),g=w=>{const k=Math.floor(w/60),S=w%60;return k>0?`${k}時間${S}分`:`${S}分`},p=c>100,m=p?"bg-red-500":"bg-gradient-to-r from-blue-500 to-indigo-500",b=p?"100%":`${l}%`,y=u?"text-red-500":"text-green-500",x=u?"超過":"残り",_=`
        <div class="mt-4 mb-4 py-2 px-4 bg-gray-50/50 dark:bg-[#1e1e1e]/30 rounded-lg flex items-center justify-between gap-4 text-sm animate-fade-in border border-gray-100 dark:border-gray-800/50">
            
            <!-- Left: 時間帯名 -->
            <div class="flex-shrink-0 text-xs text-gray-400 font-mono">
                ${i.name}
            </div>

            <!-- Center: 数字とプログレスバー -->
            <div class="flex-1 flex flex-col justify-center gap-1 mx-2">
                <div class="text-xs text-center text-gray-500 dark:text-gray-400">
                    <span class="font-bold text-gray-700 dark:text-gray-300">${a}</span> <span class="text-[10px] text-gray-400">/</span> ${r} <span class="text-[10px]">時間</span>
                </div>
                <div class="relative h-1.5 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden w-full">
                     <div class="${m} h-full rounded-full transition-all duration-500 ease-out"
                         style="width: ${b}">
                    </div>
                </div>
            </div>

            <!-- Right: %と過不足 -->
            <div class="flex-shrink-0 text-right min-w-[80px]">
                <div class="text-xl font-bold ${p?"text-red-500":"text-blue-500"} leading-none">
                    ${Math.round(c)}<span class="text-xs font-normal opacity-70">%</span>
                </div>
                <div class="text-[10px] font-medium ${y} mt-0.5">
                    ${x} ${g(h)} <span class="opacity-70">(${f}h)</span>
                </div>
            </div>
        </div>
    `,v=document.createElement("div");v.innerHTML=_,e.appendChild(v)}function W_(e,t){const[n,i]=e.split(":").map(Number),[s,o]=t.split(":").map(Number);let r=n*60+i,a=s*60+o;return a<r&&(a+=1440),a-r}function Y_(e,t,n=[],i=null,s=null,o=null){const r=document.getElementById("task-view");if(!r)return;q_(e.length,i,s,t,n);const a=document.getElementById("sort-select"),l=document.getElementById("sort-trigger");let c="createdAt_desc";a?c=a.value:l&&l.dataset.value&&(c=l.dataset.value);const d=U_(e,c);r.innerHTML="";const u=document.createElement("div");if(u.id="task-list-container",r.appendChild(u),qu(u,d),o){const f=document.createElement("div");f.id="timeblock-stats-container",r.appendChild(f),V_(f,e,o)}const h=document.createElement("div");h.id="inline-input-container",h.className="mt-2 pb-10",r.appendChild(h),ca(h,i,s)}function q_(e,t,n,i,s){const o=document.getElementById("header-title"),r=document.getElementById("header-count");if(o){let a="インボックス";if(t){const l=i.find(c=>c.id===t);a=l?l.name:"プロジェクト"}else if(n){const l=s.find(c=>c.id===n);a=l?`${l.name}`:"ラベル"}o.textContent=a}r&&(r.textContent=`${e}件`)}let Bt={};function G_(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function X_(e){Bt={input:e.querySelector("#page-search-input"),select:e.querySelector("#page-search-project"),results:e.querySelector("#search-results-container")}}function K_(e,t,n,i,s){var r;if(xs(e,t),e.innerHTML=L_(i),X_(e),!Bt.input||!Bt.results)return;const o=G_(()=>Ac(n),300);Bt.input.addEventListener("input",o),(r=Bt.select)==null||r.addEventListener("change",()=>Ac(n)),Gd({type:"search"}),qd(),requestAnimationFrame(()=>Bt.input.focus())}function Ac(e){var s;const t=Bt.input.value.trim().toLowerCase(),n=((s=Bt.select)==null?void 0:s.value)||null;if(!t){Bt.results.innerHTML=O_();return}const i=Ys(e,{keyword:t,projectId:n,showCompleted:!0});i.length===0?Bt.results.innerHTML=P_():(Bt.results.innerHTML="",qu(Bt.results,i))}let It={type:"inbox",id:null},bt=null;const Lc={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function J_(){if(bt)return;const{VIEW_IDS:e}=Yr;bt={task:document.getElementById(e.TASK),dashboard:document.getElementById(e.DASHBOARD),search:document.getElementById(e.SEARCH),settings:document.getElementById(e.SETTINGS)}}function Fn(e,t=[],n=[]){if(e.type==="settings"){io();return}It=e,xb(It),Gd(It,t,n)}function Z_(e,t,n){if(J_(),!bt.task||!bt.dashboard||!bt.search)return;const i=document.getElementById(Lc.SORT),s=(i==null?void 0:i.dataset.value)||"createdAt_desc",o=[bt.task,bt.dashboard,bt.search,bt.settings];if(It.type==="dashboard"){xs(bt.dashboard,o.filter(d=>d!==bt.dashboard)),bt.dashboard.innerHTML=Yu(),R_(e);return}if(It.type==="search"){xs(bt.search,o.filter(d=>d!==bt.search)),K_(bt.search,e,t,It);return}xs(bt.task,o.filter(d=>d!==bt.task));const r=document.getElementById(Lc.COMPLETED_TOGGLE),l={keyword:"",showCompleted:r?r.classList.contains("text-blue-500"):!1,projectId:It.type==="project"?It.id:null,labelId:It.type==="label"?It.id:null,timeBlockId:It.type==="timeblock"?It.id:null,duration:It.type==="duration"?It.id:null,sortCriteria:s},c=ob(e,l);Y_(c,t,n,l.projectId,l.labelId,l.timeBlockId)}const jt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null};let Ir=!1,Xo=null;function bn(){Xo||(Xo=requestAnimationFrame(()=>{const e=Ko.tasks(),t=Ko.projects(),n=Ko.labels();Z_(e,t,n),Xo=null}))}function $n(e){document.dispatchEvent(new CustomEvent(e)),bn()}function Q_(e){if(!(U!=null&&U.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}da(!1);const t=Zt();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}Ir=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),jt.tasks=kp(t,()=>$n("tasks-updated")),jt.projects=pp(t,()=>$n("projects-updated")),jt.labels=cp(t,()=>$n("labels-updated")),jt.timeBlocks=vp(t,()=>$n("timeblocks-updated")),jt.filters=ip(t,()=>$n("filters-updated"))}function da(e=!1){(Ir||e)&&console.log("[DataSync] Stopping data sync..."),Object.keys(jt).forEach(t=>{t==="workspaces"&&!e||typeof jt[t]=="function"&&(jt[t](),jt[t]=null)}),xp(),np(),Ir=!1,bn()}const Ko={tasks:In,projects:Fr,labels:ap,timeBlocks:he,filters:md,workspaceId:()=>Zt()};function Gu(){return jt.workspaces}function Xu(e){jt.workspaces=e}function tw(){const e=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),n=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!e||!t||!n)return;const s=r=>{r?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",o)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",o))},o=r=>{r&&(t.contains(r.target)||e.contains(r.target))||s(!1)};e.addEventListener("click",r=>{r.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(r=>{r.addEventListener("click",a=>{const l=r.dataset.value,c=r.textContent;n.textContent=c,e.dataset.value=l,bn(),s(!1)})}),e.dataset.value||(e.dataset.value="createdAt_desc",n.textContent="作成日(新しい順)")}function ew(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function nw(){var n;let e=!0;document.addEventListener("workspace-changed",i=>{const{workspaceId:s}=i.detail;console.log("[EventManager] Workspace changed to:",s);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),U!=null&&U.currentUser){if(e){e=!1;try{const r=JSON.parse(localStorage.getItem("lastPage"));r&&r.page==="settings"?Fn({type:"inbox"}):Fn(r?{type:r.page,id:r.id||null}:{type:"inbox"})}catch{Fn({type:"inbox"})}}else Fn({type:"inbox",id:null});da(!1),Q_(),bn()}}),document.addEventListener("route-change",i=>{const{page:s,id:o}=i.detail;Fn({type:s,id:o||null}),s!=="settings"&&localStorage.setItem("lastPage",JSON.stringify({page:s,id:o||null})),bn()});const t=ew(()=>bn(),300);(n=document.getElementById("search-input"))==null||n.addEventListener("input",t),tw()}function iw(){try{uh()}catch(e){console.error("Firebase Initialization Failed",e);return}xd(),Xp(),dh(async()=>{const{applyBackground:e}=await Promise.resolve().then(()=>Sp);return{applyBackground:e}},void 0).then(({applyBackground:e})=>e()),Op(),Sd(),Bc(),nw(),sw()}function sw(){U&&nh(U,e=>{bh(e),e?ow(e):rw()})}function ow(e){fb();const t=Gu();typeof t=="function"&&t();const n=wh(e.uid,i=>{Ed(i)});Xu(n)}function rw(){const e=Gu();typeof e=="function"&&(e(),Xu(null)),da(!0),wb(),Bc()}function aw(){iw()}let Oc=!1;function lw(e){const t=document.createElement("div");t.id=yb.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const n=t.querySelector("#error-code-box");n&&(n.textContent=e.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function cw(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const e=document.createElement("link");e.rel="icon",e.type="image/png",e.href=bb.FAVICON,document.head.appendChild(e)}async function Pc(){if(!Oc){Oc=!0;try{cw(),await aw()}catch(e){console.error("[Main] Critical Initialization Error:",e),lw(e)}}}(()=>{if(document.readyState==="loading"){const e=()=>{document.removeEventListener("DOMContentLoaded",e),Pc()};document.addEventListener("DOMContentLoaded",e)}else Pc()})();
