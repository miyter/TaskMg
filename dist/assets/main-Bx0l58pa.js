const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/FilterEditModal-BWGXB7Qe.js","assets/react-vendor-D2I7O6xs.js","assets/vendor-CBsUEP5T.js","assets/vendor-DKQ_J0ve.css","assets/i18n-CkMKOdEg.js","assets/firebase-Dk4oNdYC.js","assets/ErrorMessage-ysv-5oYb.js","assets/Modal-DLEcublt.js","assets/dnd-BYudv-0e.js","assets/LabelEditModal-CY4Fso0E.js","assets/ProjectEditModal-CyiVRJQl.js","assets/SettingsModal-CusrrClN.js","assets/TaskDetailModal-BovXqXB8.js","assets/TimeBlockEditModal-hYY43PBO.js","assets/WorkspaceEditModal-CdDIxJ3A.js","assets/WikiFrameworkModal-CQYkMwSF.js","assets/ConfirmationModal-nDENARZf.js"])))=>i.map(i=>d[i]);
var Tr=Object.defineProperty;var Dr=(e,t,r)=>t in e?Tr(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r;var A=(e,t,r)=>Dr(e,typeof t!="symbol"?t+"":t,r);import{r as k,j as s,c as we,R as S,u as Pt,b as Ir,a as Er,d as Sr,Q as Mr}from"./react-vendor-D2I7O6xs.js";import{e as Re,f as ut,C as ht,S as gt,v as mt,u as Ot,a as $e,s as Ar,K as Lr,P as Bt,D as Wt,c as $t,d as pt,T as Rr,p as Fr,r as Pr}from"./dnd-BYudv-0e.js";import{a as Et,i as Or,b as Br,e as Wr,f as $r,h as zr,j as zt,k as qr,T as Fe,q as de,o as ft,c as L,m as je,n as qt,p as Vr,g as ie,r as U,t as Z,d as z,u as De,v as Ie,x as Kr,y as Vt,s as Ur,z as Hr,w as xt,A as Kt}from"./firebase-Dk4oNdYC.js";import{u as W,g as me,i as Gr}from"./i18n-CkMKOdEg.js";import{t as Xr,d as Yr,p as Ve,u as Ut,e as Jr,f as Qr,g as b,h as V,j as se,k as G,l as ze,m as Ht,q as Gt,v as Zr,w as es,x as ts}from"./vendor-CBsUEP5T.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const i of o.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&a(i)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();const rs="modulepreload",ss=function(e){return"/"+e},St={},ae=function(t,r,a){let n=Promise.resolve();if(r&&r.length>0){let i=function(d){return Promise.all(d.map(h=>Promise.resolve(h).then(u=>({status:"fulfilled",value:u}),u=>({status:"rejected",reason:u}))))};document.getElementsByTagName("link");const l=document.querySelector("meta[property=csp-nonce]"),c=(l==null?void 0:l.nonce)||(l==null?void 0:l.getAttribute("nonce"));n=i(r.map(d=>{if(d=ss(d),d in St)return;St[d]=!0;const h=d.endsWith(".css"),u=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${d}"]${u}`))return;const p=document.createElement("link");if(p.rel=h?"stylesheet":rs,h||(p.as="script"),p.crossOrigin="",p.href=d,c&&p.setAttribute("nonce",c),document.head.appendChild(p),h)return new Promise((y,x)=>{p.addEventListener("load",y),p.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${d}`)))})}))}function o(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return n.then(i=>{for(const l of i||[])l.status==="rejected"&&o(l.reason);return t().catch(o)})},as={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};function ns(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return window.GLOBAL_FIREBASE_CONFIG;try{const e=as;if(e&&e.VITE_FIREBASE_API_KEY)return{apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}const ue=ns();if(!(ue!=null&&ue.apiKey)||!(ue!=null&&ue.projectId)){const e="[Firebase] Configuration is missing required fields (apiKey, projectId). Application cannot start.";throw console.error(e,ue),new Error(e)}let st;Et().length>0?st=Et()[0]:st=Or(ue);const Xt=st,D=Br(Xt,{persistence:zr,popupRedirectResolver:$r}),v=Wr(Xt),M=()=>{const e=W(r=>r.language);return k.useMemo(()=>me(e),[e])},os=()=>{const{t:e}=M(),[t,r]=k.useState(""),[a,n]=k.useState(""),[o,i]=k.useState(!1),[l,c]=k.useState(null),d=async u=>{u.preventDefault(),c(null),i(!0);try{await zt(D,t,a)}catch(p){let y=e("login.error.login_fail");switch(p.code){case"auth/invalid-email":y=e("login.error.invalid_email");break;case"auth/user-disabled":y=e("login.error.user_disabled");break;case"auth/user-not-found":y=e("login.error.user_not_found");break;case"auth/wrong-password":y=e("login.error.wrong_password");break;case"auth/too-many-requests":y=e("login.error.too_many_requests");break;case"auth/network-request-failed":y=e("login.error.network_error");break}c(y)}finally{i(!1)}},h=async()=>{c(null),i(!0);try{await qr(D)}catch(u){c(e("login.error.guest_fail").replace("{message}",u.message))}finally{i(!1)}};return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-premium-gradient p-4 antialiased",children:s.jsxs("div",{className:"max-w-md w-full p-6 sm:p-8 bg-white/70 dark:bg-gray-800/60 backdrop-blur-xl border border-white/20 dark:border-gray-700/30 rounded-[2rem] shadow-2xl transition-all duration-300",children:[s.jsxs("div",{className:"text-center mb-8 sm:mb-10",children:[s.jsx("div",{className:"inline-flex items-center justify-center p-4 bg-white dark:bg-gray-700 rounded-3xl shadow-lg mb-6 animate-float",children:s.jsx("img",{src:"/images/web-app-manifest-512x512.png",alt:"Logo",className:"h-12 w-12"})}),s.jsxs("h1",{className:"text-4xl font-black text-gray-900 dark:text-white mb-2 tracking-tight",children:["Task",s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 font-medium",children:e("login.tagline")})]}),s.jsxs("form",{onSubmit:d,className:"space-y-5 sm:space-y-6",children:[l&&s.jsx("div",{className:"p-4 bg-red-500/10 border border-red-500/20 text-red-600 dark:text-red-400 text-sm rounded-xl font-medium animate-in fade-in slide-in-from-top-4 duration-300 shadow-sm",children:l}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-email",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.email_label")}),s.jsx("input",{id:"login-email",name:"email",type:"email",autoComplete:"email",required:!0,value:t,onChange:u=>r(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"mail@example.com"})]}),s.jsxs("div",{children:[s.jsx("label",{htmlFor:"login-password",className:"block text-xs font-bold text-gray-500 dark:text-gray-400 mb-2 uppercase tracking-wider",children:e("login.password_label")}),s.jsx("input",{id:"login-password",name:"password",type:"password",autoComplete:"current-password",required:!0,value:a,onChange:u=>n(u.target.value),className:"w-full px-5 py-3 bg-white/50 dark:bg-gray-900/50 border border-gray-200/50 dark:border-gray-700/50 rounded-2xl focus:ring-2 focus:ring-blue-500/50 outline-none text-gray-900 dark:text-white transition-all placeholder-gray-400",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"})]}),s.jsx("button",{type:"submit",disabled:o,className:"btn-premium w-full py-4 text-lg shadow-lg hover:shadow-xl active:scale-[0.98] transition-all",children:e(o?"login.signing_in":"login.signin")})]}),s.jsxs("div",{className:"mt-8",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 flex items-center",children:s.jsx("div",{className:"w-full border-t border-gray-200/50 dark:border-gray-700/50"})}),s.jsx("div",{className:"relative flex justify-center text-xs",children:s.jsx("span",{className:"px-3 bg-transparent text-gray-400 uppercase tracking-widest font-bold",children:e("login.or")})})]}),s.jsxs("button",{onClick:h,disabled:o,className:"mt-8 w-full py-3.5 bg-gray-100/50 hover:bg-gray-200/70 active:bg-gray-300 dark:bg-gray-700/30 dark:hover:bg-gray-600/50 dark:active:bg-gray-600 text-gray-700 dark:text-gray-200 font-bold rounded-2xl transition-all active:scale-95 flex items-center justify-center gap-3 border border-transparent hover:border-gray-300 dark:hover:border-gray-600",children:[s.jsx("span",{className:"text-xl",children:"ðŸ•µï¸"})," ",e("login.guest_login")]})]})]})})},is={success:3e3,info:4e3,error:6e3},Oe=new Map,ls=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():Math.random().toString(36).substring(2,11),We=we(e=>({toasts:[],addToast:(t,r="info")=>{const a=ls();e(i=>({toasts:[...i.toasts,{id:a,message:t,type:r}]}));const n=is[r],o=setTimeout(()=>{e(i=>({toasts:i.toasts.filter(l=>l.id!==a)})),Oe.delete(a)},n);Oe.set(a,o)},removeToast:t=>{const r=Oe.get(t);r&&(clearTimeout(r),Oe.delete(t)),e(a=>({toasts:a.toasts.filter(n=>n.id!==t)}))}})),j={success:e=>We.getState().addToast(e,"success"),error:e=>We.getState().addToast(e,"error"),info:e=>We.getState().addToast(e,"info")};function T(...e){return Xr(Yr(e))}const cs=()=>{const{toasts:e,removeToast:t}=We();return e.length===0?null:s.jsx("div",{className:"fixed bottom-4 right-4 z-[9999] flex flex-col gap-2 pointer-events-none",children:e.map(r=>s.jsx("div",{onClick:()=>t(r.id),className:T("pointer-events-auto min-w-[300px] max-w-sm p-4 rounded-xl shadow border text-sm font-medium cursor-pointer hover:opacity-90",r.type==="success"&&"bg-white dark:bg-gray-800 text-green-600 dark:text-green-400 border-green-200 dark:border-green-900",r.type==="error"&&"bg-white dark:bg-gray-800 text-red-600 dark:text-red-400 border-red-200 dark:border-red-900",r.type==="info"&&"bg-white dark:bg-gray-800 text-gray-800 dark:text-gray-200 border-gray-200 dark:border-gray-700"),children:s.jsxs("div",{className:"flex items-start gap-3",children:[r.type==="success"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M5 13l4 4L19 7"})}),r.type==="error"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),r.type==="info"&&s.jsx("svg",{className:"w-5 h-5 flex-shrink-0",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),s.jsx("p",{className:"leading-5 flex-1",children:r.message}),s.jsx("button",{onClick:a=>{a.stopPropagation(),t(r.id)},className:"flex-shrink-0 p-1 rounded hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors","aria-label":"é–‰ã˜ã‚‹",children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M6 18L18 6M6 6l12 12"})})})]})},r.id))})},N={Z_INDEX:{BASE:0,SIDEBAR_BACKDROP:20,SIDEBAR_MOBILE:30,SIDEBAR_RESIZER:40,DROPDOWN:50,STICKY:100,MODAL_BACKDROP:9990,MODAL:9991,POPOVER_BACKDROP:9998,POPOVER:9999,TOOLTIP:1e4,TOAST:10001},DEFAULT_COLORS:{PROJECT:"#7E57C2",PROJECT_INACTIVE:"#cccccc",LABEL:"#42A5F5",TIME_BLOCK:"#3B82F6",TIME_BLOCK_INACTIVE:"#cccccc",LABEL_INACTIVE:"#9ca3af"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},SIDEBAR_DENSITY:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},DND:{PREFIX_TASK:"task:",PREFIX_PROJECT:"project:",PREFIX_FILTER:"filter:",TYPE_PROJECT:"project",TYPE_INBOX:"inbox",TYPE_TIMEBLOCK:"timeblock",TYPE_LABEL:"label",TOUCH_DELAY:250},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order",FONT_EN:"font_family_en",FONT_JP:"font_family_jp",FONT_SIZE:"fontSize"},SIDEBAR:{MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DURATIONS:[30,45,60,75,90]},TIME_BLOCK:{MAX_COUNT:10,DEFAULTS:[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}]},LAYOUT:{CONTAINER_WIDTH_CLASS:"w-full max-w-full",MOBILE_SIDEBAR_WIDTH_PX:280},FONTS:{EU:[{label:"Google Sans",value:'"Google Sans", Inter, sans-serif'},{label:"Inter",value:"Inter, sans-serif"},{label:"Roboto",value:"Roboto, sans-serif"},{label:"System UI",value:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif'}],JP:[{label:"M PLUS 2",value:'"M PLUS 2", sans-serif'},{label:"Noto Sans JP",value:'"Noto Sans JP", sans-serif'},{label:"Hiragino / Yu Gothic",value:'"Hiragino Sans", "Hiragino Kaku Gothic ProN", "Yu Gothic", sans-serif'}]}},ds=[{value:"#EF5350",key:"red"},{value:"#EC407A",key:"pink"},{value:"#AB47BC",key:"purple"},{value:"#7E57C2",key:"deep_purple"},{value:"#5C6BC0",key:"indigo"},{value:"#42A5F5",key:"blue"},{value:"#29B6F6",key:"light_blue"},{value:"#26C6DA",key:"cyan"},{value:"#26A69A",key:"teal"},{value:"#66BB6A",key:"green"},{value:"#9CCC65",key:"light_green"},{value:"#D4E157",key:"lime"},{value:"#FFEE58",key:"yellow"},{value:"#FFCA28",key:"amber"},{value:"#FFA726",key:"orange"},{value:"#FF7043",key:"deep_orange"},{value:"#8D6E63",key:"brown"},{value:"#BDBDBD",key:"grey"},{value:"#78909C",key:"blue_grey"}];ds.map(e=>e.value);const us=()=>typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)}),ne=we(e=>({stack:[],openModal:(t,r=null)=>{if(!t)return;const n={id:us(),type:t,data:r};e(o=>({stack:[...o.stack,n]}))},closeModal:()=>e(t=>t.stack.length===0?t:{stack:t.stack.slice(0,-1)}),closeAllModals:()=>e({stack:[]})})),hs=1024,bt=we()(Ve(e=>({sidebarWidth:N.SIDEBAR.DEFAULT_WIDTH,isSidebarOpen:!0,sidebarDensity:"normal",setSidebarWidth:t=>{const r=Math.max(N.SIDEBAR.MIN_WIDTH,Math.min(t,N.SIDEBAR.MAX_WIDTH));e({sidebarWidth:r})},toggleSidebar:()=>e(t=>({isSidebarOpen:!t.isSidebarOpen})),setSidebarOpen:t=>e({isSidebarOpen:t}),setSidebarDensity:t=>e({sidebarDensity:t})}),{name:"ui-storage",partialize:e=>({sidebarWidth:e.sidebarWidth,sidebarDensity:e.sidebarDensity,isSidebarOpen:e.isSidebarOpen}),onRehydrateStorage:()=>e=>{typeof window<"u"&&window.innerWidth<hs&&(e==null||e.setSidebarOpen(!1))}})),I=(e,t="0 0 24 24")=>({className:r,size:a,strokeWidth:n=2,...o})=>s.jsx("svg",{className:T("w-4 h-4",r),width:a,height:a,fill:"none",stroke:"currentColor",viewBox:t,strokeWidth:n,strokeLinecap:"round",strokeLinejoin:"round",...o,children:e}),gs=I(s.jsx("path",{d:"M4 6h16M4 12h16M4 18h16"})),ms=I(s.jsx("path",{d:"M18 6L6 18M6 6l12 12"})),Yt=I(s.jsx("path",{d:"M12 5v14M5 12h14"})),Ke=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 6h18"}),s.jsx("path",{d:"M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6"})]})),Ue=I(s.jsx("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7"}),"0 0 24 24"),Jt=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),Pe=I(s.jsx("path",{d:"M20 6L9 17l-5-5"})),Me=I(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"11",cy:"11",r:"8"}),s.jsx("path",{d:"M21 21l-4.35-4.35"})]})),Yo=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10.29 3.86L1.82 18a2 2 0 001.71 3h16.94a2 2 0 001.71-3L13.71 3.86a2 2 0 00-3.42 0z"}),s.jsx("path",{d:"M12 9v4M12 17h.01"})]})),yt=I(s.jsx("path",{d:"M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.382-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"})),Jo=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"}),s.jsx("path",{d:"M14 2v6h6"}),s.jsx("path",{d:"M16 13H8"}),s.jsx("path",{d:"M16 17H8"}),s.jsx("path",{d:"M10 9H8"})]})),ps=I(s.jsx("path",{d:"M15 18l-6-6 6-6"})),Ae=I(s.jsx("path",{d:"M9 18l6-6-6-6"})),Qt=I(s.jsx("path",{d:"M6 9l6 6 6-6"})),fs=I(s.jsx("path",{d:"M18 15l-6-6-6 6"})),xs=I(s.jsx("path",{d:"M11 19l-7-7 7-7m8 14l-7-7 7-7"})),Zt=I(s.jsx("path",{d:"M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"})),er=I(s.jsx("path",{d:"M13 10V3L4 14h7v7l9-11h-7z"})),tr=I(s.jsx("path",{d:"M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253"})),bs=I(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"9",cy:"12",r:"1"}),s.jsx("circle",{cx:"9",cy:"5",r:"1"}),s.jsx("circle",{cx:"9",cy:"19",r:"1"}),s.jsx("circle",{cx:"15",cy:"12",r:"1"}),s.jsx("circle",{cx:"15",cy:"5",r:"1"}),s.jsx("circle",{cx:"15",cy:"19",r:"1"})]})),qe=I(s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"})]})),rr=I(s.jsxs(s.Fragment,{children:[s.jsx("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",ry:"2"}),s.jsx("path",{d:"M16 2v4M8 2v4M3 10h18"}),s.jsx("path",{d:"M8 14h.01"}),s.jsx("path",{d:"M12 14h.01"}),s.jsx("path",{d:"M16 14h.01"}),s.jsx("path",{d:"M8 18h.01"}),s.jsx("path",{d:"M12 18h.01"}),s.jsx("path",{d:"M16 18h.01"})]})),sr=I(s.jsxs(s.Fragment,{children:[s.jsx("circle",{cx:"12",cy:"12",r:"10"}),s.jsx("path",{d:"M12 6v6l4 2"})]})),ys=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17 1l4 4-4 4"}),s.jsx("path",{d:"M3 11V9a4 4 0 014-4h14"}),s.jsx("path",{d:"M7 23l-4-4 4-4"}),s.jsx("path",{d:"M21 13v2a4 4 0 01-4 4H3"})]})),ar=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M4 11V4h16v7"}),s.jsx("path",{d:"M4 11h5.8a2.2 2.2 0 004.4 0H20v8a1 1 0 01-1 1H5a1 1 0 01-1-1v-8z"})]})),ks=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M16 4h2a2 2 0 012 2v14a2 2 0 01-2 2H6a2 2 0 01-2-2V6a2 2 0 012-2h2"}),s.jsx("rect",{x:"8",y:"2",width:"8",height:"4",rx:"1",ry:"1"})]})),Qo=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"}),s.jsx("circle",{cx:"12",cy:"12",r:"3"})]})),Zo=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19m-6.72-1.07a3 3 0 11-4.24-4.24"}),s.jsx("path",{d:"M1 1l22 22"})]})),ei=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6z"}),s.jsx("path",{d:"M6 12h9a4 4 0 014 4 4 4 0 01-4 4H6z"})]})),ti=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M19 4h-9"}),s.jsx("path",{d:"M14 20H5"}),s.jsx("path",{d:"M15 4L9 20"})]})),ri=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M8 6h13"}),s.jsx("path",{d:"M8 12h13"}),s.jsx("path",{d:"M8 18h13"}),s.jsx("path",{d:"M3 6h.01"}),s.jsx("path",{d:"M3 12h.01"}),s.jsx("path",{d:"M3 18h.01"})]})),si=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M10 6h11"}),s.jsx("path",{d:"M10 12h11"}),s.jsx("path",{d:"M10 18h11"}),s.jsx("path",{d:"M4 6h1v4"}),s.jsx("path",{d:"M4 10h2"}),s.jsx("path",{d:"M6 18H4c0-1 2-2 2-3s-1-1.5-2-1"})]})),ai=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M6 4v16"}),s.jsx("path",{d:"M18 4v16"}),s.jsx("path",{d:"M6 12h12"})]})),ni=I(s.jsxs(s.Fragment,{children:[s.jsx("path",{d:"M3 21c3 0 7-1 7-8V5c0-1.25-.756-2.017-2-2H4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"}),s.jsx("path",{d:"M16 21c3 0 7-1 7-8V5c0-1.25-.757-2.017-2-2h-4c-1.25 0-2 .75-2 1.972V11c0 1.25.75 2 2 2 1 0 1 0 1 1v1c0 1-1 2-2.5 2h-1c-.5 0-1 .5-1 1v1c0 .5.5 1 1 1z"})]})),ws=({className:e,size:t,...r})=>s.jsxs("svg",{className:T("animate-spin",e),width:t||16,height:t||16,fill:"none",viewBox:"0 0 24 24",...r,children:[s.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),s.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),js="/assets/logo-BADOZ29k.png",ee=we()(Ve(e=>({filterType:"inbox",targetId:null,query:"",showCompleted:!1,sortCriteria:"createdAt_desc",setFilter:(t,r=null)=>e({filterType:t,targetId:r,query:""}),setSearchQuery:t=>e({query:t,filterType:"search"}),clearFilter:()=>e({filterType:"inbox",targetId:null,query:""}),setShowCompleted:t=>e({showCompleted:t}),setSortCriteria:t=>e({sortCriteria:t})}),{name:"filter-storage",partialize:e=>({filterType:e.filterType,targetId:e.targetId,query:e.query,showCompleted:e.showCompleted,sortCriteria:e.sortCriteria})})),te=we()(Ve(e=>({currentView:"tasks",viewData:null,setView:(t,r=null)=>e({currentView:t,viewData:r})}),{name:"view-storage",partialize:e=>({currentView:e.currentView})})),vs=()=>{const{t:e}=M(),{query:t,setFilter:r}=ee(),{currentView:a,setView:n}=te(),o=a==="search",i=()=>{r("search"),n("search")};return s.jsxs("button",{onClick:i,className:`w-full flex items-center gap-3 px-3 py-2 rounded-lg text-left transition-all duration-200 group ${o?"bg-blue-100 dark:bg-blue-900/40 text-blue-700 dark:text-blue-300":"hover:bg-gray-100 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-400"}`,"aria-label":e("sidebar.search_placeholder"),children:[s.jsx(Me,{className:`w-4 h-4 transition-colors ${o?"text-blue-600 dark:text-blue-400":"text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300"}`}),s.jsx("span",{className:"flex-1 text-sm font-medium",children:t?`"${t}"`:e("sidebar.search_placeholder")}),s.jsx("span",{className:"text-xs text-gray-400 opacity-0 group-hover:opacity-100 transition-opacity",children:"/"})]})},Ns=({children:e})=>{const{sidebarWidth:t,isSidebarOpen:r,sidebarDensity:a,toggleSidebar:n,setSidebarWidth:o}=bt(),{t:i}=M(),l={compact:"p-1",normal:"p-2",comfortable:"p-4",spacious:"p-6"}[a];S.useEffect(()=>{const d=u=>{if(!document.body.classList.contains("resizing"))return;const p=Math.max(N.SIDEBAR.MIN_WIDTH,Math.min(N.SIDEBAR.MAX_WIDTH,u.clientX));o(p)},h=()=>{document.body.classList.remove("resizing"),document.body.style.cursor="default"};return document.addEventListener("mousemove",d),document.addEventListener("mouseup",h),()=>{document.removeEventListener("mousemove",d),document.removeEventListener("mouseup",h)}},[o]);const c=()=>{document.body.classList.add("resizing"),document.body.style.cursor="col-resize"};return s.jsxs("aside",{className:T("h-full transition-all duration-300 flex flex-col group relative","bg-white dark:bg-gray-900 lg:bg-white/70 lg:dark:bg-gray-800/60","lg:backdrop-blur-xl","border-r border-gray-200/50 dark:border-gray-700/30",r?"translate-x-0":"-translate-x-full lg:translate-x-0","fixed lg:relative lg:z-0 shadow-2xl lg:shadow-none overflow-hidden","w-[var(--sidebar-mobile)] lg:w-[var(--sidebar-desktop)]"),style:{"--sidebar-desktop":`${t}px`,"--sidebar-mobile":r?`${N.LAYOUT.MOBILE_SIDEBAR_WIDTH_PX}px`:"0px",width:r?void 0:"0px",zIndex:window.innerWidth<1024?N.Z_INDEX.SIDEBAR_MOBILE:void 0},children:[s.jsxs("div",{className:"h-14 flex items-center px-4 flex-shrink-0 justify-between border-b border-gray-100 dark:border-gray-800/50",children:[s.jsxs("div",{className:"flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none",children:[s.jsx("div",{className:"w-8 h-8 rounded-xl bg-blue-600 flex items-center justify-center shadow-lg shadow-blue-500/20",children:s.jsx("img",{src:js,alt:"L",className:"h-5 w-5 invert brightness-0"})}),s.jsxs("span",{className:"text-lg font-black text-gray-900 dark:text-white tracking-tight",children:["Task",s.jsx("span",{className:"text-blue-600 dark:text-blue-400",children:"Mg"})]})]}),s.jsx("button",{onClick:n,className:"text-gray-400 hover:text-gray-900 dark:hover:text-white p-2 rounded-xl hover:bg-gray-100 dark:hover:bg-gray-800 transition-all active:scale-90",title:i(r?"sidebar.toggle_collapse":"sidebar.toggle_expand"),"aria-label":i(r?"sidebar.toggle_collapse":"sidebar.toggle_expand"),children:s.jsx(xs,{className:T("w-5 h-5 transition-transform duration-300",!r&&"rotate-180"),strokeWidth:2.5})})]}),s.jsx("div",{className:"px-3 pb-2 pt-2",children:s.jsx(vs,{})}),s.jsx("div",{className:T("flex-1 overflow-y-auto custom-scrollbar pt-2",l),children:e}),s.jsx("div",{role:"separator","aria-orientation":"vertical","aria-label":i("sidebar.resizer_label"),"aria-valuenow":t,"aria-valuemin":N.SIDEBAR.MIN_WIDTH,"aria-valuemax":N.SIDEBAR.MAX_WIDTH,tabIndex:r?0:-1,onMouseDown:c,onKeyDown:d=>{d.key==="ArrowLeft"?o(Math.max(N.SIDEBAR.MIN_WIDTH,t-10)):d.key==="ArrowRight"&&o(Math.min(N.SIDEBAR.MAX_WIDTH,t+10))},className:T("absolute top-0 right-0 w-3 h-full cursor-col-resize transition-colors hidden lg:flex items-center justify-center outline-none focus:bg-blue-500","hover:bg-blue-500/30 active:bg-blue-600/50 group/resizer"),style:{zIndex:N.Z_INDEX.SIDEBAR_RESIZER},title:i("sidebar.resizer_hint"),children:s.jsx("div",{className:"absolute w-1 h-12 bg-gray-400 dark:bg-gray-500 rounded-full opacity-0 group-hover/resizer:opacity-100 group-focus/resizer:opacity-100 transition-opacity pointer-events-none"})}),s.jsx("div",{className:"absolute top-0 right-0 w-[1px] h-full bg-gray-200/50 dark:bg-gray-700/30 hidden lg:block"})]})},le=Ut([Jr(),Qr(Fe),b().datetime({offset:!0}).or(b().datetime())]).nullable().optional(),_s=V({type:ze(["none","daily","weekly","weekdays","monthly"]).default("none"),days:se(G().min(0).max(6)).optional()}).nullable(),kt=V({id:b().optional(),title:b().refine(e=>e.length>=1,{params:{i18n:"validation.title_required"}}),description:b().nullable().optional(),status:ze(["todo","completed","archived"]).default("todo"),dueDate:le,completedAt:le,createdAt:le,ownerId:b(),projectId:b().nullable().optional(),labelIds:se(b()).optional(),timeBlockId:b().nullable().optional(),duration:G().refine(e=>e>=0,{params:{i18n:"validation.duration_invalid"}}).optional(),isImportant:Ht().default(!1),recurrence:_s,order:G().optional()}),nr=V({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.project_name_required"}}),color:b().optional(),ownerId:b(),createdAt:le,order:G().optional()}),or=V({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.label_name_required"}}),color:b().optional(),ownerId:b(),workspaceId:b().optional(),createdAt:le,order:G().optional()}),wt=V({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.workspace_name_required"}}),createdAt:le}),ir=V({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.filter_name_required"}}),query:b(),workspaceId:b().optional(),ownerId:b().optional(),createdAt:le}),Mt=b().refine(e=>/^([01]\d|2[0-3]):([0-5]\d)$/.test(e),{params:{i18n:"validation.time_format_invalid"}}),Cs=V({id:b().optional(),name:b().refine(e=>e.length>=1,{params:{i18n:"validation.timeblock_name_required"}}),start:Mt,end:Mt,color:b().optional(),order:G().optional()});V({id:b().optional(),mode:b(),data:Gt(b(),b()),createdAt:le,updatedAt:le,ownerId:b(),workspaceId:b()});const He=we()(Ve(e=>({currentWorkspaceId:null,workspaces:[],setCurrentWorkspaceId:t=>e({currentWorkspaceId:t}),setWorkspaces:t=>{const r=t.filter(a=>{const n=wt.safeParse(a);return n.success?!0:(console.error("Invalid workspace data:",a,n.error),!1)});e({workspaces:r})}}),{name:"workspace-storage",partialize:e=>({currentWorkspaceId:e.currentWorkspaceId})}));function Ts(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function at(e){return`artifacts/${Ts()}/users/${e}`}function _e(e,t){return`${at(e)}/workspaces/${t}`}const _={users:e=>at(e),workspaces:e=>`${at(e)}/workspaces`,filters:(e,t)=>`${_e(e,t)}/filters`,labels:(e,t)=>`${_e(e,t)}/labels`,timeblocks:(e,t)=>`${_e(e,t)}/timeblocks`,tasks:(e,t)=>`${_e(e,t)}/tasks`,projects:(e,t)=>`${_e(e,t)}/projects`,targets:(e,t)=>`${_e(e,t)}/targets`},Ds=["permission-denied","invalid-argument","unauthenticated","not-found","already-exists","failed-precondition"];async function P(e,t={}){const r=typeof t=="number"?{maxRetries:t}:t,{maxRetries:a=3,initialDelay:n=1e3,onError:o,onFinalFailure:i}=r;let l;for(let c=0;c<=a;c++)try{return await e()}catch(d){if(l=d,o&&o(d,c),c===a)break;const h=(d==null?void 0:d.code)||"";if(Ds.some(y=>h.includes(y)))throw i&&i(d),d;const p=n*Math.pow(2,c);await new Promise(y=>setTimeout(y,p))}throw i&&i(l),l}class Is{constructor(){A(this,"cachedWorkspacesMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}isInitialized(t){return this.cachedWorkspacesMap.has(t)}notifyListeners(t){const r=this.cachedWorkspacesMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}setCache(t,r){this.cachedWorkspacesMap.set(t,r),this.notifyListeners(t)}getWorkspaces(t){return this.cachedWorkspacesMap.get(t)||[]}subscribe(t,r){this.listeners.has(t)||this.listeners.set(t,new Set);const a=this.listeners.get(t);a.add(r);const n=this.cachedWorkspacesMap.get(t);if(n&&queueMicrotask(()=>r([...n])),!this.unsubscribes.has(t)){const o=_.workspaces(t),i=de(L(v,o),ft("createdAt","asc"));console.log(`[WorkspaceCache] Subscribing to path: ${o}`);const l=je(i,c=>{const d=c.docs.map(u=>({id:u.id,...u.data()}));console.log(`[WorkspaceCache] Received ${d.length} workspaces from Firestore`);const h=d.filter(u=>{const p=wt.safeParse(u);return p.success?!0:(console.error("[WorkspaceCache] Invalid workspace data:",u,p.error),!1)});this.cachedWorkspacesMap.set(t,h),this.notifyListeners(t)},c=>{console.error("[WorkspaceCache] Subscription error:",c),this.cachedWorkspacesMap.set(t,[]),this.notifyListeners(t)});this.unsubscribes.set(t,l)}return()=>{var o;a.delete(r),a.size===0&&((o=this.unsubscribes.get(t))==null||o(),this.unsubscribes.delete(t),this.listeners.delete(t))}}clearCache(t){var r;this.cachedWorkspacesMap.delete(t),(r=this.unsubscribes.get(t))==null||r(),this.unsubscribes.delete(t),this.listeners.delete(t)}}const X=new Is,Es=e=>X.isInitialized(e),Ss=e=>X.getWorkspaces(e);function Ms(e,t){return X.subscribe(e,t)}async function lr(e,t){const r=X.getWorkspaces(e);wt.pick({name:!0}).parse({name:t});const a="temp-"+Date.now(),n={id:a,name:t,createdAt:new Date};X.setCache(e,[...r,n]);const o=_.workspaces(e);console.log(`[WorkspaceCache] Adding workspace to path: ${o}`);let i=a;return await P(async()=>{const l=await U(L(v,o),{name:t,createdAt:Z()});i=l.id,console.log(`[WorkspaceCache] Successfully added workspace with ID: ${l.id}`)},{onFinalFailure:()=>{console.error(`[WorkspaceCache] Failed to add workspace: ${t}`),X.setCache(e,r),j.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}}),{id:i,name:t}}async function As(e,t,r=null){const a=_.workspaces(e),n=de(L(v,a),Vr("name","==",t),qt(5));return(await ie(n)).docs.some(i=>i.id!==r)}async function Ls(e,t,r){const a=X.getWorkspaces(e),n=a.map(o=>o.id===t?{...o,...r}:o);X.setCache(e,n),await P(async()=>{const o=_.workspaces(e),i=z(v,o,t);await De(i,r)},{onFinalFailure:()=>{X.setCache(e,a),j.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Rs(e,t){const r=X.getWorkspaces(e),a=r.filter(n=>n.id!==t);X.setCache(e,a),await P(async()=>{const n=_.workspaces(e);await Ie(z(v,n,t))},{onFinalFailure:()=>{X.setCache(e,r),j.error("ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Fs(e){try{const t=_.workspaces(e);(await ie(de(L(v,t),qt(1)))).empty&&await lr(e,"ãƒ¡ã‚¤ãƒ³")}catch(t){console.error("[WorkspaceCache] Failed to ensure default workspace:",t)}}function Ps(e){var r;const t=e||((r=D.currentUser)==null?void 0:r.uid);return t?Ss(t):[]}function Os(e){var r;const t=e||((r=D.currentUser)==null?void 0:r.uid);return t?Es(t):!1}function re(){return He.getState().currentWorkspaceId}function Bs(e){if(!e)return;const t=He.getState();t.currentWorkspaceId!==e&&t.setCurrentWorkspaceId(e)}function Ws(e,t){var o;const r=typeof e=="function"?e:t,a=typeof e=="string"?e:(o=D.currentUser)==null?void 0:o.uid;return a?Ms(a,i=>{i.length===0?Fs(a).catch(l=>console.error("[Workspace] Default creation error:",l)):$s(i),typeof r=="function"&&r(i)}):(typeof r=="function"&&r([]),()=>{})}function $s(e){if(e.length===0)return null;const t=He.getState();let r=t.currentWorkspaceId;const a=r?e.some(n=>n.id===r):!1;return(!r||!a)&&(r=e[0].id,t.setCurrentWorkspaceId(r)),r}async function oi(e){const t=D.currentUser;if(!t)throw new Error("Authentication required");return lr(t.uid,e)}async function ii(e,t=null){const r=D.currentUser;return r?As(r.uid,e,t):!1}async function li(e,t){const r=D.currentUser;if(!r)throw new Error("Authentication required");return Ls(r.uid,e,{name:t})}async function ci(e){const t=D.currentUser;if(!t)throw new Error("Authentication required");return Rs(t.uid,e)}function Le(e){const t=`[ErrorLogger] [${e.type.toUpperCase()}]`,r=e.stack?`
${e.stack}`:"";e.type==="warn"?console.warn(`${t} ${e.message}${r}`):console.error(`${t} ${e.message}${r}`)}function zs(){window.onerror=(e,t,r,a,n)=>(Le({timestamp:new Date().toISOString(),type:"error",message:String(e),stack:n==null?void 0:n.stack}),!1),window.onunhandledrejection=e=>{const t=e.reason;Le({timestamp:new Date().toISOString(),type:"unhandledrejection",message:(t==null?void 0:t.message)||String(t),stack:t==null?void 0:t.stack})},console.info("[ErrorLogger] Initialized")}function qs(e,t){Le({timestamp:new Date().toISOString(),type:"react",message:e.message,stack:e.stack})}class Vs{constructor(){A(this,"initialLoginPromise",null)}getCurrentUserId(){var t;return((t=D.currentUser)==null?void 0:t.uid)||null}hasInitialToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return!0;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return!0}catch{}return!1}getInitialAuthToken(){if(typeof window<"u"&&window.GLOBAL_INITIAL_AUTH_TOKEN)return window.GLOBAL_INITIAL_AUTH_TOKEN;try{if(typeof __initial_auth_token<"u"&&__initial_auth_token)return __initial_auth_token}catch{}return null}async tryInitialTokenLogin(){if(this.initialLoginPromise)return this.initialLoginPromise;const t=this.getInitialAuthToken();if(!t){this.initialLoginPromise=Promise.resolve();return}return this.initialLoginPromise=(async()=>{try{await Kr(D,t),console.log("[Auth] Initial token login success")}catch(r){Le({timestamp:new Date().toISOString(),type:"error",message:`Initial token login failed: ${r.message}`,stack:r.stack})}})(),this.initialLoginPromise}initAuthListener(t,r){return this.tryInitialTokenLogin(),Vt(D,n=>{n?t(n):r()})}async loginWithEmail(t,r){return await zt(D,t,r)}async logout(){try{await Ur(D)}catch(t){throw Le({timestamp:new Date().toISOString(),type:"error",message:`Logout failed: ${t.message}`,stack:t.stack}),t}}async updateUserAuthPassword(t){const r=D.currentUser;if(!r)throw new Error("Authentication required: No current user.");await Hr(r,t)}}const nt=new Vs,Ks=(e,t)=>nt.initAuthListener(e,t),Us={TIMEOUT:{AUTH_LOADING:1e4}},cr=()=>{var i;const[e,t]=k.useState(((i=D.currentUser)==null?void 0:i.uid)||null),[r,a]=k.useState(D.currentUser),[n,o]=k.useState(!0);return k.useEffect(()=>{const l=new AbortController;let c=()=>{},d=null;const h=async()=>{if(nt.hasInitialToken())try{await nt.tryInitialTokenLogin()}catch(u){console.error("[useAuth] Initial token login failed:",u)}l.signal.aborted||(c=Ks(u=>{l.signal.aborted||(t(u.uid),a(u),o(!1),d&&clearTimeout(d))},()=>{l.signal.aborted||(t(null),a(null),o(!1),d&&clearTimeout(d))}))};return d=setTimeout(()=>{l.signal.aborted||(console.warn("[useAuth] Loading timeout reached, forcing loading=false"),o(!1))},Us.TIMEOUT.AUTH_LOADING),h(),()=>{l.abort(),c(),d&&clearTimeout(d)}},[]),{userId:e,user:r,loading:n}},Be=new Map;function ve(e,t,r,a){const n=Pt(),o=JSON.stringify(e),i=15e3;return k.useEffect(()=>{if(e.some(c=>c==null))return;let l=Be.get(o);return l||(l={count:0,unsubscribe:t(d=>{n.setQueryData(e,d)})},Be.set(o,l)),l.count++,()=>{const c=Be.get(o);c&&(c.count--,c.count===0&&(c.unsubscribe(),Be.delete(o)))}},[o]),Ir({queryKey:e,queryFn:()=>{const l=n.getQueryData(e);return l!==void 0?Promise.resolve(l):r!==void 0?Promise.resolve(r):new Promise(c=>{const d=setTimeout(()=>{const p=n.getQueryData(e);console.debug(`[FirestoreSub] Timeout waiting for data (monitor): ${o}`),c(p??r??null)},i),h=n.getQueryCache().subscribe(p=>{if(p.type==="updated"&&JSON.stringify(p.query.queryKey)===o){const y=p.query.state.data;y!==void 0&&(clearTimeout(d),h(),c(y))}}),u=n.getQueryData(e);u!==void 0&&(clearTimeout(d),h(),c(u))})},initialData:r,staleTime:1/0,gcTime:1e3*60*5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1})}const Hs=()=>{const{userId:e,loading:t}=cr(),r=k.useCallback(c=>e?Ws(e,c):()=>{},[e]),n=(e?Os(e):!1)&&e?Ps(e):void 0,{data:o,isPending:i}=ve(["workspaces",e||void 0],r,n);return{workspaces:o||[],loading:t||!!e&&i}},oe=()=>{const e=He(a=>a.currentWorkspaceId),{userId:t,loading:r}=cr();return{workspaceId:e,userId:t,loading:r}},Gs=()=>{const{t:e}=M(),{workspaces:t,loading:r}=Hs(),{openModal:a}=ne(),[n,o]=k.useState(!1),i=k.useRef(null),{workspaceId:l}=oe(),c=t.find(d=>d.id===l);return k.useEffect(()=>{const d=u=>{i.current&&!i.current.contains(u.target)&&o(!1)},h=u=>{u.key==="Escape"&&o(!1)};return n&&(document.addEventListener("mousedown",d),document.addEventListener("keydown",h)),()=>{document.removeEventListener("mousedown",d),document.removeEventListener("keydown",h)}},[n]),r?s.jsx("div",{className:"h-8 w-32 bg-gray-100 dark:bg-gray-800 animate-pulse rounded"}):s.jsxs("div",{className:"relative",ref:i,children:[s.jsxs("button",{onClick:()=>o(!n),className:"flex items-center gap-2 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 transition-colors group","aria-expanded":n,"aria-haspopup":"true",children:[s.jsx("span",{className:"text-sm font-bold text-gray-800 dark:text-gray-200 truncate max-w-[120px] sm:max-w-[140px] md:max-w-[180px]",children:c?c.name:e("loading")}),s.jsx(Qt,{className:T("w-4 h-4 text-gray-400 group-hover:text-gray-600 transition-transform duration-200",n?"rotate-180":"")})]}),n&&s.jsxs("div",{className:"absolute left-0 mt-2 w-60 sm:w-64 max-w-[calc(100vw-32px)] origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 border border-gray-100 dark:border-gray-700 overflow-hidden animate-scale-in custom-scrollbar",style:{zIndex:N.Z_INDEX.DROPDOWN},children:[s.jsx("div",{className:"p-1 border-b border-gray-200 dark:border-gray-700 bg-gray-50/50 dark:bg-gray-800/50",children:s.jsxs("button",{onClick:()=>{o(!1),a("workspace-edit",null)},className:"flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors rounded-md",children:[s.jsx(Yt,{className:"w-4 h-4 mr-2"}),e("sidebar.add_workspace")]})}),s.jsx("div",{className:"py-1 max-h-[300px] overflow-y-auto custom-scrollbar",children:t.map(d=>{const h=d.id===l;return s.jsxs("div",{className:"flex items-center justify-between group/item px-4 py-2 hover:bg-gray-50 dark:hover:bg-gray-700 transition-colors",children:[s.jsx("button",{onClick:()=>{d.id&&Bs(d.id),o(!1)},className:T("flex-1 text-left text-sm truncate mr-2",h?"text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300"),children:s.jsx("span",{className:"truncate block max-w-[120px] sm:max-w-[140px]",children:d.name})}),s.jsxs("div",{className:"flex items-center gap-1",children:[h&&s.jsx(Pe,{className:"w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0"}),s.jsx("button",{onClick:u=>{u.stopPropagation(),o(!1),a("workspace-edit",d)},className:"p-1 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 rounded opacity-0 group-hover/item:opacity-100 transition-opacity",title:e("edit"),children:s.jsx(Jt,{className:"w-3.5 h-3.5"})})]})]},d.id)})})]})]})},Xs=({sidebarContent:e,title:t,children:r})=>{const{toggleSidebar:a,isSidebarOpen:n}=bt(),{t:o}=M(),{openModal:i}=ne();return s.jsxs("div",{className:"w-full h-full flex overflow-hidden bg-premium-gradient text-gray-800 dark:text-white antialiased",children:[n&&s.jsx("div",{className:"fixed inset-0 bg-black/50 backdrop-blur-sm lg:hidden transition-opacity duration-300",style:{zIndex:N.Z_INDEX.SIDEBAR_BACKDROP},onClick:a}),s.jsx(Ns,{children:e}),s.jsxs("div",{className:"flex-1 flex flex-col relative overflow-hidden",children:[s.jsxs("header",{className:"h-12 border-b border-gray-200 dark:border-gray-800 flex items-center px-4 justify-between bg-white/80 dark:bg-gray-900/80 backdrop-blur-sm z-10 sticky top-0",children:[s.jsxs("div",{className:"flex items-center gap-3",children:[!n&&s.jsx("button",{onClick:a,className:"p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-800 transition-colors",title:o("sidebar.menu_open"),"aria-label":o("sidebar.menu_open"),children:s.jsx(gs,{className:"w-5 h-5"})}),s.jsx(Gs,{}),s.jsx("h1",{className:"font-bold text-lg border-l border-gray-300 dark:border-gray-700 pl-3 ml-1 truncate",children:t})]}),s.jsx("div",{className:"flex items-center gap-2",children:s.jsx("button",{onClick:()=>i("settings"),className:"p-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors",title:"Settings","aria-label":"Settings",children:s.jsx(Jt,{className:"w-5 h-5"})})})]}),s.jsx("main",{className:"flex-1 overflow-hidden flex flex-col",id:"main-content",children:s.jsx("div",{className:T("w-full h-full bg-white dark:bg-gray-900 relative flex-1",N.LAYOUT.CONTAINER_WIDTH_CLASS),children:r})})]})]})},Ys=S.lazy(()=>ae(()=>import("./FilterEditModal-BWGXB7Qe.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8])).then(e=>({default:e.FilterEditModal}))),Js=S.lazy(()=>ae(()=>import("./LabelEditModal-CY4Fso0E.js"),__vite__mapDeps([9,1,2,3,6,7,8,5,4])).then(e=>({default:e.LabelEditModal}))),Qs=S.lazy(()=>ae(()=>import("./ProjectEditModal-CyiVRJQl.js"),__vite__mapDeps([10,1,2,3,6,7,8,5,4])).then(e=>({default:e.ProjectEditModal}))),Zs=S.lazy(()=>ae(()=>import("./SettingsModal-CusrrClN.js"),__vite__mapDeps([11,1,2,3,4,7,5,8])).then(e=>({default:e.SettingsModal}))),ea=S.lazy(()=>ae(()=>import("./TaskDetailModal-BovXqXB8.js"),__vite__mapDeps([12,1,2,3,5,4,6,7,8])).then(e=>({default:e.TaskDetailModal}))),ta=S.lazy(()=>ae(()=>import("./TimeBlockEditModal-hYY43PBO.js"),__vite__mapDeps([13,1,2,3,8,4,6,7,5])).then(e=>({default:e.TimeBlockEditModal}))),ra=S.lazy(()=>ae(()=>import("./WorkspaceEditModal-CdDIxJ3A.js"),__vite__mapDeps([14,1,2,3,6,7,8,5,4])).then(e=>({default:e.WorkspaceEditModal}))),sa=S.lazy(()=>ae(()=>import("./WikiFrameworkModal-CQYkMwSF.js"),__vite__mapDeps([15,1,2,3,7,4,8,5])).then(e=>({default:e.WikiFrameworkModal}))),aa=S.lazy(()=>ae(()=>import("./ConfirmationModal-nDENARZf.js"),__vite__mapDeps([16,1,2,3,7,8,5,4])).then(e=>({default:e.ConfirmationModal}))),na=()=>{const{stack:e}=ne();return e.length===0?null:s.jsx(k.Suspense,{fallback:null,children:e.map((t,r)=>{const n=r===0?void 0:"bg-black/30",o={isOpen:!0,data:t.data,zIndex:N.Z_INDEX.MODAL+r*10,overlayClassName:n};switch(t.type){case"settings":return s.jsx(Zs,{...o},t.id);case"task-detail":return s.jsx(ea,{...o},t.id);case"label-edit":return s.jsx(Js,{...o},t.id);case"project-edit":return s.jsx(Qs,{...o},t.id);case"workspace-edit":return s.jsx(ra,{...o},t.id);case"filter-edit":return s.jsx(Ys,{...o},t.id);case"timeblock-edit":return s.jsx(ta,{...o},t.id);case"wiki-framework":return s.jsx(sa,{...o},t.id);case"confirmation":return s.jsx(aa,{...o},t.id);default:return null}})})};function $(e){if(!e)return null;if(e instanceof Date)return e;if(e.toDate&&typeof e.toDate=="function")return e.toDate();const t=new Date(e);return isNaN(t.getTime())?null:t}const At=(e,t)=>{const r=$(e),a=$(t);return!r||!a?!1:r.getFullYear()===a.getFullYear()&&r.getMonth()===a.getMonth()&&r.getDate()===a.getDate()},oa=e=>{const t=$(e);if(!t)return!1;const r=new Date;return t.getFullYear()===r.getFullYear()&&t.getMonth()===r.getMonth()&&t.getDate()===r.getDate()},ia=(e,t=7)=>{const r=$(e);if(!r)return!1;const a=new Date;a.setHours(0,0,0,0);const n=new Date(a);n.setDate(a.getDate()+1);const o=new Date(a);return o.setDate(a.getDate()+t+1),r>=n&&r<o};function Ge(e=new Date){const t=$(e)||new Date,r=new Date(t);return r.setHours(0,0,0,0),r}function la(e=new Date,t=1){const r=$(e)||new Date,a=r.getDay(),n=r.getDate()-a+(a<t?t-7:t),o=new Date(r);return o.setDate(n),Ge(o)}function Lt(e){const t=$(e);if(!t)return"";const r=new Date,a=Ge(r),n=Math.round((t.getTime()-a.getTime())/(1e3*60*60*24));if(n===0)return"ä»Šæ—¥";if(n===1)return"æ˜Žæ—¥";if(n===-1)return"æ˜¨æ—¥";const o=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),l=String(t.getDate()).padStart(2,"0");return o!==r.getFullYear()?`${o}/${i}/${l}`:`${i}/${l}`}const di=e=>{const t=$(e);if(!t)return"";const r=t.getFullYear(),a=String(t.getMonth()+1).padStart(2,"0"),n=String(t.getDate()).padStart(2,"0");return`${r}-${a}-${n}`},ui=e=>{if(!e)return null;const t=new Date(e);return isNaN(t.getTime())?null:t};function ca(e){const t=$(e);if(!t)return"text-gray-500";const r=Ge(new Date),a=Math.round((t.getTime()-r.getTime())/(1e3*60*60*24));return a<0?"text-red-500 font-bold":a===0?"text-green-600 dark:text-green-400 font-medium":a===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function da(e,t){var a;if(!e||!(t!=null&&t.type))return null;const r=new Date($(e));switch(t.type){case"daily":return r.setDate(r.getDate()+1),r;case"weekly":{if(!((a=t.days)!=null&&a.length))return null;const n=r.getDay();for(let o=1;o<=7;o++){const i=(n+o)%7;if(t.days.includes(i))return r.setDate(r.getDate()+o),r}return null}case"weekdays":do r.setDate(r.getDate()+1);while(r.getDay()===0||r.getDay()===6);return r;case"monthly":return r.setMonth(r.getMonth()+1),r;default:return null}}function hi(e){const t=Ge(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&e.days&&e.days.length>0){const r=t.getDay();for(let a=0;a<=6;a++)if(e.days.includes((r+a)%7))return t.setDate(t.getDate()+a),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function ua(e,t){if(!e||!t)return 0;const[r,a]=e.split(":").map(Number),[n,o]=t.split(":").map(Number);if(isNaN(r)||isNaN(a)||isNaN(n)||isNaN(o))return 0;const i=r*60+a;let l=n*60+o;return l<i&&(l+=1440),l-i}const he=Ut([G(),b(),Zr(),es()]),ha=V({id:b(),title:b().min(1),description:b().nullable().optional(),status:ze(["todo","completed","archived"]).optional(),dueDate:he,completedAt:he,createdAt:he,ownerId:b().optional(),projectId:b().nullable().optional(),labelIds:se(b()).optional(),timeBlockId:b().nullable().optional(),duration:G().optional(),isImportant:Ht().optional(),recurrence:V({type:ze(["none","daily","weekly","weekdays","monthly"]).optional(),days:se(G()).optional()}).nullable().optional(),order:G().optional()}).passthrough(),ga=V({id:b(),name:b().min(1),color:b().optional(),ownerId:b().optional(),createdAt:he,order:G().optional()}).passthrough(),ma=V({id:b(),name:b().min(1),color:b().optional(),ownerId:b().optional(),createdAt:he}).passthrough(),pa=V({id:b(),mode:b(),data:Gt(b(),b()),createdAt:he,updatedAt:he,ownerId:b().optional(),workspaceId:b().optional()}).passthrough(),fa=V({id:b(),name:b().min(1),start:b(),end:b(),color:b().optional(),order:G().optional()}).passthrough(),xa=V({id:b(),name:b().min(1),query:b(),createdAt:he}).passthrough(),ba=V({version:b().optional(),exportedAt:b().optional(),userId:b().optional(),workspaceId:b().optional(),tasks:se(ha).default([]),projects:se(ga).default([]),labels:se(ma).default([]),targets:se(pa).default([]),timeBlocks:se(fa).default([]),customFilters:se(xa).default([])}),ya=e=>e instanceof Date?Fe.fromDate(e):e,pe=e=>{if(e!=null){if(typeof e=="number")return new Date(e);if(typeof e=="string")return new Date(e)}};async function gi(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");try{const r=L(v,_.tasks(e,t)),a=L(v,_.projects(e,t)),n=L(v,_.labels(e,t)),o=L(v,_.targets(e,t)),i=L(v,_.timeblocks(e,t)),l=L(v,_.filters(e,t)),[c,d,h,u,p,y]=await Promise.all([ie(r),ie(a),ie(n),ie(o),ie(i),ie(l)]),x=g=>g.docs.map(w=>{const C=w.data(),m={id:w.id};for(const f in C){const E=C[f];m[f]=E instanceof Fe?E.toMillis():E}return m});return{version:"1.4",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:x(c),projects:x(d),labels:x(h),targets:x(u),timeBlocks:x(p),customFilters:x(y)}}catch(r){throw console.error("[Backup] createBackupData failed:",r),r}}async function mi(e,t,r){var i;if(!e||!t)throw new Error("Invalid import parameters: userId and workspaceId are required.");if(!r)throw new Error("Invalid import parameters: backupData is required.");const a=ba.safeParse(r);if(!a.success)throw console.error("[Backup] Validation failed:",a.error.format()),new Error(`ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ã‚¿ã®å½¢å¼ãŒä¸æ­£ã§ã™: ${a.error.issues.map(l=>l.message).join(", ")}`);const n=a.data,o=[];try{const{tasks:l,projects:c,labels:d,targets:h,timeBlocks:u,customFilters:p}=n,y=new Map,x=new Map,g=await ie(L(v,_.labels(e,t))),w=new Map;g.forEach(m=>w.set(m.data().name,m.id));for(const m of d)try{const f=(i=m.name)==null?void 0:i.trim();if(!f)continue;if(w.has(f))x.set(m.id,w.get(f));else{const E={...m,name:f};delete E.id;const R=await U(L(v,_.labels(e,t)),E);x.set(m.id,R.id),w.set(f,R.id)}}catch(f){o.push(`ãƒ©ãƒ™ãƒ« "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of c)try{const f={...m};delete f.id,f.createdAt=pe(m.createdAt);const E=await U(L(v,_.projects(e,t)),f);y.set(m.id,E.id)}catch(f){o.push(`ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of u)try{const f={...m};delete f.id,await U(L(v,_.timeblocks(e,t)),f)}catch(f){o.push(`ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of p)try{const f={...m};delete f.id,f.createdAt=pe(m.createdAt),await U(L(v,_.filters(e,t)),f)}catch(f){o.push(`ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ "${m.name}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}for(const m of h)try{const f={...m};delete f.id,f.createdAt=pe(m.createdAt),f.updatedAt=pe(m.updatedAt),f.ownerId=e,f.workspaceId=t,await U(L(v,_.targets(e,t)),f)}catch(f){o.push(`ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ (mode: ${m.mode}) ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}const C=l.map(async m=>{try{const f={...m};delete f.id,f.createdAt=pe(m.createdAt);const E=pe(m.dueDate);f.dueDate=E?ya(E):null,f.completedAt=pe(m.completedAt),m.projectId&&y.has(m.projectId)?f.projectId=y.get(m.projectId):f.projectId=null,Array.isArray(m.labelIds)&&(f.labelIds=m.labelIds.map(R=>x.get(R)).filter(R=>!!R)),f.ownerId=e,await U(L(v,_.tasks(e,t)),f)}catch(f){o.push(`ã‚¿ã‚¹ã‚¯ "${m.title}" ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã«å¤±æ•—: ${f}`)}});return await Promise.all(C),{tasksCount:l.length,projectsCount:c.length,labelsCount:d.length,targetsCount:h.length,timeBlocksCount:u.length,filtersCount:p.length,errors:o}}catch(l){throw console.error("[Backup] importBackupData failed:",l),l}}const fe=class fe{constructor(){A(this,"cacheMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}static getInstance(){return fe.instance||(fe.instance=new fe),fe.instance}getFilters(t){return this.cacheMap.get(t)||[]}isInitialized(t){return this.cacheMap.has(t)}setCache(t,r){this.cacheMap.set(t,r),this.notify(t)}clearCache(t){t?(this.cacheMap.delete(t),this.notify(t)):this.cacheMap.clear()}notify(t){const r=this.getFilters(t),a=this.listeners.get(t);a&&a.forEach(n=>n([...r]))}subscribe(t,r,a){if(!t||!r)return a([]),()=>{};this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(a);const n=this.cacheMap.get(r);if(n&&queueMicrotask(()=>a([...n])),!this.unsubscribes.has(r)){const o=_.filters(t,r),i=de(L(v,o)),l=je(i,c=>{const d=c.docs.map(h=>({id:h.id,...h.data()}));this.cacheMap.set(r,d),this.notify(r)},c=>{console.error("[Filters] Subscription error:",c),this.cacheMap.set(r,[]),this.notify(r)});this.unsubscribes.set(r,l)}return()=>{const o=this.listeners.get(r);o&&o.delete(a)}}};A(fe,"instance");let ot=fe;const Y=ot.getInstance();function ka(e,t,r){return Y.subscribe(e,t,r)}function wa(e){return Y.getFilters(e)}function ja(e){return Y.isInitialized(e)}async function va(e,t,r){const a=Y.getFilters(t),n="temp_"+Date.now(),o={...r,id:n,createdAt:new Date};Y.setCache(t,[...a,o]);const i=_.filters(e,t);return P(async()=>(await U(L(v,i),{...r,createdAt:Z()})).id,{onFinalFailure:()=>{Y.setCache(t,a),j.error("ãƒ•ã‚£ãƒ«ã‚¿ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Na(e,t,r,a){const n=Y.getFilters(t),o=n.map(l=>l.id===r?{...l,...a}:l);Y.setCache(t,o);const i=_.filters(e,t);return P(async()=>{await De(z(v,i,r),{...a,updatedAt:Z()})},{onFinalFailure:()=>{Y.setCache(t,n),j.error("ãƒ•ã‚£ãƒ«ã‚¿ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function _a(e,t,r){const a=Y.getFilters(t),n=a.filter(i=>i.id!==r);Y.setCache(t,n);const o=_.filters(e,t);return P(async()=>{await Ie(z(v,o,r))},{onFinalFailure:()=>{Y.setCache(t,a),j.error("ãƒ•ã‚£ãƒ«ã‚¿ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const jt=()=>me(W.getState().language).t;function Ca(e){return e?wa(e):[]}function Ta(e){return ja(e)}function Da(e,t){var a;const r=(a=D.currentUser)==null?void 0:a.uid;return!r||!e?(t([]),()=>{}):ka(r,e,t)}async function pi(e){var c;const t=jt(),r=(c=D.currentUser)==null?void 0:c.uid;if(!r)throw j.error(t("validation.auth_required")),new Error("Authentication required");const{workspaceId:a,...n}=e;if(!a)throw j.error(t("validation.workspace_required")),new Error("Workspace ID required");const o=ir.pick({name:!0,query:!0}).safeParse(n);if(!o.success){const d=o.error.issues.map(h=>h.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),j.error(`${t("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=n;await va(r,a,{name:l.name,query:l.query,workspaceId:a,ownerId:r})}async function fi(e,t,r){var c;const a=jt(),n=(c=D.currentUser)==null?void 0:c.uid;if(!n||!e)throw j.error(a("validation.auth_required")),new Error("Authentication required");const o=ir.partial().safeParse(r);if(!o.success){const d=o.error.issues.map(h=>h.message).join(", ");throw console.error("[Filters] Validation failed:",o.error.flatten()),j.error(`${a("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}const{id:i,...l}=r;await Na(n,e,t,l)}async function Ia(e,t){var n;const r=jt(),a=(n=D.currentUser)==null?void 0:n.uid;if(!a||!e)throw j.error(r("validation.auth_required")),new Error("Authentication required");await _a(a,e,t)}class Ea{constructor(){A(this,"cachedLabelsMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}isInitialized(t){return this.cachedLabelsMap.has(t)}notifyListeners(t){const r=this.cachedLabelsMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}setCache(t,r){this.cachedLabelsMap.set(t,r),this.notifyListeners(t)}getLabels(t){return this.cachedLabelsMap.get(t)||[]}subscribe(t,r,a){this.listeners.has(r)||this.listeners.set(r,new Set);const n=this.listeners.get(r);n.add(a);const o=this.cachedLabelsMap.get(r);if(o&&queueMicrotask(()=>a([...o])),!this.unsubscribes.has(r)){const i=_.labels(t,r),l=de(L(v,i));console.log(`[LabelCache] Subscribing to path: ${i}`);const c=je(l,d=>{const h=d.docs.map(u=>({id:u.id,...u.data()}));console.log(`[LabelCache] Received ${h.length} labels from Firestore for workspace: ${r}`),this.cachedLabelsMap.set(r,h),this.notifyListeners(r)},d=>{console.error("[LabelCache] Subscription error:",d),this.cachedLabelsMap.set(r,[]),this.notifyListeners(r)});this.unsubscribes.set(r,c)}return()=>{var i;n.delete(a),n.size===0&&((i=this.unsubscribes.get(r))==null||i(),this.unsubscribes.delete(r),this.listeners.delete(r))}}}const J=new Ea,Sa=e=>J.isInitialized(e),Ma=e=>J.getLabels(e);function Aa(e,t,r){return!e||!t?(r([]),()=>{}):J.subscribe(e,t,r)}async function La(e,t,r,a){const n=J.getLabels(t),i={id:"temp-"+Date.now(),name:r,color:a,ownerId:e,createdAt:new Date};J.setCache(t,[...n,i]);const l=_.labels(e,t);return console.log(`[LabelCache] Adding label to path: ${l}`),P(async()=>{await U(L(v,l),{name:r,color:a,ownerId:e,workspaceId:t,createdAt:Z()})},{onFinalFailure:()=>{console.error(`[LabelCache] Failed to add label: ${r}`),J.setCache(t,n),j.error("ãƒ©ãƒ™ãƒ«ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ra(e,t,r,a){const n=J.getLabels(t),o=n.map(i=>i.id===r?{...i,...a}:i);return J.setCache(t,o),P(async()=>{const i=_.labels(e,t),l=z(v,i,r);await De(l,a)},{onFinalFailure:()=>{J.setCache(t,n),j.error("ãƒ©ãƒ™ãƒ«ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Fa(e,t,r){const a=J.getLabels(t),n=a.filter(o=>o.id!==r);return J.setCache(t,n),P(async()=>{const o=_.labels(e,t);await Ie(z(v,o,r))},{onFinalFailure:()=>{J.setCache(t,a),j.error("ãƒ©ãƒ™ãƒ«ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const Pa=Ma,Oa=e=>e?Sa(e):!1,Te=()=>me(W.getState().language).t;function vt(){var t;const e=(t=D.currentUser)==null?void 0:t.uid;if(!e)throw console.error("Authentication required for label operation."),new Error("Authentication required.");return e}function Ba(e,t){var a;const r=(a=D.currentUser)==null?void 0:a.uid;return r&&e?Aa(r,e,t):(t([]),()=>{})}async function xi(e,t,r){const a=Te();try{const n=vt();if(!e)throw new Error("Workspace ID required");const o={name:t,color:r,ownerId:n},i=or.pick({name:!0,color:!0,ownerId:!0}).safeParse(o);if(!i.success){const c=i.error.issues.map(d=>d.message).join(", ");throw j.error(`${a("validation.validation_error")}: ${c}`),new Error(`Validation failed: ${c}`)}return await La(n,e,t,r)}catch(n){throw console.error("Failed to add label:",n),n.message.includes("Validation")||j.error(Te()("msg.label.create_fail")),n}}async function bi(e,t,r){const a=Te();try{const n=vt();if(!e)throw new Error("Workspace ID required");const o=or.partial().safeParse(r);if(!o.success){const l=o.error.issues.map(c=>c.message).join(", ");throw j.error(`${a("validation.validation_error")}: ${l}`),new Error(`Validation failed: ${l}`)}return await Ra(n,e,t,r)}catch(n){throw console.error("Failed to update label:",n),n.message.includes("Validation")||j.error(Te()("msg.label.update_fail")),n}}async function yi(e,t){try{const r=vt();if(!e)throw new Error("Workspace ID required");const a=await Fa(r,e,t);return j.success(Te()("msg.label.delete_success")),a}catch(r){throw console.error("Failed to delete label:",r),j.error(Te()("msg.label.delete_fail")),r}}function Wa(e,t){return e===t?!0:!e||!t||e.length!==t.length?!1:JSON.stringify(e)===JSON.stringify(t)}function $a(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;const r=[...e].sort((n,o)=>(n.id||"").localeCompare(o.id||"")),a=[...t].sort((n,o)=>(n.id||"").localeCompare(o.id||""));for(let n=0;n<r.length;n++){const o=r[n],i=a[n];if(o.id!==i.id||o.status!==i.status||o.title!==i.title||o.description!==i.description||o.projectId!==i.projectId||o.timeBlockId!==i.timeBlockId||o.duration!==i.duration||o.isImportant!==i.isImportant)return!1;const l=c=>c==null?c:c instanceof Date?c.getTime():typeof(c==null?void 0:c.toMillis)=="function"?c.toMillis():c;if(l(o.dueDate)!==l(i.dueDate))return!1}return!0}function za(e,t){if(e===t)return!0;if(!e||!t||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].id!==t[r].id||e[r].name!==t[r].name||e[r].color!==t[r].color)return!1;return!0}class qa{constructor(){A(this,"cachedProjectsMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}isInitialized(t){return this.cachedProjectsMap.has(t)}notifyListeners(t){const r=this.cachedProjectsMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}setCache(t,r){this.cachedProjectsMap.set(t,r),this.notifyListeners(t)}getProjects(t){return this.cachedProjectsMap.get(t)||[]}subscribe(t,r,a){this.listeners.has(r)||this.listeners.set(r,new Set);const n=this.listeners.get(r);n.add(a);const o=this.cachedProjectsMap.get(r);if(o&&queueMicrotask(()=>a([...o])),!this.unsubscribes.has(r)){const i=_.projects(t,r),l=de(L(v,i));console.log(`[ProjectCache] Subscribing to path: ${i} for user: ${t}`);const c=je(l,d=>{const h=d.docs.map(p=>({id:p.id,...p.data()}));console.log(`[ProjectCache] Received ${h.length} projects from Firestore for workspace: ${r}`);const u=this.cachedProjectsMap.get(r);if(u&&za(u,h)){console.log("[ProjectCache] Data identical, skipping update");return}console.log("[ProjectCache] Updating cache and notifying listeners"),this.cachedProjectsMap.set(r,h),this.notifyListeners(r)},d=>{console.error("[ProjectCache] Subscription error:",d),this.cachedProjectsMap.set(r,[]),this.notifyListeners(r)});this.unsubscribes.set(r,c)}return()=>{var i;n.delete(a),n.size===0&&((i=this.unsubscribes.get(r))==null||i(),this.unsubscribes.delete(r),this.listeners.delete(r))}}}const q=new qa,Va=e=>q.isInitialized(e),Ka=e=>q.getProjects(e),Ua=(e,t)=>q.setCache(e,t);function Ha(e,t,r){return q.subscribe(e,t,r)}async function Ga(e,t,r,a){const n=q.getProjects(t),i={id:"temp-"+Date.now(),name:r,color:a,ownerId:e,createdAt:new Date};q.setCache(t,[...n,i]);const l=_.projects(e,t);return console.log(`[ProjectCache] Adding project to path: ${l}`),P(async()=>{const c=await U(L(v,l),{name:r,color:a,ownerId:e,createdAt:Z()});console.log(`[ProjectCache] Successfully added project with ID: ${c.id}`)},{onFinalFailure:()=>{console.error(`[ProjectCache] Failed to add project: ${r}`),q.setCache(t,n),j.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Xa(e,t,r,a){const n=q.getProjects(t),o=n.map(i=>i.id===r?{...i,...a}:i);return q.setCache(t,o),P(async()=>{const i=_.projects(e,t),l=z(v,i,r);await De(l,a)},{onFinalFailure:()=>{q.setCache(t,n),j.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ya(e,t,r){const a=q.getProjects(t),n=a.filter(o=>o.id!==r);return q.setCache(t,n),P(async()=>{const o=_.projects(e,t);await Ie(z(v,o,r))},{onFinalFailure:()=>{q.setCache(t,a),j.error("ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Ja(e,t,r){const a=q.getProjects(t);return q.setCache(t,r),P(async()=>{const n=xt(v),o=_.projects(e,t);r.forEach((i,l)=>{if(i.id&&!i.id.startsWith("temp-")){const c=z(v,o,i.id);n.update(c,{order:l})}}),await n.commit()},{onFinalFailure:()=>{q.setCache(t,a),j.error("ä¸¦ã³æ›¿ãˆã®ä¿å­˜ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const ke=()=>me(W.getState().language).t;function Nt(){var r;const e=(r=D.currentUser)==null?void 0:r.uid,t=re();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const Qa=e=>{const t=e||re();return t?Ka(t):[]},Za=e=>{const t=e||re();return t?Va(t):!1},en=(e,t)=>{const r=t||re();r&&Ua(r,e)},tn=(e,t)=>{const r=typeof e=="function"?e:t,a=typeof e=="string"?e:re(),n=D.currentUser;return n&&a&&typeof r=="function"?Ha(n.uid,a,r):(typeof r=="function"&&r([]),()=>{})},ki=async(e,t=null,r)=>{const a=ke();try{const n=D.currentUser;if(!n)throw new Error("Authentication required.");const o=t||re();if(!o)throw new Error("Workspace selection required.");const i={name:e,color:r,ownerId:n.uid},l=nr.pick({name:!0,color:!0,ownerId:!0}).safeParse(i);if(!l.success){const d=l.error.issues.map(h=>h.message).join(", ");throw j.error(`${a("validation.validation_error")}: ${d}`),new Error(`Validation failed: ${d}`)}return await Ga(n.uid,o,e,r)}catch(n){throw console.error("Failed to add project:",n),n.message.includes("Validation")||j.error(ke()("msg.project.create_fail")),n}},wi=async(e,t)=>{const r=ke();try{const{userId:a,workspaceId:n}=Nt(),o=nr.partial().safeParse(t);if(!o.success){const i=o.error.issues.map(l=>l.message).join(", ");throw j.error(`${r("validation.validation_error")}: ${i}`),new Error(`Validation failed: ${i}`)}await Xa(a,n,e,t)}catch(a){throw console.error("Failed to update project:",a),a.message.includes("Validation")||j.error(ke()("msg.project.update_fail")),a}},rn=async e=>{try{const{userId:t,workspaceId:r}=Nt();await Ya(t,r,e),j.success(ke()("msg.project.delete_success"))}catch(t){throw console.error("Failed to delete project:",t),j.error(ke()("msg.project.delete_fail")),t}},sn=async e=>{try{const{userId:t,workspaceId:r}=Nt();await Ja(t,r,e)}catch(t){throw console.error("Failed to reorder projects:",t),j.error(ke()("msg.project.reorder_fail")),t}};class an{constructor(){A(this,"cachedTargetsMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}isInitialized(t){return this.cachedTargetsMap.has(t)}notifyListeners(t){const r=this.cachedTargetsMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}setCache(t,r){this.cachedTargetsMap.set(t,r),this.notifyListeners(t)}getTargets(t){return this.cachedTargetsMap.get(t)||[]}subscribe(t,r,a){this.listeners.has(r)||this.listeners.set(r,new Set);const n=this.listeners.get(r);n.add(a);const o=this.cachedTargetsMap.get(r);if(o&&queueMicrotask(()=>a([...o])),!this.unsubscribes.has(r)){const i=_.targets(t,r),l=de(L(v,i),ft("createdAt","desc"));console.log(`[TargetCache] Subscribing to path: ${i}`);const c=je(l,d=>{const h=d.docs.map(p=>({id:p.id,...p.data()})),u=this.cachedTargetsMap.get(r);u&&Wa(u,h)||(console.log(`[TargetCache] Received ${h.length} targets from Firestore for workspace: ${r}`),this.cachedTargetsMap.set(r,h),this.notifyListeners(r))},d=>{console.error("[TargetCache] Subscription error:",d),this.cachedTargetsMap.set(r,[]),this.notifyListeners(r)});this.unsubscribes.set(r,c)}return()=>{var i;n.delete(a),n.size===0&&((i=this.unsubscribes.get(r))==null||i(),this.unsubscribes.delete(r),this.listeners.delete(r))}}}const Ce=new an,nn=e=>Ce.isInitialized(e),on=e=>Ce.getTargets(e);function ln(e,t,r,a){return!e||!t?(r([]),()=>{}):Ce.subscribe(e,t,n=>{r(n)})}async function cn(e,t,r){const a=Ce.getTargets(t),o={id:"temp-"+Date.now(),mode:r.mode||"",data:r.data||{},ownerId:e,workspaceId:t,createdAt:new Date,updatedAt:new Date,...r};return Ce.setCache(t,[o,...a]),P(async()=>{const i=_.targets(e,t),l={...r,ownerId:e,workspaceId:t,createdAt:Z(),updatedAt:Z()};delete l.id,await U(L(v,i),l)},{onFinalFailure:()=>{console.error("[TargetCache] Failed to add target"),Ce.setCache(t,a),j.error("ç›®æ¨™ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}function dn(){var t;const e=(t=D.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}const un=e=>{const t=e||re();return t?on(t):[]},hn=e=>{const t=e||re();return t?nn(t):!1},gn=(e,t,r)=>{const a=D.currentUser;return a&&e&&typeof t=="function"?ln(a.uid,e,t):(typeof t=="function"&&t([]),()=>{})},mn=async(e,t)=>{const r=dn();if(!e)throw new Error("Workspace ID required.");return cn(r,e,t)},tt=e=>e instanceof Fe?e.toDate():e instanceof Date?e:void 0,dr=e=>e instanceof Date?Fe.fromDate(e):e;function pn(e,t){if(!t||typeof t!="object")return console.warn(`[deserializeTask] Invalid data for task ${e}:`,t),{id:e,title:"Invalid Task",status:"todo",ownerId:""};const r=t.recurrence||null,a={id:e,title:String(t.title||"Untitled"),description:t.description?String(t.description):null,status:t.status==="completed"||t.status==="todo"||t.status==="archived"?t.status:"todo",dueDate:tt(t.dueDate)||void 0,createdAt:tt(t.createdAt)||void 0,completedAt:tt(t.completedAt)||void 0,ownerId:String(t.ownerId||""),projectId:t.projectId?String(t.projectId):null,labelIds:Array.isArray(t.labelIds)?t.labelIds.map(String):[],timeBlockId:t.timeBlockId?String(t.timeBlockId):null,duration:typeof t.duration=="number"?t.duration:null,isImportant:!!t.isImportant,recurrence:r};return kt.safeParse(a).success,a}const xe=class xe{constructor(){A(this,"cachedTasksMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map);A(this,"currentWorkspaceId",null)}static getInstance(){return xe.instance||(xe.instance=new xe),xe.instance}notifyListeners(t){const r=this.cachedTasksMap.get(t)||[],a=this.listeners.get(t);if(a){const n=[...r];a.forEach(o=>o(n))}}reset(t){var r;t?((r=this.unsubscribes.get(t))==null||r(),this.unsubscribes.delete(t),this.listeners.delete(t),this.cachedTasksMap.delete(t)):(this.unsubscribes.forEach(a=>a()),this.unsubscribes.clear(),this.listeners.clear(),this.cachedTasksMap.clear()),this.currentWorkspaceId=null}getTask(t,r){const a=this.cachedTasksMap.get(t);return a==null?void 0:a.find(n=>n.id===r)}getTasks(t){return this.cachedTasksMap.get(t)||[]}isInitialized(t){return this.cachedTasksMap.has(t)}setCache(t,r){this.cachedTasksMap.set(t,r),this.notifyListeners(t)}subscribe(t,r,a,n){if(!t||!r)return a([]),()=>{};this.currentWorkspaceId=r,this.listeners.has(r)||this.listeners.set(r,new Set);const o=this.listeners.get(r);o.add(a);const i=this.cachedTasksMap.get(r);if(i&&queueMicrotask(()=>a([...i])),!this.unsubscribes.has(r)){const l=_.tasks(t,r),c=de(L(v,l)),d=je(c,h=>{const u=h.docs.map(y=>pn(y.id,y.data())),p=this.cachedTasksMap.get(r);p&&$a(p,u)||(this.cachedTasksMap.set(r,u),this.notifyListeners(r))},h=>{console.error("[Tasks] Subscription error:",h),n&&n(h)});this.unsubscribes.set(r,d)}return()=>{if(o.delete(a),o.size===0){const l=this.unsubscribes.get(r);l&&(l(),this.unsubscribes.delete(r))}}}};A(xe,"instance");let it=xe;const K=it.getInstance();function ur(e,t){return K.getTask(e,t)}function fn(e){return K.getTasks(e)}function xn(e){return K.isInitialized(e)}function bn(e,t,r,a){return K.subscribe(e,t,r,a)}function hr(e){return Object.fromEntries(Object.entries(e).filter(([t,r])=>r!==void 0))}async function yn(e,t,r){const a=new Map;r.forEach((o,i)=>a.set(o,i));const n=K.getTasks(t);if(n&&n.length>0){const o=n.map(i=>{const l=a.get(i.id);return l!==void 0?{...i,order:l}:i});o.sort((i,l)=>{const c=i.order??Number.MAX_SAFE_INTEGER,d=l.order??Number.MAX_SAFE_INTEGER;return c-d}),K.setCache(t,o)}return P(async()=>{const o=_.tasks(e,t),i=[];for(let l=0;l<r.length;l+=500)i.push(r.slice(l,l+500));for(const l of i){const c=xt(v);l.forEach(d=>{const h=a.get(d),u=z(v,o,d);c.update(u,{order:h})}),await c.commit()}})}async function gr(e,t,r){return P(async()=>{const a=_.tasks(e,t),n=hr({...r});return n.dueDate&&(n.dueDate=dr(n.dueDate)),delete n.id,await U(L(v,a),{...n,ownerId:e,status:"todo",createdAt:Z()})})}async function kn(e,t,r,a){const n=K.getTasks(t);if(n==null||n.find(o=>o.id===r),n){const o=n.map(i=>i.id===r?{...i,status:a,completedAt:a==="completed"?new Date:void 0}:i);K.setCache(t,o)}return P(async()=>{const o=_.tasks(e,t),i={status:a};a==="completed"?i.completedAt=Z():i.completedAt=null,await De(z(v,o,r),i)},{onFinalFailure:()=>{n&&K.setCache(t,n),j.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function wn(e,t,r,a){const n=K.getTasks(t);if(n){const o=n.map(i=>i.id===r?{...i,...a}:i);K.setCache(t,o)}return P(async()=>{const o=_.tasks(e,t),i=hr({...a});i.dueDate!==void 0&&(i.dueDate=dr(i.dueDate)),await De(z(v,o,r),i)},{onFinalFailure:()=>{n&&K.setCache(t,n),j.error("ã‚¿ã‚¹ã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function jn(e,t,r){const a=K.getTasks(t);if(a){const n=a.filter(o=>o.id!==r);K.setCache(t,n)}return P(async()=>{const n=_.tasks(e,t);await Ie(z(v,n,r))},{onFinalFailure:()=>{a&&K.setCache(t,a),j.error("ã‚¿ã‚¹ã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const ge=()=>me(W.getState().language).t;function Ee(){var r;const e=(r=D.currentUser)==null?void 0:r.uid,t=re();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}async function ji(e){try{const{userId:t,workspaceId:r}=Ee(),n=kt.partial().required({title:!0}).safeParse(e);n.success||console.warn("[addTask] Validation warning:",n.error.flatten()),await gr(t,r,e)}catch(t){throw console.error("Failed to add task:",t),j.error(ge()("msg.task.create_fail")),t}}async function vn(e,t){try{const{userId:r,workspaceId:a}=Ee();if(t==="completed"){const n=ur(a,e);if(n!=null&&n.recurrence&&n.recurrence.type!=="none"){const o=da(n.dueDate??null,n.recurrence);if(o){const i={title:n.title,description:n.description,projectId:n.projectId,labelIds:n.labelIds,timeBlockId:n.timeBlockId,duration:n.duration,isImportant:n.isImportant,recurrence:n.recurrence,dueDate:o,status:"todo"};gr(r,a,i).catch(l=>console.error("Failed to create recurring task:",l))}}}await kn(r,a,e,t)}catch(r){throw console.error("Failed to update status:",r),j.error(ge()("msg.task.status_update_fail")),r}}async function lt(e,t){try{const{userId:r,workspaceId:a}=Ee(),n=kt.partial().safeParse(t);n.success||console.warn("[updateTask] Validation warning:",n.error.flatten()),await wn(r,a,e,t)}catch(r){throw console.error("Failed to update task:",r),j.error(ge()("msg.task.update_fail")),r}}async function Nn(e){try{const{userId:t,workspaceId:r}=Ee();await yn(t,r,e)}catch(t){throw console.error("Failed to reorder tasks:",t),j.error(ge()("msg.task.update_fail")),t}}async function _n(e){try{const{userId:t,workspaceId:r}=Ee();await jn(t,r,e),j.success(ge()("msg.task.delete_success"))}catch(t){throw console.error("Failed to delete task:",t),j.error(ge()("msg.task.delete_fail")),t}}async function Cn(e,t){try{const{userId:r,workspaceId:a}=Ee(),n=ur(a,e),i=((n==null?void 0:n.status)||t||"todo")==="completed"?"todo":"completed";await vn(e,i),i==="completed"&&j.success(ge()("msg.task.complete_success"))}catch(r){throw console.error("Failed to toggle status:",r),j.error(ge()("msg.task.status_update_fail")),r}}function Tn(e,t,r){const a=D.currentUser;return!a||!e?(typeof t=="function"&&t([]),()=>{}):bn(a.uid,e,t,r)}const Dn=e=>{const t=e||re();return t?fn(t):[]},In=e=>{const t=e||re();return t?xn(t):!1},En=N.TIME_BLOCK.DEFAULTS.map(e=>({...e})),be=class be{constructor(){A(this,"cacheMap",new Map);A(this,"listeners",new Map);A(this,"unsubscribes",new Map)}static getInstance(){return be.instance||(be.instance=new be),be.instance}getBlocks(t){return this.cacheMap.get(t)||[]}isInitialized(t){return this.cacheMap.has(t)}setCache(t,r){this.cacheMap.set(t,r),this.notify(t)}notify(t){const r=this.getBlocks(t),a=this.listeners.get(t);a&&a.forEach(n=>n([...r]))}subscribe(t,r,a){if(!t||!r)return a([]),()=>{};this.listeners.has(r)||this.listeners.set(r,new Set),this.listeners.get(r).add(a);const n=this.cacheMap.get(r);if(n&&queueMicrotask(()=>a([...n])),!this.unsubscribes.has(r)){const o=_.timeblocks(t,r),i=de(L(v,o),ft("order","asc"));let l=!0;const c=je(i,d=>{const h=d.docs.map(u=>({id:u.id,...u.data()}));if(l&&h.length===0&&!d.metadata.hasPendingWrites){l=!1,Sn(t,r).catch(u=>console.error("[TimeBlocks] Failed to create defaults:",u));return}l=!1,this.cacheMap.set(r,h),this.notify(r)},d=>{console.error("[TimeBlocks] Subscription error:",d)});this.unsubscribes.set(r,c)}return()=>{const o=this.listeners.get(r);o&&o.delete(a)}}};A(be,"instance");let ct=be;const Q=ct.getInstance();async function Sn(e,t){const r=_.timeblocks(e,t),a=xt(v);En.forEach(n=>{const o=z(v,r,n.id);a.set(o,{name:n.name,start:n.start,end:n.end,color:n.color,order:n.order,updatedAt:Z()})}),await a.commit()}function Mn(e,t,r){return Q.subscribe(e,t,r)}function An(e){return Q.getBlocks(e)}function Ln(e){return Q.isInitialized(e)}async function Rn(e,t,r){const a=Q.getBlocks(t),n=[...a,r].sort((l,c)=>(l.order||0)-(c.order||0));Q.setCache(t,n);const o=_.timeblocks(e,t),i=r.id||crypto.randomUUID();return P(async()=>{await Kt(z(v,o,i),{...r,updatedAt:Z()})},{onFinalFailure:()=>{Q.setCache(t,a),j.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®ä½œæˆã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Fn(e,t,r,a){const n=Q.getBlocks(t),o=n.map(l=>l.id===r?{...l,...a}:l).sort((l,c)=>(l.order||0)-(c.order||0));Q.setCache(t,o);const i=_.timeblocks(e,t);return P(async()=>{await Kt(z(v,i,r),{...a,updatedAt:Z()},{merge:!0})},{onFinalFailure:()=>{Q.setCache(t,n),j.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®æ›´æ–°ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}async function Pn(e,t,r){const a=Q.getBlocks(t),n=a.filter(i=>i.id!==r);Q.setCache(t,n);const o=_.timeblocks(e,t);return P(async()=>{await Ie(z(v,o,r))},{onFinalFailure:()=>{Q.setCache(t,a),j.error("ã‚¿ã‚¤ãƒ ãƒ–ãƒ­ãƒƒã‚¯ã®å‰Šé™¤ã«å¤±æ•—ã—ã¾ã—ãŸ")}})}const On=()=>me(W.getState().language).t;function mr(e){var r;const t=(r=D.currentUser)==null?void 0:r.uid;if(!t||!e)throw new Error("Authentication and Workspace are required.");return t}function Bn(e,t){var a;const r=(a=D.currentUser)==null?void 0:a.uid;return r?Mn(r,e,t):(t([]),()=>{})}function pr(e){return An(e)}function Wn(e){return Ln(e)}async function vi(e,t){const r=mr(e),a=On();try{const n=t.id||crypto.randomUUID(),o=pr(e),i=t.order!==void 0?t.order:Math.max(...o.map(h=>h.order||0),-1)+1,l={id:n,name:t.name||"",start:t.start||"09:00",end:t.end||"10:00",color:t.color||N.DEFAULT_COLORS.TIME_BLOCK_INACTIVE,order:i},c=Cs.safeParse(l);if(!c.success){const h=c.error.issues.map(u=>u.message).join(", ");return console.error("[TimeBlocks] Validation error:",c.error),j.error(`${a("validation.validation_error")}: ${h}`),!1}return o.some(h=>h.id===n)?await Fn(r,e,n,l):await Rn(r,e,l),!0}catch(n){return console.error("[TimeBlocks] Save error:",n),!1}}async function $n(e,t){const r=mr(e);try{return await Pn(r,e,t),!0}catch(a){return console.error("[TimeBlocks] Delete error:",a),!1}}const Se=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=k.useCallback(c=>!e||!t?()=>{}:Tn(e,d=>c(d),d=>console.error("Task subscription error:",d)),[e,t]),n=e?In(e):!1,{data:o,isPending:i}=ve(["tasks",t||void 0,e||void 0],a,e&&n?Dn(e):void 0);return{tasks:o||[],loading:r||!!e&&!n&&i}};function _t(){const{tasks:e}=Se(),{showCompleted:t,query:r}=ee();return k.useMemo(()=>{var i,l;const n={inbox:0,today:0,upcoming:0,important:0,all:0,search:0,projects:{}},o=r?r.toLowerCase().trim():"";for(const c of e){if(o){const h=(i=c.title)==null?void 0:i.toLowerCase().includes(o),u=(l=c.description)==null?void 0:l.toLowerCase().includes(o);(h||u)&&n.search++}c.status==="archived"||c.status==="completed"||(n.all++,c.projectId&&(n.projects[c.projectId]=(n.projects[c.projectId]||0)+1),(!c.projectId||c.projectId==="unassigned"||c.projectId==="none")&&n.inbox++,c.isImportant&&n.important++,c.dueDate&&(oa(c.dueDate)?n.today++:ia(c.dueDate)&&n.upcoming++))}return n},[e,r])}const zn=e=>e in N.SIDEBAR_DENSITY,Xe=e=>zn(e)?N.SIDEBAR_DENSITY[e]:N.SIDEBAR_DENSITY.normal,qn=[{id:"inbox",i18nKey:"inbox",Icon:ar,color:"text-blue-500",droppable:!0},{id:"today",i18nKey:"today",Icon:qe,color:"text-green-500"},{id:"upcoming",i18nKey:"upcoming",Icon:rr,color:"text-purple-500"},{id:"important",i18nKey:"important",Icon:yt,color:"text-amber-400"},{id:"custom",i18nKey:"all_tasks",Icon:ks,color:"text-gray-500"}],Vn=()=>{const{language:e,density:t}=W(),{t:r}=me(e),a=_t(),{setView:n,currentView:o}=te(),i=o==="dashboard";return s.jsxs("ul",{className:"space-y-0.5",children:[s.jsx("li",{children:s.jsxs("button",{onClick:()=>n("dashboard"),className:T("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Xe(t),i?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700"),children:[s.jsx(Zt,{className:"w-4 h-4 text-indigo-500"}),s.jsx("span",{className:"flex-1",children:r("dashboard")})]})}),qn.map(l=>s.jsx(Kn,{item:l,label:r(l.i18nKey),count:a[l.id]||0},l.id))]})},Kn=({item:e,label:t,count:r})=>{const{filterType:a,setFilter:n}=ee(),{setView:o}=te(),{density:i}=W(),c=te(y=>y.currentView)==="tasks"&&a===e.id,d=e.Icon,{setNodeRef:h,isOver:u}=Re({id:`filter:${e.id}`,disabled:!e.droppable,data:{type:e.id==="inbox"?"inbox":"filter",value:e.id}}),p=()=>{e.id==="search"?(o("tasks"),n("search")):(o("tasks"),n(e.id))};return s.jsx("li",{ref:h,children:s.jsxs("button",{onClick:p,className:T("w-full flex items-center px-3 text-sm rounded-md transition-colors text-left gap-3 group/item",Xe(i),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",u&&e.droppable&&"bg-blue-50 dark:bg-blue-900/30"),children:[s.jsx(d,{className:T("w-4 h-4",e.color)}),s.jsx("span",{className:"flex-1",children:t}),e.id!=="search"&&r>0&&s.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:r})]})})},Un=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=k.useCallback(c=>!e||!t?()=>{}:Da(e,c),[e,t]),n=e?Ta(e):!1,{data:o,isPending:i}=ve(["filters",t||void 0,e||void 0],a,e&&n?Ca(e):void 0);return{filters:o,loading:r||!!e&&i}};function fr(e){const t={keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(!e)return t;const r=/(?:-?[a-zA-Z]+:(?:"[^"]*"|[^\s]+))|(?:"[^"]*")|(?:-?[^\s]+)/g,a=e.match(r);if(!a)return t;const n=[];for(let o=0;o<a.length;o++){const i=a[o];if(i==="OR"){const l=n.length-1,c=n[l],d=a[o+1],h=c&&(typeof c=="string"?!c.includes(":"):!0),u=d&&!d.includes(":")&&d!=="OR";if(h&&u){const p=Array.isArray(c)?c:[c];p.push(d.toLowerCase().replace(/^"|"$/g,"")),n[l]=p,o++;continue}}n.push(i)}return n.forEach(o=>{if(Array.isArray(o)){t.keywords.push(o);return}const i=o;if(i.startsWith('"')&&i.endsWith('"')){const l=i.substring(1,i.length-1);l&&t.keywords.push(l.toLowerCase());return}if(i.startsWith("-")&&!i.includes(":")){const l=i.substring(1);l&&t.excludeKeywords.push(l.toLowerCase());return}if(i.includes(":")){let l=!1,c=i;c.startsWith("-")&&(l=!0,c=c.substring(1));const d=c.indexOf(":"),h=c.substring(0,d).toLowerCase();let u=c.substring(d+1);switch(u.startsWith('"')&&u.endsWith('"')&&(u=u.substring(1,u.length-1)),u.toLowerCase(),h){case"project":case"p":l?u.split(",").forEach(x=>t.excludeProjects.push(x)):u.split(",").forEach(x=>t.projects.push(x));break;case"label":case"l":l?u.split(",").forEach(x=>t.excludeLabels.push(x)):u.split(",").forEach(x=>t.labels.push(x));break;case"timeblock":case"tb":l?u.split(",").forEach(x=>t.excludeTimeBlocks.push(x)):u.split(",").forEach(x=>t.timeBlocks.push(x));break;case"duration":case"d":u.split(",").forEach(x=>{const g=parseInt(x,10);isNaN(g)||t.durations.push(g)});break;case"date":case"due":const p=["today","tomorrow","week","upcoming","overdue","next-week"];u.split(",").forEach(x=>{const g=x.toLowerCase();p.includes(g)&&t.dates.push(g)});break;case"status":case"is":const y=["completed","active","todo"];u.split(",").forEach(x=>{const g=x.toLowerCase();y.includes(g)&&(l?t.excludeStatus.push(g):t.status.push(g)),g==="important"&&(t.isImportant=!l),g==="unimportant"&&(t.isImportant=l)});break;default:l?t.excludeKeywords.push(c.toLowerCase()):t.keywords.push(c.toLowerCase());break}}else i!=="OR"&&t.keywords.push(i.toLowerCase())}),t}function Ni(e){var r,a,n,o,i,l,c,d,h,u,p,y;const t=[];return(r=e.keywords)!=null&&r.length&&t.push(...e.keywords.map(x=>Array.isArray(x)?x.join(" OR "):x.includes(" ")?`"${x}"`:x)),(a=e.excludeKeywords)!=null&&a.length&&t.push(...e.excludeKeywords.map(x=>`-${x}`)),(n=e.projects)!=null&&n.length&&t.push(`project:${e.projects.join(",")}`),(o=e.excludeProjects)!=null&&o.length&&t.push(`-project:${e.excludeProjects.join(",")}`),(i=e.labels)!=null&&i.length&&t.push(`label:${e.labels.join(",")}`),(l=e.excludeLabels)!=null&&l.length&&t.push(`-label:${e.excludeLabels.join(",")}`),(c=e.timeBlocks)!=null&&c.length&&t.push(`timeblock:${e.timeBlocks.join(",")}`),(d=e.excludeTimeBlocks)!=null&&d.length&&t.push(`-timeblock:${e.excludeTimeBlocks.join(",")}`),(h=e.durations)!=null&&h.length&&t.push(`duration:${e.durations.join(",")}`),(u=e.dates)!=null&&u.length&&t.push(`date:${e.dates.join(",")}`),(p=e.status)!=null&&p.length&&t.push(`status:${e.status.join(",")}`),(y=e.excludeStatus)!=null&&y.length&&t.push(`-status:${e.excludeStatus.join(",")}`),e.isImportant===!0&&t.push("is:important"),e.isImportant===!1&&t.push("is:unimportant"),t.join(" ")}function Hn(e,t="createdAt_desc"){if(!Array.isArray(e))return[];const[r,a]=t.split("_"),o=a==="desc"?-1:1;return[...e].sort((i,l)=>{var h,u,p,y,x,g;let c,d;switch(r){case"dueDate":c=(h=$(i.dueDate))==null?void 0:h.getTime(),d=(u=$(l.dueDate))==null?void 0:u.getTime();break;case"createdAt":c=(p=$(i.createdAt))==null?void 0:p.getTime(),d=(y=$(l.createdAt))==null?void 0:y.getTime();break;case"title":c=i.title.toLowerCase(),d=l.title.toLowerCase();break;case"duration":c=i.duration||0,d=l.duration||0;break;case"important":c=i.isImportant?1:0,d=l.isImportant?1:0;break;case"manual":c=i.order!==void 0?i.order:Number.MAX_SAFE_INTEGER,d=l.order!==void 0?l.order:Number.MAX_SAFE_INTEGER;break;default:c=(x=$(i.createdAt))==null?void 0:x.getTime(),d=(g=$(l.createdAt))==null?void 0:g.getTime()}return Gn(c,d)*o})}function Gn(e,t){return e===t?0:e==null?1:t==null?-1:e>t?1:e<t?-1:0}function Xn(){const e=new Date;e.setHours(0,0,0,0);const t=new Date(e);t.setDate(t.getDate()+1);const r=la(e),a=new Date(r);a.setDate(a.getDate()+7);const n=new Date(t);return n.setDate(n.getDate()+7),{now:e,tomorrow:t,weekStart:r,weekEnd:a,upcomingEnd:n}}function Yn(e,t,r,a){const{now:n,tomorrow:o,weekStart:i,weekEnd:l,upcomingEnd:c}=r;switch(t){case"today":return At(e,n);case"tomorrow":return At(e,o);case"week":return e>=i&&e<l;case"upcoming":return e>=o&&e<c;case"overdue":return e<n&&a!=="completed";default:return!1}}function Rt(e,t){if(!t)return e;const r=typeof t=="string"?fr(t):t,a=r.dates.length>0?Xn():null;return e.filter(n=>{if(r.status.length>0){const i=n.status||"todo";if(!r.status.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(r.excludeStatus.length>0){const i=n.status||"todo";if(r.excludeStatus.some(c=>c==="active"&&i==="todo"?!0:c===i))return!1}if(r.isImportant===!0&&!n.isImportant||r.isImportant===!1&&n.isImportant||r.projects.length>0&&!r.projects.some(l=>l==="unassigned"?!n.projectId||n.projectId==="unassigned"||n.projectId==="none":n.projectId===l)||r.excludeProjects.length>0&&r.excludeProjects.some(i=>n.projectId===i)||r.labels.length>0&&(!n.labelIds||!r.labels.some(i=>{var l;return(l=n.labelIds)==null?void 0:l.includes(i)}))||r.excludeLabels.length>0&&n.labelIds&&r.excludeLabels.some(i=>{var l;return(l=n.labelIds)==null?void 0:l.includes(i)})||r.timeBlocks.length>0&&!r.timeBlocks.some(l=>l==="unassigned"?!n.timeBlockId:n.timeBlockId===l)||r.excludeTimeBlocks.length>0&&r.excludeTimeBlocks.some(i=>n.timeBlockId===i))return!1;if(r.durations.length>0){const i=n.duration||0;if(!r.durations.includes(i))return!1}if(a&&r.dates.length>0){const i=$(n.dueDate);if(!i||!r.dates.some(c=>Yn(i,c,a,n.status||"todo")))return!1}const o=`${n.title} ${n.description||""}`.toLowerCase();return!(r.keywords.length>0&&!r.keywords.every(l=>Array.isArray(l)?l.some(c=>o.includes(c)):o.includes(l))||r.excludeKeywords.length>0&&r.excludeKeywords.some(l=>o.includes(l)))})}function Jn(e){const{keyword:t,showCompleted:r,projectId:a,labelId:n,timeBlockId:o,duration:i,filterType:l}=e,c=t?fr(t):{keywords:[],excludeKeywords:[],projects:[],excludeProjects:[],labels:[],excludeLabels:[],timeBlocks:[],excludeTimeBlocks:[],durations:[],dates:[],status:[],excludeStatus:[],isImportant:void 0};if(a&&c.projects.push(a),n&&c.labels.push(n),o&&c.timeBlocks.push(o),i){const d=typeof i=="number"?i:parseInt(i,10);isNaN(d)||c.durations.push(d)}return l==="today"&&c.dates.push("today"),l==="upcoming"&&c.dates.push("upcoming"),l==="important"&&(c.isImportant=!0),r||c.status.length===0&&c.status.push("active"),c}function xr(e,t){const{savedFilter:r,sortCriteria:a}=t,n=Jn(t);let o=Rt(e,n);return r&&r.query&&(o=Rt(o,r.query)),Hn(o,a||"createdAt_desc")}const Ye=({x:e,y:t,onClose:r,children:a})=>{const n=k.useRef(null);return k.useEffect(()=>{const o=l=>{n.current&&!n.current.contains(l.target)&&r()},i=()=>r();return document.addEventListener("mousedown",o),window.addEventListener("scroll",i,!0),()=>{document.removeEventListener("mousedown",o),window.removeEventListener("scroll",i,!0)}},[r]),Er.createPortal(s.jsx("div",{ref:n,className:"fixed min-w-[160px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{top:t,left:e,zIndex:N.Z_INDEX.POPOVER},onContextMenu:o=>o.preventDefault(),children:a}),document.body)},Qn=({label:e,icon:t,children:r})=>{const[a,n]=S.useState(!1);return s.jsxs("div",{className:"relative w-full",onMouseEnter:()=>n(!0),onMouseLeave:()=>n(!1),children:[s.jsxs("button",{className:"w-full text-left px-3 py-2 text-sm flex items-center justify-between gap-2 transition-colors text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",children:[s.jsxs("div",{className:"flex items-center gap-2",children:[t&&s.jsx("span",{className:"w-4 h-4 text-gray-400",children:t}),e]}),s.jsx(Ae,{className:"w-3 h-3 text-gray-400"})]}),a&&s.jsx("div",{className:"absolute left-full top-0 ml-1 min-w-[140px] bg-white dark:bg-gray-800 rounded-lg shadow-xl border border-gray-100 dark:border-gray-700 py-1 animate-in fade-in zoom-in-95 duration-100",style:{zIndex:N.Z_INDEX.POPOVER},children:r})]})},H=({onClick:e,children:t,className:r,icon:a,variant:n="default"})=>s.jsxs("button",{onClick:o=>{o.stopPropagation(),e()},className:T("w-full text-left px-3 py-2 text-sm flex items-center gap-2 transition-colors",n==="danger"?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700",r),children:[a&&s.jsx("span",{className:T("w-4 h-4",n==="danger"?"text-red-500":"text-gray-400"),children:a}),t]}),ye=({icon:e,label:t,count:r,isActive:a,isOver:n,onClick:o,onContextMenu:i,showZero:l=!1})=>{const{density:c}=W();return s.jsxs("button",{type:"button",onClick:o,onContextMenu:i,className:T("w-full text-left group flex items-center justify-between px-2 ml-1 rounded-md transition-colors select-none outline-none focus:ring-2 focus:ring-blue-500/50",Xe(c),a?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",n&&"bg-blue-50 dark:bg-blue-900/30"),children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[e&&s.jsx("span",{className:"flex-shrink-0 w-5 flex justify-center text-sm",children:e}),s.jsx("span",{className:"text-sm truncate",children:t})]}),r!==void 0&&(r>0||l&&r===0)&&s.jsx("span",{className:T("text-[10px] font-bold px-1.5 py-0.5 rounded-full bg-gray-100 dark:bg-gray-700/50",a?"text-blue-700 dark:text-blue-300 bg-white":"text-gray-400"),children:r})]})},Zn=()=>{const{filters:e,loading:t}=Un(),{tasks:r}=Se(),{workspaceId:a}=oe();return t?null:s.jsx("div",{className:"space-y-0.5 py-1",children:e.map(n=>s.jsx(eo,{filter:n,tasks:r,workspaceId:a},n.id))})},eo=({filter:e,tasks:t,workspaceId:r})=>{const{t:a}=M(),{filterType:n,targetId:o,setFilter:i}=ee(),{openModal:l}=ne(),c=n==="custom"&&o===e.id,[d,h]=k.useState(null),u=S.useMemo(()=>{try{return xr(t,{savedFilter:e,showCompleted:!1}).length}catch(g){return console.warn("[CustomFilterItem] Count error:",g),0}},[t,e]),p=()=>{h(null),l("filter-edit",e)},y=()=>{h(null),l("confirmation",{title:a("delete"),message:`${a("filter")}: ${e.name}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&r&&await Ia(r,e.id)}})},x=g=>{g.preventDefault(),g.stopPropagation(),h({x:g.clientX,y:g.clientY})};return s.jsxs(s.Fragment,{children:[s.jsx("div",{onContextMenu:x,children:s.jsx(ye,{label:e.name,icon:s.jsx(Me,{size:16}),count:u,isActive:c,onClick:()=>i("custom",e.id)})}),d&&s.jsxs(Ye,{x:d.x,y:d.y,onClose:()=>h(null),children:[s.jsx(H,{onClick:p,icon:s.jsx(Ue,{size:16}),children:a("edit")}),s.jsx(H,{onClick:y,variant:"danger",icon:s.jsx(Ke,{size:16}),children:a("delete")})]})]})},to=S.memo(({mins:e,count:t})=>{const{t:r}=M(),{filterType:a,targetId:n,setFilter:o}=ee(),{setView:i}=te(),l=a==="duration"&&n===e.toString(),{setNodeRef:c,isOver:d}=Re({id:`duration:${e}`,data:{type:"duration",value:e.toString()}});return s.jsx("div",{ref:c,children:s.jsx(ye,{label:r("sidebar.duration_format",{min:e}),icon:s.jsx(sr,{className:"w-5 h-5 text-gray-500 dark:text-gray-400"}),count:t,isActive:l,isOver:d,onClick:()=>{i("tasks"),o("duration",e.toString())}})})}),ro=()=>{const{tasks:e}=Se(),{customDurations:t}=W(),r=(t==null?void 0:t.length)>0?t:N.SIDEBAR.DURATIONS,a=k.useMemo(()=>{const n=new Map;return e.forEach(o=>{if(o.status!=="completed"&&o.duration){const i=Number(o.duration);isNaN(i)||n.set(i,(n.get(i)||0)+1)}}),n},[e]);return s.jsx("div",{className:"space-y-0.5 py-1",children:r.map(n=>s.jsx(to,{mins:n,count:a.get(n)||0},n))})},Ct=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=Pt(),n=k.useCallback(u=>!e||!t?()=>{}:tn(e,u),[e,t]),i=(e?Za(e):!1)&&e?Qa(e):void 0,{data:l,isPending:c}=ve(["projects",t||void 0,e||void 0],n,i);return{projects:l||[],loading:r||!!e&&c,setProjectsOverride:u=>{e&&(a.setQueryData(["projects",e],u),en(u,e))}}},so=({id:e,children:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:l}=ut({id:e}),c={transform:ht.Transform.toString(o),transition:i,opacity:l?.5:1};return s.jsx("div",{ref:n,style:c,...r,...a,children:t})},br=()=>s.jsxs("div",{className:"space-y-2 p-2",children:[s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-3/4"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-1/2"}),s.jsx("div",{className:"h-4 bg-gray-200 dark:bg-gray-700 rounded w-2/3"})]}),ao=S.memo(({project:e})=>{const{t}=M(),{filterType:r,targetId:a,setFilter:n}=ee(),{density:o}=W(),{openModal:i}=ne(),{setView:l}=te(),c=r==="project"&&a===e.id,[d,h]=k.useState(null),{setNodeRef:u,isOver:p}=Re({id:`project:${e.id}`,data:{type:"project",value:e.id}}),y=m=>{m==null||m.stopPropagation(),h(null),i("project-edit",e)},x=()=>{h(null),i("confirmation",{title:t("delete"),message:`${t("project")}: ${e.name}
${t("msg.confirm_delete")}`,confirmLabel:t("delete"),variant:"danger",onConfirm:async()=>{e.id&&await rn(e.id)}})},g=m=>{m.preventDefault(),m.stopPropagation(),h({x:m.clientX,y:m.clientY})},w=()=>{n("project",e.id),l("tasks")},C=_t().projects[e.id]||0;return s.jsxs(s.Fragment,{children:[s.jsxs("div",{ref:u,onClick:w,onContextMenu:g,className:T("group flex items-center justify-between px-2 rounded-md cursor-pointer transition-colors select-none",Xe(o),c?"bg-blue-50 dark:bg-blue-900/30 text-blue-700 dark:text-blue-300 font-medium":"hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-200",p&&"bg-blue-50 dark:bg-blue-900/30"),role:"button",tabIndex:0,"aria-selected":c,"aria-label":`${t("project")}: ${e.name}${c?` (${t("active")})`:""}`,children:[s.jsxs("div",{className:"flex items-center gap-2 flex-1 min-w-0",children:[s.jsx("span",{className:T("text-xs shrink-0 transition-colors",c?"text-blue-500":"text-gray-400 group-hover:text-gray-500"),children:s.jsx("svg",{className:"w-3.5 h-3.5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M7 20l4-16m2 16l4-16M6 9h14M4 15h14"})})}),s.jsx("span",{className:"text-sm truncate",children:e.name})]}),C>0&&s.jsx("span",{className:"bg-gray-100 dark:bg-gray-700 text-gray-500 dark:text-gray-400 text-[10px] px-1.5 py-0.5 rounded-full font-bold",children:C})]}),d&&s.jsxs(Ye,{x:d.x,y:d.y,onClose:()=>h(null),children:[s.jsx(H,{onClick:y,icon:s.jsx(Ue,{size:16}),children:t("edit")}),s.jsx(H,{onClick:x,variant:"danger",icon:s.jsx(Ke,{size:16}),children:t("delete")})]})]})}),no=()=>{const{t:e}=M(),{projects:t,loading:r}=Ct();return r?s.jsx(br,{}):t.length===0?s.jsx("div",{className:"p-4 text-xs text-gray-400",children:e("sidebar.no_projects")}):s.jsx(gt,{items:t.map(a=>`${N.DND.PREFIX_PROJECT}${a.id}`),strategy:mt,children:s.jsx("div",{className:"space-y-0.5 p-2",children:t.map(a=>s.jsx(so,{id:`${N.DND.PREFIX_PROJECT}${a.id}`,children:s.jsx(ao,{project:a})},a.id))})})},oo=({title:e,children:t,defaultExpanded:r=!0,action:a,dragHandleProps:n})=>{const{t:o}=M(),[i,l]=k.useState(()=>typeof window<"u"&&window.innerWidth<768?!1:r),d=`section-${encodeURIComponent(e.replace(/\s+/g,"-").toLowerCase())}`;return s.jsxs("div",{className:"mb-2 group/section",children:[s.jsxs("div",{className:"flex items-center justify-between px-2 py-1",children:[s.jsxs("button",{...n,onClick:()=>l(!i),"aria-expanded":i,"aria-controls":d,className:"flex items-center flex-1 text-xs font-semibold text-gray-500 uppercase hover:text-gray-700 dark:hover:text-gray-300 transition-colors text-left cursor-grab active:cursor-grabbing touch-none select-none",title:o("sidebar.reorder_section"),children:[s.jsx("svg",{className:T("w-3 h-3 mr-1 transition-transform",i?"rotate-90":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24","aria-hidden":"true",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),e]}),a&&s.jsx("div",{className:"opacity-100 transition-opacity",onClick:h=>h.stopPropagation(),children:a})]}),i&&s.jsx("div",{className:"mt-1",id:d,children:t})]})},io=()=>{const{t:e}=M(),{currentView:t,setView:r}=te();return s.jsxs("div",{className:"space-y-0.5 py-1",children:[s.jsx(ye,{label:e("sidebar.target_wizard"),icon:s.jsx(er,{}),isActive:t==="wizard",onClick:()=>r("wizard")}),s.jsx(ye,{label:e("sidebar.target_dashboard"),icon:s.jsx(Zt,{}),isActive:t==="target-dashboard",onClick:()=>r("target-dashboard")}),s.jsx(ye,{label:e("sidebar.framework_wiki"),icon:s.jsx(tr,{}),isActive:t==="wiki",onClick:()=>r("wiki")})]})},Je=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=k.useCallback(c=>!e||!t?()=>{}:Bn(e,c),[e,t]),n=e?Wn(e):!1,{data:o,isPending:i}=ve(["timeblocks",t||void 0,e||void 0],a,e&&n?pr(e):void 0);return{timeBlocks:o||[],loading:r||!!e&&i}},lo=()=>{const{timeBlocks:e,loading:t}=Je(),{tasks:r}=Se(),{workspaceId:a}=oe(),n=S.useMemo(()=>{const o=new Map;let i=0;return r.forEach(l=>{l.status!=="completed"&&(!l.timeBlockId||l.timeBlockId==="unassigned"||l.timeBlockId==="null"?i++:o.set(l.timeBlockId,(o.get(l.timeBlockId)||0)+1))}),{map:o,unassignedCount:i}},[r]);return t?s.jsx(br,{}):s.jsxs("div",{className:"space-y-0.5 py-1",children:[e.map(o=>s.jsx(co,{block:o,count:n.map.get(o.id||"")||0,workspaceId:a},o.id)),s.jsx(uo,{count:n.unassignedCount})]})},co=({block:e,count:t,workspaceId:r})=>{const{t:a}=M(),{filterType:n,targetId:o,setFilter:i}=ee(),{openModal:l}=ne(),c=n==="timeblock"&&o===e.id,{setView:d}=te(),[h,u]=k.useState(null),{setNodeRef:p,isOver:y}=Re({id:`timeblock:${e.id}`,data:{type:"timeblock",value:e.id}}),x=()=>{u(null),l("timeblock-edit",e)},g=()=>{u(null),l("confirmation",{title:a("delete"),message:`${a("timeblock")}: ${e.start} - ${e.end}
${a("msg.confirm_delete")}`,confirmLabel:a("delete"),variant:"danger",onConfirm:async()=>{e.id&&r&&await $n(r,e.id)}})},w=m=>{m.preventDefault(),m.stopPropagation(),u({x:m.clientX,y:m.clientY})},C=()=>{i("timeblock",e.id||""),d("tasks")};return s.jsxs("div",{ref:p,onContextMenu:w,children:[s.jsx(ye,{label:`${e.start} - ${e.end}`,icon:s.jsx("span",{className:"w-2 rounded-full aspect-square",style:{backgroundColor:e.color}}),count:t,isActive:c,isOver:y,onClick:C}),h&&s.jsxs(Ye,{x:h.x,y:h.y,onClose:()=>u(null),children:[s.jsx(H,{onClick:x,icon:s.jsx(Ue,{size:16}),children:a("edit")}),s.jsx(H,{onClick:g,variant:"danger",icon:s.jsx(Ke,{size:16}),children:a("delete")})]})]})},uo=({count:e})=>{const{t}=M(),{filterType:r,targetId:a,setFilter:n}=ee(),{setView:o}=te(),i=r==="timeblock"&&a==="unassigned",{setNodeRef:l,isOver:c}=Re({id:"timeblock:unassigned",data:{type:"timeblock",value:"unassigned"}}),d=()=>{n("timeblock","unassigned"),o("tasks")};return s.jsx("div",{ref:l,children:s.jsx(ye,{label:t("sidebar.unassigned"),icon:s.jsx("span",{className:"w-2 rounded-full aspect-square bg-gray-400"}),count:e,isActive:i,isOver:c,onClick:d})})},ho=({id:e,section:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:l}=ut({id:e}),c={transform:ht.Transform.toString(o),transition:i,opacity:l?.5:1};return s.jsx("div",{ref:n,style:c,...r,children:s.jsx(oo,{title:t.title,defaultExpanded:t.defaultExpanded,action:t.action,dragHandleProps:a,children:t.component})})},rt=["general","projects","targets","timeblocks","durations","filters"],go=()=>{const{t:e}=M(),{openModal:t}=ne(),[r,a]=S.useState(()=>{const l=localStorage.getItem(N.STORAGE_KEYS.SECTION_ORDER);let c=rt;if(l)try{const d=JSON.parse(l);if(Array.isArray(d)&&d.every(h=>typeof h=="string")){const h=[...d];rt.forEach(u=>{h.includes(u)||(u==="general"?h.unshift(u):h.push(u))}),c=h.filter(u=>rt.includes(u))}}catch{}return c});k.useEffect(()=>{localStorage.setItem(N.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(r))},[r]);const n=Ot($e(Bt,{activationConstraint:{distance:8}}),$e(Lr,{coordinateGetter:Ar})),o=l=>{const{active:c,over:d}=l;d&&c.id!==d.id&&a(h=>{const u=h.indexOf(c.id),p=h.indexOf(d.id);return pt(h,u,p)})},i=S.useMemo(()=>({general:{id:"general",title:e("general"),component:s.jsx(s.Fragment,{children:s.jsx(Vn,{})}),defaultExpanded:!0},projects:{id:"projects",title:e("projects"),component:s.jsx(no,{}),defaultExpanded:!0,action:s.jsx("button",{onClick:()=>t("project-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},targets:{id:"targets",title:e("targets"),component:s.jsx(io,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("wiki-framework"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},timeblocks:{id:"timeblocks",title:e("timeblocks"),component:s.jsx(lo,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("timeblock-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})},durations:{id:"durations",title:e("durations"),component:s.jsx(ro,{}),defaultExpanded:!1},filters:{id:"filters",title:e("filters"),component:s.jsx(Zn,{}),defaultExpanded:!1,action:s.jsx("button",{onClick:()=>t("filter-edit"),className:"p-1 hover:bg-gray-200 dark:hover:bg-gray-700 rounded text-gray-400 hover:text-gray-600 dark:hover:text-gray-200 transition-colors",title:e("add"),"aria-label":e("add"),children:s.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 4v16m8-8H4"})})})}}),[e,t]);return s.jsx(Wt,{sensors:n,collisionDetection:$t,onDragEnd:o,children:s.jsx(gt,{items:r,strategy:mt,children:s.jsx("div",{className:"flex flex-col gap-4",children:r.map(l=>{const c=i[l];return c?s.jsx(ho,{id:c.id,section:c},c.id):null})})})})},yr=we(e=>({onTasksReorder:null,setTasksReorderHandler:t=>e({onTasksReorder:t})})),ce=k.forwardRef(({className:e,variant:t="primary",size:r="md",isLoading:a,leftIcon:n,rightIcon:o,children:i,disabled:l,...c},d)=>{const h={primary:"bg-blue-600 hover:bg-blue-700 text-white shadow-md hover:shadow-lg shadow-blue-500/30 border border-transparent",secondary:"bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-200 hover:bg-gray-200 dark:hover:bg-gray-600 border border-transparent",danger:"bg-red-500 hover:bg-red-600 text-white shadow-md shadow-red-500/30 border border-transparent",ghost:"bg-transparent hover:bg-gray-100 dark:hover:bg-gray-800 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-gray-200",outline:"bg-transparent border border-gray-200 dark:border-gray-700 text-gray-600 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800",premium:"bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white shadow-lg shadow-blue-500/40 border border-transparent"},u={sm:"text-xs px-3 py-1.5 rounded-lg gap-1.5",md:"text-sm px-4 py-2 rounded-lg gap-2",lg:"text-base px-6 py-3 rounded-xl gap-2.5",icon:"p-2 rounded-full aspect-square flex items-center justify-center"};return s.jsxs("button",{ref:d,className:T("flex items-center justify-center font-bold transition-all duration-200 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed disabled:active:scale-100",h[t],u[r],e),disabled:l||a,...c,children:[a&&s.jsx(ws,{className:"-ml-1 text-currentColor",size:16}),!a&&n,i,!a&&o]})});ce.displayName="Button";const kr=k.forwardRef(({className:e,label:t,error:r,containerClassName:a,options:n,children:o,id:i,...l},c)=>s.jsxs("div",{className:T("flex flex-col gap-1.5",a),children:[t&&s.jsx("label",{htmlFor:i,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),s.jsxs("div",{className:"relative group",children:[s.jsx("select",{ref:c,id:i,className:T("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl pl-4 pr-10 py-2.5 outline-none transition-all appearance-none cursor-pointer placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",r?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 text-gray-500 hover:border-gray-300 dark:hover:border-gray-600",e),"aria-invalid":!!r,"aria-describedby":r&&i?`${i}-error`:void 0,...l,children:o||(n==null?void 0:n.map(d=>s.jsx("option",{value:d.value,children:d.label},d.value)))}),s.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 pointer-events-none text-gray-400 group-hover:text-gray-600 dark:group-hover:text-gray-300 transition-colors",children:s.jsx(Qt,{size:16})})]}),r&&s.jsx("p",{id:i?`${i}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:r})]}));kr.displayName="Select";const wr=S.memo(({task:e,style:t,className:r,dragHandleProps:a})=>{const{t:n}=M(),o=e.status==="completed",i=!!e.isImportant,{openModal:l}=ne(),{projects:c}=Ct(),{timeBlocks:d}=Je(),[h,u]=k.useState(null),p=async F=>{F.stopPropagation(),e.id&&await Cn(e.id,e.status||"todo")},y=async F=>{F.stopPropagation(),e.id&&await lt(e.id,{isImportant:!i})},x=F=>{F.preventDefault(),F.stopPropagation(),u({x:F.clientX,y:F.clientY})},g=()=>{u(null),l("task-detail",e)},w=()=>{u(null),l("confirmation",{title:n("delete"),message:`${n("task")}: ${e.title}
${n("msg.confirm_delete")}`,confirmLabel:n("delete"),variant:"danger",onConfirm:async()=>{e.id&&await _n(e.id)}})},C=async F=>{if(u(null),!e.id)return;let B=null;const O=new Date;switch(O.setHours(0,0,0,0),F){case"today":B=new Date;break;case"tomorrow":B=new Date(O),B.setDate(O.getDate()+1);break;case"next_week":B=new Date(O),B.setDate(O.getDate()+7);break;case"no_date":B=null;break}await lt(e.id,{dueDate:B})},m=e.projectId?c.find(F=>F.id===e.projectId):null,f=e.timeBlockId?d.find(F=>F.id===e.timeBlockId):null,E=!!(e.recurrence&&e.recurrence.type!=="none"),R=!!e.dueDate;return s.jsxs(s.Fragment,{children:[s.jsxs("li",{style:t,onClick:()=>l("task-detail",e),onContextMenu:x,className:T("group flex items-center gap-3 p-[var(--task-p)] bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700/50 rounded-xl hover:shadow-sm hover:border-blue-200 dark:hover:border-blue-800 transition-all duration-200 cursor-default hover-lift",r),children:[a&&s.jsx("div",{...a,className:"cursor-move text-gray-300 dark:text-gray-600 hover:text-gray-500 dark:hover:text-gray-400 p-1 -ml-1 flex-shrink-0 touch-none",children:s.jsx(bs,{className:"w-4 h-4"})}),s.jsx("button",{onClick:p,className:T("w-5 h-5 rounded-full border flex items-center justify-center transition-colors shrink-0 cursor-pointer",o?"bg-blue-500 border-blue-500 text-white":"border-gray-300 dark:border-gray-600 hover:border-blue-400 text-transparent"),"aria-label":o?"Mark as incomplete":"Mark as complete",children:s.jsx(Pe,{className:"w-3 h-3",strokeWidth:3})}),s.jsxs("div",{className:"flex-1 min-w-0 flex flex-col justify-center",children:[s.jsx("div",{className:T("text-sm text-gray-800 dark:text-gray-200 break-words",o&&"line-through text-gray-400 dark:text-gray-500"),children:e.title}),e.description&&s.jsx("div",{className:"text-xs text-gray-500 line-clamp-1 truncate",children:e.description})]}),s.jsxs("div",{className:"flex items-center gap-3 text-xs shrink-0",children:[s.jsxs("div",{className:"hidden sm:flex items-center gap-1.5 px-2 py-0.5 rounded-md bg-gray-50 dark:bg-gray-700/50 text-gray-600 dark:text-gray-300",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full",style:{backgroundColor:(m==null?void 0:m.color)||N.DEFAULT_COLORS.PROJECT_INACTIVE}}),s.jsx("span",{className:"max-w-[100px] truncate",children:m?m.name:n("task_detail.project_none")})]}),s.jsx("div",{className:"hidden sm:flex items-center gap-1 text-gray-400 dark:text-gray-500 min-w-[80px]",children:f?s.jsxs(s.Fragment,{children:[s.jsx(sr,{className:"w-3.5 h-3.5"}),s.jsx("span",{className:"max-w-[120px] truncate",children:f.name||`${f.start} - ${f.end}`})]}):s.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest opacity-30",children:n("task_detail.time_block_unspecified")})}),s.jsx("div",{className:T("flex items-center gap-1 min-w-[70px]",E||R?o?"text-gray-400":ca(e.dueDate||null):"text-gray-400 dark:text-gray-500 opacity-50"),children:E?s.jsxs(s.Fragment,{children:[s.jsx(ys,{className:"w-3.5 h-3.5"}),e.dueDate&&s.jsx("span",{className:"hidden sm:inline",children:Lt(e.dueDate)})]}):R?s.jsxs(s.Fragment,{children:[s.jsx(qe,{className:"w-3.5 h-3.5"}),s.jsx("span",{className:"hidden sm:inline",children:Lt(e.dueDate)})]}):s.jsx("span",{className:"text-[10px] uppercase font-bold tracking-widest",children:n("no_date")})})]}),s.jsx("div",{className:T("flex items-center gap-1 transition-opacity shrink-0",i?"opacity-100":"opacity-0 group-hover:opacity-100 placeholder-opacity"),children:s.jsx("button",{onClick:y,className:T("p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors",i?"text-yellow-500":"text-gray-400"),title:i?"é‡è¦åº¦ã‚’è§£é™¤":"é‡è¦ã¨ã—ã¦ãƒžãƒ¼ã‚¯",children:s.jsx(yt,{className:"w-4 h-4",fill:i?"currentColor":"none"})})})]}),h&&s.jsxs(Ye,{x:h.x,y:h.y,onClose:()=>u(null),children:[s.jsxs(Qn,{label:n("date_change")||"æ—¥ä»˜å¤‰æ›´",icon:s.jsx(qe,{}),children:[s.jsx(H,{onClick:()=>C("today"),children:n("today")}),s.jsx(H,{onClick:()=>C("tomorrow"),children:n("tomorrow")}),s.jsx(H,{onClick:()=>C("next_week"),children:n("next_week")||"æ¥é€±"}),s.jsx(H,{onClick:()=>C("no_date"),children:n("no_date")||"æœŸé™ãªã—"})]}),s.jsx(H,{onClick:g,icon:s.jsx(Ue,{}),children:n("edit")}),s.jsx(H,{onClick:w,variant:"danger",icon:s.jsx(Ke,{}),children:n("delete")})]})]})},(e,t)=>{const r=n=>n?n instanceof Date?n.getTime():typeof n.toDate=="function"?n.toDate().getTime():typeof n.getTime=="function"?n.getTime():null:null,a=(n,o)=>{const i=r(n),l=r(o);return i===l};return e.task.id===t.task.id&&e.task.status===t.task.status&&e.task.title===t.task.title&&e.task.description===t.task.description&&e.task.projectId===t.task.projectId&&e.task.timeBlockId===t.task.timeBlockId&&e.task.isImportant===t.task.isImportant&&e.task.recurrence===t.task.recurrence&&a(e.task.dueDate,t.task.dueDate)}),dt=({tasks:e,timeBlockId:t})=>{const{t:r,formatNumber:a}=M(),{timeBlocks:n}=Je(),o=e.reduce((p,y)=>{const x=y.duration,g=typeof x=="number"?x:Number(x);return p+(isNaN(g)?0:g)},0),i=p=>a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2})+"h",l=t?n.find(p=>p.id===t):null;if(l&&l.start&&l.end){const p=ua(l.start,l.end);if(p<=0)return null;const y=a(p/60,{minimumFractionDigits:2,maximumFractionDigits:2}),x=a(o/60,{minimumFractionDigits:2,maximumFractionDigits:2}),g=o/p*100,w=Math.min(g,100),C=p-o,m=C<0,f=a(Math.abs(C)/60,{minimumFractionDigits:2,maximumFractionDigits:2}),E=g>100;return s.jsxs("div",{className:"flex items-center gap-3 py-2 px-3 my-1 border border-gray-100 dark:border-gray-800 rounded-lg bg-gray-50/30 dark:bg-gray-800/20",children:[s.jsx("div",{className:"flex-shrink-0 w-20 truncate text-[10px] font-bold text-gray-400 uppercase tracking-tight",title:l.name,children:l.name}),s.jsxs("div",{className:"flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums min-w-[70px]",children:[s.jsxs("span",{className:"font-bold text-gray-700 dark:text-gray-300",children:[x,"h"]}),s.jsx("span",{className:"text-gray-400 mx-0.5",children:"/"}),s.jsxs("span",{children:[y,"h"]})]}),s.jsx("div",{className:"flex-1 relative h-2 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[60px]",children:s.jsx("div",{className:T("h-full rounded-full transition-all duration-500 ease-out",E?"bg-red-500":"bg-blue-500"),style:{width:E?"100%":`${w}%`}})}),s.jsxs("div",{className:"flex-shrink-0 flex items-center gap-2 tabular-nums",children:[s.jsxs("span",{className:T("text-xs font-bold w-[4ch] text-right",E?"text-red-500":"text-blue-500"),children:[Math.round(g),"%"]}),s.jsxs("span",{className:T("text-[10px] hidden sm:inline",m?"text-red-400":"text-gray-400"),children:["(",m?"+":"-",f,"h)"]})]})]})}const c=e.length,d=c>0?o/c:0,h=r("task_stats.count_unit"),u=r("task_stats.avg_unit");return s.jsxs("div",{className:"glass-card flex items-center justify-evenly py-3 px-4 my-2",children:[s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.count_label")}),s.jsxs("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200",children:[a(c),h&&s.jsx("span",{className:"text-xs font-normal ml-0.5 text-gray-400",children:h})]})]}),s.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.total_label")}),s.jsx("span",{className:"font-bold text-sm text-gray-700 dark:text-gray-200 text-blue-600 dark:text-blue-400",children:i(o)})]}),s.jsx("div",{className:"w-px h-4 bg-gray-200 dark:bg-gray-700"}),s.jsxs("div",{className:"flex flex-row items-baseline gap-2",children:[s.jsx("span",{className:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",children:r("task_stats.avg_label")}),s.jsxs("span",{className:"font-medium text-sm",children:[i(d),s.jsx("span",{className:"text-xs ml-0.5",children:u})]})]})]})},mo=({task:e,className:t})=>{const{attributes:r,listeners:a,setNodeRef:n,transform:o,transition:i,isDragging:l}=ut({id:`${N.DND.PREFIX_TASK}${e.id||""}`,data:{type:"task",task:e}}),c={transform:ht.Transform.toString(o),transition:i,zIndex:l?50:"auto",position:"relative"};return s.jsx("div",{ref:n,style:c,className:"touch-manipulation",children:s.jsx(wr,{task:e,className:T(t,l&&"opacity-80 shadow-lg border-blue-400 bg-blue-50/50"),dragHandleProps:{...r,...a}})})},jr=()=>{const{t:e}=M(),{tasks:t,loading:r}=Se(),{filterType:a,targetId:n,query:o,showCompleted:i,sortCriteria:l,setShowCompleted:c,setSortCriteria:d}=ee(),{density:h}=W(),{openModal:u}=ne(),p=k.useMemo(()=>o&&o.trim().length>0?{keyword:o,showCompleted:i,projectId:null,labelId:null,timeBlockId:null,duration:null,filterType:"all_tasks",savedFilter:null,sortCriteria:l}:{keyword:o,showCompleted:i,projectId:a==="inbox"?"unassigned":a==="project"?n:null,labelId:a==="label"?n:null,timeBlockId:a==="timeblock"?n:null,duration:a==="duration"?n:null,filterType:a,savedFilter:null,sortCriteria:l},[a,n,o,i,l]),y=k.useMemo(()=>xr(t,p),[t,p]),x={compact:"space-y-1",normal:"space-y-2",comfortable:"space-y-3",spacious:"space-y-4"}[h],{setTasksReorderHandler:g}=yr(),[w,C]=S.useState(null);S.useEffect(()=>{C(null)},[t,p]);const m=w||y,f=S.useCallback(async(O,_r)=>{if(l!=="manual")return;const Ze=w||y,Dt=Ze.findIndex(Ne=>Ne.id===O),It=Ze.findIndex(Ne=>Ne.id===_r);if(Dt!==-1&&It!==-1){const Ne=pt(Ze,Dt,It);C(Ne);const Cr=Ne.map(et=>et.id).filter(Boolean);try{await Nn(Cr)}catch(et){console.error("Failed to reorder tasks",et),C(null)}}},[l,w,y]);S.useEffect(()=>(g(f),()=>g(null)),[f,g]);const E=m.length===0,R=!!(o&&o.trim().length>0);if(r&&!R&&t.length===0)return s.jsx("div",{className:"flex items-center justify-center h-full",children:s.jsx("div",{className:"text-gray-400 text-sm animate-pulse",children:e("task_list.loading")})});const B=l==="manual";return s.jsxs("div",{className:"flex flex-col h-full overflow-hidden relative",children:[s.jsxs("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-1 pb-24",children:[s.jsxs("div",{className:"sticky top-0 z-10 bg-white/95 dark:bg-gray-900/95 backdrop-blur-sm pt-2 pb-4 mb-4 flex items-center gap-2",children:[s.jsx("div",{className:"flex-1",children:R&&s.jsxs("div",{className:"bg-blue-50 dark:bg-blue-900/20 text-blue-600 dark:text-blue-300 px-3 py-2 rounded-lg text-sm font-medium flex items-center gap-2",children:[s.jsx(Me,{className:"w-4 h-4"}),e("task_list.searching_results",{query:o||""})]})}),s.jsx("div",{className:"flex items-center gap-2 px-1",children:s.jsxs(kr,{name:"sortCriteria","aria-label":e("task_list.sort_options")||"Sort Options",value:l,onChange:O=>d(O.target.value),className:"font-medium text-xs py-1.5 h-auto",children:[s.jsx("option",{value:"manual",children:e("task_list.sort_manual")}),s.jsx("option",{value:"createdAt_desc",children:e("task_list.sort_created")}),s.jsx("option",{value:"dueDate_asc",children:e("task_list.sort_due")}),s.jsx("option",{value:"important_desc",children:e("task_list.sort_important")}),s.jsx("option",{value:"title_asc",children:e("task_list.sort_title")})]})}),s.jsx(ce,{variant:i?"primary":"outline",size:"sm",onClick:()=>c(!i),title:e(i?"task_list.hide_completed":"task_list.show_completed"),className:"shrink-0",children:e(i?"task_list.hide_completed":"task_list.show_completed")})]}),E?s.jsxs("div",{className:"text-center py-20 flex flex-col items-center justify-center min-h-[60vh]",children:[s.jsxs("div",{className:"relative mb-8",children:[s.jsx("div",{className:"absolute -inset-4 bg-blue-500/10 dark:bg-blue-400/10 blur-3xl rounded-full"}),s.jsx("div",{className:"relative",children:s.jsx(Pe,{className:"w-24 h-24 text-blue-200 dark:text-blue-900/50",strokeWidth:1.5})})]}),s.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:e("task_list.no_tasks_title")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 max-w-xs mb-8",children:e(i?"task_list.no_tasks_desc_showing":"task_list.no_tasks_desc_hiding")}),s.jsx(ce,{variant:"premium",onClick:()=>u("task-detail",{title:""}),leftIcon:s.jsx(Yt,{className:"w-5 h-5"}),children:e("task_list.add_new_task")})]}):B?s.jsx(gt,{items:m.map(O=>`${N.DND.PREFIX_TASK}${O.id||""}`),strategy:mt,children:s.jsx("div",{className:T("transition-all duration-200",x),children:m.map(O=>s.jsx(mo,{task:O},O.id))})}):s.jsx("ul",{className:T("transition-all duration-200",x),children:m.map(O=>s.jsx(wr,{task:O},O.id))})]}),s.jsx("div",{className:"flex-none mt-auto pt-2 border-t border-gray-100 dark:border-gray-800 bg-white/50 dark:bg-gray-900/50 backdrop-blur pb-[calc(0.5rem+env(safe-area-inset-bottom))]",children:s.jsx(dt,{tasks:m,timeBlockId:p.timeBlockId})})]})},po=()=>{const{t:e}=M(),{tasks:t}=Se(),{timeBlocks:r}=Je(),a=_t(),{density:n}=W();t.length,t.filter(i=>i.status==="completed").length;const o=[{id:"inbox",label:e("inbox"),count:a.inbox,icon:ar,color:"text-blue-500",bg:"bg-blue-50 dark:bg-blue-900/20"},{id:"today",label:e("today"),count:a.today,icon:qe,color:"text-green-500",bg:"bg-green-50 dark:bg-green-900/20"},{id:"upcoming",label:e("upcoming"),count:a.upcoming,icon:rr,color:"text-purple-500",bg:"bg-purple-50 dark:bg-purple-900/20"},{id:"important",label:e("important"),count:a.important,icon:yt,color:"text-amber-400",bg:"bg-amber-50 dark:bg-amber-900/20"}];return s.jsxs("div",{className:"h-full overflow-y-auto custom-scrollbar p-4 md:p-6 space-y-6",children:[s.jsxs("header",{className:"mb-4",children:[s.jsx("h1",{className:"text-2xl font-bold text-gray-800 dark:text-gray-100",children:e("dashboard")}),s.jsxs("p",{className:"text-gray-500 dark:text-gray-400 text-sm mt-1",children:[e("general_dashboard.overall_stats")," & ",e("general_dashboard.time_block_usage")]})]}),s.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:o.map(i=>s.jsxs("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm flex items-center justify-between",children:[s.jsxs("div",{children:[s.jsx("p",{className:"text-xs font-bold text-gray-400 uppercase tracking-wider mb-1",children:i.label}),s.jsx("p",{className:"text-2xl font-black text-gray-800 dark:text-gray-100 tabular-nums",children:i.count})]}),s.jsx("div",{className:`p-3 rounded-lg ${i.bg}`,children:s.jsx(i.icon,{className:`w-6 h-6 ${i.color}`})})]},i.id))}),s.jsxs("div",{className:"bg-white/50 dark:bg-gray-800/50 rounded-xl p-4 border border-gray-100 dark:border-gray-800",children:[s.jsx("h2",{className:"text-sm font-bold text-gray-700 dark:text-gray-300 mb-2",children:e("general_dashboard.overall_stats")}),s.jsx(dt,{tasks:t.filter(i=>i.status!=="completed"),timeBlockId:null})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsx("h2",{className:"text-lg font-bold text-gray-800 dark:text-gray-100",children:e("general_dashboard.time_block_usage")}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(i=>{const l=t.filter(c=>c.timeBlockId===i.id&&c.status!=="completed");return l.length===0?null:s.jsx("div",{className:"p-4 rounded-xl border border-gray-100 dark:border-gray-800 bg-white dark:bg-gray-800 shadow-sm",children:s.jsx(dt,{tasks:l,timeBlockId:i.id||null})},i.id)})})]})]})},Tt=k.forwardRef(({className:e,label:t,error:r,leftIcon:a,rightIcon:n,containerClassName:o,id:i,...l},c)=>{const d=k.useId(),h=i||d;return s.jsxs("div",{className:T("flex flex-col gap-1.5",o),children:[t&&s.jsx("label",{htmlFor:h,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),s.jsxs("div",{className:"relative group",children:[a&&s.jsx("div",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:a}),s.jsx("input",{ref:c,id:h,className:T("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-2.5 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",r?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 group-hover:border-gray-300 dark:group-hover:border-gray-600",a&&"pl-10",n&&"pr-10",e),"aria-invalid":!!r,"aria-describedby":r?`${h}-error`:void 0,...l}),n&&s.jsx("div",{className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 z-10 pointer-events-none",children:n})]}),r&&s.jsx("p",{id:`${h}-error`,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:r})]})});Tt.displayName="Input";const fo=()=>{const{t:e}=M(),{query:t,setSearchQuery:r,setFilter:a}=ee(),{setView:n}=te(),[o,i]=k.useState(t),l=k.useRef(null);k.useEffect(()=>{var u;(u=l.current)==null||u.focus()},[]),k.useEffect(()=>{t!==o&&i(t)},[t]),k.useEffect(()=>{const u=setTimeout(()=>{o!==t&&r(o)},150);return()=>{clearTimeout(u)}},[o,t,r]);const c=u=>{i(u.target.value)},d=()=>{var u;i(""),r(""),(u=l.current)==null||u.focus()},h=()=>{r(""),a("inbox"),n("tasks")};return s.jsxs("div",{className:"flex flex-col h-full bg-gradient-to-br from-slate-50 via-white to-blue-50/30 dark:from-gray-900 dark:via-gray-900 dark:to-gray-800",children:[s.jsxs("div",{className:"relative p-4 sm:p-6 border-b border-gray-100 dark:border-gray-800",children:[s.jsx("div",{className:"absolute top-0 right-0 w-64 h-64 bg-gradient-to-br from-blue-400/10 to-purple-400/10 rounded-full blur-3xl -z-0"}),s.jsxs("div",{className:"relative z-10 max-w-3xl mx-auto",children:[s.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[s.jsx(ce,{variant:"ghost",size:"icon",onClick:h,className:"rounded-xl transition-all hover:scale-105 active:scale-95","aria-label":e("close"),children:s.jsx(ps,{className:"w-5 h-5 text-gray-500"})}),s.jsx("h1",{className:"text-xl font-bold text-gray-900 dark:text-white",children:e("sidebar.search_placeholder")})]}),s.jsxs("div",{className:"relative group",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/20 to-purple-500/20 rounded-2xl blur-xl opacity-0 group-focus-within:opacity-100 transition-opacity duration-300 pointer-events-none"}),s.jsx(Tt,{ref:l,id:"search-input",name:"search",type:"text",value:o,onChange:c,placeholder:e("sidebar.search_placeholder"),className:"py-4 text-base bg-white/80 dark:bg-gray-800/80 backdrop-blur-xl border-gray-200/50 dark:border-gray-700/50 rounded-2xl shadow-lg shadow-gray-200/50 dark:shadow-black/20",leftIcon:s.jsx(Me,{className:"w-5 h-5"}),rightIcon:o?s.jsx("button",{type:"button",onClick:d,className:"p-1 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors pointer-events-auto","aria-label":e("clear"),children:s.jsx(ms,{className:"w-5 h-5"})}):void 0})]}),!o&&s.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs text-gray-400",children:[s.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-100 dark:bg-gray-800 rounded border border-gray-200 dark:border-gray-700 font-mono",children:"/"}),s.jsx("span",{children:e("search_view.tips")})]}),o&&s.jsxs("p",{className:"mt-3 text-sm text-gray-500 dark:text-gray-400 flex items-center gap-2",children:[s.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-blue-500 animate-pulse"}),e("search_view.results_for",{query:o})]})]})]}),s.jsx("div",{className:"flex-1 overflow-hidden",children:o?s.jsx(jr,{}):s.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-gray-400 dark:text-gray-500 p-8",children:[s.jsxs("div",{className:"relative",children:[s.jsx("div",{className:"absolute inset-0 bg-gradient-to-r from-blue-500/10 to-purple-500/10 rounded-full blur-2xl"}),s.jsx("div",{className:"relative w-24 h-24 rounded-full bg-gradient-to-br from-gray-100 to-gray-200 dark:from-gray-800 dark:to-gray-700 flex items-center justify-center mb-6",children:s.jsx(Me,{className:"w-12 h-12 text-gray-400 dark:text-gray-500",strokeWidth:1.5})})]}),s.jsx("p",{className:"text-lg font-medium text-gray-600 dark:text-gray-300 mb-2",children:e("search_view.empty_title")}),s.jsx("p",{className:"text-sm text-center max-w-xs opacity-75",dangerouslySetInnerHTML:{__html:e("search_view.empty_desc")}})]})})]})},xo=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=k.useCallback(c=>!e||!t?()=>{}:gn(e,c),[e,t]),n=e?hn(e):!1,{data:o,isPending:i}=ve(["targets",t||void 0,e||void 0],a,e&&n?un(e):void 0);return{targets:o||[],loading:r||!!e&&i}},bo=S.memo(({kgi:e,currentTab:t,onTabChange:r,collapsed:a,onToggleCollapse:n})=>{const{t:o}=M(),i={good:"text-emerald-500",warning:"text-amber-500",danger:"text-red-500"},l={good:"bg-emerald-500",warning:"bg-amber-500",danger:"bg-red-500"},c=i[e.status]||"text-gray-500",d=l[e.status]||"bg-gray-500",h=[{id:"backward",label:o("backward_map"),icon:"ðŸ—ºï¸"},{id:"woop",label:o("woop_board"),icon:"âœ¨"},{id:"okr",label:o("okr_tree"),icon:"ðŸŽ¯"}];return s.jsx("div",{className:`mb-6 bg-white/80 dark:bg-gray-800/80 backdrop-blur-md rounded-2xl border border-gray-200 dark:border-gray-700 shadow-lg transition-all duration-300 mx-4 mt-4 ${a?"py-2":"py-4"}`,children:s.jsxs("div",{className:"px-6 flex items-center justify-between gap-6",children:[s.jsx("div",{className:"flex-1 min-w-0",children:s.jsx("h1",{className:`font-bold text-gray-900 dark:text-white truncate transition-all duration-300 ${a?"text-sm opacity-50":"text-base"}`,children:e.title})}),s.jsx("div",{className:"flex-1 max-w-md hidden sm:block",children:s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsx("div",{className:"flex-1",children:s.jsx("div",{className:"h-3 overflow-hidden rounded-full bg-gray-200 dark:bg-gray-700",children:s.jsx("div",{style:{width:`${e.progress}%`},className:`h-full ${d} transition-all duration-1000 ease-out rounded-full`})})}),s.jsxs("span",{className:`font-black ${c} tabular-nums text-sm whitespace-nowrap`,children:[e.progress,"%"]})]})}),s.jsxs("div",{className:"flex items-center gap-6 flex-shrink-0",children:[s.jsxs("div",{className:"text-center hidden sm:block",children:[s.jsx("div",{className:"text-xs text-gray-500 dark:text-gray-400",children:o("target_dashboard.days_left")}),s.jsxs("div",{className:`font-black ${c} tabular-nums`,children:[e.daysLeft,s.jsx("span",{className:"text-xs font-medium ml-0.5 text-gray-400",children:o("target_dashboard.days_unit")})]})]}),s.jsx("div",{className:"flex gap-1 bg-gray-100 dark:bg-gray-900/50 p-1 rounded-lg",children:h.map(u=>s.jsxs("button",{onClick:()=>r(u.id),className:`group px-3 py-1.5 rounded-md text-xs font-bold transition-all flex flex-col sm:flex-row items-center gap-1 sm:gap-2 ${t===u.id?"bg-white dark:bg-gray-700 shadow-sm text-gray-900 dark:text-white":"text-gray-500 hover:text-gray-700 dark:hover:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-800"}`,title:u.label,children:[s.jsx("span",{className:"text-sm sm:text-base leading-none",children:u.icon}),s.jsx("span",{className:"text-[10px] sm:text-xs leading-none",children:u.label})]},u.id))}),s.jsx(ce,{variant:"ghost",size:"icon",onClick:n,title:o(a?"target_dashboard.header_expand":"target_dashboard.header_collapse"),className:"rounded-lg",children:s.jsx(fs,{className:`w-4 h-4 text-gray-500 transition-transform duration-300 ${a?"rotate-180":""}`})})]})]})})}),yo=S.memo(({data:e})=>{const{t}=M();return!e||!e.milestones?s.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")}):s.jsxs("div",{className:"max-w-4xl mx-auto relative pb-10",children:[s.jsx("div",{className:"absolute left-8 top-0 bottom-0 w-0.5 bg-gray-200 dark:bg-gray-700 -translate-x-1/2"}),e.milestones.map((r,a)=>{const n=r.type==="goal",o=r.type==="current",i=r.completed;let l,c="";return n?(l=s.jsx("div",{className:"w-8 h-8 rounded-full bg-yellow-400 text-white flex items-center justify-center text-base shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"ðŸ†"}),c="bg-yellow-50 dark:bg-yellow-900/20 border-yellow-200 dark:border-yellow-700"):o?(l=s.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center text-xs font-bold shadow-md ring-4 ring-gray-50 dark:ring-gray-900 z-10 animate-pulse relative",children:t("target_dashboard.backward.now_icon")}),c="border-blue-500 border-2 shadow-md"):i?(l=s.jsx("div",{className:"w-6 h-6 rounded-full bg-green-500 text-white flex items-center justify-center text-xs shadow ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative",children:"âœ“"}),c="bg-gray-50 dark:bg-gray-800 opacity-70"):(l=s.jsx("div",{className:"w-5 h-5 rounded-full bg-white dark:bg-gray-700 border-2 border-gray-300 dark:border-gray-500 ring-4 ring-gray-50 dark:ring-gray-900 z-10 relative"}),c="bg-white dark:bg-gray-800"),s.jsxs("div",{className:"relative flex items-center mb-4 animate-fade-in group",style:{animationDelay:`${a*50}ms`},children:[s.jsx("div",{className:"w-16 flex-shrink-0 flex justify-center items-center z-10",children:l}),s.jsx("div",{className:"flex-1 pr-4 min-w-0",children:s.jsx("div",{className:`px-3 py-3 rounded-lg border ${o&&!c.includes("border-2")?"border-2 border-blue-500":o?"":"border-gray-200 dark:border-gray-700"} ${c} shadow-sm transition-all hover:shadow-md hover:translate-x-1 cursor-pointer`,children:s.jsxs("div",{className:"flex items-center justify-between gap-3",children:[s.jsx("span",{className:`text-xs font-bold ${o?"text-blue-600":"text-gray-500"} flex-shrink-0 font-mono`,children:r.date}),s.jsx("h3",{className:"font-bold text-gray-900 dark:text-white flex-1 truncate text-sm md:text-base",children:r.title}),n&&s.jsx("span",{className:"text-[10px] bg-yellow-100 text-yellow-800 px-2 py-0.5 rounded-full font-bold flex-shrink-0",children:t("target_dashboard.backward.target_label")}),o&&s.jsx("span",{className:"text-[10px] text-blue-500 font-bold flex-shrink-0",children:t("target_dashboard.backward.now_label")})]})})})]},r.id||`milestone-${a}`)})]})}),ko=S.memo(({data:e})=>{const{t}=M();if(!e||!e.keyResults)return s.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")});const r=a=>a==="high"?"bg-emerald-500":a==="medium"?"bg-amber-500":"bg-red-500";return s.jsxs("div",{className:"max-w-4xl mx-auto animate-fade-in",children:[s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-8 rounded-2xl border-2 border-blue-100 dark:border-blue-900 shadow-lg text-center mb-12 relative z-10 transition-transform hover:scale-[1.01]",children:[s.jsx("div",{className:"absolute top-[-15px] left-1/2 transform -translate-x-1/2 bg-blue-600 text-white px-4 py-1 rounded-full text-xs font-bold uppercase tracking-wider shadow-md",children:t("target_dashboard.okr.objective_label")}),s.jsxs("h2",{className:"font-black text-2xl md:text-3xl text-transparent bg-clip-text bg-gradient-to-r from-blue-600 to-indigo-600 leading-tight",children:['"',e.objective,'"']}),s.jsx("div",{className:"absolute bottom-[-50px] left-1/2 w-1 h-[50px] bg-gray-200 dark:bg-gray-700 z-0"})]}),s.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 relative",children:[s.jsx("div",{className:"hidden md:block absolute top-[-25px] left-[16.66%] right-[16.66%] h-1 bg-gray-200 dark:bg-gray-700 border-t border-gray-200 dark:border-gray-700 rounded-t-xl z-0"}),e.keyResults.map(a=>{const n=a.target>0?Math.round(a.current/a.target*100):0,o=r(a.confidence);return s.jsxs("div",{className:"relative pt-6",children:[s.jsx("div",{className:"absolute top-[-25px] left-1/2 w-1 h-[25px] bg-gray-200 dark:bg-gray-700 md:block hidden"}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 p-5 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-lg hover:border-blue-300 dark:hover:border-blue-700 transition-all group h-full flex flex-col",children:[s.jsxs("div",{className:"flex justify-between items-start mb-3",children:[s.jsxs("span",{className:"text-xs font-bold text-gray-400",children:[t("target_dashboard.okr.kr_prefix"),a.id]}),s.jsx("div",{className:`w-3 h-3 rounded-full ${o}`,title:`Confidence: ${a.confidence}`})]}),s.jsx("h4",{className:"font-bold text-gray-800 dark:text-gray-200 mb-4 h-12 line-clamp-2",children:a.text}),s.jsxs("div",{className:"space-y-1 mt-auto",children:[s.jsxs("div",{className:"flex justify-between text-xs font-bold text-gray-500 dark:text-gray-400",children:[s.jsx("span",{children:a.current}),s.jsx("span",{children:a.target})]}),s.jsx("div",{className:"h-2 w-full bg-gray-100 dark:bg-gray-900 rounded-full overflow-hidden",children:s.jsx("div",{className:"h-full bg-blue-500 rounded-full transition-all duration-1000",style:{width:`${n}%`}})}),s.jsxs("div",{className:"text-right text-sm font-black text-blue-600 mt-1",children:[n,"%"]})]})]})]},a.id)})]})]})}),wo=S.memo(({data:e})=>{const{t}=M();return!e||!e.obstacles?s.jsx("div",{className:"p-4 text-center text-gray-500",children:t("target_dashboard.loading_error")}):s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 max-w-6xl mx-auto animate-fade-in",children:[s.jsxs("div",{className:"space-y-6",children:[s.jsxs("div",{className:"bg-gradient-to-br from-indigo-50 to-blue-50 dark:from-indigo-900/30 dark:to-blue-900/30 p-6 rounded-2xl border border-indigo-100 dark:border-indigo-800 shadow-sm hover:shadow-md transition-shadow",children:[s.jsx("h3",{className:"text-sm font-bold text-indigo-500 uppercase mb-2",children:t("target_dashboard.woop.wish_label")}),s.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',e.wish,'"']})]}),s.jsxs("div",{className:"bg-gradient-to-br from-pink-50 to-rose-50 dark:from-pink-900/30 dark:to-rose-900/30 p-6 rounded-2xl border border-pink-100 dark:border-pink-800 shadow-sm hover:shadow-md transition-shadow",children:[s.jsx("h3",{className:"text-sm font-bold text-pink-500 uppercase mb-2",children:t("target_dashboard.woop.outcome_label")}),s.jsxs("p",{className:"font-bold text-gray-900 dark:text-white leading-relaxed text-lg",children:['"',e.outcome,'"']})]})]}),s.jsxs("div",{className:"space-y-4",children:[s.jsxs("h3",{className:"text-sm font-bold text-gray-500 uppercase mb-2 flex items-center",children:[s.jsx("span",{className:"mr-2",children:"ðŸš§"})," ",t("target_dashboard.woop.obstacles_header")]}),e.obstacles.map(r=>s.jsxs("div",{className:"group bg-white dark:bg-gray-800 rounded-xl border border-gray-200 dark:border-gray-700 shadow-sm hover:shadow-md transition-all overflow-hidden relative",children:[s.jsx("div",{className:"p-5 border-l-4 border-gray-400 bg-gray-50 dark:bg-gray-800 relative z-10 transition-transform group-hover:translate-x-1",children:s.jsxs("h4",{className:"font-bold text-gray-700 dark:text-gray-300 flex items-center",children:[s.jsx("span",{className:"bg-gray-200 dark:bg-gray-700 text-xs px-2 py-1 rounded mr-3 text-gray-600 dark:text-gray-400",children:t("target_dashboard.woop.obstacle_badge")}),r.text]})}),s.jsxs("div",{className:"p-4 bg-emerald-50 dark:bg-emerald-900/20 border-t border-gray-100 dark:border-gray-700 flex items-start",children:[s.jsx("div",{className:"flex-shrink-0 mt-1",children:s.jsx("span",{className:"block w-6 h-6 rounded-full bg-emerald-100 text-emerald-600 flex items-center justify-center text-xs font-bold",children:t("target_dashboard.woop.if_badge")})}),s.jsx("div",{className:"ml-3 flex-1",children:s.jsxs("p",{className:"text-emerald-800 dark:text-emerald-300 font-bold text-sm",children:["â†’ ",r.plan]})}),s.jsxs("div",{className:"ml-2 flex flex-col items-center",children:[s.jsx("span",{className:"text-[10px] font-bold text-gray-400 uppercase",children:t("target_dashboard.woop.score_label")}),s.jsx("span",{className:"text-lg font-black text-emerald-500 leading-none",children:r.overcomeCount})]})]})]},r.id)),s.jsx("button",{className:"w-full py-3 border-2 border-dashed border-gray-300 dark:border-gray-700 rounded-xl text-gray-400 hover:border-gray-400 hover:text-gray-500 dark:hover:text-gray-300 transition flex items-center justify-center font-bold text-sm",children:t("target_dashboard.woop.add_obstacle")})]})]})}),jo=()=>{var x;const{t:e}=M(),{targets:t}=xo(),[r,a]=k.useState("backward"),[n,o]=k.useState(!1),i=t.filter(g=>{var w;return((w=g.mode)==null?void 0:w.toLowerCase())===r.toLowerCase()}),l=g=>({milestones:[{date:e("target_dashboard.backward.timeline.future"),title:g.data.goal_kgi||e("target_dashboard.kgi_default"),type:"goal",completed:!1},{date:e("target_dashboard.backward.timeline.milestone"),title:g.data.milestone_minus_1mo||"",type:"milestone",completed:!1},{date:e("target_dashboard.backward.timeline.today"),title:e("target_dashboard.backward.current_status"),type:"current",completed:!0},{date:e("target_dashboard.backward.timeline.now"),title:g.data.first_action||"",type:"action",completed:!1}]}),c=g=>({wish:g.data.wish||"",outcome:g.data.outcome||"",obstacles:[{id:1,text:g.data.obstacle||"",plan:g.data.plan||"",overcomeCount:0}]}),d=g=>({objective:g.data.objective||"",keyResults:[{id:1,text:g.data.kr_1||`${e("target_dashboard.okr.kr_prefix")}1`,current:0,target:100,confidence:"medium"},{id:2,text:g.data.kr_2||`${e("target_dashboard.okr.kr_prefix")}2`,current:0,target:100,confidence:"medium"},{id:3,text:g.data.kr_3||`${e("target_dashboard.okr.kr_prefix")}3`,current:0,target:100,confidence:"medium"}]}),h=()=>i.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500 dark:text-gray-400",children:s.jsx("p",{className:"mb-4",children:e("target_dashboard.no_targets",{mode:r.toUpperCase()})})}):s.jsx("div",{className:"space-y-12",children:i.map(g=>{var w;return s.jsxs("div",{className:"border-b border-gray-200 dark:border-gray-700 pb-12 last:border-0",children:[s.jsx("div",{className:"mb-4 text-xs text-gray-400 flex justify-end",children:e("target_dashboard.created_at",{date:((w=$(g.createdAt))==null?void 0:w.toLocaleDateString())||"Unknown"})}),r==="backward"&&s.jsx(yo,{data:l(g)}),r==="woop"&&s.jsx(wo,{data:c(g)}),r==="okr"&&s.jsx(ko,{data:d(g)})]},g.id)})}),u=i[0],y={title:((g,w)=>g?w==="backward"?g.data.goal_kgi||e("target_dashboard.kgi_default"):w==="woop"?g.data.wish||e("target_dashboard.wish_default"):w==="okr"?g.data.objective||e("target_dashboard.obj_default"):e("target_dashboard.target_default"):e("target_dashboard.title_default"))(u,r),progress:Number(((x=u==null?void 0:u.data)==null?void 0:x.progress)||0),daysLeft:0,status:"good"};return s.jsxs("div",{className:"h-full flex flex-col bg-gray-50 dark:bg-gray-900 overflow-hidden",children:[s.jsx(bo,{kgi:y,currentTab:r,onTabChange:a,collapsed:n,onToggleCollapse:()=>o(!n)}),s.jsx("div",{className:"flex-1 overflow-y-auto custom-scrollbar px-6 pb-6 pt-4",children:h()})]})},vo=[{id:"okr",title:"OKR (Objectives and Key Results)",subTitle:"é‡Žå¿ƒçš„ãªç›®æ¨™ã¨æˆæžœæŒ‡æ¨™",color:"blue",icon:"ðŸŽ¯",concept:{summary:"ã€Œä½•ã‚’é”æˆã—ãŸã„ã‹ï¼ˆObjectiveï¼‰ã€ã¨ã€Œã©ã†ã‚„ã£ã¦é”æˆã‚’æ¸¬ã‚‹ã‹ï¼ˆKey Resultsï¼‰ã€ã‚’ã‚»ãƒƒãƒˆã§ç®¡ç†ã™ã‚‹æ‰‹æ³•ã€‚",detail:"Googleã‚„Intelã‚‚æŽ¡ç”¨ã™ã‚‹ç›®æ¨™ç®¡ç†ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ã€‚60-70%ã®é”æˆåº¦ã§æˆåŠŸã¨ã¿ãªã™ã€Œãƒ ãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆã€ãªç›®æ¨™è¨­å®šãŒç‰¹å¾´ã§ã€ç¾çŠ¶ç¶­æŒã§ã¯ãªãé£›èºçš„ãªæˆé•·ã‚’ä¿ƒã—ã¾ã™ã€‚"},useCases:[{title:"ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢å€‹äººã®ã‚¹ã‚­ãƒ«ã‚¢ãƒƒãƒ—",before:"æ¼ ç„¶ã¨ã€ŒæŠ€è¡“åŠ›ã‚’ä¸Šã’ãŸã„ã€ã¨è€ƒãˆã€æ‰‹å½“ãŸã‚Šæ¬¡ç¬¬ã«æœ¬ã‚’èª­ã‚€ãŒèº«ã«ã¤ã‹ãªã„ã€‚",after:"O:ã€Œãƒãƒ¼ãƒ ã®Rustç§»è¡Œã‚’ãƒªãƒ¼ãƒ‰ã™ã‚‹å­˜åœ¨ã«ãªã‚‹ã€ KR:ã€ŒRustã§ãƒžã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹ã‚’1ã¤å®Ÿè£…ã™ã‚‹ã€ã€Œç¤¾å†…å‹‰å¼·ä¼šã‚’3å›žé–‹å‚¬ã™ã‚‹ã€ã¨è¨­å®šã—ã€å­¦ç¿’ã®ç„¦ç‚¹ãŒå®šã¾ã£ãŸã€‚"},{title:"å‰¯æ¥­ãƒ»å€‹äººé–‹ç™º",before:"ã€Œã„ã¤ã‹ã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã„ã€ã¨æ€ã„ã¤ã¤ã€ãƒ€ãƒ©ãƒ€ãƒ©ã¨é–‹ç™ºã‚’ç¶šã‘ã¦ã—ã¾ã†ã€‚",after:"O:ã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼ã«æ„›ã•ã‚Œã‚‹MVPã‚’ãƒªãƒªãƒ¼ã‚¹ã™ã‚‹ã€ KR:ã€Œ3æœˆæœ«ã¾ã§ã«ã‚¹ãƒˆã‚¢å…¬é–‹ã€ã€ŒåˆæœŸãƒ¦ãƒ¼ã‚¶ãƒ¼100äººç²å¾—ã€ã€Œé€±æ¬¡ã‚¢ã‚¯ãƒ†ã‚£ãƒ–çŽ‡30%é”æˆã€ã¨æœŸé™ã¨æ•°å­—ã§ã‚³ãƒŸãƒƒãƒˆã—ãŸã€‚"}],tips:[{q:"ç›®æ¨™ãŒé«˜ã™ãŽã¦ãƒ¢ãƒãƒ™ãƒ¼ã‚·ãƒ§ãƒ³ãŒç¶šãã¾ã›ã‚“ã€‚",a:"OKRã¯ã€Œé”æˆã§ããªãã¦ã‚‚ãƒšãƒŠãƒ«ãƒ†ã‚£ãŒãªã„ã€ã®ãŒå‰æã§ã™ã€‚60%é”æˆã§ãã‚Œã°å¾¡ã®å­—ã¨è€ƒãˆã€å¤±æ•—ã‚’æã‚Œãšã«æŒ‘æˆ¦ã™ã‚‹ã“ã¨è‡ªä½“ã‚’è©•ä¾¡ã—ã¾ã—ã‚‡ã†ã€‚é€²æ—ã¯é€±æ¬¡ã§ãƒã‚§ãƒƒã‚¯ã—ï¼ˆWinã‚»ãƒƒã‚·ãƒ§ãƒ³ï¼‰ã€å°ã•ãªå‰é€²ã‚’ç¥ã†ã“ã¨ãŒé‡è¦ã§ã™ã€‚"},{q:"KRï¼ˆæˆæžœæŒ‡æ¨™ï¼‰ã®æ•°å­—ã¯ã©ã†æ±ºã‚ã‚Œã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œé ‘å¼µã‚Œã°é”æˆã§ãã‚‹ï¼ˆ50%ï¼‰ã€ã¨ã€Œã‹ãªã‚Šé‹ãŒè‰¯ããªã„ã¨ç„¡ç†ï¼ˆ100%ï¼‰ã€ã®é–“ã€ã€Œå°‘ã—èƒŒä¼¸ã³ãŒå¿…è¦ï¼ˆ70%ï¼‰ã€ãªãƒ©ã‚¤ãƒ³ã‚’ç‹™ã„ã¾ã—ã‚‡ã†ã€‚è¨ˆæ¸¬ä¸å¯èƒ½ãªã€Œã€œã‚’é ‘å¼µã‚‹ã€ã¯NGã§ã™ã€‚"}]},{id:"woop",title:"WOOP (Wish, Outcome, Obstacle, Plan)",subTitle:"ç§‘å­¦çš„ãªé¡˜æœ›å®Ÿç¾ãƒ¡ã‚½ãƒƒãƒ‰",color:"amber",icon:"âœ¨",concept:{summary:"ã€Œæœ€é«˜ã®æœªæ¥ã€ã¨ã€Œç¾å®Ÿã®éšœå®³ã€ã‚’å¯¾æ¯”ã•ã›ã€è„³ã‚’æœ¬æ°—ã«ã•ã›ã‚‹ï¼ˆãƒ¡ãƒ³ã‚¿ãƒ«ãƒ»ã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒ†ã‚£ãƒ³ã‚°ï¼‰ã€‚",detail:"ãŸã ãƒã‚¸ãƒ†ã‚£ãƒ–ã«è€ƒãˆã‚‹ã ã‘ã§ãªãã€ãã‚Œã‚’é˜»ã‚€è‡ªåˆ†ã®å†…é¢ã®éšœå®³ã‚’ç›´è¦–ã—ã€ã€ŒIf-Thenãƒ—ãƒ©ãƒ³ï¼ˆã‚‚ã—XãŒèµ·ããŸã‚‰Yã™ã‚‹ï¼‰ã€ã‚’äº‹å‰ã«ç”¨æ„ã™ã‚‹ã“ã¨ã§ã€å®Ÿè¡ŒçŽ‡ã‚’é£›èºçš„ã«é«˜ã‚ã¾ã™ã€‚"},useCases:[{title:"æ¯Žæ—¥ã®é‹å‹•ç¿’æ…£",before:"ã€Œç—©ã›ãŸã„ã€ã¨æ€ã†ã ã‘ã§ã€ä»•äº‹ã§ç–²ã‚Œã‚‹ã¨ã€Œä»Šæ—¥ã¯ã„ã„ã‚„ã€ã¨ã‚µãƒœã£ã¦ã—ã¾ã†ã€‚",after:"W:ã€Œæ¯Žæ—¥30åˆ†èµ°ã‚‹ã€ O:ã€Œä½“ãŒè»½ããªã‚Šã€è‡ªä¿¡ãŒã¤ãã€ Obs:ã€Œä»•äº‹å¸°ã‚Šã®ç–²åŠ´æ„Ÿã€ Plan:ã€Œã‚‚ã—ã€Žç–²ã‚ŒãŸã€ã¨æ„Ÿã˜ãŸã‚‰ã€ã€Žã¨ã‚Šã‚ãˆãšã‚¦ã‚§ã‚¢ã«ç€æ›¿ãˆã‚‹ã€ã€ã¨æ±ºã‚ã¦ãŠãã“ã¨ã§ã€è‡ªå‹•çš„ã«è¡Œå‹•ã§ãã‚‹ã‚ˆã†ã«ãªã£ãŸã€‚"},{title:"è³‡æ ¼è©¦é¨“ã®å‹‰å¼·",before:"ã‚¹ãƒžãƒ›ã®é€šçŸ¥ãŒæ°—ã«ãªã£ã¦é›†ä¸­åŠ›ãŒé€”åˆ‡ã‚Œã¦ã—ã¾ã†ã€‚",after:"Obs:ã€Œã‚¹ãƒžãƒ›ã‚’è¦‹ã¦ã—ã¾ã†ç™–ã€ Plan:ã€Œã‚‚ã—ã€Žå‹‰å¼·ã‚’å§‹ã‚ã‚‹ã€æ™‚ã¯ã€ã€Žã‚¹ãƒžãƒ›ã‚’åˆ¥ã®éƒ¨å±‹ã«ç½®ãã€ã€ã¨ã„ã†ã‚»ãƒƒãƒˆè¡Œå‹•ã‚’å¾¹åº•ã—ã€é›†ä¸­æ™‚é–“ã‚’ç¢ºä¿ã—ãŸã€‚"}],tips:[{q:"éšœå®³ï¼ˆObstacleï¼‰ã«ã¯ä½•ã‚’æ›¸ã‘ã°ã„ã„ã§ã™ã‹ï¼Ÿ",a:"ã€Œæ™‚é–“ãŒãªã„ã€ã€ŒãŠé‡‘ãŒãªã„ã€ã¨ã„ã£ãŸå¤–éƒ¨è¦å› ã§ã¯ãªãã€ã€Œã¤ã„ãƒ€ãƒ©ãƒ€ãƒ©ã—ã¦ã—ã¾ã†ã€ã€Œå¤±æ•—ã™ã‚‹ã®ãŒæ€–ã„ã€ã¨ã„ã£ãŸã€Žè‡ªåˆ†ã®å†…é¢ã«ã‚ã‚‹æ„Ÿæƒ…ã‚„ç™–ã€ã‚’æŽ¢ã‚Šã¾ã—ã‚‡ã†ã€‚ã“ã‚Œã“ããŒã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«å¯èƒ½ãªçœŸã®éšœå®³ã§ã™ã€‚"},{q:"è¨ˆç”»ï¼ˆPlanï¼‰ãŒã†ã¾ãæ©Ÿèƒ½ã—ã¾ã›ã‚“ã€‚",a:"ã€Œã‚‚ã—ã€œãªã‚‰ã€ã®æ¡ä»¶ï¼ˆãƒˆãƒªã‚¬ãƒ¼ï¼‰ã‚’ã‚‚ã£ã¨å…·ä½“çš„ã«ã—ã¾ã—ã‚‡ã†ã€‚ã€Œç–²ã‚ŒãŸã‚‰ã€ã‚ˆã‚Šã‚‚ã€Œå¸°å®…ã—ã¦ã‚½ãƒ•ã‚¡ã‚’è¦‹ãŸçž¬é–“ã€ã®æ–¹ãŒè„³ã¯åå¿œã—ã‚„ã™ããªã‚Šã¾ã™ã€‚ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚‚ã€Œé ‘å¼µã‚‹ã€ã§ã¯ãªãã€Œ5åˆ†ã ã‘ã‚„ã‚‹ã€ãªã©ãƒãƒ¼ãƒ‰ãƒ«ã‚’æ¥µé™ã¾ã§ä¸‹ã’ã¦ã¿ã¦ãã ã•ã„ã€‚"}]},{id:"backward",title:"Backward Design (é€†ç®—æ€è€ƒ)",subTitle:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰ç¾åœ¨åœ°ã¸ã®æž¶ã‘æ©‹",color:"purple",icon:"ðŸ—ºï¸",concept:{summary:"ã€Œã‚ã‚ŠãŸã„å§¿ï¼ˆã‚´ãƒ¼ãƒ«ï¼‰ã€ã‹ã‚‰æ™‚é–“ã‚’å·»ãæˆ»ã—ã¦ã€ä»Šã‚„ã‚‹ã¹ãã“ã¨ã‚’æ±ºå®šã™ã‚‹ã€‚",detail:"ç¾åœ¨ã‹ã‚‰ã®ç©ã¿ä¸Šã’ï¼ˆForecastingï¼‰ã§ã¯ãªãã€æœªæ¥ã‹ã‚‰ã®é€†ç®—ï¼ˆBackcastingï¼‰ã‚’è¡Œã†ã“ã¨ã§ã€ç¾çŠ¶ã®å»¶é•·ç·šä¸Šã«ã¯ãªã„é£›èºçš„ãªæˆæžœã‚„ã€ç„¡é§„ã®ãªã„æœ€çŸ­ãƒ«ãƒ¼ãƒˆãŒè¦‹ãˆã¦ãã¾ã™ã€‚é•·æœŸãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å¿…é ˆã®è¦–ç‚¹ã§ã™ã€‚"},useCases:[{title:"åŠå¹´å¾Œã®ã‚¤ãƒ™ãƒ³ãƒˆä¸»å‚¬",before:"ã¨ã‚Šã‚ãˆãšä¼šå ´ã ã‘æŠ¼ã•ãˆã¦ã€é›†å®¢ã‚„ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¯ç›´å‰ã«ãªã£ã¦æ…Œã¦ã¦æº–å‚™ã™ã‚‹ã€‚",after:"Goal:ã€Œã‚¤ãƒ™ãƒ³ãƒˆæˆåŠŸã€â†’ 1ãƒ¶æœˆå‰:ã€Œæº€å¸­ã€â†’ 3ãƒ¶æœˆå‰:ã€Œå‘ŠçŸ¥é–‹å§‹ãƒ»LPå®Œæˆã€â†’ ä»Š:ã€Œã‚³ãƒ³ã‚»ãƒ—ãƒˆæ±ºå®šãƒ»ç™»å£‡è€…ã‚ªãƒ•ã‚¡ãƒ¼ã€ã¨ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã‚’ç½®ãã€ä»Šæœˆã®å¿…é ˆã‚¿ã‚¹ã‚¯ã‚’æ´—ã„å‡ºã—ãŸã€‚"},{title:"ã‚­ãƒ£ãƒªã‚¢ãƒã‚§ãƒ³ã‚¸",before:"ä»Šã®ä»•äº‹ãŒå«Œã§è»¢è·ã‚µã‚¤ãƒˆã‚’çœºã‚ã‚‹ãŒã€ç‰¹ã«ã‚¹ã‚­ãƒ«ã‚‚ãªãå‹•ã‘ãªã„ã€‚",after:"Goal:ã€Œ3å¹´å¾Œã«ãƒ•ãƒªãƒ¼ãƒ©ãƒ³ã‚¹ç‹¬ç«‹ã€â†’ 2å¹´å¾Œ:ã€Œå‰¯æ¥­æœˆåŽ20ä¸‡ã€â†’ 1å¹´å¾Œ:ã€Œã‚¹ã‚­ãƒ«ç¿’å¾—ãƒ»ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒªã‚ªå®Œæˆã€â†’ ä»Š:ã€Œã‚¹ã‚¯ãƒ¼ãƒ«é¸ã³ãƒ»å­¦ç¿’æ™‚é–“ã®ç¢ºä¿ã€ã¨é€†ç®—ã—ã€å…·ä½“çš„ãªä¸€æ­©ã‚’è¸ã¿å‡ºã—ãŸã€‚"}],tips:[{q:"é ã„æœªæ¥ã™ãŽã¦ã‚¤ãƒ¡ãƒ¼ã‚¸ãŒæ¹§ãã¾ã›ã‚“ã€‚",a:"ç„¡ç†ã«è©³ç´°ã‚’æ±ºã‚ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚ã¾ãšã¯ã€Œçµ¶å¯¾ã«ã“ã†ãªã£ã¦ã„ãŸã„ã€ã¨ã„ã†çŠ¶æ…‹ï¼ˆKGIï¼‰ã¨æœŸé™ã‚’æ±ºã‚ã€ãã“ã‹ã‚‰ã€Œãã®ç›´å‰ã¯ã©ã†ãªã£ã¦ã„ã‚‹ã¯ãšã‹ï¼Ÿã€ã¨1ã‚¹ãƒ†ãƒƒãƒ—ãšã¤æˆ»ã£ã¦ã¿ã¾ã—ã‚‡ã†ã€‚ç›´è¿‘ã®ãƒžã‚¤ãƒ«ã‚¹ãƒˆãƒ¼ãƒ³ã ã‘è©³ç´°ã§ã‚ã‚Œã°OKã§ã™ã€‚"},{q:"è¨ˆç”»é€šã‚Šã«é€²ã¾ãªã„æ™‚ã¯ï¼Ÿ",a:"é€†ç®—æ€è€ƒã§ä½œã£ãŸè¨ˆç”»ã¯ã€Œä»®èª¬ã€ã§ã™ã€‚çŠ¶æ³ãŒå¤‰ã‚ã‚Œã°ãƒªãƒ«ãƒ¼ãƒˆï¼ˆå†è¨ˆç®—ï¼‰ã™ã‚Œã°è‰¯ã„ã®ã§ã™ã€‚é‡è¦ãªã®ã¯ã€Œã‚´ãƒ¼ãƒ«ã‚’è¦‹å¤±ã‚ãªã„ã“ã¨ã€ã€‚ç¾åœ¨åœ°ãŒå¤‰ã‚ã£ã¦ã‚‚ã€ãƒŠãƒ“ãŒç›®çš„åœ°ã¸ã®ãƒ«ãƒ¼ãƒˆã‚’å¼•ãç›´ã™ã‚ˆã†ã«ã€è¨ˆç”»ã‚’ä¿®æ­£ã—ç¶šã‘ã¾ã—ã‚‡ã†ã€‚"}]}],No=[{id:"okr",title:"OKR (Objectives and Key Results)",subTitle:"Ambitious Goals and Measurable Outcomes",color:"blue",icon:"ðŸŽ¯",concept:{summary:"A goal-setting framework for defining and tracking objectives and their outcomes.",detail:'Adopted by companies like Google and Intel. Characterized by "Moonshot" goals where 60-70% achievement is considered success, encouraging leap-forward growth rather than just the status quo.'},useCases:[{title:"Individual Skill Development",before:'Vaguely thinking "I want to improve my tech skills" and reading books without a focus.',after:`O: "Become a lead in team's Rust migration" KR: "Implement one microservice in Rust", "Hold 3 internal study sessions". Learning focus became crystal clear.`},{title:"Side Projects",before:'Wishing to release an app "someday" but continuing development without a deadline.',after:'O: "Release a MVP loved by users" KR: "App store release by March", "Gain 100 initial users", "Achieve 30% weekly active rate". Committed with dates and numbers.'}],tips:[{q:"The goals are too high and I lose motivation.",a:'OKR assumes "no penalty for falling short". Consider 60% a success and value the challenge itself. Check progress weekly (Win sessions) to celebrate small wins.'},{q:"How should I determine KR numbers?",a:'Aim for a line between "Achievable with effort (50%)" and "Impossible without extreme luck (100%)", approx the "70% stretch" line. Avoid unmeasurable descriptors like "Try hard".'}]},{id:"woop",title:"WOOP (Wish, Outcome, Obstacle, Plan)",subTitle:"A Scientific Method for Goal Realization",color:"amber",icon:"âœ¨",concept:{summary:'Mental Contrasting: Contrast your "best future" with "inner obstacles" to engage the brain.',detail:'Instead of just positive thinking, directly face your inner obstacles and prepare "If-Then Plans" in advance to dramatically increase execution rates.'},useCases:[{title:"Daily Exercise Habit",before:'Thinking "I want to lose weight" but skipping it when tired from work.',after:'W: "Run 30 mins daily" O: "Feel lighter and gain confidence" Obs: "Fatigue after work" Plan: "IF I feel tired, THEN at least change into workout clothes." Started acting automatically.'},{title:"Studying for Certifications",before:"Losing focus due to smartphone notifications.",after:'Obs: "Habit of checking phone" Plan: "IF I start studying, THEN place the phone in another room." Secured focused time.'}],tips:[{q:"What should I write for Obstacles?",a:'Avoid external factors like "no time". Look for emotions or habits within yourself, like "procrastinating" or "fear of failure". These are the true controllable obstacles.'},{q:"My Plan doesn't seem to work.",a:'Make the trigger more specific. Instead of "when tired", use "the moment I see the sofa after returning home". Keep the action extremely simple, like "do it for just 5 minutes".'}]},{id:"backward",title:"Backward Design",subTitle:"Bridging the Gap from Goal to Today",color:"purple",icon:"ðŸ—ºï¸",concept:{summary:'Determine what to do now by rewinding time from your "Ideal State (Goal)".',detail:"By using Backcasting (from future to present) instead of Forecasting (from present to future), you find shortcuts and results beyond the status quo. Essential for long-term projects."},useCases:[{title:"Organizing a Large Event",before:"Booking a venue first, then scrambling for speakers and content at the last minute.",after:'Goal: "Successful Event" -> 1mo before: "Tickets Sold out" -> 3mo before: "Start Promotion/LP Ready" -> Now: "Define Concept/Offer Speakers". Identified must-have tasks for this month.'},{title:"Career Change",before:"Disliking current job but just browsing sites without acting due to lack of skills.",after:'Goal: "Freelance in 3 years" -> 2yrs later: "200k/mo from side work" -> 1yr later: "Complete portfolio" -> Now: "Choose a school/Save study time". Started with concrete steps.'}],tips:[{q:"The future feels too distant to imagine.",a:'No need to decide every detail. Start with your KGI and deadline, then ask "What should have happened just before that?". Only the nearest milestones need full detail.'},{q:"What if I can't follow the plan?",a:`The backward plan is a hypothesis. Re-route when situations change. The important thing is "don't lose sight of the goal". Recalculate your route just like a GPS navigator.`}]}],_o=(e="ja")=>e==="ja"?vo:No,Co=S.memo(({framework:e,onClick:t})=>{const{t:r}=M();return s.jsxs("div",{className:"cursor-pointer bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 p-4 transition-colors hover:border-purple-400 dark:hover:border-purple-500 group",onClick:()=>t(e),role:"button",tabIndex:0,onKeyDown:a=>{(a.key==="Enter"||a.key===" ")&&t(e)},children:[s.jsx("div",{className:"text-2xl mb-2",children:e.icon}),s.jsx("h2",{className:"text-base font-bold text-gray-900 dark:text-white mb-1",children:e.title}),s.jsx("p",{className:"text-xs text-gray-500 dark:text-gray-400 line-clamp-2",children:e.concept.summary}),s.jsxs("div",{className:"mt-3 flex items-center text-xs text-purple-600 dark:text-purple-400 font-medium opacity-70 group-hover:opacity-100 transition-opacity",children:[s.jsx("span",{children:r("wiki.view_details")}),s.jsx(Ae,{className:"w-3 h-3 ml-1 transform transition-transform group-hover:translate-x-0.5"})]})]})}),To=()=>{const{openModal:e}=ne(),{t}=M(),{language:r}=W(),a=_o(r);return s.jsx("div",{className:"h-full bg-gray-50 dark:bg-gray-900 overflow-y-auto custom-scrollbar",children:s.jsxs("div",{className:"max-w-7xl mx-auto px-4 py-8 animate-fade-in",children:[s.jsxs("h1",{className:"text-2xl font-bold text-gray-800 dark:text-white mb-8 flex items-center",children:[s.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-blue-500 to-purple-500 mr-3",children:s.jsx(tr,{className:"w-8 h-8 text-blue-500"})}),s.jsx("span",{className:"bg-clip-text text-transparent bg-gradient-to-r from-gray-800 to-gray-600 dark:from-white dark:to-gray-300",children:t("sidebar.framework_wiki")})]}),s.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:a.map(n=>s.jsx(Co,{framework:n,onClick:o=>e("wiki-framework",o)},n.id))})]})})},Do={backward:{id:"backward",label:"Backward Design",description:"ã‚´ãƒ¼ãƒ«ã‹ã‚‰é€†ç®—ã—ã¦ã€ç€å®Ÿãªã‚¿ã‚¹ã‚¯ã‚’è¨­è¨ˆã—ã¾ã™ã€‚é•·æœŸçš„ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«æœ€é©ã§ã™ã€‚",steps:[{title:"Goal / KGI",description:"æœ€çµ‚ã‚´ãƒ¼ãƒ«ã®æ—¥ä»˜ã¨çŠ¶æ…‹ï¼ˆKGIï¼‰ã‚’å®šç¾©ã—ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼š2025å¹´3æœˆ31æ—¥ã¾ã§ã«ã€æœˆé–“ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãƒ¦ãƒ¼ã‚¶ãƒ¼1ä¸‡äººã‚’é”æˆã™ã‚‹ã€‚",key:"goal_kgi"}]},{title:"Milestone",description:"ã‚´ãƒ¼ãƒ«ã®1ãƒ¶æœˆå‰ã«åˆ°é”ã™ã¹ãçŠ¶æ…‹ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…ãŒå®Œäº†ã—ã€ãƒ™ãƒ¼ã‚¿ç‰ˆã‚’100äººã«é…å¸ƒæ¸ˆã¿ã§ã‚ã‚‹ã€‚",key:"milestone_minus_1mo"}]},{title:"First Action",description:"ä»Šã™ãå§‹ã‚ã‚‹ã¹ãæœ€åˆã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã¯ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šç«¶åˆã‚¢ãƒ—ãƒªã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’åˆ†æžã—ã¦æ©Ÿèƒ½ãƒªã‚¹ãƒˆã‚’ä½œã‚‹ã€‚",key:"first_action"}]}]},woop:{id:"woop",label:"WOOP",description:"é¡˜æœ›ã¨éšœå®³ã‚’å¯¾æ¯”ã•ã›ã€å®Ÿè¡Œè¨ˆç”»ã‚’è‡ªå‹•åŒ–ã—ã¾ã™ã€‚ç¿’æ…£åŒ–ã‚„å›°é›£ãªç›®æ¨™ã«æœ‰åŠ¹ã§ã™ã€‚",steps:[{title:"Wish (é¡˜æœ›)",description:"é”æˆã—ãŸã„ã“ã¨ã¯ä½•ã§ã™ã‹ï¼Ÿï¼ˆæŒ‘æˆ¦çš„ã ãŒé”æˆå¯èƒ½ãªã‚‚ã®ï¼‰",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šæ¯Žæ—¥30åˆ†ã€è‹±èªžã®å‹‰å¼·ã‚’ã™ã‚‹ã€‚",key:"wish"}]},{title:"Outcome (çµæžœ)",description:"ãã‚ŒãŒé”æˆã§ããŸæ™‚ã®ã€Œæœ€é«˜ã®ãƒ¡ãƒªãƒƒãƒˆã€ã‚„æ„Ÿæƒ…ã‚’è©³ã—ãã‚¤ãƒ¡ãƒ¼ã‚¸ã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šå­—å¹•ãªã—ã§æµ·å¤–ãƒ‰ãƒ©ãƒžã‚’æ¥½ã—ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã€è‡ªä¿¡ãŒã¤ãã€‚",key:"outcome"}]},{title:"Obstacle (éšœå®³)",description:"ãã‚Œã‚’é‚ªé­”ã™ã‚‹ã€ã‚ãªãŸè‡ªèº«ã®ã€Œå†…é¢ã®éšœå®³ã€ï¼ˆæ„Ÿæƒ…ãƒ»ç™–ãƒ»æ€ã„è¾¼ã¿ï¼‰ã¯ä½•ã§ã™ã‹ï¼Ÿ",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä»•äº‹ã§ç–²ã‚Œã¦å¸°ã£ã¦ãã‚‹ã¨ã€ã¤ã„ã‚¹ãƒžãƒ›ã§SNSã‚’è¦‹ã¦ã—ã¾ã†ã€‚",key:"obstacle"}]},{title:"Plan (è¨ˆç”»)",description:"ã€Œã‚‚ã—ï¼ˆéšœå®³ï¼‰ãŒèµ·ããŸã‚‰ã€ï¼ˆè¡Œå‹•ï¼‰ã™ã‚‹ã€ã¨ã„ã†å½¢ã§è¨ˆç”»ã‚’ç«‹ã¦ã¾ã—ã‚‡ã†ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šã‚‚ã—ã€Œç–²ã‚Œã¦ã‚½ãƒ•ã‚¡ã«åº§ã‚Šãã†ã€ã«ãªã£ãŸã‚‰ã€ã€Œã™ãã«ãƒ†ã‚­ã‚¹ãƒˆã‚’é–‹ãã€ã¨ã™ã‚‹ã€‚",key:"plan"}]}]},okr:{id:"okr",label:"OKR",description:"é‡Žå¿ƒçš„ãªç›®æ¨™(O)ã¨ã€æ¸¬å®šå¯èƒ½ãªæˆæžœ(KR)ã‚’çµ„ã¿åˆã‚ã›ã¾ã™ã€‚çµ„ç¹”ã‚„ãƒãƒ¼ãƒ ã€é«˜ã„æˆé•·ã‚’ç›®æŒ‡ã™å€‹äººã«ã€‚",steps:[{title:"Objective",description:"å®šæ€§çš„ã§ãƒ¯ã‚¯ãƒ¯ã‚¯ã™ã‚‹ã‚ˆã†ãªç›®æ¨™ã‚’1ã¤æ±ºã‚ã¦ãã ã•ã„ã€‚",inputs:[{type:"textarea",placeholder:"ä¾‹ï¼šä¸–ç•Œä¸­ã®ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã«æ„›ã•ã‚Œã‚‹é–‹ç™ºãƒ„ãƒ¼ãƒ«ã‚’ä½œã‚‹ï¼",key:"objective"}]},{title:"Key Results",description:"ç›®æ¨™é”æˆã‚’æ¸¬ã‚‹ãŸã‚ã®ã€3ã¤ã®å…·ä½“çš„ãªæ•°å­—ï¼ˆæŒ‡æ¨™ï¼‰ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚",inputs:[{type:"text",placeholder:"KR 1 (ä¾‹: GitHubã‚¹ã‚¿ãƒ¼æ•° 1,000åˆ°é”)",key:"kr_1"},{type:"text",placeholder:"KR 2 (ä¾‹: é€±é–“ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰æ•° 500å›ž)",key:"kr_2"},{type:"text",placeholder:"KR 3 (ä¾‹: ãƒ¦ãƒ¼ã‚¶ãƒ¼ç¶™ç¶šçŽ‡ 40%ç¶­æŒ)",key:"kr_3"}]}]}},Io={backward:{id:"backward",label:"Backward Design",description:"Design solid tasks by rewinding from your goal. Best for long-term projects.",steps:[{title:"Goal / KGI",description:"Define the date and state (KGI) of your final goal.",inputs:[{type:"textarea",placeholder:"e.g., Reach 10,000 monthly active users by March 31, 2025.",key:"goal_kgi"}]},{title:"Milestone",description:"What should be the state one month before the goal?",inputs:[{type:"textarea",placeholder:"e.g., Core features implemented and beta distributed to 100 users.",key:"milestone_minus_1mo"}]},{title:"First Action",description:"What is the very first action you should start right now?",inputs:[{type:"textarea",placeholder:"e.g., Analyze competitor reviews and create a feature list.",key:"first_action"}]}]},woop:{id:"woop",label:"WOOP",description:"Contrast wishes and obstacles to automate your execution plan. Effective for habits and tough goals.",steps:[{title:"Wish",description:"What do you want to achieve? (Challenging but achievable)",inputs:[{type:"textarea",placeholder:"e.g., Study English for 30 minutes every day.",key:"wish"}]},{title:"Outcome",description:`Imagine the "best benefit" or feeling when it's achieved.`,inputs:[{type:"textarea",placeholder:"e.g., Enjoy foreign dramas without subtitles and gain confidence.",key:"outcome"}]},{title:"Obstacle",description:'What is your "inner obstacle" (emotion, habit, belief) that gets in the way?',inputs:[{type:"textarea",placeholder:"e.g., Checking SNS on the phone when returning home tired from work.",key:"obstacle"}]},{title:"Plan",description:'Make a plan in the form of "IF (obstacle) happens, THEN (action)".',inputs:[{type:"textarea",placeholder:"e.g., IF I am about to sit on the sofa tired, THEN I will open the textbook immediately.",key:"plan"}]}]},okr:{id:"okr",label:"OKR",description:"Combine ambitious objectives (O) with measurable key results (KR). For organizations, teams, or high-growth individuals.",steps:[{title:"Objective",description:"Decide on one qualitative and exciting objective.",inputs:[{type:"textarea",placeholder:"e.g., Build a development tool loved by engineers worldwide!",key:"objective"}]},{title:"Key Results",description:"Set three specific metrics (indices) to measure goal achievement.",inputs:[{type:"text",placeholder:"KR 1 (e.g., Reach 1,000 GitHub stars)",key:"kr_1"},{type:"text",placeholder:"KR 2 (e.g., 500 downloads per week)",key:"kr_2"},{type:"text",placeholder:"KR 3 (e.g., Maintain 40% user retention rate)",key:"kr_3"}]}]}},Qe=(e="ja")=>e==="ja"?Do:Io,vr=k.forwardRef(({className:e,label:t,error:r,containerClassName:a,id:n,...o},i)=>s.jsxs("div",{className:T("flex flex-col gap-1.5 h-full",a),children:[t&&s.jsx("label",{htmlFor:n,className:"block text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider",children:t}),s.jsx("textarea",{ref:i,id:n,className:T("w-full bg-white dark:bg-gray-800 text-gray-900 dark:text-gray-100 border rounded-xl px-4 py-3 outline-none transition-all placeholder:text-gray-300 dark:placeholder:text-gray-600 resize-none","focus:ring-2 focus:ring-blue-500/20 focus:border-blue-500",r?"border-red-300 focus:border-red-500 focus:ring-red-500/20":"border-gray-200 dark:border-gray-700 hover:border-gray-300 dark:hover:border-gray-600",e),"aria-invalid":!!r,"aria-describedby":r&&n?`${n}-error`:void 0,...o}),r&&s.jsx("p",{id:n?`${n}-error`:void 0,className:"text-xs text-red-500 font-medium animate-fade-in-down",children:r})]}));vr.displayName="Textarea";const Eo=({mode:e,currentStep:t})=>{const{language:r}=W(),a=Qe(r)[e],n=a.steps.length;return s.jsx("div",{className:"flex items-center justify-between mb-8 max-w-2xl mx-auto",children:s.jsx("div",{className:"flex items-center space-x-1 mx-auto w-full justify-center",children:a.steps.map((o,i)=>{const l=i+1,c=t>l,d=t===l,h=t<l;return s.jsxs(S.Fragment,{children:[s.jsxs("div",{className:"flex flex-col items-center relative z-10 w-16",children:[s.jsx("div",{className:T("w-8 h-8 rounded-full flex items-center justify-center transition-all duration-300 font-bold",d&&"bg-blue-600 text-white ring-4 ring-blue-100 dark:ring-blue-900",c&&"bg-green-500 text-white",h&&"bg-gray-200 dark:bg-gray-700 text-gray-500"),children:c?"âœ“":l}),s.jsx("div",{className:T("text-[10px] mt-1 font-medium text-center w-20 truncate",d?"text-blue-600 dark:text-blue-400":"text-gray-400"),children:o.title})]}),i<n-1&&s.jsx("div",{className:T("h-1 flex-1 mx-[-10px] mt-[-14px] z-0 transition-all duration-500 rounded-full",t>l?"bg-green-500":"bg-gray-200 dark:bg-gray-700")})]},i)})})})},So=({mode:e,step:t,onBack:r,onNext:a,onFinish:n})=>{const{t:o}=M(),{language:i}=W(),l=Qe(i)[e],c=t-1,d=l.steps[c],h=l.steps.length,[u,p]=k.useState({}),y=(g,w)=>{p(C=>({...C,[g]:w}))},x=()=>{const g=(d.inputs??[]).reduce((w,C,m)=>{const f=u[m]||"";return C.key&&(w[C.key]=f),w},{});t<h?a(g):n(g)};return s.jsxs("div",{className:"max-w-4xl mx-auto py-8",children:[s.jsxs("h2",{className:"text-2xl font-bold mb-6 text-center text-gray-900 dark:text-white",children:[l.label," Mode"]}),s.jsxs("div",{className:"bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8 min-h-[500px] flex flex-col",children:[s.jsx(Eo,{mode:e,currentStep:t}),s.jsxs("div",{className:"flex-1 animate-fade-in",children:[s.jsxs("h3",{className:"text-xl font-bold mb-2 text-gray-800 dark:text-gray-100",children:["Q",t,". ",d.title]}),s.jsx("p",{className:"mb-6 text-gray-600 dark:text-gray-400",children:d.description}),s.jsx("div",{className:"mb-8 space-y-4",children:(d.inputs??[]).map((g,w)=>s.jsx("div",{children:g.type==="textarea"?s.jsx(vr,{name:g.key||`textarea-${w}`,id:g.key||`textarea-${w}`,className:"text-base",rows:5,placeholder:g.placeholder,value:u[w]||"",onChange:C=>y(w,C.target.value),"aria-label":g.placeholder}):s.jsx(Tt,{name:g.key||`input-${w}`,id:g.key||`input-${w}`,className:"text-base",placeholder:g.placeholder,value:u[w]||"",onChange:C=>y(w,C.target.value),"aria-label":g.placeholder})},g.key||w))})]}),s.jsxs("div",{className:"pt-6 border-t border-gray-100 dark:border-gray-700 flex justify-between items-center",children:[s.jsx(ce,{onClick:r,variant:"ghost",className:"text-gray-600 dark:text-gray-400 font-medium",children:o("wizard.back")}),t<h?s.jsx(ce,{onClick:x,variant:"primary",className:"bg-blue-600 hover:bg-blue-700 shadow-md",rightIcon:s.jsx(Ae,{className:"w-4 h-4 ml-2"}),children:o("wizard.next")}):s.jsx(ce,{onClick:x,variant:"primary",className:"bg-green-600 hover:bg-green-700 shadow-lg transform hover:scale-105",leftIcon:s.jsx(Pe,{className:"w-5 h-5 mr-2"}),children:o("wizard.finish")})]})]})]})},Mo=({currentMode:e,onModeChange:t,onStart:r})=>{const{t:a}=M(),{language:n}=W(),o=Qe(n),i=o[e],l=(a(`wizard.features.${e}`)||"").split(",");return s.jsxs("div",{className:"max-w-6xl mx-auto px-4 h-full max-h-[700px] flex flex-col py-6",children:[s.jsx("div",{className:"mb-4 flex-shrink-0",children:s.jsxs("div",{className:"flex items-center text-xs text-gray-500 dark:text-gray-400",children:[s.jsx(er,{className:"w-3 h-3 mr-1.5"}),s.jsx("span",{className:"font-medium",children:a("sidebar.target_wizard")}),s.jsx(Ae,{className:"w-3 h-3 mx-1.5"}),s.jsx("span",{className:"text-gray-700 dark:text-gray-300 font-semibold",children:a("wizard.select_method")})]})}),s.jsxs("div",{className:"mb-6 flex-shrink-0",children:[s.jsx("h2",{className:"text-xs font-bold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-3",children:a("wizard.select_framework")}),s.jsx("div",{className:"flex bg-gray-100 dark:bg-gray-800 p-1 rounded-xl",children:Object.keys(o).map(c=>s.jsx("button",{onClick:()=>t(c),className:T("flex-1 py-2 text-xs font-bold rounded-lg transition-all",e===c?"bg-white dark:bg-gray-700 text-blue-600 dark:text-blue-400 shadow-sm":"text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200"),children:o[c].label},c))})]}),s.jsx("div",{className:"flex-1 mb-6 min-h-0",children:s.jsx("div",{className:"h-full bg-gradient-to-br from-gray-50 to-gray-100 dark:from-gray-800 dark:to-gray-900 rounded-2xl border-2 border-gray-200 dark:border-gray-700 overflow-hidden shadow-xl",children:s.jsxs("div",{className:"h-full flex flex-col items-center justify-center p-8 text-center animate-fade-in",children:[s.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center mb-4 shadow-lg flex-shrink-0",children:s.jsx(Pe,{className:"w-8 h-8 text-white"})}),s.jsx("h3",{className:"font-bold text-gray-900 dark:text-white mb-3 text-xl",children:i.label}),s.jsx("p",{className:"text-sm text-gray-600 dark:text-gray-400 max-w-2xl leading-relaxed",children:i.description}),s.jsx("div",{className:"mt-6 flex flex-wrap gap-2 justify-center",children:l.map(c=>s.jsx("span",{className:"px-3 py-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-full text-xs font-medium text-gray-700 dark:text-gray-300 shadow-sm",children:c.trim()},c))})]})})}),s.jsx("div",{className:"flex justify-center pb-4 flex-shrink-0",children:s.jsx(ce,{variant:"premium",size:"lg",onClick:r,className:"shadow-xl",rightIcon:s.jsx(Ae,{className:"w-4 h-4"}),children:a("wizard.start_mode")})})]})},Ao=()=>{const[e,t]=k.useState("backward"),[r,a]=k.useState(0),[n,o]=k.useState({}),{setView:i,viewData:l}=te(),{workspaceId:c}=oe(),{t:d}=M(),{language:h}=W(),u=Qe(h);k.useEffect(()=>{l!=null&&l.mode&&(t(l.mode),a(0))},[l]);const p=g=>{o(w=>({...w,...g})),a(w=>w+1)},y=async g=>{const w={...n,...g};if(!c){j.error(d("wizard.alert_no_workspace"));return}try{await mn(c,{mode:e,data:w}),console.log("Wizard Completed, Saved to Firestore",w),j.success(d("wizard.alert_create_success",{label:u[e].label})),a(0),o({}),i("target-dashboard")}catch(C){console.error("Failed to save wizard target:",C),j.error(d("wizard.alert_save_fail"))}},x=()=>{a(g=>Math.max(0,g-1))};return r===0?s.jsx(Mo,{currentMode:e,onModeChange:t,onStart:()=>a(1)}):s.jsx(So,{mode:e,step:r,onBack:x,onNext:p,onFinish:y})},Lo=(e,t)=>{const r=Ot($e(Bt,{activationConstraint:{distance:5}}),$e(Rr,{activationConstraint:{delay:N.DND.TOUCH_DELAY,tolerance:5}})),{t:a}=M(),n=k.useRef(e),o=k.useCallback(()=>{n.current=e},[e]),i=k.useCallback(async l=>{var y,x,g,w,C;const{active:c,over:d}=l;if(!d)return;const h=String(c.id),u=String(d.id);let p=null;if(c.data.current&&c.data.current.type==="task"&&(p=((y=c.data.current.task)==null?void 0:y.id)||h.replace(N.DND.PREFIX_TASK,"")),p){const m=d.data.current,f=m==null?void 0:m.type,E=m==null?void 0:m.value;if(f&&Ro(f)){const R={};if(f===N.DND.TYPE_PROJECT)R.projectId=E;else if(f===N.DND.TYPE_INBOX)R.projectId=null;else if(f===N.DND.TYPE_TIMEBLOCK)R.timeBlockId=E==="unassigned"?null:E;else if(f===N.DND.TYPE_LABEL){const F=(x=c.data.current)==null?void 0:x.task,B=(F==null?void 0:F.labelIds)??[];E&&(B.includes(E)?R.labelIds=B.filter(O=>O!==E):R.labelIds=[...B,E])}if(Object.keys(R).length>0){try{await lt(p,R)}catch(F){console.error("Failed to update task via dnd",F),j.error(a("msg.dnd.reorderFailed")||a("error"))}return}}if(h!==u&&u.startsWith(N.DND.PREFIX_TASK)){const R=u.replace(N.DND.PREFIX_TASK,"");(g=t==null?void 0:t.onTasksReorder)==null||g.call(t,p,R);return}}if(h!==u&&h.startsWith(N.DND.PREFIX_PROJECT)&&u.startsWith(N.DND.PREFIX_PROJECT)){const m=n.current,f=h.replace(N.DND.PREFIX_PROJECT,""),E=u.replace(N.DND.PREFIX_PROJECT,""),R=m.findIndex(B=>B.id===f),F=m.findIndex(B=>B.id===E);if(R!==-1&&F!==-1){const B=pt(m,R,F);(w=t==null?void 0:t.onOptimisticReorder)==null||w.call(t,B);try{await sn(B)}catch(O){console.error("Failed to update project order",O),j.error(a("msg.dnd.reorderFailed")||a("error")),(C=t==null?void 0:t.onRevertReorder)==null||C.call(t,m)}}}},[e,t,a]);return{sensors:r,handleDragEnd:i,handleDragStart:o}};function Ro(e){return[N.DND.TYPE_PROJECT,N.DND.TYPE_INBOX,N.DND.TYPE_TIMEBLOCK,N.DND.TYPE_LABEL].includes(e)}const Fo=()=>{const{workspaceId:e,userId:t,loading:r}=oe(),a=k.useCallback(c=>!e||!t?()=>{}:Ba(e,c),[e,t]),n=e?Oa(e):!1,{data:o,isPending:i}=ve(["labels",t||void 0,e||void 0],a,e&&n?Pa(e):void 0);return{labels:o||[],loading:r||!!e&&i}},Po=()=>{const{fontEn:e,fontJp:t,fontSize:r,density:a,themeMode:n}=W(),{setSidebarDensity:o}=bt();k.useEffect(()=>{const i=document.documentElement,l=document.body;n==="dark"?i.classList.add("dark"):n==="light"?i.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches?i.classList.add("dark"):i.classList.remove("dark"),i.style.setProperty("--font-en",e),i.style.setProperty("--font-jp",t);const c=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];l.classList.remove(...c),l.classList.add(`font-app-${r}`);const d=["app-density-compact","app-density-normal","app-density-comfortable","app-density-spacious"];l.classList.remove(...d),l.classList.add(`app-density-${a}`),o(a);const h=window.matchMedia("(prefers-color-scheme: dark)"),u=()=>{n==="system"&&(h.matches?i.classList.add("dark"):i.classList.remove("dark"))};return h.addEventListener("change",u),()=>h.removeEventListener("change",u)},[n,e,t,r,a,o])};function Ft(e){const t=String(e);return t.startsWith("project:")||t==="inbox"||t.startsWith("timeblock:")||t.startsWith("duration:")||t.startsWith("label:")}const Oo=e=>{const r=Fr(e).filter(n=>Ft(n.id));if(r.length>0)return r;const a=e.droppableContainers.filter(n=>Ft(n.id));if(a.length>0){const n={...e,droppableContainers:a},o=Pr(n);if(o.length>0)return o}return $t(e)},Bo=()=>{Po();const{filterType:e,targetId:t,query:r}=ee(),{currentView:a,setView:n}=te(),{setFilter:o}=ee(),{projects:i,setProjectsOverride:l}=Ct(),{labels:c}=Fo(),[d,h]=S.useState({user:D.currentUser,loading:!D.currentUser}),u=k.useCallback(C=>{const m=C.target,f=["INPUT","TEXTAREA"].includes(m.tagName)||m.closest("[contenteditable]"),E=document.querySelector('[role="dialog"]');C.key==="/"&&!f&&!E&&(C.preventDefault(),o("search"),n("search"))},[o,n]);S.useEffect(()=>{const C=Vt(D,m=>{h({user:m,loading:!1})});return document.addEventListener("keydown",u),()=>{C(),document.removeEventListener("keydown",u)}},[u]);const{onTasksReorder:p}=yr(),{sensors:y,handleDragEnd:x,handleDragStart:g}=Lo(i,{onOptimisticReorder:l,onRevertReorder:l,onTasksReorder:p||void 0}),w=k.useMemo(()=>{var C,m;if(a==="wizard")return"Goal Wizard";if(a==="target-dashboard")return"Target Dashboard";if(a==="wiki")return"Framework Wiki";if(a==="search")return r?`"${r}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";if(e==="project")return((C=i.find(f=>f.id===t))==null?void 0:C.name)||"Project";if(e==="label")return((m=c.find(f=>f.id===t))==null?void 0:m.name)||"Label";if(e==="search")return r?`"${r}" ã®æ¤œç´¢çµæžœ`:"æ¤œç´¢";switch(e){case"inbox":return"Inbox";case"today":return"Today";case"upcoming":return"Upcoming";case"important":return"Important";case"custom":return"All Tasks";default:return"TaskMg"}},[a,r,e,t,i,c]);return d.loading?s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900",children:s.jsxs("div",{className:"flex flex-col items-center gap-4",children:[s.jsx("div",{className:"w-10 h-10 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),s.jsx("p",{className:"text-gray-500 dark:text-gray-400 text-sm",children:"èª­ã¿è¾¼ã¿ä¸­..."})]})}):d.user?s.jsxs(Wt,{sensors:y,collisionDetection:Oo,onDragEnd:x,onDragStart:g,children:[s.jsx(cs,{}),s.jsx(na,{}),s.jsx(Xs,{sidebarContent:s.jsx(go,{}),title:w,children:a==="wizard"?s.jsx(Ao,{}):a==="target-dashboard"?s.jsx(jo,{}):a==="wiki"?s.jsx(To,{}):a==="search"?s.jsx(fo,{}):a==="dashboard"?s.jsx(po,{}):s.jsx(jr,{})})]}):s.jsx(os,{})};class Wo extends k.Component{constructor(r){super(r);A(this,"handleRetry",()=>{this.setState({hasError:!1,error:null})});this.state={hasError:!1,error:null}}static getDerivedStateFromError(r){return{hasError:!0,error:r}}componentDidCatch(r,a){qs(r,a.componentStack??void 0)}render(){if(this.state.hasError){if(this.props.fallback)return this.props.fallback;const r=W.getState().language,{t:a}=me(r);return s.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50 dark:bg-gray-900 p-4",children:s.jsxs("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-xl shadow-lg p-8 text-center",children:[s.jsx("div",{className:"w-16 h-16 mx-auto mb-4 rounded-full bg-red-100 dark:bg-red-900/30 flex items-center justify-center",children:s.jsx("svg",{className:"w-8 h-8 text-red-500",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:s.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"})})}),s.jsx("h2",{className:"text-xl font-bold text-gray-800 dark:text-gray-100 mb-2",children:a("error_boundary.title")}),s.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 mb-6",children:a("error_boundary.description")}),s.jsxs("div",{className:"flex gap-3 justify-center",children:[s.jsx("button",{onClick:this.handleRetry,className:"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",children:a("error_boundary.retry")}),s.jsx("button",{onClick:()=>window.location.reload(),className:"px-4 py-2 bg-gray-200 dark:bg-gray-700 text-gray-700 dark:text-gray-300 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:a("error_boundary.reload")})]}),!1]})})}return this.props.children}}const $o=new ts({defaultOptions:{queries:{staleTime:1/0,refetchOnWindowFocus:!1,retry:!1}}});ae(()=>Promise.resolve().then(()=>qo),void 0);zs();Gr();const Nr=document.getElementById("app");if(!Nr)throw new Error("Failed to find the root element");const zo=s.jsx(Wo,{children:s.jsx(Mr,{client:$o,children:s.jsx(Bo,{})})});Sr.createRoot(Nr).render(zo);const qo=Object.freeze(Object.defineProperty({__proto__:null},Symbol.toStringTag,{value:"Module"}));export{Yt as $,Je as A,ce as B,ds as C,Ni as D,fi as E,pi as F,fr as G,$ as H,Tt as I,hi as J,ji as K,lt as L,_n as M,yt as N,ms as O,ei as P,ti as Q,ri as R,si as S,ai as T,N as U,ni as V,vr as W,di as X,ui as Y,kr as Z,so as _,ne as a,Yo as a0,$n as a1,vi as a2,D as a3,_ as a4,v as a5,Pe as a6,Ue as a7,cr as a8,Zo as a9,Qo as aa,j as ab,We as ac,gi as ad,mi as ae,oe as b,bi as c,xi as d,yi as e,T as f,Ke as g,He as h,wi as i,ki as j,rn as k,Jo as l,Ps as m,ii as n,li as o,oi as p,ci as q,_o as r,Bs as s,te as t,M as u,ps as v,Ae as w,er as x,Qt as y,Ct as z};
