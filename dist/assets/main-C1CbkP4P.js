var Fd=Object.defineProperty;var $d=(e,t,n)=>t in e?Fd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var D=(e,t,n)=>$d(e,typeof t!="symbol"?t+"":t,n);import{getAuth as Hd,signInAnonymously as zd,signInWithEmailAndPassword as jd,updatePassword as Wd,signOut as Vd,onAuthStateChanged as Ud}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as Yd,updateDoc as wi,doc as Ft,addDoc as Xe,collection as pt,serverTimestamp as en,deleteDoc as ki,query as nn,orderBy as ir,onSnapshot as Sn,getDocs as Kn,limit as qd,Timestamp as sr,getDoc as Gd,setDoc as Xd}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as Kd}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const $r={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let Zi,W,K,ms=!1;function Jd(){if(ms)return;const e=Zd();if(e!=null&&e.apiKey)try{Zi=Kd(e),W=Hd(Zi),K=Yd(Zi),ms=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function Zd(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&$r){const e=$r,t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function Vl(){if(!ms)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:Zi,auth:W,db:K}}function Qd(e,t,n){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${n?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${e.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${e.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function tu(e){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",t="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const n=e.type==="confirm";!n&&e.okText==="OK"&&(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",Qd(e,t,n));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),o=document.getElementById("msg-modal-body"),r=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=e.title,o.textContent=e.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!n&&l()};document.addEventListener("keydown",c),r.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!n&&l()},r.focus()}function R(e,t=null){let n={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof e=="object"&&e!==null?n={...n,...e}:(n.message=String(e),typeof t=="function"?(n.type="confirm",n.onConfirm=t):typeof t=="string"&&(n.type=t)),tu(n)}async function eu(e,t){if(!ms)throw new Error("Firebaseが初期化されていないぞ。");try{return await jd(W,e,t)}catch(n){let i="ログインに失敗した。";switch(n.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function nu(e){const t=W.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await Wd(t,e),R({message:"パスワードを変更したぞ",type:"success"})}catch(n){let i="変更に失敗した: "+n.message;throw n.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),R({message:i,type:"error"}),n}}function Ul(){const e=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),n=document.getElementById("password-input"),i=document.getElementById("guest-login-btn");if(e&&t&&n){const s=async()=>{const o=t.value.trim(),r=n.value.trim();if(!o||!r)return R({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await eu(o,r)}catch(a){R({message:a.message,type:"error"})}};e.onclick=s,n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&s()})}i&&(i.onclick=async()=>{try{await zd(W),R({message:"ゲストとしてログインしたぞ。データは一時的に保持される。",type:"success"})}catch(s){console.error(s),R({message:"ゲストログインに失敗した: "+s.message,type:"error"})}})}function iu(e){const t=document.getElementById("login-form-container")||document.getElementById("login-container-wrapper"),n=document.getElementById("user-info"),i=document.getElementById("user-email-display"),s=document.getElementById("email-input"),o=document.getElementById("password-input");e?(e.uid,t&&t.classList.add("hidden"),n&&(n.classList.remove("hidden"),n.classList.add("flex")),i&&(i.textContent=e.isAnonymous?"ゲストユーザー":e.email||"ユーザー")):(t&&t.classList.remove("hidden"),n&&(n.classList.add("hidden"),n.classList.remove("flex")),s&&(s.value=""),o&&(o.value=""),i&&(i.textContent=""))}const su={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},B={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DENSITY_LEVELS:{COMPACT:"compact",NORMAL:"normal",COMFORTABLE:"comfortable",SPACIOUS:"spacious"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},CLASSES:{CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},COLORS:{DEFAULT:"#CBD5E0"},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order"},LIST_IDS:{PROJECTS:"project-list",LABELS:"label-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list",TARGETS:"target-tool-list",BASIC:"basic-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function Yl(e,t){if(!t||!e)return;let n=!1,i=null,s=null;const o=()=>{i!==null&&e&&(e.style.width=`${i}px`),s=null},r=l=>{if(!n)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=B;i=Math.max(c,Math.min(d,l.clientX)),s||(s=requestAnimationFrame(o))},a=()=>{n&&(n=!1,document.body.classList.remove("cursor-col-resize","select-none"),e.style.transition="",s&&cancelAnimationFrame(s),s=null,o(),localStorage.setItem(B.STORAGE_KEYS.WIDTH,e.offsetWidth),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a))};t.addEventListener("mousedown",l=>{or()&&(n=!0,document.body.classList.add("cursor-col-resize","select-none"),e.style.transition="none",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))})}function or(){return window.innerWidth>=768}function rr(e,t=!1){const n=localStorage.getItem(e);return n===null?t:n==="true"||n==="compact"}function En(){const e=localStorage.getItem(B.STORAGE_KEYS.DENSITY);return e&&Object.values(B.DENSITY_LEVELS).includes(e)?e:rr(B.STORAGE_KEYS.COMPACT,!1)?B.DENSITY_LEVELS.COMPACT:B.DENSITY_LEVELS.NORMAL}function ou(){return En()===B.DENSITY_LEVELS.COMPACT}function bs(e,t){return Array.isArray(e)?e.filter(n=>n.status!=="completed"&&t(n)).length:0}function ru(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function hn(e){return`artifacts/${ru()}/users/${e}`}function Hr(e,t){return`${hn(e)}/workspaces/${t}`}const G={users:e=>hn(e),filters:e=>`${hn(e)}/filters`,labels:e=>`${hn(e)}/labels`,workspaces:e=>`${hn(e)}/workspaces`,timeblocks:e=>`${hn(e)}/timeblocks`,tasks:(e,t)=>`${Hr(e,t)}/tasks`,projects:(e,t)=>`${Hr(e,t)}/projects`},gt=Object.freeze({WORKSPACE_CHANGED:"workspace-changed",ROUTE_CHANGE:"route-change",TASKS_UPDATED:"tasks-updated",PROJECTS_UPDATED:"projects-updated",LABELS_UPDATED:"labels-updated",TIMEBLOCKS_UPDATED:"timeblocks-updated",FILTERS_UPDATED:"filters-updated",SIDEBAR_SETTINGS_UPDATED:"sidebar-settings-updated",UI_SETTINGS_CHANGED:"ui-settings-changed",UI_UPDATED:"ui-updated",THEME_CHANGED:"theme-changed"}),ys="currentWorkspaceId",au=gt.WORKSPACE_CHANGED;let Ii=null,ar=[];function Lo(){return ar}function lu(e,t){const n=typeof t=="function"?t:()=>{};if(!e)return n([]),()=>{};Ii&&Ii();const i=G.workspaces(e),s=nn(pt(K,i),ir("createdAt","asc"));return Ii=Sn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));if(ar=r,r.length===0&&!o.metadata.hasPendingWrites)n([]),cu().catch(a=>console.error("[Workspace] Default creation error:",a));else{const a=du(r);n(r),ql(a,r)}},o=>{console.error("[Workspace] Subscription error:",o),n([])}),Ii}async function cu(){try{const e=W.currentUser;if(!e)return;const t=G.workspaces(e.uid);(await Kn(nn(pt(K,t),qd(1)))).empty&&await Gl("メイン")}catch(e){console.error("[Workspace] Failed to ensure default workspace:",e)}}function du(e){if(e.length===0)return null;let t=Zt();const n=e.some(i=>i.id===t);return(!t||!n)&&(t=e[0].id,localStorage.setItem(ys,t)),t}function Zt(){return localStorage.getItem(ys)}function lr(e){!e||localStorage.getItem(ys)===e||(localStorage.setItem(ys,e),ql(e,ar))}function ql(e,t){const n=new CustomEvent(au,{detail:{workspaceId:e,workspaces:t}});document.dispatchEvent(n)}async function Gl(e){try{const t=W.currentUser;if(!t)throw new Error("Authentication required");const n=G.workspaces(t.uid);return{id:(await Xe(pt(K,n),{name:e,createdAt:en()})).id,name:e}}catch(t){throw console.error("[Workspace] Add error:",t),R("ワークスペースの作成に失敗した。"),t}}async function uu(e,t){try{const n=W.currentUser;if(!n)throw new Error("Authentication required");const i=G.workspaces(n.uid);await wi(Ft(K,i,e),{name:t})}catch(n){console.error("[Workspace] Update error:",n),R("名前の更新に失敗した。")}}async function hu(e){try{const t=W.currentUser;if(!t)throw new Error("Authentication required");const n=G.workspaces(t.uid);await ki(Ft(K,n,e))}catch(t){console.error("[Workspace] Delete error:",t),R("削除に失敗した。")}}const q={BUTTON:{PRIMARY:"bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-1.5 px-4 rounded-lg transition-all active:scale-95 shadow-sm",DANGER:"bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm",SECONDARY:"text-sm font-medium text-gray-500 hover:text-gray-800 transition",CANCEL:"text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition"},INPUT:{DEFAULT:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition",MINIMAL_TEXT:"w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100",MINIMAL_TEXTAREA:"w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"},SELECT:{TRANSPARENT:"bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer"},TEXT:{LABEL:"block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider"},PROGRESS_BAR:{CONTAINER:"flex-1 relative h-3 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[100px]",FILLED:"h-full bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full transition-all duration-500 ease-out shadow-sm",OVER:"h-full bg-red-500 rounded-full transition-all duration-500 ease-out shadow-sm"},STATS_BAR:{CONTAINER:"mt-2 mb-2 py-2 px-4 bg-gray-50/80 dark:bg-[#1e1e1e]/50 rounded-lg flex items-center justify-evenly text-sm border border-gray-100 dark:border-gray-800/50 backdrop-blur-sm",ITEM:"flex flex-row items-baseline gap-2",LABEL:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",VALUE:"font-bold text-sm text-gray-700 dark:text-gray-200",HIGHLIGHT:"text-blue-600 dark:text-blue-400"},MODAL:{CONTAINER:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",DIALOG:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden",WIDTH:{DEFAULT:"max-w-5xl w-full"}},CARD:{GLASS:"bg-white/70 dark:bg-gray-900/70 backdrop-blur-md border border-gray-200/50 dark:border-gray-700/50 rounded-xl shadow-lg"}};function Ln(e,t,n,i,s=!1){return`
        <div class="settings-accordion border-b border-gray-100 dark:border-gray-700 last:border-0" data-section="${e}">
            <button class="accordion-header w-full flex items-center justify-between py-4 px-2 focus:outline-none group hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-lg transition-colors">
                <div class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest group-hover:text-blue-500 transition-colors">
                    ${n}
                    ${t}
                </div>
                <svg class="accordion-icon w-5 h-5 text-gray-400 transform transition-transform duration-300 ${s?"rotate-180":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div class="accordion-content overflow-hidden transition-all duration-300 ease-in-out ${s?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"}" style="${s?"":"max-height: 0px;"}">
                <div class="pt-2 pb-6 px-2">
                    ${i}
                </div>
            </div>
        </div>
    `}function Pt(e,t,n,i,s=""){return`
        <label class="flex items-center justify-center gap-2 cursor-pointer p-3 border ${i?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300"} rounded-lg transition-all duration-200">
            <input type="radio" name="${e}" value="${t}" class="hidden" ${i?"checked":""}>
            ${s}
            <span class="text-sm font-medium">${n}</span>
        </label>
    `}function zr(e,t,n,i){const s=t.map(o=>`<option value="${o.value}" ${o.value===n?"selected":""}>${o.label}</option>`).join("");return`
        <div>
            <label for="${i}" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">${e}</label>
            <div class="relative">
                <select id="${i}" name="${i}" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                    ${s}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>
    `}const $n={NONE:"none",TEXTURE:"haikei"},fu=[{value:"Asia/Tokyo",label:"日本 (JST/UTC+9)"},{value:"America/Los_Angeles",label:"アメリカ・太平洋 (PST/UTC-8)"},{value:"America/New_York",label:"アメリカ・東部 (EST/UTC-5)"},{value:"Asia/Shanghai",label:"中国・台湾 (CST/UTC+8)"},{value:"Europe/London",label:"イギリス (GMT/UTC+0)"}];function gu(e,t,n,i){const s=n||(i?"compact":"normal");return`
        <div class="space-y-6">
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">テーマ</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Pt("app-theme","light","ライト",e==="light",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                    ${Pt("app-theme","dark","ダーク",e==="dark",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
                </div>
            </div>
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークモード)</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Pt("bg-pattern",$n.NONE,"無地",t===$n.NONE)}
                    ${Pt("bg-pattern",$n.TEXTURE,"テクスチャ",t===$n.TEXTURE)}
                </div>
            </div>
            <div>
                 <label for="timezone-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タイムゾーン</label>
                 <div class="relative">
                     ${(()=>{const o=localStorage.getItem("timezone")||"Asia/Tokyo";return`
                        <select id="timezone-select" name="timezone-select" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                            ${fu.map(r=>`<option value="${r.value}" ${r.value===o?"selected":""}>${r.label}</option>`).join("")}
                        </select>
                        `})()}
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
            </div>
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">サイドバーとUI密度</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Pt("sidebar-density","compact","Compact",s==="compact")}
                    ${Pt("sidebar-density","normal","Standard",s==="normal")}
                    ${Pt("sidebar-density","comfortable","Comfortable",s==="comfortable")}
                    ${Pt("sidebar-density","spacious","Spacious",s==="spacious")}
                </div>
            </div>
            <div>
                 <label for="visible-task-count" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タスク一覧の表示数</label>
                 <div class="relative">
                     ${(()=>{const o=localStorage.getItem("visible_task_count")||"10";return`
                     <select id="visible-task-count" name="visible-task-count" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                        ${[7,8,9,10,11,12].map(r=>`<option value="${r}" ${String(r)===o?"selected":""}>${r}件</option>`).join("")}
                     </select>
                        `})()}
                     <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                     </div>
                 </div>
            </div>
        </div>
    `}const jr={EN:[{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Segoe UI",label:"Segoe UI"},{value:'-apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif',label:"San Francisco"},{value:'"Google Sans", "Open Sans"',label:"Google Sans"}],JP:[{value:'"Hiragino Kaku Gothic ProN", "Hiragino Sans"',label:"ヒラギノ角ゴ"},{value:'"Noto Sans JP"',label:"Noto Sans JP"},{value:'"LINE Seed JP"',label:"LINE Seed JP"},{value:'"M PLUS 2"',label:"M PLUS 2"},{value:'"BIZ UDPGothic"',label:"BIZ UDPゴシック"}]},xs={FONT_EN:"font_family_en",FONT_JP:"font_family_jp"},vs={EN:"Inter",JP:"M PLUS 2"};function pu(){const e=localStorage.getItem(xs.FONT_EN)||vs.EN,t=localStorage.getItem(xs.FONT_JP)||vs.JP,n=document.documentElement;n.style.setProperty("--font-en",`"${e}"`),n.style.setProperty("--font-jp",`"${t}"`)}function mu(){return{en:localStorage.getItem(xs.FONT_EN)||vs.EN,jp:localStorage.getItem(xs.FONT_JP)||vs.JP}}function bu(){const e=localStorage.getItem("fontSize")||"md",t=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e}`)}const Ht={SMALL:"sm",BASE:"base",MEDIUM:"md",LARGE:"lg",XL:"xl"};function yu(){const e=mu();return`
        <div class="space-y-4">
            ${zr("英数字フォント",jr.EN,e.en,"font-en-select")}
            ${zr("日本語フォント",jr.JP,e.jp,"font-jp-select")}
        </div>
    `}function xu(e){return`
        <div class="grid grid-cols-5 gap-2">
            ${Pt("font-size",Ht.SMALL,"Small",e===Ht.SMALL)}
            ${Pt("font-size",Ht.BASE,"Base",e===Ht.BASE)}
            ${Pt("font-size",Ht.MEDIUM,"Medium",e===Ht.MEDIUM)}
            ${Pt("font-size",Ht.LARGE,"Large",e===Ht.LARGE)}
            ${Pt("font-size",Ht.XL,"XL",e===Ht.XL)}
        </div>
    `}function vu(){return`
        <div class="space-y-3">
            <button id="export-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">バックアップを作成</span>
                    <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">現在の全データをJSON形式でダウンロード</div>
            </button>
            
            <button id="import-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                 <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">データを復元</span>
                     <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">バックアップファイルからデータを読み込み</div>
            </button>
            <input type="file" id="import-file-input" accept=".json" class="hidden" />
        </div>
    `}function wu(e,t){return`
         <div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-100 dark:border-gray-700">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                ${e||"?"}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-500 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新しいパスワード" class="flex-1 px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                <button id="update-password-btn-new" class="px-4 py-2 bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-bold rounded-lg transition-colors whitespace-nowrap">変更</button>
            </div>
            <button id="logout-btn-settings" class="w-full py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-medium rounded-lg transition-colors text-left flex items-center gap-2 px-2">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `}function ku(e,t,n){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||Ht.MEDIUM,o=localStorage.getItem("background")||$n.NONE,r=localStorage.getItem("sidebar_density"),a=gu(i,o,r,n),l=yu(),c=xu(s),d=vu(),u=wu(e,t);return`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl ${q.MODAL.WIDTH.DEFAULT} overflow-hidden flex flex-col max-h-[90vh] h-full sm:h-auto animate-fade-in-up">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10 sticky top-0">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">Settings</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="overflow-y-auto custom-scrollbar flex-1 bg-white dark:bg-gray-800">
                <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- Left Column -->
                    <div class="space-y-0">
                        ${Ln("appearance","Appearance",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>',a,!0)}
                        ${Ln("data","Data Management",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>',d)}
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-0">
                        ${Ln("typography","Typography",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>',l)}
                        ${Ln("fontsize","Font Size",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',c)}
                        ${Ln("account","Account",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',u)}
                    </div>
                </div>
            </div>
        </div>
    `}const ve={FONT_EN:"font_family_en",FONT_JP:"font_family_jp",FONT_SIZE:"fontSize",DENSITY:B.STORAGE_KEYS.DENSITY},Ai={FONT_EN:"Inter",FONT_JP:"M PLUS 2",FONT_SIZE:"md",DENSITY:"normal"};function _i(){return{fontEn:localStorage.getItem(ve.FONT_EN)||Ai.FONT_EN,fontJp:localStorage.getItem(ve.FONT_JP)||Ai.FONT_JP,fontSize:localStorage.getItem(ve.FONT_SIZE)||Ai.FONT_SIZE,density:localStorage.getItem(ve.DENSITY)||Ai.DENSITY}}function Xl(){const e=_i(),t=document.documentElement;t.style.setProperty("--font-en",`"${e.fontEn}"`),t.style.setProperty("--font-jp",`"${e.fontJp}"`)}function Kl(){const e=_i(),t=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e.fontSize}`)}function Jl(){const e=_i(),n=["compact","normal","comfortable","spacious"].map(i=>`app-density-${i}`);document.body.classList.remove(...n),document.body.classList.add(`app-density-${e.density}`)}function _u(){Xl(),Kl(),Jl()}function Su(e){e&&_i()}function cr(){window.dispatchEvent(new CustomEvent(gt.UI_SETTINGS_CHANGED,{detail:_i()}))}function Wr(e,t){const n=e==="EN"?ve.FONT_EN:ve.FONT_JP;localStorage.setItem(n,t),Xl(),cr()}function Eu(e){localStorage.setItem(ve.FONT_SIZE,e),Kl(),cr()}function Du(e){localStorage.setItem(ve.DENSITY,e),e==="compact"?localStorage.setItem(B.STORAGE_KEYS.COMPACT,"true"):localStorage.setItem(B.STORAGE_KEYS.COMPACT,"false"),Jl(),cr(),window.dispatchEvent(new CustomEvent(gt.SIDEBAR_SETTINGS_UPDATED,{detail:{density:e}}))}function ws(e,t,n){const i=document.querySelectorAll(`input[name="${e}"]`),s=localStorage.getItem(t),o=["border-blue-500","bg-blue-50","dark:bg-blue-900/20","text-blue-700","dark:text-blue-300"],r=["border-gray-200","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-700/50","text-gray-600","dark:text-gray-300"],a=l=>{i.forEach(c=>{const d=c.parentElement;c===l?(d.classList.remove(...r),d.classList.add(...o)):(d.classList.remove(...o),d.classList.add(...r))})};if(i.forEach(l=>{l.addEventListener("change",c=>{const d=c.target.value;localStorage.setItem(t,d),a(c.target),n(d)})}),s)i.forEach(l=>{l.value===s&&(l.checked=!0)});else{const l=Array.from(i).find(c=>c.checked);l&&localStorage.setItem(t,l.value)}}function Tu(){document.querySelectorAll(".accordion-header").forEach(t=>{t.addEventListener("click",()=>{const n=t.parentElement,i=n.querySelector(".accordion-content"),s=t.querySelector(".accordion-icon"),o=i.style.maxHeight!=="0px"&&i.style.maxHeight!=="";document.querySelectorAll(".settings-accordion").forEach(r=>{if(r!==n){const a=r.querySelector(".accordion-content"),l=r.querySelector(".accordion-icon");a.style.maxHeight="0px",a.classList.remove("opacity-100"),a.classList.add("opacity-0"),l.classList.remove("rotate-180")}}),o?(i.style.maxHeight="0px",i.classList.remove("opacity-100"),i.classList.add("opacity-0"),s.classList.remove("rotate-180")):(i.style.maxHeight=i.scrollHeight+"px",i.classList.remove("opacity-0"),i.classList.add("opacity-100"),s.classList.add("rotate-180"))})}),document.querySelectorAll(".settings-accordion").forEach(t=>{const n=t.querySelector(".accordion-content");n.classList.contains("opacity-100")&&(n.style.maxHeight=n.scrollHeight+"px")})}function Mu(){ws("sidebar-density","sidebar_density",e=>{Du(e)})}function Iu(){ws("font-size","fontSize",n=>{Eu(n)});const e=document.querySelector('select[name="font-en-select"]'),t=document.querySelector('select[name="font-jp-select"]');e&&e.addEventListener("change",n=>{Wr("EN",n.target.value)}),t&&t.addEventListener("change",n=>{Wr("JP",n.target.value)})}function Au(){const e=document.querySelector('select[name="visible-task-count"]');e&&e.addEventListener("change",t=>{localStorage.setItem("visible_task_count",t.target.value),window.dispatchEvent(new CustomEvent("visible-task-count-updated",{detail:{count:Number(t.target.value)}}))})}function Lu(){const e=document.querySelector('select[name="timezone-select"]');e&&e.addEventListener("change",t=>{localStorage.setItem("timezone",t.target.value),window.dispatchEvent(new CustomEvent("timezone-changed",{detail:{timezone:t.target.value}}))})}function Cu(){const e=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",e);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),ks()}function ks(){const e=document.getElementById("main-content");if(!e)return;const t=localStorage.getItem("background")||"none";e.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(e.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}function Ou(){ws("app-theme","theme",e=>{document.documentElement.classList.toggle("dark",e==="dark"),ks()}),ws("bg-pattern","background",()=>ks())}const Zs=e=>e instanceof sr?e.toDate():e,dr=e=>e instanceof Date?sr.fromDate(e):e;function Zl(e,t){return{id:e,...t,createdAt:Zs(t.createdAt)||null,dueDate:Zs(t.dueDate)||null,recurrence:t.recurrence??null,completedAt:Zs(t.completedAt)||null}}let Co=[];function Dn(){return Co}function Pu(e,t,n){const i=r=>{typeof n=="function"&&n(r)};if(!e||!t)return i([]),()=>{};const s=G.tasks(e,t),o=nn(pt(K,s));return Sn(o,r=>{const a=r.docs.map(l=>Zl(l.id,l.data()));Co=a,i(a)},r=>{console.error("[Tasks] Subscription error:",r),Co=[],i([])})}async function Ru(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");const n=pt(K,G.tasks(e,t)),i=pt(K,G.projects(e,t)),s=pt(K,G.labels(e)),[o,r,a]=await Promise.all([Kn(n),Kn(i),Kn(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof sr?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:l(o),projects:l(r),labels:l(a)}}async function Ql(e,t,n){const i=G.tasks(e,t),s={...n};return s.dueDate&&(s.dueDate=dr(s.dueDate)),await Xe(pt(K,i),{...s,ownerId:e,status:"todo",createdAt:en()})}async function Bu(e,t,n,i){const s=G.tasks(e,t),o={status:i};i==="completed"?o.completedAt=en():o.completedAt=null,await wi(Ft(K,s,n),o)}async function Nu(e,t,n,i){const s=G.tasks(e,t),o={...i};o.dueDate!==void 0&&(o.dueDate=dr(o.dueDate)),await wi(Ft(K,s,n),o)}async function Fu(e,t,n){const i=G.tasks(e,t);await ki(Ft(K,i,n))}async function $u(e,t,n){const i=G.tasks(e,t),s=await Gd(Ft(K,i,n));return s.exists()?Zl(s.id,s.data()):null}async function Hu(e,t,n){if(!e||!t||!n)throw new Error("Invalid import parameters.");const{tasks:i=[],projects:s=[],labels:o=[]}=n,r=new Map,a=new Map,l=await Kn(pt(K,G.labels(e))),c=new Map;l.forEach(u=>c.set(u.data().name,u.id));for(const u of o)if(u.name)if(c.has(u.name))a.set(u.id,c.get(u.name));else{const h={...u};delete h.id;const f=await Xe(pt(K,G.labels(e)),h);a.set(u.id,f.id),c.set(u.name,f.id)}for(const u of s){const h={...u};delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt));const f=await Xe(pt(K,G.projects(e,t)),h);r.set(u.id,f.id)}const d=i.map(async u=>{const h={...u};return delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt)),typeof h.dueDate=="string"&&(h.dueDate=new Date(h.dueDate)),h.dueDate&&(h.dueDate=dr(h.dueDate)),h.projectId&&r.has(h.projectId)?h.projectId=r.get(h.projectId):h.projectId=null,Array.isArray(h.labelIds)&&(h.labelIds=h.labelIds.map(f=>a.get(f)).filter(f=>f)),h.ownerId=e,Xe(pt(K,G.tasks(e,t)),h)});return await Promise.all(d),{tasksCount:i.length,projectsCount:s.length,labelsCount:o.length}}function pe(e){if(!e)return null;if(e.toDate&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e;const t=new Date(e);return isNaN(t.getTime())?null:t}function ce(e=new Date){const t=pe(e)||new Date,n=new Date(t);return n.setHours(0,0,0,0),n}function zu(e=new Date){const t=pe(e)||new Date,n=new Date(t);return n.setHours(23,59,59,999),n}function tc(e=new Date){const t=pe(e)||new Date,n=t.getDay(),i=t.getDate()-n+(n===0?-6:1),s=new Date(t.setDate(i));return ce(s)}function ju(e=new Date){const t=pe(e)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function Wu(e){const t=pe(e);if(!t)return"";const n=new Date,i=ce(n),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return o!==n.getFullYear()?`${o}/${r}/${a}`:`${r}/${a}`}function Vu(e){const t=pe(e);if(!t)return"text-gray-500";const n=ce(new Date),i=Math.round((t.getTime()-n.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function Uu(e,t){var i;if(!e||!(t!=null&&t.type))return null;const n=new Date(pe(e));switch(t.type){case"daily":return n.setDate(n.getDate()+1),n;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=n.getDay();for(let o=1;o<=7;o++)if(t.days.includes((s+o)%7))return n.setDate(n.getDate()+o),n;return null;case"weekdays":do n.setDate(n.getDate()+1);while(n.getDay()===0||n.getDay()===6);return n;case"monthly":return n.setMonth(n.getMonth()+1),n;default:return null}}function ec(e){var n;const t=ce(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&((n=e.days)==null?void 0:n.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(e.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function Tn(){var t;const e=(t=W.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function Mn(){const e=Zt();if(!e)throw new Error("Workspace required.");return e}async function Yu(e){var o;if(e.status!=="completed"||!e.recurrence)return;const{recurrence:t,dueDate:n}=e;if(!n||typeof t!="object"||!t.type)return;const i=Uu(n,t);if(!i)return;const s={title:e.title,description:e.description||"",status:"todo",dueDate:i,projectId:e.projectId||null,labelIds:e.labelIds||[],timeBlockId:e.timeBlockId||null,duration:e.duration||null,recurrence:e.recurrence};try{const r=(o=W.currentUser)==null?void 0:o.uid,a=Zt();r&&a&&await Ql(r,a,s)}catch(r){console.error("[Recurring] Generation failed:",r)}}async function qu(e){const t=Tn(),n=Mn(),i={...e};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),Ql(t,n,i)}async function Gu(e,t){const n=Tn(),i=Mn();if(await Bu(n,i,e,t),t==="completed"){const s=await $u(n,i,e);s&&Yu(s).catch(o=>console.error(o))}}async function ur(e,t){const n=Tn(),i=Mn();return Nu(n,i,e,t)}async function nc(e){const t=Tn(),n=Mn();return Fu(t,n,e)}async function Xu(){const e=Tn(),t=Mn();return Ru(e,t)}async function Ku(e){const t=Tn(),n=Mn();return Hu(t,n,e)}let Jn=[];function ic(){return Jn}function Ju(){Jn=[]}function Zu(e,t){var r;const n=typeof e=="function"?e:t,i=(r=W.currentUser)==null?void 0:r.uid;if(!i||typeof n!="function")return Jn=[],typeof n=="function"&&n([]),()=>{};const s=G.filters(i),o=nn(pt(K,s));return Sn(o,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));Jn=l,n(l)},a=>{console.error("Error subscribing to filters:",a),Jn=[],n([])})}async function Qu(e){var o;const t=(o=W.currentUser)==null?void 0:o.uid;if(!t)throw new Error("Authentication required");const n=G.filters(t),{id:i,...s}=e;await Xe(pt(K,n),{...s,ownerId:t,createdAt:en()})}async function th(e,t){var r;const n=(r=W.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Authentication required");const i=G.filters(n),{id:s,...o}=t;await wi(Ft(K,i,e),{...o,updatedAt:en()})}async function eh(e){var i;const t=(i=W.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const n=G.filters(t);await ki(Ft(K,n,e))}let Oo=[];function nh(){return Oo}function ih(e,t){if(!e)return t([]),()=>{};const n=G.labels(e),{db:i}=Vl(),s=nn(pt(i,n));return Sn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));Oo=r,t(r)},o=>{console.error("[Labels] Subscription error:",o),Oo=[],t([])})}function sh(e,t){var s;const n=typeof e=="function"?e:t,i=(s=W.currentUser)==null?void 0:s.uid;return i&&typeof n=="function"?ih(i,n):(typeof n=="function"&&n([]),()=>{})}let Qs=null;function Hs(){return Qs||(Qs=Vl().db),Qs}let Qi=[];function oh(e,t,n){Qi=[];const i=G.projects(e,t),s=Hs(),o=nn(pt(s,i),ir("createdAt","asc"));return Sn(o,r=>{const a=r.docs.map(l=>({id:l.id,...l.data()}));Qi=a,n(a)},r=>{console.error("Error subscribing to projects:",r),Qi=[],n([])})}function hr(){return Qi}async function rh(e,t,n){const i=G.projects(e,t),s=Hs();await Xe(pt(s,i),{name:n,ownerId:e,createdAt:en()})}async function ah(e,t,n,i){const s=G.projects(e,t),o=Hs(),r=Ft(o,s,n);return wi(r,i)}async function lh(e,t,n){const i=G.projects(e,t),s=Hs();await ki(Ft(s,i,n))}function sc(){var n;const e=(n=W.currentUser)==null?void 0:n.uid,t=Zt();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const ch=hr,dh=(e,t)=>{const n=typeof e=="function"?e:t,i=typeof e=="string"?e:Zt(),s=W.currentUser;return s&&i&&typeof n=="function"?oh(s.uid,i,n):(typeof n=="function"&&n([]),()=>{})},uh=async(e,t=null)=>{const n=W.currentUser;if(!n)throw new Error("Authentication required.");const i=t||Zt();if(!i)throw new Error("Workspace selection required.");return rh(n.uid,i,e)},hh=async(e,t)=>{const{userId:n,workspaceId:i}=sc();return ah(n,i,e,t)},oc=async e=>{const{userId:t,workspaceId:n}=sc();return lh(t,n,e)};let we=[];const fh=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function gh(e,t){var o;const n=(o=W.currentUser)==null?void 0:o.uid;if(!n)return we=[...fh],typeof t=="function"&&t(we),()=>{};const i=G.timeblocks(n),s=nn(pt(K,i),ir("order","asc"));return Sn(s,r=>{we=r.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(we)},r=>{console.error("[TimeBlocks] Subscription error:",r)})}function ue(){return[...we]}function rc(e){return we.find(t=>t.id===e)}function ph(){we=[]}async function mh(e){var n;const t=(n=W.currentUser)==null?void 0:n.uid;if(!t){R("ログインが必要です");return}try{const i=G.timeblocks(t),s=e.id||crypto.randomUUID(),o=e.order!==void 0?e.order:Math.max(...we.map(a=>a.order),-1)+1,r={name:e.name,start:e.start,end:e.end,color:e.color,order:o,updatedAt:en()};return await Xd(Ft(K,i,s),r,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i)}}async function bh(e){var n;const t=(n=W.currentUser)==null?void 0:n.uid;if(t)try{const i=G.timeblocks(t);return await ki(Ft(K,i,e)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function yh(e,t){const n=W.currentUser;return!n||!e?(typeof t=="function"&&t([]),()=>{}):Pu(n.uid,e,t)}function xh(){const e=document.getElementById("export-data-btn-new");e&&(e.onclick=async()=>{const t=e.querySelector("span.font-bold"),n=t?t.textContent:"バックアップを作成";e.disabled=!0,e.classList.add("opacity-70","cursor-wait"),t&&(t.textContent="バックアップ作成中...");try{const i=await Xu(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(r),R({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),R({message:"エクスポートに失敗した",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait"),t&&(t.textContent=n)}})}function vh(){const e=document.getElementById("import-data-btn-new"),t=document.getElementById("import-file-input");!e||!t||(e.onclick=()=>{t.value="",t.click()},t.onchange=n=>{const i=n.target.files[0];if(!i)return;const s=new FileReader;s.onload=async o=>{try{const r=JSON.parse(o.target.result);if(!r.tasks||!r.projects)throw new Error("Invalid backup format");e.disabled=!0,e.classList.add("opacity-70","cursor-wait");const a=await Ku(r);R({message:`インポート完了！
タスク: ${a.tasksCount}件
プロジェクト: ${a.projectsCount}件
ラベル: ${a.labelsCount}件`,type:"success"}),setTimeout(()=>window.location.reload(),1500)}catch(r){console.error(r),R({message:`インポートに失敗しました。
ファイルが破損している可能性があります。`,type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait")}},s.readAsText(i)})}function wh(){const e=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!e||!t||(e.onclick=async()=>{const n=t.value.trim();if(n.length<6)return R({message:"6文字以上入力してくれ",type:"error"});try{await nu(n),t.value="",R({message:"パスワードを変更しました",type:"success"})}catch{}})}function kh(e){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Vd(W),e()}catch{R({message:"エラーが発生した",type:"error"})}})}function _h(e,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),e.addEventListener("click",i=>{i.target===e&&t()}),Ou(),Mu(),Au(),Iu(),Lu(),xh(),vh(),wh(),kh(t),Tu()}let Vr=!1;function Ur(){var e;(e=document.getElementById(B.MODAL_IDS.SETTINGS))==null||e.remove()}function Sh(){if(Vr)return;pu(),bu();const e=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),zs())};document.addEventListener("click",e),Vr=!0}function zs(){Ur();const e=ou(),t=W.currentUser,n=(t==null?void 0:t.email)||"匿名ユーザー",i=(n[0]||"?").toUpperCase(),s=document.createElement("div");s.id=B.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=ku(i,n,e),document.body.appendChild(s),_h(s,Ur)}function Eh(e=null){const t=!!e,n={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 ${q.MODAL.WIDTH.DEFAULT} rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${n.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(e==null?void 0:e.name)||""}" 
                        placeholder="${n.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${n.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function ac(e=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Eh(e),document.body.appendChild(n),Dh(n,e)}function Dh(e,t){const n=e.querySelector("#save-workspace-btn"),i=e.querySelector("#modal-workspace-name"),s=e.querySelector("#cancel-modal-btn"),o=e.querySelector("#workspace-modal-overlay"),r=()=>{document.removeEventListener("keydown",a),e.remove()},a=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",a),o.onclick=c=>{c.target===o&&r()},s&&(s.onclick=r);const l=async()=>{if(n.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return R({message:"ワークスペース名を入力してくれ",type:"error"});if(Lo().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return R({message:"その名前は既に使われているぞ",type:"error"});n.disabled=!0,n.textContent=t?"更新中...":"作成中...";try{if(t)await uu(t.id,c);else{const u=await Gl(c);lr(u.id)}r()}catch(u){n.disabled=!1,n.textContent=t?"保存":"作成",R({message:`失敗した: ${u.message}`,type:"error"})}};n==null||n.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Tt={CONTAINER:"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",DIALOG:"bg-white dark:bg-gray-800 w-full rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] transition-all",WIDTH:{DEFAULT:"max-w-5xl w-full"},HEADER:"px-modal py-modal border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",BODY:"p-modal overflow-y-auto flex-1 min-h-0 custom-scrollbar",FOOTER:"px-modal py-modal bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center gap-modal border-t border-gray-100 dark:border-gray-700",TITLE:"text-lg font-bold text-gray-800 dark:text-white",CLOSE_BUTTON:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",CHECKBOX:"appearance-none w-4 h-4 border-2 border-gray-400 dark:border-gray-500 rounded cursor-pointer relative checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition-all"},_s="none",to={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function lc(e=null){const t=!!e,n=ch(),i=ue(),s=[30,45,60,75,90],o=[{id:"today",name:"今日"},{id:"tomorrow",name:"明日"},{id:"week",name:"今週"},{id:"next-week",name:"来週"}],r=Th((e==null?void 0:e.query)||""),a=document.createElement("div");a.id="filter-creation-modal",a.className=q.MODAL.CONTAINER,a.innerHTML=`
        <div class="${q.MODAL.DIALOG} ${q.MODAL.WIDTH.DEFAULT}" role="dialog" aria-modal="true">
            <div class="${Tt.HEADER}">
                <h3 class="${Tt.TITLE}">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="${Tt.CLOSE_BUTTON}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="${Tt.BODY}">
                <div class="space-y-6">
                    <div>
                        <label for="filter-name" class="${q.TEXT.LABEL}">フィルター名</label>
                        <input type="text" id="filter-name" value="${(e==null?void 0:e.name)||""}" 
                               class="${q.INPUT.DEFAULT}" placeholder="例: 今週の重要タスク">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                        ${ts("プロジェクト",n,r.project,"filter-project-checkbox")}
                        ${Mh(i,r.timeblock)}
                        ${ts("所要時間",s,r.duration,"filter-duration-checkbox",l=>`${l} min`)}
                        ${ts("日付",o,r.date,"filter-date-checkbox")}
                    </div>
                </div>
            </div>
            <div class="${Tt.FOOTER}">
                <button id="cancel-filter-btn" class="${q.BUTTON.SECONDARY} mr-auto">キャンセル</button>
                <button id="save-filter-btn" class="${q.BUTTON.PRIMARY}">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(a),Ih(a,e)}function Th(e){const t={project:[],timeblock:[],duration:[],date:[]};return e&&e.split(/\s+/).forEach(n=>{if(!n.includes(":"))return;const[i,s]=n.split(":");if(t[i]){const o=s.split(",").map(r=>i==="timeblock"&&(r==="null"||r==="none")?_s:r);t[i]=[...t[i],...o]}}),t}function ts(e,t,n,i,s=o=>o.name||o){const o=new Set(n.map(String));return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${e}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map((r,a)=>{const l=String(r.id||r),c=o.has(l),d=`cb-${i}-${a}-${l}`;return`
                        <div class="flex items-center px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group">
                            <input type="checkbox" id="${d}" name="${i}" value="${l}" ${c?"checked":""} 
                                   class="${i} ${Tt.CHECKBOX} cursor-pointer">
                            <label for="${d}" class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate cursor-pointer flex-1 py-0.5">
                                ${s(r)}
                            </label>
                        </div>
                    `}).join("")}
            </div>
        </div>
    `}function Mh(e,t){const n=[...e,{id:_s,name:"未定"}];return ts("時間帯",n,t,"filter-timeblock-checkbox",i=>i.id===_s?i.name:`${i.start}-${i.end}`)}function Ih(e,t){const n=()=>{document.removeEventListener("keydown",i),e.remove()},i=s=>s.key==="Escape"&&n();document.addEventListener("keydown",i),e.querySelector("#close-filter-modal").onclick=n,e.querySelector("#cancel-filter-btn").onclick=n,e.onclick=s=>{s.target===e&&n()},e.querySelector("#save-filter-btn").onclick=async s=>{s.preventDefault();const r=e.querySelector("#filter-name").value.trim();if(!r)return R({message:to.NAME_REQUIRED,type:"error"});const a=u=>{const h=e.querySelectorAll(`input.${u}`);return Array.from(h).filter(f=>f.checked).map(f=>f.value)},l={project:a("filter-project-checkbox"),timeblock:a("filter-timeblock-checkbox").map(u=>u===_s?"null":u),duration:a("filter-duration-checkbox"),date:a("filter-date-checkbox")},c=Object.entries(l).filter(([u,h])=>h.length>0).map(([u,h])=>`${u}:${h.join(",")}`);if(c.length===0)return R({message:to.CONDITION_REQUIRED,type:"error"});const d=c.join(" ");try{const u={name:r,query:d,type:"custom"};t?await th(t.id,u):await Qu(u),document.dispatchEvent(new CustomEvent("filters-updated")),n()}catch(u){console.error(u),R({message:to.SAVE_ERROR+u.message,type:"error"})}}}function Ah(e=null){const t=!!e,n={title:(e==null?void 0:e.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 ${q.MODAL.WIDTH.DEFAULT} rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${n.title}" placeholder="${n.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${n.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Lh(e,t){var i;(i=document.getElementById(e))==null||i.remove();const n=document.createElement("div");return n.id=e,n.innerHTML=t,Su(n),document.body.appendChild(n),n}function Ch(e,t=null){const n=()=>{e.remove(),t&&t()};e.addEventListener("click",s=>{s.target===e&&n()});const i=s=>{s.key==="Escape"&&(n(),document.removeEventListener("keydown",i))};return document.addEventListener("keydown",i),n}function Oh(e,t,n=!1){requestAnimationFrame(()=>{const i=e.querySelector(t);i&&(i.focus(),n&&typeof i.select=="function"&&i.select())})}function Ph(e,t,n={}){const{focusSelector:i=null,selectText:s=!1,onClose:o=null}=n,r=Lh(e,t),a=Ch(r,o);return i&&Oh(r,i,s),{overlay:r,close:a}}function cc(e=null){const t="project-modal",n=Ah(e),{overlay:i,close:s}=Ph(t,n,{focusSelector:"#modal-project-name",selectText:!!e});Rh(i,e,s)}function Rh(e,t,n){const i=e.querySelector("#modal-project-name"),s=e.querySelector("#save-project-btn"),o=e.querySelector("#delete-project-btn"),r=e.querySelector("#cancel-modal-btn");r&&(r.onclick=n);const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return R({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await hh(t.id,{name:l});else{const c=Zt();if(!c)throw new Error("ワークスペースが選択されていないぞ");await uh(l,c)}n()}catch(c){R({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),o&&t&&(o.onclick=()=>{R({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await oc(t.id),n()}catch{R({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function di(e,t,n,i={},s=0,o="normal"){const r=document.createElement("li"),{DENSITY_CLASSES:a,COLORS:l}=B;r.dataset.type=t,r.dataset.id=n;const c=a[o]||a.normal;r.className=`group flex items-center justify-between px-3 ${c} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const u={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3">⏱️</span>',filter:i.iconHtml||'<span class="mr-3">🔍</span>'}[t]||'<span class="mr-3">🔹</span>',h=s>0?`<span class="text-gray-400 font-light mr-2" style="font-size: 0.85em;">${s}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${u}
            <span class="truncate">${e}</span>
        </div>
        <div class="flex items-center">${h}</div>
    `,r}function fr(e,t,n){var o;const i=Nh(t,n);if(!i)return;(o=document.getElementById("sidebar-context-menu"))==null||o.remove();const s=Fh(i);document.body.appendChild(s),dc(s,e),$h(s,i)}function Bh(e,t){e.preventDefault(),document.querySelectorAll(".app-context-menu, #sidebar-context-menu").forEach(s=>s.remove());const n=document.createElement("div");n.className="app-context-menu fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-xl rounded-lg py-1 z-[100] animate-fade-in text-sm min-w-[180px]",t.forEach((s,o)=>{if(o>0&&s.separator){const c=document.createElement("div");c.className="border-t border-gray-100 dark:border-gray-700 my-1",n.appendChild(c)}const r=document.createElement("button"),a=s.danger?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700";r.className=`flex w-full items-center px-4 py-2 text-left transition ${a}`;let l="";s.icon?l=`<span class="mr-2 w-4 h-4">${s.icon}</span>`:s.label.includes("ウィンドウ")&&(l='<svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>'),r.innerHTML=`${l}${s.label}`,r.onclick=c=>{c.stopPropagation(),n.remove(),s.action()},n.appendChild(r)}),document.body.appendChild(n),dc(n,e);const i=()=>{n.remove(),document.removeEventListener("click",i),document.removeEventListener("contextmenu",i)};setTimeout(()=>{document.addEventListener("click",i),document.addEventListener("contextmenu",i)},50)}function eo(e,t=null){document.dispatchEvent(new CustomEvent(gt.ROUTE_CHANGE,{detail:{page:e,id:t}}))}function Nh(e,t){return{project:{editLabel:"編集",onEdit:()=>cc(t),onDelete:async()=>{await oc(t.id),eo("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>lc(t),onDelete:async()=>{await eh(t.id),eo("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>ac(t),onDelete:async()=>{if(Lo().length<=1)throw new Error("最後のワークスペースは削除できない。");await hu(t.id);const s=Lo().filter(o=>o.id!==t.id);s.length>0&&(lr(s[0].id),eo("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[e]}function Fh(e){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${e.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function dc(e,t){const{clientX:i,clientY:s}=t,o=window.innerWidth,r=window.innerHeight;e.style.visibility="hidden";const{width:a,height:l}=e.getBoundingClientRect();let c=i,d=s;i+a>o&&(c=i-a),s+l>r&&(d=s-l),e.style.left=`${Math.max(8,c)}px`,e.style.top=`${Math.max(8,d)}px`,e.style.visibility="visible"}function $h(e,t){const n=()=>{e.remove(),document.removeEventListener("click",n),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&n();setTimeout(()=>{document.addEventListener("click",n),document.addEventListener("keydown",i)},0),e.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),n(),t.onEdit()},e.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),n(),R({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(o){R({message:"削除に失敗した: "+o.message,type:"error"})}}})}}const Li={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let Gt=null,Zn=null,Yr=!1;function Qn(e){Gt&&(e?(Gt.classList.remove(...Li.MENU_INVISIBLE),Gt.classList.add(...Li.MENU_VISIBLE),document.addEventListener("click",qr,{capture:!0})):(Gt.classList.remove(...Li.MENU_VISIBLE),Gt.classList.add(...Li.MENU_INVISIBLE),document.removeEventListener("click",qr,{capture:!0})))}const qr=e=>{Gt&&!Gt.contains(e.target)&&Zn&&!Zn.contains(e.target)&&Qn(!1)};function uc(){if(Yr)return;Zn=document.getElementById("workspace-trigger"),Gt=document.getElementById("workspace-menu");const e=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!Zn||!Gt||(Zn.onclick=n=>{n.stopPropagation();const i=Gt.classList.contains("opacity-100");Qn(!i)},e&&(e.onclick=()=>{Qn(!1),ac(null)}),t&&(t.onclick=()=>{Qn(!1),zs()}),document.addEventListener("workspace-changed",n=>{const{workspaceId:i,workspaces:s}=n.detail;hc(s,i)}),Yr=!0)}function hc(e,t=Zt()){const n=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(n&&Hh(e,n,t),i){const s=e.find(o=>o.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function Hh(e,t,n){t.innerHTML="",e.forEach(i=>{const s=i.id===n,o=document.createElement("button");o.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const r=document.createElement("span");if(r.className="truncate pointer-events-none",r.textContent=i.name,o.appendChild(r),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,o.appendChild(a.firstElementChild)}o.onclick=()=>{s||lr(i.id),Qn(!1)},o.oncontextmenu=a=>{a.preventDefault(),fr(a,"workspace",i)},t.appendChild(o)})}const{Z_INDEX:mn}=su,zh=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${mn.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${mn.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${B.DEFAULT_WIDTH}px;">
        ${jh()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${mn.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,jh=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,Wh=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${mn.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${mn.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700 z-50">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar bg-white dark:bg-gray-800" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1 bg-white dark:bg-gray-800">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function Vh(){const e=document.getElementById("app");e&&(e.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${zh()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${Wh()}
                <div id="main-content" class="flex-1 flex flex-col min-w-0 overflow-hidden">
                    <div class="w-full max-w-4xl mx-auto h-full flex flex-col">
                        <div id="task-view" class="w-full h-full animate-fade-in transition-opacity duration-150 flex flex-col"></div>
                        <div id="search-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="dashboard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="target-dashboard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="wizard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="wiki-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        
                        <!-- Persistent Add Task Footer -->
                        <div id="global-footer" class="w-full flex-none mt-auto pb-6 pt-2 px-4 bg-white dark:bg-gray-900 z-20 transition-all duration-300">
                             <div id="footer-add-btn-container" class="h-full"></div>
                             <div id="footer-input-form-container" class="hidden"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${mn.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{Yl(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),uc(),Yh(),Uh()}))}function Uh(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),n=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=o=>{const r=e.classList.contains("-translate-x-full"),a=o??!r;e.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};n==null||n.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function Yh(){document.addEventListener("keydown",e=>{const t=["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.closest("[contenteditable]"),n=document.querySelector('[role="dialog"]');if(e.key==="/"&&!t&&!n){const i=document.getElementById("page-search-input");i&&(e.preventDefault(),i.focus())}})}function qh(e){if(!e)return"";const t=e.toDate?e.toDate():new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${i}-${s}`}const Gh="task_modal_schedule_open";function Xh(e=[]){return["日","月","火","水","木","金","土"].map((n,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer select-none">
            <input type="checkbox" name="recurrence_days" id="recurrence-day-${i}" value="${i}" data-day-index="${i}" ${e.includes(i)?"checked":""} 
                   class="${Tt.CHECKBOX}">
            <span class="text-xs text-gray-700 dark:text-gray-300 relative z-10">${n}</span>
        </label>
    `).join("")}function Gr(e,t,n){return e.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${n(i)}
        </option>
    `).join("")}function Kh(e){let t=e.dueDate;const n=e.recurrence||{type:"none",days:[]};n.type!=="none"&&!t&&(t=ec(n));const i=t?qh(t.toDate?t.toDate():new Date(t)):"",s=Gr(ue(),e.timeBlockId,c=>`${c.start} - ${c.end}`),o=Gr([30,45,60,75,90],e.duration,c=>`${c} min`),r=i||n.type!=="none"||e.timeBlockId||e.duration,a=localStorage.getItem(Gh);let l=r;return a!==null?l=a==="true":r&&(l=!0),`
        <div class="${Tt.CONTAINER}">
            <div class="${Tt.DIALOG} ${Tt.WIDTH.DEFAULT}" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="${Tt.HEADER}">
                    <input type="text" id="modal-task-title" value="${e.title}" placeholder="タスクのタイトル"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="${Tt.CLOSE_BUTTON}">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ (2カラムレイアウト) -->
                <div class="${Tt.BODY} bg-gray-50/30 dark:bg-gray-900/10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
                        <!-- コンテンツ省略なしで維持 -->
                        <!-- 左カラム (8/12): メモ -->
                        <div class="md:col-span-8 flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label for="modal-task-desc" class="text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    メモ (Markdown)
                                </label>
                                <div class="flex items-center gap-2">
                                    <div class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-md p-0.5">
                                        <button type="button" id="md-bold-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="太字 (Ctrl+B)">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6V4zm0 8h9a4 4 0 014 4 4 4 0 01-4 4H6v-8z"></path></svg>
                                        </button>
                                        <div class="w-px h-3 bg-gray-300 dark:bg-gray-600 mx-0.5"></div>
                                        <button type="button" id="md-list-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="箇条書き">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <button type="button" id="md-ordered-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="番号付きリスト">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7v.01M3 12v.01M3 17v.01"></path></svg>
                                        </button>
                                    </div>
                                    <button id="toggle-memo-view" class="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-2 py-0.5 rounded transition-colors text-xs font-medium ml-2">プレビュー</button>
                                </div>
                            </div>
                            <div class="flex-1 relative min-h-[200px]">
                                <textarea id="modal-task-desc" placeholder="詳細を入力..."
                                    class="w-full h-full p-3 bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg outline-none text-sm transition-all resize-y leading-relaxed focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono">${e.description||""}</textarea>
                                <div id="modal-task-desc-preview" class="hidden absolute inset-0 w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- 右カラム (4/12): スケジュール設定 -->
                        <div class="md:col-span-4 space-y-4">
                            <details id="modal-task-schedule-details" class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm" ${l?"open":""}>
                                <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50">
                                    <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        スケジュール
                                    </span>
                                    <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </span>
                                </summary>
                                
                                <div class="p-4 flex flex-col gap-4">
                                    <div>
                                        <label for="modal-task-date" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                        <div class="relative">
                                            <input type="date" id="modal-task-date" value="${i}"
                                                class="w-full pl-3 pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:justify-end [&::-webkit-calendar-picker-indicator]:cursor-pointer">
                                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 dark:text-gray-400">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="modal-task-recurrence" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                        <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="none" ${n.type==="none"?"selected":""}>なし</option>
                                            <option value="daily" ${n.type==="daily"?"selected":""}>毎日</option>
                                            <option value="weekdays" ${n.type==="weekdays"?"selected":""}>平日</option>
                                            <option value="weekly" ${n.type==="weekly"?"selected":""}>毎週</option>
                                            <option value="monthly" ${n.type==="monthly"?"selected":""}>毎月</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label for="modal-task-timeblock" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                        <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">未定</option>
                                            ${s}
                                        </select>
                                    </div>

                                    <div>
                                        <label for="modal-task-duration" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                        <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">指定なし</option>
                                            ${o}
                                        </select>
                                    </div>

                                    <div id="recurrence-days-container" class="${n.type!=="weekly"?"hidden":""} pt-2 border-t border-gray-100 dark:border-gray-700">
                                        <span id="recurrence-days-label" class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</span>
                                        <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                            ${Xh(n.days)}
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                    </div>
                </div>

                <!-- フッター -->
                <div class="${Tt.FOOTER}">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition mr-auto">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                    <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                </div>
            </div>
        </div>
    `}function Jh(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function fc(e){if(!e)return"";const t=e.split(`
`);let n=[],i=null;return t.forEach(s=>{const o=s.trimStart(),r=o.startsWith("* ")||o.startsWith("- "),a=/^\d+\.\s/.test(o),l=r||a;if(l){const c=a?"ol":"ul";if(i!==c){i&&n.push(`</${i}>`);const d=a?"list-decimal":"list-disc";n.push(`<${c} class="${d} ml-5 space-y-1">`),i=c}}else i&&(n.push(`</${i}>`),i=null);if(l){let c="";r?c=o.substring(2):c=o.replace(/^\d+\.\s/,"");const d=Xr(c);n.push(`<li>${d}</li>`)}else s.trim()?n.push(`<p class="mb-2">${Xr(s)}</p>`):i&&(n.push(`</${i}>`),i=null)}),i&&n.push(`</${i}>`),n.join(`
`)}function Xr(e){return Jh(e).replace(/\[(.*?)\]\((.*?)\)/g,(n,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}function Kr(e,t,n=""){const i=e.selectionStart,s=e.selectionEnd,o=e.value,r=o.substring(i,s);let a=o.substring(0,i),l=o.substring(s),c="",d=0;if(n)c=a+t+r+n+l,d=s+t.length+n.length,i===s&&(d-=n.length);else if(i!==s){const h=r.split(`
`).map(f=>t+f).join(`
`);c=a+h+l,d=i+h.length}else c=a+t+l,d=i+t.length;e.value=c,e.focus(),e.selectionEnd=d,n&&i===s?(e.selectionStart=i+t.length,e.selectionEnd=i+t.length):n&&(e.selectionStart=i,e.selectionEnd=s+t.length+n.length),e.dispatchEvent(new Event("input"))}function Jr(e,t){const n=e.selectionStart,i=e.selectionEnd,s=e.value;let o=s.lastIndexOf(`
`,n-1)+1,r=s.indexOf(`
`,i);r===-1&&(r=s.length);const l=s.substring(o,r).split(`
`),c=/^(\s*)([-*]|\d+\.)(\s+)/,u=l.map(h=>{const f=h.match(c);if(f){const g=f[2],p=/^\d+\.\s*$/.test(t),m=/^\d+\.$/.test(g),b=/^[-*]$/.test(g);return p&&m||!p&&b?h.replace(c,"$1"):h.replace(c,`$1${t}`)}else return t+h}).join(`
`);e.setRangeText(u,o,r,"select"),e.dispatchEvent(new Event("input")),e.focus()}function Zh(){const e=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),n=document.getElementById("toggle-memo-view"),i=document.getElementById("md-bold-btn"),s=document.getElementById("md-list-btn"),o=document.getElementById("md-ordered-btn");if(!e||!t)return;n&&n.classList.add("hidden");const r=()=>{e.classList.remove("hidden"),t.classList.add("hidden"),e.focus()},a=()=>{const c=fc(e.value);t.innerHTML=c||'<span class="text-gray-400 cursor-text">メモを入力...</span>',e.classList.add("hidden"),t.classList.remove("hidden")};e.value.trim()?a():r(),t.addEventListener("click",r),e.addEventListener("blur",()=>{a()}),e.addEventListener("input",()=>{}),e.addEventListener("keydown",c=>{(c.ctrlKey||c.metaKey)&&c.key==="b"&&(c.preventDefault(),Kr(e,"**","**"))});const l=(c,d)=>{c&&(c.addEventListener("mousedown",u=>u.preventDefault()),c.addEventListener("click",d))};l(i,()=>Kr(e,"**","**")),l(s,()=>Jr(e,"- ")),l(o,()=>Jr(e,"1. "))}function Qh(){const e=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),n=document.getElementById("modal-task-date");if(!e||!t||!n)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(r,a=[])=>{if(r==="weekly"&&a.length===0)return;const l=ec({type:r,days:a});n.value=l.toISOString().substring(0,10)},o=()=>Array.from(i).filter(r=>r.checked).map(r=>parseInt(r.dataset.dayIndex??"0",10));e.addEventListener("change",r=>{const a=r.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?o():[];s(a,c)}}),i.forEach(r=>{r.addEventListener("change",()=>{const a=o();s("weekly",a)})})}let ne={};function tf(e){ne={title:e.querySelector("#modal-task-title"),desc:e.querySelector("#modal-task-desc"),date:e.querySelector("#modal-task-date"),recurrence:e.querySelector("#modal-task-recurrence"),timeblock:e.querySelector("#modal-task-timeblock"),duration:e.querySelector("#modal-task-duration"),saveBtn:e.querySelector("#save-task-modal-btn"),deleteBtn:e.querySelector("#delete-task-modal-btn"),closeBtn:e.querySelector("#close-modal-btn"),cancelBtn:e.querySelector("#cancel-modal-btn"),overlay:e.querySelector("div.fixed")}}function ef(e,t,n){tf(e);const{closeBtn:i,cancelBtn:s,overlay:o,saveBtn:r,deleteBtn:a}=ne;[i,s].forEach(d=>d==null?void 0:d.addEventListener("click",n)),o==null||o.addEventListener("click",d=>{d.target===d.currentTarget&&n()});const l=e.querySelector("#modal-task-schedule-details");l&&l.addEventListener("toggle",()=>{localStorage.setItem("task_modal_schedule_open",l.open)}),r==null||r.addEventListener("click",async()=>{await nf(t,n)}),a==null||a.addEventListener("click",()=>{R({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await nc(t.id),n()}catch{R({message:"削除に失敗した",type:"error"})}}})});const c=ne.date;c&&c.addEventListener("click",d=>{if(typeof c.showPicker=="function")try{c.showPicker()}catch(u){console.debug("showPicker failed or already open",u)}}),Qh(),Zh()}async function nf(e,t){var d,u,h,f,g,p,m,b;const n=(u=(d=ne.title)==null?void 0:d.value)==null?void 0:u.trim();if(!n){R({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=ne.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){R({message:"無効な日付だ",type:"error"});return}const o=(f=ne.recurrence)==null?void 0:f.value;let r=null;if(o!=="none"&&(r={type:o},o==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(v=>parseInt(v.dataset.dayIndex??"",10)).filter(v=>!isNaN(v)).sort((v,w)=>v-w);if(y.length===0){R({message:"曜日を選択してくれ",type:"error"});return}r.days=y}const a=parseInt((g=ne.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:n,description:((m=(p=ne.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:r,timeBlockId:((b=ne.timeblock)==null?void 0:b.value)||null,duration:l};try{await ur(e.id,c),t()}catch(y){console.error("Failed to update task:",y),R({message:"保存に失敗した",type:"error"})}}const gc=e=>{e.key==="Escape"&&pc()};function sf(e){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=Kh(e),ef(t,e,pc),document.addEventListener("keydown",gc)}function pc(){const e=document.getElementById("modal-container");e&&(e.innerHTML="",document.removeEventListener("keydown",gc))}const gr=e=>`${B.STORAGE_KEYS.SECTION_PREFIX}${e}`,of={basic:{title:"基本項目",listId:B.LIST_IDS.BASIC,renderContent:e=>`
                ${Ne("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${Ne("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${Ne("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${Ne("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            `},targets:{title:"Target Tools",listId:B.LIST_IDS.TARGETS,renderContent:e=>`
                ${Ne("nav-wizard","M13 10V3L4 14h7v7l9-11h-7z","目標設計ウィザード")}
                ${Ne("nav-target-dashboard","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","目標ダッシュボード")}
                ${Ne("nav-wiki","M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253","フレームワークWiki")}
            `},projects:{title:"プロジェクト",listId:B.LIST_IDS.PROJECTS,hasAddButton:!0,buttonId:"add-project-btn"},timeblocks:{title:"時間帯",listId:B.LIST_IDS.TIMEBLOCKS,hasAddButton:!0,buttonId:"edit-timeblocks-btn"},durations:{title:"所要時間",listId:B.LIST_IDS.DURATIONS},filters:{title:"フィルター",listId:B.LIST_IDS.FILTERS,hasAddButton:!0,buttonId:"add-filter-btn"}},mc=["basic","targets","projects","timeblocks","durations","filters"];function rf(){try{const e=localStorage.getItem(B.STORAGE_KEYS.SECTION_ORDER);if(e)return JSON.parse(e)}catch(e){console.error("Failed to parse section order",e)}return mc}function af(e,t,n=!1,i=""){const s=rr(gr(t),!0),o=s?"rotate-0":"-rotate-90",r=n?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${e}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${o} section-arrow" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${e}</h3>
            </div>
            ${r}
        </div>
    `}function lf(e,t=""){const n=rr(gr(e),!0);return`<ul id="${e}" class="space-y-0.5 mb-2 pl-1 ${n?"":"hidden"}">${t}</ul>`}function Ne(e,t,n,i=""){return`
        <li>
            <a href="#" id="${e}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${n}</span>
                ${i}
            </a>
        </li>
    `}function cf(){const e=rf();return mc.forEach(n=>{e.includes(n)||e.push(n)}),`<div class="mt-2 select-none" id="sidebar-sections-wrapper">${e.map(n=>{const i=of[n];if(!i)return"";const s=i.renderContent?i.renderContent(i.listId):"";return`
            <div class="sidebar-section-container transition-all duration-200" draggable="true" data-section-key="${n}">
                ${af(i.title,i.listId,i.hasAddButton,i.buttonId)}
                ${lf(i.listId,s)}
            </div>
        `}).join("")}</div>`}function df(){document.querySelectorAll(".sidebar-section-header").forEach(e=>{const t=e.dataset.target,n=document.getElementById(t),i=e.querySelector(".section-arrow");!n||!i||(e.onclick=s=>{if(s.target.closest("button"))return;const r=!n.classList.toggle(B.CLASSES.HIDDEN);i.classList.toggle("rotate-0",r),i.classList.toggle("-rotate-90",!r),e.setAttribute("aria-expanded",r),localStorage.setItem(gr(t),r)})})}function uf(){const e=document.getElementById("sidebar-sections-wrapper");if(!e)return;let t=null;e.querySelectorAll(".sidebar-section-container").forEach(i=>{i.addEventListener("dragstart",s=>{t=i,s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",i.dataset.sectionKey),i.classList.add("opacity-50","bg-gray-100","dark:bg-gray-800")}),i.addEventListener("dragend",s=>{i.classList.remove("opacity-50","bg-gray-100","dark:bg-gray-800"),e.querySelectorAll(".sidebar-section-container").forEach(o=>{o.classList.remove("border-t-2","border-blue-500")})}),i.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t!==i&&i.classList.add("border-t-2","border-blue-500")}),i.addEventListener("dragleave",s=>{i.classList.remove("border-t-2","border-blue-500")}),i.addEventListener("drop",s=>(s.stopPropagation(),s.preventDefault(),t!==i&&(e.insertBefore(t,i),hf(e)),!1))})}function hf(e){const t=e.querySelectorAll(".sidebar-section-container"),n=Array.from(t).map(i=>i.dataset.sectionKey);localStorage.setItem(B.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(n))}function ui(e,t,n=null){if(!e)return;let i=0;const s=B.CLASSES.DRAG_OVER;e.addEventListener("dragenter",o=>{o.preventDefault(),i++,e.classList.add(...s)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.contains("ring-2")||e.classList.add(...s)}),e.addEventListener("dragleave",o=>{o.preventDefault(),i--,i<=0&&(e.classList.remove(...s),i=0)}),e.addEventListener("drop",async o=>{o.preventDefault(),i=0,e.classList.remove(...s);const r=o.dataTransfer.getData("application/x-taskmg-id");r&&await ff(r,t,n)})}async function ff(e,t,n){const i={},{DURATION_LIMITS:s}=B;switch(t){case"inbox":i.projectId=null;break;case"project":n&&(i.projectId=n);break;case"timeblock":i.timeBlockId=n==="unassigned"||!n?null:n;break;case"duration":{const o=parseInt(n,10);if(!isNaN(o)&&o>=s.MIN&&o<=s.MAX)i.duration=o;else{R({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),R({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await ur(e,i)}catch(o){console.error(`[Drop Error] Type: ${t}, Task: ${e}`,o),R({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const Zr=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),Qr=["00","15","30","45"];function gf(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl ${q.MODAL.WIDTH.DEFAULT} overflow-hidden flex flex-col max-h-[90vh] relative animate-fade-in-up">
            <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition duration-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-8 overflow-y-auto flex-1 space-y-4 custom-scrollbar relative" id="tb-scroll-container">
                <div id="tb-list" class="space-y-2"></div> <!-- space-y-2 for tighter spacing -->
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed group">
                </button>

                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs opacity-80">デフォルトのゾーン</span>
                </div>
            </div>

            <div class="px-8 py-5 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none">完了</button>
            </div>

            <!-- Global Color Picker Popover (Hidden by default) -->
            <div id="tb-color-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 p-4 w-64 animate-fade-in-up">
                <div class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">プリセット</div>
                <div class="grid grid-cols-5 gap-3 mb-5" id="tb-color-presets">
                    <!-- Presets injected by JS -->
                </div>
                <div class="flex justify-between items-end mb-3">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">カスタム</div>
                    <button id="tb-custom-color-edit-btn" class="text-xs text-blue-500 hover:text-blue-600 font-medium transition-colors">編集</button>
                    <input type="color" id="tb-custom-color-input" class="invisible w-0 h-0 absolute">
                </div>
                <div class="grid grid-cols-5 gap-3" id="tb-color-customs">
                    <!-- Custom slots injected by JS -->
                </div>
            </div>
        </div>
    `}function Ci(e,t,n){const i=e.map(s=>`<div class="tb-select-option px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer text-sm transition-colors ${s===t?"bg-blue-50 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}" data-value="${s}">${s}</div>`).join("");return`
        <div class="relative tb-custom-select group min-w-[64px]" data-type="${n}" data-value="${t}">
            <button type="button" class="tb-select-trigger w-full py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-center shadow-sm hover:border-gray-300 dark:hover:border-gray-500 hover:shadow-md focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-400 transition-all flex items-center justify-center font-mono font-medium text-gray-700 dark:text-gray-200">
                <span class="value-display">${t}</span>
            </button>
            <div class="hidden tb-select-options absolute top-full left-0 mt-2 w-full min-w-[70px] max-h-56 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-xl z-20 custom-scrollbar animate-fade-in-down origin-top-left">
                ${i}
            </div>
        </div>
    `}function pf(e){const[t,n]=e.start.split(":"),[i,s]=e.end.split(":");return`
        <div class="flex-shrink-0 relative pl-2 cursor-grab active:cursor-grabbing handle p-1 rounded-md text-gray-400 hover:text-gray-600" title="移動">
             <div class="tb-color-trigger w-6 h-6 rounded-full shadow-sm hover:scale-110 active:scale-95 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900 cursor-pointer" 
                style="background-color: ${e.color}" data-color="${e.color}" title="色を変更"></div>
        </div>
        
        <div class="flex-1 flex items-center gap-4 px-2 handle cursor-grab active:cursor-grabbing">
            <div class="flex items-center gap-2">
                ${Ci(Zr,t,"start-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ci(Qr,n,"start-m")}
            </div>
            
            <div class="w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
            
            <div class="flex items-center gap-2">
                ${Ci(Zr,i,"end-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ci(Qr,s,"end-m")}
            </div>
        </div>

        <div class="flex items-center pr-2">
            <button class="delete-btn p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const Ss=5,ta={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${Ss}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${Ss}個)</span>`};function ea(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return t*60+n}function Es(e,t){if(!e)return;const n=t>=Ss;e.disabled=n,e.innerHTML=n?ta.LIMIT:ta.ADD}const mf=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6"],bc="timeblock_custom_colors";let es=null,on=-1;function na(){try{const e=localStorage.getItem(bc);return e?JSON.parse(e):["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}catch{return["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}}function bf(e){localStorage.setItem(bc,JSON.stringify(e))}function yf(e){const t=document.getElementById("tb-color-picker"),n=document.getElementById("tb-color-presets"),i=document.getElementById("tb-color-customs"),s=document.getElementById("tb-custom-color-input"),o=document.getElementById("tb-custom-color-edit-btn");if(!t||!n||!i)return;n.innerHTML=mf.map(a=>`
        <button class="w-8 h-8 rounded-full shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400"
            style="background-color: ${a}" data-color="${a}"></button>
    `).join("");const r=()=>{const a=na();i.innerHTML=a.map((l,c)=>`
            <button class="custom-color-slot w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 relative overflow-hidden"
                style="background-color: ${l}" data-index="${c}" data-color="${l}">
                <div class="absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"></div>
            </button>
        `).join("")};r(),t.addEventListener("click",a=>{const l=a.target.closest("button[data-color]");if(l&&!l.classList.contains("custom-color-slot")){const c=l.dataset.color;no(c,t)}else if(l&&l.classList.contains("custom-color-slot")){on=parseInt(l.dataset.index),document.querySelectorAll(".custom-color-slot").forEach(d=>d.classList.remove("ring-offset-2","ring-2","ring-blue-500")),l.classList.add("ring-offset-2","ring-2","ring-blue-500");const c=l.dataset.color;c!=="#E5E7EB"&&no(c,t)}}),o.onclick=()=>{on===-1&&(on=0),s.click()},s.onchange=a=>{on===-1&&(on=0);const l=a.target.value,c=na();c[on]=l,bf(c),r(),no(l,t)}}function no(e,t){es&&(es.style.backgroundColor=e,es.dataset.color=e,t.classList.add("hidden"))}function xf(e){var a;es=e;const t=document.getElementById("tb-color-picker");if(!t)return;const n=e.getBoundingClientRect(),i=(a=document.getElementById("tb-scroll-container"))==null?void 0:a.parentElement;if(!i)return;const s=i.getBoundingClientRect();let o=n.bottom-s.top+10,r=n.left-s.left;r+280>s.width&&(r=s.width-290),t.style.top=`${o}px`,t.style.left=`${r}px`,t.classList.remove("hidden")}function vf(){const e=document.getElementById("tb-color-picker");e&&e.classList.add("hidden")}function wf(e,t){const n=e.querySelector('.tb-custom-select[data-type="start-h"]').dataset.value,i=e.querySelector('.tb-custom-select[data-type="start-m"]').dataset.value,s=e.querySelector('.tb-custom-select[data-type="end-h"]').dataset.value,o=e.querySelector('.tb-custom-select[data-type="end-m"]').dataset.value,r=e.querySelector(".tb-color-trigger").dataset.color;return{id:e.dataset.id||null,start:`${n}:${i}`,end:`${s}:${o}`,color:r,order:t}}function kf(e){const t=e.dataset.id;if(!t){e.remove(),Es(document.getElementById("add-tb-btn"),ue().length);return}e.style.opacity="0",e.style.transform="translateX(-20px)",setTimeout(()=>{R({message:`削除しますか？
（完了ボタンを押さなくても、削除は即時反映されます）`,type:"confirm",onConfirm:async()=>{try{await bh(t),e.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),Es(document.getElementById("add-tb-btn"),ue().length)}catch{R({message:"削除に失敗しました",type:"error"})}},onCancel:()=>{e.style.opacity="1",e.style.transform="translate(0)"}})},200)}async function _f(e,t){const i=Array.from(document.querySelectorAll(".tb-row")).map((o,r)=>wf(o,r));for(const o of i){const r=ea(o.start),a=ea(o.end);if(r>=a)return R({message:`時間設定が不正です: ${o.start} - ${o.end}
(終了時間は開始時間より後にしてください)`,type:"error"})}e.disabled=!0;const s=e.textContent;e.textContent="保存中...";try{const o=i.map(r=>mh({id:r.id,name:`${r.start}-${r.end}`,start:r.start,end:r.end,color:r.color,order:r.order}));await Promise.all(o),document.dispatchEvent(new CustomEvent("timeblocks-updated")),t()}catch(o){console.error("Timeblock save error (suppressed):",o)}finally{e.disabled=!1,e.textContent=s}}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function ia(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ia(Object(n),!0).forEach(function(i){Sf(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ia(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function ns(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?ns=function(t){return typeof t}:ns=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ns(e)}function Sf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(){return he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},he.apply(this,arguments)}function Ef(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function Df(e,t){if(e==null)return{};var n=Ef(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var Tf="1.15.6";function de(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var me=de(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Si=de(/Edge/i),sa=de(/firefox/i),ti=de(/safari/i)&&!de(/chrome/i)&&!de(/android/i),pr=de(/iP(ad|od|hone)/i),yc=de(/chrome/i)&&de(/android/i),xc={capture:!1,passive:!1};function H(e,t,n){e.addEventListener(t,n,!me&&xc)}function F(e,t,n){e.removeEventListener(t,n,!me&&xc)}function Ds(e,t){if(t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function vc(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function zt(e,t,n,i){if(e){n=n||document;do{if(t!=null&&(t[0]===">"?e.parentNode===n&&Ds(e,t):Ds(e,t))||i&&e===n)return e;if(e===n)break}while(e=vc(e))}return null}var oa=/\s+/g;function Lt(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(oa," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(oa," ")}}function A(e,t,n){var i=e&&e.style;if(i){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=n+(typeof n=="string"?"":"px")}}function bn(e,t){var n="";if(typeof e=="string")n=e;else do{var i=A(e,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(n)}function wc(e,t,n){if(e){var i=e.getElementsByTagName(t),s=0,o=i.length;if(n)for(;s<o;s++)n(i[s],s);return i}return[]}function Xt(){var e=document.scrollingElement;return e||document.documentElement}function dt(e,t,n,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var o,r,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==Xt()?(o=e.getBoundingClientRect(),r=o.top,a=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(r=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(s=s||e.parentNode,!me))do if(s&&s.getBoundingClientRect&&(A(s,"transform")!=="none"||n&&A(s,"position")!=="static")){var h=s.getBoundingClientRect();r-=h.top+parseInt(A(s,"border-top-width")),a-=h.left+parseInt(A(s,"border-left-width")),l=r+o.height,c=a+o.width;break}while(s=s.parentNode);if(i&&e!==window){var f=bn(s||e),g=f&&f.a,p=f&&f.d;f&&(r/=p,a/=g,u/=g,d/=p,l=r+d,c=a+u)}return{top:r,left:a,bottom:l,right:c,width:u,height:d}}}function ra(e,t,n){for(var i=ke(e,!0),s=dt(e)[t];i;){var o=dt(i)[n],r=void 0;if(r=s>=o,!r)return i;if(i===Xt())break;i=ke(i,!1)}return!1}function vn(e,t,n,i){for(var s=0,o=0,r=e.children;o<r.length;){if(r[o].style.display!=="none"&&r[o]!==L.ghost&&(i||r[o]!==L.dragged)&&zt(r[o],n.draggable,e,!1)){if(s===t)return r[o];s++}o++}return null}function mr(e,t){for(var n=e.lastElementChild;n&&(n===L.ghost||A(n,"display")==="none"||t&&!Ds(n,t));)n=n.previousElementSibling;return n||null}function Bt(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==L.clone&&(!t||Ds(e,t))&&n++;return n}function aa(e){var t=0,n=0,i=Xt();if(e)do{var s=bn(e),o=s.a,r=s.d;t+=e.scrollLeft*o,n+=e.scrollTop*r}while(e!==i&&(e=e.parentNode));return[t,n]}function Mf(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n)}return-1}function ke(e,t){if(!e||!e.getBoundingClientRect)return Xt();var n=e,i=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var s=A(n);if(n.clientWidth<n.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Xt();if(i||t)return n;i=!0}}while(n=n.parentNode);return Xt()}function If(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function io(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var ei;function kc(e,t){return function(){if(!ei){var n=arguments,i=this;n.length===1?e.call(i,n[0]):e.apply(i,n),ei=setTimeout(function(){ei=void 0},t)}}}function Af(){clearTimeout(ei),ei=void 0}function _c(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function Sc(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function Ec(e,t,n){var i={};return Array.from(e.children).forEach(function(s){var o,r,a,l;if(!(!zt(s,t.draggable,e,!1)||s.animated||s===n)){var c=dt(s);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,c.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,c.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,c.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var It="Sortable"+new Date().getTime();function Lf(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(A(s,"display")==="none"||s===L.ghost)){e.push({target:s,rect:dt(s)});var o=Jt({},e[e.length-1].rect);if(s.thisAnimationDuration){var r=bn(s,!0);r&&(o.top-=r.f,o.left-=r.e)}s.fromRect=o}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(Mf(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var o=!1,r=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,u=dt(c),h=c.prevFromRect,f=c.prevToRect,g=a.rect,p=bn(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&io(h,u)&&!io(d,u)&&(g.top-u.top)/(g.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(l=Of(g,h,f,s.options)),io(u,d)||(c.prevFromRect=d,c.prevToRect=u,l||(l=s.options.animation),s.animate(c,g,u,l)),l&&(o=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),o?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),e=[]},animate:function(i,s,o,r){if(r){A(i,"transition",""),A(i,"transform","");var a=bn(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-o.left)/(l||1),u=(s.top-o.top)/(c||1);i.animatingX=!!d,i.animatingY=!!u,A(i,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=Cf(i),A(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),A(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){A(i,"transition",""),A(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Cf(e){return e.offsetWidth}function Of(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}var rn=[],so={initializeByDefault:!0},Ei={mount:function(t){for(var n in so)so.hasOwnProperty(n)&&!(n in t)&&(t[n]=so[n]);rn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),rn.push(t)},pluginEvent:function(t,n,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";rn.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][o]&&n[r.pluginName][o](Jt({sortable:n},i)),n.options[r.pluginName]&&n[r.pluginName][t]&&n[r.pluginName][t](Jt({sortable:n},i)))})},initializePlugins:function(t,n,i,s){rn.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,n,t.options);c.sortable=t,c.options=t.options,t[l]=c,he(i,c.defaults)}});for(var o in t.options)if(t.options.hasOwnProperty(o)){var r=this.modifyOption(t,o,t.options[o]);typeof r<"u"&&(t.options[o]=r)}},getEventProperties:function(t,n){var i={};return rn.forEach(function(s){typeof s.eventProperties=="function"&&he(i,s.eventProperties.call(n[s.pluginName],t))}),i},modifyOption:function(t,n,i){var s;return rn.forEach(function(o){t[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[n]=="function"&&(s=o.optionListeners[n].call(t[o.pluginName],i))}),s}};function Pf(e){var t=e.sortable,n=e.rootEl,i=e.name,s=e.targetEl,o=e.cloneEl,r=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,f=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[It],!!t){var p,m=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!me&&!Si?p=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(i,!0,!0)),p.to=r||n,p.from=a||n,p.item=s||n,p.clone=o,p.oldIndex=l,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=f?f.lastPutMode:void 0;var y=Jt(Jt({},g),Ei.getEventProperties(i,t));for(var v in y)p[v]=y[v];n&&n.dispatchEvent(p),m[b]&&m[b].call(t,p)}}var Rf=["evt"],Et=function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,o=Df(i,Rf);Ei.pluginEvent.bind(L)(t,n,Jt({dragEl:E,parentEl:rt,ghostEl:O,rootEl:et,nextEl:Ve,lastDownEl:is,cloneEl:ot,cloneHidden:xe,dragStarted:Hn,putSortable:yt,activeSortable:L.active,originalEvent:s,oldIndex:gn,oldDraggableIndex:ni,newIndex:Ct,newDraggableIndex:ye,hideGhostForTarget:Ic,unhideGhostForTarget:Ac,cloneNowHidden:function(){xe=!0},cloneNowShown:function(){xe=!1},dispatchSortableEvent:function(a){St({sortable:n,name:a,originalEvent:s})}},o))};function St(e){Pf(Jt({putSortable:yt,cloneEl:ot,targetEl:E,rootEl:et,oldIndex:gn,oldDraggableIndex:ni,newIndex:Ct,newDraggableIndex:ye},e))}var E,rt,O,et,Ve,is,ot,xe,gn,Ct,ni,ye,Oi,yt,fn=!1,Ts=!1,Ms=[],Fe,$t,oo,ro,la,ca,Hn,an,ii,si=!1,Pi=!1,ss,xt,ao=[],Po=!1,Is=[],js=typeof document<"u",Ri=pr,da=Si||me?"cssFloat":"float",Bf=js&&!yc&&!pr&&"draggable"in document.createElement("div"),Dc=(function(){if(js){if(me)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),Tc=function(t,n){var i=A(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=vn(t,0,n),r=vn(t,1,n),a=o&&A(o),l=r&&A(r),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+dt(o).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+dt(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[da]==="none"||r&&i[da]==="none"&&c+d>s)?"vertical":"horizontal"},Nf=function(t,n,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,r=i?t.width:t.height,a=i?n.left:n.top,l=i?n.right:n.bottom,c=i?n.width:n.height;return s===a||o===l||s+r/2===a+c/2},Ff=function(t,n){var i;return Ms.some(function(s){var o=s[It].options.emptyInsertThreshold;if(!(!o||mr(s))){var r=dt(s),a=t>=r.left-o&&t<=r.right+o,l=n>=r.top-o&&n<=r.bottom+o;if(a&&l)return i=s}}),i},Mc=function(t){function n(o,r){return function(a,l,c,d){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(o==null&&(r||u))return!0;if(o==null||o===!1)return!1;if(r&&o==="clone")return o;if(typeof o=="function")return n(o(a,l,c,d),r)(a,l,c,d);var h=(r?a:l).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var i={},s=t.group;(!s||ns(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=n(s.pull,!0),i.checkPut=n(s.put),i.revertClone=s.revertClone,t.group=i},Ic=function(){!Dc&&O&&A(O,"display","none")},Ac=function(){!Dc&&O&&A(O,"display","")};js&&!yc&&document.addEventListener("click",function(e){if(Ts)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ts=!1,!1},!0);var $e=function(t){if(E){t=t.touches?t.touches[0]:t;var n=Ff(t.clientX,t.clientY);if(n){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=n,i.preventDefault=void 0,i.stopPropagation=void 0,n[It]._onDragOver(i)}}},$f=function(t){E&&E.parentNode[It]._isOutsideThisEl(t.target)};function L(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=he({},t),e[It]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Tc(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,a){r.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:L.supportPointer!==!1&&"PointerEvent"in window&&(!ti||pr),emptyInsertThreshold:5};Ei.initializePlugins(this,e,n);for(var i in n)!(i in t)&&(t[i]=n[i]);Mc(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:Bf,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?H(e,"pointerdown",this._onTapStart):(H(e,"mousedown",this._onTapStart),H(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(H(e,"dragover",this),H(e,"dragenter",this)),Ms.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),he(this,Lf())}L.prototype={constructor:L,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(an=null)},_getDirection:function(t,n){return typeof this.options.direction=="function"?this.options.direction.call(this,t,n,E):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n=this,i=this.el,s=this.options,o=s.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(qf(i),!E&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&ti&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=zt(l,s.draggable,i,!1),!(l&&l.animated)&&is!==l)){if(gn=Bt(l),ni=Bt(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){St({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),Et("filter",n,{evt:t}),o&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=zt(c,u.trim(),i,!1),u)return St({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),Et("filter",n,{evt:t}),!0}),d)){o&&t.preventDefault();return}s.handle&&!zt(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,n,i){var s=this,o=s.el,r=s.options,a=o.ownerDocument,l;if(i&&!E&&i.parentNode===o){var c=dt(i);if(et=o,E=i,rt=E.parentNode,Ve=E.nextSibling,is=i,Oi=r.group,L.dragged=E,Fe={target:E,clientX:(n||t).clientX,clientY:(n||t).clientY},la=Fe.clientX-c.left,ca=Fe.clientY-c.top,this._lastX=(n||t).clientX,this._lastY=(n||t).clientY,E.style["will-change"]="all",l=function(){if(Et("delayEnded",s,{evt:t}),L.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!sa&&s.nativeDraggable&&(E.draggable=!0),s._triggerDragStart(t,n),St({sortable:s,name:"choose",originalEvent:t}),Lt(E,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){wc(E,d.trim(),lo)}),H(a,"dragover",$e),H(a,"mousemove",$e),H(a,"touchmove",$e),r.supportPointer?(H(a,"pointerup",s._onDrop),!this.nativeDraggable&&H(a,"pointercancel",s._onDrop)):(H(a,"mouseup",s._onDrop),H(a,"touchend",s._onDrop),H(a,"touchcancel",s._onDrop)),sa&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),Et("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Si||me))){if(L.eventCanceled){this._onDrop();return}r.supportPointer?(H(a,"pointerup",s._disableDelayedDrag),H(a,"pointercancel",s._disableDelayedDrag)):(H(a,"mouseup",s._disableDelayedDrag),H(a,"touchend",s._disableDelayedDrag),H(a,"touchcancel",s._disableDelayedDrag)),H(a,"mousemove",s._delayedDragTouchMoveHandler),H(a,"touchmove",s._delayedDragTouchMoveHandler),r.supportPointer&&H(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&lo(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._disableDelayedDrag),F(t,"touchend",this._disableDelayedDrag),F(t,"touchcancel",this._disableDelayedDrag),F(t,"pointerup",this._disableDelayedDrag),F(t,"pointercancel",this._disableDelayedDrag),F(t,"mousemove",this._delayedDragTouchMoveHandler),F(t,"touchmove",this._delayedDragTouchMoveHandler),F(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||t.pointerType=="touch"&&t,!this.nativeDraggable||n?this.options.supportPointer?H(document,"pointermove",this._onTouchMove):n?H(document,"touchmove",this._onTouchMove):H(document,"mousemove",this._onTouchMove):(H(E,"dragend",this),H(et,"dragstart",this._onDragStart));try{document.selection?os(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,n){if(fn=!1,et&&E){Et("dragStarted",this,{evt:n}),this.nativeDraggable&&H(document,"dragover",$f);var i=this.options;!t&&Lt(E,i.dragClass,!1),Lt(E,i.ghostClass,!0),L.active=this,t&&this._appendGhost(),St({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if($t){this._lastX=$t.clientX,this._lastY=$t.clientY,Ic();for(var t=document.elementFromPoint($t.clientX,$t.clientY),n=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint($t.clientX,$t.clientY),t!==n);)n=t;if(E.parentNode[It]._isOutsideThisEl(t),n)do{if(n[It]){var i=void 0;if(i=n[It]._onDragOver({clientX:$t.clientX,clientY:$t.clientY,target:t,rootEl:n}),i&&!this.options.dragoverBubble)break}t=n}while(n=vc(n));Ac()}},_onTouchMove:function(t){if(Fe){var n=this.options,i=n.fallbackTolerance,s=n.fallbackOffset,o=t.touches?t.touches[0]:t,r=O&&bn(O,!0),a=O&&r&&r.a,l=O&&r&&r.d,c=Ri&&xt&&aa(xt),d=(o.clientX-Fe.clientX+s.x)/(a||1)+(c?c[0]-ao[0]:0)/(a||1),u=(o.clientY-Fe.clientY+s.y)/(l||1)+(c?c[1]-ao[1]:0)/(l||1);if(!L.active&&!fn){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(O){r?(r.e+=d-(oo||0),r.f+=u-(ro||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");A(O,"webkitTransform",h),A(O,"mozTransform",h),A(O,"msTransform",h),A(O,"transform",h),oo=d,ro=u,$t=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!O){var t=this.options.fallbackOnBody?document.body:et,n=dt(E,!0,Ri,!0,t),i=this.options;if(Ri){for(xt=t;A(xt,"position")==="static"&&A(xt,"transform")==="none"&&xt!==document;)xt=xt.parentNode;xt!==document.body&&xt!==document.documentElement?(xt===document&&(xt=Xt()),n.top+=xt.scrollTop,n.left+=xt.scrollLeft):xt=Xt(),ao=aa(xt)}O=E.cloneNode(!0),Lt(O,i.ghostClass,!1),Lt(O,i.fallbackClass,!0),Lt(O,i.dragClass,!0),A(O,"transition",""),A(O,"transform",""),A(O,"box-sizing","border-box"),A(O,"margin",0),A(O,"top",n.top),A(O,"left",n.left),A(O,"width",n.width),A(O,"height",n.height),A(O,"opacity","0.8"),A(O,"position",Ri?"absolute":"fixed"),A(O,"zIndex","100000"),A(O,"pointerEvents","none"),L.ghost=O,t.appendChild(O),A(O,"transform-origin",la/parseInt(O.style.width)*100+"% "+ca/parseInt(O.style.height)*100+"%")}},_onDragStart:function(t,n){var i=this,s=t.dataTransfer,o=i.options;if(Et("dragStart",this,{evt:t}),L.eventCanceled){this._onDrop();return}Et("setupClone",this),L.eventCanceled||(ot=Sc(E),ot.removeAttribute("id"),ot.draggable=!1,ot.style["will-change"]="",this._hideClone(),Lt(ot,this.options.chosenClass,!1),L.clone=ot),i.cloneId=os(function(){Et("clone",i),!L.eventCanceled&&(i.options.removeCloneOnHide||et.insertBefore(ot,E),i._hideClone(),St({sortable:i,name:"clone"}))}),!n&&Lt(E,o.dragClass,!0),n?(Ts=!0,i._loopId=setInterval(i._emulateDragOver,50)):(F(document,"mouseup",i._onDrop),F(document,"touchend",i._onDrop),F(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,E)),H(document,"drop",i),A(E,"transform","translateZ(0)")),fn=!0,i._dragStartId=os(i._dragStarted.bind(i,n,t)),H(document,"selectstart",i),Hn=!0,window.getSelection().removeAllRanges(),ti&&A(document.body,"user-select","none")},_onDragOver:function(t){var n=this.el,i=t.target,s,o,r,a=this.options,l=a.group,c=L.active,d=Oi===l,u=a.sort,h=yt||c,f,g=this,p=!1;if(Po)return;function m(bt,ht){Et(bt,g,Jt({evt:t,isOwner:d,axis:f?"vertical":"horizontal",revert:r,dragRect:s,targetRect:o,canSort:u,fromSortable:h,target:i,completed:y,onMove:function(Pe,be){return Bi(et,n,E,s,Pe,dt(Pe),t,be)},changed:v},ht))}function b(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==h&&h.captureAnimationState()}function y(bt){return m("dragOverCompleted",{insertion:bt}),bt&&(d?c._hideClone():c._showClone(g),g!==h&&(Lt(E,yt?yt.options.ghostClass:c.options.ghostClass,!1),Lt(E,a.ghostClass,!0)),yt!==g&&g!==L.active?yt=g:g===L.active&&yt&&(yt=null),h===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===n&&!i.animated)&&(an=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(E.parentNode[It]._isOutsideThisEl(t.target),!bt&&$e(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function v(){Ct=Bt(E),ye=Bt(E,a.draggable),St({sortable:g,name:"change",toEl:n,newIndex:Ct,newDraggableIndex:ye,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=zt(i,a.draggable,n,!0),m("dragOver"),L.eventCanceled)return p;if(E.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if(Ts=!1,c&&!a.disabled&&(d?u||(r=rt!==et):yt===this||(this.lastPutMode=Oi.checkPull(this,c,E,t))&&l.checkPut(this,c,E,t))){if(f=this._getDirection(t,i)==="vertical",s=dt(E),m("dragOverValid"),L.eventCanceled)return p;if(r)return rt=et,b(),this._hideClone(),m("revert"),L.eventCanceled||(Ve?et.insertBefore(E,Ve):et.appendChild(E)),y(!0);var w=mr(n,a.draggable);if(!w||Wf(t,f,this)&&!w.animated){if(w===E)return y(!1);if(w&&n===t.target&&(i=w),i&&(o=dt(i)),Bi(et,n,E,s,i,o,t,!!i)!==!1)return b(),w&&w.nextSibling?n.insertBefore(E,w.nextSibling):n.appendChild(E),rt=n,v(),y(!0)}else if(w&&jf(t,f,this)){var x=vn(n,0,a,!0);if(x===E)return y(!1);if(i=x,o=dt(i),Bi(et,n,E,s,i,o,t,!1)!==!1)return b(),n.insertBefore(E,x),rt=n,v(),y(!0)}else if(i.parentNode===n){o=dt(i);var _=0,k,S=E.parentNode!==n,M=!Nf(E.animated&&E.toRect||s,i.animated&&i.toRect||o,f),I=f?"top":"left",T=ra(i,"top","top")||ra(E,"top","top"),C=T?T.scrollTop:void 0;an!==i&&(k=o[I],si=!1,Pi=!M&&a.invertSwap||S),_=Vf(t,i,o,f,M?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Pi,an===i);var U;if(_!==0){var Q=Bt(E);do Q-=_,U=rt.children[Q];while(U&&(A(U,"display")==="none"||U===O))}if(_===0||U===i)return y(!1);an=i,ii=_;var z=i.nextElementSibling,j=!1;j=_===1;var J=Bi(et,n,E,s,i,o,t,j);if(J!==!1)return(J===1||J===-1)&&(j=J===1),Po=!0,setTimeout(zf,30),b(),j&&!z?n.appendChild(E):i.parentNode.insertBefore(E,j?z:i),T&&_c(T,0,C-T.scrollTop),rt=E.parentNode,k!==void 0&&!Pi&&(ss=Math.abs(k-dt(i)[I])),v(),y(!0)}if(n.contains(E))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",$e),F(document,"mousemove",$e),F(document,"touchmove",$e)},_offUpEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._onDrop),F(t,"touchend",this._onDrop),F(t,"pointerup",this._onDrop),F(t,"pointercancel",this._onDrop),F(t,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(t){var n=this.el,i=this.options;if(Ct=Bt(E),ye=Bt(E,i.draggable),Et("drop",this,{evt:t}),rt=E&&E.parentNode,Ct=Bt(E),ye=Bt(E,i.draggable),L.eventCanceled){this._nulling();return}fn=!1,Pi=!1,si=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ro(this.cloneId),Ro(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ti&&A(document.body,"user-select",""),A(E,"transform",""),t&&(Hn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),O&&O.parentNode&&O.parentNode.removeChild(O),(et===rt||yt&&yt.lastPutMode!=="clone")&&ot&&ot.parentNode&&ot.parentNode.removeChild(ot),E&&(this.nativeDraggable&&F(E,"dragend",this),lo(E),E.style["will-change"]="",Hn&&!fn&&Lt(E,yt?yt.options.ghostClass:this.options.ghostClass,!1),Lt(E,this.options.chosenClass,!1),St({sortable:this,name:"unchoose",toEl:rt,newIndex:null,newDraggableIndex:null,originalEvent:t}),et!==rt?(Ct>=0&&(St({rootEl:rt,name:"add",toEl:rt,fromEl:et,originalEvent:t}),St({sortable:this,name:"remove",toEl:rt,originalEvent:t}),St({rootEl:rt,name:"sort",toEl:rt,fromEl:et,originalEvent:t}),St({sortable:this,name:"sort",toEl:rt,originalEvent:t})),yt&&yt.save()):Ct!==gn&&Ct>=0&&(St({sortable:this,name:"update",toEl:rt,originalEvent:t}),St({sortable:this,name:"sort",toEl:rt,originalEvent:t})),L.active&&((Ct==null||Ct===-1)&&(Ct=gn,ye=ni),St({sortable:this,name:"end",toEl:rt,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){Et("nulling",this),et=E=rt=O=Ve=ot=is=xe=Fe=$t=Hn=Ct=ye=gn=ni=an=ii=yt=Oi=L.dragged=L.ghost=L.clone=L.active=null,Is.forEach(function(t){t.checked=!0}),Is.length=oo=ro=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":E&&(this._onDragOver(t),Hf(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],n,i=this.el.children,s=0,o=i.length,r=this.options;s<o;s++)n=i[s],zt(n,r.draggable,this.el,!1)&&t.push(n.getAttribute(r.dataIdAttr)||Yf(n));return t},sort:function(t,n){var i={},s=this.el;this.toArray().forEach(function(o,r){var a=s.children[r];zt(a,this.options.draggable,s,!1)&&(i[o]=a)},this),n&&this.captureAnimationState(),t.forEach(function(o){i[o]&&(s.removeChild(i[o]),s.appendChild(i[o]))}),n&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,n){return zt(t,n||this.options.draggable,this.el,!1)},option:function(t,n){var i=this.options;if(n===void 0)return i[t];var s=Ei.modifyOption(this,t,n);typeof s<"u"?i[t]=s:i[t]=n,t==="group"&&Mc(i)},destroy:function(){Et("destroy",this);var t=this.el;t[It]=null,F(t,"mousedown",this._onTapStart),F(t,"touchstart",this._onTapStart),F(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(t,"dragover",this),F(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Ms.splice(Ms.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!xe){if(Et("hideClone",this),L.eventCanceled)return;A(ot,"display","none"),this.options.removeCloneOnHide&&ot.parentNode&&ot.parentNode.removeChild(ot),xe=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(xe){if(Et("showClone",this),L.eventCanceled)return;E.parentNode==et&&!this.options.group.revertClone?et.insertBefore(ot,E):Ve?et.insertBefore(ot,Ve):et.appendChild(ot),this.options.group.revertClone&&this.animate(E,ot),A(ot,"display",""),xe=!1}}};function Hf(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Bi(e,t,n,i,s,o,r,a){var l,c=e[It],d=c.options.onMove,u;return window.CustomEvent&&!me&&!Si?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=s||t,l.relatedRect=o||dt(t),l.willInsertAfter=a,l.originalEvent=r,e.dispatchEvent(l),d&&(u=d.call(c,l,r)),u}function lo(e){e.draggable=!1}function zf(){Po=!1}function jf(e,t,n){var i=dt(vn(n.el,0,n.options,!0)),s=Ec(n.el,n.options,O),o=10;return t?e.clientX<s.left-o||e.clientY<i.top&&e.clientX<i.right:e.clientY<s.top-o||e.clientY<i.bottom&&e.clientX<i.left}function Wf(e,t,n){var i=dt(mr(n.el,n.options.draggable)),s=Ec(n.el,n.options,O),o=10;return t?e.clientX>s.right+o||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>s.bottom+o||e.clientX>i.right&&e.clientY>i.top}function Vf(e,t,n,i,s,o,r,a){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,h=!1;if(!r){if(a&&ss<c*s){if(!si&&(ii===1?l>d+c*o/2:l<u-c*o/2)&&(si=!0),si)h=!0;else if(ii===1?l<d+ss:l>u-ss)return-ii}else if(l>d+c*(1-s)/2&&l<u-c*(1-s)/2)return Uf(t)}return h=h||r,h&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}function Uf(e){return Bt(E)<Bt(e)?1:-1}function Yf(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function qf(e){Is.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&Is.push(i)}}function os(e){return setTimeout(e,0)}function Ro(e){return clearTimeout(e)}js&&H(document,"touchmove",function(e){(L.active||fn)&&e.cancelable&&e.preventDefault()});L.utils={on:H,off:F,css:A,find:wc,is:function(t,n){return!!zt(t,n,t,!1)},extend:If,throttle:kc,closest:zt,toggleClass:Lt,clone:Sc,index:Bt,nextTick:os,cancelNextTick:Ro,detectDirection:Tc,getChild:vn,expando:It};L.get=function(e){return e[It]};L.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(L.utils=Jt(Jt({},L.utils),i.utils)),Ei.mount(i)})};L.create=function(e,t){return new L(e,t)};L.version=Tf;var ct=[],zn,Bo,No=!1,co,uo,As,jn;function Gf(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(n){var i=n.originalEvent;this.sortable.nativeDraggable?H(document,"dragover",this._handleAutoScroll):this.options.supportPointer?H(document,"pointermove",this._handleFallbackAutoScroll):i.touches?H(document,"touchmove",this._handleFallbackAutoScroll):H(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var i=n.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),ua(),rs(),Af()},nulling:function(){As=Bo=zn=No=jn=co=uo=null,ct.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,i){var s=this,o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(o,r);if(As=n,i||this.options.forceAutoScrollFallback||Si||me||ti){ho(n,this.options,a,i);var l=ke(a,!0);No&&(!jn||o!==co||r!==uo)&&(jn&&ua(),jn=setInterval(function(){var c=ke(document.elementFromPoint(o,r),!0);c!==l&&(l=c,rs()),ho(n,s.options,c,i)},10),co=o,uo=r)}else{if(!this.options.bubbleScroll||ke(a,!0)===Xt()){rs();return}ho(n,this.options,ke(a,!1),!1)}}},he(e,{pluginName:"scroll",initializeByDefault:!0})}function rs(){ct.forEach(function(e){clearInterval(e.pid)}),ct=[]}function ua(){clearInterval(jn)}var ho=kc(function(e,t,n,i){if(t.scroll){var s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,a=t.scrollSpeed,l=Xt(),c=!1,d;Bo!==n&&(Bo=n,rs(),zn=t.scroll,d=t.scrollFn,zn===!0&&(zn=ke(n,!0)));var u=0,h=zn;do{var f=h,g=dt(f),p=g.top,m=g.bottom,b=g.left,y=g.right,v=g.width,w=g.height,x=void 0,_=void 0,k=f.scrollWidth,S=f.scrollHeight,M=A(f),I=f.scrollLeft,T=f.scrollTop;f===l?(x=v<k&&(M.overflowX==="auto"||M.overflowX==="scroll"||M.overflowX==="visible"),_=w<S&&(M.overflowY==="auto"||M.overflowY==="scroll"||M.overflowY==="visible")):(x=v<k&&(M.overflowX==="auto"||M.overflowX==="scroll"),_=w<S&&(M.overflowY==="auto"||M.overflowY==="scroll"));var C=x&&(Math.abs(y-s)<=r&&I+v<k)-(Math.abs(b-s)<=r&&!!I),U=_&&(Math.abs(m-o)<=r&&T+w<S)-(Math.abs(p-o)<=r&&!!T);if(!ct[u])for(var Q=0;Q<=u;Q++)ct[Q]||(ct[Q]={});(ct[u].vx!=C||ct[u].vy!=U||ct[u].el!==f)&&(ct[u].el=f,ct[u].vx=C,ct[u].vy=U,clearInterval(ct[u].pid),(C!=0||U!=0)&&(c=!0,ct[u].pid=setInterval((function(){i&&this.layer===0&&L.active._onTouchMove(As);var z=ct[this.layer].vy?ct[this.layer].vy*a:0,j=ct[this.layer].vx?ct[this.layer].vx*a:0;typeof d=="function"&&d.call(L.dragged.parentNode[It],j,z,e,As,ct[this.layer].el)!=="continue"||_c(ct[this.layer].el,j,z)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==l&&(h=ke(h,!1)));No=c}},30),Lc=function(t){var n=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(n){var c=i||o;a();var d=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function br(){}br.prototype={startIndex:null,dragStart:function(t){var n=t.oldDraggableIndex;this.startIndex=n},onSpill:function(t){var n=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=vn(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(n,s):this.sortable.el.appendChild(n),this.sortable.animateAll(),i&&i.animateAll()},drop:Lc};he(br,{pluginName:"revertOnSpill"});function yr(){}yr.prototype={onSpill:function(t){var n=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),s.animateAll()},drop:Lc};he(yr,{pluginName:"removeOnSpill"});L.mount(new Gf);L.mount(yr,br);const Xf={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function Cc(e=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",n.innerHTML=gf(),document.body.appendChild(n),Kf(e),yf(),Jf(n)}function Kf(e){const t=document.getElementById("tb-list"),n=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=ue(),s=document.createDocumentFragment();i.forEach(o=>s.appendChild(Oc(o))),t.appendChild(s),Es(n,i.length),new L(t,{animation:150,handle:".handle",ghostClass:"bg-blue-50",onEnd:function(o){}}),e!=null&&e.id&&requestAnimationFrame(()=>{const o=t.querySelector(`.tb-row[data-id="${e.id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("bg-blue-50","dark:bg-blue-900/20"))})}function Oc(e=null){const t=e||{...Xf},n=document.createElement("div");n.className="tb-row flex items-center gap-4 py-2 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg select-none",t.id&&(n.dataset.id=t.id),n.innerHTML=pf(t);const i=n.querySelector(".delete-btn");return i.onclick=()=>kf(n),n}function Jf(e){const t=e.querySelector("#add-tb-btn"),n=e.querySelector("#close-tb-modal"),i=e.querySelector("#close-tb-footer"),s=()=>{e.remove(),document.removeEventListener("keydown",o),document.removeEventListener("click",handleOutsideClick),window.tbHandleOutsideClick&&(window.tbHandleOutsideClick=null)},o=r=>{r.key==="Escape"&&s()};n.onclick=s,i.onclick=async()=>await _f(i,s),e.onclick=r=>{r.target===e&&s()},document.addEventListener("keydown",o),t.onclick=()=>{const r=document.getElementById("tb-list"),a=r.querySelectorAll(".tb-row").length;if(a<Ss){const l=Oc();r.appendChild(l),Es(t,a+1),l.scrollIntoView({behavior:"smooth"})}},Zf(e)}function Zf(e){let t=null;const n=i=>{t&&!t.contains(i.target)&&(t.querySelector(".tb-select-options").classList.add("hidden"),t=null);const s=document.getElementById("tb-color-picker"),o=i.target.closest(".tb-color-trigger"),r=s&&s.contains(i.target);!o&&!r&&s&&!s.classList.contains("hidden")&&vf()};setTimeout(()=>document.addEventListener("click",n),0),e.addEventListener("click",i=>{const s=i.target.closest(".tb-select-trigger");if(s){const a=s.closest(".tb-custom-select"),l=a.querySelector(".tb-select-options");document.querySelectorAll(".tb-select-options").forEach(c=>{c!==l&&c.classList.add("hidden")}),l.classList.toggle("hidden"),t=l.classList.contains("hidden")?null:a,i.stopPropagation();return}const o=i.target.closest(".tb-select-option");if(o){const a=o.closest(".tb-custom-select"),l=o.dataset.value;a.dataset.value=l,a.querySelector(".value-display").textContent=l,a.querySelectorAll(".tb-select-option").forEach(c=>{c.dataset.value===l?c.classList.add("bg-blue-50/50","font-bold"):c.classList.remove("bg-blue-50/50","font-bold")}),a.querySelector(".tb-select-options").classList.add("hidden"),t=null,i.stopPropagation();return}const r=i.target.closest(".tb-color-trigger");r&&(xf(r),i.stopPropagation())})}function Qf(e){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",n=>{n.stopPropagation(),cc()})}function tg(e,t=[]){const n=document.getElementById("project-list");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}e.forEach(i=>{const s=t.filter(r=>r.projectId===i.id&&!r.completed).length,o=di(i.name,"project",i.id,i.color,s);o.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},o.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation(),fr(r,"project",i)},ui(o,"project",i.id),n.appendChild(o)})}}function eg(e,t){let n=Ls(e,t);return ng(n,t.sortCriteria)}function Ls(e,t){const{keyword:n,projectId:i,labelId:s,showCompleted:o,timeBlockId:r,duration:a,savedFilter:l}=t;return e.filter(c=>{if(!o&&c.status==="completed")return!1;if(i){if(i==="unassigned"){if(c.projectId&&c.projectId!=="unassigned"&&c.projectId!=="null")return!1}else if(c.projectId!==i)return!1}if(s&&(!c.labelIds||!c.labelIds.includes(s)))return!1;if(r){if(r==="unassigned"){if(c.timeBlockId&&c.timeBlockId!=="null")return!1}else if(String(c.timeBlockId)!==String(r))return!1}if(a&&Number(c.duration)!==Number(a))return!1;if(n){const d=n.toLowerCase(),u=c.title.toLowerCase().includes(d),h=(c.description||"").toLowerCase().includes(d);if(!u&&!h)return!1}return!(l&&l.query&&!ig(c,l.query))})}function ng(e,t="createdAt_desc"){return[...e].sort((n,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(n.createdAt||0);case"createdAt_asc":return(n.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return n.dueDate?i.dueDate?n.dueDate-i.dueDate:-1:1;case"project_asc":return(n.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function ig(e,t){const n=sg(t);if(n.project&&n.project.length>0&&!n.project.includes(String(e.projectId||"")))return!1;if(n.timeblock&&n.timeblock.length>0){const i=!e.timeBlockId||e.timeBlockId==="null"?"none":String(e.timeBlockId);if(!n.timeblock.some(o=>o==="null"||o==="none"?i==="none"||i==="null"||!e.timeBlockId:o===i))return!1}if(n.duration&&n.duration.length>0&&!n.duration.includes(String(e.duration||"")))return!1;if(n.date&&n.date.length>0){if(!e.dueDate)return!1;const i=new Date(e.dueDate),s=new Date;if(s.setHours(0,0,0,0),!n.date.some(r=>{if(r==="today")return ha(i,s);if(r==="tomorrow"){const a=new Date(s);return a.setDate(a.getDate()+1),ha(i,a)}if(r==="week"){const a=new Date(s);a.setDate(s.getDate()-s.getDay());const l=new Date(a);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),i>=a&&i<=l}if(r==="next-week"){const a=new Date(s);a.setDate(s.getDate()-s.getDay()+7);const l=new Date(a);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),i>=a&&i<=l}return!1}))return!1}return!0}function sg(e){const t={};return e&&e.split(/\s+/).forEach(n=>{if(!n.includes(":"))return;const[i,s]=n.split(":");t[i]=s.split(",")}),t}function ha(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function og(){const e=document.getElementById("inbox-count");if(!e)return;const t=Dn(),n=bs(t,i=>!i.projectId||i.projectId==="null"||i.projectId==="unassigned");e.textContent=n,e.classList.toggle("hidden",n===0)}function rg(){if(!document.getElementById(B.LIST_IDS.PROJECTS))return;const t=hr(),n=Dn();tg(t,n)}function ag(){const e=document.getElementById(B.LIST_IDS.TIMEBLOCKS);if(!e)return;e.innerHTML="";const t=document.createDocumentFragment(),n=ue().sort((a,l)=>(a.order||0)-(l.order||0)),i=Dn(),s=En();n.forEach(a=>{const l=bs(i,u=>{const h=u.timeBlockId==="null"?null:u.timeBlockId,f=a.id;return h===f}),c=`${a.start} - ${a.end}`,d=di(c,"timeblock",a.id,{color:a.color},l,s);d.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:a.id}})),d.oncontextmenu=u=>{u.preventDefault(),Cc(a)},ui(d,"timeblock",a.id),t.appendChild(d)});const o=bs(i,a=>!a.timeBlockId||a.timeBlockId==="null"||a.timeBlockId==="unassigned"),r=di("未定","timeblock","unassigned",{color:"#a0aec0"},o,s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),ui(r,"timeblock","unassigned"),t.appendChild(r),e.appendChild(t)}function lg(){const e=document.getElementById(B.LIST_IDS.DURATIONS);if(!e)return;e.innerHTML="";const t=Dn(),n=En(),i=document.createDocumentFragment(),s='<span class="mr-3 text-sm">⏱️</span>';B.DURATIONS.forEach(o=>{const r=bs(t,l=>Number(l.duration)===o),a=di(`${o} min`,"duration",o.toString(),{iconHtml:s},r,n);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:o.toString()}})),ui(a,"duration",o.toString()),i.appendChild(a)}),e.appendChild(i)}function cg(){const e=document.getElementById(B.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const t=ic(),n=Dn(),i=En(),s=document.createDocumentFragment(),o='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';t.forEach(r=>{let a=0;try{typeof Ls=="function"&&(a=Ls(n,{savedFilter:r,showCompleted:!1}).length)}catch(c){console.warn("[Sidebar] Filter count error:",c)}const l=di(r.name,"filter",r.id,{iconHtml:o},a,i);l.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),l.oncontextmenu=c=>{c.preventDefault(),fr(c,"filter",r)},s.appendChild(l)}),e.appendChild(s)}function dg(){rg(),ag(),lg(),cg(),og()}function ug(e,t={}){const n=window.location.origin+window.location.pathname,i=new URLSearchParams(window.location.search);i.set("mode","window"),i.set("view",e),Object.entries(t).forEach(([d,u])=>{i.set(d,u)});const s=`${n}?${i.toString()}`,o=1200,r=800,a=(window.screen.width-o)/2,l=(window.screen.height-r)/2,c=`width=${o},height=${r},left=${a},top=${l},resizable=yes,scrollbars=yes`;window.open(s,`TaskMg_${e}_${Date.now()}`,c)}function hg(){return new URLSearchParams(window.location.search).get("mode")||"main"}function fg(){return new URLSearchParams(window.location.search).get("view")}function gg(){return hg()==="window"}let pn=null,Ni=null,Mt={};function fa(){Mt={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function pg(){if(fa(),!Mt.container)return;Mt.container.innerHTML=cf(),fa(),Yl(Mt.sidebar,Mt.resizer),bg(),df(),uf(),mg(),Mt.inbox&&ui(Mt.inbox,"inbox"),Qf(Mt.container),Ni&&window.removeEventListener("resize",Ni),Ni=()=>Fo(),window.addEventListener("resize",Ni),Fo();const e=En();xr(e),yg(),pn&&pn()}function mg(){const e=[gt.TIMEBLOCKS_UPDATED,gt.PROJECTS_UPDATED,gt.LABELS_UPDATED,gt.FILTERS_UPDATED,gt.TASKS_UPDATED];pn&&e.forEach(t=>document.removeEventListener(t,pn)),pn=()=>{dg();const t=En();xr(t)},e.forEach(t=>document.addEventListener(t,pn))}function bg(){var t,n;const e=(i,s=null)=>document.dispatchEvent(new CustomEvent(gt.ROUTE_CHANGE,{detail:{page:i,id:s}}));Mt.container.addEventListener("click",i=>{const s=i.target.closest("a"),o=i.target.closest("button");if(s){i.preventDefault();const r=s.id;r==="nav-dashboard"&&e("dashboard"),r==="nav-inbox"&&e("inbox"),r==="nav-search"&&e("search"),r==="nav-settings"&&zs(),r==="nav-wizard"&&e("wizard"),r==="nav-target-dashboard"&&e("target-dashboard"),r==="nav-wiki"&&e("wiki");return}if(o){const r=o.id;r==="add-filter-btn"&&lc(),r==="edit-timeblocks-btn"&&Cc()}}),Mt.container.addEventListener("contextmenu",i=>{const s=i.target.closest("a");if(!s)return;const o=s.id,r={"nav-wizard":"wizard","nav-target-dashboard":"target-dashboard","nav-wiki":"wiki","nav-dashboard":"dashboard"};r[o]&&Bh(i,[{label:"新しいウィンドウで開く",action:()=>ug(r[o])}])}),(t=Mt.openBtn)==null||t.addEventListener("click",()=>ga(!0)),(n=Mt.closeBtn)==null||n.addEventListener("click",()=>ga(!1))}function xr(e){const t=document.querySelectorAll(".sidebar-item-row"),n=Object.values(B.DENSITY_CLASSES),i=B.DENSITY_CLASSES[e]||B.DENSITY_CLASSES.normal;t.forEach(s=>{s.classList.remove(...n),s.classList.add(i)})}function ga(e){const{sidebar:t,resizer:n}=Mt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(t){if(t.classList.toggle(i,!e),t.classList.toggle(s,!e),or())if(n&&n.classList.toggle(s,!e),e){const o=localStorage.getItem(B.STORAGE_KEYS.WIDTH)||B.DEFAULT_WIDTH;t.style.width=`${o}px`}else t.style.width="0";Fo()}}function Fo(){const{sidebar:e,openBtn:t,closeBtn:n}=Mt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(!e||!t||!n)return;const o=e.classList.contains(i)||e.classList.contains(s);or()?(t.classList.toggle(s,!o),n.classList.toggle(s,o),o||e.classList.remove(s)):(t.classList.remove(s),n.classList.remove(s),e.classList.remove(s))}function yg(){window.addEventListener(gt.SIDEBAR_SETTINGS_UPDATED,e=>{xr(e.detail.density)})}const xg={FAVICON:"/images/favicon-96x96.png"},vg={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},Wn={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},vr={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view",WIZARD:"wizard-view",TARGET_DASHBOARD:"target-dashboard-view",WIKI:"wiki-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:ft,HEADER_IDS:pa,DATA_ATTRS:wg}=vr;function Ue(e,t){Array.isArray(t)&&t.forEach(n=>{var i,s;(i=n==null?void 0:n.classList)==null||i.add(ft.HIDDEN),(s=n==null?void 0:n.classList)==null||s.remove(ft.FADE_IN)}),e!=null&&e.classList&&(e.classList.remove(ft.HIDDEN),e.classList.add(ft.FADE_IN))}function Pc(){document.querySelectorAll(".sidebar-item-row").forEach(e=>{e.classList.remove(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]),e.classList.add(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]);const t=e.querySelector("svg, span:not(.truncate)");if(t){const n=Array.from(t.classList).filter(s=>s.startsWith("text-"));n.length>0&&t.classList.remove(...n);const i=e.getAttribute(wg.DEFAULT_COLOR);i&&t.classList.add(i)}})}function kg(e){Pc();const t=_g(e);if(t!=null&&t.classList){t.classList.remove(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]),t.classList.add(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]);const n=t.querySelector("svg, span:not(.truncate)");if(n){const i=Array.from(n.classList).filter(s=>s.startsWith("text-"));i.length>0&&n.classList.remove(...i),n.classList.add("text-white")}}}function _g(e){if(!e)return null;const{type:t,id:n}=e;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?Wn.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${n}"]`)}function Rc(e,t=[],n=[]){var c;const i=document.getElementById(pa.TITLE),s=document.getElementById(pa.COUNT);if(!i)return;let o="インボックス";const{type:r,id:a,name:l}=e;if(l)o=l;else switch(r){case Wn.PROJECT:o=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case Wn.LABEL:const d=n.find(u=>u.id===a);o=d?`ラベル: ${d.name}`:"ラベル";break;case Wn.TIMEBLOCK:if(a==="unassigned")o="時間帯: 未定";else{const u=rc(a);o=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case Wn.DURATION:o=`所要時間: ${a}分`;break;case"search":o="タスク検索";break;case"dashboard":o="ダッシュボード";break}i.textContent=o,s&&["dashboard","search"].includes(r)&&(s.textContent="")}function Sg(){const{VIEW_IDS:e}=vr;Object.values(e).forEach(n=>{const i=document.getElementById(n);n!==e.TASK&&i&&i.classList.add(ft.HIDDEN)});const t=document.getElementById(e.TASK);t&&(t.classList.remove(ft.HIDDEN),t.innerHTML=`
        <div id="login-container-wrapper" class="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in">
            <div id="login-form-container" class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
                    <p class="text-gray-500 dark:text-gray-400">タスク管理をはじめよう</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">メールアドレス</label>
                        <input id="email-input" type="email" placeholder="name@example.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">パスワード</label>
                        <input id="password-input" type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                </div>
                
                <button id="email-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-0.5 mb-6">
                    ログイン
                </button>

                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">または</span>
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600 text-center">
                     <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">アカウント登録なしで試す</p>
                    <button id="guest-login-btn" class="w-full bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center gap-2">
                        <span>🚀</span> ゲストとして利用する
                    </button>
                    <p class="text-xs text-gray-400 mt-2">※ゲストデータはローカルに保存されます</p>
                </div>
            </div>
            
            <!-- ユーザー情報表示用（ロジック互換性のため残す、実際はヘッダー等で管理推奨） -->
            <div id="user-info" class="hidden">
                 <span id="user-email-display"></span>
            </div>
        </div>
    `)}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Di(e){return e+.5|0}const _e=(e,t,n)=>Math.max(Math.min(e,n),t);function Vn(e){return _e(Di(e*2.55),0,255)}function Me(e){return _e(Di(e*255),0,255)}function ie(e){return _e(Di(e/2.55)/100,0,1)}function ma(e){return _e(Di(e*100),0,100)}const Rt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},$o=[..."0123456789ABCDEF"],Eg=e=>$o[e&15],Dg=e=>$o[(e&240)>>4]+$o[e&15],Fi=e=>(e&240)>>4===(e&15),Tg=e=>Fi(e.r)&&Fi(e.g)&&Fi(e.b)&&Fi(e.a);function Mg(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Rt[e[1]]*17,g:255&Rt[e[2]]*17,b:255&Rt[e[3]]*17,a:t===5?Rt[e[4]]*17:255}:(t===7||t===9)&&(n={r:Rt[e[1]]<<4|Rt[e[2]],g:Rt[e[3]]<<4|Rt[e[4]],b:Rt[e[5]]<<4|Rt[e[6]],a:t===9?Rt[e[7]]<<4|Rt[e[8]]:255})),n}const Ig=(e,t)=>e<255?t(e):"";function Ag(e){var t=Tg(e)?Eg:Dg;return e?"#"+t(e.r)+t(e.g)+t(e.b)+Ig(e.a,t):void 0}const Lg=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Bc(e,t,n){const i=t*Math.min(n,1-n),s=(o,r=(o+e/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[s(0),s(8),s(4)]}function Cg(e,t,n){const i=(s,o=(s+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function Og(e,t,n){const i=Bc(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function Pg(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}function wr(e){const n=e.r/255,i=e.g/255,s=e.b/255,o=Math.max(n,i,s),r=Math.min(n,i,s),a=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=a>.5?d/(2-o-r):d/(o+r),l=Pg(n,i,s,d,o),l=l*60+.5),[l|0,c||0,a]}function kr(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Me)}function _r(e,t,n){return kr(Bc,e,t,n)}function Rg(e,t,n){return kr(Og,e,t,n)}function Bg(e,t,n){return kr(Cg,e,t,n)}function Nc(e){return(e%360+360)%360}function Ng(e){const t=Lg.exec(e);let n=255,i;if(!t)return;t[5]!==i&&(n=t[6]?Vn(+t[5]):Me(+t[5]));const s=Nc(+t[2]),o=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=Rg(s,o,r):t[1]==="hsv"?i=Bg(s,o,r):i=_r(s,o,r),{r:i[0],g:i[1],b:i[2],a:n}}function Fg(e,t){var n=wr(e);n[0]=Nc(n[0]+t),n=_r(n),e.r=n[0],e.g=n[1],e.b=n[2]}function $g(e){if(!e)return;const t=wr(e),n=t[0],i=ma(t[1]),s=ma(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${s}%, ${ie(e.a)})`:`hsl(${n}, ${i}%, ${s}%)`}const ba={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ya={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Hg(){const e={},t=Object.keys(ya),n=Object.keys(ba);let i,s,o,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],s=0;s<n.length;s++)o=n[s],a=a.replace(o,ba[o]);o=parseInt(ya[r],16),e[a]=[o>>16&255,o>>8&255,o&255]}return e}let $i;function zg(e){$i||($i=Hg(),$i.transparent=[0,0,0,0]);const t=$i[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const jg=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Wg(e){const t=jg.exec(e);let n=255,i,s,o;if(t){if(t[7]!==i){const r=+t[7];n=t[8]?Vn(r):_e(r*255,0,255)}return i=+t[1],s=+t[3],o=+t[5],i=255&(t[2]?Vn(i):_e(i,0,255)),s=255&(t[4]?Vn(s):_e(s,0,255)),o=255&(t[6]?Vn(o):_e(o,0,255)),{r:i,g:s,b:o,a:n}}}function Vg(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${ie(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const fo=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,ln=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Ug(e,t,n){const i=ln(ie(e.r)),s=ln(ie(e.g)),o=ln(ie(e.b));return{r:Me(fo(i+n*(ln(ie(t.r))-i))),g:Me(fo(s+n*(ln(ie(t.g))-s))),b:Me(fo(o+n*(ln(ie(t.b))-o))),a:e.a+n*(t.a-e.a)}}function Hi(e,t,n){if(e){let i=wr(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,t===0?360:1)),i=_r(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function Fc(e,t){return e&&Object.assign(t||{},e)}function xa(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Me(e[3]))):(t=Fc(e,{r:0,g:0,b:0,a:1}),t.a=Me(t.a)),t}function Yg(e){return e.charAt(0)==="r"?Wg(e):Ng(e)}class hi{constructor(t){if(t instanceof hi)return t;const n=typeof t;let i;n==="object"?i=xa(t):n==="string"&&(i=Mg(t)||zg(t)||Yg(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Fc(this._rgb);return t&&(t.a=ie(t.a)),t}set rgb(t){this._rgb=xa(t)}rgbString(){return this._valid?Vg(this._rgb):void 0}hexString(){return this._valid?Ag(this._rgb):void 0}hslString(){return this._valid?$g(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,s=t.rgb;let o;const r=n===o?.5:n,a=2*r-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-c,i.r=255&c*i.r+o*s.r+.5,i.g=255&c*i.g+o*s.g+.5,i.b=255&c*i.b+o*s.b+.5,i.a=r*i.a+(1-r)*s.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=Ug(this._rgb,t._rgb,n)),this}clone(){return new hi(this.rgb)}alpha(t){return this._rgb.a=Me(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=Di(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Hi(this._rgb,2,t),this}darken(t){return Hi(this._rgb,2,-t),this}saturate(t){return Hi(this._rgb,1,t),this}desaturate(t){return Hi(this._rgb,1,-t),this}rotate(t){return Fg(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Qt(){}const qg=(()=>{let e=0;return()=>e++})();function N(e){return e==null}function it(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function $(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function at(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function Ot(e,t){return at(e)?e:t}function P(e,t){return typeof e>"u"?t:e}const Gg=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,$c=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Z(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function X(e,t,n,i){let s,o,r;if(it(e))for(o=e.length,s=0;s<o;s++)t.call(n,e[s],s);else if($(e))for(r=Object.keys(e),o=r.length,s=0;s<o;s++)t.call(n,e[r[s]],r[s])}function Cs(e,t){let n,i,s,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],o=t[n],s.datasetIndex!==o.datasetIndex||s.index!==o.index)return!1;return!0}function Os(e){if(it(e))return e.map(Os);if($(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=Os(e[n[s]]);return t}return e}function Hc(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function Xg(e,t,n,i){if(!Hc(e))return;const s=t[e],o=n[e];$(s)&&$(o)?fi(s,o,i):t[e]=Os(o)}function fi(e,t,n){const i=it(t)?t:[t],s=i.length;if(!$(e))return e;n=n||{};const o=n.merger||Xg;let r;for(let a=0;a<s;++a){if(r=i[a],!$(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],e,r,n)}return e}function oi(e,t){return fi(e,t,{merger:Kg})}function Kg(e,t,n){if(!Hc(e))return;const i=t[e],s=n[e];$(i)&&$(s)?oi(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Os(s))}const va={"":e=>e,x:e=>e.x,y:e=>e.y};function Jg(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}function Zg(e){const t=Jg(e);return n=>{for(const i of t){if(i==="")break;n=n&&n[i]}return n}}function Ie(e,t){return(va[t]||(va[t]=Zg(t)))(e)}function Sr(e){return e.charAt(0).toUpperCase()+e.slice(1)}const gi=e=>typeof e<"u",Ae=e=>typeof e=="function",wa=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function Qg(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const V=Math.PI,tt=2*V,tp=tt+V,Ps=Number.POSITIVE_INFINITY,ep=V/180,lt=V/2,He=V/4,ka=V*2/3,Se=Math.log10,Kt=Math.sign;function ri(e,t,n){return Math.abs(e-t)<n}function _a(e){const t=Math.round(e);e=ri(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(Se(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function np(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(n|0)&&t.push(n),t.sort((s,o)=>s-o).pop(),t}function ip(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function wn(e){return!ip(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function sp(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function zc(e,t,n){let i,s,o;for(i=0,s=e.length;i<s;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function Wt(e){return e*(V/180)}function Er(e){return e*(180/V)}function Sa(e){if(!at(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function jc(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*V&&(o+=tt),{angle:o,distance:s}}function Ho(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function op(e,t){return(e-t+tp)%tt-V}function wt(e){return(e%tt+tt)%tt}function pi(e,t,n,i){const s=wt(e),o=wt(t),r=wt(n),a=wt(o-s),l=wt(r-s),c=wt(s-o),d=wt(s-r);return s===o||s===r||i&&o===r||a>l&&c<d}function mt(e,t,n){return Math.max(t,Math.min(n,e))}function rp(e){return mt(e,-32768,32767)}function oe(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function Dr(e,t,n){n=n||(r=>e[r]<t);let i=e.length-1,s=0,o;for(;i-s>1;)o=s+i>>1,n(o)?s=o:i=o;return{lo:s,hi:i}}const re=(e,t,n,i)=>Dr(e,n,i?s=>{const o=e[s][t];return o<n||o===n&&e[s+1][t]===n}:s=>e[s][t]<n),ap=(e,t,n)=>Dr(e,n,i=>e[i][t]>=n);function lp(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}const Wc=["push","pop","shift","splice","unshift"];function cp(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Wc.forEach(n=>{const i="_onData"+Sr(n),s=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const r=s.apply(this,o);return e._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...o)}),r}})})}function Ea(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(Wc.forEach(o=>{delete e[o]}),delete e._chartjs)}function Vc(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const Uc=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function Yc(e,t){let n=[],i=!1;return function(...s){n=s,i||(i=!0,Uc.call(window,()=>{i=!1,e.apply(t,n)}))}}function dp(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}const Tr=e=>e==="start"?"left":e==="end"?"right":"center",vt=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,up=(e,t,n,i)=>e===(i?"left":"right")?n:e==="center"?(t+n)/2:t;function qc(e,t,n){const i=t.length;let s=0,o=i;if(e._sorted){const{iScale:r,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=r.axis,{min:u,max:h,minDefined:f,maxDefined:g}=r.getUserBounds();if(f){if(s=Math.min(re(l,d,u).lo,n?i:re(t,d,r.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!N(m[a.axis]));s-=Math.max(0,p)}s=mt(s,0,i-1)}if(g){let p=Math.max(re(l,r.axis,h,!0).hi+1,n?0:re(t,d,r.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!N(b[a.axis]));p+=Math.max(0,m)}o=mt(p,s,i)-s}else o=i-s}return{start:s,count:o}}function Gc(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),o}const zi=e=>e===0||e===1,Da=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*tt/n)),Ta=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*tt/n)+1,ai={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*lt)+1,easeOutSine:e=>Math.sin(e*lt),easeInOutSine:e=>-.5*(Math.cos(V*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>zi(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>zi(e)?e:Da(e,.075,.3),easeOutElastic:e=>zi(e)?e:Ta(e,.075,.3),easeInOutElastic(e){return zi(e)?e:e<.5?.5*Da(e*2,.1125,.45):.5+.5*Ta(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-ai.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?ai.easeInBounce(e*2)*.5:ai.easeOutBounce(e*2-1)*.5+.5};function Mr(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Ma(e){return Mr(e)?e:new hi(e)}function go(e){return Mr(e)?e:new hi(e).saturate(.5).darken(.1).hexString()}const hp=["x","y","borderWidth","radius","tension"],fp=["color","borderColor","backgroundColor"];function gp(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:fp},numbers:{type:"number",properties:hp}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function pp(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Ia=new Map;function mp(e,t){t=t||{};const n=e+JSON.stringify(t);let i=Ia.get(n);return i||(i=new Intl.NumberFormat(e,t),Ia.set(n,i)),i}function Ti(e,t,n){return mp(t,n).format(e)}const Xc={values(e){return it(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const i=this.chart.options.locale;let s,o=e;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),o=bp(e,n)}const r=Se(Math.abs(o)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Ti(e,i,l)},logarithmic(e,t,n){if(e===0)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(Se(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?Xc.numeric.call(this,e,t,n):""}};function bp(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var Ws={formatters:Xc};function yp(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ws.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Qe=Object.create(null),zo=Object.create(null);function li(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const o=n[i];e=e[o]||(e[o]=Object.create(null))}return e}function po(e,t,n){return typeof t=="string"?fi(li(e,t),n):fi(li(e,""),t)}class xp{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>go(s.backgroundColor),this.hoverBorderColor=(i,s)=>go(s.borderColor),this.hoverColor=(i,s)=>go(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return po(this,t,n)}get(t){return li(this,t)}describe(t,n){return po(zo,t,n)}override(t,n){return po(Qe,t,n)}route(t,n,i,s){const o=li(this,t),r=li(this,i),a="_"+n;Object.defineProperties(o,{[a]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=r[s];return $(l)?Object.assign({},c,l):P(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(n=>n(this))}}var st=new xp({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[gp,pp,yp]);function vp(e){return!e||N(e.size)||N(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function Rs(e,t,n,i,s){let o=t[s];return o||(o=t[s]=e.measureText(s).width,n.push(s)),o>i&&(i=o),i}function wp(e,t,n,i){i=i||{};let s=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},o=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let r=0;const a=n.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=n[l],u!=null&&!it(u))r=Rs(e,s,o,r,u);else if(it(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!it(h)&&(r=Rs(e,s,o,r,h));e.restore();const f=o.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[o[l]];o.splice(0,f)}return r}function ze(e,t,n){const i=e.currentDevicePixelRatio,s=n!==0?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function Aa(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function jo(e,t,n,i){Kc(e,t,n,i,null)}function Kc(e,t,n,i,s){let o,r,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*ep;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,i),e.rotate(m),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!(isNaN(p)||p<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,p,0,0,tt):e.arc(n,i,p,0,tt),e.closePath();break;case"triangle":d=s?s/2:p,e.moveTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=ka,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=ka,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),e.closePath();break;case"rectRounded":c=p*.516,l=p-c,r=Math.cos(m+He)*l,u=Math.cos(m+He)*(s?s/2-c:l),a=Math.sin(m+He)*l,h=Math.sin(m+He)*(s?s/2-c:l),e.arc(n-u,i-a,c,m-V,m-lt),e.arc(n+h,i-r,c,m-lt,m),e.arc(n+u,i+a,c,m,m+lt),e.arc(n-h,i+r,c,m+lt,m+V),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,e.rect(n-d,i-l,2*d,2*l);break}m+=He;case"rectRot":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+h,i-r),e.lineTo(n+u,i+a),e.lineTo(n-h,i+r),e.closePath();break;case"crossRot":m+=He;case"cross":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"star":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r),m+=He,u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"line":r=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,e.moveTo(n-r,i-a),e.lineTo(n+r,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function ae(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function Vs(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function Us(e){e.restore()}function kp(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if(s==="middle"){const o=(t.x+n.x)/2;e.lineTo(o,t.y),e.lineTo(o,n.y)}else s==="after"!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function _p(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function Sp(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),N(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function Ep(e,t,n,i,s){if(s.strikethrough||s.underline){const o=e.measureText(i),r=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(r,d),e.lineTo(a,d),e.stroke()}}function Dp(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function tn(e,t,n,i,s,o={}){const r=it(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(e.save(),e.font=s.string,Sp(e,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&Dp(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),N(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),Ep(e,n,i,c,o),i+=Number(s.lineHeight);e.restore()}function mi(e,t){const{x:n,y:i,w:s,h:o,radius:r}=t;e.arc(n+r.topLeft,i+r.topLeft,r.topLeft,1.5*V,V,!0),e.lineTo(n,i+o-r.bottomLeft),e.arc(n+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,V,lt,!0),e.lineTo(n+s-r.bottomRight,i+o),e.arc(n+s-r.bottomRight,i+o-r.bottomRight,r.bottomRight,lt,0,!0),e.lineTo(n+s,i+r.topRight),e.arc(n+s-r.topRight,i+r.topRight,r.topRight,0,-lt,!0),e.lineTo(n+r.topLeft,i)}const Tp=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Mp=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Ip(e,t){const n=(""+e).match(Tp);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const Ap=e=>+e||0;function Ir(e,t){const n={},i=$(t),s=i?Object.keys(t):t,o=$(e)?i?r=>P(e[r],e[t[r]]):r=>e[r]:()=>e;for(const r of s)n[r]=Ap(o(r));return n}function Jc(e){return Ir(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Ke(e){return Ir(e,["topLeft","topRight","bottomLeft","bottomRight"])}function _t(e){const t=Jc(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function ut(e,t){e=e||{},t=t||st.font;let n=P(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let i=P(e.style,t.style);i&&!(""+i).match(Mp)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:P(e.family,t.family),lineHeight:Ip(P(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:P(e.weight,t.weight),string:""};return s.string=vp(s),s}function Un(e,t,n,i){let s,o,r;for(s=0,o=e.length;s<o;++s)if(r=e[s],r!==void 0&&r!==void 0)return r}function Lp(e,t,n){const{min:i,max:s}=e,o=$c(t,(s-i)/2),r=(a,l)=>n&&a===0?0:a+l;return{min:r(i,-Math.abs(o)),max:r(s,o)}}function Ce(e,t){return Object.assign(Object.create(e),t)}function Ar(e,t=[""],n,i,s=()=>e[0]){const o=n||e;typeof i>"u"&&(i=ed("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:i,_getTarget:s,override:a=>Ar([a,...e],t,o,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete a._keys,delete e[0][l],!0},get(a,l){return Qc(a,l,()=>$p(l,t,e,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(a,l){return Ca(a).includes(l)},ownKeys(a){return Ca(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function kn(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:Zc(e,i),setContext:o=>kn(e,o,n,i),override:o=>kn(e.override(o),t,n,i)};return new Proxy(s,{deleteProperty(o,r){return delete o[r],delete e[r],!0},get(o,r,a){return Qc(o,r,()=>Op(o,r,a))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(e,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,r)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,r){return Reflect.has(e,r)},ownKeys(){return Reflect.ownKeys(e)},set(o,r,a){return e[r]=a,delete o[r],!0}})}function Zc(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:Ae(n)?n:()=>n,isIndexable:Ae(i)?i:()=>i}}const Cp=(e,t)=>e?e+Sr(t):t,Lr=(e,t)=>$(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Qc(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const i=n();return e[t]=i,i}function Op(e,t,n){const{_proxy:i,_context:s,_subProxy:o,_descriptors:r}=e;let a=i[t];return Ae(a)&&r.isScriptable(t)&&(a=Pp(t,a,e,n)),it(a)&&a.length&&(a=Rp(t,a,e,r.isIndexable)),Lr(t,a)&&(a=kn(a,s,o&&o[t],r)),a}function Pp(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,r||i);return a.delete(e),Lr(e,l)&&(l=Cr(s._scopes,s,e,l)),l}function Rp(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_descriptors:a}=n;if(typeof o.index<"u"&&i(e))return t[o.index%t.length];if($(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=Cr(c,s,e,d);t.push(kn(u,o,r&&r[e],a))}}return t}function td(e,t,n){return Ae(e)?e(t,n):e}const Bp=(e,t)=>e===!0?t:typeof e=="string"?Ie(t,e):void 0;function Np(e,t,n,i,s){for(const o of t){const r=Bp(n,o);if(r){e.add(r);const a=td(r._fallback,n,s);if(typeof a<"u"&&a!==n&&a!==i)return a}else if(r===!1&&typeof i<"u"&&n!==i)return null}return!1}function Cr(e,t,n,i){const s=t._rootScopes,o=td(t._fallback,n,i),r=[...e,...s],a=new Set;a.add(i);let l=La(a,r,n,o||n,i);return l===null||typeof o<"u"&&o!==n&&(l=La(a,r,o,l,i),l===null)?!1:Ar(Array.from(a),[""],s,o,()=>Fp(t,n,i))}function La(e,t,n,i,s){for(;n;)n=Np(e,t,n,i,s);return n}function Fp(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];return it(s)&&$(n)?n:s||{}}function $p(e,t,n,i){let s;for(const o of t)if(s=ed(Cp(o,e),n),typeof s<"u")return Lr(e,s)?Cr(n,i,e,s):s}function ed(e,t){for(const n of t){if(!n)continue;const i=n[e];if(typeof i<"u")return i}}function Ca(e){let t=e._keys;return t||(t=e._keys=Hp(e._scopes)),t}function Hp(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function nd(e,t,n,i){const{iScale:s}=e,{key:o="r"}=this._parsing,r=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+n,d=t[c],r[a]={r:s.parse(Ie(d,o),c)};return r}const zp=Number.EPSILON||1e-14,_n=(e,t)=>t<e.length&&!e[t].skip&&e[t],id=e=>e==="x"?"y":"x";function jp(e,t,n,i){const s=e.skip?t:e,o=t,r=n.skip?t:n,a=Ho(o,s),l=Ho(r,o);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:o.x-u*(r.x-s.x),y:o.y-u*(r.y-s.y)},next:{x:o.x+h*(r.x-s.x),y:o.y+h*(r.y-s.y)}}}function Wp(e,t,n){const i=e.length;let s,o,r,a,l,c=_n(e,0);for(let d=0;d<i-1;++d)if(l=c,c=_n(e,d+1),!(!l||!c)){if(ri(t[d],0,zp)){n[d]=n[d+1]=0;continue}s=n[d]/t[d],o=n[d+1]/t[d],a=Math.pow(s,2)+Math.pow(o,2),!(a<=9)&&(r=3/Math.sqrt(a),n[d]=s*r*t[d],n[d+1]=o*r*t[d])}}function Vp(e,t,n="x"){const i=id(n),s=e.length;let o,r,a,l=_n(e,0);for(let c=0;c<s;++c){if(r=a,a=l,l=_n(e,c+1),!a)continue;const d=a[n],u=a[i];r&&(o=(d-r[n])/3,a[`cp1${n}`]=d-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-d)/3,a[`cp2${n}`]=d+o,a[`cp2${i}`]=u+o*t[c])}}function Up(e,t="x"){const n=id(t),i=e.length,s=Array(i).fill(0),o=Array(i);let r,a,l,c=_n(e,0);for(r=0;r<i;++r)if(a=l,l=c,c=_n(e,r+1),!!l){if(c){const d=c[t]-l[t];s[r]=d!==0?(c[n]-l[n])/d:0}o[r]=a?c?Kt(s[r-1])!==Kt(s[r])?0:(s[r-1]+s[r])/2:s[r-1]:s[r]}Wp(e,s,o),Vp(e,o,t)}function ji(e,t,n){return Math.max(Math.min(e,n),t)}function Yp(e,t){let n,i,s,o,r,a=ae(e[0],t);for(n=0,i=e.length;n<i;++n)r=o,o=a,a=n<i-1&&ae(e[n+1],t),o&&(s=e[n],r&&(s.cp1x=ji(s.cp1x,t.left,t.right),s.cp1y=ji(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=ji(s.cp2x,t.left,t.right),s.cp2y=ji(s.cp2y,t.top,t.bottom)))}function qp(e,t,n,i,s){let o,r,a,l;if(t.spanGaps&&(e=e.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")Up(e,s);else{let c=i?e[e.length-1]:e[0];for(o=0,r=e.length;o<r;++o)a=e[o],l=jp(c,a,e[Math.min(o+1,r-(i?0:1))%r],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&Yp(e,n)}function Or(){return typeof window<"u"&&typeof document<"u"}function Pr(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Bs(e,t,n){let i;return typeof e=="string"?(i=parseInt(e,10),e.indexOf("%")!==-1&&(i=i/100*t.parentNode[n])):i=e,i}const Ys=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function Gp(e,t){return Ys(e).getPropertyValue(t)}const Xp=["top","right","bottom","left"];function Je(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const o=Xp[s];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const Kp=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function Jp(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:o}=i;let r=!1,a,l;if(Kp(s,o,e.target))a=s,l=o;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:a,y:l,box:r}}function Ye(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=Ys(n),o=s.boxSizing==="border-box",r=Je(s,"padding"),a=Je(s,"border","width"),{x:l,y:c,box:d}=Jp(e,n),u=r.left+(d&&a.left),h=r.top+(d&&a.top);let{width:f,height:g}=t;return o&&(f-=r.width+a.width,g-=r.height+a.height),{x:Math.round((l-u)/f*n.width/i),y:Math.round((c-h)/g*n.height/i)}}function Zp(e,t,n){let i,s;if(t===void 0||n===void 0){const o=e&&Pr(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const r=o.getBoundingClientRect(),a=Ys(o),l=Je(a,"border","width"),c=Je(a,"padding");t=r.width-c.width-l.width,n=r.height-c.height-l.height,i=Bs(a.maxWidth,o,"clientWidth"),s=Bs(a.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:i||Ps,maxHeight:s||Ps}}const Ee=e=>Math.round(e*10)/10;function Qp(e,t,n,i){const s=Ys(e),o=Je(s,"margin"),r=Bs(s.maxWidth,e,"clientWidth")||Ps,a=Bs(s.maxHeight,e,"clientHeight")||Ps,l=Zp(e,t,n);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=Je(s,"border","width"),f=Je(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=Ee(Math.min(c,r,l.maxWidth)),d=Ee(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Ee(c/2)),(t!==void 0||n!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Ee(Math.floor(d*i))),{width:c,height:d}}function Oa(e,t,n){const i=t||1,s=Ee(e.height*i),o=Ee(e.width*i);e.height=Ee(e.height),e.width=Ee(e.width);const r=e.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${e.height}px`,r.style.width=`${e.width}px`),e.currentDevicePixelRatio!==i||r.height!==s||r.width!==o?(e.currentDevicePixelRatio=i,r.height=s,r.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0):!1}const tm=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};Or()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function Pa(e,t){const n=Gp(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function qe(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function em(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:i==="middle"?n<.5?e.y:t.y:i==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function nm(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},r=qe(e,s,n),a=qe(s,o,n),l=qe(o,t,n),c=qe(r,a,n),d=qe(a,l,n);return qe(c,d,n)}const im=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,i){return n-i},leftForLtr(n,i){return n-i}}},sm=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function yn(e,t,n){return e?im(t,n):sm()}function sd(e,t){let n,i;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function od(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function rd(e){return e==="angle"?{between:pi,compare:op,normalize:wt}:{between:oe,compare:(t,n)=>t-n,normalize:t=>t}}function Ra({start:e,end:t,count:n,loop:i,style:s}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n===0,style:s}}function om(e,t,n){const{property:i,start:s,end:o}=n,{between:r,normalize:a}=rd(i),l=t.length;let{start:c,end:d,loop:u}=e,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(a(t[c%l][i]),s,o);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:e.style}}function ad(e,t,n){if(!n)return[e];const{property:i,start:s,end:o}=n,r=t.length,{compare:a,between:l,normalize:c}=rd(i),{start:d,end:u,loop:h,style:f}=om(e,t,n),g=[];let p=!1,m=null,b,y,v;const w=()=>l(s,v,b)&&a(s,v)!==0,x=()=>a(o,b)===0||l(o,v,b),_=()=>p||w(),k=()=>!p||x();for(let S=d,M=d;S<=u;++S)y=t[S%r],!y.skip&&(b=c(y[i]),b!==v&&(p=l(b,s,o),m===null&&_()&&(m=a(b,s)===0?S:M),m!==null&&k()&&(g.push(Ra({start:m,end:S,loop:h,count:r,style:f})),m=null),M=S,v=b));return m!==null&&g.push(Ra({start:m,end:u,loop:h,count:r,style:f})),g}function ld(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const o=ad(i[s],e.points,t);o.length&&n.push(...o)}return n}function rm(e,t,n,i){let s=0,o=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(o+=s);o>s&&e[o%t].skip;)o--;return o%=t,{start:s,end:o}}function am(e,t,n,i){const s=e.length,o=[];let r=t,a=e[t],l;for(l=t+1;l<=n;++l){const c=e[l%s];c.skip||c.stop?a.skip||(i=!1,o.push({start:t%s,end:(l-1)%s,loop:i}),t=r=c.stop?l:null):(r=l,a.skip&&(t=l)),a=c}return r!==null&&o.push({start:t%s,end:r%s,loop:i}),o}function lm(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const o=!!e._loop,{start:r,end:a}=rm(n,s,o,i);if(i===!0)return Ba(e,[{start:r,end:a,loop:o}],n,t);const l=a<r?a+s:a,c=!!e._fullLoop&&r===0&&a===s-1;return Ba(e,am(n,r,l,c),n,t)}function Ba(e,t,n,i){return!i||!i.setContext||!n?t:cm(e,t,n,i)}function cm(e,t,n,i){const s=e._chart.getContext(),o=Na(e.options),{_datasetIndex:r,options:{spanGaps:a}}=e,l=n.length,c=[];let d=o,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;n[g%l].skip;)g-=y;for(;n[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=n[u%l],m;for(h=u+1;h<=g.end;h++){const b=n[h%l];m=Na(i.setContext(Ce(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),dm(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Na(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function dm(e,t){if(!t)return!1;const n=[],i=function(s,o){return Mr(o)?(n.includes(o)||n.push(o),n.indexOf(o)):o};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function Wi(e,t,n){return e.options.clip?e[n]:t[n]}function um(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:Wi(n,t,"left"),right:Wi(n,t,"right"),top:Wi(i,t,"top"),bottom:Wi(i,t,"bottom")}:t}function cd(e,t){const n=t._clip;if(n.disabled)return!1;const i=um(t,e.chartArea);return{left:n.left===!1?0:i.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:i.right+(n.right===!0?0:n.right),top:n.top===!1?0:i.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:i.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class hm{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,s){const o=n.listeners[s],r=n.duration;o.forEach(a=>a({chart:t,initial:n.initial,numSteps:r,currentStep:Math.min(i-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=Uc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,a=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(o[r]=o[o.length-1],o.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),o.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var te=new hm;const Fa="transparent",fm={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const i=Ma(e||Fa),s=i.valid&&Ma(t||Fa);return s&&s.valid?s.mix(i,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class gm{constructor(t,n,i,s){const o=n[i];s=Un([t.to,s,o,t.from]);const r=Un([t.from,o,s]);this._active=!0,this._fn=t.fn||fm[t.type||typeof r],this._easing=ai[t.easing]||ai.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=r,this._to=s,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const s=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=Un([t.to,n,s,t.from]),this._from=Un([t.from,s,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,s=this._prop,o=this._from,r=this._loop,a=this._to;let l;if(this._active=o!==a&&(r||n<i),!this._active){this._target[s]=a,this._notify(!0);return}if(n<0){this._target[s]=o;return}l=n/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(o,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][n]()}}class dd{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!$(t))return;const n=Object.keys(st.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const o=t[s];if(!$(o))return;const r={};for(const a of n)r[a]=o[a];(it(o.properties)&&o.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,n){const i=n.options,s=mm(t,i);if(!s)return[];const o=this._createAnimations(s,i);return i.$shared&&pm(t.options.$animations,i).then(()=>{t.options=i},()=>{}),o}_createAnimations(t,n){const i=this._properties,s=[],o=t.$animations||(t.$animations={}),r=Object.keys(n),a=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,n));continue}const d=n[c];let u=o[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}o[c]=u=new gm(h,t,c,d),s.push(u)}return s}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const i=this._createAnimations(t,n);if(i.length)return te.add(this._chart,i),!0}}function pm(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const o=e[i[s]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function mm(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function $a(e,t){const n=e&&e.options||{},i=n.reverse,s=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:i?o:s,end:i?s:o}}function bm(e,t,n){if(n===!1)return!1;const i=$a(e,n),s=$a(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function ym(e){let t,n,i,s;return $(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:e===!1}}function ud(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,o;for(s=0,o=i.length;s<o;++s)n.push(i[s].index);return n}function Ha(e,t,n,i={}){const s=e.keys,o=i.mode==="single";let r,a,l,c;if(t===null)return;let d=!1;for(r=0,a=s.length;r<a;++r){if(l=+s[r],l===n){if(d=!0,i.all)continue;break}c=e.values[l],at(c)&&(o||t===0||Kt(t)===Kt(c))&&(t+=c)}return!d&&!i.all?0:t}function xm(e,t){const{iScale:n,vScale:i}=t,s=n.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(e),a=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],a[l]={[s]:d,[o]:e[d]};return a}function mo(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function vm(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function wm(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}function km(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function za(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const o=e[s.index];if(n&&o>0||!n&&o<0)return s.index}return null}function ja(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:o,vScale:r,index:a}=i,l=o.axis,c=r.axis,d=vm(o,r,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=km(s,d,p),h[a]=m,h._top=za(h,r,!0,i.type),h._bottom=za(h,r,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function bo(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function _m(e,t){return Ce(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function Sm(e,t,n){return Ce(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function Cn(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const s of t){const o=s._stacks;if(!o||o[i]===void 0||o[i][n]===void 0)return;delete o[i][n],o[i]._visualValues!==void 0&&o[i]._visualValues[n]!==void 0&&delete o[i]._visualValues[n]}}}const yo=e=>e==="reset"||e==="none",Wa=(e,t)=>t?e:Object.assign({},e),Em=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:ud(n,!0),values:null};class Vt{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=mo(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&Cn(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,o=n.xAxisID=P(i.xAxisID,bo(t,"x")),r=n.yAxisID=P(i.yAxisID,bo(t,"y")),a=n.rAxisID=P(i.rAxisID,bo(t,"r")),l=n.indexAxis,c=n.iAxisID=s(l,o,r,a),d=n.vAxisID=s(l,r,o,a);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Ea(this._data,this),t._stacked&&Cn(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if($(n)){const s=this._cachedMeta;this._data=xm(n,s)}else if(i!==n){if(i){Ea(i,this);const s=this._cachedMeta;Cn(s),s._parsed=[]}n&&Object.isExtensible(n)&&cp(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const o=n._stacked;n._stacked=mo(n.vScale,n),n.stack!==i.stack&&(s=!0,Cn(n),n.stack=i.stack),this._resyncElements(t),(s||o!==n._stacked)&&(ja(this,n._parsed),n._stacked=mo(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:i,_data:s}=this,{iScale:o,_stacked:r}=i,a=o.axis;let l=t===0&&n===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{it(s[t])?h=this.parseArrayData(i,s,t,n):$(s[t])?h=this.parseObjectData(i,s,t,n):h=this.parsePrimitiveData(i,s,t,n);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<n;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}r&&ja(this,h)}parsePrimitiveData(t,n,i,s){const{iScale:o,vScale:r}=t,a=o.axis,l=r.axis,c=o.getLabels(),d=o===r,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||o.parse(c[g],g),[l]:r.parse(n[g],g)};return u}parseArrayData(t,n,i,s){const{xScale:o,yScale:r}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=n[d],a[l]={x:o.parse(u[0],d),y:r.parse(u[1],d)};return a}parseObjectData(t,n,i,s){const{xScale:o,yScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=n[h],c[d]={x:o.parse(Ie(f,a),h),y:r.parse(Ie(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){const s=this.chart,o=this._cachedMeta,r=n[t.axis],a={keys:ud(s,!0),values:n._stacks[t.axis]._visualValues};return Ha(a,r,o.index,{mode:i})}updateRangeFromParsed(t,n,i,s){const o=i[n.axis];let r=o===null?NaN:o;const a=s&&i._stacks[n.axis];s&&a&&(s.values=a,r=Ha(s,o,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,n){const i=this._cachedMeta,s=i._parsed,o=i._sorted&&t===i.iScale,r=s.length,a=this._getOtherScale(t),l=Em(n,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=wm(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!at(f[t.axis])||d>p||u<p}for(h=0;h<r&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),o));++h);if(o){for(h=r-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const n=this._cachedMeta._parsed,i=[];let s,o,r;for(s=0,o=n.length;s<o;++s)r=n[s][t.axis],at(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,i=n.iScale,s=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:s?""+s.getLabelForValue(o[s.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=ym(P(this.options.clip,bm(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,i=this._cachedMeta,s=i.data||[],o=n.chartArea,r=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,o,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?r.push(u):u.draw(t,o))}for(d=0;d<r.length;++d)r[d].draw(t,o)}getStyle(t,n){const i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){const s=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];o=r.$context||(r.$context=Sm(this.getContext(),t,r)),o.parsed=this.getParsed(t),o.raw=s.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=_m(this.chart.getContext(),this.index)),o.dataset=s,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){const s=n==="active",o=this._cachedDataOpts,r=t+"-"+n,a=o[r],l=this.enableOptionSharing&&gi(i);if(a)return Wa(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(st.elements[t]),g=()=>this.getContext(i,s,n),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,o[r]=Object.freeze(Wa(p,l))),p}_resolveAnimations(t,n,i){const s=this.chart,o=this._cachedDataOpts,r=`animation-${n}`,a=o[r];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,n))}const c=new dd(s,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||yo(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const i=this.resolveDataElementOptions(t,n),s=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(n,o)||o!==s;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:r}}updateElement(t,n,i,s){yo(s)?Object.assign(t,i):this._resolveAnimations(n,s).update(t,i)}updateSharedOptions(t,n,i){t&&!yo(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,s){t.active=s;const o=this.getStyle(n,s);this._resolveAnimations(n,i,s).update(t,{options:!s&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,o=n.length,r=Math.min(o,s);r&&this.parse(0,r),o>s?this._insertElements(s,o-s,t):o<s&&this._removeElements(o,s-o)}_insertElements(t,n,i=!0){const s=this._cachedMeta,o=s.data,r=t+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=r;a--)c[a]=c[a-n]};for(l(o),a=t;a<r;++a)o[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,s){}_removeElements(t,n){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,n);i._stacked&&Cn(i,s)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,i,s]=t;this[n](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}D(Vt,"defaults",{}),D(Vt,"datasetElementType",null),D(Vt,"dataElementType",null);function Dm(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let s=0,o=n.length;s<o;s++)i=i.concat(n[s].controller.getAllParsedValues(e));e._cache.$bar=Vc(i.sort((s,o)=>s-o))}return e._cache.$bar}function Tm(e){const t=e.iScale,n=Dm(t,e.type);let i=t._length,s,o,r,a;const l=()=>{r===32767||r===-32768||(gi(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(s=0,o=n.length;s<o;++s)r=t.getPixelForValue(n[s]),l();for(a=void 0,s=0,o=t.ticks.length;s<o;++s)r=t.getPixelForTick(s),l();return i}function Mm(e,t,n,i){const s=n.barThickness;let o,r;return N(s)?(o=t.min*n.categoryPercentage,r=n.barPercentage):(o=s*i,r=1),{chunk:o/i,ratio:r,start:t.pixels[e]-o/2}}function Im(e,t,n,i){const s=t.pixels,o=s[e];let r=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;r===null&&(r=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-r);const c=o-(o-Math.min(r,a))/2*l;return{chunk:Math.abs(a-r)/2*l/i,ratio:n.barPercentage,start:c}}function Am(e,t,n,i){const s=n.parse(e[0],i),o=n.parse(e[1],i),r=Math.min(s,o),a=Math.max(s,o);let l=r,c=a;Math.abs(r)>Math.abs(a)&&(l=a,c=r),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:o,min:r,max:a}}function hd(e,t,n,i){return it(e)?Am(e,t,n,i):t[n.axis]=n.parse(e,i),t}function Va(e,t,n,i){const s=e.iScale,o=e.vScale,r=s.getLabels(),a=s===o,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(r[c],c),l.push(hd(h,u,o,c));return l}function xo(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function Lm(e,t,n){return e!==0?Kt(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function Cm(e){let t,n,i,s,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",o="start"):(s="start",o="end"),{start:n,end:i,reverse:t,top:s,bottom:o}}function Om(e,t,n,i){let s=t.borderSkipped;const o={};if(!s){e.borderSkipped=o;return}if(s===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:l,top:c,bottom:d}=Cm(e);s==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=d:(o[Ua(d,r,a,l)]=!0,s=c)),o[Ua(s,r,a,l)]=!0,e.borderSkipped=o}function Ua(e,t,n,i){return i?(e=Pm(e,t,n),e=Ya(e,n,t)):e=Ya(e,t,n),e}function Pm(e,t,n){return e===t?n:e===n?t:e}function Ya(e,t,n){return e==="start"?t:e==="end"?n:e}function Rm(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class as extends Vt{parsePrimitiveData(t,n,i,s){return Va(t,n,i,s)}parseArrayData(t,n,i,s){return Va(t,n,i,s)}parseObjectData(t,n,i,s){const{iScale:o,vScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?a:l,d=r.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=n[h],g={},g[o.axis]=o.parse(Ie(p,c),h),u.push(hd(Ie(p,d),g,r,h));return u}updateRangeFromParsed(t,n,i,s){super.updateRangeFromParsed(t,n,i,s);const o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:i,vScale:s}=n,o=this.getParsed(t),r=o._custom,a=xo(r)?"["+r.start+", "+r.end+"]":""+s.getLabelForValue(o[s.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,s){const o=s==="reset",{index:r,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,s);for(let f=n;f<n+i;f++){const g=this.getParsed(f),p=o||N(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||xo(g._custom)||r===b._top||r===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const v=y.options||t[f].options;Om(y,v,b,r),Rm(y,v,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,n){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(n),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(N(h)||isNaN(h))return!0};for(const d of s)if(!(n!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[P(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,i){const s=this._getStacks(t,i),o=n!==void 0?s.indexOf(n):-1;return o===-1?s.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,i=n.iScale,s=[];let o,r;for(o=0,r=n.data.length;o<r;++o)s.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const a=t.barThickness;return{min:a||Tm(n),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:i,index:s},options:{base:o,minBarLength:r}}=this,a=o||0,l=this.getParsed(t),c=l._custom,d=xo(c);let u=l[n.axis],h=0,f=i?this.applyStack(n,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Kt(u)!==Kt(c.barEnd)&&(h=0),h+=u);const m=!N(o)&&!d?o:h;let b=n.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=n.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<r){p=Lm(p,n,a)*r,u===a&&(b-=p/2);const y=n.getPixelForDecimal(0),v=n.getPixelForDecimal(1),w=Math.min(y,v),x=Math.max(y,v);b=Math.max(Math.min(b,x),w),g=b+p,i&&!d&&(l._stacks[n.axis]._visualValues[s]=n.getValueForPixel(g)-n.getValueForPixel(b))}if(b===n.getPixelForValue(a)){const y=Kt(p)*n.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,n){const i=n.scale,s=this.options,o=s.skipNull,r=P(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(n.grouped){const d=o?this._getStackCount(t):n.stackCount,u=s.barThickness==="flex"?Im(t,n,s,d*c):Mm(t,n,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(P(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(r,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(r,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,i=t.data,s=i.length;let o=0;for(;o<s;++o)this.getParsed(o)[n.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}D(as,"id","bar"),D(as,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),D(as,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class ls extends Vt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,s){const o=super.parsePrimitiveData(t,n,i,s);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(t,n,i,s){const o=super.parseArrayData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(t,n,i,s){const o=super.parseObjectData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,s),d=r.axis,u=a.axis;for(let h=n;h<n+i;h++){const f=t[h],g=!o&&this.getParsed(h),p={},m=p[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(g[d]),b=p[u]=o?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),o&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,n){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,n);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const o=s.radius;return n!=="active"&&(s.radius=0),s.radius+=P(i&&i._custom,o),s}}D(ls,"id","bubble"),D(ls,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),D(ls,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Bm(e,t,n){let i=1,s=1,o=0,r=0;if(t<tt){const a=e,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(v,w,x)=>pi(v,a,l,!0)?1:Math.max(w,w*n,x,x*n),g=(v,w,x)=>pi(v,a,l,!0)?-1:Math.min(w,w*n,x,x*n),p=f(0,c,u),m=f(lt,d,h),b=g(V,c,u),y=g(V+lt,d,h);i=(p-b)/2,s=(m-y)/2,o=-(p+b)/2,r=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:o,offsetY:r}}class Ge extends Vt{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let o=l=>+i[l];if($(i[t])){const{key:l="value"}=this._parsing;o=c=>+Ie(i[c],l)}let r,a;for(r=t,a=t+n;r<a;++r)s._parsed[r]=o(r)}}_getRotation(){return Wt(this.options.rotation-90)}_getCircumference(){return Wt(this.options.circumference)}_getRotationExtents(){let t=tt,n=-tt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,o=s._getRotation(),r=s._getCircumference();t=Math.min(t,o),n=Math.max(n,o+r)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:i}=n,s=this._cachedMeta,o=s.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(Gg(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Bm(u,d,l),m=(i.width-r)/h,b=(i.height-r)/f,y=Math.max(Math.min(m,b)/2,0),v=$c(this.options.radius,y),w=Math.max(v*l,0),x=(v-w)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=p*v,s.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const i=this.options,s=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*o/tt)}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,a=r.chartArea,c=r.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=o&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(n,s);let b=this._getRotation(),y;for(y=0;y<n;++y)b+=this._circumference(y,o);for(y=n;y<n+i;++y){const v=this._circumference(y,o),w=t[y],x={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+v,circumference:v,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(y,w.active?"active":s)),b+=v,this.updateElement(w,y,x,s)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let i=0,s;for(s=0;s<n.length;s++){const o=t._parsed[s];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(s)&&!n[s].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?tt*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ti(n._parsed[t],i.options.locale);return{label:s[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const i=this.chart;let s,o,r,a,l;if(!t){for(s=0,o=i.data.datasets.length;s<o;++s)if(i.isDatasetVisible(s)){r=i.getDatasetMeta(s),t=r.data,a=r.controller;break}}if(!t)return 0;for(s=0,o=t.length;s<o;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,s=t.length;i<s;++i){const o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(P(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}D(Ge,"id","doughnut"),D(Ge,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),D(Ge,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),D(Ge,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data,{labels:{pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=t.legend.options;return n.labels.length&&n.datasets.length?n.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:r&&(a||u.borderRadius),index:c}}):[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}});class cs extends Vt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:i,data:s=[],_dataset:o}=n,r=this.chart._animationsDisabled;let{start:a,count:l}=qc(n,s,r);this._drawStart=a,this._drawCount=l,Gc(n)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,s),h=r.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=wn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||s==="none",y=n+i,v=t.length;let w=n>0&&this.getParsed(n-1);for(let x=0;x<v;++x){const _=t[x],k=b?_:{};if(x<n||x>=y){k.skip=!0;continue}const S=this.getParsed(x),M=N(S[f]),I=k[h]=r.getPixelForValue(S[h],x),T=k[f]=o||M?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[f],x);k.skip=isNaN(I)||isNaN(T)||M,k.stop=x>0&&Math.abs(S[h]-w[h])>m,p&&(k.parsed=S,k.raw=c.data[x]),u&&(k.options=d||this.resolveDataElementOptions(x,_.active?"active":s)),b||this.updateElement(_,x,k,s),w=S}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const o=s[0].size(this.resolveDataElementOptions(0)),r=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,o,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}D(cs,"id","line"),D(cs,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),D(cs,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ci extends Vt{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ti(n._parsed[t].r,i.options.locale);return{label:s[t]||"",value:o}}parseObjectData(t,n,i,s){return nd.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const o=this.getParsed(s).r;!isNaN(o)&&this.chart.getDataVisibility(s)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,i=t.options,s=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(s/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),a=(o-r)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*V;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<n;++g)f+=this._computeAngle(g,s,p);for(g=n;g<n+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),v=r.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,o&&(l.animateScale&&(v=0),l.animateRotate&&(b=y=h));const w={x:d,y:u,innerRadius:0,outerRadius:v,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,w,s)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?Wt(this.resolveDataElementOptions(t,n).angle||i):0}}D(ci,"id","polarArea"),D(ci,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),D(ci,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return n.labels.map((o,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class Wo extends Ge{}D(Wo,"id","pie"),D(Wo,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ds extends Vt{getLabelAndValue(t){const n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,s){return nd.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta,i=n.dataset,s=n.data||[],o=n.iScale.getLabels();if(i.points=s,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===s.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,n,i,s){const o=this._cachedMeta.rScale,r=s==="reset";for(let a=n;a<n+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=o.getPointPositionForValue(a,this.getParsed(a).r),u=r?o.xCenter:d.x,h=r?o.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}D(ds,"id","radar"),D(ds,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),D(ds,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class us extends Vt{getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const n=this._cachedMeta,{data:i=[]}=n,s=this.chart._animationsDisabled;let{start:o,count:r}=qc(n,i,s);if(this._drawStart=o,this._drawCount=r,Gc(n)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=r.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=wn(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||s==="none";let v=n>0&&this.getParsed(n-1);for(let w=n;w<n+i;++w){const x=t[w],_=this.getParsed(w),k=y?x:{},S=N(_[g]),M=k[f]=r.getPixelForValue(_[f],w),I=k[g]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,_,l):_[g],w);k.skip=isNaN(M)||isNaN(I)||S,k.stop=w>0&&Math.abs(_[f]-v[f])>b,m&&(k.parsed=_,k.raw=c.data[w]),h&&(k.options=u||this.resolveDataElementOptions(w,x.active?"active":s)),y||this.updateElement(x,w,k,s),v=_}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let a=0;for(let l=n.length-1;l>=0;--l)a=Math.max(a,n[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!n.length)return s;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,o,r)/2}}D(us,"id","scatter"),D(us,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),D(us,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Nm=Object.freeze({__proto__:null,BarController:as,BubbleController:ls,DoughnutController:Ge,LineController:cs,PieController:Wo,PolarAreaController:ci,RadarController:ds,ScatterController:us});function je(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Rr{constructor(t){D(this,"options");this.options=t||{}}static override(t){Object.assign(Rr.prototype,t)}init(){}formats(){return je()}parse(){return je()}format(){return je()}add(){return je()}diff(){return je()}startOf(){return je()}endOf(){return je()}}var Fm={_date:Rr};function $m(e,t,n,i){const{controller:s,data:o,_sorted:r}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&o.length){const c=a._reversePixels?ap:re;if(i){if(s._sharedOptions){const d=o[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(o,t,n-u),f=c(o,t,n+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(o,t,n);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=e,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!N(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!N(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:o.length-1}}function qs(e,t,n,i,s){const o=e.getSortedVisibleDatasetMetas(),r=n[t];for(let a=0,l=o.length;a<l;++a){const{index:c,data:d}=o[a],{lo:u,hi:h}=$m(o[a],t,r,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Hm(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(i,s){const o=t?Math.abs(i.x-s.x):0,r=n?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function vo(e,t,n,i,s){const o=[];return!s&&!e.isPointInArea(t)||qs(e,n,t,function(a,l,c){!s&&!ae(a,e.chartArea,0)||a.inRange(t.x,t.y,i)&&o.push({element:a,datasetIndex:l,index:c})},!0),o}function zm(e,t,n,i){let s=[];function o(r,a,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:u}=jc(r,{x:t.x,y:t.y});pi(u,c,d)&&s.push({element:r,datasetIndex:a,index:l})}return qs(e,n,t,o),s}function jm(e,t,n,i,s,o){let r=[];const a=Hm(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!o||e.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return qs(e,n,t,c),r}function wo(e,t,n,i,s,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!i?zm(e,t,n,s):jm(e,t,n,i,s,o)}function qa(e,t,n,i,s){const o=[],r=n==="x"?"inXRange":"inYRange";let a=!1;return qs(e,n,t,(l,c,d)=>{l[r]&&l[r](t[n],s)&&(o.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:o}var Wm={modes:{index(e,t,n,i){const s=Ye(t,e),o=n.axis||"x",r=n.includeInvisible||!1,a=n.intersect?vo(e,s,o,i,r):wo(e,s,o,!1,i,r),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;let a=n.intersect?vo(e,s,o,i,r):wo(e,s,o,!1,i,r);if(a.length>0){const l=a[0].datasetIndex,c=e.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return vo(e,s,o,i,r)},nearest(e,t,n,i){const s=Ye(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return wo(e,s,o,n.intersect,i,r)},x(e,t,n,i){const s=Ye(t,e);return qa(e,s,"x",n.intersect,i)},y(e,t,n,i){const s=Ye(t,e);return qa(e,s,"y",n.intersect,i)}}};const fd=["left","top","right","bottom"];function On(e,t){return e.filter(n=>n.pos===t)}function Ga(e,t){return e.filter(n=>fd.indexOf(n.pos)===-1&&n.box.axis===t)}function Pn(e,t){return e.sort((n,i)=>{const s=t?i:n,o=t?n:i;return s.weight===o.weight?s.index-o.index:s.weight-o.weight})}function Vm(e){const t=[];let n,i,s,o,r,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],{position:o,options:{stack:r,stackWeight:a=1}}=s,t.push({index:n,box:s,pos:o,horizontal:s.isHorizontal(),weight:s.weight,stack:r&&o+r,stackWeight:a});return t}function Um(e){const t={};for(const n of e){const{stack:i,pos:s,stackWeight:o}=n;if(!i||!fd.includes(s))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}function Ym(e,t){const n=Um(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let o,r,a;for(o=0,r=e.length;o<r;++o){a=e[o];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return n}function qm(e){const t=Vm(e),n=Pn(t.filter(c=>c.box.fullSize),!0),i=Pn(On(t,"left"),!0),s=Pn(On(t,"right")),o=Pn(On(t,"top"),!0),r=Pn(On(t,"bottom")),a=Ga(t,"x"),l=Ga(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:s.concat(l).concat(r).concat(a),chartArea:On(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:o.concat(r).concat(a)}}function Xa(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function gd(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Gm(e,t,n,i){const{pos:s,box:o}=n,r=e.maxPadding;if(!$(s)){n.size&&(e[s]-=n.size);const u=i[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?o.height:o.width),n.size=u.size/u.count,e[s]+=n.size}o.getPadding&&gd(r,o.getPadding());const a=Math.max(0,t.outerWidth-Xa(r,e,"left","right")),l=Math.max(0,t.outerHeight-Xa(r,e,"top","bottom")),c=a!==e.w,d=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function Xm(e){const t=e.maxPadding;function n(i){const s=Math.max(t[i]-e[i],0);return e[i]+=s,s}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function Km(e,t){const n=t.maxPadding;function i(s){const o={left:0,top:0,right:0,bottom:0};return s.forEach(r=>{o[r]=Math.max(t[r],n[r])}),o}return i(e?["left","right"]:["top","bottom"])}function Yn(e,t,n,i){const s=[];let o,r,a,l,c,d;for(o=0,r=e.length,c=0;o<r;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,Km(a.horizontal,t));const{same:u,other:h}=Gm(t,n,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&Yn(s,t,n,i)||d}function Vi(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function Ka(e,t,n,i){const s=n.padding;let{x:o,y:r}=t;for(const a of e){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;gi(c.start)&&(r=c.start),l.fullSize?Vi(l,s.left,r,n.outerWidth-s.right-s.left,h):Vi(l,t.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=t.h*d,h=c.size||l.width;gi(c.start)&&(o=c.start),l.fullSize?Vi(l,o,s.top,h,n.outerHeight-s.bottom-s.top):Vi(l,o,t.top+c.placed,h,u),c.start=o,c.placed+=u,o=l.right}}t.x=o,t.y=r}var kt={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=_t(e.options.layout.padding),o=Math.max(t-s.width,0),r=Math.max(n-s.height,0),a=qm(e.boxes),l=a.vertical,c=a.horizontal;X(e.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},s);gd(h,_t(i));const f=Object.assign({maxPadding:h,w:o,h:r,x:s.left,y:s.top},s),g=Ym(l.concat(c),u);Yn(a.fullSize,f,u,g),Yn(l,f,u,g),Yn(c,f,u,g)&&Yn(l,f,u,g),Xm(f),Ka(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,Ka(a.rightAndBottom,f,u,g),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},X(a.chartArea,p=>{const m=p.box;Object.assign(m,e.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class pd{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,s){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,s?Math.floor(n/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Jm extends pd{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const hs="$chartjs",Zm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},Ja=e=>e===null||e==="";function Qm(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[hs]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",Ja(s)){const o=Pa(e,"width");o!==void 0&&(e.width=o)}if(Ja(i))if(e.style.height==="")e.height=e.width/(t||2);else{const o=Pa(e,"height");o!==void 0&&(e.height=o)}return e}const md=tm?{passive:!0}:!1;function t0(e,t,n){e&&e.addEventListener(t,n,md)}function e0(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,md)}function n0(e,t){const n=Zm[e.type]||e.type,{x:i,y:s}=Ye(e,t);return{type:n,chart:t,native:e,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Ns(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function i0(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ns(a.addedNodes,i),r=r&&!Ns(a.removedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function s0(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ns(a.removedNodes,i),r=r&&!Ns(a.addedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const bi=new Map;let Za=0;function bd(){const e=window.devicePixelRatio;e!==Za&&(Za=e,bi.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function o0(e,t){bi.size||window.addEventListener("resize",bd),bi.set(e,t)}function r0(e){bi.delete(e),bi.size||window.removeEventListener("resize",bd)}function a0(e,t,n){const i=e.canvas,s=i&&Pr(i);if(!s)return;const o=Yc((a,l)=>{const c=s.clientWidth;n(a,l),c<s.clientWidth&&n()},window),r=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(s),o0(e,o),r}function ko(e,t,n){n&&n.disconnect(),t==="resize"&&r0(e)}function l0(e,t,n){const i=e.canvas,s=Yc(o=>{e.ctx!==null&&n(n0(o,e))},e);return t0(i,t,s),s}class c0 extends pd{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Qm(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[hs])return!1;const i=n[hs].initial;["height","width"].forEach(o=>{const r=i[o];N(r)?n.removeAttribute(o):n.setAttribute(o,r)});const s=i.style||{};return Object.keys(s).forEach(o=>{n.style[o]=s[o]}),n.width=n.width,delete n[hs],!0}addEventListener(t,n,i){this.removeEventListener(t,n);const s=t.$proxies||(t.$proxies={}),r={attach:i0,detach:s0,resize:a0}[n]||l0;s[n]=r(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),s=i[n];if(!s)return;({attach:ko,detach:ko,resize:ko}[n]||e0)(t,n,s),i[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,s){return Qp(t,n,i,s)}isAttached(t){const n=t&&Pr(t);return!!(n&&n.isConnected)}}function d0(e){return!Or()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?Jm:c0}class Ut{constructor(){D(this,"x");D(this,"y");D(this,"active",!1);D(this,"options");D(this,"$animations")}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return wn(this.x)&&wn(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const s={};return t.forEach(o=>{s[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),s}}D(Ut,"defaults",{}),D(Ut,"defaultRoutes");function u0(e,t){const n=e.options.ticks,i=h0(e),s=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?g0(t):[],r=o.length,a=o[0],l=o[r-1],c=[];if(r>s)return p0(t,c,o,r/s),c;const d=f0(o,t,s);if(r>0){let u,h;const f=r>1?Math.round((l-a)/(r-1)):null;for(Ui(t,c,d,N(f)?0:a-f,a),u=0,h=r-1;u<h;u++)Ui(t,c,d,o[u],o[u+1]);return Ui(t,c,d,l,N(f)?t.length:l+f),c}return Ui(t,c,d),c}function h0(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}function f0(e,t,n){const i=m0(e),s=t.length/n;if(!i)return Math.max(s,1);const o=np(i);for(let r=0,a=o.length-1;r<a;r++){const l=o[r];if(l>s)return l}return Math.max(s,1)}function g0(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}function p0(e,t,n,i){let s=0,o=n[0],r;for(i=Math.ceil(i),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=n[s*i])}function Ui(e,t,n,i,s){const o=P(i,0),r=Math.min(P(s,e.length),e.length);let a=0,l,c,d;for(n=Math.ceil(n),s&&(l=s-i,n=l/Math.floor(l/n)),d=o;d<0;)a++,d=Math.round(o+a*n);for(c=Math.max(o,0);c<r;c++)c===d&&(t.push(e[c]),a++,d=Math.round(o+a*n))}function m0(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}const b0=e=>e==="left"?"right":e==="right"?"left":e,Qa=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,tl=(e,t)=>Math.min(t||e,e);function el(e,t){const n=[],i=e.length/t,s=e.length;let o=0;for(;o<s;o+=i)n.push(e[Math.floor(o)]);return n}function y0(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),o=e._startPixel,r=e._endPixel,a=1e-6;let l=e.getPixelForTick(s),c;if(!(n&&(i===1?c=Math.max(l-o,r-l):t===0?c=(e.getPixelForTick(1)-l)/2:c=(l-e.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<o-a||l>r+a)))return l}function x0(e,t){X(e,n=>{const i=n.gc,s=i.length/2;let o;if(s>t){for(o=0;o<s;++o)delete n.data[i[o]];i.splice(0,s)}})}function Rn(e){return e.drawTicks?e.tickLength:0}function nl(e,t){if(!e.display)return 0;const n=ut(e.font,t),i=_t(e.padding);return(it(e.text)?e.text.length:1)*n.lineHeight+i.height}function v0(e,t){return Ce(e,{scale:t,type:"scale"})}function w0(e,t,n){return Ce(e,{tick:n,index:t,type:"tick"})}function k0(e,t,n){let i=Tr(e);return(n&&t!=="right"||!n&&t==="right")&&(i=b0(i)),i}function _0(e,t,n,i){const{top:s,left:o,bottom:r,right:a,chart:l}=e,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=r-s,m=a-o;if(e.isHorizontal()){if(f=vt(i,o,a),$(n)){const b=Object.keys(n)[0],y=n[b];g=d[b].getPixelForValue(y)+p-t}else n==="center"?g=(c.bottom+c.top)/2+p-t:g=Qa(e,n,t);h=a-o}else{if($(n)){const b=Object.keys(n)[0],y=n[b];f=d[b].getPixelForValue(y)-m+t}else n==="center"?f=(c.left+c.right)/2-m+t:f=Qa(e,n,t);g=vt(i,r,s),u=n==="left"?-lt:lt}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class sn extends Ut{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:s}=this;return t=Ot(t,Number.POSITIVE_INFINITY),n=Ot(n,Number.NEGATIVE_INFINITY),i=Ot(i,Number.POSITIVE_INFINITY),s=Ot(s,Number.NEGATIVE_INFINITY),{min:Ot(t,i),max:Ot(n,s),minDefined:at(t),maxDefined:at(n)}}getMinMax(t){let{min:n,max:i,minDefined:s,maxDefined:o}=this.getUserBounds(),r;if(s&&o)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)r=a[l].controller.getMinMax(this,t),s||(n=Math.min(n,r.min)),o||(i=Math.max(i,r.max));return n=o&&n>i?i:n,i=s&&n>i?n:i,{min:Ot(n,Ot(i,n)),max:Ot(i,Ot(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Z(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:s,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Lp(this,o,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?el(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=u0(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,i;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Z(this.options.afterUpdate,[this])}beforeSetDimensions(){Z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,s,o;for(i=0,s=t.length;i<s;i++)o=t[i],o.label=Z(n.callback,[o.value,i,t],this)}afterTickToLabelConversion(){Z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=tl(this.ticks.length,t.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation;let r=s,a,l,c;if(!this._isVisible()||!n.display||s>=o||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=mt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Rn(t.grid)-n.padding-nl(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=Er(Math.min(Math.asin(mt((d.highest.height+6)/a,-1,1)),Math.asin(mt(l/c,-1,1))-Math.asin(mt(h/c,-1,1)))),r=Math.max(s,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){Z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:s,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const l=nl(s,n.options.font);if(a?(t.width=this.maxWidth,t.height=Rn(o)+l):(t.height=this.maxHeight,t.width=Rn(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=Wt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,s){const{ticks:{align:o,padding:r},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*n.height):(h=i*t.height,f=s*n.width):o==="start"?f=n.width:o==="end"?h=t.width:o!=="inner"&&(h=t.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=t.height/2;o==="start"?(d=0,u=t.height):o==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,i;for(n=0,i=t.length;n<i;n++)N(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=el(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,i){const{ctx:s,_longestTextCache:o}=this,r=[],a=[],l=Math.floor(n/tl(n,i));let c=0,d=0,u,h,f,g,p,m,b,y,v,w,x;for(u=0;u<n;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=o[m]=o[m]||{data:{},gc:[]},y=p.lineHeight,v=w=0,!N(g)&&!it(g))v=Rs(s,b.data,b.gc,v,g),w=y;else if(it(g))for(h=0,f=g.length;h<f;++h)x=g[h],!N(x)&&!it(x)&&(v=Rs(s,b.data,b.gc,v,x),w+=y);r.push(v),a.push(w),c=Math.max(v,c),d=Math.max(w,d)}x0(o,n);const _=r.indexOf(c),k=a.indexOf(d),S=M=>({width:r[M]||0,height:a[M]||0});return{first:S(0),last:S(n-1),widest:S(_),highest:S(k),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return rp(this._alignToPixels?ze(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=w0(this.getContext(),t,i))}return this.$context||(this.$context=v0(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=Wt(this.labelRotation),i=Math.abs(Math.cos(n)),s=Math.abs(Math.sin(n)),o=this._getLabelSizes(),r=t.autoSkipPadding||0,a=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,s=this.options,{grid:o,position:r,border:a}=s,l=o.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Rn(o),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(j){return ze(i,j,p)};let y,v,w,x,_,k,S,M,I,T,C,U;if(r==="top")y=b(this.bottom),k=this.bottom-h,M=y-m,T=b(t.top)+m,U=t.bottom;else if(r==="bottom")y=b(this.top),T=t.top,U=b(t.bottom)-m,k=y+m,M=this.top+h;else if(r==="left")y=b(this.right),_=this.right-h,S=y-m,I=b(t.left)+m,C=t.right;else if(r==="right")y=b(this.left),I=t.left,C=b(t.right)-m,_=y+m,S=this.left+h;else if(n==="x"){if(r==="center")y=b((t.top+t.bottom)/2+.5);else if($(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}T=t.top,U=t.bottom,k=y+m,M=k+h}else if(n==="y"){if(r==="center")y=b((t.left+t.right)/2);else if($(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}_=y-m,S=_-h,I=t.left,C=t.right}const Q=P(s.ticks.maxTicksLimit,u),z=Math.max(1,Math.ceil(u/Q));for(v=0;v<u;v+=z){const j=this.getContext(v),J=o.setContext(j),bt=a.setContext(j),ht=J.lineWidth,Oe=J.color,Pe=bt.dash||[],be=bt.dashOffset,In=J.tickWidth,Re=J.tickColor,An=J.tickBorderDash||[],Be=J.tickBorderDashOffset;w=y0(this,v,l),w!==void 0&&(x=ze(i,w,ht),c?_=S=I=C=x:k=M=T=U=x,f.push({tx1:_,ty1:k,tx2:S,ty2:M,x1:I,y1:T,x2:C,y2:U,width:ht,color:Oe,borderDash:Pe,borderDashOffset:be,tickWidth:In,tickColor:Re,tickBorderDash:An,tickBorderDashOffset:Be}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const n=this.axis,i=this.options,{position:s,ticks:o}=i,r=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=o,h=Rn(i.grid),f=h+d,g=u?-d:f,p=-Wt(this.labelRotation),m=[];let b,y,v,w,x,_,k,S,M,I,T,C,U="middle";if(s==="top")_=this.bottom-g,k=this._getXAxisLabelAlignment();else if(s==="bottom")_=this.top+g,k=this._getXAxisLabelAlignment();else if(s==="left"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,x=z.x}else if(s==="right"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,x=z.x}else if(n==="x"){if(s==="center")_=(t.top+t.bottom)/2+f;else if($(s)){const z=Object.keys(s)[0],j=s[z];_=this.chart.scales[z].getPixelForValue(j)+f}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if($(s)){const z=Object.keys(s)[0],j=s[z];x=this.chart.scales[z].getPixelForValue(j)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?U="top":l==="end"&&(U="bottom"));const Q=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){v=a[b],w=v.label;const z=o.setContext(this.getContext(b));S=this.getPixelForTick(b)+o.labelOffset,M=this._resolveTickFontOptions(b),I=M.lineHeight,T=it(w)?w.length:1;const j=T/2,J=z.color,bt=z.textStrokeColor,ht=z.textStrokeWidth;let Oe=k;r?(x=S,k==="inner"&&(b===y-1?Oe=this.options.reverse?"left":"right":b===0?Oe=this.options.reverse?"right":"left":Oe="center"),s==="top"?c==="near"||p!==0?C=-T*I+I/2:c==="center"?C=-Q.highest.height/2-j*I+I:C=-Q.highest.height+I/2:c==="near"||p!==0?C=I/2:c==="center"?C=Q.highest.height/2-j*I:C=Q.highest.height-T*I,u&&(C*=-1),p!==0&&!z.showLabelBackdrop&&(x+=I/2*Math.sin(p))):(_=S,C=(1-T)*I/2);let Pe;if(z.showLabelBackdrop){const be=_t(z.backdropPadding),In=Q.heights[b],Re=Q.widths[b];let An=C-be.top,Be=0-be.left;switch(U){case"middle":An-=In/2;break;case"bottom":An-=In;break}switch(k){case"center":Be-=Re/2;break;case"right":Be-=Re;break;case"inner":b===y-1?Be-=Re:b>0&&(Be-=Re/2);break}Pe={left:Be,top:An,width:Re+be.width,height:In+be.height,color:z.backdropColor}}m.push({label:w,font:M,textOffset:C,options:{rotation:p,color:J,strokeColor:bt,strokeWidth:ht,textAlign:Oe,textBaseline:U,translation:[x,_],backdrop:Pe}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-Wt(this.labelRotation))return t==="top"?"left":"right";let s="center";return n.align==="start"?s="left":n.align==="end"?s="right":n.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:s,padding:o}}=this.options,r=this._getLabelSizes(),a=t+o,l=r.widest.width;let c,d;return n==="left"?s?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?s?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:s,width:o,height:r}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,s,o,r),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const s=this.ticks.findIndex(o=>o.value===t);return s>=0?n.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,r;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(n.display)for(o=0,r=s.length;o<r;++o){const l=s[o];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:i,grid:s}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=ze(t,this.left,r)-r/2,d=ze(t,this.right,a)+a/2,u=h=l):(u=ze(t,this.top,r)-r/2,h=ze(t,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&Vs(i,s);const o=this.getLabelItems(t);for(const r of o){const a=r.options,l=r.font,c=r.label,d=r.textOffset;tn(i,c,0,d,l,a)}s&&Us(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:s}}=this;if(!i.display)return;const o=ut(i.font),r=_t(i.padding),a=i.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||$(n)?(l+=r.bottom,it(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=_0(this,l,n,a);tn(t,i.text,0,0,o,{color:i.color,maxWidth:u,rotation:h,textAlign:k0(a,n,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=P(t.grid&&t.grid.z,-1),s=P(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==sn.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let o,r;for(o=0,r=n.length;o<r;++o){const a=n[o];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return ut(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Yi{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;D0(n)&&(i=this.register(n));const s=this.items,o=t.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in s||(s[o]=t,S0(t,r,i),this.override&&st.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,s=this.scope;i in n&&delete n[i],s&&i in st[s]&&(delete st[s][i],this.override&&delete Qe[i])}}function S0(e,t,n){const i=fi(Object.create(null),[n?st.get(n):{},st.get(t),e.defaults]);st.set(t,i),e.defaultRoutes&&E0(t,e.defaultRoutes),e.descriptors&&st.describe(t,e.descriptors)}function E0(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),o=[e].concat(i).join("."),r=t[n].split("."),a=r.pop(),l=r.join(".");st.route(o,s,l,a)})}function D0(e){return"id"in e&&"defaults"in e}class T0{constructor(){this.controllers=new Yi(Vt,"datasets",!0),this.elements=new Yi(Ut,"elements"),this.plugins=new Yi(Object,"plugins"),this.scales=new Yi(sn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(s=>{const o=i||this._getRegistryForType(s);i||o.isForType(s)||o===this.plugins&&s.id?this._exec(t,o,s):X(s,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,n,i){const s=Sr(t);Z(i["before"+s],[],i),n[t](i),Z(i["after"+s],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const s=n.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var qt=new T0;class M0{constructor(){this._init=void 0}notify(t,n,i,s){if(n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=s?this._descriptors(t).filter(s):this._descriptors(t),r=this._notify(o,t,n,i);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,n,i,s){s=s||{};for(const o of t){const r=o.plugin,a=r[i],l=[n,s,o.options];if(Z(a,l,r)===!1&&s.cancelable)return!1}return!0}invalidate(){N(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,s=P(i.options&&i.options.plugins,{}),o=I0(i);return s===!1&&!n?[]:L0(t,o,s,n)}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,s=(o,r)=>o.filter(a=>!r.some(l=>a.plugin.id===l.plugin.id));this._notify(s(n,i),t,"stop"),this._notify(s(i,n),t,"start")}}function I0(e){const t={},n=[],i=Object.keys(qt.plugins.items);for(let o=0;o<i.length;o++)n.push(qt.getPlugin(i[o]));const s=e.plugins||[];for(let o=0;o<s.length;o++){const r=s[o];n.indexOf(r)===-1&&(n.push(r),t[r.id]=!0)}return{plugins:n,localIds:t}}function A0(e,t){return!t&&e===!1?null:e===!0?{}:e}function L0(e,{plugins:t,localIds:n},i,s){const o=[],r=e.getContext();for(const a of t){const l=a.id,c=A0(i[l],s);c!==null&&o.push({plugin:a,options:C0(e.config,{plugin:a,local:n[l]},c,r)})}return o}function C0(e,{plugin:t,local:n},i,s){const o=e.pluginScopeKeys(t),r=e.getOptionScopes(i,o);return n&&t.defaults&&r.push(t.defaults),e.createResolver(r,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Vo(e,t){const n=st.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function O0(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function P0(e,t){return e===t?"_index_":"_value_"}function il(e){if(e==="x"||e==="y"||e==="r")return e}function R0(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function Uo(e,...t){if(il(e))return e;for(const n of t){const i=n.axis||R0(n.position)||e.length>1&&il(e[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function sl(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function B0(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(i=>i.xAxisID===e||i.yAxisID===e);if(n.length)return sl(e,"x",n[0])||sl(e,"y",n[0])}return{}}function N0(e,t){const n=Qe[e.type]||{scales:{}},i=t.scales||{},s=Vo(e.type,t),o=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!$(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=Uo(r,a,B0(r,e),st.scales[a.type]),c=P0(l,s),d=n.scales||{};o[r]=oi(Object.create(null),[{axis:l},a,d[l],d[c]])}),e.data.datasets.forEach(r=>{const a=r.type||e.type,l=r.indexAxis||Vo(a,t),d=(Qe[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=O0(u,l),f=r[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),oi(o[f],[{axis:h},i[f],d[u]])})}),Object.keys(o).forEach(r=>{const a=o[r];oi(a,[st.scales[a.type],st.scale])}),o}function yd(e){const t=e.options||(e.options={});t.plugins=P(t.plugins,{}),t.scales=N0(e,t)}function xd(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function F0(e){return e=e||{},e.data=xd(e.data),yd(e),e}const ol=new Map,vd=new Set;function qi(e,t){let n=ol.get(e);return n||(n=t(),ol.set(e,n),vd.add(n)),n}const Bn=(e,t,n)=>{const i=Ie(t,n);i!==void 0&&e.add(i)};class $0{constructor(t){this._config=F0(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=xd(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),yd(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return qi(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return qi(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return qi(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,i=this.type;return qi(`${i}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let s=i.get(t);return(!s||n)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,n,i){const{options:s,type:o}=this,r=this._cachedScopes(t,i),a=r.get(n);if(a)return a;const l=new Set;n.forEach(d=>{t&&(l.add(t),d.forEach(u=>Bn(l,t,u))),d.forEach(u=>Bn(l,s,u)),d.forEach(u=>Bn(l,Qe[o]||{},u)),d.forEach(u=>Bn(l,st,u)),d.forEach(u=>Bn(l,zo,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),vd.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:t,type:n}=this;return[t,Qe[n]||{},st.datasets[n]||{},{type:n},st,zo]}resolveNamedOptions(t,n,i,s=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=rl(this._resolverCache,t,s);let l=r;if(z0(r,n)){o.$shared=!1,i=Ae(i)?i():i;const c=this.createResolver(t,i,a);l=kn(r,i,c)}for(const c of n)o[c]=l[c];return o}createResolver(t,n,i=[""],s){const{resolver:o}=rl(this._resolverCache,t,i);return $(n)?kn(o,n,void 0,s):o}}function rl(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let o=i.get(s);return o||(o={resolver:Ar(t,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,o)),o}const H0=e=>$(e)&&Object.getOwnPropertyNames(e).some(t=>Ae(e[t]));function z0(e,t){const{isScriptable:n,isIndexable:i}=Zc(e);for(const s of t){const o=n(s),r=i(s),a=(r||o)&&e[s];if(o&&(Ae(a)||H0(a))||r&&it(a))return!0}return!1}var j0="4.5.1";const W0=["top","bottom","left","right","chartArea"];function al(e,t){return e==="top"||e==="bottom"||W0.indexOf(e)===-1&&t==="x"}function ll(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function cl(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Z(n&&n.onComplete,[e],t)}function V0(e){const t=e.chart,n=t.options.animation;Z(n&&n.onProgress,[e],t)}function wd(e){return Or()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const fs={},dl=e=>{const t=wd(e);return Object.values(fs).filter(n=>n.canvas===t).pop()};function U0(e,t,n){const i=Object.keys(e);for(const s of i){const o=+s;if(o>=t){const r=e[s];delete e[s],(n>0||o>t)&&(e[o+n]=r)}}}function Y0(e,t,n,i){return!n||e.type==="mouseout"?null:i?t:e}class se{static register(...t){qt.add(...t),ul()}static unregister(...t){qt.remove(...t),ul()}constructor(t,n){const i=this.config=new $0(n),s=wd(t),o=dl(s);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||d0(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,r.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=qg(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new M0,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=dp(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],fs[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}te.listen(this,"complete",cl),te.listen(this,"progress",V0),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:s,_aspectRatio:o}=this;return N(t)?n&&o?o:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return qt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Oa(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Aa(this.canvas,this.ctx),this}stop(){return te.stop(this),this}resize(t,n){te.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,s=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,t,n,o),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Oa(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),Z(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};X(n,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,s=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let o=[];n&&(o=o.concat(Object.keys(n).map(r=>{const a=n[r],l=Uo(r,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),X(o,r=>{const a=r.options,l=a.id,c=Uo(l,a),d=P(a.type,r.dtype);(a.position===void 0||al(a.position,c)!==al(r.dposition))&&(a.position=r.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=qt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),X(s,(r,a)=>{r||delete i[a]}),X(i,r=>{kt.configure(this,r,r.options),kt.addBox(this,r)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((s,o)=>s.index-o.index),i>n){for(let s=n;s<i;++s)this._destroyDatasetMeta(s);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(ll("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,s)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=n.length;i<s;i++){const o=n[i];let r=this.getDatasetMeta(i);const a=o.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=o.indexAxis||Vo(a,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=qt.getController(a),{datasetElementType:c,dataElementType:d}=st.datasets[a];Object.assign(l,{dataElementType:qt.getElement(d),datasetElementType:c&&qt.getElement(c)}),r.controller=new l(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){X(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&o.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),s||X(o,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(ll("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){X(this.scales,t=>{kt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!wa(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:o}of n){const r=i==="_removeElements"?-o:o;U0(t,s,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=o=>new Set(t.filter(r=>r[0]===o).map((r,a)=>a+","+r.splice(1).join(","))),s=i(0);for(let o=1;o<n;o++)if(!wa(s,i(o)))return;return Array.from(s).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;kt.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],X(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,o)=>{s._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Ae(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(n),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(te.has(this)?this.attached&&!te.running(this)&&te.start(this):(this.draw(),cl({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let s,o;for(s=0,o=n.length;s<o;++s){const r=n[s];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=cd(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&Vs(n,s),t.controller.draw(),s&&Us(n),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return ae(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,s){const o=Wm.modes[n];return typeof o=="function"?o(this,t,i,s):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let s=i.filter(o=>o&&o._dataset===n).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Ce(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){const i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const s=i?"show":"hide",o=this.getDatasetMeta(t),r=o.controller._resolveAnimations(void 0,s);gi(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(o,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),te.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Aa(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete fs[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(o,r)=>{n.addEventListener(this,o,r),t[o]=r},s=(o,r,a)=>{o.offsetX=r,o.offsetY=a,this._eventHandler(o)};X(this.options.events,o=>i(o,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(l,c)=>{n.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(n.removeEventListener(this,l,c),delete t[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,s("resize",o),this._stop(),this._resize(0,0),i("attach",a)},n.isAttached(this.canvas)?a():r()}unbindEvents(){X(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},X(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const s=i?"set":"remove";let o,r,a,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){r=t[a];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:o,index:r})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[r],index:r}});!Cs(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){const s=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=o(n,t),a=i?t:o(t,n);r.length&&this.updateHoverStyle(r,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},s=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:s=[],options:o}=this,r=n,a=this._getActiveElements(t,s,i,r),l=Qg(t),c=Y0(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Z(o.onHover,[t,a,this],this),l&&Z(o.onClick,[t,a,this],this));const d=!Cs(a,s);return(d||n)&&(this._active=a,this._updateHoverStyles(a,s,n)),this._lastEvent=c,d}_getActiveElements(t,n,i,s){if(t.type==="mouseout")return[];if(!i)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,s)}}D(se,"defaults",st),D(se,"instances",fs),D(se,"overrides",Qe),D(se,"registry",qt),D(se,"version",j0),D(se,"getChart",dl);function ul(){return X(se.instances,e=>e._plugins.invalidate())}function q0(e,t,n){const{startAngle:i,x:s,y:o,outerRadius:r,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/r,wt(i-n));if(e.beginPath(),e.arc(s,o,r-c/2,i+u/2,n-u/2),a>0){const h=Math.min(c/a,wt(i-n));e.arc(s,o,a+c/2,n-h/2,i+h/2,!0)}else{const h=Math.min(c/2,r*wt(i-n));if(d==="round")e.arc(s,o,h,n-V/2,i+V/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(n+V/2)+s,p=-f*Math.sin(n+V/2)+o,m=f*Math.cos(i+V/2)+s,b=f*Math.sin(i+V/2)+o;e.lineTo(g,p),e.lineTo(m,b)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function G0(e,t,n){const{startAngle:i,pixelMargin:s,x:o,y:r,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(o,r,a,i-c,n+c),l>s?(c=s/l,e.arc(o,r,l,n+c,i-c,!0)):e.arc(o,r,s,n+lt,i-lt),e.closePath(),e.clip()}function X0(e){return Ir(e,["outerStart","outerEnd","innerStart","innerEnd"])}function K0(e,t,n,i){const s=X0(e.options.borderRadius),o=(n-t)/2,r=Math.min(o,i*t/2),a=l=>{const c=(n-Math.min(o,l))*i/2;return mt(l,0,Math.min(o,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:mt(s.innerStart,0,r),innerEnd:mt(s.innerEnd,0,r)}}function cn(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function Fs(e,t,n,i,s,o){const{x:r,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let f=0;const g=s-l;if(i){const z=d>0?d-i:0,j=u>0?u-i:0,J=(z+j)/2,bt=J!==0?g*J/(J+i):g;f=(g-bt)/2}const p=Math.max(.001,g*u-n/V)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:v,outerEnd:w,innerStart:x,innerEnd:_}=K0(t,h,u,y-b),k=u-v,S=u-w,M=b+v/k,I=y-w/S,T=h+x,C=h+_,U=b+x/T,Q=y-_/C;if(e.beginPath(),o){const z=(M+I)/2;if(e.arc(r,a,u,M,z),e.arc(r,a,u,z,I),w>0){const ht=cn(S,I,r,a);e.arc(ht.x,ht.y,w,I,y+lt)}const j=cn(C,y,r,a);if(e.lineTo(j.x,j.y),_>0){const ht=cn(C,Q,r,a);e.arc(ht.x,ht.y,_,y+lt,Q+Math.PI)}const J=(y-_/h+(b+x/h))/2;if(e.arc(r,a,h,y-_/h,J,!0),e.arc(r,a,h,J,b+x/h,!0),x>0){const ht=cn(T,U,r,a);e.arc(ht.x,ht.y,x,U+Math.PI,b-lt)}const bt=cn(k,b,r,a);if(e.lineTo(bt.x,bt.y),v>0){const ht=cn(k,M,r,a);e.arc(ht.x,ht.y,v,b-lt,M)}}else{e.moveTo(r,a);const z=Math.cos(M)*u+r,j=Math.sin(M)*u+a;e.lineTo(z,j);const J=Math.cos(I)*u+r,bt=Math.sin(I)*u+a;e.lineTo(J,bt)}e.closePath()}function J0(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a}=t;let l=t.endAngle;if(o){Fs(e,t,n,i,l,s);for(let c=0;c<o;++c)e.fill();isNaN(a)||(l=r+(a%tt||tt))}return Fs(e,t,n,i,l,s),e.fill(),l}function Z0(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,g?(e.lineWidth=c*2,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let p=t.endAngle;if(o){Fs(e,t,n,i,p,s);for(let m=0;m<o;++m)e.stroke();isNaN(a)||(p=r+(a%tt||tt))}g&&G0(e,t,p),l.selfJoin&&p-r>=V&&f===0&&d!=="miter"&&q0(e,t,p),o||(Fs(e,t,n,i,p,s),e.stroke())}class qn extends Ut{constructor(n){super();D(this,"circumference");D(this,"endAngle");D(this,"fullCircles");D(this,"innerRadius");D(this,"outerRadius");D(this,"pixelMargin");D(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.getProps(["x","y"],s),{angle:r,distance:a}=jc(o,{x:n,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=P(h,c-l),p=pi(r,l,c)&&l!==c,m=g>=tt||p,b=oe(a,d+f,u+f);return m&&b}getCenterPoint(n){const{x:i,y:s,startAngle:o,endAngle:r,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(o+r)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:i,circumference:s}=this,o=(i.offset||0)/4,r=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>tt?Math.floor(s/tt):0,s===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const c=1-Math.sin(Math.min(V,s||0)),d=o*c;n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,J0(n,this,d,r,a),Z0(n,this,d,r,a),n.restore()}}D(qn,"id","arc"),D(qn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),D(qn,"defaultRoutes",{backgroundColor:"backgroundColor"}),D(qn,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function kd(e,t,n=t){e.lineCap=P(n.borderCapStyle,t.borderCapStyle),e.setLineDash(P(n.borderDash,t.borderDash)),e.lineDashOffset=P(n.borderDashOffset,t.borderDashOffset),e.lineJoin=P(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=P(n.borderWidth,t.borderWidth),e.strokeStyle=P(n.borderColor,t.borderColor)}function Q0(e,t,n){e.lineTo(n.x,n.y)}function tb(e){return e.stepped?kp:e.tension||e.cubicInterpolationMode==="monotone"?_p:Q0}function _d(e,t,n={}){const i=e.length,{start:s=0,end:o=i-1}=n,{start:r,end:a}=t,l=Math.max(s,r),c=Math.min(o,a),d=s<r&&o<r||s>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function eb(e,t,n,i){const{points:s,options:o}=t,{count:r,start:a,loop:l,ilen:c}=_d(s,n,i),d=tb(o);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%r],!g.skip&&(u?(e.moveTo(g.x,g.y),u=!1):d(e,p,g,h,o.stepped),p=g);return l&&(g=s[(a+(h?c:0))%r],d(e,p,g,h,o.stepped)),!!l}function nb(e,t,n,i){const s=t.points,{count:o,start:r,ilen:a}=_d(s,n,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=w=>(r+(c?a-w:w))%o,v=()=>{p!==m&&(e.lineTo(d,m),e.lineTo(d,p),e.lineTo(d,b))};for(l&&(f=s[y(0)],e.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const w=f.x,x=f.y,_=w|0;_===g?(x<p?p=x:x>m&&(m=x),d=(u*d+w)/++u):(v(),e.lineTo(w,x),g=_,u=0,p=m=x),b=x}v()}function Yo(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?nb:eb}function ib(e){return e.stepped?em:e.tension||e.cubicInterpolationMode==="monotone"?nm:qe}function sb(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),kd(e,t.options),e.stroke(s)}function ob(e,t,n,i){const{segments:s,options:o}=t,r=Yo(t);for(const a of s)kd(e,o,a.style),e.beginPath(),r(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}const rb=typeof Path2D=="function";function ab(e,t,n,i){rb&&!t.options.segment?sb(e,t,n,i):ob(e,t,n,i)}class De extends Ut{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;qp(this._points,i,t,s,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=lm(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){const i=this.options,s=t[n],o=this.points,r=ld(this,{property:n,start:s,end:s});if(!r.length)return;const a=[],l=ib(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=o[u],g=o[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[n])/(g[n]-f[n])),m=l(f,g,p,i.stepped);m[n]=t[n],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,n,i){return Yo(this)(t,this,n,i)}path(t,n,i){const s=this.segments,o=Yo(this);let r=this._loop;n=n||0,i=i||this.points.length-n;for(const a of s)r&=o(t,this,a,{start:n,end:n+i-1});return!!r}draw(t,n,i,s){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),ab(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}D(De,"id","line"),D(De,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),D(De,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),D(De,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function hl(e,t,n,i){const s=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<s.radius+s.hitRadius}class gs extends Ut{constructor(n){super();D(this,"parsed");D(this,"skip");D(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.options,{x:r,y:a}=this.getProps(["x","y"],s);return Math.pow(n-r,2)+Math.pow(i-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(n,i){return hl(this,n,"x",i)}inYRange(n,i){return hl(this,n,"y",i)}getCenterPoint(n){const{x:i,y:s}=this.getProps(["x","y"],n);return{x:i,y:s}}size(n){n=n||this.options||{};let i=n.radius||0;i=Math.max(i,i&&n.hoverRadius||0);const s=i&&n.borderWidth||0;return(i+s)*2}draw(n,i){const s=this.options;this.skip||s.radius<.1||!ae(this,i,this.size(s)/2)||(n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.fillStyle=s.backgroundColor,jo(n,s,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}D(gs,"id","point"),D(gs,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),D(gs,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Sd(e,t){const{x:n,y:i,base:s,width:o,height:r}=e.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return e.horizontal?(u=r/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,d=i+u):(u=o/2,a=n-u,l=n+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function Te(e,t,n,i){return e?0:mt(t,n,i)}function lb(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,o=Jc(i);return{t:Te(s.top,o.top,0,n),r:Te(s.right,o.right,0,t),b:Te(s.bottom,o.bottom,0,n),l:Te(s.left,o.left,0,t)}}function cb(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,o=Ke(s),r=Math.min(t,n),a=e.borderSkipped,l=i||$(s);return{topLeft:Te(!l||a.top||a.left,o.topLeft,0,r),topRight:Te(!l||a.top||a.right,o.topRight,0,r),bottomLeft:Te(!l||a.bottom||a.left,o.bottomLeft,0,r),bottomRight:Te(!l||a.bottom||a.right,o.bottomRight,0,r)}}function db(e){const t=Sd(e),n=t.right-t.left,i=t.bottom-t.top,s=lb(e,n/2,i/2),o=cb(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,o.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(s.b,s.r))}}}}function _o(e,t,n,i){const s=t===null,o=n===null,a=e&&!(s&&o)&&Sd(e,i);return a&&(s||oe(t,a.left,a.right))&&(o||oe(n,a.top,a.bottom))}function ub(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function hb(e,t){e.rect(t.x,t.y,t.w,t.h)}function So(e,t,n={}){const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,r=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+o,h:e.h+r,radius:e.radius}}class ps extends Ut{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:s}}=this,{inner:o,outer:r}=db(this),a=ub(r.radius)?mi:hb;t.save(),(r.w!==o.w||r.h!==o.h)&&(t.beginPath(),a(t,So(r,n,o)),t.clip(),a(t,So(o,-n,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,So(o,n)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,n,i){return _o(this,t,n,i)}inXRange(t,n){return _o(this,t,null,n)}inYRange(t,n){return _o(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:s,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+s)/2:n,y:o?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}D(ps,"id","bar"),D(ps,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),D(ps,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var fb=Object.freeze({__proto__:null,ArcElement:qn,BarElement:ps,LineElement:De,PointElement:gs});const qo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],fl=qo.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function Ed(e){return qo[e%qo.length]}function Dd(e){return fl[e%fl.length]}function gb(e,t){return e.borderColor=Ed(t),e.backgroundColor=Dd(t),++t}function pb(e,t){return e.backgroundColor=e.data.map(()=>Ed(t++)),t}function mb(e,t){return e.backgroundColor=e.data.map(()=>Dd(t++)),t}function bb(e){let t=0;return(n,i)=>{const s=e.getDatasetMeta(i).controller;s instanceof Ge?t=pb(n,t):s instanceof ci?t=mb(n,t):s&&(t=gb(n,t))}}function gl(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function yb(e){return e&&(e.borderColor||e.backgroundColor)}function xb(){return st.borderColor!=="rgba(0,0,0,0.1)"||st.backgroundColor!=="rgba(0,0,0,0.1)"}var vb={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:s}=e.config,{elements:o}=s,r=gl(i)||yb(s)||o&&gl(o)||xb();if(!n.forceOverride&&r)return;const a=bb(e);i.forEach(a)}};function wb(e,t,n,i,s){const o=s.samples||i;if(o>=n)return e.slice(t,t+n);const r=[],a=(n-2)/(o-2);let l=0;const c=t+n-1;let d=t,u,h,f,g,p;for(r[l++]=e[d],u=0;u<o-2;u++){let m=0,b=0,y;const v=Math.floor((u+1)*a)+1+t,w=Math.min(Math.floor((u+2)*a)+1,n)+t,x=w-v;for(y=v;y<w;y++)m+=e[y].x,b+=e[y].y;m/=x,b/=x;const _=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,n)+t,{x:S,y:M}=e[d];for(f=g=-1,y=_;y<k;y++)g=.5*Math.abs((S-m)*(e[y].y-M)-(S-e[y].x)*(b-M)),g>f&&(f=g,h=e[y],p=y);r[l++]=h,d=p}return r[l++]=e[c],r}function kb(e,t,n,i){let s=0,o=0,r,a,l,c,d,u,h,f,g,p;const m=[],b=t+n-1,y=e[t].x,w=e[b].x-y;for(r=t;r<t+n;++r){a=e[r],l=(a.x-y)/w*i,c=a.y;const x=l|0;if(x===d)c<g?(g=c,u=r):c>p&&(p=c,h=r),s=(o*s+a.x)/++o;else{const _=r-1;if(!N(u)&&!N(h)){const k=Math.min(u,h),S=Math.max(u,h);k!==f&&k!==_&&m.push({...e[k],x:s}),S!==f&&S!==_&&m.push({...e[S],x:s})}r>0&&_!==f&&m.push(e[_]),m.push(a),d=x,o=0,g=p=c,u=h=f=r}}return m}function Td(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function pl(e){e.data.datasets.forEach(t=>{Td(t)})}function _b(e,t){const n=t.length;let i=0,s;const{iScale:o}=e,{min:r,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=mt(re(t,o.axis,r).lo,0,n-1)),c?s=mt(re(t,o.axis,a).hi+1,i,n)-i:s=n-i,{start:i,count:s}}var Sb={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){pl(e);return}const i=e.width;e.data.datasets.forEach((s,o)=>{const{_data:r,indexAxis:a}=s,l=e.getDatasetMeta(o),c=r||s.data;if(Un([a,e.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=e.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||e.options.parsing)return;let{start:u,count:h}=_b(l,c);const f=n.threshold||4*i;if(h<=f){Td(s);return}N(r)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(n.algorithm){case"lttb":g=wb(c,u,h,i,n);break;case"min-max":g=kb(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}s._decimated=g})},destroy(e){pl(e)}};function Eb(e,t,n){const i=e.segments,s=e.points,o=t.points,r=[];for(const a of i){let{start:l,end:c}=a;c=Gs(l,c,s);const d=Go(n,s[l],s[c],a.loop);if(!t.segments){r.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=ld(t,d);for(const h of u){const f=Go(n,o[h.start],o[h.end],h.loop),g=ad(a,s,f);for(const p of g)r.push({source:p,target:h,start:{[n]:ml(d,f,"start",Math.max)},end:{[n]:ml(d,f,"end",Math.min)}})}}return r}function Go(e,t,n,i){if(i)return;let s=t[e],o=n[e];return e==="angle"&&(s=wt(s),o=wt(o)),{property:e,start:s,end:o}}function Db(e,t){const{x:n=null,y:i=null}=e||{},s=t.points,o=[];return t.segments.forEach(({start:r,end:a})=>{a=Gs(r,a,s);const l=s[r],c=s[a];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):n!==null&&(o.push({x:n,y:l.y}),o.push({x:n,y:c.y}))}),o}function Gs(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function ml(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function Md(e,t){let n=[],i=!1;return it(e)?(i=!0,n=e):n=Db(e,t),n.length?new De({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function bl(e){return e&&e.fill!==!1}function Tb(e,t,n){let s=e[t].fill;const o=[t];let r;if(!n)return s;for(;s!==!1&&o.indexOf(s)===-1;){if(!at(s))return s;if(r=e[s],!r)return!1;if(r.visible)return s;o.push(s),s=r.fill}return!1}function Mb(e,t,n){const i=Cb(e);if($(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return at(s)&&Math.floor(s)===s?Ib(i[0],t,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Ib(e,t,n,i){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=i?!1:n}function Ab(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:$(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function Lb(e,t,n){let i;return e==="start"?i=n:e==="end"?i=t.options.reverse?t.min:t.max:$(e)?i=e.value:i=t.getBaseValue(),i}function Cb(e){const t=e.options,n=t.fill;let i=P(n&&n.target,n);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Ob(e){const{scale:t,index:n,line:i}=e,s=[],o=i.segments,r=i.points,a=Pb(t,n);a.push(Md({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)Rb(s,r[d],a)}return new De({points:s,options:{}})}function Pb(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const o=i[s];if(o.index===t)break;o.hidden||n.unshift(o.dataset)}return n}function Rb(e,t,n){const i=[];for(let s=0;s<n.length;s++){const o=n[s],{first:r,last:a,point:l}=Bb(o,t,"x");if(!(!l||r&&a)){if(r)i.unshift(l);else if(e.push(l),!a)break}}e.push(...i)}function Bb(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const s=i[n],o=e.segments,r=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],u=r[d.start][n],h=r[d.end][n];if(oe(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Id{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:s,y:o,radius:r}=this;return n=n||{start:0,end:tt},t.arc(s,o,r,n.end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:s}=this,o=t.angle;return{x:n+Math.cos(o)*s,y:i+Math.sin(o)*s,angle:o}}}function Nb(e){const{chart:t,fill:n,line:i}=e;if(at(n))return Fb(t,n);if(n==="stack")return Ob(e);if(n==="shape")return!0;const s=$b(e);return s instanceof Id?s:Md(s,i)}function Fb(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function $b(e){return(e.scale||{}).getPointPositionForValue?zb(e):Hb(e)}function Hb(e){const{scale:t={},fill:n}=e,i=Ab(n,t);if(at(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function zb(e){const{scale:t,fill:n}=e,i=t.options,s=t.getLabels().length,o=i.reverse?t.max:t.min,r=Lb(n,t,o),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,o);return new Id({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(r)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,r));return a}function Eo(e,t,n){const i=Nb(t),{chart:s,index:o,line:r,scale:a,axis:l}=t,c=r.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(o),p=cd(s,g);i&&r.points.length&&(Vs(e,n),jb(e,{line:r,target:i,above:h,below:f,area:n,scale:a,axis:l,clip:p}),Us(e))}function jb(e,t){const{line:n,target:i,above:s,below:o,area:r,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let d=o;o!==s&&(c==="x"?(yl(e,i,r.top),Do(e,{line:n,target:i,color:s,scale:a,property:c,clip:l}),e.restore(),e.save(),yl(e,i,r.bottom)):c==="y"&&(xl(e,i,r.left),Do(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),xl(e,i,r.right),d=s)),Do(e,{line:n,target:i,color:d,scale:a,property:c,clip:l}),e.restore()}function yl(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Gs(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(d.x,n),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function xl(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Gs(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(n,d.y),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function Do(e,t){const{line:n,target:i,property:s,color:o,scale:r,clip:a}=t,l=Eb(n,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=o}={}}=c,g=i!==!0;e.save(),e.fillStyle=f,Wb(e,r,a,g&&Go(s,u,h)),e.beginPath();const p=!!n.pathSegment(e,c);let m;if(g){p?e.closePath():vl(e,i,h,s);const b=!!i.pathSegment(e,d,{move:p,reverse:!0});m=p&&b,m||vl(e,i,u,s)}e.closePath(),e.fill(m?"evenodd":"nonzero"),e.restore()}}function Wb(e,t,n,i){const s=t.chart.chartArea,{property:o,start:r,end:a}=i||{};if(o==="x"||o==="y"){let l,c,d,u;o==="x"?(l=r,c=s.top,d=a,u=s.bottom):(l=s.left,c=r,d=s.right,u=a),e.beginPath(),n&&(l=Math.max(l,n.left),d=Math.min(d,n.right),c=Math.max(c,n.top),u=Math.min(u,n.bottom)),e.rect(l,c,d-l,u-c),e.clip()}}function vl(e,t,n,i){const s=t.interpolate(n,i);s&&e.lineTo(s.x,s.y)}var Vb={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,s=[];let o,r,a,l;for(r=0;r<i;++r)o=e.getDatasetMeta(r),a=o.dataset,l=null,a&&a.options&&a instanceof De&&(l={visible:e.isDatasetVisible(r),index:r,fill:Mb(a,r,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,s.push(l);for(r=0;r<i;++r)l=s[r],!(!l||l.fill===!1)&&(l.fill=Tb(s,r,n.propagate))},beforeDraw(e,t,n){const i=n.drawTime==="beforeDraw",s=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let r=s.length-1;r>=0;--r){const a=s[r].$filler;a&&(a.line.updateControlPoints(o,a.axis),i&&a.fill&&Eo(e.ctx,a,o))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const i=e.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const o=i[s].$filler;bl(o)&&Eo(e.ctx,o,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!bl(i)||n.drawTime!=="beforeDatasetDraw"||Eo(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const wl=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}},Ub=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class kl extends Ut{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Z(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=ut(i.font),o=s.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=wl(i,o);let c,d;n.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,a,l)+10):(d=this.maxHeight,c=this._fitCols(r,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,s){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+n/2+o.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>r)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,n,i,s){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:v}=Yb(i,n,o,m,s);b>0&&f+v+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:v},h=Math.max(h,y),f+=v+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:s},rtl:o}}=this,r=yn(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=vt(i,this.left+s,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=vt(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+s}else{let a=0,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;Vs(t,this),this._draw(),Us(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:s}=this,{align:o,labels:r}=t,a=st.color,l=yn(t.rtl,this.left,this.width),c=ut(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=wl(r,u),b=function(_,k,S){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const M=P(S.lineWidth,1);if(s.fillStyle=P(S.fillStyle,a),s.lineCap=P(S.lineCap,"butt"),s.lineDashOffset=P(S.lineDashOffset,0),s.lineJoin=P(S.lineJoin,"miter"),s.lineWidth=M,s.strokeStyle=P(S.strokeStyle,a),s.setLineDash(P(S.lineDash,[])),r.usePointStyle){const I={radius:p*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:M},T=l.xPlus(_,g/2),C=k+h;Kc(s,I,T,C,r.pointStyleWidth&&g)}else{const I=k+Math.max((u-p)/2,0),T=l.leftForLtr(_,g),C=Ke(S.borderRadius);s.beginPath(),Object.values(C).some(U=>U!==0)?mi(s,{x:T,y:I,w:g,h:p,radius:C}):s.rect(T,I,g,p),s.fill(),M!==0&&s.stroke()}s.restore()},y=function(_,k,S){tn(s,S.text,_,k+m/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},v=this.isHorizontal(),w=this._computeTitleHeight();v?f={x:vt(o,this.left+d,this.right-i[0]),y:this.top+d+w,line:0}:f={x:this.left+d,y:vt(o,this.top+w+d,this.bottom-n[0].height),line:0},sd(this.ctx,t.textDirection);const x=m+d;this.legendItems.forEach((_,k)=>{s.strokeStyle=_.fontColor,s.fillStyle=_.fontColor;const S=s.measureText(_.text).width,M=l.textAlign(_.textAlign||(_.textAlign=r.textAlign)),I=g+h+S;let T=f.x,C=f.y;l.setWidth(this.width),v?k>0&&T+I+d>this.right&&(C=f.y+=x,f.line++,T=f.x=vt(o,this.left+d,this.right-i[f.line])):k>0&&C+x>this.bottom&&(T=f.x=T+n[f.line].width+d,f.line++,C=f.y=vt(o,this.top+w+d,this.bottom-n[f.line].height));const U=l.x(T);if(b(U,C,_),T=up(M,T+g+h,v?T+I:this.right,t.rtl),y(l.x(T),C,_),v)f.x+=I+d;else if(typeof _.text!="string"){const Q=c.lineHeight;f.y+=Ad(_,Q)+d}else f.y+=x}),od(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=ut(n.font),s=_t(n.padding);if(!n.display)return;const o=yn(t.rtl,this.left,this.width),r=this.ctx,a=n.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=vt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+vt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=vt(a,u,u+h);r.textAlign=o.textAlign(Tr(a)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=i.string,tn(r,n.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,n=ut(t.font),i=_t(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,s,o;if(oe(t,this.left,this.right)&&oe(n,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(s=o[i],oe(t,s.left,s.left+s.width)&&oe(n,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const n=this.options;if(!Xb(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,o=Ub(s,i);s&&!o&&Z(n.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!o&&Z(n.onHover,[t,i,this],this)}else i&&Z(n.onClick,[t,i,this],this)}}function Yb(e,t,n,i,s){const o=qb(i,e,t,n),r=Gb(s,i,t.lineHeight);return{itemWidth:o,itemHeight:r}}function qb(e,t,n,i){let s=e.text;return s&&typeof s!="string"&&(s=s.reduce((o,r)=>o.length>r.length?o:r)),t+n.size/2+i.measureText(s).width}function Gb(e,t,n){let i=e;return typeof t.text!="string"&&(i=Ad(t,n)),i}function Ad(e,t){const n=e.text?e.text.length:0;return t*n}function Xb(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var Kb={id:"legend",_element:kl,start(e,t,n){const i=e.legend=new kl({ctx:e.ctx,options:n,chart:e});kt.configure(e,i,n),kt.addBox(e,i)},stop(e){kt.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;kt.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=_t(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:r&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class Br extends Ut{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const s=it(i.text)?i.text.length:1;this._padding=_t(i.padding);const o=s*ut(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:i,bottom:s,right:o,options:r}=this,a=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=vt(a,i,o),u=n+t,c=o-i):(r.position==="left"?(d=i+t,u=vt(a,s,n),l=V*-.5):(d=o-t,u=vt(a,n,s),l=V*.5),c=s-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=ut(n.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(o);tn(t,n.text,0,0,i,{color:n.color,maxWidth:l,rotation:c,textAlign:Tr(n.align),textBaseline:"middle",translation:[r,a]})}}function Jb(e,t){const n=new Br({ctx:e.ctx,options:t,chart:e});kt.configure(e,n,t),kt.addBox(e,n),e.titleBlock=n}var Zb={id:"title",_element:Br,start(e,t,n){Jb(e,n)},stop(e){const t=e.titleBlock;kt.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;kt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Gi=new WeakMap;var Qb={id:"subtitle",start(e,t,n){const i=new Br({ctx:e.ctx,options:n,chart:e});kt.configure(e,i,n),kt.addBox(e,i),Gi.set(e,i)},stop(e){kt.removeBox(e,Gi.get(e)),Gi.delete(e)},beforeUpdate(e,t,n){const i=Gi.get(e);kt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Gn={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,o=0;for(t=0,n=e.length;t<n;++t){const a=e[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,i=t.y,s=Number.POSITIVE_INFINITY,o,r,a;for(o=0,r=e.length;o<r;++o){const l=e[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=Ho(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,i=l.y}return{x:n,y:i}}};function Yt(e,t){return t&&(it(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function ee(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function ty(e,t){const{element:n,datasetIndex:i,index:s}=t,o=e.getDatasetMeta(i).controller,{label:r,value:a}=o.getLabelAndValue(s);return{chart:e,label:r,parsed:o.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:o.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function _l(e,t){const n=e.chart.ctx,{body:i,footer:s,title:o}=e,{boxWidth:r,boxHeight:a}=t,l=ut(t.bodyFont),c=ut(t.titleFont),d=ut(t.footerFont),u=o.length,h=s.length,f=i.length,g=_t(t.padding);let p=g.height,m=0,b=i.reduce((w,x)=>w+x.before.length+x.lines.length+x.after.length,0);if(b+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const w=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*w+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(w){m=Math.max(m,n.measureText(w).width+y)};return n.save(),n.font=c.string,X(e.title,v),n.font=l.string,X(e.beforeBody.concat(e.afterBody),v),y=t.displayColors?r+2+t.boxPadding:0,X(i,w=>{X(w.before,v),X(w.lines,v),X(w.after,v)}),y=0,n.font=d.string,X(e.footer,v),n.restore(),m+=g.width,{width:m,height:p}}function ey(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}function ny(e,t,n,i){const{x:s,width:o}=i,r=n.caretSize+n.caretPadding;if(e==="left"&&s+o+r>t.width||e==="right"&&s-o-r<0)return!0}function iy(e,t,n,i){const{x:s,width:o}=n,{width:r,chartArea:{left:a,right:l}}=e;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=o/2?c="left":s>=r-o/2&&(c="right"),ny(c,e,t,n)&&(c="center"),c}function Sl(e,t,n){const i=n.yAlign||t.yAlign||ey(e,n);return{xAlign:n.xAlign||t.xAlign||iy(e,t,n,i),yAlign:i}}function sy(e,t){let{x:n,width:i}=e;return t==="right"?n-=i:t==="center"&&(n-=i/2),n}function oy(e,t,n){let{y:i,height:s}=e;return t==="top"?i+=n:t==="bottom"?i-=s+n:i-=s/2,i}function El(e,t,n,i){const{caretSize:s,caretPadding:o,cornerRadius:r}=e,{xAlign:a,yAlign:l}=n,c=s+o,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=Ke(r);let g=sy(t,a);const p=oy(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:mt(g,0,i.width-t.width),y:mt(p,0,i.height-t.height)}}function Xi(e,t,n){const i=_t(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-i.right:e.x+i.left}function Dl(e){return Yt([],ee(e))}function ry(e,t,n){return Ce(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function Tl(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Ld={beforeTitle:Qt,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Qt,beforeBody:Qt,beforeLabel:Qt,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return N(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Qt,afterBody:Qt,beforeFooter:Qt,footer:Qt,afterFooter:Qt};function Dt(e,t,n,i){const s=e[t].call(n,i);return typeof s>"u"?Ld[t].call(n,i):s}class Xo extends Ut{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&n.options.animation&&i.animations,o=new dd(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=ry(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:i}=n,s=Dt(i,"beforeTitle",this,t),o=Dt(i,"title",this,t),r=Dt(i,"afterTitle",this,t);let a=[];return a=Yt(a,ee(s)),a=Yt(a,ee(o)),a=Yt(a,ee(r)),a}getBeforeBody(t,n){return Dl(Dt(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:i}=n,s=[];return X(t,o=>{const r={before:[],lines:[],after:[]},a=Tl(i,o);Yt(r.before,ee(Dt(a,"beforeLabel",this,o))),Yt(r.lines,Dt(a,"label",this,o)),Yt(r.after,ee(Dt(a,"afterLabel",this,o))),s.push(r)}),s}getAfterBody(t,n){return Dl(Dt(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:i}=n,s=Dt(i,"beforeFooter",this,t),o=Dt(i,"footer",this,t),r=Dt(i,"afterFooter",this,t);let a=[];return a=Yt(a,ee(s)),a=Yt(a,ee(o)),a=Yt(a,ee(r)),a}_createItems(t){const n=this._active,i=this.chart.data,s=[],o=[],r=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(ty(this.chart,n[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),X(a,d=>{const u=Tl(t.callbacks,d);s.push(Dt(u,"labelColor",this,d)),o.push(Dt(u,"labelPointStyle",this,d)),r.push(Dt(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=a,a}update(t,n){const i=this.options.setContext(this.getContext()),s=this._active;let o,r=[];if(!s.length)this.opacity!==0&&(o={opacity:0});else{const a=Gn[i.position].call(this,s,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=_l(this,i),c=Object.assign({},a,l),d=Sl(this.chart,i,c),u=El(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,s){const o=this.getCaretPosition(t,i,s);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){const{xAlign:s,yAlign:o}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=Ke(a),{x:h,y:f}=t,{width:g,height:p}=n;let m,b,y,v,w,x;return o==="center"?(w=f+p/2,s==="left"?(m=h,b=m-r,v=w+r,x=w-r):(m=h+g,b=m+r,v=w-r,x=w+r),y=m):(s==="left"?b=h+Math.max(l,d)+r:s==="right"?b=h+g-Math.max(c,u)-r:b=this.caretX,o==="top"?(v=f,w=v-r,m=b-r,y=b+r):(v=f+p,w=v+r,m=b+r,y=b-r),x=v),{x1:m,x2:b,x3:y,y1:v,y2:w,y3:x}}drawTitle(t,n,i){const s=this.title,o=s.length;let r,a,l;if(o){const c=yn(i.rtl,this.x,this.width);for(t.x=Xi(this,i.titleAlign,i),n.textAlign=c.textAlign(i.titleAlign),n.textBaseline="middle",r=ut(i.titleFont),a=i.titleSpacing,n.fillStyle=i.titleColor,n.font=r.string,l=0;l<o;++l)n.fillText(s[l],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,l+1===o&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,n,i,s,o){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=ut(o.bodyFont),u=Xi(this,"left",o),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=n.y+f;if(o.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,jo(t,p,m,b),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,jo(t,p,m,b)}else{t.lineWidth=$(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=Ke(r.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,mi(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),mi(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=r.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){const{body:s}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=ut(i.bodyFont);let h=u.lineHeight,f=0;const g=yn(i.rtl,this.x,this.width),p=function(S){n.fillText(S,g.x(t.x+f),t.y+h/2),t.y+=h+o},m=g.textAlign(r);let b,y,v,w,x,_,k;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,t.x=Xi(this,m,i),n.fillStyle=i.bodyColor,X(this.beforeBody,p),f=a&&m!=="right"?r==="center"?c/2+d:c+2+d:0,w=0,_=s.length;w<_;++w){for(b=s[w],y=this.labelTextColors[w],n.fillStyle=y,X(b.before,p),v=b.lines,a&&v.length&&(this._drawColorBox(n,t,w,g,i),h=Math.max(u.lineHeight,l)),x=0,k=v.length;x<k;++x)p(v[x]),h=u.lineHeight;X(b.after,p)}f=0,h=u.lineHeight,X(this.afterBody,p),t.y-=o}drawFooter(t,n,i){const s=this.footer,o=s.length;let r,a;if(o){const l=yn(i.rtl,this.x,this.width);for(t.x=Xi(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=l.textAlign(i.footerAlign),n.textBaseline="middle",r=ut(i.footerFont),n.fillStyle=i.footerColor,n.font=r.string,a=0;a<o;++a)n.fillText(s[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,n,i,s){const{xAlign:o,yAlign:r}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=Ke(s.cornerRadius);n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.beginPath(),n.moveTo(a+u,l),r==="top"&&this.drawCaret(t,n,i,s),n.lineTo(a+c-h,l),n.quadraticCurveTo(a+c,l,a+c,l+h),r==="center"&&o==="right"&&this.drawCaret(t,n,i,s),n.lineTo(a+c,l+d-g),n.quadraticCurveTo(a+c,l+d,a+c-g,l+d),r==="bottom"&&this.drawCaret(t,n,i,s),n.lineTo(a+f,l+d),n.quadraticCurveTo(a,l+d,a,l+d-f),r==="center"&&o==="left"&&this.drawCaret(t,n,i,s),n.lineTo(a,l+u),n.quadraticCurveTo(a,l,a+u,l),n.closePath(),n.fill(),s.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,i=this.$animations,s=i&&i.x,o=i&&i.y;if(s||o){const r=Gn[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=_l(this,t),l=Object.assign({},r,this._size),c=Sl(n,t,l),d=El(t,l,c,n);(s._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(n);const s={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=_t(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,s,n),sd(t,n.textDirection),o.y+=r.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),od(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),o=!Cs(i,s),r=this._positionChanged(s,n);(o||r)&&(this._active=s,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,o=this._active||[],r=this._getActiveElements(t,o,n,i),a=this._positionChanged(r,t),l=n||!Cs(r,o)||a;return l&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,i,s){const o=this.options;if(t.type==="mouseout")return[];if(!s)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(t,n){const{caretX:i,caretY:s,options:o}=this,r=Gn[o.position].call(this,t,n);return r!==!1&&(i!==r.x||s!==r.y)}}D(Xo,"positioners",Gn);var ay={id:"tooltip",_element:Xo,positioners:Gn,afterInit(e,t,n){n&&(e.tooltip=new Xo({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Ld},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},ly=Object.freeze({__proto__:null,Colors:vb,Decimation:Sb,Filler:Vb,Legend:Kb,SubTitle:Qb,Title:Zb,Tooltip:ay});const cy=(e,t,n,i)=>(typeof t=="string"?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function dy(e,t,n,i){const s=e.indexOf(t);if(s===-1)return cy(e,t,n,i);const o=e.lastIndexOf(t);return s!==o?n:s}const uy=(e,t)=>e===null?null:mt(Math.round(e),0,t);function Ml(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Ko extends sn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:s,label:o}of n)i[s]===o&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(N(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:dy(i,t,P(n,t),this._addedLabels),uy(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,s=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=n;r++)s.push({value:r});return s}getLabelForValue(t){return Ml.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}D(Ko,"id","category"),D(Ko,"defaults",{ticks:{callback:Ml}});function hy(e,t){const n=[],{bounds:s,step:o,min:r,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=e,f=o||1,g=d-1,{min:p,max:m}=t,b=!N(r),y=!N(a),v=!N(c),w=(m-p)/(u+1);let x=_a((m-p)/g/f)*f,_,k,S,M;if(x<1e-14&&!b&&!y)return[{value:p},{value:m}];M=Math.ceil(m/x)-Math.floor(p/x),M>g&&(x=_a(M*x/g/f)*f),N(l)||(_=Math.pow(10,l),x=Math.ceil(x*_)/_),s==="ticks"?(k=Math.floor(p/x)*x,S=Math.ceil(m/x)*x):(k=p,S=m),b&&y&&o&&sp((a-r)/o,x/1e3)?(M=Math.round(Math.min((a-r)/x,d)),x=(a-r)/M,k=r,S=a):v?(k=b?r:k,S=y?a:S,M=c-1,x=(S-k)/M):(M=(S-k)/x,ri(M,Math.round(M),x/1e3)?M=Math.round(M):M=Math.ceil(M));const I=Math.max(Sa(x),Sa(k));_=Math.pow(10,N(l)?I:l),k=Math.round(k*_)/_,S=Math.round(S*_)/_;let T=0;for(b&&(h&&k!==r?(n.push({value:r}),k<r&&T++,ri(Math.round((k+T*x)*_)/_,r,Il(r,w,e))&&T++):k<r&&T++);T<M;++T){const C=Math.round((k+T*x)*_)/_;if(y&&C>a)break;n.push({value:C})}return y&&h&&S!==a?n.length&&ri(n[n.length-1].value,a,Il(a,w,e))?n[n.length-1].value=a:n.push({value:a}):(!y||S===a)&&n.push({value:S}),n}function Il(e,t,{horizontal:n,minRotation:i}){const s=Wt(i),o=(n?Math.sin(s):Math.cos(s))||.001,r=.75*t*(""+e).length;return Math.min(t/o,r)}class $s extends sn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return N(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:s,max:o}=this;const r=l=>s=n?s:l,a=l=>o=i?o:l;if(t){const l=Kt(s),c=Kt(o);l<0&&c<0?a(0):l>0&&c>0&&r(0)}if(s===o){let l=o===0?1:Math.abs(o*.05);a(o+l),t||r(s-l)}this.min=s,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),n=n||11),n&&(s=Math.min(n,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,r=hy(s,o);return t.bounds==="ticks"&&zc(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-n)/Math.max(t.length-1,1)/2;n-=s,i+=s}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return Ti(t,this.chart.options.locale,this.options.ticks.format)}}class Jo extends $s{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=at(t)?t:0,this.max=at(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=Wt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}D(Jo,"id","linear"),D(Jo,"defaults",{ticks:{callback:Ws.formatters.numeric}});const yi=e=>Math.floor(Se(e)),We=(e,t)=>Math.pow(10,yi(e)+t);function Al(e){return e/Math.pow(10,yi(e))===1}function Ll(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function fy(e,t){const n=t-e;let i=yi(n);for(;Ll(e,t,i)>10;)i++;for(;Ll(e,t,i)<10;)i--;return Math.min(i,yi(e))}function gy(e,{min:t,max:n}){t=Ot(e.min,t);const i=[],s=yi(t);let o=fy(t,n),r=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=s>o?Math.pow(10,s):0,c=Math.round((t-l)*r)/r,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,o)),h=Ot(e.min,Math.round((l+d+u*Math.pow(10,o))*r)/r);for(;h<n;)i.push({value:h,major:Al(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,r=o>=0?1:r),h=Math.round((l+d+u*Math.pow(10,o))*r)/r;const f=Ot(e.max,h);return i.push({value:f,major:Al(f),significand:u}),i}class Zo extends sn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=$s.prototype.parse.apply(this,[t,n]);if(i===0){this._zero=!0;return}return at(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=at(t)?Math.max(0,t):null,this.max=at(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!at(this._userMin)&&(this.min=t===We(this.min,0)?We(this.min,-1):We(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,s=this.max;const o=a=>i=t?i:a,r=a=>s=n?s:a;i===s&&(i<=0?(o(1),r(10)):(o(We(i,-1)),r(We(s,1)))),i<=0&&o(We(s,-1)),s<=0&&r(We(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},i=gy(n,this);return t.bounds==="ticks"&&zc(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Ti(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=Se(t),this._valueRange=Se(this.max)-Se(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(Se(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}D(Zo,"id","logarithmic"),D(Zo,"defaults",{ticks:{callback:Ws.formatters.logarithmic,major:{enabled:!0}}});function Qo(e){const t=e.ticks;if(t.display&&e.display){const n=_t(t.backdropPadding);return P(t.font&&t.font.size,st.font.size)+n.height}return 0}function py(e,t,n){return n=it(n)?n:[n],{w:wp(e,t.string,n),h:n.length*t.lineHeight}}function Cl(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function my(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],o=e._pointLabels.length,r=e.options.pointLabels,a=r.centerPointLabels?V/o:0;for(let l=0;l<o;l++){const c=r.setContext(e.getPointLabelContext(l));s[l]=c.padding;const d=e.getPointPosition(l,e.drawingArea+s[l],a),u=ut(c.font),h=py(e.ctx,u,e._pointLabels[l]);i[l]=h;const f=wt(e.getIndexAngle(l)+a),g=Math.round(Er(f)),p=Cl(g,d.x,h.w,0,180),m=Cl(g,d.y,h.h,90,270);by(n,t,f,p,m)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=vy(e,i,s)}function by(e,t,n,i,s){const o=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/o,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/r,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/r,e.b=Math.max(e.b,t.b+l))}function yy(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:o,padding:r,size:a}=n,l=e.getPointPosition(t,i+s+r,o),c=Math.round(Er(wt(l.angle+lt))),d=_y(l.y,a.h,c),u=wy(c),h=ky(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function xy(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:o}=e;return!(ae({x:n,y:i},t)||ae({x:n,y:o},t)||ae({x:s,y:i},t)||ae({x:s,y:o},t))}function vy(e,t,n){const i=[],s=e._pointLabels.length,o=e.options,{centerPointLabels:r,display:a}=o.pointLabels,l={extra:Qo(o)/2,additionalAngle:r?V/s:0};let c;for(let d=0;d<s;d++){l.padding=n[d],l.size=t[d];const u=yy(e,d,l);i.push(u),a==="auto"&&(u.visible=xy(u,c),u.visible&&(c=u))}return i}function wy(e){return e===0||e===180?"center":e<180?"left":"right"}function ky(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function _y(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function Sy(e,t,n){const{left:i,top:s,right:o,bottom:r}=n,{backdropColor:a}=t;if(!N(a)){const l=Ke(t.borderRadius),c=_t(t.backdropPadding);e.fillStyle=a;const d=i-c.left,u=s-c.top,h=o-i+c.width,f=r-s+c.height;Object.values(l).some(g=>g!==0)?(e.beginPath(),mi(e,{x:d,y:u,w:h,h:f,radius:l}),e.fill()):e.fillRect(d,u,h,f)}}function Ey(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const o=e._pointLabelItems[s];if(!o.visible)continue;const r=i.setContext(e.getPointLabelContext(s));Sy(n,r,o);const a=ut(r.font),{x:l,y:c,textAlign:d}=o;tn(n,e._pointLabels[s],l,c+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function Cd(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,tt);else{let o=e.getPointPosition(0,t);s.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=e.getPointPosition(r,t),s.lineTo(o.x,o.y)}}function Dy(e,t,n,i,s){const o=e.ctx,r=t.circular,{color:a,lineWidth:l}=t;!r&&!i||!a||!l||n<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(s.dash||[]),o.lineDashOffset=s.dashOffset,o.beginPath(),Cd(e,n,r,i),o.closePath(),o.stroke(),o.restore())}function Ty(e,t,n){return Ce(e,{label:n,index:t,type:"pointLabel"})}class Xn extends $s{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=_t(Qo(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=at(t)&&!isNaN(t)?t:0,this.max=at(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Qo(this.options))}generateTickLabels(t){$s.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const s=Z(this.options.pointLabels.callback,[n,i],this);return s||s===0?s:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?my(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,s){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,s))}getIndexAngle(t){const n=tt/(this._pointLabels.length||1),i=this.options.startAngle||0;return wt(t*n+Wt(i))}getDistanceFromCenterForValue(t){if(N(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(N(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return Ty(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const s=this.getIndexAngle(t)-lt+i;return{x:Math.cos(s)*n+this.xCenter,y:Math.sin(s)*n+this.yCenter,angle:s}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:s,bottom:o}=this._pointLabelItems[t];return{left:n,top:i,right:s,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Cd(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:s,border:o}=n,r=this._pointLabels.length;let a,l,c;if(n.pointLabels.display&&Ey(this,r),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=o.setContext(h);Dy(this,f,l,r,g)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let o,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const c=i.setContext(this.getContext(l)),d=ut(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=_t(c.backdropPadding);t.fillRect(-r/2-u.left,-o-d.size/2-u.top,r+u.width,d.size+u.height)}tn(t,a.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}D(Xn,"id","radialLinear"),D(Xn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Ws.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),D(Xn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),D(Xn,"descriptors",{angleLines:{_fallback:"grid"}});const Xs={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},At=Object.keys(Xs);function Ol(e,t){return e-t}function Pl(e,t){if(N(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:o}=e._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),at(r)||(r=typeof i=="string"?n.parse(r,i):n.parse(r)),r===null?null:(s&&(r=s==="week"&&(wn(o)||o===!0)?n.startOf(r,"isoWeek",o):n.startOf(r,s)),+r)}function Rl(e,t,n,i){const s=At.length;for(let o=At.indexOf(e);o<s-1;++o){const r=Xs[At[o]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-t)/(a*r.size))<=i)return At[o]}return At[s-1]}function My(e,t,n,i,s){for(let o=At.length-1;o>=At.indexOf(n);o--){const r=At[o];if(Xs[r].common&&e._adapter.diff(s,i,r)>=t-1)return r}return At[n?At.indexOf(n):0]}function Iy(e){for(let t=At.indexOf(e)+1,n=At.length;t<n;++t)if(Xs[At[t]].common)return At[t]}function Bl(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:i,hi:s}=Dr(n,t),o=n[i]>=t?n[i]:n[s];e[o]=!0}}function Ay(e,t,n,i){const s=e._adapter,o=+s.startOf(t[0].value,i),r=t[t.length-1].value;let a,l;for(a=o;a<=r;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}function Nl(e,t,n){const i=[],s={},o=t.length;let r,a;for(r=0;r<o;++r)a=t[r],s[a]=r,i.push({value:a,major:!1});return o===0||!n?i:Ay(e,i,s,n)}class xi extends sn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const i=t.time||(t.time={}),s=this._adapter=new Fm._date(t.adapters.date);s.init(n),oi(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Pl(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,i=t.time.unit||"day";let{min:s,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=at(s)&&!isNaN(s)?s:+n.startOf(Date.now(),i),o=at(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(s,o-1),this.max=Math.max(s+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){const t=this.options,n=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const o=this.min,r=this.max,a=lp(s,o,r);return this._unit=n.unit||(i.autoSkip?Rl(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):My(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:Iy(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Nl(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,s,o;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?n=1-s:n=(this.getDecimalForValue(t[1])-s)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=mt(n,0,r),i=mt(i,0,r),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){const t=this._adapter,n=this.min,i=this.max,s=this.options,o=s.time,r=o.unit||Rl(o.minUnit,n,i,this._getLabelCapacity(n)),a=P(s.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=wn(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":r),t.diff(i,n,r)>1e5*a)throw new Error(n+" and "+i+" are too far apart with stepSize of "+a+" "+r);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,r),f++)Bl(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Bl(d,h,g),Object.keys(d).sort(Ol).map(p=>+p)}getLabelForValue(t){const n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){const s=this.options.time.displayFormats,o=this._unit,r=n||s[o];return this._adapter.format(t,r)}_tickFormatFunction(t,n,i,s){const o=this.options,r=o.ticks.callback;if(r)return Z(r,[t,n,i],this);const a=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[n],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let n,i,s;for(n=0,i=t.length;n<i;++n)s=t[n],s.label=this._tickFormatFunction(s.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,i=this.ctx.measureText(t).width,s=Wt(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(s),r=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*o+a*r,h:i*r+a*o}}_getLabelCapacity(t){const n=this.options.time,i=n.displayFormats,s=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,Nl(this,[t],this._majorUnit),s),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(n=0,i=s.length;n<i;++n)t=t.concat(s[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,i;if(t.length)return t;const s=this.getLabels();for(n=0,i=s.length;n<i;++n)t.push(Pl(this,s[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Vc(t.sort(Ol))}}D(xi,"id","time"),D(xi,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function Ki(e,t,n){let i=0,s=e.length-1,o,r,a,l;n?(t>=e[i].pos&&t<=e[s].pos&&({lo:i,hi:s}=re(e,"pos",t)),{pos:o,time:a}=e[i],{pos:r,time:l}=e[s]):(t>=e[i].time&&t<=e[s].time&&({lo:i,hi:s}=re(e,"time",t)),{time:o,pos:a}=e[i],{time:r,pos:l}=e[s]);const c=r-o;return c?a+(l-a)*(t-o)/c:a}class tr extends xi{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=Ki(n,this.min),this._tableRange=Ki(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,s=[],o=[];let r,a,l,c,d;for(r=0,a=t.length;r<a;++r)c=t[r],c>=n&&c<=i&&s.push(c);if(s.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(r=0,a=s.length;r<a;++r)d=s[r+1],l=s[r-1],c=s[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(a-1)});return o}_generate(){const t=this.min,n=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(n)||i.length===1)&&i.push(n),i.sort((s,o)=>s-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return n.length&&i.length?t=this.normalize(n.concat(i)):t=n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Ki(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return Ki(this._table,i*this._tableRange+this._minPos,!0)}}D(tr,"id","timeseries"),D(tr,"defaults",xi.defaults);var Ly=Object.freeze({__proto__:null,CategoryScale:Ko,LinearScale:Jo,LogarithmicScale:Zo,RadialLinearScale:Xn,TimeScale:xi,TimeSeriesScale:tr});const Cy=[Nm,fb,ly,Ly];se.register(...Cy);function Ks(e,t=""){return`
        <div class="${q.CARD.GLASS} ${t}">
            ${e}
        </div>
    `}const le={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function vi(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,n=>t[n])}function Oy(e,t,n,i){return Ks(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${vi(e)}</span>
        <span id="${n}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${vi(t)}</span>
    `,le.CLASSES.KPI_CARD)}function Od(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${le.KPI_ITEMS.map(e=>Oy(e.label,"-",e.id,e.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${le.CHARTS.map(e=>Ks(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${e.dot}"></span> ${vi(e.label)}
                    </h3>
                    <div class="${le.CLASSES.CHART_CONTAINER}">
                        <canvas id="${e.id}Chart"></canvas>
                    </div>
                `,`${le.CLASSES.CHART_CARD} ${e.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function Py(e=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label for="page-search-input" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label for="page-search-project" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(e)?e:[]).map(s=>`<option value="${vi(s.id)}">${vi(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${Ks(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function Ry(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function By(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Fl=new WeakMap;function Ny(e){const t=document.getElementById("dashboard-view");if(!e||!t)return;t.innerHTML=Od();const n=e.filter(s=>s.status==="completed"&&s.completedAt);Fy(n),[{id:"daily",color:le.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:le.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:le.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:o,data:r}=$y(n,s.count,s.unit);Hy(s.id,o,r,s.color)})}function Fy(e){const t=new Date,n=ce(t).getTime(),i=tc(t).getTime(),s=ju(t).getTime(),o=e.reduce((r,a)=>{const l=pe(a.completedAt);if(!l)return r;const c=l.getTime();return c>=n&&r.today++,c>=i&&r.weekly++,c>=s&&r.monthly++,r},{today:0,weekly:0,monthly:0,total:e.length});Object.entries(o).forEach(([r,a])=>{const l=document.getElementById(`${r}-count`);l&&(l.textContent=a)})}function $y(e,t,n){const i=[],s=[],o=new Date;for(let r=0;r<t;r++){let a,l,c;const d=new Date(o);n==="day"?(d.setDate(o.getDate()-(t-1-r)),a=ce(d),l=zu(d),c=`${a.getMonth()+1}/${a.getDate()}`):n==="week"?(d.setDate(o.getDate()-(t-1-r)*7),a=tc(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(o.getFullYear(),o.getMonth()-(t-1-r),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=e.filter(h=>{const f=pe(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function Hy(e,t,n,i){const s=document.getElementById(`${e}Chart`);if(!s)return;let o=Fl.get(s);o?(o.data.labels=t,o.data.datasets[0].data=n,o.update()):(o=new se(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:n,backgroundColor:i,borderRadius:4}]},options:le.CHART_DEFAULTS}),Fl.set(s,o))}function To(e){const t=document.querySelectorAll(".sort-option"),n=Array.from(t).find(i=>i.dataset.value===e);if(n)n.click();else{const i=document.getElementById("sort-trigger");i&&(i.dataset.value=e,Ze())}}function Pd(e,t,n){var b,y,v,w,x,_,k,S,M,I;(b=document.getElementById("task-context-menu"))==null||b.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[200px] font-sans user-select-none text-gray-700 dark:text-gray-200",i.style.left=`${t}px`,i.style.top=`${n}px`;const s=T=>{i.remove(),T&&T()},o=selectionState.isSelectionMode,r=e&&selectionState.selectedIds.has(e.id),a=selectionState.selectedIds.size,l=o&&r&&a>0,c=!!e||l,d="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition flex items-center justify-between group relative",u="opacity-50 cursor-not-allowed hover:bg-transparent dark:hover:bg-transparent",h='<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>';let f="";f+=`
        <div class="${d} ${c?"":u}">
            <span>日付変更</span>
            ${h}
            ${c?`
            <div class="absolute left-full top-0 ml-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 hidden group-hover:block min-w-[120px]">
                <button id="ctx-date-today" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">今日</button>
                <button id="ctx-date-tomorrow" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">明日</button>
                <button id="ctx-date-next-week" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">来週</button>
            </div>
            `:""}
        </div>
    `,f+=`
        <button id="ctx-delete" class="${d} ${c?"":u} text-red-600 dark:text-red-400">
            <span>削除</span>
        </button>
    `,f+='<div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>',f+=`
        <button id="ctx-add-task" class="${d}">
            <span>タスク追加</span>
        </button>
    `,f+=`
        <div class="${d}">
            <span>並び替え</span>
            ${h}
            <div class="absolute left-full top-0 ml-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 hidden group-hover:block min-w-[120px]">
                <button id="ctx-sort-name" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">名前順</button>
                <button id="ctx-sort-date" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">日付順</button>
                <button id="ctx-sort-created" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">作成日順</button>
            </div>
        </div>
    `,f+=`
        <button id="ctx-multi-select" class="${d}">
            <span class="flex items-center">
                複数選択
                ${o?'<svg class="w-4 h-4 ml-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>':""}
            </span>
        </button>
    `,i.innerHTML=f,document.body.appendChild(i);const g=()=>l?Array.from(selectionState.selectedIds):e?[e.id]:[],p=async T=>{const C=g();C.length!==0&&s(async()=>{const U=C.map(Q=>ur(Q,T));await Promise.all(U)})};c&&((y=i.querySelector("#ctx-date-today"))==null||y.addEventListener("click",()=>{p({dueDate:ce(new Date)})}),(v=i.querySelector("#ctx-date-tomorrow"))==null||v.addEventListener("click",()=>{const T=ce(new Date);T.setDate(T.getDate()+1),p({dueDate:T})}),(w=i.querySelector("#ctx-date-next-week"))==null||w.addEventListener("click",()=>{const T=ce(new Date);T.setDate(T.getDate()+(8-T.getDay())),p({dueDate:T})}),(x=i.querySelector("#ctx-delete"))==null||x.addEventListener("click",()=>{const T=g(),C=T.length>1?`${T.length}件のタスクを削除しますか？`:"削除しますか？";s(()=>{R(C,async()=>{const U=T.map(Q=>nc(Q));await Promise.all(U),l&&toggleSelectionMode(!1)})})})),(_=i.querySelector("#ctx-add-task"))==null||_.addEventListener("click",()=>{s(()=>{const T=document.getElementById("task-input-fld");T&&T.focus()})}),(k=i.querySelector("#ctx-sort-name"))==null||k.addEventListener("click",()=>s(()=>To("title_asc"))),(S=i.querySelector("#ctx-sort-date"))==null||S.addEventListener("click",()=>s(()=>To("dueDate_asc"))),(M=i.querySelector("#ctx-sort-created"))==null||M.addEventListener("click",()=>s(()=>To("createdAt_desc"))),(I=i.querySelector("#ctx-multi-select"))==null||I.addEventListener("click",()=>{s(()=>{toggleSelectionMode(!o)})});const m=T=>{i.contains(T.target)||(i.remove(),document.removeEventListener("click",m))};setTimeout(()=>document.addEventListener("click",m),0)}const xn={isSelectionMode:!1,selectedIds:new Set},er=new Set;function zy(e){return er.add(e),()=>er.delete(e)}function jy(){er.forEach(e=>e({isSelectionMode:xn.isSelectionMode,selectedIds:xn.selectedIds}))}function Mo(e){xn.selectedIds.has(e)?xn.selectedIds.delete(e):xn.selectedIds.add(e),jy()}function Wy(e,t,n={isSelectionMode:!1,selectedIds:new Set},i={}){const{isSelectionMode:s,selectedIds:o}=n,r=o.has(e.id),a=document.createElement("li");a.setAttribute("data-id",e.id);const l=i.duration!==null&&i.duration!==void 0;a.setAttribute("draggable",s||l?"false":"true");const c=e.status==="completed",d=Wu(e.dueDate),u=Vu(e.dueDate),h=!!e.recurrence,f=!!e.dueDate&&!h,g=ue(),p=e.timeBlockId?g.find(k=>k.id===e.timeBlockId):null,m=i.timeBlockId===null||i.timeBlockId===void 0,b=i.duration===null||i.duration===void 0;let y="group flex items-start gap-2 sm:gap-3 py-1.5 px-2 rounded -mx-2 transition-all duration-200 border border-transparent",v="";s?r?v="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 cursor-pointer":v="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-pointer":c?v="opacity-60 bg-gray-50 dark:bg-gray-900/50 cursor-grab active:cursor-grabbing":v="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-grab active:cursor-grabbing",a.className=`${y} ${v}`;let w="",x="";return s?(w=r?"bg-blue-600 border-blue-600 text-white":"border-gray-300 dark:border-gray-600 bg-white dark:bg-transparent hover:border-blue-500",x='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',r||(w+=" text-transparent")):(w=c?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500 cursor-pointer",x='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'),a.innerHTML=`
        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 ${w}">
            ${x}
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center pointer-events-none">
            <div class="col-span-1 sm:col-span-8 flex flex-wrap sm:flex-nowrap items-baseline gap-x-2 gap-y-0.5 pointer-events-auto min-w-0 pr-1">
                <div class="leading-snug truncate font-medium transition-colors ${c&&!s?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"} flex-shrink-0 max-w-full">${e.title}</div>
                ${e.description?`<div class="text-xs text-gray-400 font-light truncate max-w-[180px] sm:max-w-[240px]">${fc(e.description.split(`
`)[0]).replace(/<\/?p[^>]*>/g,"")}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-4 flex items-center sm:justify-end gap-1.5 text-xs h-full mt-1 sm:mt-0 overflow-hidden pointer-events-auto">
                ${h?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${f?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${m?`<div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${p?`${p.start} - ${p.end}`:"時間帯未定"}">
                    <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${p?p.color:"#cbd5e1"}"></span>
                    <span class="truncate font-mono text-[11px]">${p?`${p.start} - ${p.end}`:"未定"}</span>
                </div>`:""}

                ${b?`<div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${e.duration||0}分">
                    <span class="mr-0.5 text-[10px]">⏱️</span>${e.duration||0}m
                </div>`:""}

                ${d?`<div class="flex items-center ${u} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${d}</div>`:""}
            </div>
        </div>
    `,!s&&!l&&(a.addEventListener("dragstart",k=>{if(k.target.closest(".task-checkbox")){k.preventDefault();return}a.classList.add("opacity-50"),k.dataTransfer.setData("text/plain",e.id),k.dataTransfer.setData("application/x-taskmg-id",e.id),k.dataTransfer.effectAllowed="move"}),a.addEventListener("dragend",()=>a.classList.remove("opacity-50"))),a.querySelector(".task-checkbox").addEventListener("click",async k=>{k.stopPropagation(),s?Mo(e.id):await Gu(e.id,c?"todo":"completed")}),a.addEventListener("click",k=>{k.target.closest(".task-checkbox")||(s?Mo(e.id):sf(e))}),a.addEventListener("contextmenu",k=>{k.preventDefault(),k.stopPropagation(),s&&!r&&Mo(e.id),Pd(e,k.clientX,k.clientY)}),a}function Rd(e,t,n,i={isSelectionMode:!1,selectedIds:new Set},s={}){if(!e)return;const o=document.createElement("ul");if(o.id="task-list-ul",o.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2 min-h-[50px]",o.addEventListener("contextmenu",r=>{(r.target===o||r.target.closest("li")===null)&&(r.preventDefault(),Pd(null,r.clientX,r.clientY))}),!t||t.length===0)o.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none select-none">
                タスクがありません
                <div class="text-xs mt-2 opacity-70">右クリックでタスク追加・並び替え</div>
            </li>
        `;else{const r=document.createDocumentFragment();t.forEach(a=>{r.appendChild(Wy(a,n,i,s))}),o.appendChild(r)}e.innerHTML="",e.appendChild(o)}function Nr(e,t,n,i={}){if(!(i.forceExpand||e.dataset.expanded==="true")){e.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,e.querySelector("#show-input-btn").onclick=()=>{e.dataset.expanded="true",Nr(e,t,n,i)};return}const o=ue().map(a=>`<option value="${a.id}">${a.start} - ${a.end}</option>`).join(""),r=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="${q.INPUT.MINIMAL_TEXT}">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="${q.INPUT.MINIMAL_TEXTAREA}"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="${q.SELECT.TRANSPARENT}">
                    <option value="">時間帯 (未定)</option>
                    ${o}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="${q.BUTTON.CANCEL}">キャンセル</button>
                    <button id="submit-task-btn" class="${q.BUTTON.DANGER}">タスクを追加</button>
                </div>
            </div>
        </div>
    `;e.innerHTML=Ks(r,"p-3 animate-fade-in-down"),Uy(e,t,n,i)}function Vy(e,t,n,i){e.innerHTML=`
        <div id="fixed-add-task-btn" class="w-full h-full flex items-center px-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group">
            <div class="w-6 h-6 mr-3 rounded-full text-red-500 bg-red-50 dark:bg-red-900/20 flex items-center justify-center transition-transform group-hover:scale-110 shadow-sm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            </div>
            <span class="text-sm font-medium text-gray-600 dark:text-gray-300">タスクを追加</span>
        </div>
    `,e.querySelector("#fixed-add-task-btn").onclick=()=>{e.classList.add("hidden"),t.innerHTML="",t.classList.remove("hidden"),Nr(t,n,i,{forceExpand:!0,onClose:()=>{t.innerHTML="",t.classList.add("hidden"),e.classList.remove("hidden")}}),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},100)}}function Uy(e,t,n,i={}){const s=e.querySelector("#inline-title-input"),o=e.querySelector("#submit-task-btn"),r=e.querySelector("#cancel-input-btn"),a=e.querySelector("#inline-desc-input"),l=e.querySelector("#inline-timeblock-select");s.focus();const c=()=>{e.dataset.expanded="false",i.onClose?i.onClose():Nr(e,t,n)};r.onclick=c;const d=async()=>{const u=s.value.trim();u&&(o.disabled=!0,await Yy({title:u,description:a.value.trim(),projectId:t,labelIds:n?[n]:[],timeBlockId:l.value||null}),s.value="",a.value="",s.focus(),o.disabled=!1)};o.onclick=d,s.onkeydown=u=>{u.key==="Enter"&&!u.isComposing&&d()}}async function Yy(e){try{await qu(e)}catch(t){console.error(t),R({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function qy(e,t="createdAt_desc"){return Array.isArray(e)?[...e].sort((n,i)=>{switch(t){case"createdAt_asc":return Io(n.createdAt,i.createdAt);case"createdAt_desc":return Io(i.createdAt,n.createdAt);case"dueDate_asc":return Ji(n.dueDate,i.dueDate,(s,o)=>Io(s,o));case"timeBlockId_asc":return Ji(n.timeBlockId,i.timeBlockId,(s,o)=>String(s).localeCompare(String(o)));case"projectId_asc":return Ji(n.projectId,i.projectId,(s,o)=>String(s).localeCompare(String(o)));case"duration_asc":return Ji(n.duration,i.duration,(s,o)=>Number(s)-Number(o));case"title_asc":return(n.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function Io(e,t){const n=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return n(e)-n(t)}function Ji(e,t,n){return e===t?0:e==null||e==="null"?1:t==null||t==="null"?-1:n(e,t)}function Gy(e,t,n){e.innerHTML="";const i=n?rc(n):null,s=t.reduce((l,c)=>{const d=parseInt(c.duration,10);return l+(isNaN(d)?0:d)},0),o=l=>(l/60).toFixed(2)+"h";let r="";if(i&&i.start&&i.end){const l=Xy(i.start,i.end);if(l<=0)return;const c=(l/60).toFixed(2),d=(s/60).toFixed(2),u=Math.min(s/l*100,100),h=s/l*100,f=l-s,g=f<0,m=(Math.abs(f)/60).toFixed(2),b=h>100,y=b?q.PROGRESS_BAR.OVER:q.PROGRESS_BAR.FILLED,v=b?"100%":`${u}%`,w=g?"text-red-500":"text-green-500",x=g?"超過":"残り";r=`
            <div class="mt-2 mb-2 py-2 px-4 bg-gray-50/80 dark:bg-[#1e1e1e]/50 rounded-lg flex items-center gap-4 text-sm border border-gray-100 dark:border-gray-800/50 backdrop-blur-sm">
                <!-- 1. 時間帯名 (左端) -->
                <div class="flex-shrink-0 w-24 truncate text-xs font-bold text-gray-500 dark:text-gray-400" title="${i.name}">
                    ${i.name}
                </div>

                <!-- 2. 進捗時間 (中央左) -->
                <div class="flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums">
                    <span class="font-bold text-gray-700 dark:text-gray-300 w-[4.5ch] text-right inline-block">${d}h</span>
                    <span class="text-gray-400 mx-0.5">/</span>
                    <span class="w-[4.5ch] inline-block">${c}h</span>
                </div>

                <!-- 3. プログレスバー (可変幅) -->
                <div class="${q.PROGRESS_BAR.CONTAINER}">
                     <div class="${y}" style="width: ${v}"></div>
                </div>

                <!-- 4. 詳細情報 (右端) -->
                <div class="flex-shrink-0 flex items-center justify-end gap-3 min-w-[140px]">
                    <div class="text-lg font-bold ${b?"text-red-500":"text-blue-500"} tabular-nums text-right w-[3.5ch]">
                        ${Math.round(h)}<span class="text-xs font-normal opacity-70">%</span>
                    </div>
                    <div class="text-xs ${w} whitespace-nowrap text-right w-[100px]">
                        (${x} ${m}h)
                    </div>
                </div>
            </div>
        `}else{const l=t.length,c=l>0?s/l:0,d=o(s),u=o(c);r=`
            <div class="${q.STATS_BAR.CONTAINER}">
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">COUNT</span>
                    <span class="${q.STATS_BAR.VALUE}">${l}<span class="text-xs font-normal ml-0.5 text-gray-400">件</span></span>
                </div>
                <div class="w-px h-4 bg-gray-200 dark:bg-gray-700"></div>
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">TOTAL</span>
                    <span class="${q.STATS_BAR.VALUE} ${q.STATS_BAR.HIGHLIGHT}">${d}</span>
                </div>
                <div class="w-px h-4 bg-gray-200 dark:bg-gray-700"></div>
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">AVG</span>
                    <span class="font-medium text-sm">${u}<span class="text-xs ml-0.5">/件</span></span>
                </div>
            </div>
        `}const a=document.createElement("div");a.innerHTML=r,e.appendChild(a)}function Xy(e,t){const[n,i]=e.split(":").map(Number),[s,o]=t.split(":").map(Number);let r=n*60+i,a=s*60+o;return a<r&&(a+=1440),a-r}let fe=null;document.addEventListener("request-sort-change",e=>{const{sort:t}=e.detail,n=document.getElementById("sort-select");n&&(n.value=t);const i=document.getElementById("sort-trigger");if(i){i.dataset.value=t;const s=document.getElementById("sort-label");s&&(t==="title_asc"&&(s.textContent="名前順"),t==="dueDate_asc"&&(s.textContent="日付順"))}fe&&Mi(...fe)});zy(()=>{fe&&Mi(...fe)});window.addEventListener("visible-task-count-updated",()=>{fe&&Mi(...fe)});window.addEventListener("sidebar-settings-updated",()=>{fe&&Mi(...fe)});function Mi(e,t,n=[],i={}){const{projectId:s=null,labelId:o=null,timeBlockId:r=null,title:a=""}=i;fe=[e,t,n,i];const l=document.getElementById("task-view");if(!l)return;Ky(e.length,a);const c=document.getElementById("sort-select"),d=document.getElementById("sort-trigger");let u="createdAt_desc";c?u=c.value:d&&d.dataset.value&&(u=d.dataset.value);const h=qy(e,u);l.innerHTML="",l.className="flex flex-col h-full bg-transparent overflow-hidden";const f=document.createElement("div");f.className="w-full px-4 sm:px-6 h-full flex flex-col pt-2",l.appendChild(f);const g=document.createElement("div");g.id="task-list-container";const p=localStorage.getItem("visible_task_count"),m=p?Number(p):10,b=localStorage.getItem(B.STORAGE_KEYS.DENSITY)||"normal",v={compact:42,normal:52,comfortable:64,spacious:76}[b]||52,w=m*v;g.style.height=`${w}px`,g.className="w-full flex-none overflow-y-auto custom-scrollbar pr-2 mb-2 scroll-smooth border-b border-gray-100 dark:border-gray-800",f.appendChild(g),Rd(g,h,t,xn,i);const x=document.createElement("div");x.id="stats-container",x.className="flex-none mb-0 animate-fade-in transition-all duration-300 mt-auto",f.appendChild(x),Gy(x,e,r)}function Ky(e,t){const n=document.getElementById("header-title"),i=document.getElementById("header-count");n&&(n.textContent=t||"インボックス"),i&&(i.textContent=`${e}件`)}let Nt={};function Jy(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Zy(e){Nt={input:e.querySelector("#page-search-input"),select:e.querySelector("#page-search-project"),results:e.querySelector("#search-results-container")}}function Qy(e,t,n,i,s){var r;if(Ue(e,t),e.innerHTML=Py(i),Zy(e),!Nt.input||!Nt.results)return;const o=Jy(()=>$l(n),300);Nt.input.addEventListener("input",o),(r=Nt.select)==null||r.addEventListener("change",()=>$l(n)),Rc({type:"search"}),Pc(),requestAnimationFrame(()=>Nt.input.focus())}function $l(e){var s;const t=Nt.input.value.trim().toLowerCase(),n=((s=Nt.select)==null?void 0:s.value)||null;if(!t){Nt.results.innerHTML=Ry();return}const i=Ls(e,{keyword:t,projectId:n,showCompleted:!0});i.length===0?Nt.results.innerHTML=By():(Nt.results.innerHTML="",Rd(Nt.results,i))}let ge=0;function Le(e){if(e)switch(ge){case 0:Hl(e);break;case 1:tx(e);break;case 2:ex(e);break;case 3:nx(e);break;default:Hl(e),ge=0}}function Js(e){const t="bg-blue-600 text-white font-bold",n="bg-gray-200 dark:bg-gray-700 text-gray-500 font-bold",i="bg-blue-600",s="bg-gray-200 dark:bg-gray-700";return`
    <div class="flex items-center justify-between mb-8">
        <div class="flex items-center space-x-4 mx-auto">
            <div class="w-8 h-8 rounded-full ${e>=1?t:n} flex items-center justify-center">1</div>
            <div class="text-sm font-medium ${e>=1?"text-blue-600 dark:text-blue-400":"text-gray-500"}">Vision</div>
            <div class="w-8 h-1 ${e>=2?i:s}"></div>
            <div class="w-8 h-8 rounded-full ${e>=2?t:n} flex items-center justify-center">2</div>
            <div class="text-sm font-medium ${e>=2?"text-blue-600 dark:text-blue-400":"text-gray-500"}">Strategy</div>
             <div class="w-8 h-1 ${e>=3?i:s}"></div>
             <div class="w-8 h-8 rounded-full ${e>=3?t:n} flex items-center justify-center">3</div>
             <div class="text-sm font-medium ${e>=3?"text-blue-600 dark:text-blue-400":"text-gray-500"}">Action</div>
        </div>
    </div>`}function Hl(e){var t;e.innerHTML=`
        <div class="max-w-4xl mx-auto py-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">目標設計ウィザード</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden">
                <div class="p-8">
                    ${Js(0)}
                
                    <div class="text-center py-12 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-dashed border-gray-300 dark:border-gray-600">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-100">目標設定プロセスを開始</h3>
                        <p class="mt-1 text-sm text-gray-500">Backwards Designアプローチで、ゴールから逆算してタスクを生成します。</p>
                        <div class="mt-6">
                            <button id="wizard-start-btn" type="button" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-colors">
                                開始する
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `,(t=e.querySelector("#wizard-start-btn"))==null||t.addEventListener("click",()=>{ge=1,Le(e)})}function tx(e){var t,n;e.innerHTML=`
        <div class="max-w-4xl mx-auto py-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Step 1: Vision (目的地)</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8">
                ${Js(1)}
                <p class="mb-4 text-gray-700 dark:text-gray-300">あなたが達成したい最終的なゴールは何ですか？（例：3ヶ月後にWebアプリをリリースする）</p>
                <textarea class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition" rows="4" placeholder="ゴールを具体的に記述..."></textarea>
                
                <div class="mt-6 flex justify-between">
                    <button id="wizard-back-btn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition">戻る</button>
                    <button id="wizard-next-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition">次へ: Strategy</button>
                </div>
            </div>
        </div>
    `,(t=e.querySelector("#wizard-back-btn"))==null||t.addEventListener("click",()=>{ge=0,Le(e)}),(n=e.querySelector("#wizard-next-btn"))==null||n.addEventListener("click",()=>{ge=2,Le(e)})}function ex(e){var t,n;e.innerHTML=`
        <div class="max-w-4xl mx-auto py-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Step 2: Strategy (戦略)</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8">
                ${Js(2)}
                <p class="mb-4 text-gray-700 dark:text-gray-300">そのゴールを達成するために、どのような戦略やマイルストーンが必要ですか？</p>
                <div class="space-y-4">
                     <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent dark:bg-gray-700" placeholder="マイルストーン 1 (例: MVPの機能定義完了)">
                     <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent dark:bg-gray-700" placeholder="マイルストーン 2 (例: データベース設計完了)">
                     <input type="text" class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent dark:bg-gray-700" placeholder="マイルストーン 3 (例: フロントエンド実装)">
                </div>
                
                <div class="mt-6 flex justify-between">
                    <button id="wizard-back-btn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition">戻る</button>
                    <button id="wizard-next-btn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 shadow-md transition">次へ: Action</button>
                </div>
            </div>
        </div>
    `,(t=e.querySelector("#wizard-back-btn"))==null||t.addEventListener("click",()=>{ge=1,Le(e)}),(n=e.querySelector("#wizard-next-btn"))==null||n.addEventListener("click",()=>{ge=3,Le(e)})}function nx(e){var t,n;e.innerHTML=`
        <div class="max-w-4xl mx-auto py-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Step 3: Action (行動)</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 p-8">
                ${Js(3)}
                <p class="mb-4 text-gray-700 dark:text-gray-300">今日からできる具体的なアクションアイテムに分解しましょう。</p>
                <textarea class="w-full p-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-transparent dark:bg-gray-700 focus:ring-2 focus:ring-blue-500 outline-none transition" rows="6" placeholder="- [ ] リポジトリを作成する
- [ ] READMEを書く
- [ ] UIデザインをスケッチする"></textarea>
                
                <div class="mt-6 flex justify-between">
                    <button id="wizard-back-btn" class="px-4 py-2 text-gray-600 dark:text-gray-400 hover:text-gray-900 dark:hover:text-white transition">戻る</button>
                    <button id="wizard-finish-btn" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 shadow-md transition flex items-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
                        完了してダッシュボードへ
                    </button>
                </div>
            </div>
        </div>
    `,(t=e.querySelector("#wizard-back-btn"))==null||t.addEventListener("click",()=>{ge=2,Le(e)}),(n=e.querySelector("#wizard-finish-btn"))==null||n.addEventListener("click",()=>{alert("目標が作成されました！（機能は未実装）"),ge=0,Le(e)})}function ix(e){e&&(e.innerHTML=`
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold mb-2 text-gray-900 dark:text-white">Target Insight</h2>
            <p class="mb-8 text-gray-500 dark:text-gray-400">厳選した重要目標の戦略的進捗と分析</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Goal 1 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Project A: Launch</h3>
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 text-xs rounded-full">On Track</span>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <div class="text-xs text-gray-500 mb-1">Backup Design Timeline</div>
                            <div class="h-24 bg-gray-50 dark:bg-gray-700/50 rounded-lg flex items-center justify-center text-gray-400 text-xs border border-dashed border-gray-200 dark:border-gray-600">
                                Gantt Chart Visualization
                            </div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500 mb-1">Progress</div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: 65%"></div>
                            </div>
                            <div class="text-right text-xs text-gray-400 mt-1">65%</div>
                        </div>
                    </div>
                </div>

                <!-- Goal 2 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                     <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Skill Acquisition</h3>
                        <span class="px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-300 text-xs rounded-full">At Risk</span>
                    </div>
                     <div class="space-y-4">
                        <div>
                            <div class="text-xs text-gray-500 mb-1">WOOP Analysis</div>
                             <div class="p-3 bg-yellow-50 dark:bg-yellow-900/10 rounded text-sm text-gray-600 dark:text-gray-300 border border-yellow-100 dark:border-yellow-900/20">
                                <span class="font-bold text-yellow-700 dark:text-yellow-500">Obstacle:</span> 時間不足<br>
                                <span class="font-bold text-green-700 dark:text-green-500">Plan:</span> 朝6時に起きて30分確保
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- Goal 3 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                     <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Network Growth</h3>
                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-300 text-xs rounded-full">Completed</span>
                    </div>
                     <div class="space-y-4">
                        <div class="text-center py-6">
                            <div class="text-4xl font-bold text-gray-900 dark:text-white mb-1">120<span class="text-lg text-gray-400 font-normal">/100</span></div>
                            <div class="text-sm text-gray-500">Key Results Achieved</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `)}function sx(e){e&&(e.innerHTML=`
        <div class="max-w-4xl mx-auto py-6">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Framework Wiki</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-blue-400">GTD (Getting Things Done)</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                        「頭の中を空っぽにする」ストレスフリーの仕事術。全ての気になることを収集し、処理し、整理するプロセス。
                    </p>
                    <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                        <li>Capture (収集)</li>
                        <li>Clarify (明確化)</li>
                        <li>Organize (整理)</li>
                        <li>Reflect (見直し)</li>
                        <li>Engage (実行)</li>
                    </ul>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-green-600 dark:text-green-400">WOOP</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                        願望を実現するためのメンタル・コントラスティング戦略。
                    </p>
                    <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                        <li>Wish (願い)</li>
                        <li>Outcome (結果)</li>
                        <li>Obstacle (障害)</li>
                        <li>Plan (計画) - If/Thenプランニング</li>
                    </ul>
                </div>
                 <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-purple-600 dark:text-purple-400">OKR</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                         Objectives and Key Results. 野心的な目標と測定可能な成果指標を設定する。
                    </p>
                </div>
            </div>
        </div>
    `)}let Y={type:"inbox",id:null},nt=null;const zl={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function ox(){if(nt)return;const{VIEW_IDS:e}=vr;nt={task:document.getElementById(e.TASK),dashboard:document.getElementById(e.DASHBOARD),search:document.getElementById(e.SEARCH),settings:document.getElementById(e.SETTINGS),wizard:document.getElementById(e.WIZARD),targetDashboard:document.getElementById(e.TARGET_DASHBOARD),wiki:document.getElementById(e.WIKI)}}function dn(e,t=[],n=[]){if(e.type==="settings"){zs();return}Y=e,kg(Y),Rc(Y,t,n)}function rx(e,t,n,i=[],s=[]){if(ox(),!nt.task)return;const o=document.getElementById(zl.SORT),r=(o==null?void 0:o.dataset.value)||"createdAt_desc",a=Object.values(nt).filter(f=>f);if(Y.type==="dashboard"){Ue(nt.dashboard,a.filter(f=>f!==nt.dashboard)),nt.dashboard.innerHTML=Od(),Ny(e),un(!1);return}if(Y.type==="search"){Ue(nt.search,a.filter(f=>f!==nt.search)),Qy(nt.search,e,t,Y),un(!0,null,null);return}if(Y.type==="wizard"){nt.wizard&&(Ue(nt.wizard,a.filter(f=>f!==nt.wizard)),Le(nt.wizard),un(!1));return}if(Y.type==="target-dashboard"){nt.targetDashboard&&(Ue(nt.targetDashboard,a.filter(f=>f!==nt.targetDashboard)),ix(nt.targetDashboard),un(!1));return}if(Y.type==="wiki"){nt.wiki&&(Ue(nt.wiki,a.filter(f=>f!==nt.wiki)),sx(nt.wiki),un(!1));return}Ue(nt.task,a.filter(f=>f!==nt.task));const l=document.getElementById(zl.COMPLETED_TOGGLE),c=l?l.classList.contains("text-blue-500"):!1,d=()=>{var f,g,p,m;switch(Y.type){case"inbox":return"インボックス";case"project":return((f=t.find(b=>b.id===Y.id))==null?void 0:f.name)||"プロジェクト";case"label":return((g=n.find(b=>b.id===Y.id))==null?void 0:g.name)||"ラベル";case"timeblock":return Y.id==="unassigned"||Y.id==="none"?"未定":((p=i.find(b=>b.id===Y.id))==null?void 0:p.name)||"時間帯";case"duration":return`${Y.id}分`;case"filter":case"custom":return((m=s.find(b=>b.id===Y.id))==null?void 0:m.name)||"フィルター";case"today":return"今日";case"upcoming":return"今後";case"wizard":return"目標設計ウィザード";case"target-dashboard":return"目標ダッシュボード";case"wiki":return"フレームワークWiki";default:return Y.id?Y.id:"タスク"}},u={keyword:"",showCompleted:c,projectId:Y.type==="inbox"?"unassigned":Y.type==="project"?Y.id:null,labelId:Y.type==="label"?Y.id:null,timeBlockId:Y.type==="timeblock"?Y.id:null,duration:Y.type==="duration"?Y.id:null,savedFilter:Y.type==="custom"||Y.type==="filter"?s.find(f=>f.id===Y.id):null,sortCriteria:r,title:d()};if(u.savedFilter&&!u.timeBlockId){const g=(u.savedFilter.query||"").match(/timeblock:([^ ]+)/);if(g){const p=g[1].split(",");p.length>0&&p[0]!=="null"&&p[0]!=="none"&&(u.timeBlockId=p[0])}}const h=eg(e,u);Mi(h,t,n,u),un(!0,u.projectId,u.labelId)}function un(e,t=null,n=null){const i=document.getElementById("footer-add-btn-container"),s=document.getElementById("footer-input-form-container");i&&s&&(e?(i.classList.remove("hidden"),s.classList.add("hidden"),s.innerHTML="",Vy(i,s,t,n)):(i.classList.add("hidden"),s.classList.add("hidden")))}const jt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null};let nr=!1,Ao=null;function Ze(){Ao||(Ao=requestAnimationFrame(()=>{const e=Fn.tasks(),t=Fn.projects(),n=Fn.labels(),i=Fn.timeBlocks(),s=Fn.filters();rx(e,t,n,i,s),Ao=null}))}function Nn(e){document.dispatchEvent(new CustomEvent(e)),Ze()}function ax(e){if(!(W!=null&&W.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}Fr(!1);const t=Zt();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}nr=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),jt.tasks=yh(t,()=>Nn(gt.TASKS_UPDATED)),jt.projects=dh(t,()=>Nn(gt.PROJECTS_UPDATED)),jt.labels=sh(t,()=>Nn(gt.LABELS_UPDATED)),jt.timeBlocks=gh(t,()=>Nn(gt.TIMEBLOCKS_UPDATED)),jt.filters=Zu(t,()=>Nn(gt.FILTERS_UPDATED))}function Fr(e=!1){(nr||e)&&console.log("[DataSync] Stopping data sync..."),Object.keys(jt).forEach(t=>{t==="workspaces"&&!e||typeof jt[t]=="function"&&(jt[t](),jt[t]=null)}),ph(),Ju(),nr=!1,Ze()}const Fn={tasks:Dn,projects:hr,labels:nh,timeBlocks:ue,filters:ic,workspaceId:()=>Zt()};function Bd(){return jt.workspaces}function Nd(e){jt.workspaces=e}function lx(){const e=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),n=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!e||!t||!n)return;const s=r=>{r?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",o)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",o))},o=r=>{r&&(t.contains(r.target)||e.contains(r.target))||s(!1)};e.addEventListener("click",r=>{r.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(r=>{r.addEventListener("click",a=>{const l=r.dataset.value,c=r.textContent;n.textContent=c,e.dataset.value=l,Ze(),s(!1)})}),e.dataset.value||(e.dataset.value="createdAt_desc",n.textContent="作成日(新しい順)")}function cx(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function dx(){var n;let e=!0;document.addEventListener(gt.WORKSPACE_CHANGED,i=>{const{workspaceId:s}=i.detail;console.log("[EventManager] Workspace changed to:",s);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),W!=null&&W.currentUser){if(e)if(e=!1,gg()){const r=fg();r&&dn({type:r})}else try{const r=JSON.parse(localStorage.getItem("lastPage"));r&&r.page==="settings"?dn({type:"inbox"}):dn(r?{type:r.page,id:r.id||null}:{type:"inbox"})}catch{dn({type:"inbox"})}else dn({type:"inbox",id:null});Fr(!1),ax(),Ze()}}),document.addEventListener(gt.ROUTE_CHANGE,i=>{const{page:s,id:o}=i.detail;dn({type:s,id:o||null}),s!=="settings"&&localStorage.setItem("lastPage",JSON.stringify({page:s,id:o||null})),Ze()});const t=cx(()=>Ze(),300);(n=document.getElementById("search-input"))==null||n.addEventListener("input",t),lx()}function ux(){try{Jd()}catch(e){console.error("Firebase Initialization Failed",e);return}Cu(),Vh(),ks(),_u(),Sh(),uc(),Ul(),dx(),hx()}function hx(){W&&Ud(W,e=>{iu(e),e?fx(e):gx()})}function fx(e){pg();const t=Bd();typeof t=="function"&&t();const n=lu(e.uid,i=>{hc(i)});Nd(n)}function gx(){const e=Bd();typeof e=="function"&&(e(),Nd(null)),Fr(!0),Sg(),Ul()}function px(){ux()}let jl=!1;function mx(e){const t=document.createElement("div");t.id=vg.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const n=t.querySelector("#error-code-box");n&&(n.textContent=e.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function bx(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const e=document.createElement("link");e.rel="icon",e.type="image/png",e.href=xg.FAVICON,document.head.appendChild(e)}async function Wl(){if(!jl){jl=!0;try{bx(),await px()}catch(e){console.error("[Main] Critical Initialization Error:",e),mx(e)}}}(()=>{if(document.readyState==="loading"){const e=()=>{document.removeEventListener("DOMContentLoaded",e),Wl()};document.addEventListener("DOMContentLoaded",e)}else Wl()})();
