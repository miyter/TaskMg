var Rd=Object.defineProperty;var Bd=(e,t,n)=>t in e?Rd(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var D=(e,t,n)=>Bd(e,typeof t!="symbol"?t+"":t,n);import{getAuth as Fd,signInAnonymously as Nd,signInWithEmailAndPassword as $d,updatePassword as Hd,signOut as zd,onAuthStateChanged as jd}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as Wd,updateDoc as yi,doc as Nt,addDoc as qe,collection as gt,serverTimestamp as Qe,deleteDoc as xi,query as tn,orderBy as Qo,onSnapshot as wn,getDocs as qn,limit as Vd,Timestamp as tr,getDoc as Ud,setDoc as Yd}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as qd}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const Rr={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let Xi,W,K,fs=!1;function Gd(){if(fs)return;const e=Xd();if(e!=null&&e.apiKey)try{Xi=qd(e),W=Fd(Xi),K=Wd(Xi),fs=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function Xd(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&Rr){const e=Rr,t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function Hl(){if(!fs)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:Xi,auth:W,db:K}}function Kd(e,t,n){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${n?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${e.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${e.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function Jd(e){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",t="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const n=e.type==="confirm";!n&&e.okText==="OK"&&(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",Kd(e,t,n));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),o=document.getElementById("msg-modal-body"),r=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=e.title,o.textContent=e.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!n&&l()};document.addEventListener("keydown",c),r.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!n&&l()},r.focus()}function R(e,t=null){let n={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof e=="object"&&e!==null?n={...n,...e}:(n.message=String(e),typeof t=="function"?(n.type="confirm",n.onConfirm=t):typeof t=="string"&&(n.type=t)),Jd(n)}async function Zd(e,t){if(!fs)throw new Error("Firebaseが初期化されていないぞ。");try{return await $d(W,e,t)}catch(n){let i="ログインに失敗した。";switch(n.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function Qd(e){const t=W.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await Hd(t,e),R({message:"パスワードを変更したぞ",type:"success"})}catch(n){let i="変更に失敗した: "+n.message;throw n.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),R({message:i,type:"error"}),n}}function zl(){const e=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),n=document.getElementById("password-input"),i=document.getElementById("guest-login-btn");if(e&&t&&n){const s=async()=>{const o=t.value.trim(),r=n.value.trim();if(!o||!r)return R({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await Zd(o,r)}catch(a){R({message:a.message,type:"error"})}};e.onclick=s,n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&s()})}i&&(i.onclick=async()=>{try{await Nd(W),R({message:"ゲストとしてログインしたぞ。データは一時的に保持される。",type:"success"})}catch(s){console.error(s),R({message:"ゲストログインに失敗した: "+s.message,type:"error"})}})}function tu(e){const t=document.getElementById("login-form-container")||document.getElementById("login-container-wrapper"),n=document.getElementById("user-info"),i=document.getElementById("user-email-display"),s=document.getElementById("email-input"),o=document.getElementById("password-input");e?(e.uid,t&&t.classList.add("hidden"),n&&(n.classList.remove("hidden"),n.classList.add("flex")),i&&(i.textContent=e.isAnonymous?"ゲストユーザー":e.email||"ユーザー")):(t&&t.classList.remove("hidden"),n&&(n.classList.add("hidden"),n.classList.remove("flex")),s&&(s.value=""),o&&(o.value=""),i&&(i.textContent=""))}const eu={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},B={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DENSITY_LEVELS:{COMPACT:"compact",NORMAL:"normal",COMFORTABLE:"comfortable",SPACIOUS:"spacious"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},CLASSES:{CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},COLORS:{DEFAULT:"#CBD5E0"},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order"},LIST_IDS:{PROJECTS:"project-list",LABELS:"label-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list",TARGETS:"target-tool-list",BASIC:"basic-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function jl(e,t){if(!t||!e)return;let n=!1,i=null,s=null;const o=()=>{i!==null&&e&&(e.style.width=`${i}px`),s=null},r=l=>{if(!n)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=B;i=Math.max(c,Math.min(d,l.clientX)),s||(s=requestAnimationFrame(o))},a=()=>{n&&(n=!1,document.body.classList.remove("cursor-col-resize","select-none"),e.style.transition="",s&&cancelAnimationFrame(s),s=null,o(),localStorage.setItem(B.STORAGE_KEYS.WIDTH,e.offsetWidth),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a))};t.addEventListener("mousedown",l=>{er()&&(n=!0,document.body.classList.add("cursor-col-resize","select-none"),e.style.transition="none",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))})}function er(){return window.innerWidth>=768}function nr(e,t=!1){const n=localStorage.getItem(e);return n===null?t:n==="true"||n==="compact"}function kn(){const e=localStorage.getItem(B.STORAGE_KEYS.DENSITY);return e&&Object.values(B.DENSITY_LEVELS).includes(e)?e:nr(B.STORAGE_KEYS.COMPACT,!1)?B.DENSITY_LEVELS.COMPACT:B.DENSITY_LEVELS.NORMAL}function nu(){return kn()===B.DENSITY_LEVELS.COMPACT}function gs(e,t){return Array.isArray(e)?e.filter(n=>n.status!=="completed"&&t(n)).length:0}function iu(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function dn(e){return`artifacts/${iu()}/users/${e}`}function Br(e,t){return`${dn(e)}/workspaces/${t}`}const G={users:e=>dn(e),filters:e=>`${dn(e)}/filters`,labels:e=>`${dn(e)}/labels`,workspaces:e=>`${dn(e)}/workspaces`,timeblocks:e=>`${dn(e)}/timeblocks`,tasks:(e,t)=>`${Br(e,t)}/tasks`,projects:(e,t)=>`${Br(e,t)}/projects`},ps="currentWorkspaceId",su="workspace-changed";let Di=null,ir=[];function Mo(){return ir}function ou(e,t){const n=typeof t=="function"?t:()=>{};if(!e)return n([]),()=>{};Di&&Di();const i=G.workspaces(e),s=tn(gt(K,i),Qo("createdAt","asc"));return Di=wn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));if(ir=r,r.length===0&&!o.metadata.hasPendingWrites)n([]),ru().catch(a=>console.error("[Workspace] Default creation error:",a));else{const a=au(r);n(r),Wl(a,r)}},o=>{console.error("[Workspace] Subscription error:",o),n([])}),Di}async function ru(){try{const e=W.currentUser;if(!e)return;const t=G.workspaces(e.uid);(await qn(tn(gt(K,t),Vd(1)))).empty&&await Vl("メイン")}catch(e){console.error("[Workspace] Failed to ensure default workspace:",e)}}function au(e){if(e.length===0)return null;let t=Zt();const n=e.some(i=>i.id===t);return(!t||!n)&&(t=e[0].id,localStorage.setItem(ps,t)),t}function Zt(){return localStorage.getItem(ps)}function sr(e){!e||localStorage.getItem(ps)===e||(localStorage.setItem(ps,e),Wl(e,ir))}function Wl(e,t){const n=new CustomEvent(su,{detail:{workspaceId:e,workspaces:t}});document.dispatchEvent(n)}async function Vl(e){try{const t=W.currentUser;if(!t)throw new Error("Authentication required");const n=G.workspaces(t.uid);return{id:(await qe(gt(K,n),{name:e,createdAt:Qe()})).id,name:e}}catch(t){throw console.error("[Workspace] Add error:",t),R("ワークスペースの作成に失敗した。"),t}}async function lu(e,t){try{const n=W.currentUser;if(!n)throw new Error("Authentication required");const i=G.workspaces(n.uid);await yi(Nt(K,i,e),{name:t})}catch(n){console.error("[Workspace] Update error:",n),R("名前の更新に失敗した。")}}async function cu(e){try{const t=W.currentUser;if(!t)throw new Error("Authentication required");const n=G.workspaces(t.uid);await xi(Nt(K,n,e))}catch(t){console.error("[Workspace] Delete error:",t),R("削除に失敗した。")}}const q={BUTTON:{PRIMARY:"bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold py-1.5 px-4 rounded-lg transition-all active:scale-95 shadow-sm",DANGER:"bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm",SECONDARY:"text-sm font-medium text-gray-500 hover:text-gray-800 transition",CANCEL:"text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition"},INPUT:{DEFAULT:"w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition",MINIMAL_TEXT:"w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100",MINIMAL_TEXTAREA:"w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"},SELECT:{TRANSPARENT:"bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer"},TEXT:{LABEL:"block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider"},PROGRESS_BAR:{CONTAINER:"flex-1 relative h-3 bg-gray-200 dark:bg-gray-700/50 rounded-full overflow-hidden min-w-[100px]",FILLED:"h-full bg-gradient-to-r from-blue-500 to-indigo-600 rounded-full transition-all duration-500 ease-out shadow-sm",OVER:"h-full bg-red-500 rounded-full transition-all duration-500 ease-out shadow-sm"},STATS_BAR:{CONTAINER:"mt-2 mb-2 py-2 px-4 bg-gray-50/80 dark:bg-[#1e1e1e]/50 rounded-lg flex items-center justify-evenly text-sm border border-gray-100 dark:border-gray-800/50 backdrop-blur-sm",ITEM:"flex flex-row items-baseline gap-2",LABEL:"text-[10px] text-gray-500 dark:text-gray-400 uppercase tracking-wider font-bold",VALUE:"font-bold text-sm text-gray-700 dark:text-gray-200",HIGHLIGHT:"text-blue-600 dark:text-blue-400"},MODAL:{CONTAINER:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 backdrop-blur-sm",DIALOG:"bg-white dark:bg-gray-800 rounded-xl shadow-2xl overflow-hidden",WIDTH:{DEFAULT:"max-w-5xl w-full"}},CARD:{GLASS:"bg-white/70 dark:bg-gray-900/70 backdrop-blur-md border border-gray-200/50 dark:border-gray-700/50 rounded-xl shadow-lg"}};function Tn(e,t,n,i,s=!1){return`
        <div class="settings-accordion border-b border-gray-100 dark:border-gray-700 last:border-0" data-section="${e}">
            <button class="accordion-header w-full flex items-center justify-between py-4 px-2 focus:outline-none group hover:bg-gray-50 dark:hover:bg-gray-700/30 rounded-lg transition-colors">
                <div class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest group-hover:text-blue-500 transition-colors">
                    ${n}
                    ${t}
                </div>
                <svg class="accordion-icon w-5 h-5 text-gray-400 transform transition-transform duration-300 ${s?"rotate-180":""}" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
            </button>
            <div class="accordion-content overflow-hidden transition-all duration-300 ease-in-out ${s?"max-h-[1000px] opacity-100":"max-h-0 opacity-0"}" style="${s?"":"max-height: 0px;"}">
                <div class="pt-2 pb-6 px-2">
                    ${i}
                </div>
            </div>
        </div>
    `}function Ot(e,t,n,i,s=""){return`
        <label class="flex items-center justify-center gap-2 cursor-pointer p-3 border ${i?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300"} rounded-lg transition-all duration-200">
            <input type="radio" name="${e}" value="${t}" class="hidden" ${i?"checked":""}>
            ${s}
            <span class="text-sm font-medium">${n}</span>
        </label>
    `}function Fr(e,t,n,i){const s=t.map(o=>`<option value="${o.value}" ${o.value===n?"selected":""}>${o.label}</option>`).join("");return`
        <div>
            <label for="${i}" class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">${e}</label>
            <div class="relative">
                <select id="${i}" name="${i}" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                    ${s}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>
    `}const Bn={NONE:"none",TEXTURE:"haikei"},du=[{value:"Asia/Tokyo",label:"日本 (JST/UTC+9)"},{value:"America/Los_Angeles",label:"アメリカ・太平洋 (PST/UTC-8)"},{value:"America/New_York",label:"アメリカ・東部 (EST/UTC-5)"},{value:"Asia/Shanghai",label:"中国・台湾 (CST/UTC+8)"},{value:"Europe/London",label:"イギリス (GMT/UTC+0)"}];function uu(e,t,n,i){const s=n||(i?"compact":"normal");return`
        <div class="space-y-6">
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">テーマ</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Ot("app-theme","light","ライト",e==="light",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                    ${Ot("app-theme","dark","ダーク",e==="dark",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
                </div>
            </div>
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークモード)</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Ot("bg-pattern",Bn.NONE,"無地",t===Bn.NONE)}
                    ${Ot("bg-pattern",Bn.TEXTURE,"テクスチャ",t===Bn.TEXTURE)}
                </div>
            </div>
            <div>
                 <label for="timezone-select" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タイムゾーン</label>
                 <div class="relative">
                     ${(()=>{const o=localStorage.getItem("timezone")||"Asia/Tokyo";return`
                        <select id="timezone-select" name="timezone-select" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                            ${du.map(r=>`<option value="${r.value}" ${r.value===o?"selected":""}>${r.label}</option>`).join("")}
                        </select>
                        `})()}
                    <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                    </div>
                </div>
            </div>
            <div>
                <div class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">サイドバーとUI密度</div>
                <div class="grid grid-cols-2 gap-3">
                    ${Ot("sidebar-density","compact","Compact",s==="compact")}
                    ${Ot("sidebar-density","normal","Standard",s==="normal")}
                    ${Ot("sidebar-density","comfortable","Comfortable",s==="comfortable")}
                    ${Ot("sidebar-density","spacious","Spacious",s==="spacious")}
                </div>
            </div>
            <div>
                 <label for="visible-task-count" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">タスク一覧の表示数</label>
                 <div class="relative">
                     ${(()=>{const o=localStorage.getItem("visible_task_count")||"10";return`
                     <select id="visible-task-count" name="visible-task-count" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                        ${[7,8,9,10,11,12].map(r=>`<option value="${r}" ${String(r)===o?"selected":""}>${r}件</option>`).join("")}
                     </select>
                        `})()}
                     <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                         <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                     </div>
                 </div>
            </div>
        </div>
    `}const Nr={EN:[{value:"Inter",label:"Inter"},{value:"Roboto",label:"Roboto"},{value:"Segoe UI",label:"Segoe UI"},{value:'-apple-system, BlinkMacSystemFont, "San Francisco", "Helvetica Neue", sans-serif',label:"San Francisco"},{value:'"Google Sans", "Open Sans"',label:"Google Sans"}],JP:[{value:'"Hiragino Kaku Gothic ProN", "Hiragino Sans"',label:"ヒラギノ角ゴ"},{value:'"Noto Sans JP"',label:"Noto Sans JP"},{value:'"LINE Seed JP"',label:"LINE Seed JP"},{value:'"M PLUS 2"',label:"M PLUS 2"},{value:'"BIZ UDPGothic"',label:"BIZ UDPゴシック"}]},ms={FONT_EN:"font_family_en",FONT_JP:"font_family_jp"},bs={EN:"Inter",JP:"M PLUS 2"};function hu(){const e=localStorage.getItem(ms.FONT_EN)||bs.EN,t=localStorage.getItem(ms.FONT_JP)||bs.JP,n=document.documentElement;n.style.setProperty("--font-en",`"${e}"`),n.style.setProperty("--font-jp",`"${t}"`)}function fu(){return{en:localStorage.getItem(ms.FONT_EN)||bs.EN,jp:localStorage.getItem(ms.FONT_JP)||bs.JP}}function gu(){const e=localStorage.getItem("fontSize")||"md",t=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e}`)}const Ht={SMALL:"sm",BASE:"base",MEDIUM:"md",LARGE:"lg",XL:"xl"};function pu(){const e=fu();return`
        <div class="space-y-4">
            ${Fr("英数字フォント",Nr.EN,e.en,"font-en-select")}
            ${Fr("日本語フォント",Nr.JP,e.jp,"font-jp-select")}
        </div>
    `}function mu(e){return`
        <div class="grid grid-cols-5 gap-2">
            ${Ot("font-size",Ht.SMALL,"Small",e===Ht.SMALL)}
            ${Ot("font-size",Ht.BASE,"Base",e===Ht.BASE)}
            ${Ot("font-size",Ht.MEDIUM,"Medium",e===Ht.MEDIUM)}
            ${Ot("font-size",Ht.LARGE,"Large",e===Ht.LARGE)}
            ${Ot("font-size",Ht.XL,"XL",e===Ht.XL)}
        </div>
    `}function bu(){return`
        <div class="space-y-3">
            <button id="export-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">バックアップを作成</span>
                    <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">現在の全データをJSON形式でダウンロード</div>
            </button>
            
            <button id="import-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                 <div class="flex justify-between items-center">
                    <span class="text-sm font-bold text-gray-700 dark:text-gray-200">データを復元</span>
                     <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                </div>
                <div class="text-xs text-gray-500 mt-1">バックアップファイルからデータを読み込み</div>
            </button>
            <input type="file" id="import-file-input" accept=".json" class="hidden" />
        </div>
    `}function yu(e,t){return`
         <div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-100 dark:border-gray-700">
            <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                ${e||"?"}
            </div>
            <div>
                <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                <div class="text-xs text-gray-500 font-mono">${t}</div>
            </div>
        </div>
        <div class="space-y-3">
            <div class="flex gap-2">
                <input type="password" id="new-password-input-new" placeholder="新しいパスワード" class="flex-1 px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                <button id="update-password-btn-new" class="px-4 py-2 bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-bold rounded-lg transition-colors whitespace-nowrap">変更</button>
            </div>
            <button id="logout-btn-settings" class="w-full py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-medium rounded-lg transition-colors text-left flex items-center gap-2 px-2">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                ログアウト
            </button>
        </div>
    `}function xu(e,t,n){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||Ht.MEDIUM,o=localStorage.getItem("background")||Bn.NONE,r=localStorage.getItem("sidebar_density"),a=uu(i,o,r,n),l=pu(),c=mu(s),d=bu(),u=yu(e,t);return`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl ${q.MODAL.WIDTH.DEFAULT} overflow-hidden flex flex-col max-h-[90vh] h-full sm:h-auto animate-fade-in-up">
            <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10 sticky top-0">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">Settings</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="overflow-y-auto custom-scrollbar flex-1 bg-white dark:bg-gray-800">
                <div class="p-6 grid grid-cols-1 lg:grid-cols-2 gap-8 items-start">
                    <!-- Left Column -->
                    <div class="space-y-0">
                        ${Tn("appearance","Appearance",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>',a,!0)}
                        ${Tn("data","Data Management",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>',d)}
                    </div>

                    <!-- Right Column -->
                    <div class="space-y-0">
                        ${Tn("typography","Typography",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>',l)}
                        ${Tn("fontsize","Font Size",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>',c)}
                        ${Tn("account","Account",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>',u)}
                    </div>
                </div>
            </div>
        </div>
    `}const xe={FONT_EN:"font_family_en",FONT_JP:"font_family_jp",FONT_SIZE:"fontSize",DENSITY:B.STORAGE_KEYS.DENSITY},Mi={FONT_EN:"Inter",FONT_JP:"M PLUS 2",FONT_SIZE:"md",DENSITY:"normal"};function vi(){return{fontEn:localStorage.getItem(xe.FONT_EN)||Mi.FONT_EN,fontJp:localStorage.getItem(xe.FONT_JP)||Mi.FONT_JP,fontSize:localStorage.getItem(xe.FONT_SIZE)||Mi.FONT_SIZE,density:localStorage.getItem(xe.DENSITY)||Mi.DENSITY}}function Ul(){const e=vi(),t=document.documentElement;t.style.setProperty("--font-en",`"${e.fontEn}"`),t.style.setProperty("--font-jp",`"${e.fontJp}"`)}function Yl(){const e=vi(),t=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e.fontSize}`)}function ql(){const e=vi(),n=["compact","normal","comfortable","spacious"].map(i=>`app-density-${i}`);document.body.classList.remove(...n),document.body.classList.add(`app-density-${e.density}`)}function vu(){Ul(),Yl(),ql()}function wu(e){e&&vi()}function or(){window.dispatchEvent(new CustomEvent("ui-settings-changed",{detail:vi()}))}function $r(e,t){const n=e==="EN"?xe.FONT_EN:xe.FONT_JP;localStorage.setItem(n,t),Ul(),or()}function ku(e){localStorage.setItem(xe.FONT_SIZE,e),Yl(),or()}function _u(e){localStorage.setItem(xe.DENSITY,e),e==="compact"?localStorage.setItem(B.STORAGE_KEYS.COMPACT,"true"):localStorage.setItem(B.STORAGE_KEYS.COMPACT,"false"),ql(),or(),window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{density:e}}))}function ys(e,t,n){const i=document.querySelectorAll(`input[name="${e}"]`),s=localStorage.getItem(t),o=["border-blue-500","bg-blue-50","dark:bg-blue-900/20","text-blue-700","dark:text-blue-300"],r=["border-gray-200","dark:border-gray-700","hover:bg-gray-50","dark:hover:bg-gray-700/50","text-gray-600","dark:text-gray-300"],a=l=>{i.forEach(c=>{const d=c.parentElement;c===l?(d.classList.remove(...r),d.classList.add(...o)):(d.classList.remove(...o),d.classList.add(...r))})};if(i.forEach(l=>{l.addEventListener("change",c=>{const d=c.target.value;localStorage.setItem(t,d),a(c.target),n(d)})}),s)i.forEach(l=>{l.value===s&&(l.checked=!0)});else{const l=Array.from(i).find(c=>c.checked);l&&localStorage.setItem(t,l.value)}}function Su(){document.querySelectorAll(".accordion-header").forEach(t=>{t.addEventListener("click",()=>{const n=t.parentElement,i=n.querySelector(".accordion-content"),s=t.querySelector(".accordion-icon"),o=i.style.maxHeight!=="0px"&&i.style.maxHeight!=="";document.querySelectorAll(".settings-accordion").forEach(r=>{if(r!==n){const a=r.querySelector(".accordion-content"),l=r.querySelector(".accordion-icon");a.style.maxHeight="0px",a.classList.remove("opacity-100"),a.classList.add("opacity-0"),l.classList.remove("rotate-180")}}),o?(i.style.maxHeight="0px",i.classList.remove("opacity-100"),i.classList.add("opacity-0"),s.classList.remove("rotate-180")):(i.style.maxHeight=i.scrollHeight+"px",i.classList.remove("opacity-0"),i.classList.add("opacity-100"),s.classList.add("rotate-180"))})}),document.querySelectorAll(".settings-accordion").forEach(t=>{const n=t.querySelector(".accordion-content");n.classList.contains("opacity-100")&&(n.style.maxHeight=n.scrollHeight+"px")})}function Eu(){ys("sidebar-density","sidebar_density",e=>{_u(e)})}function Du(){ys("font-size","fontSize",n=>{ku(n)});const e=document.querySelector('select[name="font-en-select"]'),t=document.querySelector('select[name="font-jp-select"]');e&&e.addEventListener("change",n=>{$r("EN",n.target.value)}),t&&t.addEventListener("change",n=>{$r("JP",n.target.value)})}function Mu(){const e=document.querySelector('select[name="visible-task-count"]');e&&e.addEventListener("change",t=>{localStorage.setItem("visible_task_count",t.target.value),window.dispatchEvent(new CustomEvent("visible-task-count-updated",{detail:{count:Number(t.target.value)}}))})}function Tu(){const e=document.querySelector('select[name="timezone-select"]');e&&e.addEventListener("change",t=>{localStorage.setItem("timezone",t.target.value),window.dispatchEvent(new CustomEvent("timezone-changed",{detail:{timezone:t.target.value}}))})}function Iu(){const e=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",e);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),xs()}function xs(){const e=document.getElementById("main-content");if(!e)return;const t=localStorage.getItem("background")||"none";e.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(e.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}function Lu(){ys("app-theme","theme",e=>{document.documentElement.classList.toggle("dark",e==="dark"),xs()}),ys("bg-pattern","background",()=>xs())}const Gs=e=>e instanceof tr?e.toDate():e,rr=e=>e instanceof Date?tr.fromDate(e):e;function Gl(e,t){return{id:e,...t,createdAt:Gs(t.createdAt)||null,dueDate:Gs(t.dueDate)||null,recurrence:t.recurrence??null,completedAt:Gs(t.completedAt)||null}}let To=[];function _n(){return To}function Au(e,t,n){const i=r=>{typeof n=="function"&&n(r)};if(!e||!t)return i([]),()=>{};const s=G.tasks(e,t),o=tn(gt(K,s));return wn(o,r=>{const a=r.docs.map(l=>Gl(l.id,l.data()));To=a,i(a)},r=>{console.error("[Tasks] Subscription error:",r),To=[],i([])})}async function Cu(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");const n=gt(K,G.tasks(e,t)),i=gt(K,G.projects(e,t)),s=gt(K,G.labels(e)),[o,r,a]=await Promise.all([qn(n),qn(i),qn(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof tr?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:l(o),projects:l(r),labels:l(a)}}async function Xl(e,t,n){const i=G.tasks(e,t),s={...n};return s.dueDate&&(s.dueDate=rr(s.dueDate)),await qe(gt(K,i),{...s,ownerId:e,status:"todo",createdAt:Qe()})}async function Ou(e,t,n,i){const s=G.tasks(e,t),o={status:i};i==="completed"?o.completedAt=Qe():o.completedAt=null,await yi(Nt(K,s,n),o)}async function Pu(e,t,n,i){const s=G.tasks(e,t),o={...i};o.dueDate!==void 0&&(o.dueDate=rr(o.dueDate)),await yi(Nt(K,s,n),o)}async function Ru(e,t,n){const i=G.tasks(e,t);await xi(Nt(K,i,n))}async function Bu(e,t,n){const i=G.tasks(e,t),s=await Ud(Nt(K,i,n));return s.exists()?Gl(s.id,s.data()):null}async function Fu(e,t,n){if(!e||!t||!n)throw new Error("Invalid import parameters.");const{tasks:i=[],projects:s=[],labels:o=[]}=n,r=new Map,a=new Map,l=await qn(gt(K,G.labels(e))),c=new Map;l.forEach(u=>c.set(u.data().name,u.id));for(const u of o)if(u.name)if(c.has(u.name))a.set(u.id,c.get(u.name));else{const h={...u};delete h.id;const f=await qe(gt(K,G.labels(e)),h);a.set(u.id,f.id),c.set(u.name,f.id)}for(const u of s){const h={...u};delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt));const f=await qe(gt(K,G.projects(e,t)),h);r.set(u.id,f.id)}const d=i.map(async u=>{const h={...u};return delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt)),typeof h.dueDate=="string"&&(h.dueDate=new Date(h.dueDate)),h.dueDate&&(h.dueDate=rr(h.dueDate)),h.projectId&&r.has(h.projectId)?h.projectId=r.get(h.projectId):h.projectId=null,Array.isArray(h.labelIds)&&(h.labelIds=h.labelIds.map(f=>a.get(f)).filter(f=>f)),h.ownerId=e,qe(gt(K,G.tasks(e,t)),h)});return await Promise.all(d),{tasksCount:i.length,projectsCount:s.length,labelsCount:o.length}}function ge(e){if(!e)return null;if(e.toDate&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e;const t=new Date(e);return isNaN(t.getTime())?null:t}function ce(e=new Date){const t=ge(e)||new Date,n=new Date(t);return n.setHours(0,0,0,0),n}function Nu(e=new Date){const t=ge(e)||new Date,n=new Date(t);return n.setHours(23,59,59,999),n}function Kl(e=new Date){const t=ge(e)||new Date,n=t.getDay(),i=t.getDate()-n+(n===0?-6:1),s=new Date(t.setDate(i));return ce(s)}function $u(e=new Date){const t=ge(e)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function Hu(e){const t=ge(e);if(!t)return"";const n=new Date,i=ce(n),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return o!==n.getFullYear()?`${o}/${r}/${a}`:`${r}/${a}`}function zu(e){const t=ge(e);if(!t)return"text-gray-500";const n=ce(new Date),i=Math.round((t.getTime()-n.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function ju(e,t){var i;if(!e||!(t!=null&&t.type))return null;const n=new Date(ge(e));switch(t.type){case"daily":return n.setDate(n.getDate()+1),n;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=n.getDay();for(let o=1;o<=7;o++)if(t.days.includes((s+o)%7))return n.setDate(n.getDate()+o),n;return null;case"weekdays":do n.setDate(n.getDate()+1);while(n.getDay()===0||n.getDay()===6);return n;case"monthly":return n.setMonth(n.getMonth()+1),n;default:return null}}function Jl(e){var n;const t=ce(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&((n=e.days)==null?void 0:n.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(e.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function Sn(){var t;const e=(t=W.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function En(){const e=Zt();if(!e)throw new Error("Workspace required.");return e}async function Wu(e){var o;if(e.status!=="completed"||!e.recurrence)return;const{recurrence:t,dueDate:n}=e;if(!n||typeof t!="object"||!t.type)return;const i=ju(n,t);if(!i)return;const s={title:e.title,description:e.description||"",status:"todo",dueDate:i,projectId:e.projectId||null,labelIds:e.labelIds||[],timeBlockId:e.timeBlockId||null,duration:e.duration||null,recurrence:e.recurrence};try{const r=(o=W.currentUser)==null?void 0:o.uid,a=Zt();r&&a&&await Xl(r,a,s)}catch(r){console.error("[Recurring] Generation failed:",r)}}async function Vu(e){const t=Sn(),n=En(),i={...e};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),Xl(t,n,i)}async function Uu(e,t){const n=Sn(),i=En();if(await Ou(n,i,e,t),t==="completed"){const s=await Bu(n,i,e);s&&Wu(s).catch(o=>console.error(o))}}async function ar(e,t){const n=Sn(),i=En();return Pu(n,i,e,t)}async function Zl(e){const t=Sn(),n=En();return Ru(t,n,e)}async function Yu(){const e=Sn(),t=En();return Cu(e,t)}async function qu(e){const t=Sn(),n=En();return Fu(t,n,e)}let Gn=[];function Ql(){return Gn}function Gu(){Gn=[]}function Xu(e,t){var r;const n=typeof e=="function"?e:t,i=(r=W.currentUser)==null?void 0:r.uid;if(!i||typeof n!="function")return Gn=[],typeof n=="function"&&n([]),()=>{};const s=G.filters(i),o=tn(gt(K,s));return wn(o,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));Gn=l,n(l)},a=>{console.error("Error subscribing to filters:",a),Gn=[],n([])})}async function Ku(e){var o;const t=(o=W.currentUser)==null?void 0:o.uid;if(!t)throw new Error("Authentication required");const n=G.filters(t),{id:i,...s}=e;await qe(gt(K,n),{...s,ownerId:t,createdAt:Qe()})}async function Ju(e,t){var r;const n=(r=W.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Authentication required");const i=G.filters(n),{id:s,...o}=t;await yi(Nt(K,i,e),{...o,updatedAt:Qe()})}async function Zu(e){var i;const t=(i=W.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const n=G.filters(t);await xi(Nt(K,n,e))}let Io=[];function Qu(){return Io}function th(e,t){if(!e)return t([]),()=>{};const n=G.labels(e),{db:i}=Hl(),s=tn(gt(i,n));return wn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));Io=r,t(r)},o=>{console.error("[Labels] Subscription error:",o),Io=[],t([])})}function eh(e,t){var s;const n=typeof e=="function"?e:t,i=(s=W.currentUser)==null?void 0:s.uid;return i&&typeof n=="function"?th(i,n):(typeof n=="function"&&n([]),()=>{})}let Xs=null;function Fs(){return Xs||(Xs=Hl().db),Xs}let Ki=[];function nh(e,t,n){Ki=[];const i=G.projects(e,t),s=Fs(),o=tn(gt(s,i),Qo("createdAt","asc"));return wn(o,r=>{const a=r.docs.map(l=>({id:l.id,...l.data()}));Ki=a,n(a)},r=>{console.error("Error subscribing to projects:",r),Ki=[],n([])})}function lr(){return Ki}async function ih(e,t,n){const i=G.projects(e,t),s=Fs();await qe(gt(s,i),{name:n,ownerId:e,createdAt:Qe()})}async function sh(e,t,n,i){const s=G.projects(e,t),o=Fs(),r=Nt(o,s,n);return yi(r,i)}async function oh(e,t,n){const i=G.projects(e,t),s=Fs();await xi(Nt(s,i,n))}function tc(){var n;const e=(n=W.currentUser)==null?void 0:n.uid,t=Zt();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const rh=lr,ah=(e,t)=>{const n=typeof e=="function"?e:t,i=typeof e=="string"?e:Zt(),s=W.currentUser;return s&&i&&typeof n=="function"?nh(s.uid,i,n):(typeof n=="function"&&n([]),()=>{})},lh=async(e,t=null)=>{const n=W.currentUser;if(!n)throw new Error("Authentication required.");const i=t||Zt();if(!i)throw new Error("Workspace selection required.");return ih(n.uid,i,e)},ch=async(e,t)=>{const{userId:n,workspaceId:i}=tc();return sh(n,i,e,t)},ec=async e=>{const{userId:t,workspaceId:n}=tc();return oh(t,n,e)};let ve=[];const dh=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function uh(e,t){var o;const n=(o=W.currentUser)==null?void 0:o.uid;if(!n)return ve=[...dh],typeof t=="function"&&t(ve),()=>{};const i=G.timeblocks(n),s=tn(gt(K,i),Qo("order","asc"));return wn(s,r=>{ve=r.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(ve)},r=>{console.error("[TimeBlocks] Subscription error:",r)})}function ue(){return[...ve]}function nc(e){return ve.find(t=>t.id===e)}function hh(){ve=[]}async function fh(e){var n;const t=(n=W.currentUser)==null?void 0:n.uid;if(!t){R("ログインが必要です");return}try{const i=G.timeblocks(t),s=e.id||crypto.randomUUID(),o=e.order!==void 0?e.order:Math.max(...ve.map(a=>a.order),-1)+1,r={name:e.name,start:e.start,end:e.end,color:e.color,order:o,updatedAt:Qe()};return await Yd(Nt(K,i,s),r,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i)}}async function gh(e){var n;const t=(n=W.currentUser)==null?void 0:n.uid;if(t)try{const i=G.timeblocks(t);return await xi(Nt(K,i,e)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function ph(e,t){const n=W.currentUser;return!n||!e?(typeof t=="function"&&t([]),()=>{}):Au(n.uid,e,t)}function mh(){const e=document.getElementById("export-data-btn-new");e&&(e.onclick=async()=>{const t=e.querySelector("span.font-bold"),n=t?t.textContent:"バックアップを作成";e.disabled=!0,e.classList.add("opacity-70","cursor-wait"),t&&(t.textContent="バックアップ作成中...");try{const i=await Yu(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(r),R({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),R({message:"エクスポートに失敗した",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait"),t&&(t.textContent=n)}})}function bh(){const e=document.getElementById("import-data-btn-new"),t=document.getElementById("import-file-input");!e||!t||(e.onclick=()=>{t.value="",t.click()},t.onchange=n=>{const i=n.target.files[0];if(!i)return;const s=new FileReader;s.onload=async o=>{try{const r=JSON.parse(o.target.result);if(!r.tasks||!r.projects)throw new Error("Invalid backup format");e.disabled=!0,e.classList.add("opacity-70","cursor-wait");const a=await qu(r);R({message:`インポート完了！
タスク: ${a.tasksCount}件
プロジェクト: ${a.projectsCount}件
ラベル: ${a.labelsCount}件`,type:"success"}),setTimeout(()=>window.location.reload(),1500)}catch(r){console.error(r),R({message:`インポートに失敗しました。
ファイルが破損している可能性があります。`,type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait")}},s.readAsText(i)})}function yh(){const e=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!e||!t||(e.onclick=async()=>{const n=t.value.trim();if(n.length<6)return R({message:"6文字以上入力してくれ",type:"error"});try{await Qd(n),t.value="",R({message:"パスワードを変更しました",type:"success"})}catch{}})}function xh(e){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await zd(W),e()}catch{R({message:"エラーが発生した",type:"error"})}})}function vh(e,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),e.addEventListener("click",i=>{i.target===e&&t()}),Lu(),Eu(),Mu(),Du(),Tu(),mh(),bh(),yh(),xh(t),Su()}let Hr=!1;function zr(){var e;(e=document.getElementById(B.MODAL_IDS.SETTINGS))==null||e.remove()}function wh(){if(Hr)return;hu(),gu();const e=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),Ns())};document.addEventListener("click",e),Hr=!0}function Ns(){zr();const e=nu(),t=W.currentUser,n=(t==null?void 0:t.email)||"匿名ユーザー",i=(n[0]||"?").toUpperCase(),s=document.createElement("div");s.id=B.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=xu(i,n,e),document.body.appendChild(s),vh(s,zr)}function kh(e=null){const t=!!e,n={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 ${q.MODAL.WIDTH.DEFAULT} rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${n.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(e==null?void 0:e.name)||""}" 
                        placeholder="${n.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${n.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function ic(e=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=kh(e),document.body.appendChild(n),_h(n,e)}function _h(e,t){const n=e.querySelector("#save-workspace-btn"),i=e.querySelector("#modal-workspace-name"),s=e.querySelector("#cancel-modal-btn"),o=e.querySelector("#workspace-modal-overlay"),r=()=>{document.removeEventListener("keydown",a),e.remove()},a=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",a),o.onclick=c=>{c.target===o&&r()},s&&(s.onclick=r);const l=async()=>{if(n.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return R({message:"ワークスペース名を入力してくれ",type:"error"});if(Mo().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return R({message:"その名前は既に使われているぞ",type:"error"});n.disabled=!0,n.textContent=t?"更新中...":"作成中...";try{if(t)await lu(t.id,c);else{const u=await Vl(c);sr(u.id)}r()}catch(u){n.disabled=!1,n.textContent=t?"保存":"作成",R({message:`失敗した: ${u.message}`,type:"error"})}};n==null||n.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Dt={CONTAINER:"fixed inset-0 z-[70] flex items-center justify-center bg-black/60 backdrop-blur-sm p-4 animate-fade-in",DIALOG:"bg-white dark:bg-gray-800 w-full rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh] transition-all",WIDTH:{DEFAULT:"max-w-5xl w-full"},HEADER:"px-modal py-modal border-b border-gray-100 dark:border-gray-700 flex justify-between items-center",BODY:"p-modal overflow-y-auto flex-1 min-h-0 custom-scrollbar",FOOTER:"px-modal py-modal bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center gap-modal border-t border-gray-100 dark:border-gray-700",TITLE:"text-lg font-bold text-gray-800 dark:text-white",CLOSE_BUTTON:"text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700",CHECKBOX:"appearance-none w-4 h-4 border-2 border-gray-400 dark:border-gray-500 rounded cursor-pointer relative checked:bg-blue-600 checked:border-blue-600 focus:outline-none transition-all"},vs="none",Ks={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function sc(e=null){const t=!!e,n=rh(),i=ue(),s=[30,45,60,75,90],o=[{id:"today",name:"今日"},{id:"tomorrow",name:"明日"},{id:"week",name:"今週"},{id:"next-week",name:"来週"}],r=Sh((e==null?void 0:e.query)||""),a=document.createElement("div");a.id="filter-creation-modal",a.className=q.MODAL.CONTAINER,a.innerHTML=`
        <div class="${q.MODAL.DIALOG} ${q.MODAL.WIDTH.DEFAULT}" role="dialog" aria-modal="true">
            <div class="${Dt.HEADER}">
                <h3 class="${Dt.TITLE}">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="${Dt.CLOSE_BUTTON}">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="${Dt.BODY}">
                <div class="space-y-6">
                    <div>
                        <label for="filter-name" class="${q.TEXT.LABEL}">フィルター名</label>
                        <input type="text" id="filter-name" value="${(e==null?void 0:e.name)||""}" 
                               class="${q.INPUT.DEFAULT}" placeholder="例: 今週の重要タスク">
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-3">
                        ${Ji("プロジェクト",n,r.project,"filter-project-checkbox")}
                        ${Eh(i,r.timeblock)}
                        ${Ji("所要時間",s,r.duration,"filter-duration-checkbox",l=>`${l} min`)}
                        ${Ji("日付",o,r.date,"filter-date-checkbox")}
                    </div>
                </div>
            </div>
            <div class="${Dt.FOOTER}">
                <button id="cancel-filter-btn" class="${q.BUTTON.SECONDARY} mr-auto">キャンセル</button>
                <button id="save-filter-btn" class="${q.BUTTON.PRIMARY}">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(a),Dh(a,e)}function Sh(e){const t={project:[],timeblock:[],duration:[],date:[]};return e&&e.split(/\s+/).forEach(n=>{if(!n.includes(":"))return;const[i,s]=n.split(":");if(t[i]){const o=s.split(",").map(r=>i==="timeblock"&&(r==="null"||r==="none")?vs:r);t[i]=[...t[i],...o]}}),t}function Ji(e,t,n,i,s=o=>o.name||o){const o=new Set(n.map(String));return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${e}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map((r,a)=>{const l=String(r.id||r),c=o.has(l),d=`cb-${i}-${a}-${l}`;return`
                        <div class="flex items-center px-2 py-1.5 rounded cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group">
                            <input type="checkbox" id="${d}" name="${i}" value="${l}" ${c?"checked":""} 
                                   class="${i} ${Dt.CHECKBOX} cursor-pointer">
                            <label for="${d}" class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate cursor-pointer flex-1 py-0.5">
                                ${s(r)}
                            </label>
                        </div>
                    `}).join("")}
            </div>
        </div>
    `}function Eh(e,t){const n=[...e,{id:vs,name:"未定"}];return Ji("時間帯",n,t,"filter-timeblock-checkbox",i=>i.id===vs?i.name:`${i.start}-${i.end}`)}function Dh(e,t){const n=()=>{document.removeEventListener("keydown",i),e.remove()},i=s=>s.key==="Escape"&&n();document.addEventListener("keydown",i),e.querySelector("#close-filter-modal").onclick=n,e.querySelector("#cancel-filter-btn").onclick=n,e.onclick=s=>{s.target===e&&n()},e.querySelector("#save-filter-btn").onclick=async s=>{s.preventDefault();const r=e.querySelector("#filter-name").value.trim();if(!r)return R({message:Ks.NAME_REQUIRED,type:"error"});const a=u=>{const h=e.querySelectorAll(`input.${u}`);return Array.from(h).filter(f=>f.checked).map(f=>f.value)},l={project:a("filter-project-checkbox"),timeblock:a("filter-timeblock-checkbox").map(u=>u===vs?"null":u),duration:a("filter-duration-checkbox"),date:a("filter-date-checkbox")},c=Object.entries(l).filter(([u,h])=>h.length>0).map(([u,h])=>`${u}:${h.join(",")}`);if(c.length===0)return R({message:Ks.CONDITION_REQUIRED,type:"error"});const d=c.join(" ");try{const u={name:r,query:d,type:"custom"};t?await Ju(t.id,u):await Ku(u),document.dispatchEvent(new CustomEvent("filters-updated")),n()}catch(u){console.error(u),R({message:Ks.SAVE_ERROR+u.message,type:"error"})}}}function Mh(e=null){const t=!!e,n={title:(e==null?void 0:e.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 ${q.MODAL.WIDTH.DEFAULT} rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${n.title}" placeholder="${n.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${n.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function Th(e,t){var i;(i=document.getElementById(e))==null||i.remove();const n=document.createElement("div");return n.id=e,n.innerHTML=t,wu(n),document.body.appendChild(n),n}function Ih(e,t=null){const n=()=>{e.remove(),t&&t()};e.addEventListener("click",s=>{s.target===e&&n()});const i=s=>{s.key==="Escape"&&(n(),document.removeEventListener("keydown",i))};return document.addEventListener("keydown",i),n}function Lh(e,t,n=!1){requestAnimationFrame(()=>{const i=e.querySelector(t);i&&(i.focus(),n&&typeof i.select=="function"&&i.select())})}function Ah(e,t,n={}){const{focusSelector:i=null,selectText:s=!1,onClose:o=null}=n,r=Th(e,t),a=Ih(r,o);return i&&Lh(r,i,s),{overlay:r,close:a}}function oc(e=null){const t="project-modal",n=Mh(e),{overlay:i,close:s}=Ah(t,n,{focusSelector:"#modal-project-name",selectText:!!e});Ch(i,e,s)}function Ch(e,t,n){const i=e.querySelector("#modal-project-name"),s=e.querySelector("#save-project-btn"),o=e.querySelector("#delete-project-btn"),r=e.querySelector("#cancel-modal-btn");r&&(r.onclick=n);const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return R({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await ch(t.id,{name:l});else{const c=Zt();if(!c)throw new Error("ワークスペースが選択されていないぞ");await lh(l,c)}n()}catch(c){R({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),o&&t&&(o.onclick=()=>{R({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await ec(t.id),n()}catch{R({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function ai(e,t,n,i={},s=0,o="normal"){const r=document.createElement("li"),{DENSITY_CLASSES:a,COLORS:l}=B;r.dataset.type=t,r.dataset.id=n;const c=a[o]||a.normal;r.className=`group flex items-center justify-between px-3 ${c} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const u={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3">⏱️</span>',filter:i.iconHtml||'<span class="mr-3">🔍</span>'}[t]||'<span class="mr-3">🔹</span>',h=s>0?`<span class="text-gray-400 font-light mr-2" style="font-size: 0.85em;">${s}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${u}
            <span class="truncate">${e}</span>
        </div>
        <div class="flex items-center">${h}</div>
    `,r}function cr(e,t,n){var o;const i=Ph(t,n);if(!i)return;(o=document.getElementById("sidebar-context-menu"))==null||o.remove();const s=Rh(i);document.body.appendChild(s),rc(s,e),Bh(s,i)}function Oh(e,t){e.preventDefault(),document.querySelectorAll(".app-context-menu, #sidebar-context-menu").forEach(s=>s.remove());const n=document.createElement("div");n.className="app-context-menu fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 shadow-xl rounded-lg py-1 z-[100] animate-fade-in text-sm min-w-[180px]",t.forEach((s,o)=>{if(o>0&&s.separator){const c=document.createElement("div");c.className="border-t border-gray-100 dark:border-gray-700 my-1",n.appendChild(c)}const r=document.createElement("button"),a=s.danger?"text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50":"text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700";r.className=`flex w-full items-center px-4 py-2 text-left transition ${a}`;let l="";s.icon?l=`<span class="mr-2 w-4 h-4">${s.icon}</span>`:s.label.includes("ウィンドウ")&&(l='<svg class="w-4 h-4 mr-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"></path></svg>'),r.innerHTML=`${l}${s.label}`,r.onclick=c=>{c.stopPropagation(),n.remove(),s.action()},n.appendChild(r)}),document.body.appendChild(n),rc(n,e);const i=()=>{n.remove(),document.removeEventListener("click",i),document.removeEventListener("contextmenu",i)};setTimeout(()=>{document.addEventListener("click",i),document.addEventListener("contextmenu",i)},50)}function Js(e,t=null){document.dispatchEvent(new CustomEvent("route-change",{detail:{page:e,id:t}}))}function Ph(e,t){return{project:{editLabel:"編集",onEdit:()=>oc(t),onDelete:async()=>{await ec(t.id),Js("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>sc(t),onDelete:async()=>{await Zu(t.id),Js("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>ic(t),onDelete:async()=>{if(Mo().length<=1)throw new Error("最後のワークスペースは削除できない。");await cu(t.id);const s=Mo().filter(o=>o.id!==t.id);s.length>0&&(sr(s[0].id),Js("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[e]}function Rh(e){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${e.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function rc(e,t){const{clientX:i,clientY:s}=t,o=window.innerWidth,r=window.innerHeight;e.style.visibility="hidden";const{width:a,height:l}=e.getBoundingClientRect();let c=i,d=s;i+a>o&&(c=i-a),s+l>r&&(d=s-l),e.style.left=`${Math.max(8,c)}px`,e.style.top=`${Math.max(8,d)}px`,e.style.visibility="visible"}function Bh(e,t){const n=()=>{e.remove(),document.removeEventListener("click",n),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&n();setTimeout(()=>{document.addEventListener("click",n),document.addEventListener("keydown",i)},0),e.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),n(),t.onEdit()},e.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),n(),R({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(o){R({message:"削除に失敗した: "+o.message,type:"error"})}}})}}const Ti={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let Gt=null,Xn=null,jr=!1;function Kn(e){Gt&&(e?(Gt.classList.remove(...Ti.MENU_INVISIBLE),Gt.classList.add(...Ti.MENU_VISIBLE),document.addEventListener("click",Wr,{capture:!0})):(Gt.classList.remove(...Ti.MENU_VISIBLE),Gt.classList.add(...Ti.MENU_INVISIBLE),document.removeEventListener("click",Wr,{capture:!0})))}const Wr=e=>{Gt&&!Gt.contains(e.target)&&Xn&&!Xn.contains(e.target)&&Kn(!1)};function ac(){if(jr)return;Xn=document.getElementById("workspace-trigger"),Gt=document.getElementById("workspace-menu");const e=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!Xn||!Gt||(Xn.onclick=n=>{n.stopPropagation();const i=Gt.classList.contains("opacity-100");Kn(!i)},e&&(e.onclick=()=>{Kn(!1),ic(null)}),t&&(t.onclick=()=>{Kn(!1),Ns()}),document.addEventListener("workspace-changed",n=>{const{workspaceId:i,workspaces:s}=n.detail;lc(s,i)}),jr=!0)}function lc(e,t=Zt()){const n=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(n&&Fh(e,n,t),i){const s=e.find(o=>o.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function Fh(e,t,n){t.innerHTML="",e.forEach(i=>{const s=i.id===n,o=document.createElement("button");o.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const r=document.createElement("span");if(r.className="truncate pointer-events-none",r.textContent=i.name,o.appendChild(r),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,o.appendChild(a.firstElementChild)}o.onclick=()=>{s||sr(i.id),Kn(!1)},o.oncontextmenu=a=>{a.preventDefault(),cr(a,"workspace",i)},t.appendChild(o)})}const{Z_INDEX:gn}=eu,Nh=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${gn.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${gn.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${B.DEFAULT_WIDTH}px;">
        ${$h()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${gn.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,$h=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,Hh=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${gn.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${gn.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700 z-50">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar bg-white dark:bg-gray-800" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1 bg-white dark:bg-gray-800">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function zh(){const e=document.getElementById("app");e&&(e.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${Nh()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${Hh()}
                <div id="main-content" class="flex-1 flex flex-col min-w-0 overflow-hidden">
                    <div class="w-full max-w-4xl mx-auto h-full flex flex-col">
                        <div id="task-view" class="w-full h-full animate-fade-in transition-opacity duration-150 flex flex-col"></div>
                        <div id="search-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="dashboard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="target-dashboard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="wizard-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        <div id="wiki-view" class="hidden w-full h-full animate-fade-in overflow-y-auto custom-scrollbar p-4 sm:p-6 lg:p-8"></div>
                        
                        <!-- Persistent Add Task Footer -->
                        <div id="global-footer" class="w-full flex-none mt-auto pb-6 pt-2 px-4 bg-white dark:bg-gray-900 z-20 transition-all duration-300">
                             <div id="footer-add-btn-container" class="h-full"></div>
                             <div id="footer-input-form-container" class="hidden"></div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${gn.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{jl(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),ac(),Wh(),jh()}))}function jh(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),n=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=o=>{const r=e.classList.contains("-translate-x-full"),a=o??!r;e.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};n==null||n.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function Wh(){document.addEventListener("keydown",e=>{const t=["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.closest("[contenteditable]"),n=document.querySelector('[role="dialog"]');if(e.key==="/"&&!t&&!n){const i=document.getElementById("page-search-input");i&&(e.preventDefault(),i.focus())}})}function Vh(e){if(!e)return"";const t=e.toDate?e.toDate():new Date(e),n=t.getFullYear(),i=String(t.getMonth()+1).padStart(2,"0"),s=String(t.getDate()).padStart(2,"0");return`${n}-${i}-${s}`}const Uh="task_modal_schedule_open";function Yh(e=[]){return["日","月","火","水","木","金","土"].map((n,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer select-none">
            <input type="checkbox" name="recurrence_days" id="recurrence-day-${i}" value="${i}" data-day-index="${i}" ${e.includes(i)?"checked":""} 
                   class="${Dt.CHECKBOX}">
            <span class="text-xs text-gray-700 dark:text-gray-300 relative z-10">${n}</span>
        </label>
    `).join("")}function Vr(e,t,n){return e.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${n(i)}
        </option>
    `).join("")}function qh(e){let t=e.dueDate;const n=e.recurrence||{type:"none",days:[]};n.type!=="none"&&!t&&(t=Jl(n));const i=t?Vh(t.toDate?t.toDate():new Date(t)):"",s=Vr(ue(),e.timeBlockId,c=>`${c.start} - ${c.end}`),o=Vr([30,45,60,75,90],e.duration,c=>`${c} min`),r=i||n.type!=="none"||e.timeBlockId||e.duration,a=localStorage.getItem(Uh);let l=r;return a!==null?l=a==="true":r&&(l=!0),`
        <div class="${Dt.CONTAINER}">
            <div class="${Dt.DIALOG} ${Dt.WIDTH.DEFAULT}" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="${Dt.HEADER}">
                    <input type="text" id="modal-task-title" value="${e.title}" placeholder="タスクのタイトル"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="${Dt.CLOSE_BUTTON}">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ (2カラムレイアウト) -->
                <div class="${Dt.BODY} bg-gray-50/30 dark:bg-gray-900/10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
                        <!-- コンテンツ省略なしで維持 -->
                        <!-- 左カラム (8/12): メモ -->
                        <div class="md:col-span-8 flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label for="modal-task-desc" class="text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    メモ (Markdown)
                                </label>
                                <div class="flex items-center gap-2">
                                    <div class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-md p-0.5">
                                        <button type="button" id="md-bold-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="太字 (Ctrl+B)">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6V4zm0 8h9a4 4 0 014 4 4 4 0 01-4 4H6v-8z"></path></svg>
                                        </button>
                                        <div class="w-px h-3 bg-gray-300 dark:bg-gray-600 mx-0.5"></div>
                                        <button type="button" id="md-list-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="箇条書き">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <button type="button" id="md-ordered-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="番号付きリスト">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7v.01M3 12v.01M3 17v.01"></path></svg>
                                        </button>
                                    </div>
                                    <button id="toggle-memo-view" class="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-2 py-0.5 rounded transition-colors text-xs font-medium ml-2">プレビュー</button>
                                </div>
                            </div>
                            <div class="flex-1 relative min-h-[200px]">
                                <textarea id="modal-task-desc" placeholder="詳細を入力..."
                                    class="w-full h-full p-3 bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg outline-none text-sm transition-all resize-y leading-relaxed focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono">${e.description||""}</textarea>
                                <div id="modal-task-desc-preview" class="hidden absolute inset-0 w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- 右カラム (4/12): スケジュール設定 -->
                        <div class="md:col-span-4 space-y-4">
                            <details id="modal-task-schedule-details" class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm" ${l?"open":""}>
                                <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50">
                                    <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        スケジュール
                                    </span>
                                    <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </span>
                                </summary>
                                
                                <div class="p-4 flex flex-col gap-4">
                                    <div>
                                        <label for="modal-task-date" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                        <div class="relative">
                                            <input type="date" id="modal-task-date" value="${i}"
                                                class="w-full pl-3 pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:justify-end [&::-webkit-calendar-picker-indicator]:cursor-pointer">
                                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 dark:text-gray-400">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label for="modal-task-recurrence" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                        <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="none" ${n.type==="none"?"selected":""}>なし</option>
                                            <option value="daily" ${n.type==="daily"?"selected":""}>毎日</option>
                                            <option value="weekdays" ${n.type==="weekdays"?"selected":""}>平日</option>
                                            <option value="weekly" ${n.type==="weekly"?"selected":""}>毎週</option>
                                            <option value="monthly" ${n.type==="monthly"?"selected":""}>毎月</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label for="modal-task-timeblock" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                        <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">未定</option>
                                            ${s}
                                        </select>
                                    </div>

                                    <div>
                                        <label for="modal-task-duration" class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                        <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">指定なし</option>
                                            ${o}
                                        </select>
                                    </div>

                                    <div id="recurrence-days-container" class="${n.type!=="weekly"?"hidden":""} pt-2 border-t border-gray-100 dark:border-gray-700">
                                        <span id="recurrence-days-label" class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</span>
                                        <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                            ${Yh(n.days)}
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                    </div>
                </div>

                <!-- フッター -->
                <div class="${Dt.FOOTER}">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition mr-auto">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                    <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                </div>
            </div>
        </div>
    `}function Gh(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function cc(e){if(!e)return"";const t=e.split(`
`);let n=[],i=null;return t.forEach(s=>{const o=s.trimStart(),r=o.startsWith("* ")||o.startsWith("- "),a=/^\d+\.\s/.test(o),l=r||a;if(l){const c=a?"ol":"ul";if(i!==c){i&&n.push(`</${i}>`);const d=a?"list-decimal":"list-disc";n.push(`<${c} class="${d} ml-5 space-y-1">`),i=c}}else i&&(n.push(`</${i}>`),i=null);if(l){let c="";r?c=o.substring(2):c=o.replace(/^\d+\.\s/,"");const d=Ur(c);n.push(`<li>${d}</li>`)}else s.trim()?n.push(`<p class="mb-2">${Ur(s)}</p>`):i&&(n.push(`</${i}>`),i=null)}),i&&n.push(`</${i}>`),n.join(`
`)}function Ur(e){return Gh(e).replace(/\[(.*?)\]\((.*?)\)/g,(n,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}function Yr(e,t,n=""){const i=e.selectionStart,s=e.selectionEnd,o=e.value,r=o.substring(i,s);let a=o.substring(0,i),l=o.substring(s),c="",d=0;if(n)c=a+t+r+n+l,d=s+t.length+n.length,i===s&&(d-=n.length);else if(i!==s){const h=r.split(`
`).map(f=>t+f).join(`
`);c=a+h+l,d=i+h.length}else c=a+t+l,d=i+t.length;e.value=c,e.focus(),e.selectionEnd=d,n&&i===s?(e.selectionStart=i+t.length,e.selectionEnd=i+t.length):n&&(e.selectionStart=i,e.selectionEnd=s+t.length+n.length),e.dispatchEvent(new Event("input"))}function qr(e,t){const n=e.selectionStart,i=e.selectionEnd,s=e.value;let o=s.lastIndexOf(`
`,n-1)+1,r=s.indexOf(`
`,i);r===-1&&(r=s.length);const l=s.substring(o,r).split(`
`),c=/^(\s*)([-*]|\d+\.)(\s+)/,u=l.map(h=>{const f=h.match(c);if(f){const g=f[2],p=/^\d+\.\s*$/.test(t),m=/^\d+\.$/.test(g),b=/^[-*]$/.test(g);return p&&m||!p&&b?h.replace(c,"$1"):h.replace(c,`$1${t}`)}else return t+h}).join(`
`);e.setRangeText(u,o,r,"select"),e.dispatchEvent(new Event("input")),e.focus()}function Xh(){const e=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),n=document.getElementById("toggle-memo-view"),i=document.getElementById("md-bold-btn"),s=document.getElementById("md-list-btn"),o=document.getElementById("md-ordered-btn");if(!e||!t)return;n&&n.classList.add("hidden");const r=()=>{e.classList.remove("hidden"),t.classList.add("hidden"),e.focus()},a=()=>{const c=cc(e.value);t.innerHTML=c||'<span class="text-gray-400 cursor-text">メモを入力...</span>',e.classList.add("hidden"),t.classList.remove("hidden")};e.value.trim()?a():r(),t.addEventListener("click",r),e.addEventListener("blur",()=>{a()}),e.addEventListener("input",()=>{}),e.addEventListener("keydown",c=>{(c.ctrlKey||c.metaKey)&&c.key==="b"&&(c.preventDefault(),Yr(e,"**","**"))});const l=(c,d)=>{c&&(c.addEventListener("mousedown",u=>u.preventDefault()),c.addEventListener("click",d))};l(i,()=>Yr(e,"**","**")),l(s,()=>qr(e,"- ")),l(o,()=>qr(e,"1. "))}function Kh(){const e=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),n=document.getElementById("modal-task-date");if(!e||!t||!n)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(r,a=[])=>{if(r==="weekly"&&a.length===0)return;const l=Jl({type:r,days:a});n.value=l.toISOString().substring(0,10)},o=()=>Array.from(i).filter(r=>r.checked).map(r=>parseInt(r.dataset.dayIndex??"0",10));e.addEventListener("change",r=>{const a=r.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?o():[];s(a,c)}}),i.forEach(r=>{r.addEventListener("change",()=>{const a=o();s("weekly",a)})})}let ne={};function Jh(e){ne={title:e.querySelector("#modal-task-title"),desc:e.querySelector("#modal-task-desc"),date:e.querySelector("#modal-task-date"),recurrence:e.querySelector("#modal-task-recurrence"),timeblock:e.querySelector("#modal-task-timeblock"),duration:e.querySelector("#modal-task-duration"),saveBtn:e.querySelector("#save-task-modal-btn"),deleteBtn:e.querySelector("#delete-task-modal-btn"),closeBtn:e.querySelector("#close-modal-btn"),cancelBtn:e.querySelector("#cancel-modal-btn"),overlay:e.querySelector("div.fixed")}}function Zh(e,t,n){Jh(e);const{closeBtn:i,cancelBtn:s,overlay:o,saveBtn:r,deleteBtn:a}=ne;[i,s].forEach(d=>d==null?void 0:d.addEventListener("click",n)),o==null||o.addEventListener("click",d=>{d.target===d.currentTarget&&n()});const l=e.querySelector("#modal-task-schedule-details");l&&l.addEventListener("toggle",()=>{localStorage.setItem("task_modal_schedule_open",l.open)}),r==null||r.addEventListener("click",async()=>{await Qh(t,n)}),a==null||a.addEventListener("click",()=>{R({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await Zl(t.id),n()}catch{R({message:"削除に失敗した",type:"error"})}}})});const c=ne.date;c&&c.addEventListener("click",d=>{if(typeof c.showPicker=="function")try{c.showPicker()}catch(u){console.debug("showPicker failed or already open",u)}}),Kh(),Xh()}async function Qh(e,t){var d,u,h,f,g,p,m,b;const n=(u=(d=ne.title)==null?void 0:d.value)==null?void 0:u.trim();if(!n){R({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=ne.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){R({message:"無効な日付だ",type:"error"});return}const o=(f=ne.recurrence)==null?void 0:f.value;let r=null;if(o!=="none"&&(r={type:o},o==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(v=>parseInt(v.dataset.dayIndex??"",10)).filter(v=>!isNaN(v)).sort((v,w)=>v-w);if(y.length===0){R({message:"曜日を選択してくれ",type:"error"});return}r.days=y}const a=parseInt((g=ne.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:n,description:((m=(p=ne.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:r,timeBlockId:((b=ne.timeblock)==null?void 0:b.value)||null,duration:l};try{await ar(e.id,c),t()}catch(y){console.error("Failed to update task:",y),R({message:"保存に失敗した",type:"error"})}}const dc=e=>{e.key==="Escape"&&uc()};function tf(e){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=qh(e),Zh(t,e,uc),document.addEventListener("keydown",dc)}function uc(){const e=document.getElementById("modal-container");e&&(e.innerHTML="",document.removeEventListener("keydown",dc))}const dr=e=>`${B.STORAGE_KEYS.SECTION_PREFIX}${e}`,ef={basic:{title:"基本項目",listId:B.LIST_IDS.BASIC,renderContent:e=>`
                ${Re("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${Re("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${Re("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${Re("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            `},targets:{title:"Target Tools",listId:B.LIST_IDS.TARGETS,renderContent:e=>`
                ${Re("nav-wizard","M13 10V3L4 14h7v7l9-11h-7z","目標設計ウィザード")}
                ${Re("nav-target-dashboard","M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z","目標ダッシュボード")}
                ${Re("nav-wiki","M12 6.253v13m0-13C10.832 5.477 9.246 5 7.5 5S4.168 5.477 3 6.253v13C4.168 18.477 5.754 18 7.5 18s3.332.477 4.5 1.253m0-13C13.168 5.477 14.754 5 16.5 5c1.747 0 3.332.477 4.5 1.253v13C19.832 18.477 18.247 18 16.5 18c-1.746 0-3.332.477-4.5 1.253","フレームワークWiki")}
            `},projects:{title:"プロジェクト",listId:B.LIST_IDS.PROJECTS,hasAddButton:!0,buttonId:"add-project-btn"},timeblocks:{title:"時間帯",listId:B.LIST_IDS.TIMEBLOCKS,hasAddButton:!0,buttonId:"edit-timeblocks-btn"},durations:{title:"所要時間",listId:B.LIST_IDS.DURATIONS},filters:{title:"フィルター",listId:B.LIST_IDS.FILTERS,hasAddButton:!0,buttonId:"add-filter-btn"}},hc=["basic","targets","projects","timeblocks","durations","filters"];function nf(){try{const e=localStorage.getItem(B.STORAGE_KEYS.SECTION_ORDER);if(e)return JSON.parse(e)}catch(e){console.error("Failed to parse section order",e)}return hc}function sf(e,t,n=!1,i=""){const s=nr(dr(t),!0),o=s?"rotate-0":"-rotate-90",r=n?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${e}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${o} section-arrow" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${e}</h3>
            </div>
            ${r}
        </div>
    `}function of(e,t=""){const n=nr(dr(e),!0);return`<ul id="${e}" class="space-y-0.5 mb-2 pl-1 ${n?"":"hidden"}">${t}</ul>`}function Re(e,t,n,i=""){return`
        <li>
            <a href="#" id="${e}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${n}</span>
                ${i}
            </a>
        </li>
    `}function rf(){const e=nf();return hc.forEach(n=>{e.includes(n)||e.push(n)}),`<div class="mt-2 select-none" id="sidebar-sections-wrapper">${e.map(n=>{const i=ef[n];if(!i)return"";const s=i.renderContent?i.renderContent(i.listId):"";return`
            <div class="sidebar-section-container transition-all duration-200" draggable="true" data-section-key="${n}">
                ${sf(i.title,i.listId,i.hasAddButton,i.buttonId)}
                ${of(i.listId,s)}
            </div>
        `}).join("")}</div>`}function af(){document.querySelectorAll(".sidebar-section-header").forEach(e=>{const t=e.dataset.target,n=document.getElementById(t),i=e.querySelector(".section-arrow");!n||!i||(e.onclick=s=>{if(s.target.closest("button"))return;const r=!n.classList.toggle(B.CLASSES.HIDDEN);i.classList.toggle("rotate-0",r),i.classList.toggle("-rotate-90",!r),e.setAttribute("aria-expanded",r),localStorage.setItem(dr(t),r)})})}function lf(){const e=document.getElementById("sidebar-sections-wrapper");if(!e)return;let t=null;e.querySelectorAll(".sidebar-section-container").forEach(i=>{i.addEventListener("dragstart",s=>{t=i,s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",i.dataset.sectionKey),i.classList.add("opacity-50","bg-gray-100","dark:bg-gray-800")}),i.addEventListener("dragend",s=>{i.classList.remove("opacity-50","bg-gray-100","dark:bg-gray-800"),e.querySelectorAll(".sidebar-section-container").forEach(o=>{o.classList.remove("border-t-2","border-blue-500")})}),i.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t!==i&&i.classList.add("border-t-2","border-blue-500")}),i.addEventListener("dragleave",s=>{i.classList.remove("border-t-2","border-blue-500")}),i.addEventListener("drop",s=>(s.stopPropagation(),s.preventDefault(),t!==i&&(e.insertBefore(t,i),cf(e)),!1))})}function cf(e){const t=e.querySelectorAll(".sidebar-section-container"),n=Array.from(t).map(i=>i.dataset.sectionKey);localStorage.setItem(B.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(n))}function li(e,t,n=null){if(!e)return;let i=0;const s=B.CLASSES.DRAG_OVER;e.addEventListener("dragenter",o=>{o.preventDefault(),i++,e.classList.add(...s)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.contains("ring-2")||e.classList.add(...s)}),e.addEventListener("dragleave",o=>{o.preventDefault(),i--,i<=0&&(e.classList.remove(...s),i=0)}),e.addEventListener("drop",async o=>{o.preventDefault(),i=0,e.classList.remove(...s);const r=o.dataTransfer.getData("application/x-taskmg-id");r&&await df(r,t,n)})}async function df(e,t,n){const i={},{DURATION_LIMITS:s}=B;switch(t){case"inbox":i.projectId=null;break;case"project":n&&(i.projectId=n);break;case"timeblock":i.timeBlockId=n==="unassigned"||!n?null:n;break;case"duration":{const o=parseInt(n,10);if(!isNaN(o)&&o>=s.MIN&&o<=s.MAX)i.duration=o;else{R({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),R({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await ar(e,i)}catch(o){console.error(`[Drop Error] Type: ${t}, Task: ${e}`,o),R({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const Gr=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),Xr=["00","15","30","45"];function uf(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl ${q.MODAL.WIDTH.DEFAULT} overflow-hidden flex flex-col max-h-[90vh] relative animate-fade-in-up">
            <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition duration-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-8 overflow-y-auto flex-1 space-y-4 custom-scrollbar relative" id="tb-scroll-container">
                <div id="tb-list" class="space-y-2"></div> <!-- space-y-2 for tighter spacing -->
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed group">
                </button>

                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs opacity-80">デフォルトのゾーン</span>
                </div>
            </div>

            <div class="px-8 py-5 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none">完了</button>
            </div>

            <!-- Global Color Picker Popover (Hidden by default) -->
            <div id="tb-color-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 p-4 w-64 animate-fade-in-up">
                <div class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">プリセット</div>
                <div class="grid grid-cols-5 gap-3 mb-5" id="tb-color-presets">
                    <!-- Presets injected by JS -->
                </div>
                <div class="flex justify-between items-end mb-3">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">カスタム</div>
                    <button id="tb-custom-color-edit-btn" class="text-xs text-blue-500 hover:text-blue-600 font-medium transition-colors">編集</button>
                    <input type="color" id="tb-custom-color-input" class="invisible w-0 h-0 absolute">
                </div>
                <div class="grid grid-cols-5 gap-3" id="tb-color-customs">
                    <!-- Custom slots injected by JS -->
                </div>
            </div>
        </div>
    `}function Ii(e,t,n){const i=e.map(s=>`<div class="tb-select-option px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer text-sm transition-colors ${s===t?"bg-blue-50 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}" data-value="${s}">${s}</div>`).join("");return`
        <div class="relative tb-custom-select group min-w-[64px]" data-type="${n}" data-value="${t}">
            <button type="button" class="tb-select-trigger w-full py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-center shadow-sm hover:border-gray-300 dark:hover:border-gray-500 hover:shadow-md focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-400 transition-all flex items-center justify-center font-mono font-medium text-gray-700 dark:text-gray-200">
                <span class="value-display">${t}</span>
            </button>
            <div class="hidden tb-select-options absolute top-full left-0 mt-2 w-full min-w-[70px] max-h-56 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-xl z-20 custom-scrollbar animate-fade-in-down origin-top-left">
                ${i}
            </div>
        </div>
    `}function hf(e){const[t,n]=e.start.split(":"),[i,s]=e.end.split(":");return`
        <div class="flex-shrink-0 relative pl-2 cursor-grab active:cursor-grabbing handle p-1 rounded-md text-gray-400 hover:text-gray-600" title="移動">
             <div class="tb-color-trigger w-6 h-6 rounded-full shadow-sm hover:scale-110 active:scale-95 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900 cursor-pointer" 
                style="background-color: ${e.color}" data-color="${e.color}" title="色を変更"></div>
        </div>
        
        <div class="flex-1 flex items-center gap-4 px-2 handle cursor-grab active:cursor-grabbing">
            <div class="flex items-center gap-2">
                ${Ii(Gr,t,"start-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ii(Xr,n,"start-m")}
            </div>
            
            <div class="w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
            
            <div class="flex items-center gap-2">
                ${Ii(Gr,i,"end-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${Ii(Xr,s,"end-m")}
            </div>
        </div>

        <div class="flex items-center pr-2">
            <button class="delete-btn p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const ws=5,Kr={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${ws}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${ws}個)</span>`};function Jr(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return t*60+n}function ks(e,t){if(!e)return;const n=t>=ws;e.disabled=n,e.innerHTML=n?Kr.LIMIT:Kr.ADD}const ff=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6"],fc="timeblock_custom_colors";let Zi=null,nn=-1;function Zr(){try{const e=localStorage.getItem(fc);return e?JSON.parse(e):["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}catch{return["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}}function gf(e){localStorage.setItem(fc,JSON.stringify(e))}function pf(e){const t=document.getElementById("tb-color-picker"),n=document.getElementById("tb-color-presets"),i=document.getElementById("tb-color-customs"),s=document.getElementById("tb-custom-color-input"),o=document.getElementById("tb-custom-color-edit-btn");if(!t||!n||!i)return;n.innerHTML=ff.map(a=>`
        <button class="w-8 h-8 rounded-full shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400"
            style="background-color: ${a}" data-color="${a}"></button>
    `).join("");const r=()=>{const a=Zr();i.innerHTML=a.map((l,c)=>`
            <button class="custom-color-slot w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 relative overflow-hidden"
                style="background-color: ${l}" data-index="${c}" data-color="${l}">
                <div class="absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"></div>
            </button>
        `).join("")};r(),t.addEventListener("click",a=>{const l=a.target.closest("button[data-color]");if(l&&!l.classList.contains("custom-color-slot")){const c=l.dataset.color;Zs(c,t)}else if(l&&l.classList.contains("custom-color-slot")){nn=parseInt(l.dataset.index),document.querySelectorAll(".custom-color-slot").forEach(d=>d.classList.remove("ring-offset-2","ring-2","ring-blue-500")),l.classList.add("ring-offset-2","ring-2","ring-blue-500");const c=l.dataset.color;c!=="#E5E7EB"&&Zs(c,t)}}),o.onclick=()=>{nn===-1&&(nn=0),s.click()},s.onchange=a=>{nn===-1&&(nn=0);const l=a.target.value,c=Zr();c[nn]=l,gf(c),r(),Zs(l,t)}}function Zs(e,t){Zi&&(Zi.style.backgroundColor=e,Zi.dataset.color=e,t.classList.add("hidden"))}function mf(e){var a;Zi=e;const t=document.getElementById("tb-color-picker");if(!t)return;const n=e.getBoundingClientRect(),i=(a=document.getElementById("tb-scroll-container"))==null?void 0:a.parentElement;if(!i)return;const s=i.getBoundingClientRect();let o=n.bottom-s.top+10,r=n.left-s.left;r+280>s.width&&(r=s.width-290),t.style.top=`${o}px`,t.style.left=`${r}px`,t.classList.remove("hidden")}function bf(){const e=document.getElementById("tb-color-picker");e&&e.classList.add("hidden")}function yf(e,t){const n=e.querySelector('.tb-custom-select[data-type="start-h"]').dataset.value,i=e.querySelector('.tb-custom-select[data-type="start-m"]').dataset.value,s=e.querySelector('.tb-custom-select[data-type="end-h"]').dataset.value,o=e.querySelector('.tb-custom-select[data-type="end-m"]').dataset.value,r=e.querySelector(".tb-color-trigger").dataset.color;return{id:e.dataset.id||null,start:`${n}:${i}`,end:`${s}:${o}`,color:r,order:t}}function xf(e){const t=e.dataset.id;if(!t){e.remove(),ks(document.getElementById("add-tb-btn"),ue().length);return}e.style.opacity="0",e.style.transform="translateX(-20px)",setTimeout(()=>{R({message:`削除しますか？
（完了ボタンを押さなくても、削除は即時反映されます）`,type:"confirm",onConfirm:async()=>{try{await gh(t),e.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),ks(document.getElementById("add-tb-btn"),ue().length)}catch{R({message:"削除に失敗しました",type:"error"})}},onCancel:()=>{e.style.opacity="1",e.style.transform="translate(0)"}})},200)}async function vf(e,t){const i=Array.from(document.querySelectorAll(".tb-row")).map((o,r)=>yf(o,r));for(const o of i){const r=Jr(o.start),a=Jr(o.end);if(r>=a)return R({message:`時間設定が不正です: ${o.start} - ${o.end}
(終了時間は開始時間より後にしてください)`,type:"error"})}e.disabled=!0;const s=e.textContent;e.textContent="保存中...";try{const o=i.map(r=>fh({id:r.id,name:`${r.start}-${r.end}`,start:r.start,end:r.end,color:r.color,order:r.order}));await Promise.all(o),document.dispatchEvent(new CustomEvent("timeblocks-updated")),t()}catch(o){console.error("Timeblock save error (suppressed):",o)}finally{e.disabled=!1,e.textContent=s}}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Qr(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Qr(Object(n),!0).forEach(function(i){wf(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qr(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function Qi(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?Qi=function(t){return typeof t}:Qi=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Qi(e)}function wf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(){return he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},he.apply(this,arguments)}function kf(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function _f(e,t){if(e==null)return{};var n=kf(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var Sf="1.15.6";function de(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var pe=de(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),wi=de(/Edge/i),ta=de(/firefox/i),Jn=de(/safari/i)&&!de(/chrome/i)&&!de(/android/i),ur=de(/iP(ad|od|hone)/i),gc=de(/chrome/i)&&de(/android/i),pc={capture:!1,passive:!1};function H(e,t,n){e.addEventListener(t,n,!pe&&pc)}function N(e,t,n){e.removeEventListener(t,n,!pe&&pc)}function _s(e,t){if(t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function mc(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function zt(e,t,n,i){if(e){n=n||document;do{if(t!=null&&(t[0]===">"?e.parentNode===n&&_s(e,t):_s(e,t))||i&&e===n)return e;if(e===n)break}while(e=mc(e))}return null}var ea=/\s+/g;function Lt(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(ea," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(ea," ")}}function L(e,t,n){var i=e&&e.style;if(i){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=n+(typeof n=="string"?"":"px")}}function pn(e,t){var n="";if(typeof e=="string")n=e;else do{var i=L(e,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(n)}function bc(e,t,n){if(e){var i=e.getElementsByTagName(t),s=0,o=i.length;if(n)for(;s<o;s++)n(i[s],s);return i}return[]}function Xt(){var e=document.scrollingElement;return e||document.documentElement}function dt(e,t,n,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var o,r,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==Xt()?(o=e.getBoundingClientRect(),r=o.top,a=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(r=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(s=s||e.parentNode,!pe))do if(s&&s.getBoundingClientRect&&(L(s,"transform")!=="none"||n&&L(s,"position")!=="static")){var h=s.getBoundingClientRect();r-=h.top+parseInt(L(s,"border-top-width")),a-=h.left+parseInt(L(s,"border-left-width")),l=r+o.height,c=a+o.width;break}while(s=s.parentNode);if(i&&e!==window){var f=pn(s||e),g=f&&f.a,p=f&&f.d;f&&(r/=p,a/=g,u/=g,d/=p,l=r+d,c=a+u)}return{top:r,left:a,bottom:l,right:c,width:u,height:d}}}function na(e,t,n){for(var i=we(e,!0),s=dt(e)[t];i;){var o=dt(i)[n],r=void 0;if(r=s>=o,!r)return i;if(i===Xt())break;i=we(i,!1)}return!1}function bn(e,t,n,i){for(var s=0,o=0,r=e.children;o<r.length;){if(r[o].style.display!=="none"&&r[o]!==A.ghost&&(i||r[o]!==A.dragged)&&zt(r[o],n.draggable,e,!1)){if(s===t)return r[o];s++}o++}return null}function hr(e,t){for(var n=e.lastElementChild;n&&(n===A.ghost||L(n,"display")==="none"||t&&!_s(n,t));)n=n.previousElementSibling;return n||null}function Rt(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==A.clone&&(!t||_s(e,t))&&n++;return n}function ia(e){var t=0,n=0,i=Xt();if(e)do{var s=pn(e),o=s.a,r=s.d;t+=e.scrollLeft*o,n+=e.scrollTop*r}while(e!==i&&(e=e.parentNode));return[t,n]}function Ef(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n)}return-1}function we(e,t){if(!e||!e.getBoundingClientRect)return Xt();var n=e,i=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var s=L(n);if(n.clientWidth<n.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Xt();if(i||t)return n;i=!0}}while(n=n.parentNode);return Xt()}function Df(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function Qs(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var Zn;function yc(e,t){return function(){if(!Zn){var n=arguments,i=this;n.length===1?e.call(i,n[0]):e.apply(i,n),Zn=setTimeout(function(){Zn=void 0},t)}}}function Mf(){clearTimeout(Zn),Zn=void 0}function xc(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function vc(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function wc(e,t,n){var i={};return Array.from(e.children).forEach(function(s){var o,r,a,l;if(!(!zt(s,t.draggable,e,!1)||s.animated||s===n)){var c=dt(s);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,c.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,c.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,c.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Tt="Sortable"+new Date().getTime();function Tf(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(L(s,"display")==="none"||s===A.ghost)){e.push({target:s,rect:dt(s)});var o=Jt({},e[e.length-1].rect);if(s.thisAnimationDuration){var r=pn(s,!0);r&&(o.top-=r.f,o.left-=r.e)}s.fromRect=o}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(Ef(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var o=!1,r=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,u=dt(c),h=c.prevFromRect,f=c.prevToRect,g=a.rect,p=pn(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&Qs(h,u)&&!Qs(d,u)&&(g.top-u.top)/(g.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(l=Lf(g,h,f,s.options)),Qs(u,d)||(c.prevFromRect=d,c.prevToRect=u,l||(l=s.options.animation),s.animate(c,g,u,l)),l&&(o=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),o?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),e=[]},animate:function(i,s,o,r){if(r){L(i,"transition",""),L(i,"transform","");var a=pn(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-o.left)/(l||1),u=(s.top-o.top)/(c||1);i.animatingX=!!d,i.animatingY=!!u,L(i,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=If(i),L(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),L(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){L(i,"transition",""),L(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function If(e){return e.offsetWidth}function Lf(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}var sn=[],to={initializeByDefault:!0},ki={mount:function(t){for(var n in to)to.hasOwnProperty(n)&&!(n in t)&&(t[n]=to[n]);sn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),sn.push(t)},pluginEvent:function(t,n,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";sn.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][o]&&n[r.pluginName][o](Jt({sortable:n},i)),n.options[r.pluginName]&&n[r.pluginName][t]&&n[r.pluginName][t](Jt({sortable:n},i)))})},initializePlugins:function(t,n,i,s){sn.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,n,t.options);c.sortable=t,c.options=t.options,t[l]=c,he(i,c.defaults)}});for(var o in t.options)if(t.options.hasOwnProperty(o)){var r=this.modifyOption(t,o,t.options[o]);typeof r<"u"&&(t.options[o]=r)}},getEventProperties:function(t,n){var i={};return sn.forEach(function(s){typeof s.eventProperties=="function"&&he(i,s.eventProperties.call(n[s.pluginName],t))}),i},modifyOption:function(t,n,i){var s;return sn.forEach(function(o){t[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[n]=="function"&&(s=o.optionListeners[n].call(t[o.pluginName],i))}),s}};function Af(e){var t=e.sortable,n=e.rootEl,i=e.name,s=e.targetEl,o=e.cloneEl,r=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,f=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[Tt],!!t){var p,m=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!pe&&!wi?p=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(i,!0,!0)),p.to=r||n,p.from=a||n,p.item=s||n,p.clone=o,p.oldIndex=l,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=f?f.lastPutMode:void 0;var y=Jt(Jt({},g),ki.getEventProperties(i,t));for(var v in y)p[v]=y[v];n&&n.dispatchEvent(p),m[b]&&m[b].call(t,p)}}var Cf=["evt"],St=function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,o=_f(i,Cf);ki.pluginEvent.bind(A)(t,n,Jt({dragEl:E,parentEl:rt,ghostEl:O,rootEl:et,nextEl:je,lastDownEl:ts,cloneEl:ot,cloneHidden:ye,dragStarted:Fn,putSortable:bt,activeSortable:A.active,originalEvent:s,oldIndex:hn,oldDraggableIndex:Qn,newIndex:At,newDraggableIndex:be,hideGhostForTarget:Ec,unhideGhostForTarget:Dc,cloneNowHidden:function(){ye=!0},cloneNowShown:function(){ye=!1},dispatchSortableEvent:function(a){_t({sortable:n,name:a,originalEvent:s})}},o))};function _t(e){Af(Jt({putSortable:bt,cloneEl:ot,targetEl:E,rootEl:et,oldIndex:hn,oldDraggableIndex:Qn,newIndex:At,newDraggableIndex:be},e))}var E,rt,O,et,je,ts,ot,ye,hn,At,Qn,be,Li,bt,un=!1,Ss=!1,Es=[],Be,$t,eo,no,sa,oa,Fn,on,ti,ei=!1,Ai=!1,es,yt,io=[],Lo=!1,Ds=[],$s=typeof document<"u",Ci=ur,ra=wi||pe?"cssFloat":"float",Of=$s&&!gc&&!ur&&"draggable"in document.createElement("div"),kc=(function(){if($s){if(pe)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),_c=function(t,n){var i=L(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=bn(t,0,n),r=bn(t,1,n),a=o&&L(o),l=r&&L(r),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+dt(o).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+dt(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[ra]==="none"||r&&i[ra]==="none"&&c+d>s)?"vertical":"horizontal"},Pf=function(t,n,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,r=i?t.width:t.height,a=i?n.left:n.top,l=i?n.right:n.bottom,c=i?n.width:n.height;return s===a||o===l||s+r/2===a+c/2},Rf=function(t,n){var i;return Es.some(function(s){var o=s[Tt].options.emptyInsertThreshold;if(!(!o||hr(s))){var r=dt(s),a=t>=r.left-o&&t<=r.right+o,l=n>=r.top-o&&n<=r.bottom+o;if(a&&l)return i=s}}),i},Sc=function(t){function n(o,r){return function(a,l,c,d){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(o==null&&(r||u))return!0;if(o==null||o===!1)return!1;if(r&&o==="clone")return o;if(typeof o=="function")return n(o(a,l,c,d),r)(a,l,c,d);var h=(r?a:l).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var i={},s=t.group;(!s||Qi(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=n(s.pull,!0),i.checkPut=n(s.put),i.revertClone=s.revertClone,t.group=i},Ec=function(){!kc&&O&&L(O,"display","none")},Dc=function(){!kc&&O&&L(O,"display","")};$s&&!gc&&document.addEventListener("click",function(e){if(Ss)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),Ss=!1,!1},!0);var Fe=function(t){if(E){t=t.touches?t.touches[0]:t;var n=Rf(t.clientX,t.clientY);if(n){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=n,i.preventDefault=void 0,i.stopPropagation=void 0,n[Tt]._onDragOver(i)}}},Bf=function(t){E&&E.parentNode[Tt]._isOutsideThisEl(t.target)};function A(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=he({},t),e[Tt]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return _c(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,a){r.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:A.supportPointer!==!1&&"PointerEvent"in window&&(!Jn||ur),emptyInsertThreshold:5};ki.initializePlugins(this,e,n);for(var i in n)!(i in t)&&(t[i]=n[i]);Sc(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:Of,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?H(e,"pointerdown",this._onTapStart):(H(e,"mousedown",this._onTapStart),H(e,"touchstart",this._onTapStart)),this.nativeDraggable&&(H(e,"dragover",this),H(e,"dragenter",this)),Es.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),he(this,Tf())}A.prototype={constructor:A,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(on=null)},_getDirection:function(t,n){return typeof this.options.direction=="function"?this.options.direction.call(this,t,n,E):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n=this,i=this.el,s=this.options,o=s.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(Vf(i),!E&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Jn&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=zt(l,s.draggable,i,!1),!(l&&l.animated)&&ts!==l)){if(hn=Rt(l),Qn=Rt(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){_t({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),St("filter",n,{evt:t}),o&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=zt(c,u.trim(),i,!1),u)return _t({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),St("filter",n,{evt:t}),!0}),d)){o&&t.preventDefault();return}s.handle&&!zt(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,n,i){var s=this,o=s.el,r=s.options,a=o.ownerDocument,l;if(i&&!E&&i.parentNode===o){var c=dt(i);if(et=o,E=i,rt=E.parentNode,je=E.nextSibling,ts=i,Li=r.group,A.dragged=E,Be={target:E,clientX:(n||t).clientX,clientY:(n||t).clientY},sa=Be.clientX-c.left,oa=Be.clientY-c.top,this._lastX=(n||t).clientX,this._lastY=(n||t).clientY,E.style["will-change"]="all",l=function(){if(St("delayEnded",s,{evt:t}),A.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!ta&&s.nativeDraggable&&(E.draggable=!0),s._triggerDragStart(t,n),_t({sortable:s,name:"choose",originalEvent:t}),Lt(E,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){bc(E,d.trim(),so)}),H(a,"dragover",Fe),H(a,"mousemove",Fe),H(a,"touchmove",Fe),r.supportPointer?(H(a,"pointerup",s._onDrop),!this.nativeDraggable&&H(a,"pointercancel",s._onDrop)):(H(a,"mouseup",s._onDrop),H(a,"touchend",s._onDrop),H(a,"touchcancel",s._onDrop)),ta&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),St("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(wi||pe))){if(A.eventCanceled){this._onDrop();return}r.supportPointer?(H(a,"pointerup",s._disableDelayedDrag),H(a,"pointercancel",s._disableDelayedDrag)):(H(a,"mouseup",s._disableDelayedDrag),H(a,"touchend",s._disableDelayedDrag),H(a,"touchcancel",s._disableDelayedDrag)),H(a,"mousemove",s._delayedDragTouchMoveHandler),H(a,"touchmove",s._delayedDragTouchMoveHandler),r.supportPointer&&H(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&so(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;N(t,"mouseup",this._disableDelayedDrag),N(t,"touchend",this._disableDelayedDrag),N(t,"touchcancel",this._disableDelayedDrag),N(t,"pointerup",this._disableDelayedDrag),N(t,"pointercancel",this._disableDelayedDrag),N(t,"mousemove",this._delayedDragTouchMoveHandler),N(t,"touchmove",this._delayedDragTouchMoveHandler),N(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||t.pointerType=="touch"&&t,!this.nativeDraggable||n?this.options.supportPointer?H(document,"pointermove",this._onTouchMove):n?H(document,"touchmove",this._onTouchMove):H(document,"mousemove",this._onTouchMove):(H(E,"dragend",this),H(et,"dragstart",this._onDragStart));try{document.selection?ns(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,n){if(un=!1,et&&E){St("dragStarted",this,{evt:n}),this.nativeDraggable&&H(document,"dragover",Bf);var i=this.options;!t&&Lt(E,i.dragClass,!1),Lt(E,i.ghostClass,!0),A.active=this,t&&this._appendGhost(),_t({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if($t){this._lastX=$t.clientX,this._lastY=$t.clientY,Ec();for(var t=document.elementFromPoint($t.clientX,$t.clientY),n=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint($t.clientX,$t.clientY),t!==n);)n=t;if(E.parentNode[Tt]._isOutsideThisEl(t),n)do{if(n[Tt]){var i=void 0;if(i=n[Tt]._onDragOver({clientX:$t.clientX,clientY:$t.clientY,target:t,rootEl:n}),i&&!this.options.dragoverBubble)break}t=n}while(n=mc(n));Dc()}},_onTouchMove:function(t){if(Be){var n=this.options,i=n.fallbackTolerance,s=n.fallbackOffset,o=t.touches?t.touches[0]:t,r=O&&pn(O,!0),a=O&&r&&r.a,l=O&&r&&r.d,c=Ci&&yt&&ia(yt),d=(o.clientX-Be.clientX+s.x)/(a||1)+(c?c[0]-io[0]:0)/(a||1),u=(o.clientY-Be.clientY+s.y)/(l||1)+(c?c[1]-io[1]:0)/(l||1);if(!A.active&&!un){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(O){r?(r.e+=d-(eo||0),r.f+=u-(no||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");L(O,"webkitTransform",h),L(O,"mozTransform",h),L(O,"msTransform",h),L(O,"transform",h),eo=d,no=u,$t=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!O){var t=this.options.fallbackOnBody?document.body:et,n=dt(E,!0,Ci,!0,t),i=this.options;if(Ci){for(yt=t;L(yt,"position")==="static"&&L(yt,"transform")==="none"&&yt!==document;)yt=yt.parentNode;yt!==document.body&&yt!==document.documentElement?(yt===document&&(yt=Xt()),n.top+=yt.scrollTop,n.left+=yt.scrollLeft):yt=Xt(),io=ia(yt)}O=E.cloneNode(!0),Lt(O,i.ghostClass,!1),Lt(O,i.fallbackClass,!0),Lt(O,i.dragClass,!0),L(O,"transition",""),L(O,"transform",""),L(O,"box-sizing","border-box"),L(O,"margin",0),L(O,"top",n.top),L(O,"left",n.left),L(O,"width",n.width),L(O,"height",n.height),L(O,"opacity","0.8"),L(O,"position",Ci?"absolute":"fixed"),L(O,"zIndex","100000"),L(O,"pointerEvents","none"),A.ghost=O,t.appendChild(O),L(O,"transform-origin",sa/parseInt(O.style.width)*100+"% "+oa/parseInt(O.style.height)*100+"%")}},_onDragStart:function(t,n){var i=this,s=t.dataTransfer,o=i.options;if(St("dragStart",this,{evt:t}),A.eventCanceled){this._onDrop();return}St("setupClone",this),A.eventCanceled||(ot=vc(E),ot.removeAttribute("id"),ot.draggable=!1,ot.style["will-change"]="",this._hideClone(),Lt(ot,this.options.chosenClass,!1),A.clone=ot),i.cloneId=ns(function(){St("clone",i),!A.eventCanceled&&(i.options.removeCloneOnHide||et.insertBefore(ot,E),i._hideClone(),_t({sortable:i,name:"clone"}))}),!n&&Lt(E,o.dragClass,!0),n?(Ss=!0,i._loopId=setInterval(i._emulateDragOver,50)):(N(document,"mouseup",i._onDrop),N(document,"touchend",i._onDrop),N(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,E)),H(document,"drop",i),L(E,"transform","translateZ(0)")),un=!0,i._dragStartId=ns(i._dragStarted.bind(i,n,t)),H(document,"selectstart",i),Fn=!0,window.getSelection().removeAllRanges(),Jn&&L(document.body,"user-select","none")},_onDragOver:function(t){var n=this.el,i=t.target,s,o,r,a=this.options,l=a.group,c=A.active,d=Li===l,u=a.sort,h=bt||c,f,g=this,p=!1;if(Lo)return;function m(mt,ht){St(mt,g,Jt({evt:t,isOwner:d,axis:f?"vertical":"horizontal",revert:r,dragRect:s,targetRect:o,canSort:u,fromSortable:h,target:i,completed:y,onMove:function(Ce,me){return Oi(et,n,E,s,Ce,dt(Ce),t,me)},changed:v},ht))}function b(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==h&&h.captureAnimationState()}function y(mt){return m("dragOverCompleted",{insertion:mt}),mt&&(d?c._hideClone():c._showClone(g),g!==h&&(Lt(E,bt?bt.options.ghostClass:c.options.ghostClass,!1),Lt(E,a.ghostClass,!0)),bt!==g&&g!==A.active?bt=g:g===A.active&&bt&&(bt=null),h===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===n&&!i.animated)&&(on=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(E.parentNode[Tt]._isOutsideThisEl(t.target),!mt&&Fe(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function v(){At=Rt(E),be=Rt(E,a.draggable),_t({sortable:g,name:"change",toEl:n,newIndex:At,newDraggableIndex:be,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=zt(i,a.draggable,n,!0),m("dragOver"),A.eventCanceled)return p;if(E.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if(Ss=!1,c&&!a.disabled&&(d?u||(r=rt!==et):bt===this||(this.lastPutMode=Li.checkPull(this,c,E,t))&&l.checkPut(this,c,E,t))){if(f=this._getDirection(t,i)==="vertical",s=dt(E),m("dragOverValid"),A.eventCanceled)return p;if(r)return rt=et,b(),this._hideClone(),m("revert"),A.eventCanceled||(je?et.insertBefore(E,je):et.appendChild(E)),y(!0);var w=hr(n,a.draggable);if(!w||Hf(t,f,this)&&!w.animated){if(w===E)return y(!1);if(w&&n===t.target&&(i=w),i&&(o=dt(i)),Oi(et,n,E,s,i,o,t,!!i)!==!1)return b(),w&&w.nextSibling?n.insertBefore(E,w.nextSibling):n.appendChild(E),rt=n,v(),y(!0)}else if(w&&$f(t,f,this)){var x=bn(n,0,a,!0);if(x===E)return y(!1);if(i=x,o=dt(i),Oi(et,n,E,s,i,o,t,!1)!==!1)return b(),n.insertBefore(E,x),rt=n,v(),y(!0)}else if(i.parentNode===n){o=dt(i);var _=0,k,S=E.parentNode!==n,T=!Pf(E.animated&&E.toRect||s,i.animated&&i.toRect||o,f),I=f?"top":"left",M=na(i,"top","top")||na(E,"top","top"),C=M?M.scrollTop:void 0;on!==i&&(k=o[I],ei=!1,Ai=!T&&a.invertSwap||S),_=zf(t,i,o,f,T?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Ai,on===i);var U;if(_!==0){var Q=Rt(E);do Q-=_,U=rt.children[Q];while(U&&(L(U,"display")==="none"||U===O))}if(_===0||U===i)return y(!1);on=i,ti=_;var z=i.nextElementSibling,j=!1;j=_===1;var J=Oi(et,n,E,s,i,o,t,j);if(J!==!1)return(J===1||J===-1)&&(j=J===1),Lo=!0,setTimeout(Nf,30),b(),j&&!z?n.appendChild(E):i.parentNode.insertBefore(E,j?z:i),M&&xc(M,0,C-M.scrollTop),rt=E.parentNode,k!==void 0&&!Ai&&(es=Math.abs(k-dt(i)[I])),v(),y(!0)}if(n.contains(E))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){N(document,"mousemove",this._onTouchMove),N(document,"touchmove",this._onTouchMove),N(document,"pointermove",this._onTouchMove),N(document,"dragover",Fe),N(document,"mousemove",Fe),N(document,"touchmove",Fe)},_offUpEvents:function(){var t=this.el.ownerDocument;N(t,"mouseup",this._onDrop),N(t,"touchend",this._onDrop),N(t,"pointerup",this._onDrop),N(t,"pointercancel",this._onDrop),N(t,"touchcancel",this._onDrop),N(document,"selectstart",this)},_onDrop:function(t){var n=this.el,i=this.options;if(At=Rt(E),be=Rt(E,i.draggable),St("drop",this,{evt:t}),rt=E&&E.parentNode,At=Rt(E),be=Rt(E,i.draggable),A.eventCanceled){this._nulling();return}un=!1,Ai=!1,ei=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Ao(this.cloneId),Ao(this._dragStartId),this.nativeDraggable&&(N(document,"drop",this),N(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Jn&&L(document.body,"user-select",""),L(E,"transform",""),t&&(Fn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),O&&O.parentNode&&O.parentNode.removeChild(O),(et===rt||bt&&bt.lastPutMode!=="clone")&&ot&&ot.parentNode&&ot.parentNode.removeChild(ot),E&&(this.nativeDraggable&&N(E,"dragend",this),so(E),E.style["will-change"]="",Fn&&!un&&Lt(E,bt?bt.options.ghostClass:this.options.ghostClass,!1),Lt(E,this.options.chosenClass,!1),_t({sortable:this,name:"unchoose",toEl:rt,newIndex:null,newDraggableIndex:null,originalEvent:t}),et!==rt?(At>=0&&(_t({rootEl:rt,name:"add",toEl:rt,fromEl:et,originalEvent:t}),_t({sortable:this,name:"remove",toEl:rt,originalEvent:t}),_t({rootEl:rt,name:"sort",toEl:rt,fromEl:et,originalEvent:t}),_t({sortable:this,name:"sort",toEl:rt,originalEvent:t})),bt&&bt.save()):At!==hn&&At>=0&&(_t({sortable:this,name:"update",toEl:rt,originalEvent:t}),_t({sortable:this,name:"sort",toEl:rt,originalEvent:t})),A.active&&((At==null||At===-1)&&(At=hn,be=Qn),_t({sortable:this,name:"end",toEl:rt,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){St("nulling",this),et=E=rt=O=je=ot=ts=ye=Be=$t=Fn=At=be=hn=Qn=on=ti=bt=Li=A.dragged=A.ghost=A.clone=A.active=null,Ds.forEach(function(t){t.checked=!0}),Ds.length=eo=no=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":E&&(this._onDragOver(t),Ff(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],n,i=this.el.children,s=0,o=i.length,r=this.options;s<o;s++)n=i[s],zt(n,r.draggable,this.el,!1)&&t.push(n.getAttribute(r.dataIdAttr)||Wf(n));return t},sort:function(t,n){var i={},s=this.el;this.toArray().forEach(function(o,r){var a=s.children[r];zt(a,this.options.draggable,s,!1)&&(i[o]=a)},this),n&&this.captureAnimationState(),t.forEach(function(o){i[o]&&(s.removeChild(i[o]),s.appendChild(i[o]))}),n&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,n){return zt(t,n||this.options.draggable,this.el,!1)},option:function(t,n){var i=this.options;if(n===void 0)return i[t];var s=ki.modifyOption(this,t,n);typeof s<"u"?i[t]=s:i[t]=n,t==="group"&&Sc(i)},destroy:function(){St("destroy",this);var t=this.el;t[Tt]=null,N(t,"mousedown",this._onTapStart),N(t,"touchstart",this._onTapStart),N(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(N(t,"dragover",this),N(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),Es.splice(Es.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!ye){if(St("hideClone",this),A.eventCanceled)return;L(ot,"display","none"),this.options.removeCloneOnHide&&ot.parentNode&&ot.parentNode.removeChild(ot),ye=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(ye){if(St("showClone",this),A.eventCanceled)return;E.parentNode==et&&!this.options.group.revertClone?et.insertBefore(ot,E):je?et.insertBefore(ot,je):et.appendChild(ot),this.options.group.revertClone&&this.animate(E,ot),L(ot,"display",""),ye=!1}}};function Ff(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Oi(e,t,n,i,s,o,r,a){var l,c=e[Tt],d=c.options.onMove,u;return window.CustomEvent&&!pe&&!wi?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=s||t,l.relatedRect=o||dt(t),l.willInsertAfter=a,l.originalEvent=r,e.dispatchEvent(l),d&&(u=d.call(c,l,r)),u}function so(e){e.draggable=!1}function Nf(){Lo=!1}function $f(e,t,n){var i=dt(bn(n.el,0,n.options,!0)),s=wc(n.el,n.options,O),o=10;return t?e.clientX<s.left-o||e.clientY<i.top&&e.clientX<i.right:e.clientY<s.top-o||e.clientY<i.bottom&&e.clientX<i.left}function Hf(e,t,n){var i=dt(hr(n.el,n.options.draggable)),s=wc(n.el,n.options,O),o=10;return t?e.clientX>s.right+o||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>s.bottom+o||e.clientX>i.right&&e.clientY>i.top}function zf(e,t,n,i,s,o,r,a){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,h=!1;if(!r){if(a&&es<c*s){if(!ei&&(ti===1?l>d+c*o/2:l<u-c*o/2)&&(ei=!0),ei)h=!0;else if(ti===1?l<d+es:l>u-es)return-ti}else if(l>d+c*(1-s)/2&&l<u-c*(1-s)/2)return jf(t)}return h=h||r,h&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}function jf(e){return Rt(E)<Rt(e)?1:-1}function Wf(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function Vf(e){Ds.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&Ds.push(i)}}function ns(e){return setTimeout(e,0)}function Ao(e){return clearTimeout(e)}$s&&H(document,"touchmove",function(e){(A.active||un)&&e.cancelable&&e.preventDefault()});A.utils={on:H,off:N,css:L,find:bc,is:function(t,n){return!!zt(t,n,t,!1)},extend:Df,throttle:yc,closest:zt,toggleClass:Lt,clone:vc,index:Rt,nextTick:ns,cancelNextTick:Ao,detectDirection:_c,getChild:bn,expando:Tt};A.get=function(e){return e[Tt]};A.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(A.utils=Jt(Jt({},A.utils),i.utils)),ki.mount(i)})};A.create=function(e,t){return new A(e,t)};A.version=Sf;var ct=[],Nn,Co,Oo=!1,oo,ro,Ms,$n;function Uf(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(n){var i=n.originalEvent;this.sortable.nativeDraggable?H(document,"dragover",this._handleAutoScroll):this.options.supportPointer?H(document,"pointermove",this._handleFallbackAutoScroll):i.touches?H(document,"touchmove",this._handleFallbackAutoScroll):H(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var i=n.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?N(document,"dragover",this._handleAutoScroll):(N(document,"pointermove",this._handleFallbackAutoScroll),N(document,"touchmove",this._handleFallbackAutoScroll),N(document,"mousemove",this._handleFallbackAutoScroll)),aa(),is(),Mf()},nulling:function(){Ms=Co=Nn=Oo=$n=oo=ro=null,ct.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,i){var s=this,o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(o,r);if(Ms=n,i||this.options.forceAutoScrollFallback||wi||pe||Jn){ao(n,this.options,a,i);var l=we(a,!0);Oo&&(!$n||o!==oo||r!==ro)&&($n&&aa(),$n=setInterval(function(){var c=we(document.elementFromPoint(o,r),!0);c!==l&&(l=c,is()),ao(n,s.options,c,i)},10),oo=o,ro=r)}else{if(!this.options.bubbleScroll||we(a,!0)===Xt()){is();return}ao(n,this.options,we(a,!1),!1)}}},he(e,{pluginName:"scroll",initializeByDefault:!0})}function is(){ct.forEach(function(e){clearInterval(e.pid)}),ct=[]}function aa(){clearInterval($n)}var ao=yc(function(e,t,n,i){if(t.scroll){var s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,a=t.scrollSpeed,l=Xt(),c=!1,d;Co!==n&&(Co=n,is(),Nn=t.scroll,d=t.scrollFn,Nn===!0&&(Nn=we(n,!0)));var u=0,h=Nn;do{var f=h,g=dt(f),p=g.top,m=g.bottom,b=g.left,y=g.right,v=g.width,w=g.height,x=void 0,_=void 0,k=f.scrollWidth,S=f.scrollHeight,T=L(f),I=f.scrollLeft,M=f.scrollTop;f===l?(x=v<k&&(T.overflowX==="auto"||T.overflowX==="scroll"||T.overflowX==="visible"),_=w<S&&(T.overflowY==="auto"||T.overflowY==="scroll"||T.overflowY==="visible")):(x=v<k&&(T.overflowX==="auto"||T.overflowX==="scroll"),_=w<S&&(T.overflowY==="auto"||T.overflowY==="scroll"));var C=x&&(Math.abs(y-s)<=r&&I+v<k)-(Math.abs(b-s)<=r&&!!I),U=_&&(Math.abs(m-o)<=r&&M+w<S)-(Math.abs(p-o)<=r&&!!M);if(!ct[u])for(var Q=0;Q<=u;Q++)ct[Q]||(ct[Q]={});(ct[u].vx!=C||ct[u].vy!=U||ct[u].el!==f)&&(ct[u].el=f,ct[u].vx=C,ct[u].vy=U,clearInterval(ct[u].pid),(C!=0||U!=0)&&(c=!0,ct[u].pid=setInterval((function(){i&&this.layer===0&&A.active._onTouchMove(Ms);var z=ct[this.layer].vy?ct[this.layer].vy*a:0,j=ct[this.layer].vx?ct[this.layer].vx*a:0;typeof d=="function"&&d.call(A.dragged.parentNode[Tt],j,z,e,Ms,ct[this.layer].el)!=="continue"||xc(ct[this.layer].el,j,z)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==l&&(h=we(h,!1)));Oo=c}},30),Mc=function(t){var n=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(n){var c=i||o;a();var d=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function fr(){}fr.prototype={startIndex:null,dragStart:function(t){var n=t.oldDraggableIndex;this.startIndex=n},onSpill:function(t){var n=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=bn(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(n,s):this.sortable.el.appendChild(n),this.sortable.animateAll(),i&&i.animateAll()},drop:Mc};he(fr,{pluginName:"revertOnSpill"});function gr(){}gr.prototype={onSpill:function(t){var n=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),s.animateAll()},drop:Mc};he(gr,{pluginName:"removeOnSpill"});A.mount(new Uf);A.mount(gr,fr);const Yf={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function Tc(e=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",n.innerHTML=uf(),document.body.appendChild(n),qf(e),pf(),Gf(n)}function qf(e){const t=document.getElementById("tb-list"),n=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=ue(),s=document.createDocumentFragment();i.forEach(o=>s.appendChild(Ic(o))),t.appendChild(s),ks(n,i.length),new A(t,{animation:150,handle:".handle",ghostClass:"bg-blue-50",onEnd:function(o){}}),e!=null&&e.id&&requestAnimationFrame(()=>{const o=t.querySelector(`.tb-row[data-id="${e.id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("bg-blue-50","dark:bg-blue-900/20"))})}function Ic(e=null){const t=e||{...Yf},n=document.createElement("div");n.className="tb-row flex items-center gap-4 py-2 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg select-none",t.id&&(n.dataset.id=t.id),n.innerHTML=hf(t);const i=n.querySelector(".delete-btn");return i.onclick=()=>xf(n),n}function Gf(e){const t=e.querySelector("#add-tb-btn"),n=e.querySelector("#close-tb-modal"),i=e.querySelector("#close-tb-footer"),s=()=>{e.remove(),document.removeEventListener("keydown",o),document.removeEventListener("click",handleOutsideClick),window.tbHandleOutsideClick&&(window.tbHandleOutsideClick=null)},o=r=>{r.key==="Escape"&&s()};n.onclick=s,i.onclick=async()=>await vf(i,s),e.onclick=r=>{r.target===e&&s()},document.addEventListener("keydown",o),t.onclick=()=>{const r=document.getElementById("tb-list"),a=r.querySelectorAll(".tb-row").length;if(a<ws){const l=Ic();r.appendChild(l),ks(t,a+1),l.scrollIntoView({behavior:"smooth"})}},Xf(e)}function Xf(e){let t=null;const n=i=>{t&&!t.contains(i.target)&&(t.querySelector(".tb-select-options").classList.add("hidden"),t=null);const s=document.getElementById("tb-color-picker"),o=i.target.closest(".tb-color-trigger"),r=s&&s.contains(i.target);!o&&!r&&s&&!s.classList.contains("hidden")&&bf()};setTimeout(()=>document.addEventListener("click",n),0),e.addEventListener("click",i=>{const s=i.target.closest(".tb-select-trigger");if(s){const a=s.closest(".tb-custom-select"),l=a.querySelector(".tb-select-options");document.querySelectorAll(".tb-select-options").forEach(c=>{c!==l&&c.classList.add("hidden")}),l.classList.toggle("hidden"),t=l.classList.contains("hidden")?null:a,i.stopPropagation();return}const o=i.target.closest(".tb-select-option");if(o){const a=o.closest(".tb-custom-select"),l=o.dataset.value;a.dataset.value=l,a.querySelector(".value-display").textContent=l,a.querySelectorAll(".tb-select-option").forEach(c=>{c.dataset.value===l?c.classList.add("bg-blue-50/50","font-bold"):c.classList.remove("bg-blue-50/50","font-bold")}),a.querySelector(".tb-select-options").classList.add("hidden"),t=null,i.stopPropagation();return}const r=i.target.closest(".tb-color-trigger");r&&(mf(r),i.stopPropagation())})}function Kf(e){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",n=>{n.stopPropagation(),oc()})}function Jf(e,t=[]){const n=document.getElementById("project-list");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}e.forEach(i=>{const s=t.filter(r=>r.projectId===i.id&&!r.completed).length,o=ai(i.name,"project",i.id,i.color,s);o.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},o.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation(),cr(r,"project",i)},li(o,"project",i.id),n.appendChild(o)})}}function Zf(e,t){let n=Ts(e,t);return Qf(n,t.sortCriteria)}function Ts(e,t){const{keyword:n,projectId:i,labelId:s,showCompleted:o,timeBlockId:r,duration:a,savedFilter:l}=t;return e.filter(c=>{if(!o&&c.status==="completed")return!1;if(i){if(i==="unassigned"){if(c.projectId&&c.projectId!=="unassigned"&&c.projectId!=="null")return!1}else if(c.projectId!==i)return!1}if(s&&(!c.labelIds||!c.labelIds.includes(s)))return!1;if(r){if(r==="unassigned"){if(c.timeBlockId&&c.timeBlockId!=="null")return!1}else if(String(c.timeBlockId)!==String(r))return!1}if(a&&Number(c.duration)!==Number(a))return!1;if(n){const d=n.toLowerCase(),u=c.title.toLowerCase().includes(d),h=(c.description||"").toLowerCase().includes(d);if(!u&&!h)return!1}return!(l&&l.query&&!tg(c,l.query))})}function Qf(e,t="createdAt_desc"){return[...e].sort((n,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(n.createdAt||0);case"createdAt_asc":return(n.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return n.dueDate?i.dueDate?n.dueDate-i.dueDate:-1:1;case"project_asc":return(n.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function tg(e,t){const n=eg(t);if(n.project&&n.project.length>0&&!n.project.includes(String(e.projectId||"")))return!1;if(n.timeblock&&n.timeblock.length>0){const i=!e.timeBlockId||e.timeBlockId==="null"?"none":String(e.timeBlockId);if(!n.timeblock.some(o=>o==="null"||o==="none"?i==="none"||i==="null"||!e.timeBlockId:o===i))return!1}if(n.duration&&n.duration.length>0&&!n.duration.includes(String(e.duration||"")))return!1;if(n.date&&n.date.length>0){if(!e.dueDate)return!1;const i=new Date(e.dueDate),s=new Date;if(s.setHours(0,0,0,0),!n.date.some(r=>{if(r==="today")return la(i,s);if(r==="tomorrow"){const a=new Date(s);return a.setDate(a.getDate()+1),la(i,a)}if(r==="week"){const a=new Date(s);a.setDate(s.getDate()-s.getDay());const l=new Date(a);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),i>=a&&i<=l}if(r==="next-week"){const a=new Date(s);a.setDate(s.getDate()-s.getDay()+7);const l=new Date(a);return l.setDate(l.getDate()+6),l.setHours(23,59,59,999),i>=a&&i<=l}return!1}))return!1}return!0}function eg(e){const t={};return e&&e.split(/\s+/).forEach(n=>{if(!n.includes(":"))return;const[i,s]=n.split(":");t[i]=s.split(",")}),t}function la(e,t){return e.getFullYear()===t.getFullYear()&&e.getMonth()===t.getMonth()&&e.getDate()===t.getDate()}function ng(){const e=document.getElementById("inbox-count");if(!e)return;const t=_n(),n=gs(t,i=>!i.projectId||i.projectId==="null"||i.projectId==="unassigned");e.textContent=n,e.classList.toggle("hidden",n===0)}function ig(){if(!document.getElementById(B.LIST_IDS.PROJECTS))return;const t=lr(),n=_n();Jf(t,n)}function sg(){const e=document.getElementById(B.LIST_IDS.TIMEBLOCKS);if(!e)return;e.innerHTML="";const t=document.createDocumentFragment(),n=ue().sort((a,l)=>(a.order||0)-(l.order||0)),i=_n(),s=kn();n.forEach(a=>{const l=gs(i,u=>{const h=u.timeBlockId==="null"?null:u.timeBlockId,f=a.id;return h===f}),c=`${a.start} - ${a.end}`,d=ai(c,"timeblock",a.id,{color:a.color},l,s);d.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:a.id}})),d.oncontextmenu=u=>{u.preventDefault(),Tc(a)},li(d,"timeblock",a.id),t.appendChild(d)});const o=gs(i,a=>!a.timeBlockId||a.timeBlockId==="null"||a.timeBlockId==="unassigned"),r=ai("未定","timeblock","unassigned",{color:"#a0aec0"},o,s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),li(r,"timeblock","unassigned"),t.appendChild(r),e.appendChild(t)}function og(){const e=document.getElementById(B.LIST_IDS.DURATIONS);if(!e)return;e.innerHTML="";const t=_n(),n=kn(),i=document.createDocumentFragment(),s='<span class="mr-3 text-sm">⏱️</span>';B.DURATIONS.forEach(o=>{const r=gs(t,l=>Number(l.duration)===o),a=ai(`${o} min`,"duration",o.toString(),{iconHtml:s},r,n);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:o.toString()}})),li(a,"duration",o.toString()),i.appendChild(a)}),e.appendChild(i)}function rg(){const e=document.getElementById(B.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const t=Ql(),n=_n(),i=kn(),s=document.createDocumentFragment(),o='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';t.forEach(r=>{let a=0;try{typeof Ts=="function"&&(a=Ts(n,{savedFilter:r,showCompleted:!1}).length)}catch(c){console.warn("[Sidebar] Filter count error:",c)}const l=ai(r.name,"filter",r.id,{iconHtml:o},a,i);l.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),l.oncontextmenu=c=>{c.preventDefault(),cr(c,"filter",r)},s.appendChild(l)}),e.appendChild(s)}function ag(){ig(),sg(),og(),rg(),ng()}function lg(e,t={}){const n=window.location.origin+window.location.pathname,i=new URLSearchParams(window.location.search);i.set("mode","window"),i.set("view",e),Object.entries(t).forEach(([d,u])=>{i.set(d,u)});const s=`${n}?${i.toString()}`,o=1200,r=800,a=(window.screen.width-o)/2,l=(window.screen.height-r)/2,c=`width=${o},height=${r},left=${a},top=${l},resizable=yes,scrollbars=yes`;window.open(s,`TaskMg_${e}_${Date.now()}`,c)}function cg(){return new URLSearchParams(window.location.search).get("mode")||"main"}function dg(){return new URLSearchParams(window.location.search).get("view")}function ug(){return cg()==="window"}let fn=null,Pi=null,Mt={};function ca(){Mt={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function hg(){if(ca(),!Mt.container)return;Mt.container.innerHTML=rf(),ca(),jl(Mt.sidebar,Mt.resizer),gg(),af(),lf(),fg(),Mt.inbox&&li(Mt.inbox,"inbox"),Kf(Mt.container),Pi&&window.removeEventListener("resize",Pi),Pi=()=>Po(),window.addEventListener("resize",Pi),Po();const e=kn();pr(e),pg(),fn&&fn()}function fg(){const e=["timeblocks-updated","projects-updated","labels-updated","filters-updated","tasks-updated"];fn&&e.forEach(t=>document.removeEventListener(t,fn)),fn=()=>{ag();const t=kn();pr(t)},e.forEach(t=>document.addEventListener(t,fn))}function gg(){var t,n;const e=(i,s=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:i,id:s}}));Mt.container.addEventListener("click",i=>{const s=i.target.closest("a"),o=i.target.closest("button");if(s){i.preventDefault();const r=s.id;r==="nav-dashboard"&&e("dashboard"),r==="nav-inbox"&&e("inbox"),r==="nav-search"&&e("search"),r==="nav-settings"&&Ns(),r==="nav-wizard"&&e("wizard"),r==="nav-target-dashboard"&&e("target-dashboard"),r==="nav-wiki"&&e("wiki");return}if(o){const r=o.id;r==="add-filter-btn"&&sc(),r==="edit-timeblocks-btn"&&Tc()}}),Mt.container.addEventListener("contextmenu",i=>{const s=i.target.closest("a");if(!s)return;const o=s.id,r={"nav-wizard":"wizard","nav-target-dashboard":"target-dashboard","nav-wiki":"wiki","nav-dashboard":"dashboard"};r[o]&&Oh(i,[{label:"新しいウィンドウで開く",action:()=>lg(r[o])}])}),(t=Mt.openBtn)==null||t.addEventListener("click",()=>da(!0)),(n=Mt.closeBtn)==null||n.addEventListener("click",()=>da(!1))}function pr(e){const t=document.querySelectorAll(".sidebar-item-row"),n=Object.values(B.DENSITY_CLASSES),i=B.DENSITY_CLASSES[e]||B.DENSITY_CLASSES.normal;t.forEach(s=>{s.classList.remove(...n),s.classList.add(i)})}function da(e){const{sidebar:t,resizer:n}=Mt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(t){if(t.classList.toggle(i,!e),t.classList.toggle(s,!e),er())if(n&&n.classList.toggle(s,!e),e){const o=localStorage.getItem(B.STORAGE_KEYS.WIDTH)||B.DEFAULT_WIDTH;t.style.width=`${o}px`}else t.style.width="0";Po()}}function Po(){const{sidebar:e,openBtn:t,closeBtn:n}=Mt,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(!e||!t||!n)return;const o=e.classList.contains(i)||e.classList.contains(s);er()?(t.classList.toggle(s,!o),n.classList.toggle(s,o),o||e.classList.remove(s)):(t.classList.remove(s),n.classList.remove(s),e.classList.remove(s))}function pg(){window.addEventListener("sidebar-settings-updated",e=>{pr(e.detail.density)})}const mg={FAVICON:"/images/favicon-96x96.png"},bg={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},Hn={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},mr={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view",WIZARD:"wizard-view",TARGET_DASHBOARD:"target-dashboard-view",WIKI:"wiki-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:ft,HEADER_IDS:ua,DATA_ATTRS:yg}=mr;function We(e,t){Array.isArray(t)&&t.forEach(n=>{var i,s;(i=n==null?void 0:n.classList)==null||i.add(ft.HIDDEN),(s=n==null?void 0:n.classList)==null||s.remove(ft.FADE_IN)}),e!=null&&e.classList&&(e.classList.remove(ft.HIDDEN),e.classList.add(ft.FADE_IN))}function Lc(){document.querySelectorAll(".sidebar-item-row").forEach(e=>{e.classList.remove(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]),e.classList.add(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]);const t=e.querySelector("svg, span:not(.truncate)");if(t){const n=Array.from(t.classList).filter(s=>s.startsWith("text-"));n.length>0&&t.classList.remove(...n);const i=e.getAttribute(yg.DEFAULT_COLOR);i&&t.classList.add(i)}})}function xg(e){Lc();const t=vg(e);if(t!=null&&t.classList){t.classList.remove(...Array.isArray(ft.NORMAL)?ft.NORMAL:[ft.NORMAL]),t.classList.add(...Array.isArray(ft.HIGHLIGHT)?ft.HIGHLIGHT:[ft.HIGHLIGHT]);const n=t.querySelector("svg, span:not(.truncate)");if(n){const i=Array.from(n.classList).filter(s=>s.startsWith("text-"));i.length>0&&n.classList.remove(...i),n.classList.add("text-white")}}}function vg(e){if(!e)return null;const{type:t,id:n}=e;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?Hn.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${n}"]`)}function Ac(e,t=[],n=[]){var c;const i=document.getElementById(ua.TITLE),s=document.getElementById(ua.COUNT);if(!i)return;let o="インボックス";const{type:r,id:a,name:l}=e;if(l)o=l;else switch(r){case Hn.PROJECT:o=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case Hn.LABEL:const d=n.find(u=>u.id===a);o=d?`ラベル: ${d.name}`:"ラベル";break;case Hn.TIMEBLOCK:if(a==="unassigned")o="時間帯: 未定";else{const u=nc(a);o=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case Hn.DURATION:o=`所要時間: ${a}分`;break;case"search":o="タスク検索";break;case"dashboard":o="ダッシュボード";break}i.textContent=o,s&&["dashboard","search"].includes(r)&&(s.textContent="")}function wg(){const{VIEW_IDS:e}=mr;Object.values(e).forEach(n=>{const i=document.getElementById(n);n!==e.TASK&&i&&i.classList.add(ft.HIDDEN)});const t=document.getElementById(e.TASK);t&&(t.classList.remove(ft.HIDDEN),t.innerHTML=`
        <div id="login-container-wrapper" class="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in">
            <div id="login-form-container" class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
                    <p class="text-gray-500 dark:text-gray-400">タスク管理をはじめよう</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">メールアドレス</label>
                        <input id="email-input" type="email" placeholder="name@example.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">パスワード</label>
                        <input id="password-input" type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                </div>
                
                <button id="email-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-0.5 mb-6">
                    ログイン
                </button>

                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">または</span>
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600 text-center">
                     <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">アカウント登録なしで試す</p>
                    <button id="guest-login-btn" class="w-full bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center gap-2">
                        <span>🚀</span> ゲストとして利用する
                    </button>
                    <p class="text-xs text-gray-400 mt-2">※ゲストデータはローカルに保存されます</p>
                </div>
            </div>
            
            <!-- ユーザー情報表示用（ロジック互換性のため残す、実際はヘッダー等で管理推奨） -->
            <div id="user-info" class="hidden">
                 <span id="user-email-display"></span>
            </div>
        </div>
    `)}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function _i(e){return e+.5|0}const ke=(e,t,n)=>Math.max(Math.min(e,n),t);function zn(e){return ke(_i(e*2.55),0,255)}function Me(e){return ke(_i(e*255),0,255)}function ie(e){return ke(_i(e/2.55)/100,0,1)}function ha(e){return ke(_i(e*100),0,100)}const Pt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Ro=[..."0123456789ABCDEF"],kg=e=>Ro[e&15],_g=e=>Ro[(e&240)>>4]+Ro[e&15],Ri=e=>(e&240)>>4===(e&15),Sg=e=>Ri(e.r)&&Ri(e.g)&&Ri(e.b)&&Ri(e.a);function Eg(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Pt[e[1]]*17,g:255&Pt[e[2]]*17,b:255&Pt[e[3]]*17,a:t===5?Pt[e[4]]*17:255}:(t===7||t===9)&&(n={r:Pt[e[1]]<<4|Pt[e[2]],g:Pt[e[3]]<<4|Pt[e[4]],b:Pt[e[5]]<<4|Pt[e[6]],a:t===9?Pt[e[7]]<<4|Pt[e[8]]:255})),n}const Dg=(e,t)=>e<255?t(e):"";function Mg(e){var t=Sg(e)?kg:_g;return e?"#"+t(e.r)+t(e.g)+t(e.b)+Dg(e.a,t):void 0}const Tg=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Cc(e,t,n){const i=t*Math.min(n,1-n),s=(o,r=(o+e/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[s(0),s(8),s(4)]}function Ig(e,t,n){const i=(s,o=(s+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function Lg(e,t,n){const i=Cc(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function Ag(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}function br(e){const n=e.r/255,i=e.g/255,s=e.b/255,o=Math.max(n,i,s),r=Math.min(n,i,s),a=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=a>.5?d/(2-o-r):d/(o+r),l=Ag(n,i,s,d,o),l=l*60+.5),[l|0,c||0,a]}function yr(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Me)}function xr(e,t,n){return yr(Cc,e,t,n)}function Cg(e,t,n){return yr(Lg,e,t,n)}function Og(e,t,n){return yr(Ig,e,t,n)}function Oc(e){return(e%360+360)%360}function Pg(e){const t=Tg.exec(e);let n=255,i;if(!t)return;t[5]!==i&&(n=t[6]?zn(+t[5]):Me(+t[5]));const s=Oc(+t[2]),o=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=Cg(s,o,r):t[1]==="hsv"?i=Og(s,o,r):i=xr(s,o,r),{r:i[0],g:i[1],b:i[2],a:n}}function Rg(e,t){var n=br(e);n[0]=Oc(n[0]+t),n=xr(n),e.r=n[0],e.g=n[1],e.b=n[2]}function Bg(e){if(!e)return;const t=br(e),n=t[0],i=ha(t[1]),s=ha(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${s}%, ${ie(e.a)})`:`hsl(${n}, ${i}%, ${s}%)`}const fa={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},ga={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Fg(){const e={},t=Object.keys(ga),n=Object.keys(fa);let i,s,o,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],s=0;s<n.length;s++)o=n[s],a=a.replace(o,fa[o]);o=parseInt(ga[r],16),e[a]=[o>>16&255,o>>8&255,o&255]}return e}let Bi;function Ng(e){Bi||(Bi=Fg(),Bi.transparent=[0,0,0,0]);const t=Bi[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const $g=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Hg(e){const t=$g.exec(e);let n=255,i,s,o;if(t){if(t[7]!==i){const r=+t[7];n=t[8]?zn(r):ke(r*255,0,255)}return i=+t[1],s=+t[3],o=+t[5],i=255&(t[2]?zn(i):ke(i,0,255)),s=255&(t[4]?zn(s):ke(s,0,255)),o=255&(t[6]?zn(o):ke(o,0,255)),{r:i,g:s,b:o,a:n}}}function zg(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${ie(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const lo=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,rn=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function jg(e,t,n){const i=rn(ie(e.r)),s=rn(ie(e.g)),o=rn(ie(e.b));return{r:Me(lo(i+n*(rn(ie(t.r))-i))),g:Me(lo(s+n*(rn(ie(t.g))-s))),b:Me(lo(o+n*(rn(ie(t.b))-o))),a:e.a+n*(t.a-e.a)}}function Fi(e,t,n){if(e){let i=br(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,t===0?360:1)),i=xr(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function Pc(e,t){return e&&Object.assign(t||{},e)}function pa(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Me(e[3]))):(t=Pc(e,{r:0,g:0,b:0,a:1}),t.a=Me(t.a)),t}function Wg(e){return e.charAt(0)==="r"?Hg(e):Pg(e)}class ci{constructor(t){if(t instanceof ci)return t;const n=typeof t;let i;n==="object"?i=pa(t):n==="string"&&(i=Eg(t)||Ng(t)||Wg(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=Pc(this._rgb);return t&&(t.a=ie(t.a)),t}set rgb(t){this._rgb=pa(t)}rgbString(){return this._valid?zg(this._rgb):void 0}hexString(){return this._valid?Mg(this._rgb):void 0}hslString(){return this._valid?Bg(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,s=t.rgb;let o;const r=n===o?.5:n,a=2*r-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-c,i.r=255&c*i.r+o*s.r+.5,i.g=255&c*i.g+o*s.g+.5,i.b=255&c*i.b+o*s.b+.5,i.a=r*i.a+(1-r)*s.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=jg(this._rgb,t._rgb,n)),this}clone(){return new ci(this.rgb)}alpha(t){return this._rgb.a=Me(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=_i(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Fi(this._rgb,2,t),this}darken(t){return Fi(this._rgb,2,-t),this}saturate(t){return Fi(this._rgb,1,t),this}desaturate(t){return Fi(this._rgb,1,-t),this}rotate(t){return Rg(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Qt(){}const Vg=(()=>{let e=0;return()=>e++})();function F(e){return e==null}function it(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function $(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function at(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function Ct(e,t){return at(e)?e:t}function P(e,t){return typeof e>"u"?t:e}const Ug=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,Rc=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Z(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function X(e,t,n,i){let s,o,r;if(it(e))for(o=e.length,s=0;s<o;s++)t.call(n,e[s],s);else if($(e))for(r=Object.keys(e),o=r.length,s=0;s<o;s++)t.call(n,e[r[s]],r[s])}function Is(e,t){let n,i,s,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],o=t[n],s.datasetIndex!==o.datasetIndex||s.index!==o.index)return!1;return!0}function Ls(e){if(it(e))return e.map(Ls);if($(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=Ls(e[n[s]]);return t}return e}function Bc(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function Yg(e,t,n,i){if(!Bc(e))return;const s=t[e],o=n[e];$(s)&&$(o)?di(s,o,i):t[e]=Ls(o)}function di(e,t,n){const i=it(t)?t:[t],s=i.length;if(!$(e))return e;n=n||{};const o=n.merger||Yg;let r;for(let a=0;a<s;++a){if(r=i[a],!$(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],e,r,n)}return e}function ni(e,t){return di(e,t,{merger:qg})}function qg(e,t,n){if(!Bc(e))return;const i=t[e],s=n[e];$(i)&&$(s)?ni(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Ls(s))}const ma={"":e=>e,x:e=>e.x,y:e=>e.y};function Gg(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}function Xg(e){const t=Gg(e);return n=>{for(const i of t){if(i==="")break;n=n&&n[i]}return n}}function Te(e,t){return(ma[t]||(ma[t]=Xg(t)))(e)}function vr(e){return e.charAt(0).toUpperCase()+e.slice(1)}const ui=e=>typeof e<"u",Ie=e=>typeof e=="function",ba=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function Kg(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const V=Math.PI,tt=2*V,Jg=tt+V,As=Number.POSITIVE_INFINITY,Zg=V/180,lt=V/2,Ne=V/4,ya=V*2/3,_e=Math.log10,Kt=Math.sign;function ii(e,t,n){return Math.abs(e-t)<n}function xa(e){const t=Math.round(e);e=ii(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(_e(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function Qg(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(n|0)&&t.push(n),t.sort((s,o)=>s-o).pop(),t}function tp(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function yn(e){return!tp(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function ep(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function Fc(e,t,n){let i,s,o;for(i=0,s=e.length;i<s;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function Wt(e){return e*(V/180)}function wr(e){return e*(180/V)}function va(e){if(!at(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function Nc(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*V&&(o+=tt),{angle:o,distance:s}}function Bo(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function np(e,t){return(e-t+Jg)%tt-V}function vt(e){return(e%tt+tt)%tt}function hi(e,t,n,i){const s=vt(e),o=vt(t),r=vt(n),a=vt(o-s),l=vt(r-s),c=vt(s-o),d=vt(s-r);return s===o||s===r||i&&o===r||a>l&&c<d}function pt(e,t,n){return Math.max(t,Math.min(n,e))}function ip(e){return pt(e,-32768,32767)}function oe(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function kr(e,t,n){n=n||(r=>e[r]<t);let i=e.length-1,s=0,o;for(;i-s>1;)o=s+i>>1,n(o)?s=o:i=o;return{lo:s,hi:i}}const re=(e,t,n,i)=>kr(e,n,i?s=>{const o=e[s][t];return o<n||o===n&&e[s+1][t]===n}:s=>e[s][t]<n),sp=(e,t,n)=>kr(e,n,i=>e[i][t]>=n);function op(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}const $c=["push","pop","shift","splice","unshift"];function rp(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),$c.forEach(n=>{const i="_onData"+vr(n),s=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const r=s.apply(this,o);return e._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...o)}),r}})})}function wa(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&($c.forEach(o=>{delete e[o]}),delete e._chartjs)}function Hc(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const zc=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function jc(e,t){let n=[],i=!1;return function(...s){n=s,i||(i=!0,zc.call(window,()=>{i=!1,e.apply(t,n)}))}}function ap(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}const _r=e=>e==="start"?"left":e==="end"?"right":"center",xt=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,lp=(e,t,n,i)=>e===(i?"left":"right")?n:e==="center"?(t+n)/2:t;function Wc(e,t,n){const i=t.length;let s=0,o=i;if(e._sorted){const{iScale:r,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=r.axis,{min:u,max:h,minDefined:f,maxDefined:g}=r.getUserBounds();if(f){if(s=Math.min(re(l,d,u).lo,n?i:re(t,d,r.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!F(m[a.axis]));s-=Math.max(0,p)}s=pt(s,0,i-1)}if(g){let p=Math.max(re(l,r.axis,h,!0).hi+1,n?0:re(t,d,r.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!F(b[a.axis]));p+=Math.max(0,m)}o=pt(p,s,i)-s}else o=i-s}return{start:s,count:o}}function Vc(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),o}const Ni=e=>e===0||e===1,ka=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*tt/n)),_a=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*tt/n)+1,si={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*lt)+1,easeOutSine:e=>Math.sin(e*lt),easeInOutSine:e=>-.5*(Math.cos(V*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>Ni(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Ni(e)?e:ka(e,.075,.3),easeOutElastic:e=>Ni(e)?e:_a(e,.075,.3),easeInOutElastic(e){return Ni(e)?e:e<.5?.5*ka(e*2,.1125,.45):.5+.5*_a(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-si.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?si.easeInBounce(e*2)*.5:si.easeOutBounce(e*2-1)*.5+.5};function Sr(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Sa(e){return Sr(e)?e:new ci(e)}function co(e){return Sr(e)?e:new ci(e).saturate(.5).darken(.1).hexString()}const cp=["x","y","borderWidth","radius","tension"],dp=["color","borderColor","backgroundColor"];function up(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:dp},numbers:{type:"number",properties:cp}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function hp(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Ea=new Map;function fp(e,t){t=t||{};const n=e+JSON.stringify(t);let i=Ea.get(n);return i||(i=new Intl.NumberFormat(e,t),Ea.set(n,i)),i}function Si(e,t,n){return fp(t,n).format(e)}const Uc={values(e){return it(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const i=this.chart.options.locale;let s,o=e;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),o=gp(e,n)}const r=_e(Math.abs(o)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Si(e,i,l)},logarithmic(e,t,n){if(e===0)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(_e(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?Uc.numeric.call(this,e,t,n):""}};function gp(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var Hs={formatters:Uc};function pp(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Hs.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Je=Object.create(null),Fo=Object.create(null);function oi(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const o=n[i];e=e[o]||(e[o]=Object.create(null))}return e}function uo(e,t,n){return typeof t=="string"?di(oi(e,t),n):di(oi(e,""),t)}class mp{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>co(s.backgroundColor),this.hoverBorderColor=(i,s)=>co(s.borderColor),this.hoverColor=(i,s)=>co(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return uo(this,t,n)}get(t){return oi(this,t)}describe(t,n){return uo(Fo,t,n)}override(t,n){return uo(Je,t,n)}route(t,n,i,s){const o=oi(this,t),r=oi(this,i),a="_"+n;Object.defineProperties(o,{[a]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=r[s];return $(l)?Object.assign({},c,l):P(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(n=>n(this))}}var st=new mp({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[up,hp,pp]);function bp(e){return!e||F(e.size)||F(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function Cs(e,t,n,i,s){let o=t[s];return o||(o=t[s]=e.measureText(s).width,n.push(s)),o>i&&(i=o),i}function yp(e,t,n,i){i=i||{};let s=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},o=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let r=0;const a=n.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=n[l],u!=null&&!it(u))r=Cs(e,s,o,r,u);else if(it(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!it(h)&&(r=Cs(e,s,o,r,h));e.restore();const f=o.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[o[l]];o.splice(0,f)}return r}function $e(e,t,n){const i=e.currentDevicePixelRatio,s=n!==0?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function Da(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function No(e,t,n,i){Yc(e,t,n,i,null)}function Yc(e,t,n,i,s){let o,r,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Zg;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,i),e.rotate(m),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!(isNaN(p)||p<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,p,0,0,tt):e.arc(n,i,p,0,tt),e.closePath();break;case"triangle":d=s?s/2:p,e.moveTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=ya,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=ya,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),e.closePath();break;case"rectRounded":c=p*.516,l=p-c,r=Math.cos(m+Ne)*l,u=Math.cos(m+Ne)*(s?s/2-c:l),a=Math.sin(m+Ne)*l,h=Math.sin(m+Ne)*(s?s/2-c:l),e.arc(n-u,i-a,c,m-V,m-lt),e.arc(n+h,i-r,c,m-lt,m),e.arc(n+u,i+a,c,m,m+lt),e.arc(n-h,i+r,c,m+lt,m+V),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,e.rect(n-d,i-l,2*d,2*l);break}m+=Ne;case"rectRot":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+h,i-r),e.lineTo(n+u,i+a),e.lineTo(n-h,i+r),e.closePath();break;case"crossRot":m+=Ne;case"cross":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"star":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r),m+=Ne,u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"line":r=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,e.moveTo(n-r,i-a),e.lineTo(n+r,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function ae(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function zs(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function js(e){e.restore()}function xp(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if(s==="middle"){const o=(t.x+n.x)/2;e.lineTo(o,t.y),e.lineTo(o,n.y)}else s==="after"!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function vp(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function wp(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),F(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function kp(e,t,n,i,s){if(s.strikethrough||s.underline){const o=e.measureText(i),r=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(r,d),e.lineTo(a,d),e.stroke()}}function _p(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function Ze(e,t,n,i,s,o={}){const r=it(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(e.save(),e.font=s.string,wp(e,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&_p(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),F(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),kp(e,n,i,c,o),i+=Number(s.lineHeight);e.restore()}function fi(e,t){const{x:n,y:i,w:s,h:o,radius:r}=t;e.arc(n+r.topLeft,i+r.topLeft,r.topLeft,1.5*V,V,!0),e.lineTo(n,i+o-r.bottomLeft),e.arc(n+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,V,lt,!0),e.lineTo(n+s-r.bottomRight,i+o),e.arc(n+s-r.bottomRight,i+o-r.bottomRight,r.bottomRight,lt,0,!0),e.lineTo(n+s,i+r.topRight),e.arc(n+s-r.topRight,i+r.topRight,r.topRight,0,-lt,!0),e.lineTo(n+r.topLeft,i)}const Sp=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,Ep=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function Dp(e,t){const n=(""+e).match(Sp);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const Mp=e=>+e||0;function Er(e,t){const n={},i=$(t),s=i?Object.keys(t):t,o=$(e)?i?r=>P(e[r],e[t[r]]):r=>e[r]:()=>e;for(const r of s)n[r]=Mp(o(r));return n}function qc(e){return Er(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Ge(e){return Er(e,["topLeft","topRight","bottomLeft","bottomRight"])}function kt(e){const t=qc(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function ut(e,t){e=e||{},t=t||st.font;let n=P(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let i=P(e.style,t.style);i&&!(""+i).match(Ep)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:P(e.family,t.family),lineHeight:Dp(P(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:P(e.weight,t.weight),string:""};return s.string=bp(s),s}function jn(e,t,n,i){let s,o,r;for(s=0,o=e.length;s<o;++s)if(r=e[s],r!==void 0&&r!==void 0)return r}function Tp(e,t,n){const{min:i,max:s}=e,o=Rc(t,(s-i)/2),r=(a,l)=>n&&a===0?0:a+l;return{min:r(i,-Math.abs(o)),max:r(s,o)}}function Le(e,t){return Object.assign(Object.create(e),t)}function Dr(e,t=[""],n,i,s=()=>e[0]){const o=n||e;typeof i>"u"&&(i=Jc("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:i,_getTarget:s,override:a=>Dr([a,...e],t,o,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete a._keys,delete e[0][l],!0},get(a,l){return Xc(a,l,()=>Bp(l,t,e,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(a,l){return Ta(a).includes(l)},ownKeys(a){return Ta(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function xn(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:Gc(e,i),setContext:o=>xn(e,o,n,i),override:o=>xn(e.override(o),t,n,i)};return new Proxy(s,{deleteProperty(o,r){return delete o[r],delete e[r],!0},get(o,r,a){return Xc(o,r,()=>Lp(o,r,a))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(e,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,r)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,r){return Reflect.has(e,r)},ownKeys(){return Reflect.ownKeys(e)},set(o,r,a){return e[r]=a,delete o[r],!0}})}function Gc(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:Ie(n)?n:()=>n,isIndexable:Ie(i)?i:()=>i}}const Ip=(e,t)=>e?e+vr(t):t,Mr=(e,t)=>$(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Xc(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const i=n();return e[t]=i,i}function Lp(e,t,n){const{_proxy:i,_context:s,_subProxy:o,_descriptors:r}=e;let a=i[t];return Ie(a)&&r.isScriptable(t)&&(a=Ap(t,a,e,n)),it(a)&&a.length&&(a=Cp(t,a,e,r.isIndexable)),Mr(t,a)&&(a=xn(a,s,o&&o[t],r)),a}function Ap(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,r||i);return a.delete(e),Mr(e,l)&&(l=Tr(s._scopes,s,e,l)),l}function Cp(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_descriptors:a}=n;if(typeof o.index<"u"&&i(e))return t[o.index%t.length];if($(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=Tr(c,s,e,d);t.push(xn(u,o,r&&r[e],a))}}return t}function Kc(e,t,n){return Ie(e)?e(t,n):e}const Op=(e,t)=>e===!0?t:typeof e=="string"?Te(t,e):void 0;function Pp(e,t,n,i,s){for(const o of t){const r=Op(n,o);if(r){e.add(r);const a=Kc(r._fallback,n,s);if(typeof a<"u"&&a!==n&&a!==i)return a}else if(r===!1&&typeof i<"u"&&n!==i)return null}return!1}function Tr(e,t,n,i){const s=t._rootScopes,o=Kc(t._fallback,n,i),r=[...e,...s],a=new Set;a.add(i);let l=Ma(a,r,n,o||n,i);return l===null||typeof o<"u"&&o!==n&&(l=Ma(a,r,o,l,i),l===null)?!1:Dr(Array.from(a),[""],s,o,()=>Rp(t,n,i))}function Ma(e,t,n,i,s){for(;n;)n=Pp(e,t,n,i,s);return n}function Rp(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];return it(s)&&$(n)?n:s||{}}function Bp(e,t,n,i){let s;for(const o of t)if(s=Jc(Ip(o,e),n),typeof s<"u")return Mr(e,s)?Tr(n,i,e,s):s}function Jc(e,t){for(const n of t){if(!n)continue;const i=n[e];if(typeof i<"u")return i}}function Ta(e){let t=e._keys;return t||(t=e._keys=Fp(e._scopes)),t}function Fp(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function Zc(e,t,n,i){const{iScale:s}=e,{key:o="r"}=this._parsing,r=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+n,d=t[c],r[a]={r:s.parse(Te(d,o),c)};return r}const Np=Number.EPSILON||1e-14,vn=(e,t)=>t<e.length&&!e[t].skip&&e[t],Qc=e=>e==="x"?"y":"x";function $p(e,t,n,i){const s=e.skip?t:e,o=t,r=n.skip?t:n,a=Bo(o,s),l=Bo(r,o);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:o.x-u*(r.x-s.x),y:o.y-u*(r.y-s.y)},next:{x:o.x+h*(r.x-s.x),y:o.y+h*(r.y-s.y)}}}function Hp(e,t,n){const i=e.length;let s,o,r,a,l,c=vn(e,0);for(let d=0;d<i-1;++d)if(l=c,c=vn(e,d+1),!(!l||!c)){if(ii(t[d],0,Np)){n[d]=n[d+1]=0;continue}s=n[d]/t[d],o=n[d+1]/t[d],a=Math.pow(s,2)+Math.pow(o,2),!(a<=9)&&(r=3/Math.sqrt(a),n[d]=s*r*t[d],n[d+1]=o*r*t[d])}}function zp(e,t,n="x"){const i=Qc(n),s=e.length;let o,r,a,l=vn(e,0);for(let c=0;c<s;++c){if(r=a,a=l,l=vn(e,c+1),!a)continue;const d=a[n],u=a[i];r&&(o=(d-r[n])/3,a[`cp1${n}`]=d-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-d)/3,a[`cp2${n}`]=d+o,a[`cp2${i}`]=u+o*t[c])}}function jp(e,t="x"){const n=Qc(t),i=e.length,s=Array(i).fill(0),o=Array(i);let r,a,l,c=vn(e,0);for(r=0;r<i;++r)if(a=l,l=c,c=vn(e,r+1),!!l){if(c){const d=c[t]-l[t];s[r]=d!==0?(c[n]-l[n])/d:0}o[r]=a?c?Kt(s[r-1])!==Kt(s[r])?0:(s[r-1]+s[r])/2:s[r-1]:s[r]}Hp(e,s,o),zp(e,o,t)}function $i(e,t,n){return Math.max(Math.min(e,n),t)}function Wp(e,t){let n,i,s,o,r,a=ae(e[0],t);for(n=0,i=e.length;n<i;++n)r=o,o=a,a=n<i-1&&ae(e[n+1],t),o&&(s=e[n],r&&(s.cp1x=$i(s.cp1x,t.left,t.right),s.cp1y=$i(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=$i(s.cp2x,t.left,t.right),s.cp2y=$i(s.cp2y,t.top,t.bottom)))}function Vp(e,t,n,i,s){let o,r,a,l;if(t.spanGaps&&(e=e.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")jp(e,s);else{let c=i?e[e.length-1]:e[0];for(o=0,r=e.length;o<r;++o)a=e[o],l=$p(c,a,e[Math.min(o+1,r-(i?0:1))%r],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&Wp(e,n)}function Ir(){return typeof window<"u"&&typeof document<"u"}function Lr(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Os(e,t,n){let i;return typeof e=="string"?(i=parseInt(e,10),e.indexOf("%")!==-1&&(i=i/100*t.parentNode[n])):i=e,i}const Ws=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function Up(e,t){return Ws(e).getPropertyValue(t)}const Yp=["top","right","bottom","left"];function Xe(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const o=Yp[s];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const qp=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function Gp(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:o}=i;let r=!1,a,l;if(qp(s,o,e.target))a=s,l=o;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:a,y:l,box:r}}function Ve(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=Ws(n),o=s.boxSizing==="border-box",r=Xe(s,"padding"),a=Xe(s,"border","width"),{x:l,y:c,box:d}=Gp(e,n),u=r.left+(d&&a.left),h=r.top+(d&&a.top);let{width:f,height:g}=t;return o&&(f-=r.width+a.width,g-=r.height+a.height),{x:Math.round((l-u)/f*n.width/i),y:Math.round((c-h)/g*n.height/i)}}function Xp(e,t,n){let i,s;if(t===void 0||n===void 0){const o=e&&Lr(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const r=o.getBoundingClientRect(),a=Ws(o),l=Xe(a,"border","width"),c=Xe(a,"padding");t=r.width-c.width-l.width,n=r.height-c.height-l.height,i=Os(a.maxWidth,o,"clientWidth"),s=Os(a.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:i||As,maxHeight:s||As}}const Se=e=>Math.round(e*10)/10;function Kp(e,t,n,i){const s=Ws(e),o=Xe(s,"margin"),r=Os(s.maxWidth,e,"clientWidth")||As,a=Os(s.maxHeight,e,"clientHeight")||As,l=Xp(e,t,n);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=Xe(s,"border","width"),f=Xe(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=Se(Math.min(c,r,l.maxWidth)),d=Se(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Se(c/2)),(t!==void 0||n!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Se(Math.floor(d*i))),{width:c,height:d}}function Ia(e,t,n){const i=t||1,s=Se(e.height*i),o=Se(e.width*i);e.height=Se(e.height),e.width=Se(e.width);const r=e.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${e.height}px`,r.style.width=`${e.width}px`),e.currentDevicePixelRatio!==i||r.height!==s||r.width!==o?(e.currentDevicePixelRatio=i,r.height=s,r.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0):!1}const Jp=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};Ir()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function La(e,t){const n=Up(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ue(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function Zp(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:i==="middle"?n<.5?e.y:t.y:i==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function Qp(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},r=Ue(e,s,n),a=Ue(s,o,n),l=Ue(o,t,n),c=Ue(r,a,n),d=Ue(a,l,n);return Ue(c,d,n)}const tm=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,i){return n-i},leftForLtr(n,i){return n-i}}},em=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function mn(e,t,n){return e?tm(t,n):em()}function td(e,t){let n,i;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function ed(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function nd(e){return e==="angle"?{between:hi,compare:np,normalize:vt}:{between:oe,compare:(t,n)=>t-n,normalize:t=>t}}function Aa({start:e,end:t,count:n,loop:i,style:s}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n===0,style:s}}function nm(e,t,n){const{property:i,start:s,end:o}=n,{between:r,normalize:a}=nd(i),l=t.length;let{start:c,end:d,loop:u}=e,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(a(t[c%l][i]),s,o);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:e.style}}function id(e,t,n){if(!n)return[e];const{property:i,start:s,end:o}=n,r=t.length,{compare:a,between:l,normalize:c}=nd(i),{start:d,end:u,loop:h,style:f}=nm(e,t,n),g=[];let p=!1,m=null,b,y,v;const w=()=>l(s,v,b)&&a(s,v)!==0,x=()=>a(o,b)===0||l(o,v,b),_=()=>p||w(),k=()=>!p||x();for(let S=d,T=d;S<=u;++S)y=t[S%r],!y.skip&&(b=c(y[i]),b!==v&&(p=l(b,s,o),m===null&&_()&&(m=a(b,s)===0?S:T),m!==null&&k()&&(g.push(Aa({start:m,end:S,loop:h,count:r,style:f})),m=null),T=S,v=b));return m!==null&&g.push(Aa({start:m,end:u,loop:h,count:r,style:f})),g}function sd(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const o=id(i[s],e.points,t);o.length&&n.push(...o)}return n}function im(e,t,n,i){let s=0,o=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(o+=s);o>s&&e[o%t].skip;)o--;return o%=t,{start:s,end:o}}function sm(e,t,n,i){const s=e.length,o=[];let r=t,a=e[t],l;for(l=t+1;l<=n;++l){const c=e[l%s];c.skip||c.stop?a.skip||(i=!1,o.push({start:t%s,end:(l-1)%s,loop:i}),t=r=c.stop?l:null):(r=l,a.skip&&(t=l)),a=c}return r!==null&&o.push({start:t%s,end:r%s,loop:i}),o}function om(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const o=!!e._loop,{start:r,end:a}=im(n,s,o,i);if(i===!0)return Ca(e,[{start:r,end:a,loop:o}],n,t);const l=a<r?a+s:a,c=!!e._fullLoop&&r===0&&a===s-1;return Ca(e,sm(n,r,l,c),n,t)}function Ca(e,t,n,i){return!i||!i.setContext||!n?t:rm(e,t,n,i)}function rm(e,t,n,i){const s=e._chart.getContext(),o=Oa(e.options),{_datasetIndex:r,options:{spanGaps:a}}=e,l=n.length,c=[];let d=o,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;n[g%l].skip;)g-=y;for(;n[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=n[u%l],m;for(h=u+1;h<=g.end;h++){const b=n[h%l];m=Oa(i.setContext(Le(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),am(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Oa(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function am(e,t){if(!t)return!1;const n=[],i=function(s,o){return Sr(o)?(n.includes(o)||n.push(o),n.indexOf(o)):o};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function Hi(e,t,n){return e.options.clip?e[n]:t[n]}function lm(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:Hi(n,t,"left"),right:Hi(n,t,"right"),top:Hi(i,t,"top"),bottom:Hi(i,t,"bottom")}:t}function od(e,t){const n=t._clip;if(n.disabled)return!1;const i=lm(t,e.chartArea);return{left:n.left===!1?0:i.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:i.right+(n.right===!0?0:n.right),top:n.top===!1?0:i.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:i.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class cm{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,s){const o=n.listeners[s],r=n.duration;o.forEach(a=>a({chart:t,initial:n.initial,numSteps:r,currentStep:Math.min(i-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=zc.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,a=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(o[r]=o[o.length-1],o.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),o.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var te=new cm;const Pa="transparent",dm={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const i=Sa(e||Pa),s=i.valid&&Sa(t||Pa);return s&&s.valid?s.mix(i,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class um{constructor(t,n,i,s){const o=n[i];s=jn([t.to,s,o,t.from]);const r=jn([t.from,o,s]);this._active=!0,this._fn=t.fn||dm[t.type||typeof r],this._easing=si[t.easing]||si.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=r,this._to=s,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const s=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=jn([t.to,n,s,t.from]),this._from=jn([t.from,s,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,s=this._prop,o=this._from,r=this._loop,a=this._to;let l;if(this._active=o!==a&&(r||n<i),!this._active){this._target[s]=a,this._notify(!0);return}if(n<0){this._target[s]=o;return}l=n/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(o,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][n]()}}class rd{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!$(t))return;const n=Object.keys(st.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const o=t[s];if(!$(o))return;const r={};for(const a of n)r[a]=o[a];(it(o.properties)&&o.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,n){const i=n.options,s=fm(t,i);if(!s)return[];const o=this._createAnimations(s,i);return i.$shared&&hm(t.options.$animations,i).then(()=>{t.options=i},()=>{}),o}_createAnimations(t,n){const i=this._properties,s=[],o=t.$animations||(t.$animations={}),r=Object.keys(n),a=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,n));continue}const d=n[c];let u=o[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}o[c]=u=new um(h,t,c,d),s.push(u)}return s}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const i=this._createAnimations(t,n);if(i.length)return te.add(this._chart,i),!0}}function hm(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const o=e[i[s]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function fm(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Ra(e,t){const n=e&&e.options||{},i=n.reverse,s=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:i?o:s,end:i?s:o}}function gm(e,t,n){if(n===!1)return!1;const i=Ra(e,n),s=Ra(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function pm(e){let t,n,i,s;return $(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:e===!1}}function ad(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,o;for(s=0,o=i.length;s<o;++s)n.push(i[s].index);return n}function Ba(e,t,n,i={}){const s=e.keys,o=i.mode==="single";let r,a,l,c;if(t===null)return;let d=!1;for(r=0,a=s.length;r<a;++r){if(l=+s[r],l===n){if(d=!0,i.all)continue;break}c=e.values[l],at(c)&&(o||t===0||Kt(t)===Kt(c))&&(t+=c)}return!d&&!i.all?0:t}function mm(e,t){const{iScale:n,vScale:i}=t,s=n.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(e),a=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],a[l]={[s]:d,[o]:e[d]};return a}function ho(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function bm(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function ym(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}function xm(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function Fa(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const o=e[s.index];if(n&&o>0||!n&&o<0)return s.index}return null}function Na(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:o,vScale:r,index:a}=i,l=o.axis,c=r.axis,d=bm(o,r,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=xm(s,d,p),h[a]=m,h._top=Fa(h,r,!0,i.type),h._bottom=Fa(h,r,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function fo(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function vm(e,t){return Le(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function wm(e,t,n){return Le(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function In(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const s of t){const o=s._stacks;if(!o||o[i]===void 0||o[i][n]===void 0)return;delete o[i][n],o[i]._visualValues!==void 0&&o[i]._visualValues[n]!==void 0&&delete o[i]._visualValues[n]}}}const go=e=>e==="reset"||e==="none",$a=(e,t)=>t?e:Object.assign({},e),km=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:ad(n,!0),values:null};class Vt{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=ho(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&In(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,o=n.xAxisID=P(i.xAxisID,fo(t,"x")),r=n.yAxisID=P(i.yAxisID,fo(t,"y")),a=n.rAxisID=P(i.rAxisID,fo(t,"r")),l=n.indexAxis,c=n.iAxisID=s(l,o,r,a),d=n.vAxisID=s(l,r,o,a);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&wa(this._data,this),t._stacked&&In(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if($(n)){const s=this._cachedMeta;this._data=mm(n,s)}else if(i!==n){if(i){wa(i,this);const s=this._cachedMeta;In(s),s._parsed=[]}n&&Object.isExtensible(n)&&rp(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const o=n._stacked;n._stacked=ho(n.vScale,n),n.stack!==i.stack&&(s=!0,In(n),n.stack=i.stack),this._resyncElements(t),(s||o!==n._stacked)&&(Na(this,n._parsed),n._stacked=ho(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:i,_data:s}=this,{iScale:o,_stacked:r}=i,a=o.axis;let l=t===0&&n===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{it(s[t])?h=this.parseArrayData(i,s,t,n):$(s[t])?h=this.parseObjectData(i,s,t,n):h=this.parsePrimitiveData(i,s,t,n);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<n;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}r&&Na(this,h)}parsePrimitiveData(t,n,i,s){const{iScale:o,vScale:r}=t,a=o.axis,l=r.axis,c=o.getLabels(),d=o===r,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||o.parse(c[g],g),[l]:r.parse(n[g],g)};return u}parseArrayData(t,n,i,s){const{xScale:o,yScale:r}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=n[d],a[l]={x:o.parse(u[0],d),y:r.parse(u[1],d)};return a}parseObjectData(t,n,i,s){const{xScale:o,yScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=n[h],c[d]={x:o.parse(Te(f,a),h),y:r.parse(Te(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){const s=this.chart,o=this._cachedMeta,r=n[t.axis],a={keys:ad(s,!0),values:n._stacks[t.axis]._visualValues};return Ba(a,r,o.index,{mode:i})}updateRangeFromParsed(t,n,i,s){const o=i[n.axis];let r=o===null?NaN:o;const a=s&&i._stacks[n.axis];s&&a&&(s.values=a,r=Ba(s,o,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,n){const i=this._cachedMeta,s=i._parsed,o=i._sorted&&t===i.iScale,r=s.length,a=this._getOtherScale(t),l=km(n,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=ym(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!at(f[t.axis])||d>p||u<p}for(h=0;h<r&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),o));++h);if(o){for(h=r-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const n=this._cachedMeta._parsed,i=[];let s,o,r;for(s=0,o=n.length;s<o;++s)r=n[s][t.axis],at(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,i=n.iScale,s=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:s?""+s.getLabelForValue(o[s.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=pm(P(this.options.clip,gm(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,i=this._cachedMeta,s=i.data||[],o=n.chartArea,r=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,o,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?r.push(u):u.draw(t,o))}for(d=0;d<r.length;++d)r[d].draw(t,o)}getStyle(t,n){const i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){const s=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];o=r.$context||(r.$context=wm(this.getContext(),t,r)),o.parsed=this.getParsed(t),o.raw=s.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=vm(this.chart.getContext(),this.index)),o.dataset=s,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){const s=n==="active",o=this._cachedDataOpts,r=t+"-"+n,a=o[r],l=this.enableOptionSharing&&ui(i);if(a)return $a(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(st.elements[t]),g=()=>this.getContext(i,s,n),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,o[r]=Object.freeze($a(p,l))),p}_resolveAnimations(t,n,i){const s=this.chart,o=this._cachedDataOpts,r=`animation-${n}`,a=o[r];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,n))}const c=new rd(s,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||go(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const i=this.resolveDataElementOptions(t,n),s=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(n,o)||o!==s;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:r}}updateElement(t,n,i,s){go(s)?Object.assign(t,i):this._resolveAnimations(n,s).update(t,i)}updateSharedOptions(t,n,i){t&&!go(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,s){t.active=s;const o=this.getStyle(n,s);this._resolveAnimations(n,i,s).update(t,{options:!s&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,o=n.length,r=Math.min(o,s);r&&this.parse(0,r),o>s?this._insertElements(s,o-s,t):o<s&&this._removeElements(o,s-o)}_insertElements(t,n,i=!0){const s=this._cachedMeta,o=s.data,r=t+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=r;a--)c[a]=c[a-n]};for(l(o),a=t;a<r;++a)o[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,s){}_removeElements(t,n){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,n);i._stacked&&In(i,s)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,i,s]=t;this[n](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}D(Vt,"defaults",{}),D(Vt,"datasetElementType",null),D(Vt,"dataElementType",null);function _m(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let s=0,o=n.length;s<o;s++)i=i.concat(n[s].controller.getAllParsedValues(e));e._cache.$bar=Hc(i.sort((s,o)=>s-o))}return e._cache.$bar}function Sm(e){const t=e.iScale,n=_m(t,e.type);let i=t._length,s,o,r,a;const l=()=>{r===32767||r===-32768||(ui(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(s=0,o=n.length;s<o;++s)r=t.getPixelForValue(n[s]),l();for(a=void 0,s=0,o=t.ticks.length;s<o;++s)r=t.getPixelForTick(s),l();return i}function Em(e,t,n,i){const s=n.barThickness;let o,r;return F(s)?(o=t.min*n.categoryPercentage,r=n.barPercentage):(o=s*i,r=1),{chunk:o/i,ratio:r,start:t.pixels[e]-o/2}}function Dm(e,t,n,i){const s=t.pixels,o=s[e];let r=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;r===null&&(r=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-r);const c=o-(o-Math.min(r,a))/2*l;return{chunk:Math.abs(a-r)/2*l/i,ratio:n.barPercentage,start:c}}function Mm(e,t,n,i){const s=n.parse(e[0],i),o=n.parse(e[1],i),r=Math.min(s,o),a=Math.max(s,o);let l=r,c=a;Math.abs(r)>Math.abs(a)&&(l=a,c=r),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:o,min:r,max:a}}function ld(e,t,n,i){return it(e)?Mm(e,t,n,i):t[n.axis]=n.parse(e,i),t}function Ha(e,t,n,i){const s=e.iScale,o=e.vScale,r=s.getLabels(),a=s===o,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(r[c],c),l.push(ld(h,u,o,c));return l}function po(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function Tm(e,t,n){return e!==0?Kt(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function Im(e){let t,n,i,s,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",o="start"):(s="start",o="end"),{start:n,end:i,reverse:t,top:s,bottom:o}}function Lm(e,t,n,i){let s=t.borderSkipped;const o={};if(!s){e.borderSkipped=o;return}if(s===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:l,top:c,bottom:d}=Im(e);s==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=d:(o[za(d,r,a,l)]=!0,s=c)),o[za(s,r,a,l)]=!0,e.borderSkipped=o}function za(e,t,n,i){return i?(e=Am(e,t,n),e=ja(e,n,t)):e=ja(e,t,n),e}function Am(e,t,n){return e===t?n:e===n?t:e}function ja(e,t,n){return e==="start"?t:e==="end"?n:e}function Cm(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class ss extends Vt{parsePrimitiveData(t,n,i,s){return Ha(t,n,i,s)}parseArrayData(t,n,i,s){return Ha(t,n,i,s)}parseObjectData(t,n,i,s){const{iScale:o,vScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?a:l,d=r.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=n[h],g={},g[o.axis]=o.parse(Te(p,c),h),u.push(ld(Te(p,d),g,r,h));return u}updateRangeFromParsed(t,n,i,s){super.updateRangeFromParsed(t,n,i,s);const o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:i,vScale:s}=n,o=this.getParsed(t),r=o._custom,a=po(r)?"["+r.start+", "+r.end+"]":""+s.getLabelForValue(o[s.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,s){const o=s==="reset",{index:r,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,s);for(let f=n;f<n+i;f++){const g=this.getParsed(f),p=o||F(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||po(g._custom)||r===b._top||r===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const v=y.options||t[f].options;Lm(y,v,b,r),Cm(y,v,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,n){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(n),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(F(h)||isNaN(h))return!0};for(const d of s)if(!(n!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[P(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,i){const s=this._getStacks(t,i),o=n!==void 0?s.indexOf(n):-1;return o===-1?s.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,i=n.iScale,s=[];let o,r;for(o=0,r=n.data.length;o<r;++o)s.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const a=t.barThickness;return{min:a||Sm(n),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:i,index:s},options:{base:o,minBarLength:r}}=this,a=o||0,l=this.getParsed(t),c=l._custom,d=po(c);let u=l[n.axis],h=0,f=i?this.applyStack(n,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Kt(u)!==Kt(c.barEnd)&&(h=0),h+=u);const m=!F(o)&&!d?o:h;let b=n.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=n.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<r){p=Tm(p,n,a)*r,u===a&&(b-=p/2);const y=n.getPixelForDecimal(0),v=n.getPixelForDecimal(1),w=Math.min(y,v),x=Math.max(y,v);b=Math.max(Math.min(b,x),w),g=b+p,i&&!d&&(l._stacks[n.axis]._visualValues[s]=n.getValueForPixel(g)-n.getValueForPixel(b))}if(b===n.getPixelForValue(a)){const y=Kt(p)*n.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,n){const i=n.scale,s=this.options,o=s.skipNull,r=P(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(n.grouped){const d=o?this._getStackCount(t):n.stackCount,u=s.barThickness==="flex"?Dm(t,n,s,d*c):Em(t,n,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(P(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(r,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(r,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,i=t.data,s=i.length;let o=0;for(;o<s;++o)this.getParsed(o)[n.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}D(ss,"id","bar"),D(ss,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),D(ss,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class os extends Vt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,s){const o=super.parsePrimitiveData(t,n,i,s);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(t,n,i,s){const o=super.parseArrayData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(t,n,i,s){const o=super.parseObjectData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,s),d=r.axis,u=a.axis;for(let h=n;h<n+i;h++){const f=t[h],g=!o&&this.getParsed(h),p={},m=p[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(g[d]),b=p[u]=o?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),o&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,n){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,n);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const o=s.radius;return n!=="active"&&(s.radius=0),s.radius+=P(i&&i._custom,o),s}}D(os,"id","bubble"),D(os,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),D(os,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Om(e,t,n){let i=1,s=1,o=0,r=0;if(t<tt){const a=e,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(v,w,x)=>hi(v,a,l,!0)?1:Math.max(w,w*n,x,x*n),g=(v,w,x)=>hi(v,a,l,!0)?-1:Math.min(w,w*n,x,x*n),p=f(0,c,u),m=f(lt,d,h),b=g(V,c,u),y=g(V+lt,d,h);i=(p-b)/2,s=(m-y)/2,o=-(p+b)/2,r=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:o,offsetY:r}}class Ye extends Vt{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let o=l=>+i[l];if($(i[t])){const{key:l="value"}=this._parsing;o=c=>+Te(i[c],l)}let r,a;for(r=t,a=t+n;r<a;++r)s._parsed[r]=o(r)}}_getRotation(){return Wt(this.options.rotation-90)}_getCircumference(){return Wt(this.options.circumference)}_getRotationExtents(){let t=tt,n=-tt;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,o=s._getRotation(),r=s._getCircumference();t=Math.min(t,o),n=Math.max(n,o+r)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:i}=n,s=this._cachedMeta,o=s.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(Ug(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Om(u,d,l),m=(i.width-r)/h,b=(i.height-r)/f,y=Math.max(Math.min(m,b)/2,0),v=Rc(this.options.radius,y),w=Math.max(v*l,0),x=(v-w)/this._getVisibleDatasetWeightTotal();this.offsetX=g*v,this.offsetY=p*v,s.total=this.calculateTotal(),this.outerRadius=v-x*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-x*c,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const i=this.options,s=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*o/tt)}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,a=r.chartArea,c=r.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=o&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(n,s);let b=this._getRotation(),y;for(y=0;y<n;++y)b+=this._circumference(y,o);for(y=n;y<n+i;++y){const v=this._circumference(y,o),w=t[y],x={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+v,circumference:v,outerRadius:g,innerRadius:f};m&&(x.options=p||this.resolveDataElementOptions(y,w.active?"active":s)),b+=v,this.updateElement(w,y,x,s)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let i=0,s;for(s=0;s<n.length;s++){const o=t._parsed[s];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(s)&&!n[s].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?tt*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Si(n._parsed[t],i.options.locale);return{label:s[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const i=this.chart;let s,o,r,a,l;if(!t){for(s=0,o=i.data.datasets.length;s<o;++s)if(i.isDatasetVisible(s)){r=i.getDatasetMeta(s),t=r.data,a=r.controller;break}}if(!t)return 0;for(s=0,o=t.length;s<o;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,s=t.length;i<s;++i){const o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(P(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}D(Ye,"id","doughnut"),D(Ye,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),D(Ye,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),D(Ye,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data,{labels:{pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=t.legend.options;return n.labels.length&&n.datasets.length?n.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:r&&(a||u.borderRadius),index:c}}):[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}});class rs extends Vt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:i,data:s=[],_dataset:o}=n,r=this.chart._animationsDisabled;let{start:a,count:l}=Wc(n,s,r);this._drawStart=a,this._drawCount=l,Vc(n)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,s),h=r.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=yn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||s==="none",y=n+i,v=t.length;let w=n>0&&this.getParsed(n-1);for(let x=0;x<v;++x){const _=t[x],k=b?_:{};if(x<n||x>=y){k.skip=!0;continue}const S=this.getParsed(x),T=F(S[f]),I=k[h]=r.getPixelForValue(S[h],x),M=k[f]=o||T?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[f],x);k.skip=isNaN(I)||isNaN(M)||T,k.stop=x>0&&Math.abs(S[h]-w[h])>m,p&&(k.parsed=S,k.raw=c.data[x]),u&&(k.options=d||this.resolveDataElementOptions(x,_.active?"active":s)),b||this.updateElement(_,x,k,s),w=S}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const o=s[0].size(this.resolveDataElementOptions(0)),r=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,o,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}D(rs,"id","line"),D(rs,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),D(rs,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ri extends Vt{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Si(n._parsed[t].r,i.options.locale);return{label:s[t]||"",value:o}}parseObjectData(t,n,i,s){return Zc.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const o=this.getParsed(s).r;!isNaN(o)&&this.chart.getDataVisibility(s)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,i=t.options,s=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(s/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),a=(o-r)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*V;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<n;++g)f+=this._computeAngle(g,s,p);for(g=n;g<n+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),v=r.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,o&&(l.animateScale&&(v=0),l.animateRotate&&(b=y=h));const w={x:d,y:u,innerRadius:0,outerRadius:v,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,w,s)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?Wt(this.resolveDataElementOptions(t,n).angle||i):0}}D(ri,"id","polarArea"),D(ri,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),D(ri,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return n.labels.map((o,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class $o extends Ye{}D($o,"id","pie"),D($o,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class as extends Vt{getLabelAndValue(t){const n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,s){return Zc.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta,i=n.dataset,s=n.data||[],o=n.iScale.getLabels();if(i.points=s,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===s.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,n,i,s){const o=this._cachedMeta.rScale,r=s==="reset";for(let a=n;a<n+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=o.getPointPositionForValue(a,this.getParsed(a).r),u=r?o.xCenter:d.x,h=r?o.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}D(as,"id","radar"),D(as,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),D(as,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class ls extends Vt{getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const n=this._cachedMeta,{data:i=[]}=n,s=this.chart._animationsDisabled;let{start:o,count:r}=Wc(n,i,s);if(this._drawStart=o,this._drawCount=r,Vc(n)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=r.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=yn(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||s==="none";let v=n>0&&this.getParsed(n-1);for(let w=n;w<n+i;++w){const x=t[w],_=this.getParsed(w),k=y?x:{},S=F(_[g]),T=k[f]=r.getPixelForValue(_[f],w),I=k[g]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,_,l):_[g],w);k.skip=isNaN(T)||isNaN(I)||S,k.stop=w>0&&Math.abs(_[f]-v[f])>b,m&&(k.parsed=_,k.raw=c.data[w]),h&&(k.options=u||this.resolveDataElementOptions(w,x.active?"active":s)),y||this.updateElement(x,w,k,s),v=_}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let a=0;for(let l=n.length-1;l>=0;--l)a=Math.max(a,n[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!n.length)return s;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,o,r)/2}}D(ls,"id","scatter"),D(ls,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),D(ls,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Pm=Object.freeze({__proto__:null,BarController:ss,BubbleController:os,DoughnutController:Ye,LineController:rs,PieController:$o,PolarAreaController:ri,RadarController:as,ScatterController:ls});function He(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class Ar{constructor(t){D(this,"options");this.options=t||{}}static override(t){Object.assign(Ar.prototype,t)}init(){}formats(){return He()}parse(){return He()}format(){return He()}add(){return He()}diff(){return He()}startOf(){return He()}endOf(){return He()}}var Rm={_date:Ar};function Bm(e,t,n,i){const{controller:s,data:o,_sorted:r}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&o.length){const c=a._reversePixels?sp:re;if(i){if(s._sharedOptions){const d=o[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(o,t,n-u),f=c(o,t,n+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(o,t,n);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=e,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!F(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!F(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:o.length-1}}function Vs(e,t,n,i,s){const o=e.getSortedVisibleDatasetMetas(),r=n[t];for(let a=0,l=o.length;a<l;++a){const{index:c,data:d}=o[a],{lo:u,hi:h}=Bm(o[a],t,r,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Fm(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(i,s){const o=t?Math.abs(i.x-s.x):0,r=n?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function mo(e,t,n,i,s){const o=[];return!s&&!e.isPointInArea(t)||Vs(e,n,t,function(a,l,c){!s&&!ae(a,e.chartArea,0)||a.inRange(t.x,t.y,i)&&o.push({element:a,datasetIndex:l,index:c})},!0),o}function Nm(e,t,n,i){let s=[];function o(r,a,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:u}=Nc(r,{x:t.x,y:t.y});hi(u,c,d)&&s.push({element:r,datasetIndex:a,index:l})}return Vs(e,n,t,o),s}function $m(e,t,n,i,s,o){let r=[];const a=Fm(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!o||e.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return Vs(e,n,t,c),r}function bo(e,t,n,i,s,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!i?Nm(e,t,n,s):$m(e,t,n,i,s,o)}function Wa(e,t,n,i,s){const o=[],r=n==="x"?"inXRange":"inYRange";let a=!1;return Vs(e,n,t,(l,c,d)=>{l[r]&&l[r](t[n],s)&&(o.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:o}var Hm={modes:{index(e,t,n,i){const s=Ve(t,e),o=n.axis||"x",r=n.includeInvisible||!1,a=n.intersect?mo(e,s,o,i,r):bo(e,s,o,!1,i,r),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;let a=n.intersect?mo(e,s,o,i,r):bo(e,s,o,!1,i,r);if(a.length>0){const l=a[0].datasetIndex,c=e.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return mo(e,s,o,i,r)},nearest(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return bo(e,s,o,n.intersect,i,r)},x(e,t,n,i){const s=Ve(t,e);return Wa(e,s,"x",n.intersect,i)},y(e,t,n,i){const s=Ve(t,e);return Wa(e,s,"y",n.intersect,i)}}};const cd=["left","top","right","bottom"];function Ln(e,t){return e.filter(n=>n.pos===t)}function Va(e,t){return e.filter(n=>cd.indexOf(n.pos)===-1&&n.box.axis===t)}function An(e,t){return e.sort((n,i)=>{const s=t?i:n,o=t?n:i;return s.weight===o.weight?s.index-o.index:s.weight-o.weight})}function zm(e){const t=[];let n,i,s,o,r,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],{position:o,options:{stack:r,stackWeight:a=1}}=s,t.push({index:n,box:s,pos:o,horizontal:s.isHorizontal(),weight:s.weight,stack:r&&o+r,stackWeight:a});return t}function jm(e){const t={};for(const n of e){const{stack:i,pos:s,stackWeight:o}=n;if(!i||!cd.includes(s))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}function Wm(e,t){const n=jm(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let o,r,a;for(o=0,r=e.length;o<r;++o){a=e[o];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return n}function Vm(e){const t=zm(e),n=An(t.filter(c=>c.box.fullSize),!0),i=An(Ln(t,"left"),!0),s=An(Ln(t,"right")),o=An(Ln(t,"top"),!0),r=An(Ln(t,"bottom")),a=Va(t,"x"),l=Va(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:s.concat(l).concat(r).concat(a),chartArea:Ln(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:o.concat(r).concat(a)}}function Ua(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function dd(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Um(e,t,n,i){const{pos:s,box:o}=n,r=e.maxPadding;if(!$(s)){n.size&&(e[s]-=n.size);const u=i[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?o.height:o.width),n.size=u.size/u.count,e[s]+=n.size}o.getPadding&&dd(r,o.getPadding());const a=Math.max(0,t.outerWidth-Ua(r,e,"left","right")),l=Math.max(0,t.outerHeight-Ua(r,e,"top","bottom")),c=a!==e.w,d=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function Ym(e){const t=e.maxPadding;function n(i){const s=Math.max(t[i]-e[i],0);return e[i]+=s,s}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function qm(e,t){const n=t.maxPadding;function i(s){const o={left:0,top:0,right:0,bottom:0};return s.forEach(r=>{o[r]=Math.max(t[r],n[r])}),o}return i(e?["left","right"]:["top","bottom"])}function Wn(e,t,n,i){const s=[];let o,r,a,l,c,d;for(o=0,r=e.length,c=0;o<r;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,qm(a.horizontal,t));const{same:u,other:h}=Um(t,n,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&Wn(s,t,n,i)||d}function zi(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function Ya(e,t,n,i){const s=n.padding;let{x:o,y:r}=t;for(const a of e){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;ui(c.start)&&(r=c.start),l.fullSize?zi(l,s.left,r,n.outerWidth-s.right-s.left,h):zi(l,t.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=t.h*d,h=c.size||l.width;ui(c.start)&&(o=c.start),l.fullSize?zi(l,o,s.top,h,n.outerHeight-s.bottom-s.top):zi(l,o,t.top+c.placed,h,u),c.start=o,c.placed+=u,o=l.right}}t.x=o,t.y=r}var wt={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=kt(e.options.layout.padding),o=Math.max(t-s.width,0),r=Math.max(n-s.height,0),a=Vm(e.boxes),l=a.vertical,c=a.horizontal;X(e.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},s);dd(h,kt(i));const f=Object.assign({maxPadding:h,w:o,h:r,x:s.left,y:s.top},s),g=Wm(l.concat(c),u);Wn(a.fullSize,f,u,g),Wn(l,f,u,g),Wn(c,f,u,g)&&Wn(l,f,u,g),Ym(f),Ya(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,Ya(a.rightAndBottom,f,u,g),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},X(a.chartArea,p=>{const m=p.box;Object.assign(m,e.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class ud{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,s){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,s?Math.floor(n/s):i)}}isAttached(t){return!0}updateConfig(t){}}class Gm extends ud{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const cs="$chartjs",Xm={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},qa=e=>e===null||e==="";function Km(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[cs]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",qa(s)){const o=La(e,"width");o!==void 0&&(e.width=o)}if(qa(i))if(e.style.height==="")e.height=e.width/(t||2);else{const o=La(e,"height");o!==void 0&&(e.height=o)}return e}const hd=Jp?{passive:!0}:!1;function Jm(e,t,n){e&&e.addEventListener(t,n,hd)}function Zm(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,hd)}function Qm(e,t){const n=Xm[e.type]||e.type,{x:i,y:s}=Ve(e,t);return{type:n,chart:t,native:e,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Ps(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function t0(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ps(a.addedNodes,i),r=r&&!Ps(a.removedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function e0(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ps(a.removedNodes,i),r=r&&!Ps(a.addedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const gi=new Map;let Ga=0;function fd(){const e=window.devicePixelRatio;e!==Ga&&(Ga=e,gi.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function n0(e,t){gi.size||window.addEventListener("resize",fd),gi.set(e,t)}function i0(e){gi.delete(e),gi.size||window.removeEventListener("resize",fd)}function s0(e,t,n){const i=e.canvas,s=i&&Lr(i);if(!s)return;const o=jc((a,l)=>{const c=s.clientWidth;n(a,l),c<s.clientWidth&&n()},window),r=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(s),n0(e,o),r}function yo(e,t,n){n&&n.disconnect(),t==="resize"&&i0(e)}function o0(e,t,n){const i=e.canvas,s=jc(o=>{e.ctx!==null&&n(Qm(o,e))},e);return Jm(i,t,s),s}class r0 extends ud{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Km(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[cs])return!1;const i=n[cs].initial;["height","width"].forEach(o=>{const r=i[o];F(r)?n.removeAttribute(o):n.setAttribute(o,r)});const s=i.style||{};return Object.keys(s).forEach(o=>{n.style[o]=s[o]}),n.width=n.width,delete n[cs],!0}addEventListener(t,n,i){this.removeEventListener(t,n);const s=t.$proxies||(t.$proxies={}),r={attach:t0,detach:e0,resize:s0}[n]||o0;s[n]=r(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),s=i[n];if(!s)return;({attach:yo,detach:yo,resize:yo}[n]||Zm)(t,n,s),i[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,s){return Kp(t,n,i,s)}isAttached(t){const n=t&&Lr(t);return!!(n&&n.isConnected)}}function a0(e){return!Ir()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?Gm:r0}class Ut{constructor(){D(this,"x");D(this,"y");D(this,"active",!1);D(this,"options");D(this,"$animations")}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return yn(this.x)&&yn(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const s={};return t.forEach(o=>{s[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),s}}D(Ut,"defaults",{}),D(Ut,"defaultRoutes");function l0(e,t){const n=e.options.ticks,i=c0(e),s=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?u0(t):[],r=o.length,a=o[0],l=o[r-1],c=[];if(r>s)return h0(t,c,o,r/s),c;const d=d0(o,t,s);if(r>0){let u,h;const f=r>1?Math.round((l-a)/(r-1)):null;for(ji(t,c,d,F(f)?0:a-f,a),u=0,h=r-1;u<h;u++)ji(t,c,d,o[u],o[u+1]);return ji(t,c,d,l,F(f)?t.length:l+f),c}return ji(t,c,d),c}function c0(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}function d0(e,t,n){const i=f0(e),s=t.length/n;if(!i)return Math.max(s,1);const o=Qg(i);for(let r=0,a=o.length-1;r<a;r++){const l=o[r];if(l>s)return l}return Math.max(s,1)}function u0(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}function h0(e,t,n,i){let s=0,o=n[0],r;for(i=Math.ceil(i),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=n[s*i])}function ji(e,t,n,i,s){const o=P(i,0),r=Math.min(P(s,e.length),e.length);let a=0,l,c,d;for(n=Math.ceil(n),s&&(l=s-i,n=l/Math.floor(l/n)),d=o;d<0;)a++,d=Math.round(o+a*n);for(c=Math.max(o,0);c<r;c++)c===d&&(t.push(e[c]),a++,d=Math.round(o+a*n))}function f0(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}const g0=e=>e==="left"?"right":e==="right"?"left":e,Xa=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,Ka=(e,t)=>Math.min(t||e,e);function Ja(e,t){const n=[],i=e.length/t,s=e.length;let o=0;for(;o<s;o+=i)n.push(e[Math.floor(o)]);return n}function p0(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),o=e._startPixel,r=e._endPixel,a=1e-6;let l=e.getPixelForTick(s),c;if(!(n&&(i===1?c=Math.max(l-o,r-l):t===0?c=(e.getPixelForTick(1)-l)/2:c=(l-e.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<o-a||l>r+a)))return l}function m0(e,t){X(e,n=>{const i=n.gc,s=i.length/2;let o;if(s>t){for(o=0;o<s;++o)delete n.data[i[o]];i.splice(0,s)}})}function Cn(e){return e.drawTicks?e.tickLength:0}function Za(e,t){if(!e.display)return 0;const n=ut(e.font,t),i=kt(e.padding);return(it(e.text)?e.text.length:1)*n.lineHeight+i.height}function b0(e,t){return Le(e,{scale:t,type:"scale"})}function y0(e,t,n){return Le(e,{tick:n,index:t,type:"tick"})}function x0(e,t,n){let i=_r(e);return(n&&t!=="right"||!n&&t==="right")&&(i=g0(i)),i}function v0(e,t,n,i){const{top:s,left:o,bottom:r,right:a,chart:l}=e,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=r-s,m=a-o;if(e.isHorizontal()){if(f=xt(i,o,a),$(n)){const b=Object.keys(n)[0],y=n[b];g=d[b].getPixelForValue(y)+p-t}else n==="center"?g=(c.bottom+c.top)/2+p-t:g=Xa(e,n,t);h=a-o}else{if($(n)){const b=Object.keys(n)[0],y=n[b];f=d[b].getPixelForValue(y)-m+t}else n==="center"?f=(c.left+c.right)/2-m+t:f=Xa(e,n,t);g=xt(i,r,s),u=n==="left"?-lt:lt}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class en extends Ut{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:s}=this;return t=Ct(t,Number.POSITIVE_INFINITY),n=Ct(n,Number.NEGATIVE_INFINITY),i=Ct(i,Number.POSITIVE_INFINITY),s=Ct(s,Number.NEGATIVE_INFINITY),{min:Ct(t,i),max:Ct(n,s),minDefined:at(t),maxDefined:at(n)}}getMinMax(t){let{min:n,max:i,minDefined:s,maxDefined:o}=this.getUserBounds(),r;if(s&&o)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)r=a[l].controller.getMinMax(this,t),s||(n=Math.min(n,r.min)),o||(i=Math.max(i,r.max));return n=o&&n>i?i:n,i=s&&n>i?n:i,{min:Ct(n,Ct(i,n)),max:Ct(i,Ct(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Z(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:s,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=Tp(this,o,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?Ja(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=l0(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,i;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Z(this.options.afterUpdate,[this])}beforeSetDimensions(){Z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,s,o;for(i=0,s=t.length;i<s;i++)o=t[i],o.label=Z(n.callback,[o.value,i,t],this)}afterTickToLabelConversion(){Z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=Ka(this.ticks.length,t.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation;let r=s,a,l,c;if(!this._isVisible()||!n.display||s>=o||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=pt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Cn(t.grid)-n.padding-Za(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=wr(Math.min(Math.asin(pt((d.highest.height+6)/a,-1,1)),Math.asin(pt(l/c,-1,1))-Math.asin(pt(h/c,-1,1)))),r=Math.max(s,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){Z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:s,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const l=Za(s,n.options.font);if(a?(t.width=this.maxWidth,t.height=Cn(o)+l):(t.height=this.maxHeight,t.width=Cn(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=Wt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,s){const{ticks:{align:o,padding:r},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*n.height):(h=i*t.height,f=s*n.width):o==="start"?f=n.width:o==="end"?h=t.width:o!=="inner"&&(h=t.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=t.height/2;o==="start"?(d=0,u=t.height):o==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,i;for(n=0,i=t.length;n<i;n++)F(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=Ja(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,i){const{ctx:s,_longestTextCache:o}=this,r=[],a=[],l=Math.floor(n/Ka(n,i));let c=0,d=0,u,h,f,g,p,m,b,y,v,w,x;for(u=0;u<n;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=o[m]=o[m]||{data:{},gc:[]},y=p.lineHeight,v=w=0,!F(g)&&!it(g))v=Cs(s,b.data,b.gc,v,g),w=y;else if(it(g))for(h=0,f=g.length;h<f;++h)x=g[h],!F(x)&&!it(x)&&(v=Cs(s,b.data,b.gc,v,x),w+=y);r.push(v),a.push(w),c=Math.max(v,c),d=Math.max(w,d)}m0(o,n);const _=r.indexOf(c),k=a.indexOf(d),S=T=>({width:r[T]||0,height:a[T]||0});return{first:S(0),last:S(n-1),widest:S(_),highest:S(k),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return ip(this._alignToPixels?$e(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=y0(this.getContext(),t,i))}return this.$context||(this.$context=b0(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=Wt(this.labelRotation),i=Math.abs(Math.cos(n)),s=Math.abs(Math.sin(n)),o=this._getLabelSizes(),r=t.autoSkipPadding||0,a=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,s=this.options,{grid:o,position:r,border:a}=s,l=o.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Cn(o),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(j){return $e(i,j,p)};let y,v,w,x,_,k,S,T,I,M,C,U;if(r==="top")y=b(this.bottom),k=this.bottom-h,T=y-m,M=b(t.top)+m,U=t.bottom;else if(r==="bottom")y=b(this.top),M=t.top,U=b(t.bottom)-m,k=y+m,T=this.top+h;else if(r==="left")y=b(this.right),_=this.right-h,S=y-m,I=b(t.left)+m,C=t.right;else if(r==="right")y=b(this.left),I=t.left,C=b(t.right)-m,_=y+m,S=this.left+h;else if(n==="x"){if(r==="center")y=b((t.top+t.bottom)/2+.5);else if($(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}M=t.top,U=t.bottom,k=y+m,T=k+h}else if(n==="y"){if(r==="center")y=b((t.left+t.right)/2);else if($(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}_=y-m,S=_-h,I=t.left,C=t.right}const Q=P(s.ticks.maxTicksLimit,u),z=Math.max(1,Math.ceil(u/Q));for(v=0;v<u;v+=z){const j=this.getContext(v),J=o.setContext(j),mt=a.setContext(j),ht=J.lineWidth,Ae=J.color,Ce=mt.dash||[],me=mt.dashOffset,Dn=J.tickWidth,Oe=J.tickColor,Mn=J.tickBorderDash||[],Pe=J.tickBorderDashOffset;w=p0(this,v,l),w!==void 0&&(x=$e(i,w,ht),c?_=S=I=C=x:k=T=M=U=x,f.push({tx1:_,ty1:k,tx2:S,ty2:T,x1:I,y1:M,x2:C,y2:U,width:ht,color:Ae,borderDash:Ce,borderDashOffset:me,tickWidth:Dn,tickColor:Oe,tickBorderDash:Mn,tickBorderDashOffset:Pe}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const n=this.axis,i=this.options,{position:s,ticks:o}=i,r=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=o,h=Cn(i.grid),f=h+d,g=u?-d:f,p=-Wt(this.labelRotation),m=[];let b,y,v,w,x,_,k,S,T,I,M,C,U="middle";if(s==="top")_=this.bottom-g,k=this._getXAxisLabelAlignment();else if(s==="bottom")_=this.top+g,k=this._getXAxisLabelAlignment();else if(s==="left"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,x=z.x}else if(s==="right"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,x=z.x}else if(n==="x"){if(s==="center")_=(t.top+t.bottom)/2+f;else if($(s)){const z=Object.keys(s)[0],j=s[z];_=this.chart.scales[z].getPixelForValue(j)+f}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(s==="center")x=(t.left+t.right)/2-f;else if($(s)){const z=Object.keys(s)[0],j=s[z];x=this.chart.scales[z].getPixelForValue(j)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?U="top":l==="end"&&(U="bottom"));const Q=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){v=a[b],w=v.label;const z=o.setContext(this.getContext(b));S=this.getPixelForTick(b)+o.labelOffset,T=this._resolveTickFontOptions(b),I=T.lineHeight,M=it(w)?w.length:1;const j=M/2,J=z.color,mt=z.textStrokeColor,ht=z.textStrokeWidth;let Ae=k;r?(x=S,k==="inner"&&(b===y-1?Ae=this.options.reverse?"left":"right":b===0?Ae=this.options.reverse?"right":"left":Ae="center"),s==="top"?c==="near"||p!==0?C=-M*I+I/2:c==="center"?C=-Q.highest.height/2-j*I+I:C=-Q.highest.height+I/2:c==="near"||p!==0?C=I/2:c==="center"?C=Q.highest.height/2-j*I:C=Q.highest.height-M*I,u&&(C*=-1),p!==0&&!z.showLabelBackdrop&&(x+=I/2*Math.sin(p))):(_=S,C=(1-M)*I/2);let Ce;if(z.showLabelBackdrop){const me=kt(z.backdropPadding),Dn=Q.heights[b],Oe=Q.widths[b];let Mn=C-me.top,Pe=0-me.left;switch(U){case"middle":Mn-=Dn/2;break;case"bottom":Mn-=Dn;break}switch(k){case"center":Pe-=Oe/2;break;case"right":Pe-=Oe;break;case"inner":b===y-1?Pe-=Oe:b>0&&(Pe-=Oe/2);break}Ce={left:Pe,top:Mn,width:Oe+me.width,height:Dn+me.height,color:z.backdropColor}}m.push({label:w,font:T,textOffset:C,options:{rotation:p,color:J,strokeColor:mt,strokeWidth:ht,textAlign:Ae,textBaseline:U,translation:[x,_],backdrop:Ce}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-Wt(this.labelRotation))return t==="top"?"left":"right";let s="center";return n.align==="start"?s="left":n.align==="end"?s="right":n.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:s,padding:o}}=this.options,r=this._getLabelSizes(),a=t+o,l=r.widest.width;let c,d;return n==="left"?s?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?s?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:s,width:o,height:r}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,s,o,r),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const s=this.ticks.findIndex(o=>o.value===t);return s>=0?n.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,r;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(n.display)for(o=0,r=s.length;o<r;++o){const l=s[o];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:i,grid:s}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=$e(t,this.left,r)-r/2,d=$e(t,this.right,a)+a/2,u=h=l):(u=$e(t,this.top,r)-r/2,h=$e(t,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&zs(i,s);const o=this.getLabelItems(t);for(const r of o){const a=r.options,l=r.font,c=r.label,d=r.textOffset;Ze(i,c,0,d,l,a)}s&&js(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:s}}=this;if(!i.display)return;const o=ut(i.font),r=kt(i.padding),a=i.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||$(n)?(l+=r.bottom,it(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=v0(this,l,n,a);Ze(t,i.text,0,0,o,{color:i.color,maxWidth:u,rotation:h,textAlign:x0(a,n,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=P(t.grid&&t.grid.z,-1),s=P(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==en.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let o,r;for(o=0,r=n.length;o<r;++o){const a=n[o];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return ut(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Wi{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;_0(n)&&(i=this.register(n));const s=this.items,o=t.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in s||(s[o]=t,w0(t,r,i),this.override&&st.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,s=this.scope;i in n&&delete n[i],s&&i in st[s]&&(delete st[s][i],this.override&&delete Je[i])}}function w0(e,t,n){const i=di(Object.create(null),[n?st.get(n):{},st.get(t),e.defaults]);st.set(t,i),e.defaultRoutes&&k0(t,e.defaultRoutes),e.descriptors&&st.describe(t,e.descriptors)}function k0(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),o=[e].concat(i).join("."),r=t[n].split("."),a=r.pop(),l=r.join(".");st.route(o,s,l,a)})}function _0(e){return"id"in e&&"defaults"in e}class S0{constructor(){this.controllers=new Wi(Vt,"datasets",!0),this.elements=new Wi(Ut,"elements"),this.plugins=new Wi(Object,"plugins"),this.scales=new Wi(en,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(s=>{const o=i||this._getRegistryForType(s);i||o.isForType(s)||o===this.plugins&&s.id?this._exec(t,o,s):X(s,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,n,i){const s=vr(t);Z(i["before"+s],[],i),n[t](i),Z(i["after"+s],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const s=n.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var qt=new S0;class E0{constructor(){this._init=void 0}notify(t,n,i,s){if(n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=s?this._descriptors(t).filter(s):this._descriptors(t),r=this._notify(o,t,n,i);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,n,i,s){s=s||{};for(const o of t){const r=o.plugin,a=r[i],l=[n,s,o.options];if(Z(a,l,r)===!1&&s.cancelable)return!1}return!0}invalidate(){F(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,s=P(i.options&&i.options.plugins,{}),o=D0(i);return s===!1&&!n?[]:T0(t,o,s,n)}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,s=(o,r)=>o.filter(a=>!r.some(l=>a.plugin.id===l.plugin.id));this._notify(s(n,i),t,"stop"),this._notify(s(i,n),t,"start")}}function D0(e){const t={},n=[],i=Object.keys(qt.plugins.items);for(let o=0;o<i.length;o++)n.push(qt.getPlugin(i[o]));const s=e.plugins||[];for(let o=0;o<s.length;o++){const r=s[o];n.indexOf(r)===-1&&(n.push(r),t[r.id]=!0)}return{plugins:n,localIds:t}}function M0(e,t){return!t&&e===!1?null:e===!0?{}:e}function T0(e,{plugins:t,localIds:n},i,s){const o=[],r=e.getContext();for(const a of t){const l=a.id,c=M0(i[l],s);c!==null&&o.push({plugin:a,options:I0(e.config,{plugin:a,local:n[l]},c,r)})}return o}function I0(e,{plugin:t,local:n},i,s){const o=e.pluginScopeKeys(t),r=e.getOptionScopes(i,o);return n&&t.defaults&&r.push(t.defaults),e.createResolver(r,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function Ho(e,t){const n=st.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function L0(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function A0(e,t){return e===t?"_index_":"_value_"}function Qa(e){if(e==="x"||e==="y"||e==="r")return e}function C0(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function zo(e,...t){if(Qa(e))return e;for(const n of t){const i=n.axis||C0(n.position)||e.length>1&&Qa(e[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function tl(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function O0(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(i=>i.xAxisID===e||i.yAxisID===e);if(n.length)return tl(e,"x",n[0])||tl(e,"y",n[0])}return{}}function P0(e,t){const n=Je[e.type]||{scales:{}},i=t.scales||{},s=Ho(e.type,t),o=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!$(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=zo(r,a,O0(r,e),st.scales[a.type]),c=A0(l,s),d=n.scales||{};o[r]=ni(Object.create(null),[{axis:l},a,d[l],d[c]])}),e.data.datasets.forEach(r=>{const a=r.type||e.type,l=r.indexAxis||Ho(a,t),d=(Je[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=L0(u,l),f=r[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),ni(o[f],[{axis:h},i[f],d[u]])})}),Object.keys(o).forEach(r=>{const a=o[r];ni(a,[st.scales[a.type],st.scale])}),o}function gd(e){const t=e.options||(e.options={});t.plugins=P(t.plugins,{}),t.scales=P0(e,t)}function pd(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function R0(e){return e=e||{},e.data=pd(e.data),gd(e),e}const el=new Map,md=new Set;function Vi(e,t){let n=el.get(e);return n||(n=t(),el.set(e,n),md.add(n)),n}const On=(e,t,n)=>{const i=Te(t,n);i!==void 0&&e.add(i)};class B0{constructor(t){this._config=R0(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=pd(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),gd(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Vi(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return Vi(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return Vi(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,i=this.type;return Vi(`${i}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let s=i.get(t);return(!s||n)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,n,i){const{options:s,type:o}=this,r=this._cachedScopes(t,i),a=r.get(n);if(a)return a;const l=new Set;n.forEach(d=>{t&&(l.add(t),d.forEach(u=>On(l,t,u))),d.forEach(u=>On(l,s,u)),d.forEach(u=>On(l,Je[o]||{},u)),d.forEach(u=>On(l,st,u)),d.forEach(u=>On(l,Fo,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),md.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:t,type:n}=this;return[t,Je[n]||{},st.datasets[n]||{},{type:n},st,Fo]}resolveNamedOptions(t,n,i,s=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=nl(this._resolverCache,t,s);let l=r;if(N0(r,n)){o.$shared=!1,i=Ie(i)?i():i;const c=this.createResolver(t,i,a);l=xn(r,i,c)}for(const c of n)o[c]=l[c];return o}createResolver(t,n,i=[""],s){const{resolver:o}=nl(this._resolverCache,t,i);return $(n)?xn(o,n,void 0,s):o}}function nl(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let o=i.get(s);return o||(o={resolver:Dr(t,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,o)),o}const F0=e=>$(e)&&Object.getOwnPropertyNames(e).some(t=>Ie(e[t]));function N0(e,t){const{isScriptable:n,isIndexable:i}=Gc(e);for(const s of t){const o=n(s),r=i(s),a=(r||o)&&e[s];if(o&&(Ie(a)||F0(a))||r&&it(a))return!0}return!1}var $0="4.5.1";const H0=["top","bottom","left","right","chartArea"];function il(e,t){return e==="top"||e==="bottom"||H0.indexOf(e)===-1&&t==="x"}function sl(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function ol(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Z(n&&n.onComplete,[e],t)}function z0(e){const t=e.chart,n=t.options.animation;Z(n&&n.onProgress,[e],t)}function bd(e){return Ir()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const ds={},rl=e=>{const t=bd(e);return Object.values(ds).filter(n=>n.canvas===t).pop()};function j0(e,t,n){const i=Object.keys(e);for(const s of i){const o=+s;if(o>=t){const r=e[s];delete e[s],(n>0||o>t)&&(e[o+n]=r)}}}function W0(e,t,n,i){return!n||e.type==="mouseout"?null:i?t:e}class se{static register(...t){qt.add(...t),al()}static unregister(...t){qt.remove(...t),al()}constructor(t,n){const i=this.config=new B0(n),s=bd(t),o=rl(s);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||a0(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,r.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Vg(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new E0,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=ap(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],ds[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}te.listen(this,"complete",ol),te.listen(this,"progress",z0),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:s,_aspectRatio:o}=this;return F(t)?n&&o?o:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return qt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Ia(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Da(this.canvas,this.ctx),this}stop(){return te.stop(this),this}resize(t,n){te.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,s=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,t,n,o),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Ia(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),Z(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};X(n,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,s=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let o=[];n&&(o=o.concat(Object.keys(n).map(r=>{const a=n[r],l=zo(r,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),X(o,r=>{const a=r.options,l=a.id,c=zo(l,a),d=P(a.type,r.dtype);(a.position===void 0||il(a.position,c)!==il(r.dposition))&&(a.position=r.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=qt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),X(s,(r,a)=>{r||delete i[a]}),X(i,r=>{wt.configure(this,r,r.options),wt.addBox(this,r)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((s,o)=>s.index-o.index),i>n){for(let s=n;s<i;++s)this._destroyDatasetMeta(s);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(sl("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,s)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=n.length;i<s;i++){const o=n[i];let r=this.getDatasetMeta(i);const a=o.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=o.indexAxis||Ho(a,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=qt.getController(a),{datasetElementType:c,dataElementType:d}=st.datasets[a];Object.assign(l,{dataElementType:qt.getElement(d),datasetElementType:c&&qt.getElement(c)}),r.controller=new l(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){X(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&o.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),s||X(o,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(sl("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){X(this.scales,t=>{wt.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!ba(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:o}of n){const r=i==="_removeElements"?-o:o;j0(t,s,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=o=>new Set(t.filter(r=>r[0]===o).map((r,a)=>a+","+r.splice(1).join(","))),s=i(0);for(let o=1;o<n;o++)if(!ba(s,i(o)))return;return Array.from(s).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;wt.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],X(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,o)=>{s._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Ie(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(n),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(te.has(this)?this.attached&&!te.running(this)&&te.start(this):(this.draw(),ol({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let s,o;for(s=0,o=n.length;s<o;++s){const r=n[s];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=od(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&zs(n,s),t.controller.draw(),s&&js(n),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return ae(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,s){const o=Hm.modes[n];return typeof o=="function"?o(this,t,i,s):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let s=i.filter(o=>o&&o._dataset===n).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Le(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){const i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const s=i?"show":"hide",o=this.getDatasetMeta(t),r=o.controller._resolveAnimations(void 0,s);ui(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(o,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),te.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Da(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete ds[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(o,r)=>{n.addEventListener(this,o,r),t[o]=r},s=(o,r,a)=>{o.offsetX=r,o.offsetY=a,this._eventHandler(o)};X(this.options.events,o=>i(o,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(l,c)=>{n.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(n.removeEventListener(this,l,c),delete t[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,s("resize",o),this._stop(),this._resize(0,0),i("attach",a)},n.isAttached(this.canvas)?a():r()}unbindEvents(){X(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},X(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const s=i?"set":"remove";let o,r,a,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){r=t[a];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:o,index:r})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[r],index:r}});!Is(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){const s=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=o(n,t),a=i?t:o(t,n);r.length&&this.updateHoverStyle(r,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},s=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:s=[],options:o}=this,r=n,a=this._getActiveElements(t,s,i,r),l=Kg(t),c=W0(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Z(o.onHover,[t,a,this],this),l&&Z(o.onClick,[t,a,this],this));const d=!Is(a,s);return(d||n)&&(this._active=a,this._updateHoverStyles(a,s,n)),this._lastEvent=c,d}_getActiveElements(t,n,i,s){if(t.type==="mouseout")return[];if(!i)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,s)}}D(se,"defaults",st),D(se,"instances",ds),D(se,"overrides",Je),D(se,"registry",qt),D(se,"version",$0),D(se,"getChart",rl);function al(){return X(se.instances,e=>e._plugins.invalidate())}function V0(e,t,n){const{startAngle:i,x:s,y:o,outerRadius:r,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/r,vt(i-n));if(e.beginPath(),e.arc(s,o,r-c/2,i+u/2,n-u/2),a>0){const h=Math.min(c/a,vt(i-n));e.arc(s,o,a+c/2,n-h/2,i+h/2,!0)}else{const h=Math.min(c/2,r*vt(i-n));if(d==="round")e.arc(s,o,h,n-V/2,i+V/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(n+V/2)+s,p=-f*Math.sin(n+V/2)+o,m=f*Math.cos(i+V/2)+s,b=f*Math.sin(i+V/2)+o;e.lineTo(g,p),e.lineTo(m,b)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function U0(e,t,n){const{startAngle:i,pixelMargin:s,x:o,y:r,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(o,r,a,i-c,n+c),l>s?(c=s/l,e.arc(o,r,l,n+c,i-c,!0)):e.arc(o,r,s,n+lt,i-lt),e.closePath(),e.clip()}function Y0(e){return Er(e,["outerStart","outerEnd","innerStart","innerEnd"])}function q0(e,t,n,i){const s=Y0(e.options.borderRadius),o=(n-t)/2,r=Math.min(o,i*t/2),a=l=>{const c=(n-Math.min(o,l))*i/2;return pt(l,0,Math.min(o,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:pt(s.innerStart,0,r),innerEnd:pt(s.innerEnd,0,r)}}function an(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function Rs(e,t,n,i,s,o){const{x:r,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let f=0;const g=s-l;if(i){const z=d>0?d-i:0,j=u>0?u-i:0,J=(z+j)/2,mt=J!==0?g*J/(J+i):g;f=(g-mt)/2}const p=Math.max(.001,g*u-n/V)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:v,outerEnd:w,innerStart:x,innerEnd:_}=q0(t,h,u,y-b),k=u-v,S=u-w,T=b+v/k,I=y-w/S,M=h+x,C=h+_,U=b+x/M,Q=y-_/C;if(e.beginPath(),o){const z=(T+I)/2;if(e.arc(r,a,u,T,z),e.arc(r,a,u,z,I),w>0){const ht=an(S,I,r,a);e.arc(ht.x,ht.y,w,I,y+lt)}const j=an(C,y,r,a);if(e.lineTo(j.x,j.y),_>0){const ht=an(C,Q,r,a);e.arc(ht.x,ht.y,_,y+lt,Q+Math.PI)}const J=(y-_/h+(b+x/h))/2;if(e.arc(r,a,h,y-_/h,J,!0),e.arc(r,a,h,J,b+x/h,!0),x>0){const ht=an(M,U,r,a);e.arc(ht.x,ht.y,x,U+Math.PI,b-lt)}const mt=an(k,b,r,a);if(e.lineTo(mt.x,mt.y),v>0){const ht=an(k,T,r,a);e.arc(ht.x,ht.y,v,b-lt,T)}}else{e.moveTo(r,a);const z=Math.cos(T)*u+r,j=Math.sin(T)*u+a;e.lineTo(z,j);const J=Math.cos(I)*u+r,mt=Math.sin(I)*u+a;e.lineTo(J,mt)}e.closePath()}function G0(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a}=t;let l=t.endAngle;if(o){Rs(e,t,n,i,l,s);for(let c=0;c<o;++c)e.fill();isNaN(a)||(l=r+(a%tt||tt))}return Rs(e,t,n,i,l,s),e.fill(),l}function X0(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,g?(e.lineWidth=c*2,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let p=t.endAngle;if(o){Rs(e,t,n,i,p,s);for(let m=0;m<o;++m)e.stroke();isNaN(a)||(p=r+(a%tt||tt))}g&&U0(e,t,p),l.selfJoin&&p-r>=V&&f===0&&d!=="miter"&&V0(e,t,p),o||(Rs(e,t,n,i,p,s),e.stroke())}class Vn extends Ut{constructor(n){super();D(this,"circumference");D(this,"endAngle");D(this,"fullCircles");D(this,"innerRadius");D(this,"outerRadius");D(this,"pixelMargin");D(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.getProps(["x","y"],s),{angle:r,distance:a}=Nc(o,{x:n,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=P(h,c-l),p=hi(r,l,c)&&l!==c,m=g>=tt||p,b=oe(a,d+f,u+f);return m&&b}getCenterPoint(n){const{x:i,y:s,startAngle:o,endAngle:r,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(o+r)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:i,circumference:s}=this,o=(i.offset||0)/4,r=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>tt?Math.floor(s/tt):0,s===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const c=1-Math.sin(Math.min(V,s||0)),d=o*c;n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,G0(n,this,d,r,a),X0(n,this,d,r,a),n.restore()}}D(Vn,"id","arc"),D(Vn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),D(Vn,"defaultRoutes",{backgroundColor:"backgroundColor"}),D(Vn,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function yd(e,t,n=t){e.lineCap=P(n.borderCapStyle,t.borderCapStyle),e.setLineDash(P(n.borderDash,t.borderDash)),e.lineDashOffset=P(n.borderDashOffset,t.borderDashOffset),e.lineJoin=P(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=P(n.borderWidth,t.borderWidth),e.strokeStyle=P(n.borderColor,t.borderColor)}function K0(e,t,n){e.lineTo(n.x,n.y)}function J0(e){return e.stepped?xp:e.tension||e.cubicInterpolationMode==="monotone"?vp:K0}function xd(e,t,n={}){const i=e.length,{start:s=0,end:o=i-1}=n,{start:r,end:a}=t,l=Math.max(s,r),c=Math.min(o,a),d=s<r&&o<r||s>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Z0(e,t,n,i){const{points:s,options:o}=t,{count:r,start:a,loop:l,ilen:c}=xd(s,n,i),d=J0(o);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%r],!g.skip&&(u?(e.moveTo(g.x,g.y),u=!1):d(e,p,g,h,o.stepped),p=g);return l&&(g=s[(a+(h?c:0))%r],d(e,p,g,h,o.stepped)),!!l}function Q0(e,t,n,i){const s=t.points,{count:o,start:r,ilen:a}=xd(s,n,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=w=>(r+(c?a-w:w))%o,v=()=>{p!==m&&(e.lineTo(d,m),e.lineTo(d,p),e.lineTo(d,b))};for(l&&(f=s[y(0)],e.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const w=f.x,x=f.y,_=w|0;_===g?(x<p?p=x:x>m&&(m=x),d=(u*d+w)/++u):(v(),e.lineTo(w,x),g=_,u=0,p=m=x),b=x}v()}function jo(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?Q0:Z0}function tb(e){return e.stepped?Zp:e.tension||e.cubicInterpolationMode==="monotone"?Qp:Ue}function eb(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),yd(e,t.options),e.stroke(s)}function nb(e,t,n,i){const{segments:s,options:o}=t,r=jo(t);for(const a of s)yd(e,o,a.style),e.beginPath(),r(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}const ib=typeof Path2D=="function";function sb(e,t,n,i){ib&&!t.options.segment?eb(e,t,n,i):nb(e,t,n,i)}class Ee extends Ut{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;Vp(this._points,i,t,s,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=om(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){const i=this.options,s=t[n],o=this.points,r=sd(this,{property:n,start:s,end:s});if(!r.length)return;const a=[],l=tb(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=o[u],g=o[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[n])/(g[n]-f[n])),m=l(f,g,p,i.stepped);m[n]=t[n],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,n,i){return jo(this)(t,this,n,i)}path(t,n,i){const s=this.segments,o=jo(this);let r=this._loop;n=n||0,i=i||this.points.length-n;for(const a of s)r&=o(t,this,a,{start:n,end:n+i-1});return!!r}draw(t,n,i,s){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),sb(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}D(Ee,"id","line"),D(Ee,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),D(Ee,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),D(Ee,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function ll(e,t,n,i){const s=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<s.radius+s.hitRadius}class us extends Ut{constructor(n){super();D(this,"parsed");D(this,"skip");D(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.options,{x:r,y:a}=this.getProps(["x","y"],s);return Math.pow(n-r,2)+Math.pow(i-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(n,i){return ll(this,n,"x",i)}inYRange(n,i){return ll(this,n,"y",i)}getCenterPoint(n){const{x:i,y:s}=this.getProps(["x","y"],n);return{x:i,y:s}}size(n){n=n||this.options||{};let i=n.radius||0;i=Math.max(i,i&&n.hoverRadius||0);const s=i&&n.borderWidth||0;return(i+s)*2}draw(n,i){const s=this.options;this.skip||s.radius<.1||!ae(this,i,this.size(s)/2)||(n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.fillStyle=s.backgroundColor,No(n,s,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}D(us,"id","point"),D(us,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),D(us,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function vd(e,t){const{x:n,y:i,base:s,width:o,height:r}=e.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return e.horizontal?(u=r/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,d=i+u):(u=o/2,a=n-u,l=n+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function De(e,t,n,i){return e?0:pt(t,n,i)}function ob(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,o=qc(i);return{t:De(s.top,o.top,0,n),r:De(s.right,o.right,0,t),b:De(s.bottom,o.bottom,0,n),l:De(s.left,o.left,0,t)}}function rb(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,o=Ge(s),r=Math.min(t,n),a=e.borderSkipped,l=i||$(s);return{topLeft:De(!l||a.top||a.left,o.topLeft,0,r),topRight:De(!l||a.top||a.right,o.topRight,0,r),bottomLeft:De(!l||a.bottom||a.left,o.bottomLeft,0,r),bottomRight:De(!l||a.bottom||a.right,o.bottomRight,0,r)}}function ab(e){const t=vd(e),n=t.right-t.left,i=t.bottom-t.top,s=ob(e,n/2,i/2),o=rb(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,o.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(s.b,s.r))}}}}function xo(e,t,n,i){const s=t===null,o=n===null,a=e&&!(s&&o)&&vd(e,i);return a&&(s||oe(t,a.left,a.right))&&(o||oe(n,a.top,a.bottom))}function lb(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function cb(e,t){e.rect(t.x,t.y,t.w,t.h)}function vo(e,t,n={}){const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,r=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+o,h:e.h+r,radius:e.radius}}class hs extends Ut{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:s}}=this,{inner:o,outer:r}=ab(this),a=lb(r.radius)?fi:cb;t.save(),(r.w!==o.w||r.h!==o.h)&&(t.beginPath(),a(t,vo(r,n,o)),t.clip(),a(t,vo(o,-n,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,vo(o,n)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,n,i){return xo(this,t,n,i)}inXRange(t,n){return xo(this,t,null,n)}inYRange(t,n){return xo(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:s,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+s)/2:n,y:o?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}D(hs,"id","bar"),D(hs,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),D(hs,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var db=Object.freeze({__proto__:null,ArcElement:Vn,BarElement:hs,LineElement:Ee,PointElement:us});const Wo=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],cl=Wo.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function wd(e){return Wo[e%Wo.length]}function kd(e){return cl[e%cl.length]}function ub(e,t){return e.borderColor=wd(t),e.backgroundColor=kd(t),++t}function hb(e,t){return e.backgroundColor=e.data.map(()=>wd(t++)),t}function fb(e,t){return e.backgroundColor=e.data.map(()=>kd(t++)),t}function gb(e){let t=0;return(n,i)=>{const s=e.getDatasetMeta(i).controller;s instanceof Ye?t=hb(n,t):s instanceof ri?t=fb(n,t):s&&(t=ub(n,t))}}function dl(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function pb(e){return e&&(e.borderColor||e.backgroundColor)}function mb(){return st.borderColor!=="rgba(0,0,0,0.1)"||st.backgroundColor!=="rgba(0,0,0,0.1)"}var bb={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:s}=e.config,{elements:o}=s,r=dl(i)||pb(s)||o&&dl(o)||mb();if(!n.forceOverride&&r)return;const a=gb(e);i.forEach(a)}};function yb(e,t,n,i,s){const o=s.samples||i;if(o>=n)return e.slice(t,t+n);const r=[],a=(n-2)/(o-2);let l=0;const c=t+n-1;let d=t,u,h,f,g,p;for(r[l++]=e[d],u=0;u<o-2;u++){let m=0,b=0,y;const v=Math.floor((u+1)*a)+1+t,w=Math.min(Math.floor((u+2)*a)+1,n)+t,x=w-v;for(y=v;y<w;y++)m+=e[y].x,b+=e[y].y;m/=x,b/=x;const _=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,n)+t,{x:S,y:T}=e[d];for(f=g=-1,y=_;y<k;y++)g=.5*Math.abs((S-m)*(e[y].y-T)-(S-e[y].x)*(b-T)),g>f&&(f=g,h=e[y],p=y);r[l++]=h,d=p}return r[l++]=e[c],r}function xb(e,t,n,i){let s=0,o=0,r,a,l,c,d,u,h,f,g,p;const m=[],b=t+n-1,y=e[t].x,w=e[b].x-y;for(r=t;r<t+n;++r){a=e[r],l=(a.x-y)/w*i,c=a.y;const x=l|0;if(x===d)c<g?(g=c,u=r):c>p&&(p=c,h=r),s=(o*s+a.x)/++o;else{const _=r-1;if(!F(u)&&!F(h)){const k=Math.min(u,h),S=Math.max(u,h);k!==f&&k!==_&&m.push({...e[k],x:s}),S!==f&&S!==_&&m.push({...e[S],x:s})}r>0&&_!==f&&m.push(e[_]),m.push(a),d=x,o=0,g=p=c,u=h=f=r}}return m}function _d(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function ul(e){e.data.datasets.forEach(t=>{_d(t)})}function vb(e,t){const n=t.length;let i=0,s;const{iScale:o}=e,{min:r,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=pt(re(t,o.axis,r).lo,0,n-1)),c?s=pt(re(t,o.axis,a).hi+1,i,n)-i:s=n-i,{start:i,count:s}}var wb={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){ul(e);return}const i=e.width;e.data.datasets.forEach((s,o)=>{const{_data:r,indexAxis:a}=s,l=e.getDatasetMeta(o),c=r||s.data;if(jn([a,e.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=e.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||e.options.parsing)return;let{start:u,count:h}=vb(l,c);const f=n.threshold||4*i;if(h<=f){_d(s);return}F(r)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(n.algorithm){case"lttb":g=yb(c,u,h,i,n);break;case"min-max":g=xb(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}s._decimated=g})},destroy(e){ul(e)}};function kb(e,t,n){const i=e.segments,s=e.points,o=t.points,r=[];for(const a of i){let{start:l,end:c}=a;c=Us(l,c,s);const d=Vo(n,s[l],s[c],a.loop);if(!t.segments){r.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=sd(t,d);for(const h of u){const f=Vo(n,o[h.start],o[h.end],h.loop),g=id(a,s,f);for(const p of g)r.push({source:p,target:h,start:{[n]:hl(d,f,"start",Math.max)},end:{[n]:hl(d,f,"end",Math.min)}})}}return r}function Vo(e,t,n,i){if(i)return;let s=t[e],o=n[e];return e==="angle"&&(s=vt(s),o=vt(o)),{property:e,start:s,end:o}}function _b(e,t){const{x:n=null,y:i=null}=e||{},s=t.points,o=[];return t.segments.forEach(({start:r,end:a})=>{a=Us(r,a,s);const l=s[r],c=s[a];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):n!==null&&(o.push({x:n,y:l.y}),o.push({x:n,y:c.y}))}),o}function Us(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function hl(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function Sd(e,t){let n=[],i=!1;return it(e)?(i=!0,n=e):n=_b(e,t),n.length?new Ee({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function fl(e){return e&&e.fill!==!1}function Sb(e,t,n){let s=e[t].fill;const o=[t];let r;if(!n)return s;for(;s!==!1&&o.indexOf(s)===-1;){if(!at(s))return s;if(r=e[s],!r)return!1;if(r.visible)return s;o.push(s),s=r.fill}return!1}function Eb(e,t,n){const i=Ib(e);if($(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return at(s)&&Math.floor(s)===s?Db(i[0],t,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function Db(e,t,n,i){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=i?!1:n}function Mb(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:$(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function Tb(e,t,n){let i;return e==="start"?i=n:e==="end"?i=t.options.reverse?t.min:t.max:$(e)?i=e.value:i=t.getBaseValue(),i}function Ib(e){const t=e.options,n=t.fill;let i=P(n&&n.target,n);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function Lb(e){const{scale:t,index:n,line:i}=e,s=[],o=i.segments,r=i.points,a=Ab(t,n);a.push(Sd({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)Cb(s,r[d],a)}return new Ee({points:s,options:{}})}function Ab(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const o=i[s];if(o.index===t)break;o.hidden||n.unshift(o.dataset)}return n}function Cb(e,t,n){const i=[];for(let s=0;s<n.length;s++){const o=n[s],{first:r,last:a,point:l}=Ob(o,t,"x");if(!(!l||r&&a)){if(r)i.unshift(l);else if(e.push(l),!a)break}}e.push(...i)}function Ob(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const s=i[n],o=e.segments,r=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],u=r[d.start][n],h=r[d.end][n];if(oe(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Ed{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:s,y:o,radius:r}=this;return n=n||{start:0,end:tt},t.arc(s,o,r,n.end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:s}=this,o=t.angle;return{x:n+Math.cos(o)*s,y:i+Math.sin(o)*s,angle:o}}}function Pb(e){const{chart:t,fill:n,line:i}=e;if(at(n))return Rb(t,n);if(n==="stack")return Lb(e);if(n==="shape")return!0;const s=Bb(e);return s instanceof Ed?s:Sd(s,i)}function Rb(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function Bb(e){return(e.scale||{}).getPointPositionForValue?Nb(e):Fb(e)}function Fb(e){const{scale:t={},fill:n}=e,i=Mb(n,t);if(at(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function Nb(e){const{scale:t,fill:n}=e,i=t.options,s=t.getLabels().length,o=i.reverse?t.max:t.min,r=Tb(n,t,o),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,o);return new Ed({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(r)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,r));return a}function wo(e,t,n){const i=Pb(t),{chart:s,index:o,line:r,scale:a,axis:l}=t,c=r.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(o),p=od(s,g);i&&r.points.length&&(zs(e,n),$b(e,{line:r,target:i,above:h,below:f,area:n,scale:a,axis:l,clip:p}),js(e))}function $b(e,t){const{line:n,target:i,above:s,below:o,area:r,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let d=o;o!==s&&(c==="x"?(gl(e,i,r.top),ko(e,{line:n,target:i,color:s,scale:a,property:c,clip:l}),e.restore(),e.save(),gl(e,i,r.bottom)):c==="y"&&(pl(e,i,r.left),ko(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),pl(e,i,r.right),d=s)),ko(e,{line:n,target:i,color:d,scale:a,property:c,clip:l}),e.restore()}function gl(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Us(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(d.x,n),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function pl(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[Us(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(n,d.y),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function ko(e,t){const{line:n,target:i,property:s,color:o,scale:r,clip:a}=t,l=kb(n,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=o}={}}=c,g=i!==!0;e.save(),e.fillStyle=f,Hb(e,r,a,g&&Vo(s,u,h)),e.beginPath();const p=!!n.pathSegment(e,c);let m;if(g){p?e.closePath():ml(e,i,h,s);const b=!!i.pathSegment(e,d,{move:p,reverse:!0});m=p&&b,m||ml(e,i,u,s)}e.closePath(),e.fill(m?"evenodd":"nonzero"),e.restore()}}function Hb(e,t,n,i){const s=t.chart.chartArea,{property:o,start:r,end:a}=i||{};if(o==="x"||o==="y"){let l,c,d,u;o==="x"?(l=r,c=s.top,d=a,u=s.bottom):(l=s.left,c=r,d=s.right,u=a),e.beginPath(),n&&(l=Math.max(l,n.left),d=Math.min(d,n.right),c=Math.max(c,n.top),u=Math.min(u,n.bottom)),e.rect(l,c,d-l,u-c),e.clip()}}function ml(e,t,n,i){const s=t.interpolate(n,i);s&&e.lineTo(s.x,s.y)}var zb={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,s=[];let o,r,a,l;for(r=0;r<i;++r)o=e.getDatasetMeta(r),a=o.dataset,l=null,a&&a.options&&a instanceof Ee&&(l={visible:e.isDatasetVisible(r),index:r,fill:Eb(a,r,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,s.push(l);for(r=0;r<i;++r)l=s[r],!(!l||l.fill===!1)&&(l.fill=Sb(s,r,n.propagate))},beforeDraw(e,t,n){const i=n.drawTime==="beforeDraw",s=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let r=s.length-1;r>=0;--r){const a=s[r].$filler;a&&(a.line.updateControlPoints(o,a.axis),i&&a.fill&&wo(e.ctx,a,o))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const i=e.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const o=i[s].$filler;fl(o)&&wo(e.ctx,o,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!fl(i)||n.drawTime!=="beforeDatasetDraw"||wo(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const bl=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}},jb=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class yl extends Ut{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Z(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=ut(i.font),o=s.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=bl(i,o);let c,d;n.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,a,l)+10):(d=this.maxHeight,c=this._fitCols(r,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,s){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+n/2+o.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>r)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,n,i,s){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:v}=Wb(i,n,o,m,s);b>0&&f+v+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:v},h=Math.max(h,y),f+=v+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:s},rtl:o}}=this,r=mn(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=xt(i,this.left+s,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=xt(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+s}else{let a=0,l=xt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=xt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;zs(t,this),this._draw(),js(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:s}=this,{align:o,labels:r}=t,a=st.color,l=mn(t.rtl,this.left,this.width),c=ut(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=bl(r,u),b=function(_,k,S){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const T=P(S.lineWidth,1);if(s.fillStyle=P(S.fillStyle,a),s.lineCap=P(S.lineCap,"butt"),s.lineDashOffset=P(S.lineDashOffset,0),s.lineJoin=P(S.lineJoin,"miter"),s.lineWidth=T,s.strokeStyle=P(S.strokeStyle,a),s.setLineDash(P(S.lineDash,[])),r.usePointStyle){const I={radius:p*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:T},M=l.xPlus(_,g/2),C=k+h;Yc(s,I,M,C,r.pointStyleWidth&&g)}else{const I=k+Math.max((u-p)/2,0),M=l.leftForLtr(_,g),C=Ge(S.borderRadius);s.beginPath(),Object.values(C).some(U=>U!==0)?fi(s,{x:M,y:I,w:g,h:p,radius:C}):s.rect(M,I,g,p),s.fill(),T!==0&&s.stroke()}s.restore()},y=function(_,k,S){Ze(s,S.text,_,k+m/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},v=this.isHorizontal(),w=this._computeTitleHeight();v?f={x:xt(o,this.left+d,this.right-i[0]),y:this.top+d+w,line:0}:f={x:this.left+d,y:xt(o,this.top+w+d,this.bottom-n[0].height),line:0},td(this.ctx,t.textDirection);const x=m+d;this.legendItems.forEach((_,k)=>{s.strokeStyle=_.fontColor,s.fillStyle=_.fontColor;const S=s.measureText(_.text).width,T=l.textAlign(_.textAlign||(_.textAlign=r.textAlign)),I=g+h+S;let M=f.x,C=f.y;l.setWidth(this.width),v?k>0&&M+I+d>this.right&&(C=f.y+=x,f.line++,M=f.x=xt(o,this.left+d,this.right-i[f.line])):k>0&&C+x>this.bottom&&(M=f.x=M+n[f.line].width+d,f.line++,C=f.y=xt(o,this.top+w+d,this.bottom-n[f.line].height));const U=l.x(M);if(b(U,C,_),M=lp(T,M+g+h,v?M+I:this.right,t.rtl),y(l.x(M),C,_),v)f.x+=I+d;else if(typeof _.text!="string"){const Q=c.lineHeight;f.y+=Dd(_,Q)+d}else f.y+=x}),ed(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=ut(n.font),s=kt(n.padding);if(!n.display)return;const o=mn(t.rtl,this.left,this.width),r=this.ctx,a=n.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=xt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+xt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=xt(a,u,u+h);r.textAlign=o.textAlign(_r(a)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=i.string,Ze(r,n.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,n=ut(t.font),i=kt(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,s,o;if(oe(t,this.left,this.right)&&oe(n,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(s=o[i],oe(t,s.left,s.left+s.width)&&oe(n,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const n=this.options;if(!Yb(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,o=jb(s,i);s&&!o&&Z(n.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!o&&Z(n.onHover,[t,i,this],this)}else i&&Z(n.onClick,[t,i,this],this)}}function Wb(e,t,n,i,s){const o=Vb(i,e,t,n),r=Ub(s,i,t.lineHeight);return{itemWidth:o,itemHeight:r}}function Vb(e,t,n,i){let s=e.text;return s&&typeof s!="string"&&(s=s.reduce((o,r)=>o.length>r.length?o:r)),t+n.size/2+i.measureText(s).width}function Ub(e,t,n){let i=e;return typeof t.text!="string"&&(i=Dd(t,n)),i}function Dd(e,t){const n=e.text?e.text.length:0;return t*n}function Yb(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var qb={id:"legend",_element:yl,start(e,t,n){const i=e.legend=new yl({ctx:e.ctx,options:n,chart:e});wt.configure(e,i,n),wt.addBox(e,i)},stop(e){wt.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;wt.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=kt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:r&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class Cr extends Ut{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const s=it(i.text)?i.text.length:1;this._padding=kt(i.padding);const o=s*ut(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:i,bottom:s,right:o,options:r}=this,a=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=xt(a,i,o),u=n+t,c=o-i):(r.position==="left"?(d=i+t,u=xt(a,s,n),l=V*-.5):(d=o-t,u=xt(a,n,s),l=V*.5),c=s-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=ut(n.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(o);Ze(t,n.text,0,0,i,{color:n.color,maxWidth:l,rotation:c,textAlign:_r(n.align),textBaseline:"middle",translation:[r,a]})}}function Gb(e,t){const n=new Cr({ctx:e.ctx,options:t,chart:e});wt.configure(e,n,t),wt.addBox(e,n),e.titleBlock=n}var Xb={id:"title",_element:Cr,start(e,t,n){Gb(e,n)},stop(e){const t=e.titleBlock;wt.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;wt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Ui=new WeakMap;var Kb={id:"subtitle",start(e,t,n){const i=new Cr({ctx:e.ctx,options:n,chart:e});wt.configure(e,i,n),wt.addBox(e,i),Ui.set(e,i)},stop(e){wt.removeBox(e,Ui.get(e)),Ui.delete(e)},beforeUpdate(e,t,n){const i=Ui.get(e);wt.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Un={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,o=0;for(t=0,n=e.length;t<n;++t){const a=e[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,i=t.y,s=Number.POSITIVE_INFINITY,o,r,a;for(o=0,r=e.length;o<r;++o){const l=e[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=Bo(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,i=l.y}return{x:n,y:i}}};function Yt(e,t){return t&&(it(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function ee(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function Jb(e,t){const{element:n,datasetIndex:i,index:s}=t,o=e.getDatasetMeta(i).controller,{label:r,value:a}=o.getLabelAndValue(s);return{chart:e,label:r,parsed:o.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:o.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function xl(e,t){const n=e.chart.ctx,{body:i,footer:s,title:o}=e,{boxWidth:r,boxHeight:a}=t,l=ut(t.bodyFont),c=ut(t.titleFont),d=ut(t.footerFont),u=o.length,h=s.length,f=i.length,g=kt(t.padding);let p=g.height,m=0,b=i.reduce((w,x)=>w+x.before.length+x.lines.length+x.after.length,0);if(b+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const w=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*w+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const v=function(w){m=Math.max(m,n.measureText(w).width+y)};return n.save(),n.font=c.string,X(e.title,v),n.font=l.string,X(e.beforeBody.concat(e.afterBody),v),y=t.displayColors?r+2+t.boxPadding:0,X(i,w=>{X(w.before,v),X(w.lines,v),X(w.after,v)}),y=0,n.font=d.string,X(e.footer,v),n.restore(),m+=g.width,{width:m,height:p}}function Zb(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}function Qb(e,t,n,i){const{x:s,width:o}=i,r=n.caretSize+n.caretPadding;if(e==="left"&&s+o+r>t.width||e==="right"&&s-o-r<0)return!0}function ty(e,t,n,i){const{x:s,width:o}=n,{width:r,chartArea:{left:a,right:l}}=e;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=o/2?c="left":s>=r-o/2&&(c="right"),Qb(c,e,t,n)&&(c="center"),c}function vl(e,t,n){const i=n.yAlign||t.yAlign||Zb(e,n);return{xAlign:n.xAlign||t.xAlign||ty(e,t,n,i),yAlign:i}}function ey(e,t){let{x:n,width:i}=e;return t==="right"?n-=i:t==="center"&&(n-=i/2),n}function ny(e,t,n){let{y:i,height:s}=e;return t==="top"?i+=n:t==="bottom"?i-=s+n:i-=s/2,i}function wl(e,t,n,i){const{caretSize:s,caretPadding:o,cornerRadius:r}=e,{xAlign:a,yAlign:l}=n,c=s+o,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=Ge(r);let g=ey(t,a);const p=ny(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:pt(g,0,i.width-t.width),y:pt(p,0,i.height-t.height)}}function Yi(e,t,n){const i=kt(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-i.right:e.x+i.left}function kl(e){return Yt([],ee(e))}function iy(e,t,n){return Le(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function _l(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const Md={beforeTitle:Qt,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Qt,beforeBody:Qt,beforeLabel:Qt,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return F(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Qt,afterBody:Qt,beforeFooter:Qt,footer:Qt,afterFooter:Qt};function Et(e,t,n,i){const s=e[t].call(n,i);return typeof s>"u"?Md[t].call(n,i):s}class Uo extends Ut{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&n.options.animation&&i.animations,o=new rd(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=iy(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:i}=n,s=Et(i,"beforeTitle",this,t),o=Et(i,"title",this,t),r=Et(i,"afterTitle",this,t);let a=[];return a=Yt(a,ee(s)),a=Yt(a,ee(o)),a=Yt(a,ee(r)),a}getBeforeBody(t,n){return kl(Et(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:i}=n,s=[];return X(t,o=>{const r={before:[],lines:[],after:[]},a=_l(i,o);Yt(r.before,ee(Et(a,"beforeLabel",this,o))),Yt(r.lines,Et(a,"label",this,o)),Yt(r.after,ee(Et(a,"afterLabel",this,o))),s.push(r)}),s}getAfterBody(t,n){return kl(Et(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:i}=n,s=Et(i,"beforeFooter",this,t),o=Et(i,"footer",this,t),r=Et(i,"afterFooter",this,t);let a=[];return a=Yt(a,ee(s)),a=Yt(a,ee(o)),a=Yt(a,ee(r)),a}_createItems(t){const n=this._active,i=this.chart.data,s=[],o=[],r=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(Jb(this.chart,n[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),X(a,d=>{const u=_l(t.callbacks,d);s.push(Et(u,"labelColor",this,d)),o.push(Et(u,"labelPointStyle",this,d)),r.push(Et(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=a,a}update(t,n){const i=this.options.setContext(this.getContext()),s=this._active;let o,r=[];if(!s.length)this.opacity!==0&&(o={opacity:0});else{const a=Un[i.position].call(this,s,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=xl(this,i),c=Object.assign({},a,l),d=vl(this.chart,i,c),u=wl(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,s){const o=this.getCaretPosition(t,i,s);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){const{xAlign:s,yAlign:o}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=Ge(a),{x:h,y:f}=t,{width:g,height:p}=n;let m,b,y,v,w,x;return o==="center"?(w=f+p/2,s==="left"?(m=h,b=m-r,v=w+r,x=w-r):(m=h+g,b=m+r,v=w-r,x=w+r),y=m):(s==="left"?b=h+Math.max(l,d)+r:s==="right"?b=h+g-Math.max(c,u)-r:b=this.caretX,o==="top"?(v=f,w=v-r,m=b-r,y=b+r):(v=f+p,w=v+r,m=b+r,y=b-r),x=v),{x1:m,x2:b,x3:y,y1:v,y2:w,y3:x}}drawTitle(t,n,i){const s=this.title,o=s.length;let r,a,l;if(o){const c=mn(i.rtl,this.x,this.width);for(t.x=Yi(this,i.titleAlign,i),n.textAlign=c.textAlign(i.titleAlign),n.textBaseline="middle",r=ut(i.titleFont),a=i.titleSpacing,n.fillStyle=i.titleColor,n.font=r.string,l=0;l<o;++l)n.fillText(s[l],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,l+1===o&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,n,i,s,o){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=ut(o.bodyFont),u=Yi(this,"left",o),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=n.y+f;if(o.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,No(t,p,m,b),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,No(t,p,m,b)}else{t.lineWidth=$(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=Ge(r.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,fi(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),fi(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=r.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){const{body:s}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=ut(i.bodyFont);let h=u.lineHeight,f=0;const g=mn(i.rtl,this.x,this.width),p=function(S){n.fillText(S,g.x(t.x+f),t.y+h/2),t.y+=h+o},m=g.textAlign(r);let b,y,v,w,x,_,k;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,t.x=Yi(this,m,i),n.fillStyle=i.bodyColor,X(this.beforeBody,p),f=a&&m!=="right"?r==="center"?c/2+d:c+2+d:0,w=0,_=s.length;w<_;++w){for(b=s[w],y=this.labelTextColors[w],n.fillStyle=y,X(b.before,p),v=b.lines,a&&v.length&&(this._drawColorBox(n,t,w,g,i),h=Math.max(u.lineHeight,l)),x=0,k=v.length;x<k;++x)p(v[x]),h=u.lineHeight;X(b.after,p)}f=0,h=u.lineHeight,X(this.afterBody,p),t.y-=o}drawFooter(t,n,i){const s=this.footer,o=s.length;let r,a;if(o){const l=mn(i.rtl,this.x,this.width);for(t.x=Yi(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=l.textAlign(i.footerAlign),n.textBaseline="middle",r=ut(i.footerFont),n.fillStyle=i.footerColor,n.font=r.string,a=0;a<o;++a)n.fillText(s[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,n,i,s){const{xAlign:o,yAlign:r}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=Ge(s.cornerRadius);n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.beginPath(),n.moveTo(a+u,l),r==="top"&&this.drawCaret(t,n,i,s),n.lineTo(a+c-h,l),n.quadraticCurveTo(a+c,l,a+c,l+h),r==="center"&&o==="right"&&this.drawCaret(t,n,i,s),n.lineTo(a+c,l+d-g),n.quadraticCurveTo(a+c,l+d,a+c-g,l+d),r==="bottom"&&this.drawCaret(t,n,i,s),n.lineTo(a+f,l+d),n.quadraticCurveTo(a,l+d,a,l+d-f),r==="center"&&o==="left"&&this.drawCaret(t,n,i,s),n.lineTo(a,l+u),n.quadraticCurveTo(a,l,a+u,l),n.closePath(),n.fill(),s.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,i=this.$animations,s=i&&i.x,o=i&&i.y;if(s||o){const r=Un[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=xl(this,t),l=Object.assign({},r,this._size),c=vl(n,t,l),d=wl(t,l,c,n);(s._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(n);const s={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=kt(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,s,n),td(t,n.textDirection),o.y+=r.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),ed(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),o=!Is(i,s),r=this._positionChanged(s,n);(o||r)&&(this._active=s,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,o=this._active||[],r=this._getActiveElements(t,o,n,i),a=this._positionChanged(r,t),l=n||!Is(r,o)||a;return l&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,i,s){const o=this.options;if(t.type==="mouseout")return[];if(!s)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(t,n){const{caretX:i,caretY:s,options:o}=this,r=Un[o.position].call(this,t,n);return r!==!1&&(i!==r.x||s!==r.y)}}D(Uo,"positioners",Un);var sy={id:"tooltip",_element:Uo,positioners:Un,afterInit(e,t,n){n&&(e.tooltip=new Uo({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:Md},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},oy=Object.freeze({__proto__:null,Colors:bb,Decimation:wb,Filler:zb,Legend:qb,SubTitle:Kb,Title:Xb,Tooltip:sy});const ry=(e,t,n,i)=>(typeof t=="string"?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function ay(e,t,n,i){const s=e.indexOf(t);if(s===-1)return ry(e,t,n,i);const o=e.lastIndexOf(t);return s!==o?n:s}const ly=(e,t)=>e===null?null:pt(Math.round(e),0,t);function Sl(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class Yo extends en{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:s,label:o}of n)i[s]===o&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(F(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:ay(i,t,P(n,t),this._addedLabels),ly(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,s=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=n;r++)s.push({value:r});return s}getLabelForValue(t){return Sl.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}D(Yo,"id","category"),D(Yo,"defaults",{ticks:{callback:Sl}});function cy(e,t){const n=[],{bounds:s,step:o,min:r,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=e,f=o||1,g=d-1,{min:p,max:m}=t,b=!F(r),y=!F(a),v=!F(c),w=(m-p)/(u+1);let x=xa((m-p)/g/f)*f,_,k,S,T;if(x<1e-14&&!b&&!y)return[{value:p},{value:m}];T=Math.ceil(m/x)-Math.floor(p/x),T>g&&(x=xa(T*x/g/f)*f),F(l)||(_=Math.pow(10,l),x=Math.ceil(x*_)/_),s==="ticks"?(k=Math.floor(p/x)*x,S=Math.ceil(m/x)*x):(k=p,S=m),b&&y&&o&&ep((a-r)/o,x/1e3)?(T=Math.round(Math.min((a-r)/x,d)),x=(a-r)/T,k=r,S=a):v?(k=b?r:k,S=y?a:S,T=c-1,x=(S-k)/T):(T=(S-k)/x,ii(T,Math.round(T),x/1e3)?T=Math.round(T):T=Math.ceil(T));const I=Math.max(va(x),va(k));_=Math.pow(10,F(l)?I:l),k=Math.round(k*_)/_,S=Math.round(S*_)/_;let M=0;for(b&&(h&&k!==r?(n.push({value:r}),k<r&&M++,ii(Math.round((k+M*x)*_)/_,r,El(r,w,e))&&M++):k<r&&M++);M<T;++M){const C=Math.round((k+M*x)*_)/_;if(y&&C>a)break;n.push({value:C})}return y&&h&&S!==a?n.length&&ii(n[n.length-1].value,a,El(a,w,e))?n[n.length-1].value=a:n.push({value:a}):(!y||S===a)&&n.push({value:S}),n}function El(e,t,{horizontal:n,minRotation:i}){const s=Wt(i),o=(n?Math.sin(s):Math.cos(s))||.001,r=.75*t*(""+e).length;return Math.min(t/o,r)}class Bs extends en{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return F(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:s,max:o}=this;const r=l=>s=n?s:l,a=l=>o=i?o:l;if(t){const l=Kt(s),c=Kt(o);l<0&&c<0?a(0):l>0&&c>0&&r(0)}if(s===o){let l=o===0?1:Math.abs(o*.05);a(o+l),t||r(s-l)}this.min=s,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),n=n||11),n&&(s=Math.min(n,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,r=cy(s,o);return t.bounds==="ticks"&&Fc(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-n)/Math.max(t.length-1,1)/2;n-=s,i+=s}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return Si(t,this.chart.options.locale,this.options.ticks.format)}}class qo extends Bs{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=at(t)?t:0,this.max=at(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=Wt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}D(qo,"id","linear"),D(qo,"defaults",{ticks:{callback:Hs.formatters.numeric}});const pi=e=>Math.floor(_e(e)),ze=(e,t)=>Math.pow(10,pi(e)+t);function Dl(e){return e/Math.pow(10,pi(e))===1}function Ml(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function dy(e,t){const n=t-e;let i=pi(n);for(;Ml(e,t,i)>10;)i++;for(;Ml(e,t,i)<10;)i--;return Math.min(i,pi(e))}function uy(e,{min:t,max:n}){t=Ct(e.min,t);const i=[],s=pi(t);let o=dy(t,n),r=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=s>o?Math.pow(10,s):0,c=Math.round((t-l)*r)/r,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,o)),h=Ct(e.min,Math.round((l+d+u*Math.pow(10,o))*r)/r);for(;h<n;)i.push({value:h,major:Dl(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,r=o>=0?1:r),h=Math.round((l+d+u*Math.pow(10,o))*r)/r;const f=Ct(e.max,h);return i.push({value:f,major:Dl(f),significand:u}),i}class Go extends en{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=Bs.prototype.parse.apply(this,[t,n]);if(i===0){this._zero=!0;return}return at(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=at(t)?Math.max(0,t):null,this.max=at(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!at(this._userMin)&&(this.min=t===ze(this.min,0)?ze(this.min,-1):ze(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,s=this.max;const o=a=>i=t?i:a,r=a=>s=n?s:a;i===s&&(i<=0?(o(1),r(10)):(o(ze(i,-1)),r(ze(s,1)))),i<=0&&o(ze(s,-1)),s<=0&&r(ze(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},i=uy(n,this);return t.bounds==="ticks"&&Fc(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Si(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=_e(t),this._valueRange=_e(this.max)-_e(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(_e(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}D(Go,"id","logarithmic"),D(Go,"defaults",{ticks:{callback:Hs.formatters.logarithmic,major:{enabled:!0}}});function Xo(e){const t=e.ticks;if(t.display&&e.display){const n=kt(t.backdropPadding);return P(t.font&&t.font.size,st.font.size)+n.height}return 0}function hy(e,t,n){return n=it(n)?n:[n],{w:yp(e,t.string,n),h:n.length*t.lineHeight}}function Tl(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function fy(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],o=e._pointLabels.length,r=e.options.pointLabels,a=r.centerPointLabels?V/o:0;for(let l=0;l<o;l++){const c=r.setContext(e.getPointLabelContext(l));s[l]=c.padding;const d=e.getPointPosition(l,e.drawingArea+s[l],a),u=ut(c.font),h=hy(e.ctx,u,e._pointLabels[l]);i[l]=h;const f=vt(e.getIndexAngle(l)+a),g=Math.round(wr(f)),p=Tl(g,d.x,h.w,0,180),m=Tl(g,d.y,h.h,90,270);gy(n,t,f,p,m)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=by(e,i,s)}function gy(e,t,n,i,s){const o=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/o,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/r,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/r,e.b=Math.max(e.b,t.b+l))}function py(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:o,padding:r,size:a}=n,l=e.getPointPosition(t,i+s+r,o),c=Math.round(wr(vt(l.angle+lt))),d=vy(l.y,a.h,c),u=yy(c),h=xy(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function my(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:o}=e;return!(ae({x:n,y:i},t)||ae({x:n,y:o},t)||ae({x:s,y:i},t)||ae({x:s,y:o},t))}function by(e,t,n){const i=[],s=e._pointLabels.length,o=e.options,{centerPointLabels:r,display:a}=o.pointLabels,l={extra:Xo(o)/2,additionalAngle:r?V/s:0};let c;for(let d=0;d<s;d++){l.padding=n[d],l.size=t[d];const u=py(e,d,l);i.push(u),a==="auto"&&(u.visible=my(u,c),u.visible&&(c=u))}return i}function yy(e){return e===0||e===180?"center":e<180?"left":"right"}function xy(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function vy(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function wy(e,t,n){const{left:i,top:s,right:o,bottom:r}=n,{backdropColor:a}=t;if(!F(a)){const l=Ge(t.borderRadius),c=kt(t.backdropPadding);e.fillStyle=a;const d=i-c.left,u=s-c.top,h=o-i+c.width,f=r-s+c.height;Object.values(l).some(g=>g!==0)?(e.beginPath(),fi(e,{x:d,y:u,w:h,h:f,radius:l}),e.fill()):e.fillRect(d,u,h,f)}}function ky(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const o=e._pointLabelItems[s];if(!o.visible)continue;const r=i.setContext(e.getPointLabelContext(s));wy(n,r,o);const a=ut(r.font),{x:l,y:c,textAlign:d}=o;Ze(n,e._pointLabels[s],l,c+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function Td(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,tt);else{let o=e.getPointPosition(0,t);s.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=e.getPointPosition(r,t),s.lineTo(o.x,o.y)}}function _y(e,t,n,i,s){const o=e.ctx,r=t.circular,{color:a,lineWidth:l}=t;!r&&!i||!a||!l||n<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(s.dash||[]),o.lineDashOffset=s.dashOffset,o.beginPath(),Td(e,n,r,i),o.closePath(),o.stroke(),o.restore())}function Sy(e,t,n){return Le(e,{label:n,index:t,type:"pointLabel"})}class Yn extends Bs{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=kt(Xo(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=at(t)&&!isNaN(t)?t:0,this.max=at(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Xo(this.options))}generateTickLabels(t){Bs.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const s=Z(this.options.pointLabels.callback,[n,i],this);return s||s===0?s:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?fy(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,s){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,s))}getIndexAngle(t){const n=tt/(this._pointLabels.length||1),i=this.options.startAngle||0;return vt(t*n+Wt(i))}getDistanceFromCenterForValue(t){if(F(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(F(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return Sy(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const s=this.getIndexAngle(t)-lt+i;return{x:Math.cos(s)*n+this.xCenter,y:Math.sin(s)*n+this.yCenter,angle:s}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:s,bottom:o}=this._pointLabelItems[t];return{left:n,top:i,right:s,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),Td(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:s,border:o}=n,r=this._pointLabels.length;let a,l,c;if(n.pointLabels.display&&ky(this,r),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=o.setContext(h);_y(this,f,l,r,g)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let o,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const c=i.setContext(this.getContext(l)),d=ut(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=kt(c.backdropPadding);t.fillRect(-r/2-u.left,-o-d.size/2-u.top,r+u.width,d.size+u.height)}Ze(t,a.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}D(Yn,"id","radialLinear"),D(Yn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Hs.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),D(Yn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),D(Yn,"descriptors",{angleLines:{_fallback:"grid"}});const Ys={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},It=Object.keys(Ys);function Il(e,t){return e-t}function Ll(e,t){if(F(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:o}=e._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),at(r)||(r=typeof i=="string"?n.parse(r,i):n.parse(r)),r===null?null:(s&&(r=s==="week"&&(yn(o)||o===!0)?n.startOf(r,"isoWeek",o):n.startOf(r,s)),+r)}function Al(e,t,n,i){const s=It.length;for(let o=It.indexOf(e);o<s-1;++o){const r=Ys[It[o]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-t)/(a*r.size))<=i)return It[o]}return It[s-1]}function Ey(e,t,n,i,s){for(let o=It.length-1;o>=It.indexOf(n);o--){const r=It[o];if(Ys[r].common&&e._adapter.diff(s,i,r)>=t-1)return r}return It[n?It.indexOf(n):0]}function Dy(e){for(let t=It.indexOf(e)+1,n=It.length;t<n;++t)if(Ys[It[t]].common)return It[t]}function Cl(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:i,hi:s}=kr(n,t),o=n[i]>=t?n[i]:n[s];e[o]=!0}}function My(e,t,n,i){const s=e._adapter,o=+s.startOf(t[0].value,i),r=t[t.length-1].value;let a,l;for(a=o;a<=r;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}function Ol(e,t,n){const i=[],s={},o=t.length;let r,a;for(r=0;r<o;++r)a=t[r],s[a]=r,i.push({value:a,major:!1});return o===0||!n?i:My(e,i,s,n)}class mi extends en{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const i=t.time||(t.time={}),s=this._adapter=new Rm._date(t.adapters.date);s.init(n),ni(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Ll(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,i=t.time.unit||"day";let{min:s,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=at(s)&&!isNaN(s)?s:+n.startOf(Date.now(),i),o=at(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(s,o-1),this.max=Math.max(s+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){const t=this.options,n=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const o=this.min,r=this.max,a=op(s,o,r);return this._unit=n.unit||(i.autoSkip?Al(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):Ey(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:Dy(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Ol(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,s,o;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?n=1-s:n=(this.getDecimalForValue(t[1])-s)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=pt(n,0,r),i=pt(i,0,r),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){const t=this._adapter,n=this.min,i=this.max,s=this.options,o=s.time,r=o.unit||Al(o.minUnit,n,i,this._getLabelCapacity(n)),a=P(s.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=yn(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":r),t.diff(i,n,r)>1e5*a)throw new Error(n+" and "+i+" are too far apart with stepSize of "+a+" "+r);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,r),f++)Cl(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Cl(d,h,g),Object.keys(d).sort(Il).map(p=>+p)}getLabelForValue(t){const n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){const s=this.options.time.displayFormats,o=this._unit,r=n||s[o];return this._adapter.format(t,r)}_tickFormatFunction(t,n,i,s){const o=this.options,r=o.ticks.callback;if(r)return Z(r,[t,n,i],this);const a=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[n],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let n,i,s;for(n=0,i=t.length;n<i;++n)s=t[n],s.label=this._tickFormatFunction(s.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,i=this.ctx.measureText(t).width,s=Wt(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(s),r=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*o+a*r,h:i*r+a*o}}_getLabelCapacity(t){const n=this.options.time,i=n.displayFormats,s=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,Ol(this,[t],this._majorUnit),s),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(n=0,i=s.length;n<i;++n)t=t.concat(s[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,i;if(t.length)return t;const s=this.getLabels();for(n=0,i=s.length;n<i;++n)t.push(Ll(this,s[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Hc(t.sort(Il))}}D(mi,"id","time"),D(mi,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function qi(e,t,n){let i=0,s=e.length-1,o,r,a,l;n?(t>=e[i].pos&&t<=e[s].pos&&({lo:i,hi:s}=re(e,"pos",t)),{pos:o,time:a}=e[i],{pos:r,time:l}=e[s]):(t>=e[i].time&&t<=e[s].time&&({lo:i,hi:s}=re(e,"time",t)),{time:o,pos:a}=e[i],{time:r,pos:l}=e[s]);const c=r-o;return c?a+(l-a)*(t-o)/c:a}class Ko extends mi{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=qi(n,this.min),this._tableRange=qi(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,s=[],o=[];let r,a,l,c,d;for(r=0,a=t.length;r<a;++r)c=t[r],c>=n&&c<=i&&s.push(c);if(s.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(r=0,a=s.length;r<a;++r)d=s[r+1],l=s[r-1],c=s[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(a-1)});return o}_generate(){const t=this.min,n=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(n)||i.length===1)&&i.push(n),i.sort((s,o)=>s-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return n.length&&i.length?t=this.normalize(n.concat(i)):t=n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(qi(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return qi(this._table,i*this._tableRange+this._minPos,!0)}}D(Ko,"id","timeseries"),D(Ko,"defaults",mi.defaults);var Ty=Object.freeze({__proto__:null,CategoryScale:Yo,LinearScale:qo,LogarithmicScale:Go,RadialLinearScale:Yn,TimeScale:mi,TimeSeriesScale:Ko});const Iy=[Pm,db,oy,Ty];se.register(...Iy);function qs(e,t=""){return`
        <div class="${q.CARD.GLASS} ${t}">
            ${e}
        </div>
    `}const le={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function bi(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,n=>t[n])}function Ly(e,t,n,i){return qs(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${bi(e)}</span>
        <span id="${n}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${bi(t)}</span>
    `,le.CLASSES.KPI_CARD)}function Id(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${le.KPI_ITEMS.map(e=>Ly(e.label,"-",e.id,e.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${le.CHARTS.map(e=>qs(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${e.dot}"></span> ${bi(e.label)}
                    </h3>
                    <div class="${le.CLASSES.CHART_CONTAINER}">
                        <canvas id="${e.id}Chart"></canvas>
                    </div>
                `,`${le.CLASSES.CHART_CARD} ${e.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function Ay(e=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label for="page-search-input" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label for="page-search-project" class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(e)?e:[]).map(s=>`<option value="${bi(s.id)}">${bi(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${qs(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function Cy(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function Oy(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Pl=new WeakMap;function Py(e){const t=document.getElementById("dashboard-view");if(!e||!t)return;t.innerHTML=Id();const n=e.filter(s=>s.status==="completed"&&s.completedAt);Ry(n),[{id:"daily",color:le.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:le.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:le.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:o,data:r}=By(n,s.count,s.unit);Fy(s.id,o,r,s.color)})}function Ry(e){const t=new Date,n=ce(t).getTime(),i=Kl(t).getTime(),s=$u(t).getTime(),o=e.reduce((r,a)=>{const l=ge(a.completedAt);if(!l)return r;const c=l.getTime();return c>=n&&r.today++,c>=i&&r.weekly++,c>=s&&r.monthly++,r},{today:0,weekly:0,monthly:0,total:e.length});Object.entries(o).forEach(([r,a])=>{const l=document.getElementById(`${r}-count`);l&&(l.textContent=a)})}function By(e,t,n){const i=[],s=[],o=new Date;for(let r=0;r<t;r++){let a,l,c;const d=new Date(o);n==="day"?(d.setDate(o.getDate()-(t-1-r)),a=ce(d),l=Nu(d),c=`${a.getMonth()+1}/${a.getDate()}`):n==="week"?(d.setDate(o.getDate()-(t-1-r)*7),a=Kl(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(o.getFullYear(),o.getMonth()-(t-1-r),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=e.filter(h=>{const f=ge(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function Fy(e,t,n,i){const s=document.getElementById(`${e}Chart`);if(!s)return;let o=Pl.get(s);o?(o.data.labels=t,o.data.datasets[0].data=n,o.update()):(o=new se(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:n,backgroundColor:i,borderRadius:4}]},options:le.CHART_DEFAULTS}),Pl.set(s,o))}const Ft={isSelectionMode:!1,selectedIds:new Set},Jo=new Set;function Ny(e){return Jo.add(e),()=>Jo.delete(e)}function Ld(){Jo.forEach(e=>e({isSelectionMode:Ft.isSelectionMode,selectedIds:Ft.selectedIds}))}function Rl(e){Ft.isSelectionMode=e,e||Ft.selectedIds.clear(),Ld()}function _o(e){Ft.selectedIds.has(e)?Ft.selectedIds.delete(e):Ft.selectedIds.add(e),Ld()}function Ad(e,t,n){var b,y,v,w,x,_,k,S,T,I;(b=document.getElementById("task-context-menu"))==null||b.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[200px] font-sans user-select-none text-gray-700 dark:text-gray-200",i.style.left=`${t}px`,i.style.top=`${n}px`;const s=M=>{i.remove(),M&&M()},o=Ft.isSelectionMode,r=e&&Ft.selectedIds.has(e.id),a=Ft.selectedIds.size,l=o&&r&&a>0,c=!!e||l,d="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition flex items-center justify-between group relative",u="opacity-50 cursor-not-allowed hover:bg-transparent dark:hover:bg-transparent",h='<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"></path></svg>';let f="";f+=`
        <div class="${d} ${c?"":u}">
            <span>日付変更</span>
            ${h}
            ${c?`
            <div class="absolute left-full top-0 ml-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 hidden group-hover:block min-w-[120px]">
                <button id="ctx-date-today" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">今日</button>
                <button id="ctx-date-tomorrow" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">明日</button>
                <button id="ctx-date-next-week" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">来週</button>
            </div>
            `:""}
        </div>
    `,f+=`
        <button id="ctx-delete" class="${d} ${c?"":u} text-red-600 dark:text-red-400">
            <span>削除</span>
        </button>
    `,f+='<div class="border-t border-gray-100 dark:border-gray-700 my-1"></div>',f+=`
        <button id="ctx-add-task" class="${d}">
            <span>タスク追加</span>
        </button>
    `,f+=`
        <div class="${d}">
            <span>並び替え</span>
            ${h}
            <div class="absolute left-full top-0 ml-1 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 hidden group-hover:block min-w-[120px]">
                <button id="ctx-sort-name" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">名前順</button>
                <button id="ctx-sort-date" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">日付順</button>
                <button id="ctx-sort-created" class="w-full text-left px-4 py-2 hover:bg-gray-100 dark:hover:bg-gray-700">作成日順</button>
            </div>
        </div>
    `,f+=`
        <button id="ctx-multi-select" class="${d}">
            <span class="flex items-center">
                複数選択
                ${o?'<svg class="w-4 h-4 ml-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>':""}
            </span>
        </button>
    `,i.innerHTML=f,document.body.appendChild(i);const g=()=>l?Array.from(Ft.selectedIds):e?[e.id]:[],p=async M=>{const C=g();C.length!==0&&s(async()=>{const U=C.map(Q=>ar(Q,M));await Promise.all(U)})};c&&((y=i.querySelector("#ctx-date-today"))==null||y.addEventListener("click",()=>{p({dueDate:ce(new Date)})}),(v=i.querySelector("#ctx-date-tomorrow"))==null||v.addEventListener("click",()=>{const M=ce(new Date);M.setDate(M.getDate()+1),p({dueDate:M})}),(w=i.querySelector("#ctx-date-next-week"))==null||w.addEventListener("click",()=>{const M=ce(new Date);M.setDate(M.getDate()+(8-M.getDay())),p({dueDate:M})}),(x=i.querySelector("#ctx-delete"))==null||x.addEventListener("click",()=>{const M=g(),C=M.length>1?`${M.length}件のタスクを削除しますか？`:"削除しますか？";s(()=>{R(C,async()=>{const U=M.map(Q=>Zl(Q));await Promise.all(U),l&&Rl(!1)})})})),(_=i.querySelector("#ctx-add-task"))==null||_.addEventListener("click",()=>{s(()=>{const M=document.getElementById("task-input-fld");M&&M.focus()})}),(k=i.querySelector("#ctx-sort-name"))==null||k.addEventListener("click",()=>s(()=>So("title_asc"))),(S=i.querySelector("#ctx-sort-date"))==null||S.addEventListener("click",()=>s(()=>So("dueDate_asc"))),(T=i.querySelector("#ctx-sort-created"))==null||T.addEventListener("click",()=>s(()=>So("createdAt_desc"))),(I=i.querySelector("#ctx-multi-select"))==null||I.addEventListener("click",()=>{s(()=>{Rl(!o)})});const m=M=>{i.contains(M.target)||(i.remove(),document.removeEventListener("click",m))};setTimeout(()=>document.addEventListener("click",m),0)}function So(e){const t=document.querySelectorAll(".sort-option"),n=Array.from(t).find(i=>i.dataset.value===e);if(n)n.click();else{const i=document.getElementById("sort-trigger");i&&(i.dataset.value=e,Ke())}}function $y(e,t,n={isSelectionMode:!1,selectedIds:new Set},i={}){const{isSelectionMode:s,selectedIds:o}=n,r=o.has(e.id),a=document.createElement("li");a.setAttribute("data-id",e.id);const l=i.duration!==null&&i.duration!==void 0;a.setAttribute("draggable",s||l?"false":"true");const c=e.status==="completed",d=Hu(e.dueDate),u=zu(e.dueDate),h=!!e.recurrence,f=!!e.dueDate&&!h,g=ue(),p=e.timeBlockId?g.find(k=>k.id===e.timeBlockId):null,m=i.timeBlockId===null||i.timeBlockId===void 0,b=i.duration===null||i.duration===void 0;let y="group flex items-start gap-2 sm:gap-3 py-1.5 px-2 rounded -mx-2 transition-all duration-200 border border-transparent",v="";s?r?v="bg-blue-50 dark:bg-blue-900/30 border-blue-200 dark:border-blue-800 cursor-pointer":v="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-pointer":c?v="opacity-60 bg-gray-50 dark:bg-gray-900/50 cursor-grab active:cursor-grabbing":v="hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700 cursor-grab active:cursor-grabbing",a.className=`${y} ${v}`;let w="",x="";return s?(w=r?"bg-blue-600 border-blue-600 text-white":"border-gray-300 dark:border-gray-600 bg-white dark:bg-transparent hover:border-blue-500",x='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>',r||(w+=" text-transparent")):(w=c?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500 cursor-pointer",x='<svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>'),a.innerHTML=`
        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 ${w}">
            ${x}
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center pointer-events-none">
            <div class="col-span-1 sm:col-span-8 flex flex-wrap sm:flex-nowrap items-baseline gap-x-2 gap-y-0.5 pointer-events-auto min-w-0 pr-1">
                <div class="leading-snug truncate font-medium transition-colors ${c&&!s?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"} flex-shrink-0 max-w-full">${e.title}</div>
                ${e.description?`<div class="text-xs text-gray-400 font-light truncate max-w-[180px] sm:max-w-[240px]">${cc(e.description.split(`
`)[0]).replace(/<\/?p[^>]*>/g,"")}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-4 flex items-center sm:justify-end gap-1.5 text-xs h-full mt-1 sm:mt-0 overflow-hidden pointer-events-auto">
                ${h?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${f?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${m?`<div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${p?`${p.start} - ${p.end}`:"時間帯未定"}">
                    <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${p?p.color:"#cbd5e1"}"></span>
                    <span class="truncate font-mono text-[11px]">${p?`${p.start} - ${p.end}`:"未定"}</span>
                </div>`:""}

                ${b?`<div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${e.duration||0}分">
                    <span class="mr-0.5 text-[10px]">⏱️</span>${e.duration||0}m
                </div>`:""}

                ${d?`<div class="flex items-center ${u} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${d}</div>`:""}
            </div>
        </div>
    `,!s&&!l&&(a.addEventListener("dragstart",k=>{if(k.target.closest(".task-checkbox")){k.preventDefault();return}a.classList.add("opacity-50"),k.dataTransfer.setData("text/plain",e.id),k.dataTransfer.setData("application/x-taskmg-id",e.id),k.dataTransfer.effectAllowed="move"}),a.addEventListener("dragend",()=>a.classList.remove("opacity-50"))),a.querySelector(".task-checkbox").addEventListener("click",async k=>{k.stopPropagation(),s?_o(e.id):await Uu(e.id,c?"todo":"completed")}),a.addEventListener("click",k=>{k.target.closest(".task-checkbox")||(s?_o(e.id):tf(e))}),a.addEventListener("contextmenu",k=>{k.preventDefault(),k.stopPropagation(),s&&!r&&_o(e.id),Ad(e,k.clientX,k.clientY)}),a}function Cd(e,t,n,i={isSelectionMode:!1,selectedIds:new Set},s={}){if(!e)return;const o=document.createElement("ul");if(o.id="task-list-ul",o.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2 min-h-[50px]",o.addEventListener("contextmenu",r=>{(r.target===o||r.target.closest("li")===null)&&(r.preventDefault(),Ad(null,r.clientX,r.clientY))}),!t||t.length===0)o.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none select-none">
                タスクがありません
                <div class="text-xs mt-2 opacity-70">右クリックでタスク追加・並び替え</div>
            </li>
        `;else{const r=document.createDocumentFragment();t.forEach(a=>{r.appendChild($y(a,n,i,s))}),o.appendChild(r)}e.innerHTML="",e.appendChild(o)}function Or(e,t,n,i={}){if(!(i.forceExpand||e.dataset.expanded==="true")){e.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,e.querySelector("#show-input-btn").onclick=()=>{e.dataset.expanded="true",Or(e,t,n,i)};return}const o=ue().map(a=>`<option value="${a.id}">${a.start} - ${a.end}</option>`).join(""),r=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="${q.INPUT.MINIMAL_TEXT}">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="${q.INPUT.MINIMAL_TEXTAREA}"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="${q.SELECT.TRANSPARENT}">
                    <option value="">時間帯 (未定)</option>
                    ${o}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="${q.BUTTON.CANCEL}">キャンセル</button>
                    <button id="submit-task-btn" class="${q.BUTTON.DANGER}">タスクを追加</button>
                </div>
            </div>
        </div>
    `;e.innerHTML=qs(r,"p-3 animate-fade-in-down"),zy(e,t,n,i)}function Hy(e,t,n,i){e.innerHTML=`
        <div id="fixed-add-task-btn" class="w-full h-full flex items-center px-4 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-800 transition-colors group">
            <div class="w-6 h-6 mr-3 rounded-full text-red-500 bg-red-50 dark:bg-red-900/20 flex items-center justify-center transition-transform group-hover:scale-110 shadow-sm">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
            </div>
            <span class="text-sm font-medium text-gray-600 dark:text-gray-300">タスクを追加</span>
        </div>
    `,e.querySelector("#fixed-add-task-btn").onclick=()=>{e.classList.add("hidden"),t.innerHTML="",t.classList.remove("hidden"),Or(t,n,i,{forceExpand:!0,onClose:()=>{t.innerHTML="",t.classList.add("hidden"),e.classList.remove("hidden")}}),setTimeout(()=>{t.scrollIntoView({behavior:"smooth",block:"center"})},100)}}function zy(e,t,n,i={}){const s=e.querySelector("#inline-title-input"),o=e.querySelector("#submit-task-btn"),r=e.querySelector("#cancel-input-btn"),a=e.querySelector("#inline-desc-input"),l=e.querySelector("#inline-timeblock-select");s.focus();const c=()=>{e.dataset.expanded="false",i.onClose?i.onClose():Or(e,t,n)};r.onclick=c;const d=async()=>{const u=s.value.trim();u&&(o.disabled=!0,await jy({title:u,description:a.value.trim(),projectId:t,labelIds:n?[n]:[],timeBlockId:l.value||null}),s.value="",a.value="",s.focus(),o.disabled=!1)};o.onclick=d,s.onkeydown=u=>{u.key==="Enter"&&!u.isComposing&&d()}}async function jy(e){try{await Vu(e)}catch(t){console.error(t),R({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function Wy(e,t="createdAt_desc"){return Array.isArray(e)?[...e].sort((n,i)=>{switch(t){case"createdAt_asc":return Eo(n.createdAt,i.createdAt);case"createdAt_desc":return Eo(i.createdAt,n.createdAt);case"dueDate_asc":return Gi(n.dueDate,i.dueDate,(s,o)=>Eo(s,o));case"timeBlockId_asc":return Gi(n.timeBlockId,i.timeBlockId,(s,o)=>String(s).localeCompare(String(o)));case"projectId_asc":return Gi(n.projectId,i.projectId,(s,o)=>String(s).localeCompare(String(o)));case"duration_asc":return Gi(n.duration,i.duration,(s,o)=>Number(s)-Number(o));case"title_asc":return(n.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function Eo(e,t){const n=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return n(e)-n(t)}function Gi(e,t,n){return e===t?0:e==null||e==="null"?1:t==null||t==="null"?-1:n(e,t)}function Vy(e,t,n){e.innerHTML="";const i=n?nc(n):null,s=t.reduce((l,c)=>{const d=parseInt(c.duration,10);return l+(isNaN(d)?0:d)},0),o=l=>(l/60).toFixed(2)+"h";let r="";if(i&&i.start&&i.end){const l=Uy(i.start,i.end);if(l<=0)return;const c=(l/60).toFixed(2),d=(s/60).toFixed(2),u=Math.min(s/l*100,100),h=s/l*100,f=l-s,g=f<0,m=(Math.abs(f)/60).toFixed(2),b=h>100,y=b?q.PROGRESS_BAR.OVER:q.PROGRESS_BAR.FILLED,v=b?"100%":`${u}%`,w=g?"text-red-500":"text-green-500",x=g?"超過":"残り";r=`
            <div class="mt-2 mb-2 py-2 px-4 bg-gray-50/80 dark:bg-[#1e1e1e]/50 rounded-lg flex items-center gap-4 text-sm border border-gray-100 dark:border-gray-800/50 backdrop-blur-sm">
                <!-- 1. 時間帯名 (左端) -->
                <div class="flex-shrink-0 w-24 truncate text-xs font-bold text-gray-500 dark:text-gray-400" title="${i.name}">
                    ${i.name}
                </div>

                <!-- 2. 進捗時間 (中央左) -->
                <div class="flex-shrink-0 text-xs text-gray-500 dark:text-gray-400 tabular-nums">
                    <span class="font-bold text-gray-700 dark:text-gray-300 w-[4.5ch] text-right inline-block">${d}h</span>
                    <span class="text-gray-400 mx-0.5">/</span>
                    <span class="w-[4.5ch] inline-block">${c}h</span>
                </div>

                <!-- 3. プログレスバー (可変幅) -->
                <div class="${q.PROGRESS_BAR.CONTAINER}">
                     <div class="${y}" style="width: ${v}"></div>
                </div>

                <!-- 4. 詳細情報 (右端) -->
                <div class="flex-shrink-0 flex items-center justify-end gap-3 min-w-[140px]">
                    <div class="text-lg font-bold ${b?"text-red-500":"text-blue-500"} tabular-nums text-right w-[3.5ch]">
                        ${Math.round(h)}<span class="text-xs font-normal opacity-70">%</span>
                    </div>
                    <div class="text-xs ${w} whitespace-nowrap text-right w-[100px]">
                        (${x} ${m}h)
                    </div>
                </div>
            </div>
        `}else{const l=t.length,c=l>0?s/l:0,d=o(s),u=o(c);r=`
            <div class="${q.STATS_BAR.CONTAINER}">
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">COUNT</span>
                    <span class="${q.STATS_BAR.VALUE}">${l}<span class="text-xs font-normal ml-0.5 text-gray-400">件</span></span>
                </div>
                <div class="w-px h-4 bg-gray-200 dark:bg-gray-700"></div>
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">TOTAL</span>
                    <span class="${q.STATS_BAR.VALUE} ${q.STATS_BAR.HIGHLIGHT}">${d}</span>
                </div>
                <div class="w-px h-4 bg-gray-200 dark:bg-gray-700"></div>
                <div class="${q.STATS_BAR.ITEM}">
                    <span class="${q.STATS_BAR.LABEL}">AVG</span>
                    <span class="font-medium text-sm">${u}<span class="text-xs ml-0.5">/件</span></span>
                </div>
            </div>
        `}const a=document.createElement("div");a.innerHTML=r,e.appendChild(a)}function Uy(e,t){const[n,i]=e.split(":").map(Number),[s,o]=t.split(":").map(Number);let r=n*60+i,a=s*60+o;return a<r&&(a+=1440),a-r}let fe=null;document.addEventListener("request-sort-change",e=>{const{sort:t}=e.detail,n=document.getElementById("sort-select");n&&(n.value=t);const i=document.getElementById("sort-trigger");if(i){i.dataset.value=t;const s=document.getElementById("sort-label");s&&(t==="title_asc"&&(s.textContent="名前順"),t==="dueDate_asc"&&(s.textContent="日付順"))}fe&&Ei(...fe)});Ny(()=>{fe&&Ei(...fe)});window.addEventListener("visible-task-count-updated",()=>{fe&&Ei(...fe)});window.addEventListener("sidebar-settings-updated",()=>{fe&&Ei(...fe)});function Ei(e,t,n=[],i={}){const{projectId:s=null,labelId:o=null,timeBlockId:r=null,title:a=""}=i;fe=[e,t,n,i];const l=document.getElementById("task-view");if(!l)return;Yy(e.length,a);const c=document.getElementById("sort-select"),d=document.getElementById("sort-trigger");let u="createdAt_desc";c?u=c.value:d&&d.dataset.value&&(u=d.dataset.value);const h=Wy(e,u);l.innerHTML="",l.className="flex flex-col h-full bg-transparent overflow-hidden";const f=document.createElement("div");f.className="w-full px-4 sm:px-6 h-full flex flex-col pt-2",l.appendChild(f);const g=document.createElement("div");g.id="task-list-container";const p=localStorage.getItem("visible_task_count"),m=p?Number(p):10,b=localStorage.getItem(B.STORAGE_KEYS.DENSITY)||"normal",v={compact:42,normal:52,comfortable:64,spacious:76}[b]||52,w=m*v;g.style.height=`${w}px`,g.className="w-full flex-none overflow-y-auto custom-scrollbar pr-2 mb-2 scroll-smooth border-b border-gray-100 dark:border-gray-800",f.appendChild(g),Cd(g,h,t,Ft,i);const x=document.createElement("div");x.id="stats-container",x.className="flex-none mb-0 animate-fade-in transition-all duration-300 mt-auto",f.appendChild(x),Vy(x,e,r)}function Yy(e,t){const n=document.getElementById("header-title"),i=document.getElementById("header-count");n&&(n.textContent=t||"インボックス"),i&&(i.textContent=`${e}件`)}let Bt={};function qy(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Gy(e){Bt={input:e.querySelector("#page-search-input"),select:e.querySelector("#page-search-project"),results:e.querySelector("#search-results-container")}}function Xy(e,t,n,i,s){var r;if(We(e,t),e.innerHTML=Ay(i),Gy(e),!Bt.input||!Bt.results)return;const o=qy(()=>Bl(n),300);Bt.input.addEventListener("input",o),(r=Bt.select)==null||r.addEventListener("change",()=>Bl(n)),Ac({type:"search"}),Lc(),requestAnimationFrame(()=>Bt.input.focus())}function Bl(e){var s;const t=Bt.input.value.trim().toLowerCase(),n=((s=Bt.select)==null?void 0:s.value)||null;if(!t){Bt.results.innerHTML=Cy();return}const i=Ts(e,{keyword:t,projectId:n,showCompleted:!0});i.length===0?Bt.results.innerHTML=Oy():(Bt.results.innerHTML="",Cd(Bt.results,i))}function Ky(e){e&&(e.innerHTML=`
        <div class="max-w-4xl mx-auto py-8">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">目標設計ウィザード</h2>
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-lg border border-gray-100 dark:border-gray-700 overflow-hidden">
                <div class="p-8">
                    <div class="flex items-center justify-between mb-8">
                        <div class="flex items-center space-x-4">
                            <div class="w-8 h-8 rounded-full bg-blue-600 text-white flex items-center justify-center font-bold">1</div>
                            <div class="text-sm font-medium text-gray-500">Vision</div>
                            <div class="w-8 h-1 bg-gray-200 dark:bg-gray-700"></div>
                            <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-500 flex items-center justify-center font-bold">2</div>
                             <div class="text-sm font-medium text-gray-500">Strategy</div>
                             <div class="w-8 h-1 bg-gray-200 dark:bg-gray-700"></div>
                             <div class="w-8 h-8 rounded-full bg-gray-200 dark:bg-gray-700 text-gray-500 flex items-center justify-center font-bold">3</div>
                             <div class="text-sm font-medium text-gray-500">Action</div>
                        </div>
                    </div>
                
                    <div class="text-center py-12 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-dashed border-gray-300 dark:border-gray-600">
                        <svg class="mx-auto h-12 w-12 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"></path></svg>
                        <h3 class="mt-2 text-sm font-medium text-gray-900 dark:text-gray-100">目標設定プロセスを開始</h3>
                        <p class="mt-1 text-sm text-gray-500">Backwards Designアプローチで、ゴールから逆算してタスクを生成します。</p>
                        <div class="mt-6">
                            <button type="button" class="inline-flex items-center px-4 py-2 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                開始する
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `)}function Jy(e){e&&(e.innerHTML=`
        <div class="max-w-6xl mx-auto">
            <h2 class="text-3xl font-bold mb-2 text-gray-900 dark:text-white">Target Insight</h2>
            <p class="mb-8 text-gray-500 dark:text-gray-400">厳選した重要目標の戦略的進捗と分析</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <!-- Goal 1 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Project A: Launch</h3>
                        <span class="px-2 py-1 bg-blue-100 dark:bg-blue-900/30 text-blue-600 dark:text-blue-300 text-xs rounded-full">On Track</span>
                    </div>
                    <div class="space-y-4">
                        <div>
                            <div class="text-xs text-gray-500 mb-1">Backup Design Timeline</div>
                            <div class="h-24 bg-gray-50 dark:bg-gray-700/50 rounded-lg flex items-center justify-center text-gray-400 text-xs border border-dashed border-gray-200 dark:border-gray-600">
                                Gantt Chart Visualization
                            </div>
                        </div>
                        <div>
                            <div class="text-xs text-gray-500 mb-1">Progress</div>
                            <div class="w-full bg-gray-200 dark:bg-gray-700 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: 65%"></div>
                            </div>
                            <div class="text-right text-xs text-gray-400 mt-1">65%</div>
                        </div>
                    </div>
                </div>

                <!-- Goal 2 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                     <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Skill Acquisition</h3>
                        <span class="px-2 py-1 bg-yellow-100 dark:bg-yellow-900/30 text-yellow-600 dark:text-yellow-300 text-xs rounded-full">At Risk</span>
                    </div>
                     <div class="space-y-4">
                        <div>
                            <div class="text-xs text-gray-500 mb-1">WOOP Analysis</div>
                             <div class="p-3 bg-yellow-50 dark:bg-yellow-900/10 rounded text-sm text-gray-600 dark:text-gray-300 border border-yellow-100 dark:border-yellow-900/20">
                                <span class="font-bold text-yellow-700 dark:text-yellow-500">Obstacle:</span> 時間不足<br>
                                <span class="font-bold text-green-700 dark:text-green-500">Plan:</span> 朝6時に起きて30分確保
                            </div>
                        </div>
                    </div>
                </div>

                 <!-- Goal 3 -->
                <div class="p-6 bg-white dark:bg-gray-800 rounded-xl shadow-sm border border-gray-100 dark:border-gray-700">
                     <div class="flex items-center justify-between mb-4">
                        <h3 class="font-bold text-lg text-gray-800 dark:text-gray-100">Network Growth</h3>
                        <span class="px-2 py-1 bg-green-100 dark:bg-green-900/30 text-green-600 dark:text-green-300 text-xs rounded-full">Completed</span>
                    </div>
                     <div class="space-y-4">
                        <div class="text-center py-6">
                            <div class="text-4xl font-bold text-gray-900 dark:text-white mb-1">120<span class="text-lg text-gray-400 font-normal">/100</span></div>
                            <div class="text-sm text-gray-500">Key Results Achieved</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `)}function Zy(e){e&&(e.innerHTML=`
        <div class="max-w-4xl mx-auto py-6">
            <h2 class="text-3xl font-bold mb-6 text-gray-900 dark:text-white">Framework Wiki</h2>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-blue-600 dark:text-blue-400">GTD (Getting Things Done)</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                        「頭の中を空っぽにする」ストレスフリーの仕事術。全ての気になることを収集し、処理し、整理するプロセス。
                    </p>
                    <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                        <li>Capture (収集)</li>
                        <li>Clarify (明確化)</li>
                        <li>Organize (整理)</li>
                        <li>Reflect (見直し)</li>
                        <li>Engage (実行)</li>
                    </ul>
                </div>

                <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-green-600 dark:text-green-400">WOOP</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                        願望を実現するためのメンタル・コントラスティング戦略。
                    </p>
                    <ul class="list-disc list-inside text-sm text-gray-500 space-y-1">
                        <li>Wish (願い)</li>
                        <li>Outcome (結果)</li>
                        <li>Obstacle (障害)</li>
                        <li>Plan (計画) - If/Thenプランニング</li>
                    </ul>
                </div>
                 <div class="bg-white dark:bg-gray-800 p-6 rounded-lg shadow border border-gray-100 dark:border-gray-700">
                    <h3 class="text-xl font-bold mb-2 text-purple-600 dark:text-purple-400">OKR</h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm mb-4">
                         Objectives and Key Results. 野心的な目標と測定可能な成果指標を設定する。
                    </p>
                </div>
            </div>
        </div>
    `)}let Y={type:"inbox",id:null},nt=null;const Fl={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function Qy(){if(nt)return;const{VIEW_IDS:e}=mr;nt={task:document.getElementById(e.TASK),dashboard:document.getElementById(e.DASHBOARD),search:document.getElementById(e.SEARCH),settings:document.getElementById(e.SETTINGS),wizard:document.getElementById(e.WIZARD),targetDashboard:document.getElementById(e.TARGET_DASHBOARD),wiki:document.getElementById(e.WIKI)}}function ln(e,t=[],n=[]){if(e.type==="settings"){Ns();return}Y=e,xg(Y),Ac(Y,t,n)}function tx(e,t,n,i=[],s=[]){if(Qy(),!nt.task)return;const o=document.getElementById(Fl.SORT),r=(o==null?void 0:o.dataset.value)||"createdAt_desc",a=Object.values(nt).filter(f=>f);if(Y.type==="dashboard"){We(nt.dashboard,a.filter(f=>f!==nt.dashboard)),nt.dashboard.innerHTML=Id(),Py(e),cn(!1);return}if(Y.type==="search"){We(nt.search,a.filter(f=>f!==nt.search)),Xy(nt.search,e,t,Y),cn(!0,null,null);return}if(Y.type==="wizard"){nt.wizard&&(We(nt.wizard,a.filter(f=>f!==nt.wizard)),Ky(nt.wizard),cn(!1));return}if(Y.type==="target-dashboard"){nt.targetDashboard&&(We(nt.targetDashboard,a.filter(f=>f!==nt.targetDashboard)),Jy(nt.targetDashboard),cn(!1));return}if(Y.type==="wiki"){nt.wiki&&(We(nt.wiki,a.filter(f=>f!==nt.wiki)),Zy(nt.wiki),cn(!1));return}We(nt.task,a.filter(f=>f!==nt.task));const l=document.getElementById(Fl.COMPLETED_TOGGLE),c=l?l.classList.contains("text-blue-500"):!1,d=()=>{var f,g,p,m;switch(Y.type){case"inbox":return"インボックス";case"project":return((f=t.find(b=>b.id===Y.id))==null?void 0:f.name)||"プロジェクト";case"label":return((g=n.find(b=>b.id===Y.id))==null?void 0:g.name)||"ラベル";case"timeblock":return Y.id==="unassigned"||Y.id==="none"?"未定":((p=i.find(b=>b.id===Y.id))==null?void 0:p.name)||"時間帯";case"duration":return`${Y.id}分`;case"filter":case"custom":return((m=s.find(b=>b.id===Y.id))==null?void 0:m.name)||"フィルター";case"today":return"今日";case"upcoming":return"今後";case"wizard":return"目標設計ウィザード";case"target-dashboard":return"目標ダッシュボード";case"wiki":return"フレームワークWiki";default:return Y.id?Y.id:"タスク"}},u={keyword:"",showCompleted:c,projectId:Y.type==="inbox"?"unassigned":Y.type==="project"?Y.id:null,labelId:Y.type==="label"?Y.id:null,timeBlockId:Y.type==="timeblock"?Y.id:null,duration:Y.type==="duration"?Y.id:null,savedFilter:Y.type==="custom"||Y.type==="filter"?s.find(f=>f.id===Y.id):null,sortCriteria:r,title:d()},h=Zf(e,u);Ei(h,t,n,u),cn(!0,u.projectId,u.labelId)}function cn(e,t=null,n=null){const i=document.getElementById("footer-add-btn-container"),s=document.getElementById("footer-input-form-container");i&&s&&(e?(i.classList.remove("hidden"),s.classList.add("hidden"),s.innerHTML="",Hy(i,s,t,n)):(i.classList.add("hidden"),s.classList.add("hidden")))}const jt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null};let Zo=!1,Do=null;function Ke(){Do||(Do=requestAnimationFrame(()=>{const e=Rn.tasks(),t=Rn.projects(),n=Rn.labels(),i=Rn.timeBlocks(),s=Rn.filters();tx(e,t,n,i,s),Do=null}))}function Pn(e){document.dispatchEvent(new CustomEvent(e)),Ke()}function ex(e){if(!(W!=null&&W.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}Pr(!1);const t=Zt();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}Zo=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),jt.tasks=ph(t,()=>Pn("tasks-updated")),jt.projects=ah(t,()=>Pn("projects-updated")),jt.labels=eh(t,()=>Pn("labels-updated")),jt.timeBlocks=uh(t,()=>Pn("timeblocks-updated")),jt.filters=Xu(t,()=>Pn("filters-updated"))}function Pr(e=!1){(Zo||e)&&console.log("[DataSync] Stopping data sync..."),Object.keys(jt).forEach(t=>{t==="workspaces"&&!e||typeof jt[t]=="function"&&(jt[t](),jt[t]=null)}),hh(),Gu(),Zo=!1,Ke()}const Rn={tasks:_n,projects:lr,labels:Qu,timeBlocks:ue,filters:Ql,workspaceId:()=>Zt()};function Od(){return jt.workspaces}function Pd(e){jt.workspaces=e}function nx(){const e=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),n=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!e||!t||!n)return;const s=r=>{r?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",o)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",o))},o=r=>{r&&(t.contains(r.target)||e.contains(r.target))||s(!1)};e.addEventListener("click",r=>{r.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(r=>{r.addEventListener("click",a=>{const l=r.dataset.value,c=r.textContent;n.textContent=c,e.dataset.value=l,Ke(),s(!1)})}),e.dataset.value||(e.dataset.value="createdAt_desc",n.textContent="作成日(新しい順)")}function ix(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function sx(){var n;let e=!0;document.addEventListener("workspace-changed",i=>{const{workspaceId:s}=i.detail;console.log("[EventManager] Workspace changed to:",s);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),W!=null&&W.currentUser){if(e)if(e=!1,ug()){const r=dg();r&&ln({type:r})}else try{const r=JSON.parse(localStorage.getItem("lastPage"));r&&r.page==="settings"?ln({type:"inbox"}):ln(r?{type:r.page,id:r.id||null}:{type:"inbox"})}catch{ln({type:"inbox"})}else ln({type:"inbox",id:null});Pr(!1),ex(),Ke()}}),document.addEventListener("route-change",i=>{const{page:s,id:o}=i.detail;ln({type:s,id:o||null}),s!=="settings"&&localStorage.setItem("lastPage",JSON.stringify({page:s,id:o||null})),Ke()});const t=ix(()=>Ke(),300);(n=document.getElementById("search-input"))==null||n.addEventListener("input",t),nx()}function ox(){try{Gd()}catch(e){console.error("Firebase Initialization Failed",e);return}Iu(),zh(),xs(),vu(),wh(),ac(),zl(),sx(),rx()}function rx(){W&&jd(W,e=>{tu(e),e?ax(e):lx()})}function ax(e){hg();const t=Od();typeof t=="function"&&t();const n=ou(e.uid,i=>{lc(i)});Pd(n)}function lx(){const e=Od();typeof e=="function"&&(e(),Pd(null)),Pr(!0),wg(),zl()}function cx(){ox()}let Nl=!1;function dx(e){const t=document.createElement("div");t.id=bg.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const n=t.querySelector("#error-code-box");n&&(n.textContent=e.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function ux(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const e=document.createElement("link");e.rel="icon",e.type="image/png",e.href=mg.FAVICON,document.head.appendChild(e)}async function $l(){if(!Nl){Nl=!0;try{ux(),await cx()}catch(e){console.error("[Main] Critical Initialization Error:",e),dx(e)}}}(()=>{if(document.readyState==="loading"){const e=()=>{document.removeEventListener("DOMContentLoaded",e),$l()};document.addEventListener("DOMContentLoaded",e)}else $l()})();
