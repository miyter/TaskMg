var Yu=Object.defineProperty;var qu=(e,t,n)=>t in e?Yu(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n;var I=(e,t,n)=>qu(e,typeof t!="symbol"?t+"":t,n);import{getAuth as Gu,signInAnonymously as Xu,signInWithEmailAndPassword as Ku,updatePassword as Ju,onAuthStateChanged as Zu}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";import{getFirestore as Qu,updateDoc as Ii,doc as Nt,addDoc as qe,collection as ft,serverTimestamp as wn,deleteDoc as Di,query as Ze,orderBy as Mr,onSnapshot as kn,getDocs as Gn,limit as th,Timestamp as Cr,getDoc as eh,setDoc as nh}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";import{initializeApp as ih}from"https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const o of s)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&i(r)}).observe(document,{childList:!0,subtree:!0});function n(s){const o={};return s.integrity&&(o.integrity=s.integrity),s.referrerPolicy&&(o.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?o.credentials="include":s.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(s){if(s.ep)return;s.ep=!0;const o=n(s);fetch(s.href,o)}})();const ha={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};let cs,V,K,Ms=!1;function sh(){if(Ms)return;const e=oh();if(e!=null&&e.apiKey)try{cs=ih(e),V=Gu(cs),K=Qu(cs),Ms=!0,console.log("[Firebase] Initialized successfully.")}catch(t){throw console.error("[Firebase] Initialization error:",t),t}else{const t="Firebase configuration is missing or invalid.";throw console.error(t),new Error(t)}}function oh(){if(typeof window<"u"&&window.GLOBAL_FIREBASE_CONFIG&&window.GLOBAL_FIREBASE_CONFIG.apiKey)return console.log("[Firebase] Using injected GLOBAL_FIREBASE_CONFIG"),window.GLOBAL_FIREBASE_CONFIG;try{if(import.meta&&ha){const e=ha,t={apiKey:e.VITE_FIREBASE_API_KEY,authDomain:e.VITE_FIREBASE_AUTH_DOMAIN,projectId:e.VITE_FIREBASE_PROJECT_ID,storageBucket:e.VITE_FIREBASE_STORAGE_BUCKET,messagingSenderId:e.VITE_FIREBASE_MESSAGING_SENDER_ID,appId:e.VITE_FIREBASE_APP_ID,measurementId:e.VITE_FIREBASE_MEASUREMENT_ID};if(t.apiKey)return console.log("[Firebase] Using Vite environment variables"),t}}catch{}if(typeof __firebase_config<"u")try{return typeof __firebase_config=="object"?__firebase_config:JSON.parse(__firebase_config)}catch(e){return console.error("[Firebase] Config parse failed (legacy):",e),null}return console.error("[Firebase] All config sources failed. Check index.html injection."),null}function Pc(){if(!Ms)throw new Error("Firebase not initialized. Call initializeFirebase() first.");return{app:cs,auth:V,db:K}}function rh(e,t,n){return`
        <div id="message-modal" class="fixed inset-0 z-[60] flex items-center justify-center bg-black/50 backdrop-blur-sm animate-fade-in p-4" role="dialog" aria-modal="true">
            <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl p-6 max-w-sm w-full transform transition-all scale-100 border border-gray-100 dark:border-gray-700">
                <div class="mb-5">
                    <h3 class="text-lg font-bold text-gray-800 dark:text-gray-100 mb-2 flex items-center gap-2" id="msg-modal-title"></h3>
                    <p class="text-gray-600 dark:text-gray-300 text-sm whitespace-pre-wrap leading-relaxed" id="msg-modal-body"></p>
                </div>
                <div class="flex justify-end space-x-3">
                    ${n?`
                    <button id="msg-modal-cancel" class="px-4 py-2 text-sm font-medium text-gray-600 dark:text-gray-400 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-colors">
                        ${e.cancelText}
                    </button>`:""}
                    <button id="msg-modal-ok" class="px-4 py-2 text-sm font-bold text-white ${t} rounded-lg shadow-md transition-transform active:scale-95">
                        ${e.okText}
                    </button>
                </div>
            </div>
        </div>
    `}function ah(e){var d;(d=document.getElementById("message-modal"))==null||d.remove();let t="bg-blue-600 hover:bg-blue-700";if(!e.title)switch(e.type){case"error":e.title="エラー",t="bg-red-600 hover:bg-red-700";break;case"success":e.title="成功",t="bg-green-600 hover:bg-green-700";break;case"confirm":e.title="確認",t="bg-red-600 hover:bg-red-700";break;default:e.title="通知";break}const n=e.type==="confirm";!n&&e.okText==="OK"&&(e.okText="閉じる"),document.body.insertAdjacentHTML("beforeend",rh(e,t,n));const i=document.getElementById("message-modal"),s=document.getElementById("msg-modal-title"),o=document.getElementById("msg-modal-body"),r=document.getElementById("msg-modal-ok"),a=document.getElementById("msg-modal-cancel");s.textContent=e.title,o.textContent=e.message;const l=()=>{document.removeEventListener("keydown",c),i.classList.add("opacity-0"),setTimeout(()=>i.remove(),200)},c=u=>{u.key==="Escape"&&l(),u.key==="Enter"&&!n&&l()};document.addEventListener("keydown",c),r.onclick=()=>{e.onConfirm&&e.onConfirm(),l()},a&&(a.onclick=l),i.onclick=u=>{u.target===i&&!n&&l()},r.focus()}function L(e,t=null){let n={title:"",message:"",type:"info",onConfirm:null,cancelText:"キャンセル",okText:"OK"};return typeof e=="object"&&e!==null?n={...n,...e}:(n.message=String(e),typeof t=="function"?(n.type="confirm",n.onConfirm=t):typeof t=="string"&&(n.type=t)),ah(n)}async function lh(e,t){if(!Ms)throw new Error("Firebaseが初期化されていないぞ。");try{return await Ku(V,e,t)}catch(n){let i="ログインに失敗した。";switch(n.code){case"auth/invalid-email":i="メールアドレスの形式が正しくない。";break;case"auth/user-disabled":i="このアカウントは無効化されているぞ。";break;case"auth/user-not-found":i="アカウントが見つからない。";break;case"auth/wrong-password":i="パスワードが間違っている。";break;case"auth/too-many-requests":i="試行回数が多すぎる。少し時間を置いてくれ。";break;case"auth/network-request-failed":i="ネットワークエラーだ。通信環境を確認してくれ。";break}throw new Error(i)}}async function ch(e){const t=V.currentUser;if(!t)throw new Error("認証されていないぞ。");try{await Ju(t,e),L({message:"パスワードを変更したぞ",type:"success"})}catch(n){let i="変更に失敗した: "+n.message;throw n.code==="auth/requires-recent-login"&&(i="セキュリティのため、再ログインが必要だ。一度ログアウトしてから試してくれ。"),L({message:i,type:"error"}),n}}function Rc(){const e=document.getElementById("email-login-btn"),t=document.getElementById("email-input"),n=document.getElementById("password-input"),i=document.getElementById("guest-login-btn");if(e&&t&&n){const s=async()=>{const o=t.value.trim(),r=n.value.trim();if(!o||!r)return L({message:"メールアドレスとパスワードを入力してくれ。",type:"error"});try{await lh(o,r)}catch(a){L({message:a.message,type:"error"})}};e.onclick=s,n.addEventListener("keydown",o=>{o.key==="Enter"&&!o.isComposing&&s()})}i&&(i.onclick=async()=>{try{await Xu(V),L({message:"ゲストとしてログインしたぞ。データは一時的に保持される。",type:"success"})}catch(s){console.error(s),L({message:"ゲストログインに失敗した: "+s.message,type:"error"})}})}function dh(e){const t=document.getElementById("login-form-container")||document.getElementById("login-container-wrapper"),n=document.getElementById("user-info"),i=document.getElementById("user-email-display"),s=document.getElementById("email-input"),o=document.getElementById("password-input");e?(e.uid,t&&t.classList.add("hidden"),n&&(n.classList.remove("hidden"),n.classList.add("flex")),i&&(i.textContent=e.isAnonymous?"ゲストユーザー":e.email||"ユーザー")):(t&&t.classList.remove("hidden"),n&&(n.classList.add("hidden"),n.classList.remove("flex")),s&&(s.value=""),o&&(o.value=""),i&&(i.textContent=""))}const uh={Z_INDEX:{HEADER:10,OVERLAY:20,SIDEBAR:30,DROPDOWN:40,MODAL:50}},B={MIN_WIDTH:150,MAX_WIDTH:500,DEFAULT_WIDTH:280,BREAKPOINT_MD:768,DENSITY_LEVELS:{COMPACT:"compact",NORMAL:"normal",COMFORTABLE:"comfortable",SPACIOUS:"spacious"},DENSITY_CLASSES:{compact:"py-0.5",normal:"py-1.5",comfortable:"py-2.5",spacious:"py-3.5"},CLASSES:{CLOSED:"sidebar-closed",HIDDEN:"hidden",DRAG_OVER:["bg-blue-100","dark:bg-blue-900","ring-2","ring-blue-400"]},COLORS:{DEFAULT:"#CBD5E0"},STORAGE_KEYS:{WIDTH:"sidebarWidth",DENSITY:"sidebar_density",COMPACT:"sidebar_compact",SECTION_PREFIX:"sidebar-section:",SECTION_ORDER:"sidebar_section_order"},LIST_IDS:{PROJECTS:"project-list",LABELS:"label-list",TIMEBLOCKS:"timeblock-list",DURATIONS:"duration-list",FILTERS:"filter-list",BASIC:"basic-list"},MODAL_IDS:{SETTINGS:"settings-modal-dynamic"},DURATIONS:[30,45,60,75,90],DURATION_LIMITS:{MIN:5,MAX:480}};function Bc(e,t){if(!t||!e)return;let n=!1,i=null,s=null;const o=()=>{i!==null&&e&&(e.style.width=`${i}px`),s=null},r=l=>{if(!n)return;const{MIN_WIDTH:c,MAX_WIDTH:d}=B;i=Math.max(c,Math.min(d,l.clientX)),s||(s=requestAnimationFrame(o))},a=()=>{n&&(n=!1,document.body.classList.remove("cursor-col-resize","select-none"),e.style.transition="",s&&cancelAnimationFrame(s),s=null,o(),localStorage.setItem(B.STORAGE_KEYS.WIDTH,e.offsetWidth),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",a))};t.addEventListener("mousedown",l=>{Ar()&&(n=!0,document.body.classList.add("cursor-col-resize","select-none"),e.style.transition="none",document.addEventListener("mousemove",r),document.addEventListener("mouseup",a))})}function Ar(){return window.innerWidth>=768}function Ti(e,t=!1){const n=localStorage.getItem(e);return n===null?t:n==="true"||n==="compact"}function Qs(){const e=localStorage.getItem(B.STORAGE_KEYS.DENSITY);return e&&Object.values(B.DENSITY_LEVELS).includes(e)?e:Ti(B.STORAGE_KEYS.COMPACT,!1)?B.DENSITY_LEVELS.COMPACT:B.DENSITY_LEVELS.NORMAL}function hh(){return Qs()===B.DENSITY_LEVELS.COMPACT}function Cs(e,t){return Array.isArray(e)?e.filter(n=>!n.completed&&t(n)).length:0}function fh(){return typeof window<"u"&&window.GLOBAL_APP_ID?window.GLOBAL_APP_ID:typeof __app_id<"u"?__app_id:"default-app-id"}function an(e){return`artifacts/${fh()}/users/${e}`}function fa(e,t){return`${an(e)}/workspaces/${t}`}const Y={users:e=>an(e),filters:e=>`${an(e)}/filters`,labels:e=>`${an(e)}/labels`,workspaces:e=>`${an(e)}/workspaces`,timeblocks:e=>`${an(e)}/timeblocks`,tasks:(e,t)=>`${fa(e,t)}/tasks`,projects:(e,t)=>`${fa(e,t)}/projects`},As="currentWorkspaceId",gh="workspace-changed";let Bi=null,Lr=[];function Jo(){return Lr}function ph(e,t){const n=typeof t=="function"?t:()=>{};if(!e)return n([]),()=>{};Bi&&Bi();const i=Y.workspaces(e),s=Ze(ft(K,i),Mr("createdAt","asc"));return Bi=kn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));if(Lr=r,r.length===0&&!o.metadata.hasPendingWrites)n([]),mh().catch(a=>console.error("[Workspace] Default creation error:",a));else{const a=bh(r);n(r),Nc(a,r)}},o=>{console.error("[Workspace] Subscription error:",o),n([])}),Bi}async function mh(){try{const e=V.currentUser;if(!e)return;const t=Y.workspaces(e.uid);(await Gn(Ze(ft(K,t),th(1)))).empty&&await Fc("メイン")}catch(e){console.error("[Workspace] Failed to ensure default workspace:",e)}}function bh(e){if(e.length===0)return null;let t=Zt();const n=e.some(i=>i.id===t);return(!t||!n)&&(t=e[0].id,localStorage.setItem(As,t)),t}function Zt(){return localStorage.getItem(As)}function Or(e){!e||localStorage.getItem(As)===e||(localStorage.setItem(As,e),Nc(e,Lr))}function Nc(e,t){const n=new CustomEvent(gh,{detail:{workspaceId:e,workspaces:t}});document.dispatchEvent(n)}async function Fc(e){try{const t=V.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);return{id:(await qe(ft(K,n),{name:e,createdAt:wn()})).id,name:e}}catch(t){throw console.error("[Workspace] Add error:",t),L("ワークスペースの作成に失敗した。"),t}}async function yh(e,t){try{const n=V.currentUser;if(!n)throw new Error("Authentication required");const i=Y.workspaces(n.uid);await Ii(Nt(K,i,e),{name:t})}catch(n){console.error("[Workspace] Update error:",n),L("名前の更新に失敗した。")}}async function vh(e){try{const t=V.currentUser;if(!t)throw new Error("Authentication required");const n=Y.workspaces(t.uid);await Di(Nt(K,n,e))}catch(t){console.error("[Workspace] Delete error:",t),L("削除に失敗した。")}}const ga={EN:[{value:"Inter",label:"Inter (Standard)"},{value:"Roboto Mono",label:"Roboto Mono (Monospace)"},{value:"Lora",label:"Lora (Serif)"},{value:"Oswald",label:"Oswald (Condensed)"}],JP:[{value:"M PLUS 2",label:"M PLUS 2 (Standard)"},{value:"Noto Sans JP",label:"Noto Sans JP"},{value:"Yu Mincho",label:"Yu Mincho (Serif)"},{value:"BIZ UDPGothic",label:"BIZ UDPGothic"}]},bn={FONT_EN:"font_family_en",FONT_JP:"font_family_jp"},Ls={EN:"Inter",JP:"M PLUS 2"};function Hc(){const e=localStorage.getItem(bn.FONT_EN)||Ls.EN,t=localStorage.getItem(bn.FONT_JP)||Ls.JP,n=document.documentElement;n.style.setProperty("--font-en",`"${e}"`),n.style.setProperty("--font-jp",`"${t}"`)}function pa(e,t){const n=e==="EN"?bn.FONT_EN:bn.FONT_JP;localStorage.setItem(n,t),Hc()}function xh(){return{en:localStorage.getItem(bn.FONT_EN)||Ls.EN,jp:localStorage.getItem(bn.FONT_JP)||Ls.JP}}function _h(){const e=localStorage.getItem("fontSize")||"md",t=["font-app-sm","font-app-md","font-app-lg"];document.body.classList.remove(...t),document.body.classList.add(`font-app-${e}`)}const Cn={NONE:"none",TEXTURE:"haikei"},Ft={SMALL:"sm",BASE:"base",MEDIUM:"md",LARGE:"lg",XL:"xl"};function ma(e,t,n,i){const s=t.map(o=>`<option value="${o.value}" ${o.value===n?"selected":""}>${o.label}</option>`).join("");return`
        <div>
            <label class="block text-xs font-semibold text-gray-500 uppercase tracking-wider mb-1.5">${e}</label>
            <div class="relative">
                <select name="${i}" class="w-full pl-3 pr-8 py-2 bg-gray-50 dark:bg-gray-700/50 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-gray-700 dark:text-gray-200 appearance-none focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent cursor-pointer transition-shadow">
                    ${s}
                </select>
                <div class="absolute inset-y-0 right-0 flex items-center px-2 pointer-events-none text-gray-400">
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </div>
            </div>
        </div>
    `}function wh(){const e=xh();return`
        <div class="space-y-4">
            ${ma("英数字フォント",ga.EN,e.en,"font-en-select")}
            ${ma("日本語フォント",ga.JP,e.jp,"font-jp-select")}
        </div>
    `}function Mt(e,t,n,i,s=""){return`
        <label class="flex items-center justify-center gap-2 cursor-pointer p-3 border ${i?"border-blue-500 bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300":"border-gray-200 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-700/50 text-gray-600 dark:text-gray-300"} rounded-lg transition-all duration-200">
            <input type="radio" name="${e}" value="${t}" class="hidden" ${i?"checked":""}>
            ${s}
            <span class="text-sm font-medium">${n}</span>
        </label>
    `}function kh(e,t,n){const i=localStorage.getItem("theme")||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),s=localStorage.getItem("fontSize")||Ft.MEDIUM,o=localStorage.getItem("background")||Cn.NONE,r=e||"?",a=localStorage.getItem("sidebar_density")||(n?"compact":"normal"),l=`
        <section class="mb-8">
            <h4 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 21a4 4 0 01-4-4V5a2 2 0 012-2h4a2 2 0 012 2v12a4 4 0 01-4 4zm0 0h12a2 2 0 002-2v-4a2 2 0 00-2-2h-2.343M11 7.343l1.657-1.657a2 2 0 012.828 0l2.829 2.829a2 2 0 010 2.828l-8.486 8.485M7 17h.01"></path></svg>
                Appearance
            </h4>
            
            <div class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">テーマ</label>
                    <div class="grid grid-cols-2 gap-3">
                        ${Mt("app-theme","light","ライト",i==="light",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>')}
                        ${Mt("app-theme","dark","ダーク",i==="dark",'<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>')}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">背景パターン (ダークモード)</label>
                    <div class="grid grid-cols-2 gap-3">
                        ${Mt("bg-pattern",Cn.NONE,"無地",o===Cn.NONE)}
                        ${Mt("bg-pattern",Cn.TEXTURE,"テクスチャ",o===Cn.TEXTURE)}
                    </div>
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">サイドバーとUI密度</label>
                    <div class="grid grid-cols-2 gap-3">
                        ${Mt("sidebar-density","compact","Compact",a==="compact")}
                        ${Mt("sidebar-density","normal","Standard",a==="normal")}
                        ${Mt("sidebar-density","comfortable","Comfortable",a==="comfortable")}
                        ${Mt("sidebar-density","spacious","Spacious",a==="spacious")}
                    </div>
                </div>
            </div>
        </section>

        <section>
            <h4 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
                Typography
            </h4>
             ${wh()}
        </section>
    `,d=`
        <section class="mb-8">
            <h4 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                Font Size
            </h4>
            <div class="space-y-2">
                 ${`
        <div class="grid grid-cols-2 gap-2">
            ${Mt("font-size",Ft.XL,"XL",s===Ft.XL)}
            ${Mt("font-size",Ft.LARGE,"Large",s===Ft.LARGE)}
            ${Mt("font-size",Ft.MEDIUM,"Medium",s===Ft.MEDIUM)}
            ${Mt("font-size",Ft.BASE,"Base",s===Ft.BASE)}
            ${Mt("font-size",Ft.SMALL,"Small",s===Ft.SMALL)}
        </div>
    `}
            </div>
        </section>

         <section class="mb-8">
            <h4 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path></svg>
                Account
            </h4>
             <div class="flex items-center gap-3 mb-4 p-4 bg-gray-50 dark:bg-gray-700/30 rounded-lg border border-gray-100 dark:border-gray-700">
                <div class="w-10 h-10 rounded-full bg-gradient-to-br from-blue-500 to-indigo-600 flex items-center justify-center text-white font-bold text-lg shadow-md">
                    ${r}
                </div>
                <div>
                    <div class="text-sm font-bold text-gray-900 dark:text-white">ログイン中</div>
                    <div class="text-xs text-gray-500 font-mono">${t}</div>
                </div>
            </div>
            
            <div class="space-y-3">
                <div class="flex gap-2">
                    <input type="password" id="new-password-input-new" placeholder="新しいパスワード" class="flex-1 px-3 py-2 bg-white dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm outline-none focus:ring-2 focus:ring-blue-500 transition-shadow">
                    <button id="update-password-btn-new" class="px-4 py-2 bg-gray-900 hover:bg-gray-800 dark:bg-gray-700 dark:hover:bg-gray-600 text-white text-sm font-bold rounded-lg transition-colors whitespace-nowrap">変更</button>
                </div>
                <button id="logout-btn-settings" class="w-full py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/20 text-sm font-medium rounded-lg transition-colors text-left flex items-center gap-2 px-2">
                     <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path></svg>
                    ログアウト
                </button>
            </div>
        </section>

        <section>
            <h4 class="flex items-center gap-2 text-xs font-bold text-gray-400 uppercase tracking-widest mb-4">
                 <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4"></path></svg>
                Data Management
            </h4>
            <div class="space-y-3">
                <button id="export-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">バックアップを作成</span>
                        <svg class="w-5 h-5 text-gray-400 group-hover:text-blue-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path></svg>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">現在の全データをJSON形式でダウンロード</div>
                </button>
                
                <button id="import-data-btn-new" class="w-full text-left px-4 py-3 bg-white dark:bg-gray-700/50 hover:bg-gray-50 dark:hover:bg-gray-700 rounded-xl transition-all border border-gray-200 dark:border-gray-600 group shadow-sm hover:shadow-md">
                     <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-gray-700 dark:text-gray-200">データを復元</span>
                         <svg class="w-5 h-5 text-gray-400 group-hover:text-green-500 transition-colors" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"></path></svg>
                    </div>
                    <div class="text-xs text-gray-500 mt-1">バックアップファイルからデータを読み込み</div>
                </button>
                <input type="file" id="import-file-input" accept=".json" class="hidden" />
            </div>
        </section>
    `;return`
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl w-full max-w-5xl overflow-hidden flex flex-col max-h-[90vh] h-full sm:h-auto animate-fade-in-up">
            <div class="px-8 py-5 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800 z-10">
                <h3 class="text-xl font-bold text-gray-900 dark:text-white tracking-tight">Settings</h3>
                <button id="close-settings-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition-colors p-2 hover:bg-gray-100 dark:hover:bg-gray-700 rounded-full"><svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg></button>
            </div>

            <div class="p-8 overflow-y-auto custom-scrollbar flex-1 bg-gray-50/50 dark:bg-gray-900/20">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                     <div>${l}</div>
                     <div>${d}</div>
                </div>
            </div>
        </div>
    `}var ba={};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $c=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=s&63|128):(s&64512)===55296&&i+1<e.length&&(e.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(e.charCodeAt(++i)&1023),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=s&63|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=s&63|128)}return t},Sh=function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const o=e[n++];t[i++]=String.fromCharCode((s&31)<<6|o&63)}else if(s>239&&s<365){const o=e[n++],r=e[n++],a=e[n++],l=((s&7)<<18|(o&63)<<12|(r&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const o=e[n++],r=e[n++];t[i++]=String.fromCharCode((s&15)<<12|(o&63)<<6|r&63)}}return t.join("")},zc={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<e.length;s+=3){const o=e[s],r=s+1<e.length,a=r?e[s+1]:0,l=s+2<e.length,c=l?e[s+2]:0,d=o>>2,u=(o&3)<<4|a>>4;let h=(a&15)<<2|c>>6,f=c&63;l||(f=64,r||(h=64)),i.push(n[d],n[u],n[h],n[f])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray($c(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):Sh(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<e.length;){const o=n[e.charAt(s++)],a=s<e.length?n[e.charAt(s)]:0;++s;const c=s<e.length?n[e.charAt(s)]:64;++s;const u=s<e.length?n[e.charAt(s)]:64;if(++s,o==null||a==null||c==null||u==null)throw new Eh;const h=o<<2|a>>4;if(i.push(h),c!==64){const f=a<<4&240|c>>2;if(i.push(f),u!==64){const g=c<<6&192|u;i.push(g)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class Eh extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Ih=function(e){const t=$c(e);return zc.encodeByteArray(t,!0)},jc=function(e){return Ih(e).replace(/\./g,"")},Vc=function(e){try{return zc.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Dh(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Th=()=>Dh().__FIREBASE_DEFAULTS__,Mh=()=>{if(typeof process>"u"||typeof ba>"u")return;const e=ba.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},Ch=()=>{if(typeof document>"u")return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=e&&Vc(e[1]);return t&&JSON.parse(t)},Ah=()=>{try{return Th()||Mh()||Ch()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},Lh=e=>{var t;return(t=Ah())===null||t===void 0?void 0:t[`_${e}`]};/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Kt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function Oh(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Kt())}function Ph(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function Rh(){const e=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof e=="object"&&e.id!==void 0}function Bh(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function Nh(){try{return typeof indexedDB=="object"}catch{return!1}}function Fh(){return new Promise((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var o;t(((o=s.error)===null||o===void 0?void 0:o.message)||"")}}catch(n){t(n)}})}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hh="FirebaseError";class Qe extends Error{constructor(t,n,i){super(n),this.code=t,this.customData=i,this.name=Hh,Object.setPrototypeOf(this,Qe.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Mi.prototype.create)}}class Mi{constructor(t,n,i){this.service=t,this.serviceName=n,this.errors=i}create(t,...n){const i=n[0]||{},s=`${this.service}/${t}`,o=this.errors[t],r=o?$h(o,i):"Error",a=`${this.serviceName}: ${r} (${s}).`;return new Qe(s,a,i)}}function $h(e,t){return e.replace(zh,(n,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const zh=/\{\$([^}]+)}/g;/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Uc(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function jh(e,t){const n=new Vh(e,t);return n.subscribe.bind(n)}class Vh{constructor(t,n){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=n,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(n=>{n.next(t)})}error(t){this.forEachObserver(n=>{n.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,n,i){let s;if(t===void 0&&n===void 0&&i===void 0)throw new Error("Missing Observer.");Uh(t,["next","error","complete"])?s=t:s={next:t,error:n,complete:i},s.next===void 0&&(s.next=fo),s.error===void 0&&(s.error=fo),s.complete===void 0&&(s.complete=fo);const o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),o}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let n=0;n<this.observers.length;n++)this.sendOne(n,t)}sendOne(t,n){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{n(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function Uh(e,t){if(typeof e!="object"||e===null)return!1;for(const n of t)if(n in e&&typeof e[n]=="function")return!0;return!1}function fo(){}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Ci(e){return e&&e._delegate?e._delegate:e}class hi{constructor(t,n,i){this.name=t,this.instanceFactory=n,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}/**
 * @license
 * Copyright 2017 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */var X;(function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"})(X||(X={}));const Wh={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},Yh=X.INFO,qh={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},Gh=(e,t,...n)=>{if(t<e.logLevel)return;const i=new Date().toISOString(),s=qh[t];if(s)console[s](`[${i}]  ${e.name}:`,...n);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Wc{constructor(t){this.name=t,this._logLevel=Yh,this._logHandler=Gh,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in X))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?Wh[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...t),this._logHandler(this,X.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...t),this._logHandler(this,X.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,X.INFO,...t),this._logHandler(this,X.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,X.WARN,...t),this._logHandler(this,X.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...t),this._logHandler(this,X.ERROR,...t)}}const Xh=(e,t)=>t.some(n=>e instanceof n);let ya,va;function Kh(){return ya||(ya=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function Jh(){return va||(va=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const Yc=new WeakMap,Zo=new WeakMap,qc=new WeakMap,go=new WeakMap,Pr=new WeakMap;function Zh(e){const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("success",o),e.removeEventListener("error",r)},o=()=>{n(De(e.result)),s()},r=()=>{i(e.error),s()};e.addEventListener("success",o),e.addEventListener("error",r)});return t.then(n=>{n instanceof IDBCursor&&Yc.set(n,e)}).catch(()=>{}),Pr.set(t,e),t}function Qh(e){if(Zo.has(e))return;const t=new Promise((n,i)=>{const s=()=>{e.removeEventListener("complete",o),e.removeEventListener("error",r),e.removeEventListener("abort",r)},o=()=>{n(),s()},r=()=>{i(e.error||new DOMException("AbortError","AbortError")),s()};e.addEventListener("complete",o),e.addEventListener("error",r),e.addEventListener("abort",r)});Zo.set(e,t)}let Qo={get(e,t,n){if(e instanceof IDBTransaction){if(t==="done")return Zo.get(e);if(t==="objectStoreNames")return e.objectStoreNames||qc.get(e);if(t==="store")return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return De(e[t])},set(e,t,n){return e[t]=n,!0},has(e,t){return e instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in e}};function tf(e){Qo=e(Qo)}function ef(e){return e===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...n){const i=e.call(po(this),t,...n);return qc.set(i,t.sort?t.sort():[t]),De(i)}:Jh().includes(e)?function(...t){return e.apply(po(this),t),De(Yc.get(this))}:function(...t){return De(e.apply(po(this),t))}}function nf(e){return typeof e=="function"?ef(e):(e instanceof IDBTransaction&&Qh(e),Xh(e,Kh())?new Proxy(e,Qo):e)}function De(e){if(e instanceof IDBRequest)return Zh(e);if(go.has(e))return go.get(e);const t=nf(e);return t!==e&&(go.set(e,t),Pr.set(t,e)),t}const po=e=>Pr.get(e);function sf(e,t,{blocked:n,upgrade:i,blocking:s,terminated:o}={}){const r=indexedDB.open(e,t),a=De(r);return i&&r.addEventListener("upgradeneeded",l=>{i(De(r.result),l.oldVersion,l.newVersion,De(r.transaction),l)}),n&&r.addEventListener("blocked",l=>n(l.oldVersion,l.newVersion,l)),a.then(l=>{o&&l.addEventListener("close",()=>o()),s&&l.addEventListener("versionchange",c=>s(c.oldVersion,c.newVersion,c))}).catch(()=>{}),a}const of=["get","getKey","getAll","getAllKeys","count"],rf=["put","add","delete","clear"],mo=new Map;function xa(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&typeof t=="string"))return;if(mo.get(t))return mo.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=rf.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!(s||of.includes(n)))return;const o=async function(r,...a){const l=this.transaction(r,s?"readwrite":"readonly");let c=l.store;return i&&(c=c.index(a.shift())),(await Promise.all([c[n](...a),s&&l.done]))[0]};return mo.set(t,o),o}tf(e=>({...e,get:(t,n,i)=>xa(t,n)||e.get(t,n,i),has:(t,n)=>!!xa(t,n)||e.has(t,n)}));/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class af{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(n=>{if(lf(n)){const i=n.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(n=>n).join(" ")}}function lf(e){const t=e.getComponent();return(t==null?void 0:t.type)==="VERSION"}const tr="@firebase/app",_a="0.10.13";/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const de=new Wc("@firebase/app"),cf="@firebase/app-compat",df="@firebase/analytics-compat",uf="@firebase/analytics",hf="@firebase/app-check-compat",ff="@firebase/app-check",gf="@firebase/auth",pf="@firebase/auth-compat",mf="@firebase/database",bf="@firebase/data-connect",yf="@firebase/database-compat",vf="@firebase/functions",xf="@firebase/functions-compat",_f="@firebase/installations",wf="@firebase/installations-compat",kf="@firebase/messaging",Sf="@firebase/messaging-compat",Ef="@firebase/performance",If="@firebase/performance-compat",Df="@firebase/remote-config",Tf="@firebase/remote-config-compat",Mf="@firebase/storage",Cf="@firebase/storage-compat",Af="@firebase/firestore",Lf="@firebase/vertexai-preview",Of="@firebase/firestore-compat",Pf="firebase",Rf="10.14.1",Bf={[tr]:"fire-core",[cf]:"fire-core-compat",[uf]:"fire-analytics",[df]:"fire-analytics-compat",[ff]:"fire-app-check",[hf]:"fire-app-check-compat",[gf]:"fire-auth",[pf]:"fire-auth-compat",[mf]:"fire-rtdb",[bf]:"fire-data-connect",[yf]:"fire-rtdb-compat",[vf]:"fire-fn",[xf]:"fire-fn-compat",[_f]:"fire-iid",[wf]:"fire-iid-compat",[kf]:"fire-fcm",[Sf]:"fire-fcm-compat",[Ef]:"fire-perf",[If]:"fire-perf-compat",[Df]:"fire-rc",[Tf]:"fire-rc-compat",[Mf]:"fire-gcs",[Cf]:"fire-gcs-compat",[Af]:"fire-fst",[Of]:"fire-fst-compat",[Lf]:"fire-vertex","fire-js":"fire-js",[Pf]:"fire-js-all"};/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Nf=new Map,Ff=new Map,wa=new Map;function ka(e,t){try{e.container.addComponent(t)}catch(n){de.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function fi(e){const t=e.name;if(wa.has(t))return de.debug(`There were multiple attempts to register component ${t}.`),!1;wa.set(t,e);for(const n of Nf.values())ka(n,e);for(const n of Ff.values())ka(n,e);return!0}function Nn(e){return e.settings!==void 0}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Hf={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},Rr=new Mi("app","Firebase",Hf);/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Br=Rf;function Xn(e,t,n){var i;let s=(i=Bf[e])!==null&&i!==void 0?i:e;n&&(s+=`-${n}`);const o=s.match(/\s|\//),r=t.match(/\s|\//);if(o||r){const a=[`Unable to register library "${s}" with version "${t}":`];o&&a.push(`library name "${s}" contains illegal characters (whitespace or "/")`),o&&r&&a.push("and"),r&&a.push(`version name "${t}" contains illegal characters (whitespace or "/")`),de.warn(a.join(" "));return}fi(new hi(`${s}-version`,()=>({library:s,version:t}),"VERSION"))}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const $f="firebase-heartbeat-database",zf=1,gi="firebase-heartbeat-store";let bo=null;function Gc(){return bo||(bo=sf($f,zf,{upgrade:(e,t)=>{switch(t){case 0:try{e.createObjectStore(gi)}catch(n){console.warn(n)}}}}).catch(e=>{throw Rr.create("idb-open",{originalErrorMessage:e.message})})),bo}async function jf(e){try{const n=(await Gc()).transaction(gi),i=await n.objectStore(gi).get(Xc(e));return await n.done,i}catch(t){if(t instanceof Qe)de.warn(t.message);else{const n=Rr.create("idb-get",{originalErrorMessage:t==null?void 0:t.message});de.warn(n.message)}}}async function Sa(e,t){try{const i=(await Gc()).transaction(gi,"readwrite");await i.objectStore(gi).put(t,Xc(e)),await i.done}catch(n){if(n instanceof Qe)de.warn(n.message);else{const i=Rr.create("idb-set",{originalErrorMessage:n==null?void 0:n.message});de.warn(i.message)}}}function Xc(e){return`${e.name}!${e.options.appId}`}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Vf=1024,Uf=720*60*60*1e3;class Wf{constructor(t){this.container=t,this._heartbeatsCache=null;const n=this.container.getProvider("app").getImmediate();this._storage=new qf(n),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){var t,n;try{const s=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),o=Ea();return((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,((n=this._heartbeatsCache)===null||n===void 0?void 0:n.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===o||this._heartbeatsCache.heartbeats.some(r=>r.date===o)?void 0:(this._heartbeatsCache.heartbeats.push({date:o,agent:s}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(r=>{const a=new Date(r.date).valueOf();return Date.now()-a<=Uf}),this._storage.overwrite(this._heartbeatsCache))}catch(i){de.warn(i)}}async getHeartbeatsHeader(){var t;try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,((t=this._heartbeatsCache)===null||t===void 0?void 0:t.heartbeats)==null||this._heartbeatsCache.heartbeats.length===0)return"";const n=Ea(),{heartbeatsToSend:i,unsentEntries:s}=Yf(this._heartbeatsCache.heartbeats),o=jc(JSON.stringify({version:2,heartbeats:i}));return this._heartbeatsCache.lastSentHeartbeatDate=n,s.length>0?(this._heartbeatsCache.heartbeats=s,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),o}catch(n){return de.warn(n),""}}}function Ea(){return new Date().toISOString().substring(0,10)}function Yf(e,t=Vf){const n=[];let i=e.slice();for(const s of e){const o=n.find(r=>r.agent===s.agent);if(o){if(o.dates.push(s.date),Ia(n)>t){o.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Ia(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}class qf{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return Nh()?Fh().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const n=await jf(this.app);return n!=null&&n.heartbeats?n:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){var n;if(await this._canUseIndexedDBPromise){const s=await this.read();return Sa(this.app,{lastSentHeartbeatDate:(n=t.lastSentHeartbeatDate)!==null&&n!==void 0?n:s.lastSentHeartbeatDate,heartbeats:[...s.heartbeats,...t.heartbeats]})}else return}}function Ia(e){return jc(JSON.stringify({version:2,heartbeats:e})).length}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Gf(e){fi(new hi("platform-logger",t=>new af(t),"PRIVATE")),fi(new hi("heartbeat",t=>new Wf(t),"PRIVATE")),Xn(tr,_a,e),Xn(tr,_a,"esm2017"),Xn("fire-js","")}Gf("");function Kc(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]]);return n}function Jc(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Xf=Jc,Zc=new Mi("auth","Firebase",Jc());/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Os=new Wc("@firebase/auth");function Kf(e,...t){Os.logLevel<=X.WARN&&Os.warn(`Auth (${Br}): ${e}`,...t)}function ds(e,...t){Os.logLevel<=X.ERROR&&Os.error(`Auth (${Br}): ${e}`,...t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Da(e,...t){throw Nr(e,...t)}function Qc(e,...t){return Nr(e,...t)}function td(e,t,n){const i=Object.assign(Object.assign({},Xf()),{[t]:n});return new Mi("auth","Firebase",i).create(t,{appName:e.name})}function us(e){return td(e,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Nr(e,...t){if(typeof e!="string"){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return Zc.create(e,...t)}function W(e,t,...n){if(!e)throw Nr(t,...n)}function Kn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw ds(t),new Error(t)}function Ps(e,t){e||Kn(t)}function Jf(){return Ta()==="http:"||Ta()==="https:"}function Ta(){var e;return typeof self<"u"&&((e=self.location)===null||e===void 0?void 0:e.protocol)||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Zf(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Jf()||Rh()||"connection"in navigator)?navigator.onLine:!0}function Qf(){if(typeof navigator>"u")return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Ai{constructor(t,n){this.shortDelay=t,this.longDelay=n,Ps(n>t,"Short delay should be less than long delay!"),this.isMobile=Oh()||Bh()}get(){return Zf()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function tg(e,t){Ps(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ed{static initialize(t,n,i){this.fetchImpl=t,n&&(this.headersImpl=n),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Kn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Kn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Kn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const eg={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const ng=new Ai(3e4,6e4);function nd(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function to(e,t,n,i,s={}){return id(e,s,async()=>{let o={},r={};i&&(t==="GET"?r=i:o={body:JSON.stringify(i)});const a=Uc(Object.assign({key:e.config.apiKey},r)).slice(1),l=await e._getAdditionalHeaders();l["Content-Type"]="application/json",e.languageCode&&(l["X-Firebase-Locale"]=e.languageCode);const c=Object.assign({method:t,headers:l},o);return Ph()||(c.referrerPolicy="no-referrer"),ed.fetch()(sd(e,e.config.apiHost,n,a),c)})}async function id(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},eg),t);try{const s=new ig(e),o=await Promise.race([n(),s.promise]);s.clearNetworkTimeout();const r=await o.json();if("needConfirmation"in r)throw Ni(e,"account-exists-with-different-credential",r);if(o.ok&&!("errorMessage"in r))return r;{const a=o.ok?r.errorMessage:r.error.message,[l,c]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw Ni(e,"credential-already-in-use",r);if(l==="EMAIL_EXISTS")throw Ni(e,"email-already-in-use",r);if(l==="USER_DISABLED")throw Ni(e,"user-disabled",r);const d=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(c)throw td(e,d,c);Da(e,d)}}catch(s){if(s instanceof Qe)throw s;Da(e,"network-request-failed",{message:String(s)})}}function sd(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?tg(e.config,s):`${e.config.apiScheme}://${s}`}class ig{constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((n,i)=>{this.timer=setTimeout(()=>i(Qc(this.auth,"network-request-failed")),ng.get())})}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ni(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=Qc(e,t,i);return s.customData._tokenResponse=n,s}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function sg(e,t){return to(e,"POST","/v1/accounts:delete",t)}async function od(e,t){return to(e,"POST","/v1/accounts:lookup",t)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Jn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function og(e,t=!1){const n=Ci(e),i=await n.getIdToken(t),s=rd(i);W(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const o=typeof s.firebase=="object"?s.firebase:void 0,r=o==null?void 0:o.sign_in_provider;return{claims:s,token:i,authTime:Jn(yo(s.auth_time)),issuedAtTime:Jn(yo(s.iat)),expirationTime:Jn(yo(s.exp)),signInProvider:r||null,signInSecondFactor:(o==null?void 0:o.sign_in_second_factor)||null}}function yo(e){return Number(e)*1e3}function rd(e){const[t,n,i]=e.split(".");if(t===void 0||n===void 0||i===void 0)return ds("JWT malformed, contained fewer than 3 sections"),null;try{const s=Vc(n);return s?JSON.parse(s):(ds("Failed to decode base64 JWT payload"),null)}catch(s){return ds("Caught error parsing JWT payload as JSON",s==null?void 0:s.toString()),null}}function Ma(e){const t=rd(e);return W(t,"internal-error"),W(typeof t.exp<"u","internal-error"),W(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function er(e,t,n=!1){if(n)return t;try{return await t}catch(i){throw i instanceof Qe&&rg(i)&&e.auth.currentUser===e&&await e.auth.signOut(),i}}function rg({code:e}){return e==="auth/user-disabled"||e==="auth/user-token-expired"}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ag{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){var n;if(t){const i=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),i}else{this.errorBackoff=3e4;const s=((n=this.user.stsTokenManager.expirationTime)!==null&&n!==void 0?n:0)-Date.now()-3e5;return Math.max(0,s)}}schedule(t=!1){if(!this.isRunning)return;const n=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},n)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){(t==null?void 0:t.code)==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class nr{constructor(t,n){this.createdAt=t,this.lastLoginAt=n,this._initializeTime()}_initializeTime(){this.lastSignInTime=Jn(this.lastLoginAt),this.creationTime=Jn(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function Rs(e){var t;const n=e.auth,i=await e.getIdToken(),s=await er(e,od(n,{idToken:i}));W(s==null?void 0:s.users.length,n,"internal-error");const o=s.users[0];e._notifyReloadListener(o);const r=!((t=o.providerUserInfo)===null||t===void 0)&&t.length?ad(o.providerUserInfo):[],a=cg(e.providerData,r),l=e.isAnonymous,c=!(e.email&&o.passwordHash)&&!(a!=null&&a.length),d=l?c:!1,u={uid:o.localId,displayName:o.displayName||null,photoURL:o.photoUrl||null,email:o.email||null,emailVerified:o.emailVerified||!1,phoneNumber:o.phoneNumber||null,tenantId:o.tenantId||null,providerData:a,metadata:new nr(o.createdAt,o.lastLoginAt),isAnonymous:d};Object.assign(e,u)}async function lg(e){const t=Ci(e);await Rs(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function cg(e,t){return[...e.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function ad(e){return e.map(t=>{var{providerId:n}=t,i=Kc(t,["providerId"]);return{providerId:n,uid:i.rawId||"",displayName:i.displayName||null,email:i.email||null,phoneNumber:i.phoneNumber||null,photoURL:i.photoUrl||null}})}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function dg(e,t){const n=await id(e,{},async()=>{const i=Uc({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:o}=e.config,r=sd(e,s,"/v1/token",`key=${o}`),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/x-www-form-urlencoded",ed.fetch()(r,{method:"POST",headers:a,body:i})});return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}async function ug(e,t){return to(e,"POST","/v2/accounts:revokeToken",nd(e,t))}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class un{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){W(t.idToken,"internal-error"),W(typeof t.idToken<"u","internal-error"),W(typeof t.refreshToken<"u","internal-error");const n="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):Ma(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,n)}updateFromIdToken(t){W(t.length!==0,"internal-error");const n=Ma(t);this.updateTokensAndExpiration(t,null,n)}async getToken(t,n=!1){return!n&&this.accessToken&&!this.isExpired?this.accessToken:(W(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,n){const{accessToken:i,refreshToken:s,expiresIn:o}=await dg(t,n);this.updateTokensAndExpiration(i,s,Number(o))}updateTokensAndExpiration(t,n,i){this.refreshToken=n||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,n){const{refreshToken:i,accessToken:s,expirationTime:o}=n,r=new un;return i&&(W(typeof i=="string","internal-error",{appName:t}),r.refreshToken=i),s&&(W(typeof s=="string","internal-error",{appName:t}),r.accessToken=s),o&&(W(typeof o=="number","internal-error",{appName:t}),r.expirationTime=o),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new un,this.toJSON())}_performRefresh(){return Kn("not implemented")}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function me(e,t){W(typeof e=="string"||typeof e>"u","internal-error",{appName:t})}class ve{constructor(t){var{uid:n,auth:i,stsTokenManager:s}=t,o=Kc(t,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new ag(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=n,this.auth=i,this.stsTokenManager=s,this.accessToken=s.accessToken,this.displayName=o.displayName||null,this.email=o.email||null,this.emailVerified=o.emailVerified||!1,this.phoneNumber=o.phoneNumber||null,this.photoURL=o.photoURL||null,this.isAnonymous=o.isAnonymous||!1,this.tenantId=o.tenantId||null,this.providerData=o.providerData?[...o.providerData]:[],this.metadata=new nr(o.createdAt||void 0,o.lastLoginAt||void 0)}async getIdToken(t){const n=await er(this,this.stsTokenManager.getToken(this.auth,t));return W(n,this.auth,"internal-error"),this.accessToken!==n&&(this.accessToken=n,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),n}getIdTokenResult(t){return og(this,t)}reload(){return lg(this)}_assign(t){this!==t&&(W(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(n=>Object.assign({},n)),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const n=new ve(Object.assign(Object.assign({},this),{auth:t,stsTokenManager:this.stsTokenManager._clone()}));return n.metadata._copy(this.metadata),n}_onReload(t){W(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,n=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),n&&await Rs(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(Nn(this.auth.app))return Promise.reject(us(this.auth));const t=await this.getIdToken();return await er(this,sg(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>Object.assign({},t)),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,n){var i,s,o,r,a,l,c,d;const u=(i=n.displayName)!==null&&i!==void 0?i:void 0,h=(s=n.email)!==null&&s!==void 0?s:void 0,f=(o=n.phoneNumber)!==null&&o!==void 0?o:void 0,g=(r=n.photoURL)!==null&&r!==void 0?r:void 0,p=(a=n.tenantId)!==null&&a!==void 0?a:void 0,m=(l=n._redirectEventId)!==null&&l!==void 0?l:void 0,b=(c=n.createdAt)!==null&&c!==void 0?c:void 0,y=(d=n.lastLoginAt)!==null&&d!==void 0?d:void 0,{uid:x,emailVerified:_,isAnonymous:v,providerData:w,stsTokenManager:k}=n;W(x&&k,t,"internal-error");const S=un.fromJSON(this.name,k);W(typeof x=="string",t,"internal-error"),me(u,t.name),me(h,t.name),W(typeof _=="boolean",t,"internal-error"),W(typeof v=="boolean",t,"internal-error"),me(f,t.name),me(g,t.name),me(p,t.name),me(m,t.name),me(b,t.name),me(y,t.name);const D=new ve({uid:x,auth:t,email:h,emailVerified:_,displayName:u,isAnonymous:v,photoURL:g,phoneNumber:f,tenantId:p,stsTokenManager:S,createdAt:b,lastLoginAt:y});return w&&Array.isArray(w)&&(D.providerData=w.map(A=>Object.assign({},A))),m&&(D._redirectEventId=m),D}static async _fromIdTokenResponse(t,n,i=!1){const s=new un;s.updateFromServerResponse(n);const o=new ve({uid:n.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await Rs(o),o}static async _fromGetAccountInfoResponse(t,n,i){const s=n.users[0];W(s.localId!==void 0,"internal-error");const o=s.providerUserInfo!==void 0?ad(s.providerUserInfo):[],r=!(s.email&&s.passwordHash)&&!(o!=null&&o.length),a=new un;a.updateFromIdToken(i);const l=new ve({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:r}),c={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new nr(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!(o!=null&&o.length)};return Object.assign(l,c),l}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Ca=new Map;function We(e){Ps(e instanceof Function,"Expected a class definition");let t=Ca.get(e);return t?(Ps(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,Ca.set(e,t),t)}/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class ld{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,n){this.storage[t]=n}async _get(t){const n=this.storage[t];return n===void 0?null:n}async _remove(t){delete this.storage[t]}_addListener(t,n){}_removeListener(t,n){}}ld.type="NONE";const Aa=ld;/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function vo(e,t,n){return`firebase:${e}:${t}:${n}`}class hn{constructor(t,n,i){this.persistence=t,this.auth=n,this.userKey=i;const{config:s,name:o}=this.auth;this.fullUserKey=vo(this.userKey,s.apiKey,o),this.fullPersistenceKey=vo("persistence",s.apiKey,o),this.boundEventHandler=n._onStorageEvent.bind(n),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);return t?ve._fromJSON(this.auth,t):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const n=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,n)return this.setCurrentUser(n)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,n,i="authUser"){if(!n.length)return new hn(We(Aa),t,i);const s=(await Promise.all(n.map(async c=>{if(await c._isAvailable())return c}))).filter(c=>c);let o=s[0]||We(Aa);const r=vo(i,t.config.apiKey,t.name);let a=null;for(const c of n)try{const d=await c._get(r);if(d){const u=ve._fromJSON(t,d);c!==o&&(a=u),o=c;break}}catch{}const l=s.filter(c=>c._shouldAllowMigration);return!o._shouldAllowMigration||!l.length?new hn(o,t,i):(o=l[0],a&&await o._set(r,a.toJSON()),await Promise.all(n.map(async c=>{if(c!==o)try{await c._remove(r)}catch{}})),new hn(o,t,i))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function La(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(pg(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(hg(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(bg(t))return"Blackberry";if(yg(t))return"Webos";if(fg(t))return"Safari";if((t.includes("chrome/")||gg(t))&&!t.includes("edge/"))return"Chrome";if(mg(t))return"Android";{const n=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=e.match(n);if((i==null?void 0:i.length)===2)return i[1]}return"Other"}function hg(e=Kt()){return/firefox\//i.test(e)}function fg(e=Kt()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function gg(e=Kt()){return/crios\//i.test(e)}function pg(e=Kt()){return/iemobile/i.test(e)}function mg(e=Kt()){return/android/i.test(e)}function bg(e=Kt()){return/blackberry/i.test(e)}function yg(e=Kt()){return/webos/i.test(e)}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function cd(e,t=[]){let n;switch(e){case"Browser":n=La(Kt());break;case"Worker":n=`${La(Kt())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${Br}/${i}`}/**
 * @license
 * Copyright 2022 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class vg{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,n){const i=o=>new Promise((r,a)=>{try{const l=t(o);r(l)}catch(l){a(l)}});i.onAbort=n,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const n=[];try{for(const i of this.queue)await i(t),i.onAbort&&n.push(i.onAbort)}catch(i){n.reverse();for(const s of n)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i==null?void 0:i.message})}}}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */async function xg(e,t={}){return to(e,"GET","/v2/passwordPolicy",nd(e,t))}/**
 * @license
 * Copyright 2023 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const _g=6;class wg{constructor(t){var n,i,s,o;const r=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=(n=r.minPasswordLength)!==null&&n!==void 0?n:_g,r.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=r.maxPasswordLength),r.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=r.containsLowercaseCharacter),r.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=r.containsUppercaseCharacter),r.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=r.containsNumericCharacter),r.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=r.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=(s=(i=t.allowedNonAlphanumericCharacters)===null||i===void 0?void 0:i.join(""))!==null&&s!==void 0?s:"",this.forceUpgradeOnSignin=(o=t.forceUpgradeOnSignin)!==null&&o!==void 0?o:!1,this.schemaVersion=t.schemaVersion}validatePassword(t){var n,i,s,o,r,a;const l={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,l),this.validatePasswordCharacterOptions(t,l),l.isValid&&(l.isValid=(n=l.meetsMinPasswordLength)!==null&&n!==void 0?n:!0),l.isValid&&(l.isValid=(i=l.meetsMaxPasswordLength)!==null&&i!==void 0?i:!0),l.isValid&&(l.isValid=(s=l.containsLowercaseLetter)!==null&&s!==void 0?s:!0),l.isValid&&(l.isValid=(o=l.containsUppercaseLetter)!==null&&o!==void 0?o:!0),l.isValid&&(l.isValid=(r=l.containsNumericCharacter)!==null&&r!==void 0?r:!0),l.isValid&&(l.isValid=(a=l.containsNonAlphanumericCharacter)!==null&&a!==void 0?a:!0),l}validatePasswordLengthOptions(t,n){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(n.meetsMinPasswordLength=t.length>=i),s&&(n.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,n){this.updatePasswordCharacterOptionsStatuses(n,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(n,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,n,i,s,o){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=n)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=o))}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class kg{constructor(t,n,i,s){this.app=t,this.heartbeatServiceProvider=n,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new Oa(this),this.idTokenSubscription=new Oa(this),this.beforeStateQueue=new vg(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=Zc,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion}_initializeWithPersistence(t,n){return n&&(this._popupRedirectResolver=We(n)),this._initializationPromise=this.queue(async()=>{var i,s;if(!this._deleted&&(this.persistenceManager=await hn.create(this,t),!this._deleted)){if(!((i=this._popupRedirectResolver)===null||i===void 0)&&i._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(n),this.lastNotifiedUid=((s=this.currentUser)===null||s===void 0?void 0:s.uid)||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const n=await od(this,{idToken:t}),i=await ve._fromGetAccountInfoResponse(this,n,t);await this.directlySetCurrentUser(i)}catch(n){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",n),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){var n;if(Nn(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(a=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(a,a))}):this.directlySetCurrentUser(null)}const i=await this.assertedPersistence.getCurrentUser();let s=i,o=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=(n=this.redirectUser)===null||n===void 0?void 0:n._redirectEventId,a=s==null?void 0:s._redirectEventId,l=await this.tryRedirectSignIn(t);(!r||r===a)&&(l!=null&&l.user)&&(s=l.user,o=!0)}if(!s)return this.directlySetCurrentUser(null);if(!s._redirectEventId){if(o)try{await this.beforeStateQueue.runMiddleware(s)}catch(r){s=i,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return s?this.reloadAndSetCurrentUserOrClear(s):this.directlySetCurrentUser(null)}return W(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===s._redirectEventId?this.directlySetCurrentUser(s):this.reloadAndSetCurrentUserOrClear(s)}async tryRedirectSignIn(t){let n=null;try{n=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return n}async reloadAndSetCurrentUserOrClear(t){try{await Rs(t)}catch(n){if((n==null?void 0:n.code)!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Qf()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(Nn(this.app))return Promise.reject(us(this));const n=t?Ci(t):null;return n&&W(n.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(n&&n._clone(this))}async _updateCurrentUser(t,n=!1){if(!this._deleted)return t&&W(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),n||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return Nn(this.app)?Promise.reject(us(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return Nn(this.app)?Promise.reject(us(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(We(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const n=this._getPasswordPolicyInternal();return n.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):n.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await xg(this),n=new wg(t);this.tenantId===null?this._projectPasswordPolicy=n:this._tenantPasswordPolicies[this.tenantId]=n}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(t){this._errorFactory=new Mi("auth","Firebase",t())}onAuthStateChanged(t,n,i){return this.registerStateListener(this.authStateSubscription,t,n,i)}beforeAuthStateChanged(t,n){return this.beforeStateQueue.pushCallback(t,n)}onIdTokenChanged(t,n,i){return this.registerStateListener(this.idTokenSubscription,t,n,i)}authStateReady(){return new Promise((t,n)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},n)}})}async revokeAccessToken(t){if(this.currentUser){const n=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:n};this.tenantId!=null&&(i.tenantId=this.tenantId),await ug(this,i)}}toJSON(){var t;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:(t=this._currentUser)===null||t===void 0?void 0:t.toJSON()}}async _setRedirectUser(t,n){const i=await this.getOrInitRedirectPersistenceManager(n);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const n=t&&We(t)||this._popupRedirectResolver;W(n,this,"argument-error"),this.redirectPersistenceManager=await hn.create(this,[We(n._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){var n,i;return this._isInitialized&&await this.queue(async()=>{}),((n=this._currentUser)===null||n===void 0?void 0:n._redirectEventId)===t?this._currentUser:((i=this.redirectUser)===null||i===void 0?void 0:i._redirectEventId)===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var t,n;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const i=(n=(t=this.currentUser)===null||t===void 0?void 0:t.uid)!==null&&n!==void 0?n:null;this.lastNotifiedUid!==i&&(this.lastNotifiedUid=i,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,n,i,s){if(this._deleted)return()=>{};const o=typeof n=="function"?n:n.next.bind(n);let r=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(W(a,this,"internal-error"),a.then(()=>{r||o(this.currentUser)}),typeof n=="function"){const l=t.addObserver(n,i,s);return()=>{r=!0,l()}}else{const l=t.addObserver(n);return()=>{r=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return W(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=cd(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var t;const n={"X-Client-Version":this.clientVersion};this.app.options.appId&&(n["X-Firebase-gmpid"]=this.app.options.appId);const i=await((t=this.heartbeatServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getHeartbeatsHeader());i&&(n["X-Firebase-Client"]=i);const s=await this._getAppCheckToken();return s&&(n["X-Firebase-AppCheck"]=s),n}async _getAppCheckToken(){var t;const n=await((t=this.appCheckServiceProvider.getImmediate({optional:!0}))===null||t===void 0?void 0:t.getToken());return n!=null&&n.error&&Kf(`Error while retrieving App Check token: ${n.error}`),n==null?void 0:n.token}}function Sg(e){return Ci(e)}class Oa{constructor(t){this.auth=t,this.observer=null,this.addObserver=jh(n=>this.observer=n)}get next(){return W(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}function Eg(e,t){const n=(t==null?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(We);t!=null&&t.errorMap&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,t==null?void 0:t.popupRedirectResolver)}function Ig(e){return Ci(e).signOut()}new Ai(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ai(2e3,1e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ai(3e4,6e4);/**
 * @license
 * Copyright 2020 Google LLC.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */new Ai(5e3,15e3);var Pa="@firebase/auth",Ra="1.7.9";/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */class Dg{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){var t;return this.assertAuthConfigured(),((t=this.auth.currentUser)===null||t===void 0?void 0:t.uid)||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const n=this.auth.onIdTokenChanged(i=>{t((i==null?void 0:i.stsTokenManager.accessToken)||null)});this.internalListeners.set(t,n),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const n=this.internalListeners.get(t);n&&(this.internalListeners.delete(t),n(),this.updateProactiveRefresh())}assertAuthConfigured(){W(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */function Tg(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function Mg(e){fi(new hi("auth",(t,{options:n})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),o=t.getProvider("app-check-internal"),{apiKey:r,authDomain:a}=i.options;W(r&&!r.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:r,authDomain:a,clientPlatform:e,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:cd(e)},c=new kg(i,s,o,l);return Eg(c,n),c},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,n,i)=>{t.getProvider("auth-internal").initialize()})),fi(new hi("auth-internal",t=>{const n=Sg(t.getProvider("auth").getImmediate());return(i=>new Dg(i))(n)},"PRIVATE").setInstantiationMode("EXPLICIT")),Xn(Pa,Ra,Tg(e)),Xn(Pa,Ra,"esm2017")}/**
 * @license
 * Copyright 2021 Google LLC
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */const Cg=300;Lh("authIdTokenMaxAge");Mg("Browser");const Ba=e=>e instanceof Cr?e.toDate():e,Fr=e=>e instanceof Date?Cr.fromDate(e):e;function dd(e,t){return{id:e,...t,createdAt:Ba(t.createdAt)||null,dueDate:Ba(t.dueDate)||null,recurrence:t.recurrence??null}}let ir=[];function Sn(){return ir}function Ag(e,t,n){const i=r=>{typeof n=="function"&&n(r)};if(!e||!t)return i([]),()=>{};const s=Y.tasks(e,t),o=Ze(ft(K,s));return kn(o,r=>{const a=r.docs.map(l=>dd(l.id,l.data()));ir=a,i(a)},r=>{console.error("[Tasks] Subscription error:",r),ir=[],i([])})}async function Lg(e,t){if(!e||!t)throw new Error("Missing parameters for backup.");const n=ft(K,Y.tasks(e,t)),i=ft(K,Y.projects(e,t)),s=ft(K,Y.labels(e)),[o,r,a]=await Promise.all([Gn(n),Gn(i),Gn(s)]),l=c=>c.docs.map(d=>{const u=d.data(),h={id:d.id};for(const f in u)h[f]=u[f]instanceof Cr?u[f].toDate().toISOString():u[f];return h});return{version:"1.2",exportedAt:new Date().toISOString(),userId:e,workspaceId:t,tasks:l(o),projects:l(r),labels:l(a)}}async function ud(e,t,n){const i=Y.tasks(e,t),s={...n};return s.dueDate&&(s.dueDate=Fr(s.dueDate)),await qe(ft(K,i),{...s,ownerId:e,status:"todo",createdAt:wn()})}async function Og(e,t,n,i){const s=Y.tasks(e,t);await Ii(Nt(K,s,n),{status:i})}async function Pg(e,t,n,i){const s=Y.tasks(e,t),o={...i};o.dueDate!==void 0&&(o.dueDate=Fr(o.dueDate)),await Ii(Nt(K,s,n),o)}async function Rg(e,t,n){const i=Y.tasks(e,t);await Di(Nt(K,i,n))}async function Bg(e,t,n){const i=Y.tasks(e,t),s=await eh(Nt(K,i,n));return s.exists()?dd(s.id,s.data()):null}async function Ng(e,t,n){if(!e||!t||!n)throw new Error("Invalid import parameters.");const{tasks:i=[],projects:s=[],labels:o=[]}=n,r=new Map,a=new Map,l=await Gn(ft(K,Y.labels(e))),c=new Map;l.forEach(u=>c.set(u.data().name,u.id));for(const u of o)if(u.name)if(c.has(u.name))a.set(u.id,c.get(u.name));else{const h={...u};delete h.id;const f=await qe(ft(K,Y.labels(e)),h);a.set(u.id,f.id),c.set(u.name,f.id)}for(const u of s){const h={...u};delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt));const f=await qe(ft(K,Y.projects(e,t)),h);r.set(u.id,f.id)}const d=i.map(async u=>{const h={...u};return delete h.id,typeof h.createdAt=="string"&&(h.createdAt=new Date(h.createdAt)),typeof h.dueDate=="string"&&(h.dueDate=new Date(h.dueDate)),h.dueDate&&(h.dueDate=Fr(h.dueDate)),h.projectId&&r.has(h.projectId)?h.projectId=r.get(h.projectId):h.projectId=null,Array.isArray(h.labelIds)&&(h.labelIds=h.labelIds.map(f=>a.get(f)).filter(f=>f)),h.ownerId=e,qe(ft(K,Y.tasks(e,t)),h)});return await Promise.all(d),{tasksCount:i.length,projectsCount:s.length,labelsCount:o.length}}function fe(e){if(!e)return null;if(e.toDate&&typeof e.toDate=="function")return e.toDate();if(e instanceof Date)return e;const t=new Date(e);return isNaN(t.getTime())?null:t}function En(e=new Date){const t=fe(e)||new Date,n=new Date(t);return n.setHours(0,0,0,0),n}function Fg(e=new Date){const t=fe(e)||new Date,n=new Date(t);return n.setHours(23,59,59,999),n}function hd(e=new Date){const t=fe(e)||new Date,n=t.getDay(),i=t.getDate()-n+(n===0?-6:1),s=new Date(t.setDate(i));return En(s)}function Hg(e=new Date){const t=fe(e)||new Date;return new Date(t.getFullYear(),t.getMonth(),1)}function $g(e){const t=fe(e);if(!t)return"";const n=new Date,i=En(n),s=Math.round((t.getTime()-i.getTime())/(1e3*60*60*24));if(s===0)return"今日";if(s===1)return"明日";if(s===-1)return"昨日";const o=t.getFullYear(),r=String(t.getMonth()+1).padStart(2,"0"),a=String(t.getDate()).padStart(2,"0");return o!==n.getFullYear()?`${o}/${r}/${a}`:`${r}/${a}`}function zg(e){const t=fe(e);if(!t)return"text-gray-500";const n=En(new Date),i=Math.round((t.getTime()-n.getTime())/(1e3*60*60*24));return i<0?"text-red-500 font-bold":i===0?"text-green-600 dark:text-green-400 font-medium":i===1?"text-orange-500 dark:text-orange-400 font-medium":"text-gray-500 dark:text-gray-400"}function jg(e,t){var i;if(!e||!(t!=null&&t.type))return null;const n=new Date(fe(e));switch(t.type){case"daily":return n.setDate(n.getDate()+1),n;case"weekly":if(!((i=t.days)!=null&&i.length))return null;const s=n.getDay();for(let o=1;o<=7;o++)if(t.days.includes((s+o)%7))return n.setDate(n.getDate()+o),n;return null;case"weekdays":do n.setDate(n.getDate()+1);while(n.getDay()===0||n.getDay()===6);return n;case"monthly":return n.setMonth(n.getMonth()+1),n;default:return null}}function fd(e){var n;const t=En(new Date);if(!(e!=null&&e.type)||e.type==="daily"||e.type==="monthly")return t;if(e.type==="weekly"&&((n=e.days)==null?void 0:n.length)>0){const i=t.getDay();for(let s=0;s<=6;s++)if(e.days.includes((i+s)%7))return t.setDate(t.getDate()+s),t}if(e.type==="weekdays"){for(;t.getDay()===0||t.getDay()===6;)t.setDate(t.getDate()+1);return t}return t}function In(){var t;const e=(t=V.currentUser)==null?void 0:t.uid;if(!e)throw new Error("Authentication required.");return e}function Dn(){const e=Zt();if(!e)throw new Error("Workspace required.");return e}async function Vg(e){var o;if(e.status!=="completed"||!e.recurrence)return;const{recurrence:t,dueDate:n}=e;if(!n||typeof t!="object"||!t.type)return;const i=jg(n,t);if(!i)return;const s={title:e.title,description:e.description||"",status:"todo",dueDate:i,projectId:e.projectId||null,labelIds:e.labelIds||[],recurrence:e.recurrence};try{const r=(o=V.currentUser)==null?void 0:o.uid,a=Zt();r&&a&&await ud(r,a,s)}catch(r){console.error("[Recurring] Generation failed:",r)}}async function Ug(e){const t=In(),n=Dn(),i={...e};return i.dueDate&&!(i.dueDate instanceof Date)&&(i.dueDate=new Date(i.dueDate),isNaN(i.dueDate.getTime())&&(i.dueDate=null)),ud(t,n,i)}async function Wg(e,t){const n=In(),i=Dn();if(await Og(n,i,e,t),t==="completed"){const s=await Bg(n,i,e);s&&Vg(s).catch(o=>console.error(o))}}async function Zn(e,t){const n=In(),i=Dn();return Pg(n,i,e,t)}async function gd(e){const t=In(),n=Dn();return Rg(t,n,e)}async function Yg(){const e=In(),t=Dn();return Lg(e,t)}async function qg(e){const t=In(),n=Dn();return Ng(t,n,e)}let Qn=[];function pd(){return Qn}function Gg(){Qn=[]}function Xg(e,t){var r;const n=typeof e=="function"?e:t,i=(r=V.currentUser)==null?void 0:r.uid;if(!i||typeof n!="function")return Qn=[],typeof n=="function"&&n([]),()=>{};const s=Y.filters(i),o=Ze(ft(K,s));return kn(o,a=>{const l=a.docs.map(c=>({id:c.id,...c.data()}));Qn=l,n(l)},a=>{console.error("Error subscribing to filters:",a),Qn=[],n([])})}async function Kg(e){var o;const t=(o=V.currentUser)==null?void 0:o.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t),{id:i,...s}=e;await qe(ft(K,n),{...s,ownerId:t,createdAt:wn()})}async function Jg(e,t){var r;const n=(r=V.currentUser)==null?void 0:r.uid;if(!n)throw new Error("Authentication required");const i=Y.filters(n),{id:s,...o}=t;await Ii(Nt(K,i,e),{...o,updatedAt:wn()})}async function Zg(e){var i;const t=(i=V.currentUser)==null?void 0:i.uid;if(!t)throw new Error("Authentication required");const n=Y.filters(t);await Di(Nt(K,n,e))}let sr=[];function Qg(){return sr}function tp(e,t){if(!e)return t([]),()=>{};const n=Y.labels(e),{db:i}=Pc(),s=Ze(ft(i,n));return kn(s,o=>{const r=o.docs.map(a=>({id:a.id,...a.data()}));sr=r,t(r)},o=>{console.error("[Labels] Subscription error:",o),sr=[],t([])})}function ep(e,t){var s;const n=typeof e=="function"?e:t,i=(s=V.currentUser)==null?void 0:s.uid;return i&&typeof n=="function"?tp(i,n):(typeof n=="function"&&n([]),()=>{})}let xo=null;function eo(){return xo||(xo=Pc().db),xo}let hs=[];function np(e,t,n){hs=[];const i=Y.projects(e,t),s=eo(),o=Ze(ft(s,i),Mr("createdAt","asc"));return kn(o,r=>{const a=r.docs.map(l=>({id:l.id,...l.data()}));hs=a,n(a)},r=>{console.error("Error subscribing to projects:",r),hs=[],n([])})}function Hr(){return hs}async function ip(e,t,n){const i=Y.projects(e,t),s=eo();await qe(ft(s,i),{name:n,ownerId:e,createdAt:wn()})}async function sp(e,t,n,i){const s=Y.projects(e,t),o=eo(),r=Nt(o,s,n);return Ii(r,i)}async function op(e,t,n){const i=Y.projects(e,t),s=eo();await Di(Nt(s,i,n))}function md(){var n;const e=(n=V.currentUser)==null?void 0:n.uid,t=Zt();if(!e||!t)throw new Error("Authentication or Workspace required.");return{userId:e,workspaceId:t}}const rp=Hr,ap=(e,t)=>{const n=typeof e=="function"?e:t,i=typeof e=="string"?e:Zt(),s=V.currentUser;return s&&i&&typeof n=="function"?np(s.uid,i,n):(typeof n=="function"&&n([]),()=>{})},lp=async(e,t=null)=>{const n=V.currentUser;if(!n)throw new Error("Authentication required.");const i=t||Zt();if(!i)throw new Error("Workspace selection required.");return ip(n.uid,i,e)},cp=async(e,t)=>{const{userId:n,workspaceId:i}=md();return sp(n,i,e,t)},bd=async e=>{const{userId:t,workspaceId:n}=md();return op(t,n,e)};let xe=[];const dp=[{id:"tb_morning",name:"06:00 - 09:00",start:"06:00",end:"09:00",color:"#EF4444",order:0},{id:"tb_afternoon",name:"13:00 - 17:00",start:"13:00",end:"17:00",color:"#3B82F6",order:1},{id:"tb_night",name:"20:00 - 22:00",start:"20:00",end:"22:00",color:"#8B5CF6",order:2}];function up(e,t){var o;const n=(o=V.currentUser)==null?void 0:o.uid;if(!n)return xe=[...dp],typeof t=="function"&&t(xe),()=>{};const i=Y.timeblocks(n),s=Ze(ft(K,i),Mr("order","asc"));return kn(s,r=>{xe=r.docs.map(a=>({id:a.id,...a.data()})),typeof t=="function"&&t(xe)},r=>{console.error("[TimeBlocks] Subscription error:",r)})}function ue(){return[...xe]}function hp(e){return xe.find(t=>t.id===e)}function fp(){xe=[]}async function gp(e){var n;const t=(n=V.currentUser)==null?void 0:n.uid;if(!t){L("ログインが必要です");return}try{const i=Y.timeblocks(t),s=e.id||crypto.randomUUID(),o=e.order!==void 0?e.order:Math.max(...xe.map(a=>a.order),-1)+1,r={name:e.name,start:e.start,end:e.end,color:e.color,order:o,updatedAt:wn()};return await nh(Nt(K,i,s),r,{merge:!0}),!0}catch(i){console.error("[TimeBlocks] Save error:",i),L("保存に失敗した。")}}async function pp(e){var n;const t=(n=V.currentUser)==null?void 0:n.uid;if(t)try{const i=Y.timeblocks(t);return await Di(Nt(K,i,e)),!0}catch(i){console.error("[TimeBlocks] Delete error:",i)}}function mp(e,t){const n=V.currentUser;return!n||!e?(typeof t=="function"&&t([]),()=>{}):Ag(n.uid,e,t)}function bp(){const e=localStorage.theme==="dark"||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches;document.documentElement.classList.toggle("dark",e);const t=localStorage.getItem("fontSize")||"medium";document.body.classList.remove("font-large","font-medium","font-small"),document.body.classList.add(`font-${t}`),or()}function or(){const e=document.getElementById("main-content");if(!e)return;const t=localStorage.getItem("background")||"none";e.style.backgroundImage="",t!=="none"&&t==="haikei"&&(document.documentElement.classList.contains("dark"),Object.assign(e.style,{backgroundImage:"url('/images/haikei_black_1.jpg')",backgroundSize:"cover",backgroundPosition:"center",backgroundAttachment:"fixed",backgroundRepeat:"no-repeat"}))}function yp(e,t){["close-settings-modal","close-settings-footer"].forEach(i=>{var s;return(s=document.getElementById(i))==null?void 0:s.addEventListener("click",t)}),e.addEventListener("click",i=>{i.target===e&&t()}),Fi("app-theme","theme",i=>{document.documentElement.classList.toggle("dark",i==="dark"),or()}),Fi("font-size","fontSize",i=>{const s=["font-app-sm","font-app-base","font-app-md","font-app-lg","font-app-xl"];document.body.classList.remove(...s),document.body.classList.add(`font-app-${i}`)}),Fi("bg-pattern","background",()=>or()),Fi("sidebar-density",B.STORAGE_KEYS.DENSITY,i=>{i==="compact"?localStorage.setItem(B.STORAGE_KEYS.COMPACT,"true"):localStorage.setItem(B.STORAGE_KEYS.COMPACT,"false"),window.dispatchEvent(new CustomEvent("sidebar-settings-updated",{detail:{density:i}}))}),vp(),xp(),_p(),wp(),kp(t)}function Fi(e,t,n){const i=document.querySelectorAll(`input[name="${e}"]`),s=localStorage.getItem(t);if(i.forEach(o=>{o.addEventListener("change",r=>{const a=r.target.value;localStorage.setItem(t,a),n(a)})}),s)i.forEach(o=>{o.checked=o.value===s});else{const o=Array.from(i).find(r=>r.checked);o&&localStorage.setItem(t,o.value)}}function vp(){const e=document.querySelector('select[name="font-en-select"]'),t=document.querySelector('select[name="font-jp-select"]');e&&e.addEventListener("change",n=>{pa("EN",n.target.value)}),t&&t.addEventListener("change",n=>{pa("JP",n.target.value)})}function xp(){const e=document.getElementById("export-data-btn-new");e&&(e.onclick=async()=>{const t=e.querySelector("span.font-bold"),n=t?t.textContent:"バックアップを作成";e.disabled=!0,e.classList.add("opacity-70","cursor-wait"),t&&(t.textContent="バックアップ作成中...");try{const i=await Yg(),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,19),o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),a=document.createElement("a");a.href=r,a.download=`backup_${s}.json`,a.click(),URL.revokeObjectURL(r),L({message:"バックアップをダウンロードしたぞ",type:"success"})}catch(i){console.error(i),L({message:"エクスポートに失敗した",type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait"),t&&(t.textContent=n)}})}function _p(){const e=document.getElementById("import-data-btn-new"),t=document.getElementById("import-file-input");!e||!t||(e.onclick=()=>{t.value="",t.click()},t.onchange=n=>{const i=n.target.files[0];if(!i)return;const s=new FileReader;s.onload=async o=>{try{const r=JSON.parse(o.target.result);if(!r.tasks||!r.projects)throw new Error("Invalid backup format");e.disabled=!0,e.classList.add("opacity-70","cursor-wait");const a=await qg(r);L({message:`インポート完了！
タスク: ${a.tasksCount}件
プロジェクト: ${a.projectsCount}件
ラベル: ${a.labelsCount}件`,type:"success"}),setTimeout(()=>window.location.reload(),1500)}catch(r){console.error(r),L({message:`インポートに失敗しました。
ファイルが破損している可能性があります。`,type:"error"})}finally{e.disabled=!1,e.classList.remove("opacity-70","cursor-wait")}},s.readAsText(i)})}function wp(){const e=document.getElementById("update-password-btn-new"),t=document.getElementById("new-password-input-new");!e||!t||(e.onclick=async()=>{const n=t.value.trim();if(n.length<6)return L({message:"6文字以上入力してくれ",type:"error"});try{await ch(n),t.value="",L({message:"パスワードを変更しました",type:"success"})}catch{}})}function kp(e){var t;(t=document.getElementById("logout-btn-settings"))==null||t.addEventListener("click",async()=>{try{await Ig(V),e()}catch{L({message:"エラーが発生した",type:"error"})}})}let Na=!1;function Fa(){var e;(e=document.getElementById(B.MODAL_IDS.SETTINGS))==null||e.remove()}function Sp(){if(Na)return;Hc(),_h();const e=t=>{t.target.closest("#nav-settings")&&(t.preventDefault(),no())};document.addEventListener("click",e),Na=!0}function no(){Fa();const e=hh(),t=V.currentUser,n=(t==null?void 0:t.email)||"匿名ユーザー",i=(n[0]||"?").toUpperCase(),s=document.createElement("div");s.id=B.MODAL_IDS.SETTINGS,s.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-50 p-4 animate-fade-in",s.innerHTML=kh(i,n,e),document.body.appendChild(s),yp(s,Fa)}function Ep(e=null){const t=!!e,n={title:t?"ワークスペース名の変更":"新規ワークスペース",btnText:t?"保存":"作成",placeholder:"ワークスペース名を入力...",description:t?"ワークスペースの名前を変更します。":"新しいワークスペースを作成します。プロジェクトやタスクを個別に管理できるようになります。"};return`
        <div class="fixed inset-0 z-[100] flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in" id="workspace-modal-overlay">
            <div class="bg-white dark:bg-gray-800 w-full max-w-md rounded-xl shadow-2xl overflow-hidden flex flex-col transform transition-all" role="dialog">
                
                <!-- ヘッダー -->
                <div class="px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <h2 class="text-xs font-bold text-gray-400 dark:text-gray-500 uppercase tracking-widest mb-2">${n.title}</h2>
                    <input type="text" id="modal-workspace-name" 
                        value="${(e==null?void 0:e.name)||""}" 
                        placeholder="${n.placeholder}"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-8">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-end items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    <button id="cancel-modal-btn" class="px-4 py-2 text-sm font-medium text-gray-500 hover:text-gray-800 dark:hover:text-gray-200 transition">キャンセル</button>
                    <button id="save-workspace-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 disabled:bg-blue-400 disabled:cursor-not-allowed text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                        ${n.btnText}
                    </button>
                </div>
            </div>
        </div>
    `}function yd(e=null){var i;const t="workspace-modal-root";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Ep(e),document.body.appendChild(n),Ip(n,e)}function Ip(e,t){const n=e.querySelector("#save-workspace-btn"),i=e.querySelector("#modal-workspace-name"),s=e.querySelector("#cancel-modal-btn"),o=e.querySelector("#workspace-modal-overlay"),r=()=>{document.removeEventListener("keydown",a),e.remove()},a=c=>{c.key==="Escape"&&r()};document.addEventListener("keydown",a),o.onclick=c=>{c.target===o&&r()},s&&(s.onclick=r);const l=async()=>{if(n.disabled)return;const c=i==null?void 0:i.value.trim();if(!c)return L({message:"ワークスペース名を入力してくれ",type:"error"});if(Jo().some(u=>u.name===c&&u.id!==(t==null?void 0:t.id)))return L({message:"その名前は既に使われているぞ",type:"error"});n.disabled=!0,n.textContent=t?"更新中...":"作成中...";try{if(t)await yh(t.id,c);else{const u=await Fc(c);Or(u.id)}r()}catch(u){n.disabled=!1,n.textContent=t?"保存":"作成",L({message:`失敗した: ${u.message}`,type:"error"})}};n==null||n.addEventListener("click",l),i==null||i.addEventListener("keydown",c=>{c.key==="Enter"&&l()}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}const Bs="none",_o={NAME_REQUIRED:"フィルター名を入力してくれ",CONDITION_REQUIRED:"少なくとも1つの条件を選択してくれ",SAVE_ERROR:"保存に失敗したぞ: "};function vd(e=null){const t=!!e,n=rp(),i=ue(),s=[30,45,60,75,90],o=Dp((e==null?void 0:e.query)||""),r=document.createElement("div");r.id="filter-creation-modal",r.className="fixed inset-0 bg-black/60 backdrop-blur-sm flex items-center justify-center z-[70] p-4 animate-fade-in",r.innerHTML=`
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl w-full max-w-4xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog" aria-modal="true">
            <div class="px-4 py-3 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center">
                <h3 class="text-base font-bold text-gray-800 dark:text-white">${t?"フィルター編集":"フィルター作成"}</h3>
                <button id="close-filter-modal" class="text-gray-400 hover:text-gray-700 transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            <div class="p-4 overflow-y-auto flex-1 space-y-6 custom-scrollbar">
                <div>
                    <label class="block text-xs font-bold text-gray-500 uppercase mb-1.5 tracking-wider">フィルター名</label>
                    <input type="text" id="filter-name" value="${(e==null?void 0:e.name)||""}" 
                           class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 outline-none transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                    ${rr("プロジェクト",n,o.project,"filter-project-checkbox")}
                    ${Tp(i,o.timeblock)}
                    ${rr("所要時間",s,o.duration,"filter-duration-checkbox",a=>`${a} min`)}
                </div>
            </div>
            <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900 flex justify-end gap-3 border-t border-gray-100 dark:border-gray-700">
                <button id="cancel-filter-btn" class="text-sm font-medium text-gray-500 hover:text-gray-800 transition">キャンセル</button>
                <button id="save-filter-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all active:scale-95">
                    ${t?"変更を保存":"作成"}
                </button>
            </div>
        </div>
    `,document.body.appendChild(r),Mp(r,e)}function Dp(e){const t={project:[],timeblock:[],duration:[]},n=/(\w+):([^ ]+)/g;let i;for(;(i=n.exec(e))!==null;){const[s,o,r]=i;t[o]&&(t[o]=r.split(",").map(a=>o==="timeblock"&&(a==="null"||a==="none")?Bs:a))}return t}function rr(e,t,n,i,s=o=>o.name||o){return`
        <div class="flex flex-col h-64 border border-gray-100 dark:border-gray-700 rounded-lg overflow-hidden bg-white dark:bg-gray-900">
            <div class="px-3 py-2 bg-gray-50 dark:bg-gray-800/50 border-b border-gray-100 dark:border-gray-700 text-xs font-bold text-gray-500">${e}</div>
            <div class="p-2 overflow-y-auto space-y-1 custom-scrollbar">
                ${t.map(o=>{const r=String(o.id||o);return`
                        <label class="flex items-center px-2 py-1.5 hover:bg-gray-100 dark:hover:bg-gray-800 rounded cursor-pointer transition">
                            <input type="checkbox" value="${r}" ${n.includes(r)?"checked":""} class="${i} h-4 w-4 text-blue-600 rounded">
                            <span class="ml-2 text-sm text-gray-700 dark:text-gray-300 truncate">${s(o)}</span>
                        </label>
                    `}).join("")}
            </div>
        </div>
    `}function Tp(e,t){const n=[{id:Bs,name:"未定"},...e];return rr("時間帯",n,t,"filter-timeblock-checkbox",i=>i.id===Bs?i.name:`${i.start}-${i.end}`)}function Mp(e,t){const n=()=>{document.removeEventListener("keydown",i),e.remove()},i=s=>s.key==="Escape"&&n();document.addEventListener("keydown",i),e.querySelector("#close-filter-modal").onclick=n,e.querySelector("#cancel-filter-btn").onclick=n,e.onclick=s=>s.target===e&&n(),e.querySelector("#save-filter-btn").onclick=async()=>{const s=e.querySelector("#filter-name").value.trim();if(!s)return L({message:_o.NAME_REQUIRED,type:"error"});const o=c=>Array.from(e.querySelectorAll(`.${c}:checked`)).map(d=>d.value),r=o("filter-timeblock-checkbox").map(c=>c===Bs?"null":c),a={project:o("filter-project-checkbox"),timeblock:r,duration:o("filter-duration-checkbox")},l=Object.entries(a).filter(([c,d])=>d.length>0).map(([c,d])=>`${c}:${d.join(",")}`).join(" ");if(!l)return L({message:_o.CONDITION_REQUIRED,type:"error"});try{const c={name:s,query:l,type:"custom"};t?await Jg(t.id,c):await Kg(c),document.dispatchEvent(new CustomEvent("filters-updated")),n()}catch(c){L({message:_o.SAVE_ERROR+c.message,type:"error"})}}}function Cp(e=null){const t=!!e,n={title:(e==null?void 0:e.name)||"",placeholder:t?"プロジェクト名":"新しいプロジェクト名",description:t?"プロジェクト名を変更するぞ。":"新しいプロジェクトを作成する。",btnText:t?"保存":"作成"},i=t?`
        <button id="delete-project-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center gap-1.5 px-3 py-2 rounded-lg hover:bg-red-50 dark:hover:bg-red-900/20 transition-all group">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `:"<span></span>";return`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 backdrop-blur-sm p-4 animate-fade-in">
            <div class="bg-white dark:bg-gray-800 w-full max-w-lg rounded-xl shadow-2xl overflow-hidden flex flex-col" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-project-name" value="${n.title}" placeholder="${n.placeholder}"
                        class="w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-400">
                </div>

                <!-- ボディ -->
                <div class="px-6 py-10 flex-1">
                    <p class="text-sm text-gray-500 dark:text-gray-400 leading-relaxed text-center">
                        ${n.description}
                    </p>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700 gap-3">
                    ${i}
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-project-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition-all transform active:scale-95">
                            ${n.btnText}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `}function xd(e=null){var i;const t="project-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.innerHTML=Cp(e),document.body.appendChild(n),Ap(n,e)}function Ap(e,t){const n=()=>e.remove(),i=e.querySelector("#modal-project-name"),s=e.querySelector("#save-project-btn"),o=e.querySelector("#delete-project-btn"),r=e.querySelector("#cancel-modal-btn");r&&(r.onclick=n),e.onclick=l=>{l.target===e&&n()};const a=async()=>{const l=i==null?void 0:i.value.trim();if(!l)return L({message:"プロジェクト名を入力してくれ",type:"error"});try{if(t)await cp(t.id,{name:l});else{const c=Zt();if(!c)throw new Error("ワークスペースが選択されていないぞ");await lp(l,c)}n()}catch(c){L({message:"保存に失敗した: "+c.message,type:"error"})}};s&&(s.onclick=a),i&&(i.onkeydown=l=>{l.key==="Enter"&&!l.isComposing&&a()}),o&&t&&(o.onclick=()=>{L({message:`プロジェクト「${t.name}」を削除するか？`,type:"confirm",onConfirm:async()=>{try{await bd(t.id),n()}catch{L({message:"削除に失敗した",type:"error"})}}})}),requestAnimationFrame(()=>{i&&(i.focus(),t&&i.select())})}function pi(e,t,n,i={},s=0,o="normal"){const r=document.createElement("li"),{DENSITY_CLASSES:a,COLORS:l}=B;r.dataset.type=t,r.dataset.id=n;const c=a[o]||a.normal;r.className=`group flex items-center justify-between px-3 ${c} font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md cursor-pointer transition-colors sidebar-item-row select-none`;const u={project:'<svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-6l-2-2H5a2 2 0 00-2 2z"></path></svg>',label:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,timeblock:`<span class="w-2.5 h-2.5 rounded-full mr-2.5 flex-shrink-0" style="background-color: ${i.color||l.DEFAULT}"></span>`,duration:i.iconHtml||'<span class="mr-3">⏱️</span>',filter:i.iconHtml||'<span class="mr-3">🔍</span>'}[t]||'<span class="mr-3">🔹</span>',h=s>0?`<span class="text-gray-400 font-light mr-2" style="font-size: 0.85em;">${s}</span>`:"";return r.innerHTML=`
        <div class="flex items-center flex-1 min-w-0 pointer-events-none">
            ${u}
            <span class="truncate">${e}</span>
        </div>
        <div class="flex items-center">${h}</div>
    `,r}function $r(e,t,n){var o;const i=Lp(t,n);if(!i)return;(o=document.getElementById("sidebar-context-menu"))==null||o.remove();const s=Op(i);document.body.appendChild(s),Pp(s,e),Rp(s,i)}function wo(e,t=null){document.dispatchEvent(new CustomEvent("route-change",{detail:{page:e,id:t}}))}function Lp(e,t){return{project:{editLabel:"編集",onEdit:()=>xd(t),onDelete:async()=>{await bd(t.id),wo("inbox")},deleteMsg:`${t.name} を削除するか？
（関連タスクのプロジェクト情報も削除される）`},filter:{editLabel:"編集 / 名前変更",onEdit:()=>vd(t),onDelete:async()=>{await Zg(t.id),wo("inbox")},deleteMsg:`フィルター「${t.name}」を削除するか？`},workspace:{editLabel:"名前変更",onEdit:()=>yd(t),onDelete:async()=>{if(Jo().length<=1)throw new Error("最後のワークスペースは削除できない。");await vh(t.id);const s=Jo().filter(o=>o.id!==t.id);s.length>0&&(Or(s[0].id),wo("dashboard"))},deleteMsg:`ワークスペース「${t.name}」を本当に削除するか？
関連データもすべて削除される。`}}[e]}function Op(e){const t=document.createElement("div");return t.id="sidebar-context-menu",t.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-[100] animate-fade-in text-sm min-w-[160px]",t.innerHTML=`
        <button id="ctx-edit-btn" class="flex w-full items-center px-3 py-2 hover:bg-gray-100 dark:hover:bg-gray-700 transition text-gray-700 dark:text-gray-200">
            <svg class="w-4 h-4 mr-2 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            ${e.editLabel}
        </button>
        <button id="ctx-delete-btn" class="flex w-full items-center px-3 py-2 text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition border-t border-gray-100 dark:border-gray-700">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,t}function Pp(e,t){const{clientX:i,clientY:s}=t,o=window.innerWidth,r=window.innerHeight;e.style.visibility="hidden";const{width:a,height:l}=e.getBoundingClientRect();let c=i,d=s;i+a>o&&(c=i-a),s+l>r&&(d=s-l),e.style.left=`${Math.max(8,c)}px`,e.style.top=`${Math.max(8,d)}px`,e.style.visibility="visible"}function Rp(e,t){const n=()=>{e.remove(),document.removeEventListener("click",n),document.removeEventListener("keydown",i)},i=s=>s.key==="Escape"&&n();setTimeout(()=>{document.addEventListener("click",n),document.addEventListener("keydown",i)},0),e.querySelector("#ctx-edit-btn").onclick=s=>{s.stopPropagation(),n(),t.onEdit()},e.querySelector("#ctx-delete-btn").onclick=s=>{s.stopPropagation(),n(),L({message:t.deleteMsg,type:"confirm",onConfirm:async()=>{try{await t.onDelete()}catch(o){L({message:"削除に失敗した: "+o.message,type:"error"})}}})}}const Hi={MENU_VISIBLE:["opacity-100","visible","scale-100","pointer-events-auto"],MENU_INVISIBLE:["opacity-0","invisible","scale-95","pointer-events-none"]};let qt=null,ti=null,Ha=!1;function ei(e){qt&&(e?(qt.classList.remove(...Hi.MENU_INVISIBLE),qt.classList.add(...Hi.MENU_VISIBLE),document.addEventListener("click",$a,{capture:!0})):(qt.classList.remove(...Hi.MENU_VISIBLE),qt.classList.add(...Hi.MENU_INVISIBLE),document.removeEventListener("click",$a,{capture:!0})))}const $a=e=>{qt&&!qt.contains(e.target)&&ti&&!ti.contains(e.target)&&ei(!1)};function _d(){if(Ha)return;ti=document.getElementById("workspace-trigger"),qt=document.getElementById("workspace-menu");const e=document.getElementById("add-workspace-btn"),t=document.getElementById("settings-workspace-btn");!ti||!qt||(ti.onclick=n=>{n.stopPropagation();const i=qt.classList.contains("opacity-100");ei(!i)},e&&(e.onclick=()=>{ei(!1),yd(null)}),t&&(t.onclick=()=>{ei(!1),no()}),document.addEventListener("workspace-changed",n=>{const{workspaceId:i,workspaces:s}=n.detail;wd(s,i)}),Ha=!0)}function wd(e,t=Zt()){const n=document.getElementById("workspace-list"),i=document.getElementById("workspace-label");if(n&&Bp(e,n,t),i){const s=e.find(o=>o.id===t);i.textContent=s?s.name:"ワークスペース",i.classList.toggle("text-gray-400",!s)}}function Bp(e,t,n){t.innerHTML="",e.forEach(i=>{const s=i.id===n,o=document.createElement("button");o.className=`workspace-option w-full text-left px-4 py-2 text-sm flex items-center justify-between transition-colors ${s?"bg-blue-50 dark:bg-blue-900/20 text-blue-700 dark:text-blue-300 font-medium":"text-gray-700 dark:text-gray-300 hover:bg-gray-50 dark:hover:bg-gray-700"}`;const r=document.createElement("span");if(r.className="truncate pointer-events-none",r.textContent=i.name,o.appendChild(r),s){const a=document.createElement("div");a.innerHTML=`
                <svg class="w-4 h-4 text-blue-600 dark:text-blue-400 flex-shrink-0 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
                </svg>
            `,o.appendChild(a.firstElementChild)}o.onclick=()=>{s||Or(i.id),ei(!1)},o.oncontextmenu=a=>{a.preventDefault(),$r(a,"workspace",i)},t.appendChild(o)})}const{Z_INDEX:fn}=uh,Np=()=>`
    <div id="sidebar-overlay" class="fixed inset-0 bg-black/50 z-[${fn.OVERLAY}] hidden md:hidden transition-opacity duration-300"></div>
    <aside id="sidebar" class="flex-shrink-0 flex flex-col border-r border-gray-200 dark:border-gray-800 bg-gray-50 dark:bg-gray-950 transition-all duration-300 group z-[${fn.SIDEBAR}] fixed md:relative h-full md:translate-x-0 -translate-x-full shadow-xl md:shadow-none" style="width: ${B.DEFAULT_WIDTH}px;">
        ${Fp()}
        <div id="sidebar-content" class="flex-1 overflow-y-auto py-2 custom-scrollbar"></div>
        <div id="sidebar-resizer" class="absolute top-0 right-0 w-1 h-full cursor-col-resize hover:bg-blue-500 transition-colors z-[${fn.MODAL}] opacity-0 group-hover:opacity-100 hidden md:block"></div>
    </aside>
`,Fp=()=>`
    <div class="h-12 flex items-center px-4 flex-shrink-0 justify-between">
        <div class="flex items-center gap-3 cursor-pointer hover:opacity-80 transition select-none">
            <img src="/images/web-app-manifest-512x512.png" alt="Logo" class="h-9 w-9 rounded-lg shadow-sm">
            <span class="text-lg font-bold text-gray-800 dark:text-white tracking-tight">Task<span class="text-blue-600 dark:text-blue-400">Mg</span></span>
        </div>
        <button id="sidebar-close-btn" class="text-gray-400 hover:text-gray-700 dark:hover:text-gray-200 p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-800" title="サイドバーを閉じる">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 19l-7-7 7-7m8 14l-7-7 7-7"></path></svg>
        </button>
    </div>
`,Hp=()=>`
    <header class="h-12 flex items-center justify-between px-4 border-b border-white/20 dark:border-gray-800/50 flex-shrink-0 bg-white/70 dark:bg-gray-900/60 backdrop-blur-md z-[${fn.HEADER}] relative">
        <div class="flex items-center min-w-0 flex-1 mr-4">
            <button id="sidebar-open-btn" class="mr-2 text-gray-500 hover:text-gray-700 p-1 rounded-md hover:bg-gray-100 dark:hover:bg-gray-800">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
            </button>
            <div id="workspace-dropdown" class="relative inline-block text-left mr-3 z-[${fn.DROPDOWN}]">
                <button id="workspace-trigger" class="flex items-center space-x-1 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md px-2 py-1 focus:outline-none group">
                    <span id="workspace-label" class="text-sm font-bold text-gray-800 dark:text-gray-200 max-w-[140px] truncate">読み込み中...</span>
                    <svg class="w-4 h-4 text-gray-400 group-hover:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                </button>
                <div id="workspace-menu" class="absolute left-0 mt-2 w-60 origin-top-left rounded-lg shadow-2xl bg-white dark:bg-gray-800 ring-1 ring-black/5 opacity-0 invisible scale-95 transition-all duration-150 transform pointer-events-none border border-gray-100 dark:border-gray-700 z-50">
                    <div class="py-1 max-h-[300px] overflow-y-auto custom-scrollbar bg-white dark:bg-gray-800" id="workspace-list"></div>
                    <div class="border-t border-gray-200 dark:border-gray-700 my-1"></div>
                    <div class="py-1 bg-white dark:bg-gray-800">
                        <button id="add-workspace-btn" class="flex items-center w-full text-left px-4 py-2 text-sm text-blue-600 hover:bg-blue-50 dark:hover:bg-gray-700/50 transition-colors">
                            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                            ワークスペースを追加
                        </button>
                    </div>
                </div>
            </div>
            <h2 id="header-title" class="text-base font-medium truncate text-gray-600 dark:text-gray-300 border-l border-gray-300 dark:border-gray-700 pl-3">インボックス</h2>
        </div>
        <div id="header-right-ui" class="flex items-center space-x-2"></div>
    </header>
`;function $p(){const e=document.getElementById("app");e&&(e.innerHTML=`
        <div class="flex h-screen w-full overflow-hidden bg-white dark:bg-gray-900 transition-colors duration-200">
            ${Np()}
            <main class="flex-1 flex flex-col min-w-0 bg-white dark:bg-gray-900 transition-colors duration-200 relative">
                ${Hp()}
                <div id="main-content" class="flex-1 overflow-y-auto p-4 sm:p-6 lg:p-8 custom-scrollbar scroll-smooth">
                    <div class="w-full max-w-4xl mx-auto">
                        <div id="task-view" class="w-full animate-fade-in transition-opacity duration-150"></div>
                        <div id="search-view" class="hidden w-full animate-fade-in"></div>
                        <div id="dashboard-view" class="hidden w-full animate-fade-in"></div>
                    </div>
                </div>
            </main>
        </div>
        <div id="modal-container" class="z-[${fn.MODAL}] relative"></div>
    `,requestAnimationFrame(()=>{Bc(document.getElementById("sidebar"),document.getElementById("sidebar-resizer")),_d(),jp(),zp()}))}function zp(){const e=document.getElementById("sidebar"),t=document.getElementById("sidebar-overlay"),n=document.getElementById("sidebar-close-btn"),i=document.getElementById("sidebar-open-btn"),s=o=>{const r=e.classList.contains("-translate-x-full"),a=o??!r;e.classList.toggle("-translate-x-full",a),t==null||t.classList.toggle("hidden",a)};n==null||n.addEventListener("click",()=>s(!0)),i==null||i.addEventListener("click",()=>s(!1)),t==null||t.addEventListener("click",()=>s(!0))}function jp(){document.addEventListener("keydown",e=>{const t=["INPUT","TEXTAREA"].includes(e.target.tagName)||e.target.closest("[contenteditable]"),n=document.querySelector('[role="dialog"]');if(e.key==="/"&&!t&&!n){const i=document.getElementById("page-search-input");i&&(e.preventDefault(),i.focus())}})}function Vp(e){return e?(e.toDate?e.toDate():new Date(e)).toISOString().split("T")[0]:""}function Up(e=[]){return["日","月","火","水","木","金","土"].map((n,i)=>`
        <label class="flex items-center space-x-1 cursor-pointer">
            <input type="checkbox" data-day-index="${i}" ${e.includes(i)?"checked":""} 
                   class="form-checkbox h-4 w-4 text-blue-600 dark:text-blue-400 bg-gray-50 dark:bg-gray-700 border-gray-300 dark:border-gray-600 rounded">
            <span class="text-xs text-gray-700 dark:text-gray-300">${n}</span>
        </label>
    `).join("")}function za(e,t,n){return e.map(i=>`
        <option value="${i.id||i}" ${(i.id||i)==t?"selected":""}>
            ${n(i)}
        </option>
    `).join("")}const Wp="task_modal_schedule_open";function Yp(e){let t=e.dueDate;const n=e.recurrence||{type:"none",days:[]};n.type!=="none"&&!t&&(t=fd(n));const i=t?Vp(t.toDate?t.toDate():new Date(t)):"",s=za(ue(),e.timeBlockId,c=>`${c.start} - ${c.end}`),o=za([30,45,60,75,90],e.duration,c=>`${c} min`),r=i||n.type!=="none"||e.timeBlockId||e.duration,a=localStorage.getItem(Wp);let l=r;return a!==null?l=a==="true":r&&(l=!0),`
        <div class="fixed inset-0 z-50 flex items-center justify-center bg-black/50 p-4">
            <div class="bg-white dark:bg-gray-800 w-full max-w-4xl rounded-xl shadow-2xl overflow-hidden flex flex-col max-h-[90vh]" role="dialog">
                
                <!-- ヘッダー（タイトル入力） -->
                <div class="flex justify-between items-center px-6 py-4 border-b border-gray-100 dark:border-gray-700">
                    <input type="text" id="modal-task-title" value="${e.title}" placeholder="タスクのタイトル"
                        class="w-full text-xl font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
                    <button id="close-modal-btn" class="text-gray-400 hover:text-gray-600 transition ml-4">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                    </button>
                </div>

                <!-- ボディ (2カラムレイアウト) -->
                <div class="px-6 py-6 overflow-y-auto flex-1 min-h-0 bg-gray-50/30 dark:bg-gray-900/10">
                    <div class="grid grid-cols-1 md:grid-cols-12 gap-6 h-full">
                        
                        <!-- 左カラム (8/12): メモ -->
                        <div class="md:col-span-8 flex flex-col h-full bg-white dark:bg-gray-800 rounded-lg border border-gray-200 dark:border-gray-700 shadow-sm p-4">
                            <div class="flex justify-between items-center mb-2">
                                <label class="text-xs font-semibold text-gray-500 flex items-center gap-2 uppercase">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path></svg>
                                    メモ (Markdown)
                                </label>
                                <div class="flex items-center gap-2">
                                    <div class="flex items-center bg-gray-100 dark:bg-gray-700 rounded-md p-0.5">
                                        <button type="button" id="md-bold-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="太字 (Ctrl+B)">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 4h8a4 4 0 014 4 4 4 0 01-4 4H6V4zm0 8h9a4 4 0 014 4 4 4 0 01-4 4H6v-8z"></path></svg>
                                        </button>
                                        <div class="w-px h-3 bg-gray-300 dark:bg-gray-600 mx-0.5"></div>
                                        <button type="button" id="md-list-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="箇条書き">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path></svg>
                                        </button>
                                        <button type="button" id="md-ordered-btn" class="p-1 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 rounded hover:bg-white dark:hover:bg-gray-600 transition-colors" title="番号付きリスト">
                                            <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h12M7 12h12M7 17h12M3 7v.01M3 12v.01M3 17v.01"></path></svg>
                                        </button>
                                    </div>
                                    <button id="toggle-memo-view" class="text-blue-500 hover:bg-blue-50 dark:hover:bg-blue-900/30 px-2 py-0.5 rounded transition-colors text-xs font-medium ml-2">プレビュー</button>
                                </div>
                            </div>
                            <div class="flex-1 relative min-h-[200px]">
                                <textarea id="modal-task-desc" placeholder="詳細を入力..."
                                    class="w-full h-full p-3 bg-gray-50 dark:bg-gray-900/50 border-0 rounded-lg outline-none text-sm transition-all resize-y leading-relaxed focus:ring-1 focus:ring-blue-500/50 text-gray-800 dark:text-gray-200 font-mono">${e.description||""}</textarea>
                                <div id="modal-task-desc-preview" class="hidden absolute inset-0 w-full h-full p-4 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm markdown-output overflow-y-auto"></div>
                            </div>
                        </div>

                        <!-- 右カラム (4/12): スケジュール設定 -->
                        <div class="md:col-span-4 space-y-4">
                            <details id="modal-task-schedule-details" class="group border border-gray-200 dark:border-gray-700 rounded-lg bg-white dark:bg-gray-800 shadow-sm" ${l?"open":""}>
                                <summary class="flex items-center justify-between px-4 py-3 cursor-pointer list-none outline-none bg-gray-50 dark:bg-gray-700/30 rounded-t-lg group-[:not([open])]:rounded-lg transition-colors hover:bg-gray-100 dark:hover:bg-gray-700/50">
                                    <span class="text-sm font-bold text-gray-700 dark:text-gray-300 flex items-center gap-2">
                                        <svg class="w-4 h-4 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                        スケジュール
                                    </span>
                                    <span class="transform group-open:rotate-180 transition-transform text-gray-400">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
                                    </span>
                                </summary>
                                
                                <div class="p-4 flex flex-col gap-4">
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">期限日</label>
                                        <div class="relative">
                                            <input type="date" id="modal-task-date" value="${i}"
                                                class="w-full pl-3 pr-10 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm cursor-pointer [&::-webkit-calendar-picker-indicator]:opacity-0 [&::-webkit-calendar-picker-indicator]:absolute [&::-webkit-calendar-picker-indicator]:w-full [&::-webkit-calendar-picker-indicator]:justify-end [&::-webkit-calendar-picker-indicator]:cursor-pointer">
                                            <div class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none text-gray-500 dark:text-gray-400">
                                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">繰り返し</label>
                                        <select id="modal-task-recurrence" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="none" ${n.type==="none"?"selected":""}>なし</option>
                                            <option value="daily" ${n.type==="daily"?"selected":""}>毎日</option>
                                            <option value="weekdays" ${n.type==="weekdays"?"selected":""}>平日</option>
                                            <option value="weekly" ${n.type==="weekly"?"selected":""}>毎週</option>
                                            <option value="monthly" ${n.type==="monthly"?"selected":""}>毎月</option>
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">時間帯</label>
                                        <select id="modal-task-timeblock" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">未定</option>
                                            ${s}
                                        </select>
                                    </div>

                                    <div>
                                        <label class="block text-xs font-semibold text-gray-500 mb-1.5 uppercase">所要時間</label>
                                        <select id="modal-task-duration" class="w-full px-3 py-2 bg-gray-50 dark:bg-gray-900 border border-gray-200 dark:border-gray-700 rounded-lg text-sm appearance-none cursor-pointer">
                                            <option value="">指定なし</option>
                                            ${o}
                                        </select>
                                    </div>

                                    <div id="recurrence-days-container" class="${n.type!=="weekly"?"hidden":""} pt-2 border-t border-gray-100 dark:border-gray-700">
                                        <label class="block text-xs font-semibold text-gray-500 mb-2 uppercase">繰り返す曜日</label>
                                        <div id="recurrence-days-checkboxes" class="flex flex-wrap gap-4">
                                            ${Up(n.days)}
                                        </div>
                                    </div>
                                </div>
                            </details>
                        </div>

                    </div>
                </div>

                <!-- フッター -->
                <div class="px-6 py-4 bg-gray-50 dark:bg-gray-900/50 flex justify-between items-center border-t border-gray-100 dark:border-gray-700">
                    <button id="delete-task-modal-btn" class="text-gray-400 hover:text-red-500 text-sm font-medium flex items-center group transition">
                        <svg class="w-4 h-4 mr-1.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
                        削除
                    </button>
                    <div class="flex gap-3">
                        <button id="cancel-modal-btn" class="px-4 py-2 text-sm text-gray-600 dark:text-gray-400 hover:text-gray-800 transition">キャンセル</button>
                        <button id="save-task-modal-btn" class="px-6 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-bold rounded-lg shadow-md transition transform active:scale-95">保存</button>
                    </div>
                </div>
            </div>
        </div>
    `}function qp(e){return e.replace(/[&<>"']/g,t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[t])}function ja(e){if(!e)return"";const t=e.split(`
`);let n=[],i=!1;return t.forEach(s=>{const o=s.trimStart(),r=o.startsWith("* ")||o.startsWith("- ");if(r&&!i?(n.push('<ul class="list-disc ml-5 space-y-1">'),i=!0):!r&&i&&(n.push("</ul>"),i=!1),r){const a=Va(o.substring(2));n.push(`<li>${a}</li>`)}else s.trim()?n.push(`<p class="mb-2">${Va(s)}</p>`):i&&(n.push("</ul>"),i=!1)}),i&&n.push("</ul>"),n.join(`
`)}function Va(e){return qp(e).replace(/\[(.*?)\]\((.*?)\)/g,(n,i,s)=>`<a href="${s.replace(/"/g,"&quot;")}" target="_blank" rel="noopener" class="text-blue-400 hover:text-blue-300 underline font-medium">${i}</a>`)}const ko={EDIT:"編集",PREVIEW:"プレビュー"};function Gp(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function $i(e,t,n=""){const i=e.selectionStart,s=e.selectionEnd,o=e.value,r=o.substring(i,s);let a=o.substring(0,i),l=o.substring(s),c="",d=0;if(n)c=a+t+r+n+l,d=s+t.length+n.length,i===s&&(d-=n.length);else if(i!==s){const h=r.split(`
`).map(f=>t+f).join(`
`);c=a+h+l,d=i+h.length}else c=a+t+l,d=i+t.length;e.value=c,e.focus(),e.selectionEnd=d,n&&i===s?(e.selectionStart=i+t.length,e.selectionEnd=i+t.length):n&&(e.selectionStart=i,e.selectionEnd=s+t.length+n.length),e.dispatchEvent(new Event("input"))}function Xp(){const e=document.getElementById("modal-task-desc"),t=document.getElementById("modal-task-desc-preview"),n=document.getElementById("toggle-memo-view"),i=document.getElementById("md-bold-btn"),s=document.getElementById("md-list-btn"),o=document.getElementById("md-ordered-btn");if(!e||!t||!n)return;let r=!0;const a=Gp(()=>{t.innerHTML=ja(e.value)},300);n.addEventListener("click",()=>{r=!r,r?(e.classList.remove("hidden"),t.classList.add("hidden"),n.textContent=ko.PREVIEW):(t.innerHTML=ja(e.value),e.classList.add("hidden"),t.classList.remove("hidden"),n.textContent=ko.EDIT)}),e.addEventListener("input",()=>{r||a()}),e.addEventListener("keydown",l=>{(l.ctrlKey||l.metaKey)&&l.key==="b"&&(l.preventDefault(),$i(e,"**","**"))}),i&&i.addEventListener("click",()=>$i(e,"**","**")),s&&s.addEventListener("click",()=>$i(e,"- ")),o&&o.addEventListener("click",()=>$i(e,"1. ")),e.classList.remove("hidden"),t.classList.add("hidden"),n.textContent=ko.PREVIEW}function Kp(){const e=document.getElementById("modal-task-recurrence"),t=document.getElementById("recurrence-days-container"),n=document.getElementById("modal-task-date");if(!e||!t||!n)return;const i=t.querySelectorAll('input[type="checkbox"]'),s=(r,a=[])=>{if(r==="weekly"&&a.length===0)return;const l=fd({type:r,days:a});n.value=l.toISOString().substring(0,10)},o=()=>Array.from(i).filter(r=>r.checked).map(r=>parseInt(r.dataset.dayIndex??"0",10));e.addEventListener("change",r=>{const a=r.target.value,l=a==="weekly";if(t.classList.toggle("hidden",!l),a!=="none"){const c=l?o():[];s(a,c)}}),i.forEach(r=>{r.addEventListener("change",()=>{const a=o();s("weekly",a)})})}let ne={};function Jp(e){ne={title:e.querySelector("#modal-task-title"),desc:e.querySelector("#modal-task-desc"),date:e.querySelector("#modal-task-date"),recurrence:e.querySelector("#modal-task-recurrence"),timeblock:e.querySelector("#modal-task-timeblock"),duration:e.querySelector("#modal-task-duration"),saveBtn:e.querySelector("#save-task-modal-btn"),deleteBtn:e.querySelector("#delete-task-modal-btn"),closeBtn:e.querySelector("#close-modal-btn"),cancelBtn:e.querySelector("#cancel-modal-btn"),overlay:e.querySelector("div.fixed")}}function Zp(e,t,n){Jp(e);const{closeBtn:i,cancelBtn:s,overlay:o,saveBtn:r,deleteBtn:a}=ne;[i,s].forEach(d=>d==null?void 0:d.addEventListener("click",n)),o==null||o.addEventListener("click",d=>{d.target===d.currentTarget&&n()});const l=e.querySelector("#modal-task-schedule-details");l&&l.addEventListener("toggle",()=>{localStorage.setItem("task_modal_schedule_open",l.open)}),r==null||r.addEventListener("click",async()=>{await Qp(t,n)}),a==null||a.addEventListener("click",()=>{L({message:"本当に削除するか？",type:"confirm",onConfirm:async()=>{try{await gd(t.id),n()}catch{L({message:"削除に失敗した",type:"error"})}}})});const c=ne.date;c&&c.addEventListener("click",d=>{if(typeof c.showPicker=="function")try{c.showPicker()}catch(u){console.debug("showPicker failed or already open",u)}}),Kp(),Xp()}async function Qp(e,t){var d,u,h,f,g,p,m,b;const n=(u=(d=ne.title)==null?void 0:d.value)==null?void 0:u.trim();if(!n){L({message:"タイトルを入力してくれ",type:"error"});return}const i=(h=ne.date)==null?void 0:h.value,s=i?new Date(i):null;if(i&&isNaN(s.getTime())){L({message:"無効な日付だ",type:"error"});return}const o=(f=ne.recurrence)==null?void 0:f.value;let r=null;if(o!=="none"&&(r={type:o},o==="weekly")){const y=Array.from(document.querySelectorAll("#recurrence-days-checkboxes input:checked")).map(x=>parseInt(x.dataset.dayIndex??"",10)).filter(x=>!isNaN(x)).sort((x,_)=>x-_);if(y.length===0){L({message:"曜日を選択してくれ",type:"error"});return}r.days=y}const a=parseInt((g=ne.duration)==null?void 0:g.value,10),l=isNaN(a)?null:a,c={title:n,description:((m=(p=ne.desc)==null?void 0:p.value)==null?void 0:m.trim())||"",dueDate:s,recurrence:r,timeBlockId:((b=ne.timeblock)==null?void 0:b.value)||null,duration:l};try{await Zn(e.id,c),t()}catch(y){console.error("Failed to update task:",y),L({message:"保存に失敗した",type:"error"})}}const kd=e=>{e.key==="Escape"&&Sd()};function tm(e){let t=document.getElementById("modal-container");t||(t=document.createElement("div"),t.id="modal-container",document.body.appendChild(t)),t.innerHTML=Yp(e),Zp(t,e,Sd),document.addEventListener("keydown",kd)}function Sd(){const e=document.getElementById("modal-container");e&&(e.innerHTML="",document.removeEventListener("keydown",kd))}const zr=e=>`${B.STORAGE_KEYS.SECTION_PREFIX}${e}`,em={basic:{title:"基本項目",listId:B.LIST_IDS.BASIC,renderContent:e=>`
                ${zi("nav-dashboard","M11 3.055A9.001 9.001 0 1020.945 13H11V3.055z","ダッシュボード")}
                ${zi("nav-inbox","M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4","インボックス",'<span id="inbox-count" class="hidden bg-gray-200 dark:bg-gray-700 text-gray-600 dark:text-gray-300 py-0.5 px-2 rounded-full text-xs font-semibold">0</span>')}
                ${zi("nav-search","M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z","検索")}
                ${zi("nav-settings","M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z","設定")}
            `},projects:{title:"プロジェクト",listId:B.LIST_IDS.PROJECTS,hasAddButton:!0,buttonId:"add-project-btn"},timeblocks:{title:"時間帯",listId:B.LIST_IDS.TIMEBLOCKS,hasAddButton:!0,buttonId:"edit-timeblocks-btn"},durations:{title:"所要時間",listId:B.LIST_IDS.DURATIONS},filters:{title:"フィルター",listId:B.LIST_IDS.FILTERS,hasAddButton:!0,buttonId:"add-filter-btn"}},Ed=["basic","projects","timeblocks","durations","filters"];function nm(){try{const e=localStorage.getItem(B.STORAGE_KEYS.SECTION_ORDER);if(e)return JSON.parse(e)}catch(e){console.error("Failed to parse section order",e)}return Ed}function im(e,t,n=!1,i=""){const s=Ti(zr(t),!0),o=s?"rotate-0":"-rotate-90",r=n?`
        <button id="${i}" class="text-gray-400 hover:text-blue-600 dark:hover:text-blue-400 opacity-0 group-hover:opacity-100 transition-opacity p-1 rounded hover:bg-gray-200 dark:hover:bg-gray-700 flex items-center justify-center" aria-label="${e}を追加">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        </button>
    `:"";return`
        <div class="flex items-center justify-between px-3 py-2 group cursor-pointer sidebar-section-header" 
             data-target="${t}" role="button" aria-expanded="${s}" aria-controls="${t}">
            <div class="flex items-center min-w-0 pointer-events-none">
                <svg class="w-3 h-3 text-gray-400 mr-2 transition-transform duration-200 flex-shrink-0 ${o} section-arrow" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                    <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                </svg>
                <h3 class="font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider truncate select-none">${e}</h3>
            </div>
            ${r}
        </div>
    `}function sm(e,t=""){const n=Ti(zr(e),!0);return`<ul id="${e}" class="space-y-0.5 mb-2 pl-1 ${n?"":"hidden"}">${t}</ul>`}function zi(e,t,n,i=""){return`
        <li>
            <a href="#" id="${e}" class="sidebar-item-row group flex items-center px-3 py-1.5 font-medium text-gray-700 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-800 rounded-md transition-colors">
                <svg class="mr-3 h-5 w-5 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="${t}"></path>
                </svg>
                <span class="flex-1">${n}</span>
                ${i}
            </a>
        </li>
    `}function om(){const e=nm();return Ed.forEach(n=>{e.includes(n)||e.push(n)}),`<div class="mt-2 select-none" id="sidebar-sections-wrapper">${e.map(n=>{const i=em[n];if(!i)return"";const s=i.renderContent?i.renderContent(i.listId):"";return`
            <div class="sidebar-section-container transition-all duration-200" draggable="true" data-section-key="${n}">
                ${im(i.title,i.listId,i.hasAddButton,i.buttonId)}
                ${sm(i.listId,s)}
            </div>
        `}).join("")}</div>`}function rm(){document.querySelectorAll(".sidebar-section-header").forEach(e=>{const t=e.dataset.target,n=document.getElementById(t),i=e.querySelector(".section-arrow");!n||!i||(e.onclick=s=>{if(s.target.closest("button"))return;const r=!n.classList.toggle(B.CLASSES.HIDDEN);i.classList.toggle("rotate-0",r),i.classList.toggle("-rotate-90",!r),e.setAttribute("aria-expanded",r),localStorage.setItem(zr(t),r)})})}function am(){const e=document.getElementById("sidebar-sections-wrapper");if(!e)return;let t=null;e.querySelectorAll(".sidebar-section-container").forEach(i=>{i.addEventListener("dragstart",s=>{t=i,s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",i.dataset.sectionKey),i.classList.add("opacity-50","bg-gray-100","dark:bg-gray-800")}),i.addEventListener("dragend",s=>{i.classList.remove("opacity-50","bg-gray-100","dark:bg-gray-800"),e.querySelectorAll(".sidebar-section-container").forEach(o=>{o.classList.remove("border-t-2","border-blue-500")})}),i.addEventListener("dragover",s=>{s.preventDefault(),s.dataTransfer.dropEffect="move",t!==i&&i.classList.add("border-t-2","border-blue-500")}),i.addEventListener("dragleave",s=>{i.classList.remove("border-t-2","border-blue-500")}),i.addEventListener("drop",s=>(s.stopPropagation(),s.preventDefault(),t!==i&&(e.insertBefore(t,i),lm(e)),!1))})}function lm(e){const t=e.querySelectorAll(".sidebar-section-container"),n=Array.from(t).map(i=>i.dataset.sectionKey);localStorage.setItem(B.STORAGE_KEYS.SECTION_ORDER,JSON.stringify(n))}function mi(e,t,n=null){if(!e)return;let i=0;const s=B.CLASSES.DRAG_OVER;e.addEventListener("dragenter",o=>{o.preventDefault(),i++,e.classList.add(...s)}),e.addEventListener("dragover",o=>{o.preventDefault(),e.classList.contains("ring-2")||e.classList.add(...s)}),e.addEventListener("dragleave",o=>{o.preventDefault(),i--,i<=0&&(e.classList.remove(...s),i=0)}),e.addEventListener("drop",async o=>{o.preventDefault(),i=0,e.classList.remove(...s);const r=o.dataTransfer.getData("text/plain");r&&await cm(r,t,n)})}async function cm(e,t,n){const i={},{DURATION_LIMITS:s}=B;switch(t){case"inbox":i.projectId=null;break;case"project":n&&(i.projectId=n);break;case"timeblock":i.timeBlockId=n==="unassigned"||!n?null:n;break;case"duration":{const o=parseInt(n,10);if(!isNaN(o)&&o>=s.MIN&&o<=s.MAX)i.duration=o;else{L({message:`所要時間は ${s.MIN}〜${s.MAX} 分の範囲で設定してくれ。`,type:"error"});return}break}default:console.error(`[Drop] Unknown drop type: ${t}`),L({message:"不正な操作だ。",type:"error"});return}try{Object.keys(i).length>0&&await Zn(e,i)}catch(o){console.error(`[Drop Error] Type: ${t}, Task: ${e}`,o),L({message:"タスクの更新に失敗したぞ。通信環境を確認してくれ。",type:"error"})}}const Ua=Array.from({length:24},(e,t)=>String(t).padStart(2,"0")),Wa=["00","15","30","45"];function dm(){return`
        <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl w-full max-w-2xl overflow-hidden flex flex-col max-h-[90vh] relative animate-fade-in-up">
            <div class="px-8 py-6 border-b border-gray-100 dark:border-gray-700 flex justify-between items-center bg-white dark:bg-gray-800">
                <h3 class="text-xl font-bold text-gray-800 dark:text-white tracking-tight">時間帯設定</h3>
                <button id="close-tb-modal" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 transition duration-200 p-1 rounded-full hover:bg-gray-100 dark:hover:bg-gray-700">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
                </button>
            </div>
            
            <div class="p-8 overflow-y-auto flex-1 space-y-4 custom-scrollbar relative" id="tb-scroll-container">
                <div id="tb-list" class="space-y-2"></div> <!-- space-y-2 for tighter spacing -->
                
                <button id="add-tb-btn" class="w-full py-4 border-2 border-dashed border-gray-200 dark:border-gray-700 rounded-xl text-gray-400 hover:border-blue-500 hover:text-blue-500 hover:bg-blue-50/50 dark:hover:bg-blue-900/10 transition-all font-medium text-sm flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed group">
                </button>

                <div class="px-4 py-3 bg-gray-50 dark:bg-gray-900/40 rounded-lg flex items-center text-sm text-gray-500 dark:text-gray-400">
                    <span class="w-2.5 h-2.5 rounded-full bg-gray-400 mr-3 shadow-sm"></span>
                    <span class="font-bold mr-2 text-gray-700 dark:text-gray-300">未定</span>
                    <span class="text-xs opacity-80">デフォルトのゾーン</span>
                </div>
            </div>

            <div class="px-8 py-5 border-t border-gray-100 dark:border-gray-700 bg-white dark:bg-gray-800 flex justify-end">
                <button id="close-tb-footer" class="px-8 py-2.5 bg-gray-900 hover:bg-gray-800 dark:bg-blue-600 dark:hover:bg-blue-500 text-white rounded-lg font-bold text-sm transition-all active:scale-95 shadow-lg shadow-gray-200 dark:shadow-none">完了</button>
            </div>

            <!-- Global Color Picker Popover (Hidden by default) -->
            <div id="tb-color-picker" class="hidden absolute z-50 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700 p-4 w-64 animate-fade-in-up">
                <div class="text-xs font-bold text-gray-400 mb-3 uppercase tracking-wider">プリセット</div>
                <div class="grid grid-cols-5 gap-3 mb-5" id="tb-color-presets">
                    <!-- Presets injected by JS -->
                </div>
                <div class="flex justify-between items-end mb-3">
                    <div class="text-xs font-bold text-gray-400 uppercase tracking-wider">カスタム</div>
                    <button id="tb-custom-color-edit-btn" class="text-xs text-blue-500 hover:text-blue-600 font-medium transition-colors">編集</button>
                    <input type="color" id="tb-custom-color-input" class="invisible w-0 h-0 absolute">
                </div>
                <div class="grid grid-cols-5 gap-3" id="tb-color-customs">
                    <!-- Custom slots injected by JS -->
                </div>
            </div>
        </div>
    `}function ji(e,t,n){const i=e.map(s=>`<div class="tb-select-option px-3 py-2 hover:bg-blue-50 dark:hover:bg-blue-900/30 cursor-pointer text-sm transition-colors ${s===t?"bg-blue-50 dark:bg-blue-900/30 font-bold text-blue-600 dark:text-blue-400":"text-gray-600 dark:text-gray-300"}" data-value="${s}">${s}</div>`).join("");return`
        <div class="relative tb-custom-select group min-w-[64px]" data-type="${n}" data-value="${t}">
            <button type="button" class="tb-select-trigger w-full py-2 bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-600 rounded-lg text-sm text-center shadow-sm hover:border-gray-300 dark:hover:border-gray-500 hover:shadow-md focus:ring-2 focus:ring-blue-100 dark:focus:ring-blue-900 focus:border-blue-400 transition-all flex items-center justify-center font-mono font-medium text-gray-700 dark:text-gray-200">
                <span class="value-display">${t}</span>
            </button>
            <div class="hidden tb-select-options absolute top-full left-0 mt-2 w-full min-w-[70px] max-h-56 overflow-y-auto bg-white dark:bg-gray-800 border border-gray-100 dark:border-gray-700 rounded-lg shadow-xl z-20 custom-scrollbar animate-fade-in-down origin-top-left">
                ${i}
            </div>
        </div>
    `}function um(e){const[t,n]=e.start.split(":"),[i,s]=e.end.split(":");return`
        <div class="flex-shrink-0 relative pl-2 cursor-grab active:cursor-grabbing handle p-1 rounded-md text-gray-400 hover:text-gray-600" title="移動">
             <div class="tb-color-trigger w-6 h-6 rounded-full shadow-sm hover:scale-110 active:scale-95 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 ring-offset-2 dark:ring-offset-gray-900 cursor-pointer" 
                style="background-color: ${e.color}" data-color="${e.color}" title="色を変更"></div>
        </div>
        
        <div class="flex-1 flex items-center gap-4 px-2 handle cursor-grab active:cursor-grabbing">
            <div class="flex items-center gap-2">
                ${ji(Ua,t,"start-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${ji(Wa,n,"start-m")}
            </div>
            
            <div class="w-4 h-0.5 bg-gray-200 dark:bg-gray-700 rounded-full"></div>
            
            <div class="flex items-center gap-2">
                ${ji(Ua,i,"end-h")}
                <span class="text-gray-300 dark:text-gray-600 font-light select-none">:</span>
                ${ji(Wa,s,"end-m")}
            </div>
        </div>

        <div class="flex items-center pr-2">
            <button class="delete-btn p-2 text-gray-300 hover:text-red-500 hover:bg-red-50 dark:hover:bg-red-900/20 rounded-lg transition-colors duration-200" title="削除">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            </button>
        </div>
    `}const Ns=5,Ya={ADD:`
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
        <span>新しい時間帯を追加 (最大${Ns}個)</span>
    `,LIMIT:`<span class="text-gray-400">これ以上追加できません (最大${Ns}個)</span>`};function qa(e){if(!e)return 0;const[t,n]=e.split(":").map(Number);return t*60+n}function Fs(e,t){if(!e)return;const n=t>=Ns;e.disabled=n,e.innerHTML=n?Ya.LIMIT:Ya.ADD}const hm=["#3B82F6","#EF4444","#10B981","#F59E0B","#8B5CF6"],Id="timeblock_custom_colors";let fs=null,en=-1;function Ga(){try{const e=localStorage.getItem(Id);return e?JSON.parse(e):["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}catch{return["#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB","#E5E7EB"]}}function fm(e){localStorage.setItem(Id,JSON.stringify(e))}function gm(e){const t=document.getElementById("tb-color-picker"),n=document.getElementById("tb-color-presets"),i=document.getElementById("tb-color-customs"),s=document.getElementById("tb-custom-color-input"),o=document.getElementById("tb-custom-color-edit-btn");if(!t||!n||!i)return;n.innerHTML=hm.map(a=>`
        <button class="w-8 h-8 rounded-full shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400"
            style="background-color: ${a}" data-color="${a}"></button>
    `).join("");const r=()=>{const a=Ga();i.innerHTML=a.map((l,c)=>`
            <button class="custom-color-slot w-8 h-8 rounded-full border border-gray-200 dark:border-gray-600 shadow-sm hover:scale-110 transition-transform focus:outline-none ring-2 ring-transparent focus:ring-blue-400 relative overflow-hidden"
                style="background-color: ${l}" data-index="${c}" data-color="${l}">
                <div class="absolute inset-0 bg-black/0 hover:bg-black/10 transition-colors"></div>
            </button>
        `).join("")};r(),t.addEventListener("click",a=>{const l=a.target.closest("button[data-color]");if(l&&!l.classList.contains("custom-color-slot")){const c=l.dataset.color;So(c,t)}else if(l&&l.classList.contains("custom-color-slot")){en=parseInt(l.dataset.index),document.querySelectorAll(".custom-color-slot").forEach(d=>d.classList.remove("ring-offset-2","ring-2","ring-blue-500")),l.classList.add("ring-offset-2","ring-2","ring-blue-500");const c=l.dataset.color;c!=="#E5E7EB"&&So(c,t)}}),o.onclick=()=>{en===-1&&(en=0),s.click()},s.onchange=a=>{en===-1&&(en=0);const l=a.target.value,c=Ga();c[en]=l,fm(c),r(),So(l,t)}}function So(e,t){fs&&(fs.style.backgroundColor=e,fs.dataset.color=e,t.classList.add("hidden"))}function pm(e){var a;fs=e;const t=document.getElementById("tb-color-picker");if(!t)return;const n=e.getBoundingClientRect(),i=(a=document.getElementById("tb-scroll-container"))==null?void 0:a.parentElement;if(!i)return;const s=i.getBoundingClientRect();let o=n.bottom-s.top+10,r=n.left-s.left;r+280>s.width&&(r=s.width-290),t.style.top=`${o}px`,t.style.left=`${r}px`,t.classList.remove("hidden")}function mm(){const e=document.getElementById("tb-color-picker");e&&e.classList.add("hidden")}function bm(e,t){const n=e.querySelector('.tb-custom-select[data-type="start-h"]').dataset.value,i=e.querySelector('.tb-custom-select[data-type="start-m"]').dataset.value,s=e.querySelector('.tb-custom-select[data-type="end-h"]').dataset.value,o=e.querySelector('.tb-custom-select[data-type="end-m"]').dataset.value,r=e.querySelector(".tb-color-trigger").dataset.color;return{id:e.dataset.id||null,start:`${n}:${i}`,end:`${s}:${o}`,color:r,order:t}}function ym(e){const t=e.dataset.id;if(!t){e.remove(),Fs(document.getElementById("add-tb-btn"),ue().length);return}e.style.opacity="0",e.style.transform="translateX(-20px)",setTimeout(()=>{L({message:`削除しますか？
（完了ボタンを押さなくても、削除は即時反映されます）`,type:"confirm",onConfirm:async()=>{try{await pp(t),e.remove(),document.dispatchEvent(new CustomEvent("timeblocks-updated")),Fs(document.getElementById("add-tb-btn"),ue().length)}catch{L({message:"削除に失敗しました",type:"error"})}},onCancel:()=>{e.style.opacity="1",e.style.transform="translate(0)"}})},200)}async function vm(e,t){const i=Array.from(document.querySelectorAll(".tb-row")).map((o,r)=>bm(o,r));for(const o of i){const r=qa(o.start),a=qa(o.end);if(r>=a)return L({message:`時間設定が不正です: ${o.start} - ${o.end}
(終了時間は開始時間より後にしてください)`,type:"error"})}e.disabled=!0;const s=e.textContent;e.textContent="保存中...";try{const o=i.map(r=>gp({id:r.id,name:`${r.start}-${r.end}`,start:r.start,end:r.end,color:r.color,order:r.order}));await Promise.all(o),document.dispatchEvent(new CustomEvent("timeblocks-updated")),t()}catch(o){console.error(o),L({message:"保存中にエラーが発生しました",type:"error"})}finally{e.disabled=!1,e.textContent=s}}/**!
 * Sortable 1.15.6
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function Xa(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter(function(s){return Object.getOwnPropertyDescriptor(e,s).enumerable})),n.push.apply(n,i)}return n}function Jt(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?Xa(Object(n),!0).forEach(function(i){xm(e,i,n[i])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xa(Object(n)).forEach(function(i){Object.defineProperty(e,i,Object.getOwnPropertyDescriptor(n,i))})}return e}function gs(e){"@babel/helpers - typeof";return typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?gs=function(t){return typeof t}:gs=function(t){return t&&typeof Symbol=="function"&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},gs(e)}function xm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function he(){return he=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},he.apply(this,arguments)}function _m(e,t){if(e==null)return{};var n={},i=Object.keys(e),s,o;for(o=0;o<i.length;o++)s=i[o],!(t.indexOf(s)>=0)&&(n[s]=e[s]);return n}function wm(e,t){if(e==null)return{};var n=_m(e,t),i,s;if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(s=0;s<o.length;s++)i=o[s],!(t.indexOf(i)>=0)&&Object.prototype.propertyIsEnumerable.call(e,i)&&(n[i]=e[i])}return n}var km="1.15.6";function ce(e){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(e)}var ge=ce(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Li=ce(/Edge/i),Ka=ce(/firefox/i),ni=ce(/safari/i)&&!ce(/chrome/i)&&!ce(/android/i),jr=ce(/iP(ad|od|hone)/i),Dd=ce(/chrome/i)&&ce(/android/i),Td={capture:!1,passive:!1};function $(e,t,n){e.addEventListener(t,n,!ge&&Td)}function F(e,t,n){e.removeEventListener(t,n,!ge&&Td)}function Hs(e,t){if(t){if(t[0]===">"&&(t=t.substring(1)),e)try{if(e.matches)return e.matches(t);if(e.msMatchesSelector)return e.msMatchesSelector(t);if(e.webkitMatchesSelector)return e.webkitMatchesSelector(t)}catch{return!1}return!1}}function Md(e){return e.host&&e!==document&&e.host.nodeType?e.host:e.parentNode}function $t(e,t,n,i){if(e){n=n||document;do{if(t!=null&&(t[0]===">"?e.parentNode===n&&Hs(e,t):Hs(e,t))||i&&e===n)return e;if(e===n)break}while(e=Md(e))}return null}var Ja=/\s+/g;function Ct(e,t,n){if(e&&t)if(e.classList)e.classList[n?"add":"remove"](t);else{var i=(" "+e.className+" ").replace(Ja," ").replace(" "+t+" "," ");e.className=(i+(n?" "+t:"")).replace(Ja," ")}}function M(e,t,n){var i=e&&e.style;if(i){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(e,""):e.currentStyle&&(n=e.currentStyle),t===void 0?n:n[t];!(t in i)&&t.indexOf("webkit")===-1&&(t="-webkit-"+t),i[t]=n+(typeof n=="string"?"":"px")}}function gn(e,t){var n="";if(typeof e=="string")n=e;else do{var i=M(e,"transform");i&&i!=="none"&&(n=i+" "+n)}while(!t&&(e=e.parentNode));var s=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return s&&new s(n)}function Cd(e,t,n){if(e){var i=e.getElementsByTagName(t),s=0,o=i.length;if(n)for(;s<o;s++)n(i[s],s);return i}return[]}function Gt(){var e=document.scrollingElement;return e||document.documentElement}function ct(e,t,n,i,s){if(!(!e.getBoundingClientRect&&e!==window)){var o,r,a,l,c,d,u;if(e!==window&&e.parentNode&&e!==Gt()?(o=e.getBoundingClientRect(),r=o.top,a=o.left,l=o.bottom,c=o.right,d=o.height,u=o.width):(r=0,a=0,l=window.innerHeight,c=window.innerWidth,d=window.innerHeight,u=window.innerWidth),(t||n)&&e!==window&&(s=s||e.parentNode,!ge))do if(s&&s.getBoundingClientRect&&(M(s,"transform")!=="none"||n&&M(s,"position")!=="static")){var h=s.getBoundingClientRect();r-=h.top+parseInt(M(s,"border-top-width")),a-=h.left+parseInt(M(s,"border-left-width")),l=r+o.height,c=a+o.width;break}while(s=s.parentNode);if(i&&e!==window){var f=gn(s||e),g=f&&f.a,p=f&&f.d;f&&(r/=p,a/=g,u/=g,d/=p,l=r+d,c=a+u)}return{top:r,left:a,bottom:l,right:c,width:u,height:d}}}function Za(e,t,n){for(var i=_e(e,!0),s=ct(e)[t];i;){var o=ct(i)[n],r=void 0;if(r=s>=o,!r)return i;if(i===Gt())break;i=_e(i,!1)}return!1}function yn(e,t,n,i){for(var s=0,o=0,r=e.children;o<r.length;){if(r[o].style.display!=="none"&&r[o]!==C.ghost&&(i||r[o]!==C.dragged)&&$t(r[o],n.draggable,e,!1)){if(s===t)return r[o];s++}o++}return null}function Vr(e,t){for(var n=e.lastElementChild;n&&(n===C.ghost||M(n,"display")==="none"||t&&!Hs(n,t));)n=n.previousElementSibling;return n||null}function Rt(e,t){var n=0;if(!e||!e.parentNode)return-1;for(;e=e.previousElementSibling;)e.nodeName.toUpperCase()!=="TEMPLATE"&&e!==C.clone&&(!t||Hs(e,t))&&n++;return n}function Qa(e){var t=0,n=0,i=Gt();if(e)do{var s=gn(e),o=s.a,r=s.d;t+=e.scrollLeft*o,n+=e.scrollTop*r}while(e!==i&&(e=e.parentNode));return[t,n]}function Sm(e,t){for(var n in e)if(e.hasOwnProperty(n)){for(var i in t)if(t.hasOwnProperty(i)&&t[i]===e[n][i])return Number(n)}return-1}function _e(e,t){if(!e||!e.getBoundingClientRect)return Gt();var n=e,i=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var s=M(n);if(n.clientWidth<n.scrollWidth&&(s.overflowX=="auto"||s.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(s.overflowY=="auto"||s.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Gt();if(i||t)return n;i=!0}}while(n=n.parentNode);return Gt()}function Em(e,t){if(e&&t)for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e}function Eo(e,t){return Math.round(e.top)===Math.round(t.top)&&Math.round(e.left)===Math.round(t.left)&&Math.round(e.height)===Math.round(t.height)&&Math.round(e.width)===Math.round(t.width)}var ii;function Ad(e,t){return function(){if(!ii){var n=arguments,i=this;n.length===1?e.call(i,n[0]):e.apply(i,n),ii=setTimeout(function(){ii=void 0},t)}}}function Im(){clearTimeout(ii),ii=void 0}function Ld(e,t,n){e.scrollLeft+=t,e.scrollTop+=n}function Od(e){var t=window.Polymer,n=window.jQuery||window.Zepto;return t&&t.dom?t.dom(e).cloneNode(!0):n?n(e).clone(!0)[0]:e.cloneNode(!0)}function Pd(e,t,n){var i={};return Array.from(e.children).forEach(function(s){var o,r,a,l;if(!(!$t(s,t.draggable,e,!1)||s.animated||s===n)){var c=ct(s);i.left=Math.min((o=i.left)!==null&&o!==void 0?o:1/0,c.left),i.top=Math.min((r=i.top)!==null&&r!==void 0?r:1/0,c.top),i.right=Math.max((a=i.right)!==null&&a!==void 0?a:-1/0,c.right),i.bottom=Math.max((l=i.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),i.width=i.right-i.left,i.height=i.bottom-i.top,i.x=i.left,i.y=i.top,i}var Dt="Sortable"+new Date().getTime();function Dm(){var e=[],t;return{captureAnimationState:function(){if(e=[],!!this.options.animation){var i=[].slice.call(this.el.children);i.forEach(function(s){if(!(M(s,"display")==="none"||s===C.ghost)){e.push({target:s,rect:ct(s)});var o=Jt({},e[e.length-1].rect);if(s.thisAnimationDuration){var r=gn(s,!0);r&&(o.top-=r.f,o.left-=r.e)}s.fromRect=o}})}},addAnimationState:function(i){e.push(i)},removeAnimationState:function(i){e.splice(Sm(e,{target:i}),1)},animateAll:function(i){var s=this;if(!this.options.animation){clearTimeout(t),typeof i=="function"&&i();return}var o=!1,r=0;e.forEach(function(a){var l=0,c=a.target,d=c.fromRect,u=ct(c),h=c.prevFromRect,f=c.prevToRect,g=a.rect,p=gn(c,!0);p&&(u.top-=p.f,u.left-=p.e),c.toRect=u,c.thisAnimationDuration&&Eo(h,u)&&!Eo(d,u)&&(g.top-u.top)/(g.left-u.left)===(d.top-u.top)/(d.left-u.left)&&(l=Mm(g,h,f,s.options)),Eo(u,d)||(c.prevFromRect=d,c.prevToRect=u,l||(l=s.options.animation),s.animate(c,g,u,l)),l&&(o=!0,r=Math.max(r,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(t),o?t=setTimeout(function(){typeof i=="function"&&i()},r):typeof i=="function"&&i(),e=[]},animate:function(i,s,o,r){if(r){M(i,"transition",""),M(i,"transform","");var a=gn(this.el),l=a&&a.a,c=a&&a.d,d=(s.left-o.left)/(l||1),u=(s.top-o.top)/(c||1);i.animatingX=!!d,i.animatingY=!!u,M(i,"transform","translate3d("+d+"px,"+u+"px,0)"),this.forRepaintDummy=Tm(i),M(i,"transition","transform "+r+"ms"+(this.options.easing?" "+this.options.easing:"")),M(i,"transform","translate3d(0,0,0)"),typeof i.animated=="number"&&clearTimeout(i.animated),i.animated=setTimeout(function(){M(i,"transition",""),M(i,"transform",""),i.animated=!1,i.animatingX=!1,i.animatingY=!1},r)}}}}function Tm(e){return e.offsetWidth}function Mm(e,t,n,i){return Math.sqrt(Math.pow(t.top-e.top,2)+Math.pow(t.left-e.left,2))/Math.sqrt(Math.pow(t.top-n.top,2)+Math.pow(t.left-n.left,2))*i.animation}var nn=[],Io={initializeByDefault:!0},Oi={mount:function(t){for(var n in Io)Io.hasOwnProperty(n)&&!(n in t)&&(t[n]=Io[n]);nn.forEach(function(i){if(i.pluginName===t.pluginName)throw"Sortable: Cannot mount plugin ".concat(t.pluginName," more than once")}),nn.push(t)},pluginEvent:function(t,n,i){var s=this;this.eventCanceled=!1,i.cancel=function(){s.eventCanceled=!0};var o=t+"Global";nn.forEach(function(r){n[r.pluginName]&&(n[r.pluginName][o]&&n[r.pluginName][o](Jt({sortable:n},i)),n.options[r.pluginName]&&n[r.pluginName][t]&&n[r.pluginName][t](Jt({sortable:n},i)))})},initializePlugins:function(t,n,i,s){nn.forEach(function(a){var l=a.pluginName;if(!(!t.options[l]&&!a.initializeByDefault)){var c=new a(t,n,t.options);c.sortable=t,c.options=t.options,t[l]=c,he(i,c.defaults)}});for(var o in t.options)if(t.options.hasOwnProperty(o)){var r=this.modifyOption(t,o,t.options[o]);typeof r<"u"&&(t.options[o]=r)}},getEventProperties:function(t,n){var i={};return nn.forEach(function(s){typeof s.eventProperties=="function"&&he(i,s.eventProperties.call(n[s.pluginName],t))}),i},modifyOption:function(t,n,i){var s;return nn.forEach(function(o){t[o.pluginName]&&o.optionListeners&&typeof o.optionListeners[n]=="function"&&(s=o.optionListeners[n].call(t[o.pluginName],i))}),s}};function Cm(e){var t=e.sortable,n=e.rootEl,i=e.name,s=e.targetEl,o=e.cloneEl,r=e.toEl,a=e.fromEl,l=e.oldIndex,c=e.newIndex,d=e.oldDraggableIndex,u=e.newDraggableIndex,h=e.originalEvent,f=e.putSortable,g=e.extraEventProperties;if(t=t||n&&n[Dt],!!t){var p,m=t.options,b="on"+i.charAt(0).toUpperCase()+i.substr(1);window.CustomEvent&&!ge&&!Li?p=new CustomEvent(i,{bubbles:!0,cancelable:!0}):(p=document.createEvent("Event"),p.initEvent(i,!0,!0)),p.to=r||n,p.from=a||n,p.item=s||n,p.clone=o,p.oldIndex=l,p.newIndex=c,p.oldDraggableIndex=d,p.newDraggableIndex=u,p.originalEvent=h,p.pullMode=f?f.lastPutMode:void 0;var y=Jt(Jt({},g),Oi.getEventProperties(i,t));for(var x in y)p[x]=y[x];n&&n.dispatchEvent(p),m[b]&&m[b].call(t,p)}}var Am=["evt"],St=function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},s=i.evt,o=wm(i,Am);Oi.pluginEvent.bind(C)(t,n,Jt({dragEl:E,parentEl:st,ghostEl:O,rootEl:tt,nextEl:je,lastDownEl:ps,cloneEl:it,cloneHidden:ye,dragStarted:Fn,putSortable:mt,activeSortable:C.active,originalEvent:s,oldIndex:cn,oldDraggableIndex:si,newIndex:At,newDraggableIndex:be,hideGhostForTarget:Fd,unhideGhostForTarget:Hd,cloneNowHidden:function(){ye=!0},cloneNowShown:function(){ye=!1},dispatchSortableEvent:function(a){kt({sortable:n,name:a,originalEvent:s})}},o))};function kt(e){Cm(Jt({putSortable:mt,cloneEl:it,targetEl:E,rootEl:tt,oldIndex:cn,oldDraggableIndex:si,newIndex:At,newDraggableIndex:be},e))}var E,st,O,tt,je,ps,it,ye,cn,At,si,be,Vi,mt,ln=!1,$s=!1,zs=[],Be,Ht,Do,To,tl,el,Fn,sn,oi,ri=!1,Ui=!1,ms,yt,Mo=[],ar=!1,js=[],io=typeof document<"u",Wi=jr,nl=Li||ge?"cssFloat":"float",Lm=io&&!Dd&&!jr&&"draggable"in document.createElement("div"),Rd=(function(){if(io){if(ge)return!1;var e=document.createElement("x");return e.style.cssText="pointer-events:auto",e.style.pointerEvents==="auto"}})(),Bd=function(t,n){var i=M(t),s=parseInt(i.width)-parseInt(i.paddingLeft)-parseInt(i.paddingRight)-parseInt(i.borderLeftWidth)-parseInt(i.borderRightWidth),o=yn(t,0,n),r=yn(t,1,n),a=o&&M(o),l=r&&M(r),c=a&&parseInt(a.marginLeft)+parseInt(a.marginRight)+ct(o).width,d=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+ct(r).width;if(i.display==="flex")return i.flexDirection==="column"||i.flexDirection==="column-reverse"?"vertical":"horizontal";if(i.display==="grid")return i.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(o&&a.float&&a.float!=="none"){var u=a.float==="left"?"left":"right";return r&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return o&&(a.display==="block"||a.display==="flex"||a.display==="table"||a.display==="grid"||c>=s&&i[nl]==="none"||r&&i[nl]==="none"&&c+d>s)?"vertical":"horizontal"},Om=function(t,n,i){var s=i?t.left:t.top,o=i?t.right:t.bottom,r=i?t.width:t.height,a=i?n.left:n.top,l=i?n.right:n.bottom,c=i?n.width:n.height;return s===a||o===l||s+r/2===a+c/2},Pm=function(t,n){var i;return zs.some(function(s){var o=s[Dt].options.emptyInsertThreshold;if(!(!o||Vr(s))){var r=ct(s),a=t>=r.left-o&&t<=r.right+o,l=n>=r.top-o&&n<=r.bottom+o;if(a&&l)return i=s}}),i},Nd=function(t){function n(o,r){return function(a,l,c,d){var u=a.options.group.name&&l.options.group.name&&a.options.group.name===l.options.group.name;if(o==null&&(r||u))return!0;if(o==null||o===!1)return!1;if(r&&o==="clone")return o;if(typeof o=="function")return n(o(a,l,c,d),r)(a,l,c,d);var h=(r?a:l).options.group.name;return o===!0||typeof o=="string"&&o===h||o.join&&o.indexOf(h)>-1}}var i={},s=t.group;(!s||gs(s)!="object")&&(s={name:s}),i.name=s.name,i.checkPull=n(s.pull,!0),i.checkPut=n(s.put),i.revertClone=s.revertClone,t.group=i},Fd=function(){!Rd&&O&&M(O,"display","none")},Hd=function(){!Rd&&O&&M(O,"display","")};io&&!Dd&&document.addEventListener("click",function(e){if($s)return e.preventDefault(),e.stopPropagation&&e.stopPropagation(),e.stopImmediatePropagation&&e.stopImmediatePropagation(),$s=!1,!1},!0);var Ne=function(t){if(E){t=t.touches?t.touches[0]:t;var n=Pm(t.clientX,t.clientY);if(n){var i={};for(var s in t)t.hasOwnProperty(s)&&(i[s]=t[s]);i.target=i.rootEl=n,i.preventDefault=void 0,i.stopPropagation=void 0,n[Dt]._onDragOver(i)}}},Rm=function(t){E&&E.parentNode[Dt]._isOutsideThisEl(t.target)};function C(e,t){if(!(e&&e.nodeType&&e.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(e));this.el=e,this.options=t=he({},t),e[Dt]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(e.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Bd(e,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(r,a){r.setData("Text",a.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:C.supportPointer!==!1&&"PointerEvent"in window&&(!ni||jr),emptyInsertThreshold:5};Oi.initializePlugins(this,e,n);for(var i in n)!(i in t)&&(t[i]=n[i]);Nd(t);for(var s in this)s.charAt(0)==="_"&&typeof this[s]=="function"&&(this[s]=this[s].bind(this));this.nativeDraggable=t.forceFallback?!1:Lm,this.nativeDraggable&&(this.options.touchStartThreshold=1),t.supportPointer?$(e,"pointerdown",this._onTapStart):($(e,"mousedown",this._onTapStart),$(e,"touchstart",this._onTapStart)),this.nativeDraggable&&($(e,"dragover",this),$(e,"dragenter",this)),zs.push(this.el),t.store&&t.store.get&&this.sort(t.store.get(this)||[]),he(this,Dm())}C.prototype={constructor:C,_isOutsideThisEl:function(t){!this.el.contains(t)&&t!==this.el&&(sn=null)},_getDirection:function(t,n){return typeof this.options.direction=="function"?this.options.direction.call(this,t,n,E):this.options.direction},_onTapStart:function(t){if(t.cancelable){var n=this,i=this.el,s=this.options,o=s.preventOnFilter,r=t.type,a=t.touches&&t.touches[0]||t.pointerType&&t.pointerType==="touch"&&t,l=(a||t).target,c=t.target.shadowRoot&&(t.path&&t.path[0]||t.composedPath&&t.composedPath()[0])||l,d=s.filter;if(Vm(i),!E&&!(/mousedown|pointerdown/.test(r)&&t.button!==0||s.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&ni&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=$t(l,s.draggable,i,!1),!(l&&l.animated)&&ps!==l)){if(cn=Rt(l),si=Rt(l,s.draggable),typeof d=="function"){if(d.call(this,t,l,this)){kt({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:i,fromEl:i}),St("filter",n,{evt:t}),o&&t.preventDefault();return}}else if(d&&(d=d.split(",").some(function(u){if(u=$t(c,u.trim(),i,!1),u)return kt({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:i,toEl:i}),St("filter",n,{evt:t}),!0}),d)){o&&t.preventDefault();return}s.handle&&!$t(c,s.handle,i,!1)||this._prepareDragStart(t,a,l)}}},_prepareDragStart:function(t,n,i){var s=this,o=s.el,r=s.options,a=o.ownerDocument,l;if(i&&!E&&i.parentNode===o){var c=ct(i);if(tt=o,E=i,st=E.parentNode,je=E.nextSibling,ps=i,Vi=r.group,C.dragged=E,Be={target:E,clientX:(n||t).clientX,clientY:(n||t).clientY},tl=Be.clientX-c.left,el=Be.clientY-c.top,this._lastX=(n||t).clientX,this._lastY=(n||t).clientY,E.style["will-change"]="all",l=function(){if(St("delayEnded",s,{evt:t}),C.eventCanceled){s._onDrop();return}s._disableDelayedDragEvents(),!Ka&&s.nativeDraggable&&(E.draggable=!0),s._triggerDragStart(t,n),kt({sortable:s,name:"choose",originalEvent:t}),Ct(E,r.chosenClass,!0)},r.ignore.split(",").forEach(function(d){Cd(E,d.trim(),Co)}),$(a,"dragover",Ne),$(a,"mousemove",Ne),$(a,"touchmove",Ne),r.supportPointer?($(a,"pointerup",s._onDrop),!this.nativeDraggable&&$(a,"pointercancel",s._onDrop)):($(a,"mouseup",s._onDrop),$(a,"touchend",s._onDrop),$(a,"touchcancel",s._onDrop)),Ka&&this.nativeDraggable&&(this.options.touchStartThreshold=4,E.draggable=!0),St("delayStart",this,{evt:t}),r.delay&&(!r.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Li||ge))){if(C.eventCanceled){this._onDrop();return}r.supportPointer?($(a,"pointerup",s._disableDelayedDrag),$(a,"pointercancel",s._disableDelayedDrag)):($(a,"mouseup",s._disableDelayedDrag),$(a,"touchend",s._disableDelayedDrag),$(a,"touchcancel",s._disableDelayedDrag)),$(a,"mousemove",s._delayedDragTouchMoveHandler),$(a,"touchmove",s._delayedDragTouchMoveHandler),r.supportPointer&&$(a,"pointermove",s._delayedDragTouchMoveHandler),s._dragStartTimer=setTimeout(l,r.delay)}else l()}},_delayedDragTouchMoveHandler:function(t){var n=t.touches?t.touches[0]:t;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){E&&Co(E),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._disableDelayedDrag),F(t,"touchend",this._disableDelayedDrag),F(t,"touchcancel",this._disableDelayedDrag),F(t,"pointerup",this._disableDelayedDrag),F(t,"pointercancel",this._disableDelayedDrag),F(t,"mousemove",this._delayedDragTouchMoveHandler),F(t,"touchmove",this._delayedDragTouchMoveHandler),F(t,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(t,n){n=n||t.pointerType=="touch"&&t,!this.nativeDraggable||n?this.options.supportPointer?$(document,"pointermove",this._onTouchMove):n?$(document,"touchmove",this._onTouchMove):$(document,"mousemove",this._onTouchMove):($(E,"dragend",this),$(tt,"dragstart",this._onDragStart));try{document.selection?bs(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(t,n){if(ln=!1,tt&&E){St("dragStarted",this,{evt:n}),this.nativeDraggable&&$(document,"dragover",Rm);var i=this.options;!t&&Ct(E,i.dragClass,!1),Ct(E,i.ghostClass,!0),C.active=this,t&&this._appendGhost(),kt({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(Ht){this._lastX=Ht.clientX,this._lastY=Ht.clientY,Fd();for(var t=document.elementFromPoint(Ht.clientX,Ht.clientY),n=t;t&&t.shadowRoot&&(t=t.shadowRoot.elementFromPoint(Ht.clientX,Ht.clientY),t!==n);)n=t;if(E.parentNode[Dt]._isOutsideThisEl(t),n)do{if(n[Dt]){var i=void 0;if(i=n[Dt]._onDragOver({clientX:Ht.clientX,clientY:Ht.clientY,target:t,rootEl:n}),i&&!this.options.dragoverBubble)break}t=n}while(n=Md(n));Hd()}},_onTouchMove:function(t){if(Be){var n=this.options,i=n.fallbackTolerance,s=n.fallbackOffset,o=t.touches?t.touches[0]:t,r=O&&gn(O,!0),a=O&&r&&r.a,l=O&&r&&r.d,c=Wi&&yt&&Qa(yt),d=(o.clientX-Be.clientX+s.x)/(a||1)+(c?c[0]-Mo[0]:0)/(a||1),u=(o.clientY-Be.clientY+s.y)/(l||1)+(c?c[1]-Mo[1]:0)/(l||1);if(!C.active&&!ln){if(i&&Math.max(Math.abs(o.clientX-this._lastX),Math.abs(o.clientY-this._lastY))<i)return;this._onDragStart(t,!0)}if(O){r?(r.e+=d-(Do||0),r.f+=u-(To||0)):r={a:1,b:0,c:0,d:1,e:d,f:u};var h="matrix(".concat(r.a,",").concat(r.b,",").concat(r.c,",").concat(r.d,",").concat(r.e,",").concat(r.f,")");M(O,"webkitTransform",h),M(O,"mozTransform",h),M(O,"msTransform",h),M(O,"transform",h),Do=d,To=u,Ht=o}t.cancelable&&t.preventDefault()}},_appendGhost:function(){if(!O){var t=this.options.fallbackOnBody?document.body:tt,n=ct(E,!0,Wi,!0,t),i=this.options;if(Wi){for(yt=t;M(yt,"position")==="static"&&M(yt,"transform")==="none"&&yt!==document;)yt=yt.parentNode;yt!==document.body&&yt!==document.documentElement?(yt===document&&(yt=Gt()),n.top+=yt.scrollTop,n.left+=yt.scrollLeft):yt=Gt(),Mo=Qa(yt)}O=E.cloneNode(!0),Ct(O,i.ghostClass,!1),Ct(O,i.fallbackClass,!0),Ct(O,i.dragClass,!0),M(O,"transition",""),M(O,"transform",""),M(O,"box-sizing","border-box"),M(O,"margin",0),M(O,"top",n.top),M(O,"left",n.left),M(O,"width",n.width),M(O,"height",n.height),M(O,"opacity","0.8"),M(O,"position",Wi?"absolute":"fixed"),M(O,"zIndex","100000"),M(O,"pointerEvents","none"),C.ghost=O,t.appendChild(O),M(O,"transform-origin",tl/parseInt(O.style.width)*100+"% "+el/parseInt(O.style.height)*100+"%")}},_onDragStart:function(t,n){var i=this,s=t.dataTransfer,o=i.options;if(St("dragStart",this,{evt:t}),C.eventCanceled){this._onDrop();return}St("setupClone",this),C.eventCanceled||(it=Od(E),it.removeAttribute("id"),it.draggable=!1,it.style["will-change"]="",this._hideClone(),Ct(it,this.options.chosenClass,!1),C.clone=it),i.cloneId=bs(function(){St("clone",i),!C.eventCanceled&&(i.options.removeCloneOnHide||tt.insertBefore(it,E),i._hideClone(),kt({sortable:i,name:"clone"}))}),!n&&Ct(E,o.dragClass,!0),n?($s=!0,i._loopId=setInterval(i._emulateDragOver,50)):(F(document,"mouseup",i._onDrop),F(document,"touchend",i._onDrop),F(document,"touchcancel",i._onDrop),s&&(s.effectAllowed="move",o.setData&&o.setData.call(i,s,E)),$(document,"drop",i),M(E,"transform","translateZ(0)")),ln=!0,i._dragStartId=bs(i._dragStarted.bind(i,n,t)),$(document,"selectstart",i),Fn=!0,window.getSelection().removeAllRanges(),ni&&M(document.body,"user-select","none")},_onDragOver:function(t){var n=this.el,i=t.target,s,o,r,a=this.options,l=a.group,c=C.active,d=Vi===l,u=a.sort,h=mt||c,f,g=this,p=!1;if(ar)return;function m(pt,ut){St(pt,g,Jt({evt:t,isOwner:d,axis:f?"vertical":"horizontal",revert:r,dragRect:s,targetRect:o,canSort:u,fromSortable:h,target:i,completed:y,onMove:function(Oe,pe){return Yi(tt,n,E,s,Oe,ct(Oe),t,pe)},changed:x},ut))}function b(){m("dragOverAnimationCapture"),g.captureAnimationState(),g!==h&&h.captureAnimationState()}function y(pt){return m("dragOverCompleted",{insertion:pt}),pt&&(d?c._hideClone():c._showClone(g),g!==h&&(Ct(E,mt?mt.options.ghostClass:c.options.ghostClass,!1),Ct(E,a.ghostClass,!0)),mt!==g&&g!==C.active?mt=g:g===C.active&&mt&&(mt=null),h===g&&(g._ignoreWhileAnimating=i),g.animateAll(function(){m("dragOverAnimationComplete"),g._ignoreWhileAnimating=null}),g!==h&&(h.animateAll(),h._ignoreWhileAnimating=null)),(i===E&&!E.animated||i===n&&!i.animated)&&(sn=null),!a.dragoverBubble&&!t.rootEl&&i!==document&&(E.parentNode[Dt]._isOutsideThisEl(t.target),!pt&&Ne(t)),!a.dragoverBubble&&t.stopPropagation&&t.stopPropagation(),p=!0}function x(){At=Rt(E),be=Rt(E,a.draggable),kt({sortable:g,name:"change",toEl:n,newIndex:At,newDraggableIndex:be,originalEvent:t})}if(t.preventDefault!==void 0&&t.cancelable&&t.preventDefault(),i=$t(i,a.draggable,n,!0),m("dragOver"),C.eventCanceled)return p;if(E.contains(t.target)||i.animated&&i.animatingX&&i.animatingY||g._ignoreWhileAnimating===i)return y(!1);if($s=!1,c&&!a.disabled&&(d?u||(r=st!==tt):mt===this||(this.lastPutMode=Vi.checkPull(this,c,E,t))&&l.checkPut(this,c,E,t))){if(f=this._getDirection(t,i)==="vertical",s=ct(E),m("dragOverValid"),C.eventCanceled)return p;if(r)return st=tt,b(),this._hideClone(),m("revert"),C.eventCanceled||(je?tt.insertBefore(E,je):tt.appendChild(E)),y(!0);var _=Vr(n,a.draggable);if(!_||Hm(t,f,this)&&!_.animated){if(_===E)return y(!1);if(_&&n===t.target&&(i=_),i&&(o=ct(i)),Yi(tt,n,E,s,i,o,t,!!i)!==!1)return b(),_&&_.nextSibling?n.insertBefore(E,_.nextSibling):n.appendChild(E),st=n,x(),y(!0)}else if(_&&Fm(t,f,this)){var v=yn(n,0,a,!0);if(v===E)return y(!1);if(i=v,o=ct(i),Yi(tt,n,E,s,i,o,t,!1)!==!1)return b(),n.insertBefore(E,v),st=n,x(),y(!0)}else if(i.parentNode===n){o=ct(i);var w=0,k,S=E.parentNode!==n,D=!Om(E.animated&&E.toRect||s,i.animated&&i.toRect||o,f),A=f?"top":"left",T=Za(i,"top","top")||Za(E,"top","top"),R=T?T.scrollTop:void 0;sn!==i&&(k=o[A],ri=!1,Ui=!D&&a.invertSwap||S),w=$m(t,i,o,f,D?1:a.swapThreshold,a.invertedSwapThreshold==null?a.swapThreshold:a.invertedSwapThreshold,Ui,sn===i);var G;if(w!==0){var rt=Rt(E);do rt-=w,G=st.children[rt];while(G&&(M(G,"display")==="none"||G===O))}if(w===0||G===i)return y(!1);sn=i,oi=w;var z=i.nextElementSibling,j=!1;j=w===1;var J=Yi(tt,n,E,s,i,o,t,j);if(J!==!1)return(J===1||J===-1)&&(j=J===1),ar=!0,setTimeout(Nm,30),b(),j&&!z?n.appendChild(E):i.parentNode.insertBefore(E,j?z:i),T&&Ld(T,0,R-T.scrollTop),st=E.parentNode,k!==void 0&&!Ui&&(ms=Math.abs(k-ct(i)[A])),x(),y(!0)}if(n.contains(E))return y(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){F(document,"mousemove",this._onTouchMove),F(document,"touchmove",this._onTouchMove),F(document,"pointermove",this._onTouchMove),F(document,"dragover",Ne),F(document,"mousemove",Ne),F(document,"touchmove",Ne)},_offUpEvents:function(){var t=this.el.ownerDocument;F(t,"mouseup",this._onDrop),F(t,"touchend",this._onDrop),F(t,"pointerup",this._onDrop),F(t,"pointercancel",this._onDrop),F(t,"touchcancel",this._onDrop),F(document,"selectstart",this)},_onDrop:function(t){var n=this.el,i=this.options;if(At=Rt(E),be=Rt(E,i.draggable),St("drop",this,{evt:t}),st=E&&E.parentNode,At=Rt(E),be=Rt(E,i.draggable),C.eventCanceled){this._nulling();return}ln=!1,Ui=!1,ri=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),lr(this.cloneId),lr(this._dragStartId),this.nativeDraggable&&(F(document,"drop",this),F(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),ni&&M(document.body,"user-select",""),M(E,"transform",""),t&&(Fn&&(t.cancelable&&t.preventDefault(),!i.dropBubble&&t.stopPropagation()),O&&O.parentNode&&O.parentNode.removeChild(O),(tt===st||mt&&mt.lastPutMode!=="clone")&&it&&it.parentNode&&it.parentNode.removeChild(it),E&&(this.nativeDraggable&&F(E,"dragend",this),Co(E),E.style["will-change"]="",Fn&&!ln&&Ct(E,mt?mt.options.ghostClass:this.options.ghostClass,!1),Ct(E,this.options.chosenClass,!1),kt({sortable:this,name:"unchoose",toEl:st,newIndex:null,newDraggableIndex:null,originalEvent:t}),tt!==st?(At>=0&&(kt({rootEl:st,name:"add",toEl:st,fromEl:tt,originalEvent:t}),kt({sortable:this,name:"remove",toEl:st,originalEvent:t}),kt({rootEl:st,name:"sort",toEl:st,fromEl:tt,originalEvent:t}),kt({sortable:this,name:"sort",toEl:st,originalEvent:t})),mt&&mt.save()):At!==cn&&At>=0&&(kt({sortable:this,name:"update",toEl:st,originalEvent:t}),kt({sortable:this,name:"sort",toEl:st,originalEvent:t})),C.active&&((At==null||At===-1)&&(At=cn,be=si),kt({sortable:this,name:"end",toEl:st,originalEvent:t}),this.save()))),this._nulling()},_nulling:function(){St("nulling",this),tt=E=st=O=je=it=ps=ye=Be=Ht=Fn=At=be=cn=si=sn=oi=mt=Vi=C.dragged=C.ghost=C.clone=C.active=null,js.forEach(function(t){t.checked=!0}),js.length=Do=To=0},handleEvent:function(t){switch(t.type){case"drop":case"dragend":this._onDrop(t);break;case"dragenter":case"dragover":E&&(this._onDragOver(t),Bm(t));break;case"selectstart":t.preventDefault();break}},toArray:function(){for(var t=[],n,i=this.el.children,s=0,o=i.length,r=this.options;s<o;s++)n=i[s],$t(n,r.draggable,this.el,!1)&&t.push(n.getAttribute(r.dataIdAttr)||jm(n));return t},sort:function(t,n){var i={},s=this.el;this.toArray().forEach(function(o,r){var a=s.children[r];$t(a,this.options.draggable,s,!1)&&(i[o]=a)},this),n&&this.captureAnimationState(),t.forEach(function(o){i[o]&&(s.removeChild(i[o]),s.appendChild(i[o]))}),n&&this.animateAll()},save:function(){var t=this.options.store;t&&t.set&&t.set(this)},closest:function(t,n){return $t(t,n||this.options.draggable,this.el,!1)},option:function(t,n){var i=this.options;if(n===void 0)return i[t];var s=Oi.modifyOption(this,t,n);typeof s<"u"?i[t]=s:i[t]=n,t==="group"&&Nd(i)},destroy:function(){St("destroy",this);var t=this.el;t[Dt]=null,F(t,"mousedown",this._onTapStart),F(t,"touchstart",this._onTapStart),F(t,"pointerdown",this._onTapStart),this.nativeDraggable&&(F(t,"dragover",this),F(t,"dragenter",this)),Array.prototype.forEach.call(t.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),zs.splice(zs.indexOf(this.el),1),this.el=t=null},_hideClone:function(){if(!ye){if(St("hideClone",this),C.eventCanceled)return;M(it,"display","none"),this.options.removeCloneOnHide&&it.parentNode&&it.parentNode.removeChild(it),ye=!0}},_showClone:function(t){if(t.lastPutMode!=="clone"){this._hideClone();return}if(ye){if(St("showClone",this),C.eventCanceled)return;E.parentNode==tt&&!this.options.group.revertClone?tt.insertBefore(it,E):je?tt.insertBefore(it,je):tt.appendChild(it),this.options.group.revertClone&&this.animate(E,it),M(it,"display",""),ye=!1}}};function Bm(e){e.dataTransfer&&(e.dataTransfer.dropEffect="move"),e.cancelable&&e.preventDefault()}function Yi(e,t,n,i,s,o,r,a){var l,c=e[Dt],d=c.options.onMove,u;return window.CustomEvent&&!ge&&!Li?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=t,l.from=e,l.dragged=n,l.draggedRect=i,l.related=s||t,l.relatedRect=o||ct(t),l.willInsertAfter=a,l.originalEvent=r,e.dispatchEvent(l),d&&(u=d.call(c,l,r)),u}function Co(e){e.draggable=!1}function Nm(){ar=!1}function Fm(e,t,n){var i=ct(yn(n.el,0,n.options,!0)),s=Pd(n.el,n.options,O),o=10;return t?e.clientX<s.left-o||e.clientY<i.top&&e.clientX<i.right:e.clientY<s.top-o||e.clientY<i.bottom&&e.clientX<i.left}function Hm(e,t,n){var i=ct(Vr(n.el,n.options.draggable)),s=Pd(n.el,n.options,O),o=10;return t?e.clientX>s.right+o||e.clientY>i.bottom&&e.clientX>i.left:e.clientY>s.bottom+o||e.clientX>i.right&&e.clientY>i.top}function $m(e,t,n,i,s,o,r,a){var l=i?e.clientY:e.clientX,c=i?n.height:n.width,d=i?n.top:n.left,u=i?n.bottom:n.right,h=!1;if(!r){if(a&&ms<c*s){if(!ri&&(oi===1?l>d+c*o/2:l<u-c*o/2)&&(ri=!0),ri)h=!0;else if(oi===1?l<d+ms:l>u-ms)return-oi}else if(l>d+c*(1-s)/2&&l<u-c*(1-s)/2)return zm(t)}return h=h||r,h&&(l<d+c*o/2||l>u-c*o/2)?l>d+c/2?1:-1:0}function zm(e){return Rt(E)<Rt(e)?1:-1}function jm(e){for(var t=e.tagName+e.className+e.src+e.href+e.textContent,n=t.length,i=0;n--;)i+=t.charCodeAt(n);return i.toString(36)}function Vm(e){js.length=0;for(var t=e.getElementsByTagName("input"),n=t.length;n--;){var i=t[n];i.checked&&js.push(i)}}function bs(e){return setTimeout(e,0)}function lr(e){return clearTimeout(e)}io&&$(document,"touchmove",function(e){(C.active||ln)&&e.cancelable&&e.preventDefault()});C.utils={on:$,off:F,css:M,find:Cd,is:function(t,n){return!!$t(t,n,t,!1)},extend:Em,throttle:Ad,closest:$t,toggleClass:Ct,clone:Od,index:Rt,nextTick:bs,cancelNextTick:lr,detectDirection:Bd,getChild:yn,expando:Dt};C.get=function(e){return e[Dt]};C.mount=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t[0].constructor===Array&&(t=t[0]),t.forEach(function(i){if(!i.prototype||!i.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(i));i.utils&&(C.utils=Jt(Jt({},C.utils),i.utils)),Oi.mount(i)})};C.create=function(e,t){return new C(e,t)};C.version=km;var lt=[],Hn,cr,dr=!1,Ao,Lo,Vs,$n;function Um(){function e(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var t in this)t.charAt(0)==="_"&&typeof this[t]=="function"&&(this[t]=this[t].bind(this))}return e.prototype={dragStarted:function(n){var i=n.originalEvent;this.sortable.nativeDraggable?$(document,"dragover",this._handleAutoScroll):this.options.supportPointer?$(document,"pointermove",this._handleFallbackAutoScroll):i.touches?$(document,"touchmove",this._handleFallbackAutoScroll):$(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var i=n.originalEvent;!this.options.dragOverBubble&&!i.rootEl&&this._handleAutoScroll(i)},drop:function(){this.sortable.nativeDraggable?F(document,"dragover",this._handleAutoScroll):(F(document,"pointermove",this._handleFallbackAutoScroll),F(document,"touchmove",this._handleFallbackAutoScroll),F(document,"mousemove",this._handleFallbackAutoScroll)),il(),ys(),Im()},nulling:function(){Vs=cr=Hn=dr=$n=Ao=Lo=null,lt.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,i){var s=this,o=(n.touches?n.touches[0]:n).clientX,r=(n.touches?n.touches[0]:n).clientY,a=document.elementFromPoint(o,r);if(Vs=n,i||this.options.forceAutoScrollFallback||Li||ge||ni){Oo(n,this.options,a,i);var l=_e(a,!0);dr&&(!$n||o!==Ao||r!==Lo)&&($n&&il(),$n=setInterval(function(){var c=_e(document.elementFromPoint(o,r),!0);c!==l&&(l=c,ys()),Oo(n,s.options,c,i)},10),Ao=o,Lo=r)}else{if(!this.options.bubbleScroll||_e(a,!0)===Gt()){ys();return}Oo(n,this.options,_e(a,!1),!1)}}},he(e,{pluginName:"scroll",initializeByDefault:!0})}function ys(){lt.forEach(function(e){clearInterval(e.pid)}),lt=[]}function il(){clearInterval($n)}var Oo=Ad(function(e,t,n,i){if(t.scroll){var s=(e.touches?e.touches[0]:e).clientX,o=(e.touches?e.touches[0]:e).clientY,r=t.scrollSensitivity,a=t.scrollSpeed,l=Gt(),c=!1,d;cr!==n&&(cr=n,ys(),Hn=t.scroll,d=t.scrollFn,Hn===!0&&(Hn=_e(n,!0)));var u=0,h=Hn;do{var f=h,g=ct(f),p=g.top,m=g.bottom,b=g.left,y=g.right,x=g.width,_=g.height,v=void 0,w=void 0,k=f.scrollWidth,S=f.scrollHeight,D=M(f),A=f.scrollLeft,T=f.scrollTop;f===l?(v=x<k&&(D.overflowX==="auto"||D.overflowX==="scroll"||D.overflowX==="visible"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"||D.overflowY==="visible")):(v=x<k&&(D.overflowX==="auto"||D.overflowX==="scroll"),w=_<S&&(D.overflowY==="auto"||D.overflowY==="scroll"));var R=v&&(Math.abs(y-s)<=r&&A+x<k)-(Math.abs(b-s)<=r&&!!A),G=w&&(Math.abs(m-o)<=r&&T+_<S)-(Math.abs(p-o)<=r&&!!T);if(!lt[u])for(var rt=0;rt<=u;rt++)lt[rt]||(lt[rt]={});(lt[u].vx!=R||lt[u].vy!=G||lt[u].el!==f)&&(lt[u].el=f,lt[u].vx=R,lt[u].vy=G,clearInterval(lt[u].pid),(R!=0||G!=0)&&(c=!0,lt[u].pid=setInterval((function(){i&&this.layer===0&&C.active._onTouchMove(Vs);var z=lt[this.layer].vy?lt[this.layer].vy*a:0,j=lt[this.layer].vx?lt[this.layer].vx*a:0;typeof d=="function"&&d.call(C.dragged.parentNode[Dt],j,z,e,Vs,lt[this.layer].el)!=="continue"||Ld(lt[this.layer].el,j,z)}).bind({layer:u}),24))),u++}while(t.bubbleScroll&&h!==l&&(h=_e(h,!1)));dr=c}},30),$d=function(t){var n=t.originalEvent,i=t.putSortable,s=t.dragEl,o=t.activeSortable,r=t.dispatchSortableEvent,a=t.hideGhostForTarget,l=t.unhideGhostForTarget;if(n){var c=i||o;a();var d=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(d.clientX,d.clientY);l(),c&&!c.el.contains(u)&&(r("spill"),this.onSpill({dragEl:s,putSortable:i}))}};function Ur(){}Ur.prototype={startIndex:null,dragStart:function(t){var n=t.oldDraggableIndex;this.startIndex=n},onSpill:function(t){var n=t.dragEl,i=t.putSortable;this.sortable.captureAnimationState(),i&&i.captureAnimationState();var s=yn(this.sortable.el,this.startIndex,this.options);s?this.sortable.el.insertBefore(n,s):this.sortable.el.appendChild(n),this.sortable.animateAll(),i&&i.animateAll()},drop:$d};he(Ur,{pluginName:"revertOnSpill"});function Wr(){}Wr.prototype={onSpill:function(t){var n=t.dragEl,i=t.putSortable,s=i||this.sortable;s.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),s.animateAll()},drop:$d};he(Wr,{pluginName:"removeOnSpill"});C.mount(new Um);C.mount(Wr,Ur);const Wm={id:null,start:"09:00",end:"10:00",color:"#3B82F6"};function zd(e=null){var i;const t="timeblock-modal";(i=document.getElementById(t))==null||i.remove();const n=document.createElement("div");n.id=t,n.className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-[80] p-4 animate-fade-in",n.innerHTML=dm(),document.body.appendChild(n),Ym(e),gm(),qm(n)}function Ym(e){const t=document.getElementById("tb-list"),n=document.getElementById("add-tb-btn");if(!t)return;t.innerHTML="";const i=ue(),s=document.createDocumentFragment();i.forEach(o=>s.appendChild(jd(o))),t.appendChild(s),Fs(n,i.length),new C(t,{animation:150,handle:".handle",ghostClass:"bg-blue-50",onEnd:function(o){}}),e!=null&&e.id&&requestAnimationFrame(()=>{const o=t.querySelector(`.tb-row[data-id="${e.id}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.classList.add("bg-blue-50","dark:bg-blue-900/20"))})}function jd(e=null){const t=e||{...Wm},n=document.createElement("div");n.className="tb-row flex items-center gap-4 py-2 group transition-colors hover:bg-gray-50/50 dark:hover:bg-gray-900/20 px-2 rounded-lg select-none",t.id&&(n.dataset.id=t.id),n.innerHTML=um(t);const i=n.querySelector(".delete-btn");return i.onclick=()=>ym(n),n}function qm(e){const t=e.querySelector("#add-tb-btn"),n=e.querySelector("#close-tb-modal"),i=e.querySelector("#close-tb-footer"),s=()=>{e.remove(),document.removeEventListener("keydown",o),document.removeEventListener("click",handleOutsideClick),window.tbHandleOutsideClick&&(window.tbHandleOutsideClick=null)},o=r=>{r.key==="Escape"&&s()};n.onclick=s,i.onclick=async()=>await vm(i,s),e.onclick=r=>{r.target===e&&s()},document.addEventListener("keydown",o),t.onclick=()=>{const r=document.getElementById("tb-list"),a=r.querySelectorAll(".tb-row").length;if(a<Ns){const l=jd();r.appendChild(l),Fs(t,a+1),l.scrollIntoView({behavior:"smooth"})}},Gm(e)}function Gm(e){let t=null;const n=i=>{t&&!t.contains(i.target)&&(t.querySelector(".tb-select-options").classList.add("hidden"),t=null);const s=document.getElementById("tb-color-picker"),o=i.target.closest(".tb-color-trigger"),r=s&&s.contains(i.target);!o&&!r&&s&&!s.classList.contains("hidden")&&mm()};setTimeout(()=>document.addEventListener("click",n),0),e.addEventListener("click",i=>{const s=i.target.closest(".tb-select-trigger");if(s){const a=s.closest(".tb-custom-select"),l=a.querySelector(".tb-select-options");document.querySelectorAll(".tb-select-options").forEach(c=>{c!==l&&c.classList.add("hidden")}),l.classList.toggle("hidden"),t=l.classList.contains("hidden")?null:a,i.stopPropagation();return}const o=i.target.closest(".tb-select-option");if(o){const a=o.closest(".tb-custom-select"),l=o.dataset.value;a.dataset.value=l,a.querySelector(".value-display").textContent=l,a.querySelectorAll(".tb-select-option").forEach(c=>{c.dataset.value===l?c.classList.add("bg-blue-50/50","font-bold"):c.classList.remove("bg-blue-50/50","font-bold")}),a.querySelector(".tb-select-options").classList.add("hidden"),t=null,i.stopPropagation();return}const r=i.target.closest(".tb-color-trigger");r&&(pm(r),i.stopPropagation())})}function Xm(e){const t=document.getElementById("add-project-btn");t&&t.addEventListener("click",n=>{n.stopPropagation(),xd()})}function Km(e,t=[]){const n=document.getElementById("project-list");if(n){if(n.innerHTML="",e.length===0){n.innerHTML='<li class="px-6 py-2 text-xs text-gray-400 italic select-none">プロジェクトなし</li>';return}e.forEach(i=>{const s=t.filter(r=>r.projectId===i.id&&!r.completed).length,o=pi(i.name,"project",i.id,i.color,s);o.onclick=()=>{document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"project",id:i.id}}))},o.oncontextmenu=r=>{r.preventDefault(),r.stopPropagation(),$r(r,"project",i)},mi(o,"project",i.id),n.appendChild(o)})}}function Jm(e,t){let n=Us(e,t);return Zm(n,t.sortCriteria)}function Us(e,t){const{keyword:n,projectId:i,labelId:s,showCompleted:o,timeBlockId:r,duration:a}=t;return e.filter(l=>{if(!o&&l.status==="completed"||i&&l.projectId!==i||s&&(!l.labelIds||!l.labelIds.includes(s)))return!1;if(r){if(r==="unassigned"){if(l.timeBlockId&&l.timeBlockId!=="null")return!1}else if(String(l.timeBlockId)!==String(r))return!1}if(a&&Number(l.duration)!==Number(a))return!1;if(n){const c=n.toLowerCase(),d=l.title.toLowerCase().includes(c),u=(l.description||"").toLowerCase().includes(c);if(!d&&!u)return!1}return!0})}function Zm(e,t="createdAt_desc"){return[...e].sort((n,i)=>{switch(t){case"createdAt_desc":return(i.createdAt||0)-(n.createdAt||0);case"createdAt_asc":return(n.createdAt||0)-(i.createdAt||0);case"dueDate_asc":return n.dueDate?i.dueDate?n.dueDate-i.dueDate:-1:1;case"project_asc":return(n.projectId||"").localeCompare(i.projectId||"");default:return 0}})}function Qm(){const e=document.getElementById("inbox-count");if(!e)return;const t=Sn(),n=Cs(t,i=>!i.projectId);e.textContent=n,e.classList.toggle("hidden",n===0)}function tb(){if(!document.getElementById(B.LIST_IDS.PROJECTS))return;const t=Hr(),n=Sn();Km(t,n)}function eb(){const e=document.getElementById(B.LIST_IDS.TIMEBLOCKS);if(!e)return;e.innerHTML="";const t=document.createDocumentFragment(),n=ue().sort((a,l)=>(a.order||0)-(l.order||0)),i=Sn(),s=Qs();n.forEach(a=>{const l=Cs(i,u=>String(u.timeBlockId)===String(a.id)),c=`${a.start} - ${a.end}`,d=pi(c,"timeblock",a.id,{color:a.color},l,s);d.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:a.id}})),d.oncontextmenu=u=>{u.preventDefault(),zd(a)},mi(d,"timeblock",a.id),t.appendChild(d)});const o=Cs(i,a=>!a.timeBlockId||a.timeBlockId==="null"),r=pi("未定","timeblock","unassigned",{color:"#a0aec0"},o,s);r.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"timeblock",id:"unassigned"}})),mi(r,"timeblock","unassigned"),t.appendChild(r),e.appendChild(t)}function nb(){const e=document.getElementById(B.LIST_IDS.DURATIONS);if(!e)return;e.innerHTML="";const t=Sn(),n=Qs(),i=document.createDocumentFragment(),s='<span class="mr-3 text-sm">⏱️</span>';B.DURATIONS.forEach(o=>{const r=Cs(t,l=>Number(l.duration)===o),a=pi(`${o} min`,"duration",o.toString(),{iconHtml:s},r,n);a.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"duration",id:o.toString()}})),mi(a,"duration",o.toString()),i.appendChild(a)}),e.appendChild(i)}function ib(){const e=document.getElementById(B.LIST_IDS.FILTERS);if(!e)return;e.innerHTML="";const t=pd(),n=Sn(),i=Qs(),s=document.createDocumentFragment(),o='<svg class="mr-3 h-4 w-4 text-gray-400 group-hover:text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"></path></svg>';t.forEach(r=>{let a=0;try{typeof Us=="function"&&(a=Us(n,{savedFilter:r,showCompleted:!1}).length)}catch(c){console.warn("[Sidebar] Filter count error:",c)}const l=pi(r.name,"filter",r.id,{iconHtml:o},a,i);l.onclick=()=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:"custom",id:r.id}})),l.oncontextmenu=c=>{c.preventDefault(),$r(c,"filter",r)},s.appendChild(l)}),e.appendChild(s)}function sb(){tb(),eb(),nb(),ib(),Qm()}let dn=null,qi=null,Ot={};function sl(){Ot={container:document.getElementById("sidebar-content"),sidebar:document.getElementById("sidebar"),resizer:document.getElementById("sidebar-resizer"),openBtn:document.getElementById("sidebar-open-btn"),closeBtn:document.getElementById("sidebar-close-btn"),inbox:document.getElementById("nav-inbox")}}function ob(){if(sl(),!Ot.container)return;Ot.container.innerHTML=om(),sl(),Bc(Ot.sidebar,Ot.resizer),ab(),rm(),am(),rb(),Ot.inbox&&mi(Ot.inbox,"inbox"),Xm(Ot.container),qi&&window.removeEventListener("resize",qi),qi=()=>ur(),window.addEventListener("resize",qi),ur();const e=Ti(B.STORAGE_KEYS.COMPACT,!1);Yr(e),lb(),dn&&dn()}function rb(){const e=["timeblocks-updated","projects-updated","labels-updated","filters-updated","tasks-updated"];dn&&e.forEach(t=>document.removeEventListener(t,dn)),dn=()=>{sb();const t=Ti(B.STORAGE_KEYS.COMPACT,!1);Yr(t)},e.forEach(t=>document.addEventListener(t,dn))}function ab(){var t,n;const e=(i,s=null)=>document.dispatchEvent(new CustomEvent("route-change",{detail:{page:i,id:s}}));Ot.container.addEventListener("click",i=>{const s=i.target.closest("a"),o=i.target.closest("button");if(s){i.preventDefault();const r=s.id;r==="nav-dashboard"&&e("dashboard"),r==="nav-inbox"&&e("inbox"),r==="nav-search"&&e("search"),r==="nav-settings"&&no();return}if(o){const r=o.id;r==="add-filter-btn"&&vd(),r==="edit-timeblocks-btn"&&zd()}}),(t=Ot.openBtn)==null||t.addEventListener("click",()=>ol(!0)),(n=Ot.closeBtn)==null||n.addEventListener("click",()=>ol(!1))}function Yr(e){const t=document.querySelectorAll(".sidebar-item-row"),{COMPACT_PY:n,NORMAL_PY:i}=B.CLASSES;t.forEach(s=>{s.classList.toggle(n,e),s.classList.toggle(i,!e)})}function ol(e){const{sidebar:t,resizer:n}=Ot,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(t){if(t.classList.toggle(i,!e),t.classList.toggle(s,!e),Ar())if(n&&n.classList.toggle(s,!e),e){const o=localStorage.getItem(B.STORAGE_KEYS.WIDTH)||B.DEFAULT_WIDTH;t.style.width=`${o}px`}else t.style.width="0";ur()}}function ur(){const{sidebar:e,openBtn:t,closeBtn:n}=Ot,{CLOSED:i,HIDDEN:s}=B.CLASSES;if(!e||!t||!n)return;const o=e.classList.contains(i)||e.classList.contains(s);Ar()?(t.classList.toggle(s,!o),n.classList.toggle(s,o),o||e.classList.remove(s)):(t.classList.remove(s),n.classList.remove(s),e.classList.remove(s))}function lb(){window.addEventListener("sidebar-settings-updated",e=>{Yr(!!e.detail.compact)})}const cb={FAVICON:"/images/favicon-96x96.png"},db={CRITICAL_ERROR_OVERLAY:"critical-error-overlay"},zn={PROJECT:"project",LABEL:"label",TIMEBLOCK:"timeblock",DURATION:"duration",FILTER:"filter"},qr={VIEW_IDS:{TASK:"task-view",DASHBOARD:"dashboard-view",SEARCH:"search-view",SETTINGS:"settings-view"},HEADER_IDS:{TITLE:"header-title",COUNT:"header-count"},CLASSES:{HIGHLIGHT:["bg-blue-600","dark:bg-blue-600","text-white","dark:text-white"],NORMAL:["text-gray-700","dark:text-gray-300","hover:bg-gray-100","dark:hover:bg-gray-800"],FADE_IN:"animate-fade-in",HIDDEN:"hidden"},DATA_ATTRS:{DEFAULT_COLOR:"data-default-color"}},{CLASSES:ht,HEADER_IDS:rl,DATA_ATTRS:ub}=qr;function vs(e,t){Array.isArray(t)&&t.forEach(n=>{var i,s;(i=n==null?void 0:n.classList)==null||i.add(ht.HIDDEN),(s=n==null?void 0:n.classList)==null||s.remove(ht.FADE_IN)}),e!=null&&e.classList&&(e.classList.remove(ht.HIDDEN),e.classList.add(ht.FADE_IN))}function Vd(){document.querySelectorAll(".sidebar-item-row").forEach(e=>{e.classList.remove(...Array.isArray(ht.HIGHLIGHT)?ht.HIGHLIGHT:[ht.HIGHLIGHT]),e.classList.add(...Array.isArray(ht.NORMAL)?ht.NORMAL:[ht.NORMAL]);const t=e.querySelector("svg, span:not(.truncate)");if(t){const n=Array.from(t.classList).filter(s=>s.startsWith("text-"));n.length>0&&t.classList.remove(...n);const i=e.getAttribute(ub.DEFAULT_COLOR);i&&t.classList.add(i)}})}function hb(e){Vd();const t=fb(e);if(t!=null&&t.classList){t.classList.remove(...Array.isArray(ht.NORMAL)?ht.NORMAL:[ht.NORMAL]),t.classList.add(...Array.isArray(ht.HIGHLIGHT)?ht.HIGHLIGHT:[ht.HIGHLIGHT]);const n=t.querySelector("svg, span:not(.truncate)");if(n){const i=Array.from(n.classList).filter(s=>s.startsWith("text-"));i.length>0&&n.classList.remove(...i),n.classList.add("text-white")}}}function fb(e){if(!e)return null;const{type:t,id:n}=e;if(["inbox","dashboard","search","settings"].includes(t))return document.getElementById(`nav-${t}`);const s=t==="custom"?zn.FILTER:t;return document.querySelector(`.sidebar-item-row[data-type="${s}"][data-id="${n}"]`)}function Ud(e,t=[],n=[]){var c;const i=document.getElementById(rl.TITLE),s=document.getElementById(rl.COUNT);if(!i)return;let o="インボックス";const{type:r,id:a,name:l}=e;if(l)o=l;else switch(r){case zn.PROJECT:o=((c=t.find(u=>u.id===a))==null?void 0:c.name)||"プロジェクト";break;case zn.LABEL:const d=n.find(u=>u.id===a);o=d?`ラベル: ${d.name}`:"ラベル";break;case zn.TIMEBLOCK:if(a==="unassigned")o="時間帯: 未定";else{const u=hp(a);o=u?`時間帯: ${u.start} - ${u.end}`:"時間帯"}break;case zn.DURATION:o=`所要時間: ${a}分`;break;case"search":o="タスク検索";break;case"dashboard":o="ダッシュボード";break}i.textContent=o,s&&["dashboard","search"].includes(r)&&(s.textContent="")}function gb(){const{VIEW_IDS:e}=qr;Object.values(e).forEach(n=>{const i=document.getElementById(n);n!==e.TASK&&i&&i.classList.add(ht.HIDDEN)});const t=document.getElementById(e.TASK);t&&(t.classList.remove(ht.HIDDEN),t.innerHTML=`
        <div id="login-container-wrapper" class="flex flex-col items-center justify-center min-h-[60vh] animate-fade-in">
            <div id="login-form-container" class="w-full max-w-md p-8 bg-white dark:bg-gray-800 rounded-xl shadow-2xl border border-gray-100 dark:border-gray-700">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-extrabold text-gray-800 dark:text-white mb-2">Welcome Back</h1>
                    <p class="text-gray-500 dark:text-gray-400">タスク管理をはじめよう</p>
                </div>
                
                <div class="space-y-4 mb-6">
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">メールアドレス</label>
                        <input id="email-input" type="email" placeholder="name@example.com" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                    
                    <div>
                        <label class="block text-gray-700 dark:text-gray-300 text-sm font-bold mb-2 ml-1">パスワード</label>
                        <input id="password-input" type="password" placeholder="••••••••" class="w-full px-4 py-3 rounded-lg border border-gray-300 dark:border-gray-600 focus:border-blue-500 focus:ring-2 focus:ring-blue-200 dark:bg-gray-700 dark:text-white transition-all outline-none">
                    </div>
                </div>
                
                <button id="email-login-btn" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 transform hover:-translate-y-0.5 mb-6">
                    ログイン
                </button>

                <div class="relative flex py-2 items-center mb-6">
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                    <span class="flex-shrink mx-4 text-gray-400 text-sm">または</span>
                    <div class="flex-grow border-t border-gray-300 dark:border-gray-600"></div>
                </div>

                <div class="bg-gray-50 dark:bg-gray-700/50 p-4 rounded-lg border border-gray-200 dark:border-gray-600 text-center">
                     <p class="text-sm text-gray-600 dark:text-gray-300 mb-3">アカウント登録なしで試す</p>
                    <button id="guest-login-btn" class="w-full bg-white dark:bg-gray-600 hover:bg-gray-50 dark:hover:bg-gray-500 text-gray-800 dark:text-white font-semibold py-2 px-4 border border-gray-300 dark:border-gray-500 rounded-lg shadow-sm transition-all duration-200 flex items-center justify-center gap-2">
                        <span>🚀</span> ゲストとして利用する
                    </button>
                    <p class="text-xs text-gray-400 mt-2">※ゲストデータはローカルに保存されます</p>
                </div>
            </div>
            
            <!-- ユーザー情報表示用（ロジック互換性のため残す、実際はヘッダー等で管理推奨） -->
            <div id="user-info" class="hidden">
                 <span id="user-email-display"></span>
            </div>
        </div>
    `)}/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function Pi(e){return e+.5|0}const we=(e,t,n)=>Math.max(Math.min(e,n),t);function jn(e){return we(Pi(e*2.55),0,255)}function Te(e){return we(Pi(e*255),0,255)}function ie(e){return we(Pi(e/2.55)/100,0,1)}function al(e){return we(Pi(e*100),0,100)}const Pt={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},hr=[..."0123456789ABCDEF"],pb=e=>hr[e&15],mb=e=>hr[(e&240)>>4]+hr[e&15],Gi=e=>(e&240)>>4===(e&15),bb=e=>Gi(e.r)&&Gi(e.g)&&Gi(e.b)&&Gi(e.a);function yb(e){var t=e.length,n;return e[0]==="#"&&(t===4||t===5?n={r:255&Pt[e[1]]*17,g:255&Pt[e[2]]*17,b:255&Pt[e[3]]*17,a:t===5?Pt[e[4]]*17:255}:(t===7||t===9)&&(n={r:Pt[e[1]]<<4|Pt[e[2]],g:Pt[e[3]]<<4|Pt[e[4]],b:Pt[e[5]]<<4|Pt[e[6]],a:t===9?Pt[e[7]]<<4|Pt[e[8]]:255})),n}const vb=(e,t)=>e<255?t(e):"";function xb(e){var t=bb(e)?pb:mb;return e?"#"+t(e.r)+t(e.g)+t(e.b)+vb(e.a,t):void 0}const _b=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function Wd(e,t,n){const i=t*Math.min(n,1-n),s=(o,r=(o+e/30)%12)=>n-i*Math.max(Math.min(r-3,9-r,1),-1);return[s(0),s(8),s(4)]}function wb(e,t,n){const i=(s,o=(s+e/60)%6)=>n-n*t*Math.max(Math.min(o,4-o,1),0);return[i(5),i(3),i(1)]}function kb(e,t,n){const i=Wd(e,1,.5);let s;for(t+n>1&&(s=1/(t+n),t*=s,n*=s),s=0;s<3;s++)i[s]*=1-t-n,i[s]+=t;return i}function Sb(e,t,n,i,s){return e===s?(t-n)/i+(t<n?6:0):t===s?(n-e)/i+2:(e-t)/i+4}function Gr(e){const n=e.r/255,i=e.g/255,s=e.b/255,o=Math.max(n,i,s),r=Math.min(n,i,s),a=(o+r)/2;let l,c,d;return o!==r&&(d=o-r,c=a>.5?d/(2-o-r):d/(o+r),l=Sb(n,i,s,d,o),l=l*60+.5),[l|0,c||0,a]}function Xr(e,t,n,i){return(Array.isArray(t)?e(t[0],t[1],t[2]):e(t,n,i)).map(Te)}function Kr(e,t,n){return Xr(Wd,e,t,n)}function Eb(e,t,n){return Xr(kb,e,t,n)}function Ib(e,t,n){return Xr(wb,e,t,n)}function Yd(e){return(e%360+360)%360}function Db(e){const t=_b.exec(e);let n=255,i;if(!t)return;t[5]!==i&&(n=t[6]?jn(+t[5]):Te(+t[5]));const s=Yd(+t[2]),o=+t[3]/100,r=+t[4]/100;return t[1]==="hwb"?i=Eb(s,o,r):t[1]==="hsv"?i=Ib(s,o,r):i=Kr(s,o,r),{r:i[0],g:i[1],b:i[2],a:n}}function Tb(e,t){var n=Gr(e);n[0]=Yd(n[0]+t),n=Kr(n),e.r=n[0],e.g=n[1],e.b=n[2]}function Mb(e){if(!e)return;const t=Gr(e),n=t[0],i=al(t[1]),s=al(t[2]);return e.a<255?`hsla(${n}, ${i}%, ${s}%, ${ie(e.a)})`:`hsl(${n}, ${i}%, ${s}%)`}const ll={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},cl={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Cb(){const e={},t=Object.keys(cl),n=Object.keys(ll);let i,s,o,r,a;for(i=0;i<t.length;i++){for(r=a=t[i],s=0;s<n.length;s++)o=n[s],a=a.replace(o,ll[o]);o=parseInt(cl[r],16),e[a]=[o>>16&255,o>>8&255,o&255]}return e}let Xi;function Ab(e){Xi||(Xi=Cb(),Xi.transparent=[0,0,0,0]);const t=Xi[e.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Lb=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Ob(e){const t=Lb.exec(e);let n=255,i,s,o;if(t){if(t[7]!==i){const r=+t[7];n=t[8]?jn(r):we(r*255,0,255)}return i=+t[1],s=+t[3],o=+t[5],i=255&(t[2]?jn(i):we(i,0,255)),s=255&(t[4]?jn(s):we(s,0,255)),o=255&(t[6]?jn(o):we(o,0,255)),{r:i,g:s,b:o,a:n}}}function Pb(e){return e&&(e.a<255?`rgba(${e.r}, ${e.g}, ${e.b}, ${ie(e.a)})`:`rgb(${e.r}, ${e.g}, ${e.b})`)}const Po=e=>e<=.0031308?e*12.92:Math.pow(e,1/2.4)*1.055-.055,on=e=>e<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4);function Rb(e,t,n){const i=on(ie(e.r)),s=on(ie(e.g)),o=on(ie(e.b));return{r:Te(Po(i+n*(on(ie(t.r))-i))),g:Te(Po(s+n*(on(ie(t.g))-s))),b:Te(Po(o+n*(on(ie(t.b))-o))),a:e.a+n*(t.a-e.a)}}function Ki(e,t,n){if(e){let i=Gr(e);i[t]=Math.max(0,Math.min(i[t]+i[t]*n,t===0?360:1)),i=Kr(i),e.r=i[0],e.g=i[1],e.b=i[2]}}function qd(e,t){return e&&Object.assign(t||{},e)}function dl(e){var t={r:0,g:0,b:0,a:255};return Array.isArray(e)?e.length>=3&&(t={r:e[0],g:e[1],b:e[2],a:255},e.length>3&&(t.a=Te(e[3]))):(t=qd(e,{r:0,g:0,b:0,a:1}),t.a=Te(t.a)),t}function Bb(e){return e.charAt(0)==="r"?Ob(e):Db(e)}class bi{constructor(t){if(t instanceof bi)return t;const n=typeof t;let i;n==="object"?i=dl(t):n==="string"&&(i=yb(t)||Ab(t)||Bb(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=qd(this._rgb);return t&&(t.a=ie(t.a)),t}set rgb(t){this._rgb=dl(t)}rgbString(){return this._valid?Pb(this._rgb):void 0}hexString(){return this._valid?xb(this._rgb):void 0}hslString(){return this._valid?Mb(this._rgb):void 0}mix(t,n){if(t){const i=this.rgb,s=t.rgb;let o;const r=n===o?.5:n,a=2*r-1,l=i.a-s.a,c=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;o=1-c,i.r=255&c*i.r+o*s.r+.5,i.g=255&c*i.g+o*s.g+.5,i.b=255&c*i.b+o*s.b+.5,i.a=r*i.a+(1-r)*s.a,this.rgb=i}return this}interpolate(t,n){return t&&(this._rgb=Rb(this._rgb,t._rgb,n)),this}clone(){return new bi(this.rgb)}alpha(t){return this._rgb.a=Te(t),this}clearer(t){const n=this._rgb;return n.a*=1-t,this}greyscale(){const t=this._rgb,n=Pi(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=n,this}opaquer(t){const n=this._rgb;return n.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Ki(this._rgb,2,t),this}darken(t){return Ki(this._rgb,2,-t),this}saturate(t){return Ki(this._rgb,1,t),this}desaturate(t){return Ki(this._rgb,1,-t),this}rotate(t){return Tb(this._rgb,t),this}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function Qt(){}const Nb=(()=>{let e=0;return()=>e++})();function N(e){return e==null}function et(e){if(Array.isArray&&Array.isArray(e))return!0;const t=Object.prototype.toString.call(e);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function H(e){return e!==null&&Object.prototype.toString.call(e)==="[object Object]"}function ot(e){return(typeof e=="number"||e instanceof Number)&&isFinite(+e)}function Lt(e,t){return ot(e)?e:t}function P(e,t){return typeof e>"u"?t:e}const Fb=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100:+e/t,Gd=(e,t)=>typeof e=="string"&&e.endsWith("%")?parseFloat(e)/100*t:+e;function Z(e,t,n){if(e&&typeof e.call=="function")return e.apply(n,t)}function q(e,t,n,i){let s,o,r;if(et(e))for(o=e.length,s=0;s<o;s++)t.call(n,e[s],s);else if(H(e))for(r=Object.keys(e),o=r.length,s=0;s<o;s++)t.call(n,e[r[s]],r[s])}function Ws(e,t){let n,i,s,o;if(!e||!t||e.length!==t.length)return!1;for(n=0,i=e.length;n<i;++n)if(s=e[n],o=t[n],s.datasetIndex!==o.datasetIndex||s.index!==o.index)return!1;return!0}function Ys(e){if(et(e))return e.map(Ys);if(H(e)){const t=Object.create(null),n=Object.keys(e),i=n.length;let s=0;for(;s<i;++s)t[n[s]]=Ys(e[n[s]]);return t}return e}function Xd(e){return["__proto__","prototype","constructor"].indexOf(e)===-1}function Hb(e,t,n,i){if(!Xd(e))return;const s=t[e],o=n[e];H(s)&&H(o)?yi(s,o,i):t[e]=Ys(o)}function yi(e,t,n){const i=et(t)?t:[t],s=i.length;if(!H(e))return e;n=n||{};const o=n.merger||Hb;let r;for(let a=0;a<s;++a){if(r=i[a],!H(r))continue;const l=Object.keys(r);for(let c=0,d=l.length;c<d;++c)o(l[c],e,r,n)}return e}function ai(e,t){return yi(e,t,{merger:$b})}function $b(e,t,n){if(!Xd(e))return;const i=t[e],s=n[e];H(i)&&H(s)?ai(i,s):Object.prototype.hasOwnProperty.call(t,e)||(t[e]=Ys(s))}const ul={"":e=>e,x:e=>e.x,y:e=>e.y};function zb(e){const t=e.split("."),n=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(n.push(i),i="");return n}function jb(e){const t=zb(e);return n=>{for(const i of t){if(i==="")break;n=n&&n[i]}return n}}function Me(e,t){return(ul[t]||(ul[t]=jb(t)))(e)}function Jr(e){return e.charAt(0).toUpperCase()+e.slice(1)}const vi=e=>typeof e<"u",Ce=e=>typeof e=="function",hl=(e,t)=>{if(e.size!==t.size)return!1;for(const n of e)if(!t.has(n))return!1;return!0};function Vb(e){return e.type==="mouseup"||e.type==="click"||e.type==="contextmenu"}const U=Math.PI,Q=2*U,Ub=Q+U,qs=Number.POSITIVE_INFINITY,Wb=U/180,at=U/2,Fe=U/4,fl=U*2/3,ke=Math.log10,Xt=Math.sign;function li(e,t,n){return Math.abs(e-t)<n}function gl(e){const t=Math.round(e);e=li(e,t,e/1e3)?t:e;const n=Math.pow(10,Math.floor(ke(e))),i=e/n;return(i<=1?1:i<=2?2:i<=5?5:10)*n}function Yb(e){const t=[],n=Math.sqrt(e);let i;for(i=1;i<n;i++)e%i===0&&(t.push(i),t.push(e/i));return n===(n|0)&&t.push(n),t.sort((s,o)=>s-o).pop(),t}function qb(e){return typeof e=="symbol"||typeof e=="object"&&e!==null&&!(Symbol.toPrimitive in e||"toString"in e||"valueOf"in e)}function vn(e){return!qb(e)&&!isNaN(parseFloat(e))&&isFinite(e)}function Gb(e,t){const n=Math.round(e);return n-t<=e&&n+t>=e}function Kd(e,t,n){let i,s,o;for(i=0,s=e.length;i<s;i++)o=e[i][n],isNaN(o)||(t.min=Math.min(t.min,o),t.max=Math.max(t.max,o))}function jt(e){return e*(U/180)}function Zr(e){return e*(180/U)}function pl(e){if(!ot(e))return;let t=1,n=0;for(;Math.round(e*t)/t!==e;)t*=10,n++;return n}function Jd(e,t){const n=t.x-e.x,i=t.y-e.y,s=Math.sqrt(n*n+i*i);let o=Math.atan2(i,n);return o<-.5*U&&(o+=Q),{angle:o,distance:s}}function fr(e,t){return Math.sqrt(Math.pow(t.x-e.x,2)+Math.pow(t.y-e.y,2))}function Xb(e,t){return(e-t+Ub)%Q-U}function xt(e){return(e%Q+Q)%Q}function xi(e,t,n,i){const s=xt(e),o=xt(t),r=xt(n),a=xt(o-s),l=xt(r-s),c=xt(s-o),d=xt(s-r);return s===o||s===r||i&&o===r||a>l&&c<d}function gt(e,t,n){return Math.max(t,Math.min(n,e))}function Kb(e){return gt(e,-32768,32767)}function oe(e,t,n,i=1e-6){return e>=Math.min(t,n)-i&&e<=Math.max(t,n)+i}function Qr(e,t,n){n=n||(r=>e[r]<t);let i=e.length-1,s=0,o;for(;i-s>1;)o=s+i>>1,n(o)?s=o:i=o;return{lo:s,hi:i}}const re=(e,t,n,i)=>Qr(e,n,i?s=>{const o=e[s][t];return o<n||o===n&&e[s+1][t]===n}:s=>e[s][t]<n),Jb=(e,t,n)=>Qr(e,n,i=>e[i][t]>=n);function Zb(e,t,n){let i=0,s=e.length;for(;i<s&&e[i]<t;)i++;for(;s>i&&e[s-1]>n;)s--;return i>0||s<e.length?e.slice(i,s):e}const Zd=["push","pop","shift","splice","unshift"];function Qb(e,t){if(e._chartjs){e._chartjs.listeners.push(t);return}Object.defineProperty(e,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),Zd.forEach(n=>{const i="_onData"+Jr(n),s=e[n];Object.defineProperty(e,n,{configurable:!0,enumerable:!1,value(...o){const r=s.apply(this,o);return e._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...o)}),r}})})}function ml(e,t){const n=e._chartjs;if(!n)return;const i=n.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(Zd.forEach(o=>{delete e[o]}),delete e._chartjs)}function Qd(e){const t=new Set(e);return t.size===e.length?e:Array.from(t)}const tu=(function(){return typeof window>"u"?function(e){return e()}:window.requestAnimationFrame})();function eu(e,t){let n=[],i=!1;return function(...s){n=s,i||(i=!0,tu.call(window,()=>{i=!1,e.apply(t,n)}))}}function t0(e,t){let n;return function(...i){return t?(clearTimeout(n),n=setTimeout(e,t,i)):e.apply(this,i),t}}const ta=e=>e==="start"?"left":e==="end"?"right":"center",vt=(e,t,n)=>e==="start"?t:e==="end"?n:(t+n)/2,e0=(e,t,n,i)=>e===(i?"left":"right")?n:e==="center"?(t+n)/2:t;function nu(e,t,n){const i=t.length;let s=0,o=i;if(e._sorted){const{iScale:r,vScale:a,_parsed:l}=e,c=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null,d=r.axis,{min:u,max:h,minDefined:f,maxDefined:g}=r.getUserBounds();if(f){if(s=Math.min(re(l,d,u).lo,n?i:re(t,d,r.getPixelForValue(u)).lo),c){const p=l.slice(0,s+1).reverse().findIndex(m=>!N(m[a.axis]));s-=Math.max(0,p)}s=gt(s,0,i-1)}if(g){let p=Math.max(re(l,r.axis,h,!0).hi+1,n?0:re(t,d,r.getPixelForValue(h),!0).hi+1);if(c){const m=l.slice(p-1).findIndex(b=>!N(b[a.axis]));p+=Math.max(0,m)}o=gt(p,s,i)-s}else o=i-s}return{start:s,count:o}}function iu(e){const{xScale:t,yScale:n,_scaleRanges:i}=e,s={xmin:t.min,xmax:t.max,ymin:n.min,ymax:n.max};if(!i)return e._scaleRanges=s,!0;const o=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==n.min||i.ymax!==n.max;return Object.assign(i,s),o}const Ji=e=>e===0||e===1,bl=(e,t,n)=>-(Math.pow(2,10*(e-=1))*Math.sin((e-t)*Q/n)),yl=(e,t,n)=>Math.pow(2,-10*e)*Math.sin((e-t)*Q/n)+1,ci={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>-e*(e-2),easeInOutQuad:e=>(e/=.5)<1?.5*e*e:-.5*(--e*(e-2)-1),easeInCubic:e=>e*e*e,easeOutCubic:e=>(e-=1)*e*e+1,easeInOutCubic:e=>(e/=.5)<1?.5*e*e*e:.5*((e-=2)*e*e+2),easeInQuart:e=>e*e*e*e,easeOutQuart:e=>-((e-=1)*e*e*e-1),easeInOutQuart:e=>(e/=.5)<1?.5*e*e*e*e:-.5*((e-=2)*e*e*e-2),easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>(e-=1)*e*e*e*e+1,easeInOutQuint:e=>(e/=.5)<1?.5*e*e*e*e*e:.5*((e-=2)*e*e*e*e+2),easeInSine:e=>-Math.cos(e*at)+1,easeOutSine:e=>Math.sin(e*at),easeInOutSine:e=>-.5*(Math.cos(U*e)-1),easeInExpo:e=>e===0?0:Math.pow(2,10*(e-1)),easeOutExpo:e=>e===1?1:-Math.pow(2,-10*e)+1,easeInOutExpo:e=>Ji(e)?e:e<.5?.5*Math.pow(2,10*(e*2-1)):.5*(-Math.pow(2,-10*(e*2-1))+2),easeInCirc:e=>e>=1?e:-(Math.sqrt(1-e*e)-1),easeOutCirc:e=>Math.sqrt(1-(e-=1)*e),easeInOutCirc:e=>(e/=.5)<1?-.5*(Math.sqrt(1-e*e)-1):.5*(Math.sqrt(1-(e-=2)*e)+1),easeInElastic:e=>Ji(e)?e:bl(e,.075,.3),easeOutElastic:e=>Ji(e)?e:yl(e,.075,.3),easeInOutElastic(e){return Ji(e)?e:e<.5?.5*bl(e*2,.1125,.45):.5+.5*yl(e*2-1,.1125,.45)},easeInBack(e){return e*e*((1.70158+1)*e-1.70158)},easeOutBack(e){return(e-=1)*e*((1.70158+1)*e+1.70158)+1},easeInOutBack(e){let t=1.70158;return(e/=.5)<1?.5*(e*e*(((t*=1.525)+1)*e-t)):.5*((e-=2)*e*(((t*=1.525)+1)*e+t)+2)},easeInBounce:e=>1-ci.easeOutBounce(1-e),easeOutBounce(e){return e<1/2.75?7.5625*e*e:e<2/2.75?7.5625*(e-=1.5/2.75)*e+.75:e<2.5/2.75?7.5625*(e-=2.25/2.75)*e+.9375:7.5625*(e-=2.625/2.75)*e+.984375},easeInOutBounce:e=>e<.5?ci.easeInBounce(e*2)*.5:ci.easeOutBounce(e*2-1)*.5+.5};function ea(e){if(e&&typeof e=="object"){const t=e.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function vl(e){return ea(e)?e:new bi(e)}function Ro(e){return ea(e)?e:new bi(e).saturate(.5).darken(.1).hexString()}const n0=["x","y","borderWidth","radius","tension"],i0=["color","borderColor","backgroundColor"];function s0(e){e.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),e.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),e.set("animations",{colors:{type:"color",properties:i0},numbers:{type:"number",properties:n0}}),e.describe("animations",{_fallback:"animation"}),e.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function o0(e){e.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const xl=new Map;function r0(e,t){t=t||{};const n=e+JSON.stringify(t);let i=xl.get(n);return i||(i=new Intl.NumberFormat(e,t),xl.set(n,i)),i}function Ri(e,t,n){return r0(t,n).format(e)}const su={values(e){return et(e)?e:""+e},numeric(e,t,n){if(e===0)return"0";const i=this.chart.options.locale;let s,o=e;if(n.length>1){const c=Math.max(Math.abs(n[0].value),Math.abs(n[n.length-1].value));(c<1e-4||c>1e15)&&(s="scientific"),o=a0(e,n)}const r=ke(Math.abs(o)),a=isNaN(r)?1:Math.max(Math.min(-1*Math.floor(r),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),Ri(e,i,l)},logarithmic(e,t,n){if(e===0)return"0";const i=n[t].significand||e/Math.pow(10,Math.floor(ke(e)));return[1,2,3,5,10,15].includes(i)||t>.8*n.length?su.numeric.call(this,e,t,n):""}};function a0(e,t){let n=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(n)>=1&&e!==Math.floor(e)&&(n=e-Math.floor(e)),n}var so={formatters:su};function l0(e){e.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,n)=>n.lineWidth,tickColor:(t,n)=>n.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:so.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),e.route("scale.ticks","color","","color"),e.route("scale.grid","color","","borderColor"),e.route("scale.border","color","","borderColor"),e.route("scale.title","color","","color"),e.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),e.describe("scales",{_fallback:"scale"}),e.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Ke=Object.create(null),gr=Object.create(null);function di(e,t){if(!t)return e;const n=t.split(".");for(let i=0,s=n.length;i<s;++i){const o=n[i];e=e[o]||(e[o]=Object.create(null))}return e}function Bo(e,t,n){return typeof t=="string"?yi(di(e,t),n):yi(di(e,""),t)}class c0{constructor(t,n){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Ro(s.backgroundColor),this.hoverBorderColor=(i,s)=>Ro(s.borderColor),this.hoverColor=(i,s)=>Ro(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(n)}set(t,n){return Bo(this,t,n)}get(t){return di(this,t)}describe(t,n){return Bo(gr,t,n)}override(t,n){return Bo(Ke,t,n)}route(t,n,i,s){const o=di(this,t),r=di(this,i),a="_"+n;Object.defineProperties(o,{[a]:{value:o[n],writable:!0},[n]:{enumerable:!0,get(){const l=this[a],c=r[s];return H(l)?Object.assign({},c,l):P(l,c)},set(l){this[a]=l}}})}apply(t){t.forEach(n=>n(this))}}var nt=new c0({_scriptable:e=>!e.startsWith("on"),_indexable:e=>e!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[s0,o0,l0]);function d0(e){return!e||N(e.size)||N(e.family)?null:(e.style?e.style+" ":"")+(e.weight?e.weight+" ":"")+e.size+"px "+e.family}function Gs(e,t,n,i,s){let o=t[s];return o||(o=t[s]=e.measureText(s).width,n.push(s)),o>i&&(i=o),i}function u0(e,t,n,i){i=i||{};let s=i.data=i.data||{},o=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},o=i.garbageCollect=[],i.font=t),e.save(),e.font=t;let r=0;const a=n.length;let l,c,d,u,h;for(l=0;l<a;l++)if(u=n[l],u!=null&&!et(u))r=Gs(e,s,o,r,u);else if(et(u))for(c=0,d=u.length;c<d;c++)h=u[c],h!=null&&!et(h)&&(r=Gs(e,s,o,r,h));e.restore();const f=o.length/2;if(f>n.length){for(l=0;l<f;l++)delete s[o[l]];o.splice(0,f)}return r}function He(e,t,n){const i=e.currentDevicePixelRatio,s=n!==0?Math.max(n/2,.5):0;return Math.round((t-s)*i)/i+s}function _l(e,t){!t&&!e||(t=t||e.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,e.width,e.height),t.restore())}function pr(e,t,n,i){ou(e,t,n,i,null)}function ou(e,t,n,i,s){let o,r,a,l,c,d,u,h;const f=t.pointStyle,g=t.rotation,p=t.radius;let m=(g||0)*Wb;if(f&&typeof f=="object"&&(o=f.toString(),o==="[object HTMLImageElement]"||o==="[object HTMLCanvasElement]")){e.save(),e.translate(n,i),e.rotate(m),e.drawImage(f,-f.width/2,-f.height/2,f.width,f.height),e.restore();return}if(!(isNaN(p)||p<=0)){switch(e.beginPath(),f){default:s?e.ellipse(n,i,s/2,p,0,0,Q):e.arc(n,i,p,0,Q),e.closePath();break;case"triangle":d=s?s/2:p,e.moveTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=fl,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),m+=fl,e.lineTo(n+Math.sin(m)*d,i-Math.cos(m)*p),e.closePath();break;case"rectRounded":c=p*.516,l=p-c,r=Math.cos(m+Fe)*l,u=Math.cos(m+Fe)*(s?s/2-c:l),a=Math.sin(m+Fe)*l,h=Math.sin(m+Fe)*(s?s/2-c:l),e.arc(n-u,i-a,c,m-U,m-at),e.arc(n+h,i-r,c,m-at,m),e.arc(n+u,i+a,c,m,m+at),e.arc(n-h,i+r,c,m+at,m+U),e.closePath();break;case"rect":if(!g){l=Math.SQRT1_2*p,d=s?s/2:l,e.rect(n-d,i-l,2*d,2*l);break}m+=Fe;case"rectRot":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+h,i-r),e.lineTo(n+u,i+a),e.lineTo(n-h,i+r),e.closePath();break;case"crossRot":m+=Fe;case"cross":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"star":u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r),m+=Fe,u=Math.cos(m)*(s?s/2:p),r=Math.cos(m)*p,a=Math.sin(m)*p,h=Math.sin(m)*(s?s/2:p),e.moveTo(n-u,i-a),e.lineTo(n+u,i+a),e.moveTo(n+h,i-r),e.lineTo(n-h,i+r);break;case"line":r=s?s/2:Math.cos(m)*p,a=Math.sin(m)*p,e.moveTo(n-r,i-a),e.lineTo(n+r,i+a);break;case"dash":e.moveTo(n,i),e.lineTo(n+Math.cos(m)*(s?s/2:p),i+Math.sin(m)*p);break;case!1:e.closePath();break}e.fill(),t.borderWidth>0&&e.stroke()}}function ae(e,t,n){return n=n||.5,!t||e&&e.x>t.left-n&&e.x<t.right+n&&e.y>t.top-n&&e.y<t.bottom+n}function oo(e,t){e.save(),e.beginPath(),e.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),e.clip()}function ro(e){e.restore()}function h0(e,t,n,i,s){if(!t)return e.lineTo(n.x,n.y);if(s==="middle"){const o=(t.x+n.x)/2;e.lineTo(o,t.y),e.lineTo(o,n.y)}else s==="after"!=!!i?e.lineTo(t.x,n.y):e.lineTo(n.x,t.y);e.lineTo(n.x,n.y)}function f0(e,t,n,i){if(!t)return e.lineTo(n.x,n.y);e.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?n.cp2x:n.cp1x,i?n.cp2y:n.cp1y,n.x,n.y)}function g0(e,t){t.translation&&e.translate(t.translation[0],t.translation[1]),N(t.rotation)||e.rotate(t.rotation),t.color&&(e.fillStyle=t.color),t.textAlign&&(e.textAlign=t.textAlign),t.textBaseline&&(e.textBaseline=t.textBaseline)}function p0(e,t,n,i,s){if(s.strikethrough||s.underline){const o=e.measureText(i),r=t-o.actualBoundingBoxLeft,a=t+o.actualBoundingBoxRight,l=n-o.actualBoundingBoxAscent,c=n+o.actualBoundingBoxDescent,d=s.strikethrough?(l+c)/2:c;e.strokeStyle=e.fillStyle,e.beginPath(),e.lineWidth=s.decorationWidth||2,e.moveTo(r,d),e.lineTo(a,d),e.stroke()}}function m0(e,t){const n=e.fillStyle;e.fillStyle=t.color,e.fillRect(t.left,t.top,t.width,t.height),e.fillStyle=n}function Je(e,t,n,i,s,o={}){const r=et(t)?t:[t],a=o.strokeWidth>0&&o.strokeColor!=="";let l,c;for(e.save(),e.font=s.string,g0(e,o),l=0;l<r.length;++l)c=r[l],o.backdrop&&m0(e,o.backdrop),a&&(o.strokeColor&&(e.strokeStyle=o.strokeColor),N(o.strokeWidth)||(e.lineWidth=o.strokeWidth),e.strokeText(c,n,i,o.maxWidth)),e.fillText(c,n,i,o.maxWidth),p0(e,n,i,c,o),i+=Number(s.lineHeight);e.restore()}function _i(e,t){const{x:n,y:i,w:s,h:o,radius:r}=t;e.arc(n+r.topLeft,i+r.topLeft,r.topLeft,1.5*U,U,!0),e.lineTo(n,i+o-r.bottomLeft),e.arc(n+r.bottomLeft,i+o-r.bottomLeft,r.bottomLeft,U,at,!0),e.lineTo(n+s-r.bottomRight,i+o),e.arc(n+s-r.bottomRight,i+o-r.bottomRight,r.bottomRight,at,0,!0),e.lineTo(n+s,i+r.topRight),e.arc(n+s-r.topRight,i+r.topRight,r.topRight,0,-at,!0),e.lineTo(n+r.topLeft,i)}const b0=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,y0=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function v0(e,t){const n=(""+e).match(b0);if(!n||n[1]==="normal")return t*1.2;switch(e=+n[2],n[3]){case"px":return e;case"%":e/=100;break}return t*e}const x0=e=>+e||0;function na(e,t){const n={},i=H(t),s=i?Object.keys(t):t,o=H(e)?i?r=>P(e[r],e[t[r]]):r=>e[r]:()=>e;for(const r of s)n[r]=x0(o(r));return n}function ru(e){return na(e,{top:"y",right:"x",bottom:"y",left:"x"})}function Ge(e){return na(e,["topLeft","topRight","bottomLeft","bottomRight"])}function wt(e){const t=ru(e);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function dt(e,t){e=e||{},t=t||nt.font;let n=P(e.size,t.size);typeof n=="string"&&(n=parseInt(n,10));let i=P(e.style,t.style);i&&!(""+i).match(y0)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:P(e.family,t.family),lineHeight:v0(P(e.lineHeight,t.lineHeight),n),size:n,style:i,weight:P(e.weight,t.weight),string:""};return s.string=d0(s),s}function Vn(e,t,n,i){let s,o,r;for(s=0,o=e.length;s<o;++s)if(r=e[s],r!==void 0&&r!==void 0)return r}function _0(e,t,n){const{min:i,max:s}=e,o=Gd(t,(s-i)/2),r=(a,l)=>n&&a===0?0:a+l;return{min:r(i,-Math.abs(o)),max:r(s,o)}}function Ae(e,t){return Object.assign(Object.create(e),t)}function ia(e,t=[""],n,i,s=()=>e[0]){const o=n||e;typeof i>"u"&&(i=du("_fallback",e));const r={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:e,_rootScopes:o,_fallback:i,_getTarget:s,override:a=>ia([a,...e],t,o,i)};return new Proxy(r,{deleteProperty(a,l){return delete a[l],delete a._keys,delete e[0][l],!0},get(a,l){return lu(a,l,()=>M0(l,t,e,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(e[0])},has(a,l){return kl(a).includes(l)},ownKeys(a){return kl(a)},set(a,l,c){const d=a._storage||(a._storage=s());return a[l]=d[l]=c,delete a._keys,!0}})}function xn(e,t,n,i){const s={_cacheable:!1,_proxy:e,_context:t,_subProxy:n,_stack:new Set,_descriptors:au(e,i),setContext:o=>xn(e,o,n,i),override:o=>xn(e.override(o),t,n,i)};return new Proxy(s,{deleteProperty(o,r){return delete o[r],delete e[r],!0},get(o,r,a){return lu(o,r,()=>k0(o,r,a))},getOwnPropertyDescriptor(o,r){return o._descriptors.allKeys?Reflect.has(e,r)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(e,r)},getPrototypeOf(){return Reflect.getPrototypeOf(e)},has(o,r){return Reflect.has(e,r)},ownKeys(){return Reflect.ownKeys(e)},set(o,r,a){return e[r]=a,delete o[r],!0}})}function au(e,t={scriptable:!0,indexable:!0}){const{_scriptable:n=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=e;return{allKeys:s,scriptable:n,indexable:i,isScriptable:Ce(n)?n:()=>n,isIndexable:Ce(i)?i:()=>i}}const w0=(e,t)=>e?e+Jr(t):t,sa=(e,t)=>H(t)&&e!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function lu(e,t,n){if(Object.prototype.hasOwnProperty.call(e,t)||t==="constructor")return e[t];const i=n();return e[t]=i,i}function k0(e,t,n){const{_proxy:i,_context:s,_subProxy:o,_descriptors:r}=e;let a=i[t];return Ce(a)&&r.isScriptable(t)&&(a=S0(t,a,e,n)),et(a)&&a.length&&(a=E0(t,a,e,r.isIndexable)),sa(t,a)&&(a=xn(a,s,o&&o[t],r)),a}function S0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_stack:a}=n;if(a.has(e))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+e);a.add(e);let l=t(o,r||i);return a.delete(e),sa(e,l)&&(l=oa(s._scopes,s,e,l)),l}function E0(e,t,n,i){const{_proxy:s,_context:o,_subProxy:r,_descriptors:a}=n;if(typeof o.index<"u"&&i(e))return t[o.index%t.length];if(H(t[0])){const l=t,c=s._scopes.filter(d=>d!==l);t=[];for(const d of l){const u=oa(c,s,e,d);t.push(xn(u,o,r&&r[e],a))}}return t}function cu(e,t,n){return Ce(e)?e(t,n):e}const I0=(e,t)=>e===!0?t:typeof e=="string"?Me(t,e):void 0;function D0(e,t,n,i,s){for(const o of t){const r=I0(n,o);if(r){e.add(r);const a=cu(r._fallback,n,s);if(typeof a<"u"&&a!==n&&a!==i)return a}else if(r===!1&&typeof i<"u"&&n!==i)return null}return!1}function oa(e,t,n,i){const s=t._rootScopes,o=cu(t._fallback,n,i),r=[...e,...s],a=new Set;a.add(i);let l=wl(a,r,n,o||n,i);return l===null||typeof o<"u"&&o!==n&&(l=wl(a,r,o,l,i),l===null)?!1:ia(Array.from(a),[""],s,o,()=>T0(t,n,i))}function wl(e,t,n,i,s){for(;n;)n=D0(e,t,n,i,s);return n}function T0(e,t,n){const i=e._getTarget();t in i||(i[t]={});const s=i[t];return et(s)&&H(n)?n:s||{}}function M0(e,t,n,i){let s;for(const o of t)if(s=du(w0(o,e),n),typeof s<"u")return sa(e,s)?oa(n,i,e,s):s}function du(e,t){for(const n of t){if(!n)continue;const i=n[e];if(typeof i<"u")return i}}function kl(e){let t=e._keys;return t||(t=e._keys=C0(e._scopes)),t}function C0(e){const t=new Set;for(const n of e)for(const i of Object.keys(n).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function uu(e,t,n,i){const{iScale:s}=e,{key:o="r"}=this._parsing,r=new Array(i);let a,l,c,d;for(a=0,l=i;a<l;++a)c=a+n,d=t[c],r[a]={r:s.parse(Me(d,o),c)};return r}const A0=Number.EPSILON||1e-14,_n=(e,t)=>t<e.length&&!e[t].skip&&e[t],hu=e=>e==="x"?"y":"x";function L0(e,t,n,i){const s=e.skip?t:e,o=t,r=n.skip?t:n,a=fr(o,s),l=fr(r,o);let c=a/(a+l),d=l/(a+l);c=isNaN(c)?0:c,d=isNaN(d)?0:d;const u=i*c,h=i*d;return{previous:{x:o.x-u*(r.x-s.x),y:o.y-u*(r.y-s.y)},next:{x:o.x+h*(r.x-s.x),y:o.y+h*(r.y-s.y)}}}function O0(e,t,n){const i=e.length;let s,o,r,a,l,c=_n(e,0);for(let d=0;d<i-1;++d)if(l=c,c=_n(e,d+1),!(!l||!c)){if(li(t[d],0,A0)){n[d]=n[d+1]=0;continue}s=n[d]/t[d],o=n[d+1]/t[d],a=Math.pow(s,2)+Math.pow(o,2),!(a<=9)&&(r=3/Math.sqrt(a),n[d]=s*r*t[d],n[d+1]=o*r*t[d])}}function P0(e,t,n="x"){const i=hu(n),s=e.length;let o,r,a,l=_n(e,0);for(let c=0;c<s;++c){if(r=a,a=l,l=_n(e,c+1),!a)continue;const d=a[n],u=a[i];r&&(o=(d-r[n])/3,a[`cp1${n}`]=d-o,a[`cp1${i}`]=u-o*t[c]),l&&(o=(l[n]-d)/3,a[`cp2${n}`]=d+o,a[`cp2${i}`]=u+o*t[c])}}function R0(e,t="x"){const n=hu(t),i=e.length,s=Array(i).fill(0),o=Array(i);let r,a,l,c=_n(e,0);for(r=0;r<i;++r)if(a=l,l=c,c=_n(e,r+1),!!l){if(c){const d=c[t]-l[t];s[r]=d!==0?(c[n]-l[n])/d:0}o[r]=a?c?Xt(s[r-1])!==Xt(s[r])?0:(s[r-1]+s[r])/2:s[r-1]:s[r]}O0(e,s,o),P0(e,o,t)}function Zi(e,t,n){return Math.max(Math.min(e,n),t)}function B0(e,t){let n,i,s,o,r,a=ae(e[0],t);for(n=0,i=e.length;n<i;++n)r=o,o=a,a=n<i-1&&ae(e[n+1],t),o&&(s=e[n],r&&(s.cp1x=Zi(s.cp1x,t.left,t.right),s.cp1y=Zi(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=Zi(s.cp2x,t.left,t.right),s.cp2y=Zi(s.cp2y,t.top,t.bottom)))}function N0(e,t,n,i,s){let o,r,a,l;if(t.spanGaps&&(e=e.filter(c=>!c.skip)),t.cubicInterpolationMode==="monotone")R0(e,s);else{let c=i?e[e.length-1]:e[0];for(o=0,r=e.length;o<r;++o)a=e[o],l=L0(c,a,e[Math.min(o+1,r-(i?0:1))%r],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,c=a}t.capBezierPoints&&B0(e,n)}function ra(){return typeof window<"u"&&typeof document<"u"}function aa(e){let t=e.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function Xs(e,t,n){let i;return typeof e=="string"?(i=parseInt(e,10),e.indexOf("%")!==-1&&(i=i/100*t.parentNode[n])):i=e,i}const ao=e=>e.ownerDocument.defaultView.getComputedStyle(e,null);function F0(e,t){return ao(e).getPropertyValue(t)}const H0=["top","right","bottom","left"];function Xe(e,t,n){const i={};n=n?"-"+n:"";for(let s=0;s<4;s++){const o=H0[s];i[o]=parseFloat(e[t+"-"+o+n])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const $0=(e,t,n)=>(e>0||t>0)&&(!n||!n.shadowRoot);function z0(e,t){const n=e.touches,i=n&&n.length?n[0]:e,{offsetX:s,offsetY:o}=i;let r=!1,a,l;if($0(s,o,e.target))a=s,l=o;else{const c=t.getBoundingClientRect();a=i.clientX-c.left,l=i.clientY-c.top,r=!0}return{x:a,y:l,box:r}}function Ve(e,t){if("native"in e)return e;const{canvas:n,currentDevicePixelRatio:i}=t,s=ao(n),o=s.boxSizing==="border-box",r=Xe(s,"padding"),a=Xe(s,"border","width"),{x:l,y:c,box:d}=z0(e,n),u=r.left+(d&&a.left),h=r.top+(d&&a.top);let{width:f,height:g}=t;return o&&(f-=r.width+a.width,g-=r.height+a.height),{x:Math.round((l-u)/f*n.width/i),y:Math.round((c-h)/g*n.height/i)}}function j0(e,t,n){let i,s;if(t===void 0||n===void 0){const o=e&&aa(e);if(!o)t=e.clientWidth,n=e.clientHeight;else{const r=o.getBoundingClientRect(),a=ao(o),l=Xe(a,"border","width"),c=Xe(a,"padding");t=r.width-c.width-l.width,n=r.height-c.height-l.height,i=Xs(a.maxWidth,o,"clientWidth"),s=Xs(a.maxHeight,o,"clientHeight")}}return{width:t,height:n,maxWidth:i||qs,maxHeight:s||qs}}const Se=e=>Math.round(e*10)/10;function V0(e,t,n,i){const s=ao(e),o=Xe(s,"margin"),r=Xs(s.maxWidth,e,"clientWidth")||qs,a=Xs(s.maxHeight,e,"clientHeight")||qs,l=j0(e,t,n);let{width:c,height:d}=l;if(s.boxSizing==="content-box"){const h=Xe(s,"border","width"),f=Xe(s,"padding");c-=f.width+h.width,d-=f.height+h.height}return c=Math.max(0,c-o.width),d=Math.max(0,i?c/i:d-o.height),c=Se(Math.min(c,r,l.maxWidth)),d=Se(Math.min(d,a,l.maxHeight)),c&&!d&&(d=Se(c/2)),(t!==void 0||n!==void 0)&&i&&l.height&&d>l.height&&(d=l.height,c=Se(Math.floor(d*i))),{width:c,height:d}}function Sl(e,t,n){const i=t||1,s=Se(e.height*i),o=Se(e.width*i);e.height=Se(e.height),e.width=Se(e.width);const r=e.canvas;return r.style&&(n||!r.style.height&&!r.style.width)&&(r.style.height=`${e.height}px`,r.style.width=`${e.width}px`),e.currentDevicePixelRatio!==i||r.height!==s||r.width!==o?(e.currentDevicePixelRatio=i,r.height=s,r.width=o,e.ctx.setTransform(i,0,0,i,0,0),!0):!1}const U0=(function(){let e=!1;try{const t={get passive(){return e=!0,!1}};ra()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return e})();function El(e,t){const n=F0(e,t),i=n&&n.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Ue(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:e.y+n*(t.y-e.y)}}function W0(e,t,n,i){return{x:e.x+n*(t.x-e.x),y:i==="middle"?n<.5?e.y:t.y:i==="after"?n<1?e.y:t.y:n>0?t.y:e.y}}function Y0(e,t,n,i){const s={x:e.cp2x,y:e.cp2y},o={x:t.cp1x,y:t.cp1y},r=Ue(e,s,n),a=Ue(s,o,n),l=Ue(o,t,n),c=Ue(r,a,n),d=Ue(a,l,n);return Ue(c,d,n)}const q0=function(e,t){return{x(n){return e+e+t-n},setWidth(n){t=n},textAlign(n){return n==="center"?n:n==="right"?"left":"right"},xPlus(n,i){return n-i},leftForLtr(n,i){return n-i}}},G0=function(){return{x(e){return e},setWidth(e){},textAlign(e){return e},xPlus(e,t){return e+t},leftForLtr(e,t){return e}}};function pn(e,t,n){return e?q0(t,n):G0()}function fu(e,t){let n,i;(t==="ltr"||t==="rtl")&&(n=e.canvas.style,i=[n.getPropertyValue("direction"),n.getPropertyPriority("direction")],n.setProperty("direction",t,"important"),e.prevTextDirection=i)}function gu(e,t){t!==void 0&&(delete e.prevTextDirection,e.canvas.style.setProperty("direction",t[0],t[1]))}function pu(e){return e==="angle"?{between:xi,compare:Xb,normalize:xt}:{between:oe,compare:(t,n)=>t-n,normalize:t=>t}}function Il({start:e,end:t,count:n,loop:i,style:s}){return{start:e%n,end:t%n,loop:i&&(t-e+1)%n===0,style:s}}function X0(e,t,n){const{property:i,start:s,end:o}=n,{between:r,normalize:a}=pu(i),l=t.length;let{start:c,end:d,loop:u}=e,h,f;if(u){for(c+=l,d+=l,h=0,f=l;h<f&&r(a(t[c%l][i]),s,o);++h)c--,d--;c%=l,d%=l}return d<c&&(d+=l),{start:c,end:d,loop:u,style:e.style}}function mu(e,t,n){if(!n)return[e];const{property:i,start:s,end:o}=n,r=t.length,{compare:a,between:l,normalize:c}=pu(i),{start:d,end:u,loop:h,style:f}=X0(e,t,n),g=[];let p=!1,m=null,b,y,x;const _=()=>l(s,x,b)&&a(s,x)!==0,v=()=>a(o,b)===0||l(o,x,b),w=()=>p||_(),k=()=>!p||v();for(let S=d,D=d;S<=u;++S)y=t[S%r],!y.skip&&(b=c(y[i]),b!==x&&(p=l(b,s,o),m===null&&w()&&(m=a(b,s)===0?S:D),m!==null&&k()&&(g.push(Il({start:m,end:S,loop:h,count:r,style:f})),m=null),D=S,x=b));return m!==null&&g.push(Il({start:m,end:u,loop:h,count:r,style:f})),g}function bu(e,t){const n=[],i=e.segments;for(let s=0;s<i.length;s++){const o=mu(i[s],e.points,t);o.length&&n.push(...o)}return n}function K0(e,t,n,i){let s=0,o=t-1;if(n&&!i)for(;s<t&&!e[s].skip;)s++;for(;s<t&&e[s].skip;)s++;for(s%=t,n&&(o+=s);o>s&&e[o%t].skip;)o--;return o%=t,{start:s,end:o}}function J0(e,t,n,i){const s=e.length,o=[];let r=t,a=e[t],l;for(l=t+1;l<=n;++l){const c=e[l%s];c.skip||c.stop?a.skip||(i=!1,o.push({start:t%s,end:(l-1)%s,loop:i}),t=r=c.stop?l:null):(r=l,a.skip&&(t=l)),a=c}return r!==null&&o.push({start:t%s,end:r%s,loop:i}),o}function Z0(e,t){const n=e.points,i=e.options.spanGaps,s=n.length;if(!s)return[];const o=!!e._loop,{start:r,end:a}=K0(n,s,o,i);if(i===!0)return Dl(e,[{start:r,end:a,loop:o}],n,t);const l=a<r?a+s:a,c=!!e._fullLoop&&r===0&&a===s-1;return Dl(e,J0(n,r,l,c),n,t)}function Dl(e,t,n,i){return!i||!i.setContext||!n?t:Q0(e,t,n,i)}function Q0(e,t,n,i){const s=e._chart.getContext(),o=Tl(e.options),{_datasetIndex:r,options:{spanGaps:a}}=e,l=n.length,c=[];let d=o,u=t[0].start,h=u;function f(g,p,m,b){const y=a?-1:1;if(g!==p){for(g+=l;n[g%l].skip;)g-=y;for(;n[p%l].skip;)p+=y;g%l!==p%l&&(c.push({start:g%l,end:p%l,loop:m,style:b}),d=b,u=p%l)}}for(const g of t){u=a?u:g.start;let p=n[u%l],m;for(h=u+1;h<=g.end;h++){const b=n[h%l];m=Tl(i.setContext(Ae(s,{type:"segment",p0:p,p1:b,p0DataIndex:(h-1)%l,p1DataIndex:h%l,datasetIndex:r}))),ty(m,d)&&f(u,h-1,g.loop,d),p=b,d=m}u<h-1&&f(u,h-1,g.loop,d)}return c}function Tl(e){return{backgroundColor:e.backgroundColor,borderCapStyle:e.borderCapStyle,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderJoinStyle:e.borderJoinStyle,borderWidth:e.borderWidth,borderColor:e.borderColor}}function ty(e,t){if(!t)return!1;const n=[],i=function(s,o){return ea(o)?(n.includes(o)||n.push(o),n.indexOf(o)):o};return JSON.stringify(e,i)!==JSON.stringify(t,i)}function Qi(e,t,n){return e.options.clip?e[n]:t[n]}function ey(e,t){const{xScale:n,yScale:i}=e;return n&&i?{left:Qi(n,t,"left"),right:Qi(n,t,"right"),top:Qi(i,t,"top"),bottom:Qi(i,t,"bottom")}:t}function yu(e,t){const n=t._clip;if(n.disabled)return!1;const i=ey(t,e.chartArea);return{left:n.left===!1?0:i.left-(n.left===!0?0:n.left),right:n.right===!1?e.width:i.right+(n.right===!0?0:n.right),top:n.top===!1?0:i.top-(n.top===!0?0:n.top),bottom:n.bottom===!1?e.height:i.bottom+(n.bottom===!0?0:n.bottom)}}/*!
 * Chart.js v4.5.1
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class ny{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,n,i,s){const o=n.listeners[s],r=n.duration;o.forEach(a=>a({chart:t,initial:n.initial,numSteps:r,currentStep:Math.min(i-n.start,r)}))}_refresh(){this._request||(this._running=!0,this._request=tu.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let n=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const o=i.items;let r=o.length-1,a=!1,l;for(;r>=0;--r)l=o[r],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(o[r]=o[o.length-1],o.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),o.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),n+=o.length}),this._lastDate=t,n===0&&(this._running=!1)}_getAnims(t){const n=this._charts;let i=n.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},n.set(t,i)),i}listen(t,n,i){this._getAnims(t).listeners[n].push(i)}add(t,n){!n||!n.length||this._getAnims(t).items.push(...n)}has(t){return this._getAnims(t).items.length>0}start(t){const n=this._charts.get(t);n&&(n.running=!0,n.start=Date.now(),n.duration=n.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const n=this._charts.get(t);return!(!n||!n.running||!n.items.length)}stop(t){const n=this._charts.get(t);if(!n||!n.items.length)return;const i=n.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();n.items=[],this._notify(t,n,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var te=new ny;const Ml="transparent",iy={boolean(e,t,n){return n>.5?t:e},color(e,t,n){const i=vl(e||Ml),s=i.valid&&vl(t||Ml);return s&&s.valid?s.mix(i,n).hexString():t},number(e,t,n){return e+(t-e)*n}};class sy{constructor(t,n,i,s){const o=n[i];s=Vn([t.to,s,o,t.from]);const r=Vn([t.from,o,s]);this._active=!0,this._fn=t.fn||iy[t.type||typeof r],this._easing=ci[t.easing]||ci.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=n,this._prop=i,this._from=r,this._to=s,this._promises=void 0}active(){return this._active}update(t,n,i){if(this._active){this._notify(!1);const s=this._target[this._prop],o=i-this._start,r=this._duration-o;this._start=i,this._duration=Math.floor(Math.max(r,t.duration)),this._total+=o,this._loop=!!t.loop,this._to=Vn([t.to,n,s,t.from]),this._from=Vn([t.from,s,n])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const n=t-this._start,i=this._duration,s=this._prop,o=this._from,r=this._loop,a=this._to;let l;if(this._active=o!==a&&(r||n<i),!this._active){this._target[s]=a,this._notify(!0);return}if(n<0){this._target[s]=o;return}l=n/i%2,l=r&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(o,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((n,i)=>{t.push({res:n,rej:i})})}_notify(t){const n=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][n]()}}class vu{constructor(t,n){this._chart=t,this._properties=new Map,this.configure(n)}configure(t){if(!H(t))return;const n=Object.keys(nt.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const o=t[s];if(!H(o))return;const r={};for(const a of n)r[a]=o[a];(et(o.properties)&&o.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,r)})})}_animateOptions(t,n){const i=n.options,s=ry(t,i);if(!s)return[];const o=this._createAnimations(s,i);return i.$shared&&oy(t.options.$animations,i).then(()=>{t.options=i},()=>{}),o}_createAnimations(t,n){const i=this._properties,s=[],o=t.$animations||(t.$animations={}),r=Object.keys(n),a=Date.now();let l;for(l=r.length-1;l>=0;--l){const c=r[l];if(c.charAt(0)==="$")continue;if(c==="options"){s.push(...this._animateOptions(t,n));continue}const d=n[c];let u=o[c];const h=i.get(c);if(u)if(h&&u.active()){u.update(h,d,a);continue}else u.cancel();if(!h||!h.duration){t[c]=d;continue}o[c]=u=new sy(h,t,c,d),s.push(u)}return s}update(t,n){if(this._properties.size===0){Object.assign(t,n);return}const i=this._createAnimations(t,n);if(i.length)return te.add(this._chart,i),!0}}function oy(e,t){const n=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const o=e[i[s]];o&&o.active()&&n.push(o.wait())}return Promise.all(n)}function ry(e,t){if(!t)return;let n=e.options;if(!n){e.options=t;return}return n.$shared&&(e.options=n=Object.assign({},n,{$shared:!1,$animations:{}})),n}function Cl(e,t){const n=e&&e.options||{},i=n.reverse,s=n.min===void 0?t:0,o=n.max===void 0?t:0;return{start:i?o:s,end:i?s:o}}function ay(e,t,n){if(n===!1)return!1;const i=Cl(e,n),s=Cl(t,n);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function ly(e){let t,n,i,s;return H(e)?(t=e.top,n=e.right,i=e.bottom,s=e.left):t=n=i=s=e,{top:t,right:n,bottom:i,left:s,disabled:e===!1}}function xu(e,t){const n=[],i=e._getSortedDatasetMetas(t);let s,o;for(s=0,o=i.length;s<o;++s)n.push(i[s].index);return n}function Al(e,t,n,i={}){const s=e.keys,o=i.mode==="single";let r,a,l,c;if(t===null)return;let d=!1;for(r=0,a=s.length;r<a;++r){if(l=+s[r],l===n){if(d=!0,i.all)continue;break}c=e.values[l],ot(c)&&(o||t===0||Xt(t)===Xt(c))&&(t+=c)}return!d&&!i.all?0:t}function cy(e,t){const{iScale:n,vScale:i}=t,s=n.axis==="x"?"x":"y",o=i.axis==="x"?"x":"y",r=Object.keys(e),a=new Array(r.length);let l,c,d;for(l=0,c=r.length;l<c;++l)d=r[l],a[l]={[s]:d,[o]:e[d]};return a}function No(e,t){const n=e&&e.options.stacked;return n||n===void 0&&t.stack!==void 0}function dy(e,t,n){return`${e.id}.${t.id}.${n.stack||n.type}`}function uy(e){const{min:t,max:n,minDefined:i,maxDefined:s}=e.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?n:Number.POSITIVE_INFINITY}}function hy(e,t,n){const i=e[t]||(e[t]={});return i[n]||(i[n]={})}function Ll(e,t,n,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const o=e[s.index];if(n&&o>0||!n&&o<0)return s.index}return null}function Ol(e,t){const{chart:n,_cachedMeta:i}=e,s=n._stacks||(n._stacks={}),{iScale:o,vScale:r,index:a}=i,l=o.axis,c=r.axis,d=dy(o,r,i),u=t.length;let h;for(let f=0;f<u;++f){const g=t[f],{[l]:p,[c]:m}=g,b=g._stacks||(g._stacks={});h=b[c]=hy(s,d,p),h[a]=m,h._top=Ll(h,r,!0,i.type),h._bottom=Ll(h,r,!1,i.type);const y=h._visualValues||(h._visualValues={});y[a]=m}}function Fo(e,t){const n=e.scales;return Object.keys(n).filter(i=>n[i].axis===t).shift()}function fy(e,t){return Ae(e,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function gy(e,t,n){return Ae(e,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:n,index:t,mode:"default",type:"data"})}function An(e,t){const n=e.controller.index,i=e.vScale&&e.vScale.axis;if(i){t=t||e._parsed;for(const s of t){const o=s._stacks;if(!o||o[i]===void 0||o[i][n]===void 0)return;delete o[i][n],o[i]._visualValues!==void 0&&o[i]._visualValues[n]!==void 0&&delete o[i]._visualValues[n]}}}const Ho=e=>e==="reset"||e==="none",Pl=(e,t)=>t?e:Object.assign({},e),py=(e,t,n)=>e&&!t.hidden&&t._stacked&&{keys:xu(n,!0),values:null};class Vt{constructor(t,n){this.chart=t,this._ctx=t.ctx,this.index=n,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=No(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&An(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,n=this._cachedMeta,i=this.getDataset(),s=(u,h,f,g)=>u==="x"?h:u==="r"?g:f,o=n.xAxisID=P(i.xAxisID,Fo(t,"x")),r=n.yAxisID=P(i.yAxisID,Fo(t,"y")),a=n.rAxisID=P(i.rAxisID,Fo(t,"r")),l=n.indexAxis,c=n.iAxisID=s(l,o,r,a),d=n.vAxisID=s(l,r,o,a);n.xScale=this.getScaleForId(o),n.yScale=this.getScaleForId(r),n.rScale=this.getScaleForId(a),n.iScale=this.getScaleForId(c),n.vScale=this.getScaleForId(d)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const n=this._cachedMeta;return t===n.iScale?n.vScale:n.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&ml(this._data,this),t._stacked&&An(t)}_dataCheck(){const t=this.getDataset(),n=t.data||(t.data=[]),i=this._data;if(H(n)){const s=this._cachedMeta;this._data=cy(n,s)}else if(i!==n){if(i){ml(i,this);const s=this._cachedMeta;An(s),s._parsed=[]}n&&Object.isExtensible(n)&&Qb(n,this),this._syncList=[],this._data=n}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const n=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const o=n._stacked;n._stacked=No(n.vScale,n),n.stack!==i.stack&&(s=!0,An(n),n.stack=i.stack),this._resyncElements(t),(s||o!==n._stacked)&&(Ol(this,n._parsed),n._stacked=No(n.vScale,n))}configure(){const t=this.chart.config,n=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),n,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,n){const{_cachedMeta:i,_data:s}=this,{iScale:o,_stacked:r}=i,a=o.axis;let l=t===0&&n===s.length?!0:i._sorted,c=t>0&&i._parsed[t-1],d,u,h;if(this._parsing===!1)i._parsed=s,i._sorted=!0,h=s;else{et(s[t])?h=this.parseArrayData(i,s,t,n):H(s[t])?h=this.parseObjectData(i,s,t,n):h=this.parsePrimitiveData(i,s,t,n);const f=()=>u[a]===null||c&&u[a]<c[a];for(d=0;d<n;++d)i._parsed[d+t]=u=h[d],l&&(f()&&(l=!1),c=u);i._sorted=l}r&&Ol(this,h)}parsePrimitiveData(t,n,i,s){const{iScale:o,vScale:r}=t,a=o.axis,l=r.axis,c=o.getLabels(),d=o===r,u=new Array(s);let h,f,g;for(h=0,f=s;h<f;++h)g=h+i,u[h]={[a]:d||o.parse(c[g],g),[l]:r.parse(n[g],g)};return u}parseArrayData(t,n,i,s){const{xScale:o,yScale:r}=t,a=new Array(s);let l,c,d,u;for(l=0,c=s;l<c;++l)d=l+i,u=n[d],a[l]={x:o.parse(u[0],d),y:r.parse(u[1],d)};return a}parseObjectData(t,n,i,s){const{xScale:o,yScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=new Array(s);let d,u,h,f;for(d=0,u=s;d<u;++d)h=d+i,f=n[h],c[d]={x:o.parse(Me(f,a),h),y:r.parse(Me(f,l),h)};return c}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,n,i){const s=this.chart,o=this._cachedMeta,r=n[t.axis],a={keys:xu(s,!0),values:n._stacks[t.axis]._visualValues};return Al(a,r,o.index,{mode:i})}updateRangeFromParsed(t,n,i,s){const o=i[n.axis];let r=o===null?NaN:o;const a=s&&i._stacks[n.axis];s&&a&&(s.values=a,r=Al(s,o,this._cachedMeta.index)),t.min=Math.min(t.min,r),t.max=Math.max(t.max,r)}getMinMax(t,n){const i=this._cachedMeta,s=i._parsed,o=i._sorted&&t===i.iScale,r=s.length,a=this._getOtherScale(t),l=py(n,i,this.chart),c={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:d,max:u}=uy(a);let h,f;function g(){f=s[h];const p=f[a.axis];return!ot(f[t.axis])||d>p||u<p}for(h=0;h<r&&!(!g()&&(this.updateRangeFromParsed(c,t,f,l),o));++h);if(o){for(h=r-1;h>=0;--h)if(!g()){this.updateRangeFromParsed(c,t,f,l);break}}return c}getAllParsedValues(t){const n=this._cachedMeta._parsed,i=[];let s,o,r;for(s=0,o=n.length;s<o;++s)r=n[s][t.axis],ot(r)&&i.push(r);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const n=this._cachedMeta,i=n.iScale,s=n.vScale,o=this.getParsed(t);return{label:i?""+i.getLabelForValue(o[i.axis]):"",value:s?""+s.getLabelForValue(o[s.axis]):""}}_update(t){const n=this._cachedMeta;this.update(t||"default"),n._clip=ly(P(this.options.clip,ay(n.xScale,n.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,n=this.chart,i=this._cachedMeta,s=i.data||[],o=n.chartArea,r=[],a=this._drawStart||0,l=this._drawCount||s.length-a,c=this.options.drawActiveElementsOnTop;let d;for(i.dataset&&i.dataset.draw(t,o,a,l),d=a;d<a+l;++d){const u=s[d];u.hidden||(u.active&&c?r.push(u):u.draw(t,o))}for(d=0;d<r.length;++d)r[d].draw(t,o)}getStyle(t,n){const i=n?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,n,i){const s=this.getDataset();let o;if(t>=0&&t<this._cachedMeta.data.length){const r=this._cachedMeta.data[t];o=r.$context||(r.$context=gy(this.getContext(),t,r)),o.parsed=this.getParsed(t),o.raw=s.data[t],o.index=o.dataIndex=t}else o=this.$context||(this.$context=fy(this.chart.getContext(),this.index)),o.dataset=s,o.index=o.datasetIndex=this.index;return o.active=!!n,o.mode=i,o}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,n){return this._resolveElementOptions(this.dataElementType.id,n,t)}_resolveElementOptions(t,n="default",i){const s=n==="active",o=this._cachedDataOpts,r=t+"-"+n,a=o[r],l=this.enableOptionSharing&&vi(i);if(a)return Pl(a,l);const c=this.chart.config,d=c.datasetElementScopeKeys(this._type,t),u=s?[`${t}Hover`,"hover",t,""]:[t,""],h=c.getOptionScopes(this.getDataset(),d),f=Object.keys(nt.elements[t]),g=()=>this.getContext(i,s,n),p=c.resolveNamedOptions(h,f,g,u);return p.$shared&&(p.$shared=l,o[r]=Object.freeze(Pl(p,l))),p}_resolveAnimations(t,n,i){const s=this.chart,o=this._cachedDataOpts,r=`animation-${n}`,a=o[r];if(a)return a;let l;if(s.options.animation!==!1){const d=this.chart.config,u=d.datasetAnimationScopeKeys(this._type,n),h=d.getOptionScopes(this.getDataset(),u);l=d.createResolver(h,this.getContext(t,i,n))}const c=new vu(s,l&&l.animations);return l&&l._cacheable&&(o[r]=Object.freeze(c)),c}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,n){return!n||Ho(t)||this.chart._animationsDisabled}_getSharedOptions(t,n){const i=this.resolveDataElementOptions(t,n),s=this._sharedOptions,o=this.getSharedOptions(i),r=this.includeOptions(n,o)||o!==s;return this.updateSharedOptions(o,n,i),{sharedOptions:o,includeOptions:r}}updateElement(t,n,i,s){Ho(s)?Object.assign(t,i):this._resolveAnimations(n,s).update(t,i)}updateSharedOptions(t,n,i){t&&!Ho(n)&&this._resolveAnimations(void 0,n).update(t,i)}_setStyle(t,n,i,s){t.active=s;const o=this.getStyle(n,s);this._resolveAnimations(n,i,s).update(t,{options:!s&&this.getSharedOptions(o)||o})}removeHoverStyle(t,n,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,n,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const n=this._data,i=this._cachedMeta.data;for(const[a,l,c]of this._syncList)this[a](l,c);this._syncList=[];const s=i.length,o=n.length,r=Math.min(o,s);r&&this.parse(0,r),o>s?this._insertElements(s,o-s,t):o<s&&this._removeElements(o,s-o)}_insertElements(t,n,i=!0){const s=this._cachedMeta,o=s.data,r=t+n;let a;const l=c=>{for(c.length+=n,a=c.length-1;a>=r;a--)c[a]=c[a-n]};for(l(o),a=t;a<r;++a)o[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,n),i&&this.updateElements(o,t,n,"reset")}updateElements(t,n,i,s){}_removeElements(t,n){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,n);i._stacked&&An(i,s)}i.data.splice(t,n)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[n,i,s]=t;this[n](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,n){n&&this._sync(["_removeElements",t,n]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}I(Vt,"defaults",{}),I(Vt,"datasetElementType",null),I(Vt,"dataElementType",null);function my(e,t){if(!e._cache.$bar){const n=e.getMatchingVisibleMetas(t);let i=[];for(let s=0,o=n.length;s<o;s++)i=i.concat(n[s].controller.getAllParsedValues(e));e._cache.$bar=Qd(i.sort((s,o)=>s-o))}return e._cache.$bar}function by(e){const t=e.iScale,n=my(t,e.type);let i=t._length,s,o,r,a;const l=()=>{r===32767||r===-32768||(vi(a)&&(i=Math.min(i,Math.abs(r-a)||i)),a=r)};for(s=0,o=n.length;s<o;++s)r=t.getPixelForValue(n[s]),l();for(a=void 0,s=0,o=t.ticks.length;s<o;++s)r=t.getPixelForTick(s),l();return i}function yy(e,t,n,i){const s=n.barThickness;let o,r;return N(s)?(o=t.min*n.categoryPercentage,r=n.barPercentage):(o=s*i,r=1),{chunk:o/i,ratio:r,start:t.pixels[e]-o/2}}function vy(e,t,n,i){const s=t.pixels,o=s[e];let r=e>0?s[e-1]:null,a=e<s.length-1?s[e+1]:null;const l=n.categoryPercentage;r===null&&(r=o-(a===null?t.end-t.start:a-o)),a===null&&(a=o+o-r);const c=o-(o-Math.min(r,a))/2*l;return{chunk:Math.abs(a-r)/2*l/i,ratio:n.barPercentage,start:c}}function xy(e,t,n,i){const s=n.parse(e[0],i),o=n.parse(e[1],i),r=Math.min(s,o),a=Math.max(s,o);let l=r,c=a;Math.abs(r)>Math.abs(a)&&(l=a,c=r),t[n.axis]=c,t._custom={barStart:l,barEnd:c,start:s,end:o,min:r,max:a}}function _u(e,t,n,i){return et(e)?xy(e,t,n,i):t[n.axis]=n.parse(e,i),t}function Rl(e,t,n,i){const s=e.iScale,o=e.vScale,r=s.getLabels(),a=s===o,l=[];let c,d,u,h;for(c=n,d=n+i;c<d;++c)h=t[c],u={},u[s.axis]=a||s.parse(r[c],c),l.push(_u(h,u,o,c));return l}function $o(e){return e&&e.barStart!==void 0&&e.barEnd!==void 0}function _y(e,t,n){return e!==0?Xt(e):(t.isHorizontal()?1:-1)*(t.min>=n?1:-1)}function wy(e){let t,n,i,s,o;return e.horizontal?(t=e.base>e.x,n="left",i="right"):(t=e.base<e.y,n="bottom",i="top"),t?(s="end",o="start"):(s="start",o="end"),{start:n,end:i,reverse:t,top:s,bottom:o}}function ky(e,t,n,i){let s=t.borderSkipped;const o={};if(!s){e.borderSkipped=o;return}if(s===!0){e.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:r,end:a,reverse:l,top:c,bottom:d}=wy(e);s==="middle"&&n&&(e.enableBorderRadius=!0,(n._top||0)===i?s=c:(n._bottom||0)===i?s=d:(o[Bl(d,r,a,l)]=!0,s=c)),o[Bl(s,r,a,l)]=!0,e.borderSkipped=o}function Bl(e,t,n,i){return i?(e=Sy(e,t,n),e=Nl(e,n,t)):e=Nl(e,t,n),e}function Sy(e,t,n){return e===t?n:e===n?t:e}function Nl(e,t,n){return e==="start"?t:e==="end"?n:e}function Ey(e,{inflateAmount:t},n){e.inflateAmount=t==="auto"?n===1?.33:0:t}class xs extends Vt{parsePrimitiveData(t,n,i,s){return Rl(t,n,i,s)}parseArrayData(t,n,i,s){return Rl(t,n,i,s)}parseObjectData(t,n,i,s){const{iScale:o,vScale:r}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,c=o.axis==="x"?a:l,d=r.axis==="x"?a:l,u=[];let h,f,g,p;for(h=i,f=i+s;h<f;++h)p=n[h],g={},g[o.axis]=o.parse(Me(p,c),h),u.push(_u(Me(p,d),g,r,h));return u}updateRangeFromParsed(t,n,i,s){super.updateRangeFromParsed(t,n,i,s);const o=i._custom;o&&n===this._cachedMeta.vScale&&(t.min=Math.min(t.min,o.min),t.max=Math.max(t.max,o.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const n=this._cachedMeta,{iScale:i,vScale:s}=n,o=this.getParsed(t),r=o._custom,a=$o(r)?"["+r.start+", "+r.end+"]":""+s.getLabelForValue(o[s.axis]);return{label:""+i.getLabelForValue(o[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const n=this._cachedMeta;this.updateElements(n.data,0,n.data.length,t)}updateElements(t,n,i,s){const o=s==="reset",{index:r,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),c=a.isHorizontal(),d=this._getRuler(),{sharedOptions:u,includeOptions:h}=this._getSharedOptions(n,s);for(let f=n;f<n+i;f++){const g=this.getParsed(f),p=o||N(g[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(f),m=this._calculateBarIndexPixels(f,d),b=(g._stacks||{})[a.axis],y={horizontal:c,base:p.base,enableBorderRadius:!b||$o(g._custom)||r===b._top||r===b._bottom,x:c?p.head:m.center,y:c?m.center:p.head,height:c?m.size:Math.abs(p.size),width:c?Math.abs(p.size):m.size};h&&(y.options=u||this.resolveDataElementOptions(f,t[f].active?"active":s));const x=y.options||t[f].options;ky(y,x,b,r),Ey(y,x,d.ratio),this.updateElement(t[f],f,y,s)}}_getStacks(t,n){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(d=>d.controller.options.grouped),o=i.options.stacked,r=[],a=this._cachedMeta.controller.getParsed(n),l=a&&a[i.axis],c=d=>{const u=d._parsed.find(f=>f[i.axis]===l),h=u&&u[d.vScale.axis];if(N(h)||isNaN(h))return!0};for(const d of s)if(!(n!==void 0&&c(d))&&((o===!1||r.indexOf(d.stack)===-1||o===void 0&&d.stack===void 0)&&r.push(d.stack),d.index===t))break;return r.length||r.push(void 0),r}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,n=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===n).shift()}_getAxis(){const t={},n=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[P(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,n)]=!0;return Object.keys(t)}_getStackIndex(t,n,i){const s=this._getStacks(t,i),o=n!==void 0?s.indexOf(n):-1;return o===-1?s.length-1:o}_getRuler(){const t=this.options,n=this._cachedMeta,i=n.iScale,s=[];let o,r;for(o=0,r=n.data.length;o<r;++o)s.push(i.getPixelForValue(this.getParsed(o)[i.axis],o));const a=t.barThickness;return{min:a||by(n),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:n,_stacked:i,index:s},options:{base:o,minBarLength:r}}=this,a=o||0,l=this.getParsed(t),c=l._custom,d=$o(c);let u=l[n.axis],h=0,f=i?this.applyStack(n,l,i):u,g,p;f!==u&&(h=f-u,f=u),d&&(u=c.barStart,f=c.barEnd-c.barStart,u!==0&&Xt(u)!==Xt(c.barEnd)&&(h=0),h+=u);const m=!N(o)&&!d?o:h;let b=n.getPixelForValue(m);if(this.chart.getDataVisibility(t)?g=n.getPixelForValue(h+f):g=b,p=g-b,Math.abs(p)<r){p=_y(p,n,a)*r,u===a&&(b-=p/2);const y=n.getPixelForDecimal(0),x=n.getPixelForDecimal(1),_=Math.min(y,x),v=Math.max(y,x);b=Math.max(Math.min(b,v),_),g=b+p,i&&!d&&(l._stacks[n.axis]._visualValues[s]=n.getValueForPixel(g)-n.getValueForPixel(b))}if(b===n.getPixelForValue(a)){const y=Xt(p)*n.getLineWidthForValue(a)/2;b+=y,p-=y}return{size:p,base:b,head:g,center:g+p/2}}_calculateBarIndexPixels(t,n){const i=n.scale,s=this.options,o=s.skipNull,r=P(s.maxBarThickness,1/0);let a,l;const c=this._getAxisCount();if(n.grouped){const d=o?this._getStackCount(t):n.stackCount,u=s.barThickness==="flex"?vy(t,n,s,d*c):yy(t,n,s,d*c),h=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,f=this._getAxis().indexOf(P(h,this.getFirstScaleIdForIndexAxis())),g=this._getStackIndex(this.index,this._cachedMeta.stack,o?t:void 0)+f;a=u.start+u.chunk*g+u.chunk/2,l=Math.min(r,u.chunk*u.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(r,n.min*n.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,n=t.vScale,i=t.data,s=i.length;let o=0;for(;o<s;++o)this.getParsed(o)[n.axis]!==null&&!i[o].hidden&&i[o].draw(this._ctx)}}I(xs,"id","bar"),I(xs,"defaults",{datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}}),I(xs,"overrides",{scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}});class _s extends Vt{initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,n,i,s){const o=super.parsePrimitiveData(t,n,i,s);for(let r=0;r<o.length;r++)o[r]._custom=this.resolveDataElementOptions(r+i).radius;return o}parseArrayData(t,n,i,s){const o=super.parseArrayData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a[2],this.resolveDataElementOptions(r+i).radius)}return o}parseObjectData(t,n,i,s){const o=super.parseObjectData(t,n,i,s);for(let r=0;r<o.length;r++){const a=n[i+r];o[r]._custom=P(a&&a.r&&+a.r,this.resolveDataElementOptions(r+i).radius)}return o}getMaxOverflow(){const t=this._cachedMeta.data;let n=0;for(let i=t.length-1;i>=0;--i)n=Math.max(n,t[i].size(this.resolveDataElementOptions(i))/2);return n>0&&n}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y),c=r._custom;return{label:i[t]||"",value:"("+a+", "+l+(c?", "+c:"")+")"}}update(t){const n=this._cachedMeta.data;this.updateElements(n,0,n.length,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:c}=this._getSharedOptions(n,s),d=r.axis,u=a.axis;for(let h=n;h<n+i;h++){const f=t[h],g=!o&&this.getParsed(h),p={},m=p[d]=o?r.getPixelForDecimal(.5):r.getPixelForValue(g[d]),b=p[u]=o?a.getBasePixel():a.getPixelForValue(g[u]);p.skip=isNaN(m)||isNaN(b),c&&(p.options=l||this.resolveDataElementOptions(h,f.active?"active":s),o&&(p.options.radius=0)),this.updateElement(f,h,p,s)}}resolveDataElementOptions(t,n){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,n);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const o=s.radius;return n!=="active"&&(s.radius=0),s.radius+=P(i&&i._custom,o),s}}I(_s,"id","bubble"),I(_s,"defaults",{datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}}),I(_s,"overrides",{scales:{x:{type:"linear"},y:{type:"linear"}}});function Iy(e,t,n){let i=1,s=1,o=0,r=0;if(t<Q){const a=e,l=a+t,c=Math.cos(a),d=Math.sin(a),u=Math.cos(l),h=Math.sin(l),f=(x,_,v)=>xi(x,a,l,!0)?1:Math.max(_,_*n,v,v*n),g=(x,_,v)=>xi(x,a,l,!0)?-1:Math.min(_,_*n,v,v*n),p=f(0,c,u),m=f(at,d,h),b=g(U,c,u),y=g(U+at,d,h);i=(p-b)/2,s=(m-y)/2,o=-(p+b)/2,r=-(m+y)/2}return{ratioX:i,ratioY:s,offsetX:o,offsetY:r}}class Ye extends Vt{constructor(t,n){super(t,n),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,n){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let o=l=>+i[l];if(H(i[t])){const{key:l="value"}=this._parsing;o=c=>+Me(i[c],l)}let r,a;for(r=t,a=t+n;r<a;++r)s._parsed[r]=o(r)}}_getRotation(){return jt(this.options.rotation-90)}_getCircumference(){return jt(this.options.circumference)}_getRotationExtents(){let t=Q,n=-Q;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,o=s._getRotation(),r=s._getCircumference();t=Math.min(t,o),n=Math.max(n,o+r)}return{rotation:t,circumference:n-t}}update(t){const n=this.chart,{chartArea:i}=n,s=this._cachedMeta,o=s.data,r=this.getMaxBorderWidth()+this.getMaxOffset(o)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-r)/2,0),l=Math.min(Fb(this.options.cutout,a),1),c=this._getRingWeight(this.index),{circumference:d,rotation:u}=this._getRotationExtents(),{ratioX:h,ratioY:f,offsetX:g,offsetY:p}=Iy(u,d,l),m=(i.width-r)/h,b=(i.height-r)/f,y=Math.max(Math.min(m,b)/2,0),x=Gd(this.options.radius,y),_=Math.max(x*l,0),v=(x-_)/this._getVisibleDatasetWeightTotal();this.offsetX=g*x,this.offsetY=p*x,s.total=this.calculateTotal(),this.outerRadius=x-v*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-v*c,0),this.updateElements(o,0,o.length,t)}_circumference(t,n){const i=this.options,s=this._cachedMeta,o=this._getCircumference();return n&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*o/Q)}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,a=r.chartArea,c=r.options.animation,d=(a.left+a.right)/2,u=(a.top+a.bottom)/2,h=o&&c.animateScale,f=h?0:this.innerRadius,g=h?0:this.outerRadius,{sharedOptions:p,includeOptions:m}=this._getSharedOptions(n,s);let b=this._getRotation(),y;for(y=0;y<n;++y)b+=this._circumference(y,o);for(y=n;y<n+i;++y){const x=this._circumference(y,o),_=t[y],v={x:d+this.offsetX,y:u+this.offsetY,startAngle:b,endAngle:b+x,circumference:x,outerRadius:g,innerRadius:f};m&&(v.options=p||this.resolveDataElementOptions(y,_.active?"active":s)),b+=x,this.updateElement(_,y,v,s)}}calculateTotal(){const t=this._cachedMeta,n=t.data;let i=0,s;for(s=0;s<n.length;s++){const o=t._parsed[s];o!==null&&!isNaN(o)&&this.chart.getDataVisibility(s)&&!n[s].hidden&&(i+=Math.abs(o))}return i}calculateCircumference(t){const n=this._cachedMeta.total;return n>0&&!isNaN(t)?Q*(Math.abs(t)/n):0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ri(n._parsed[t],i.options.locale);return{label:s[t]||"",value:o}}getMaxBorderWidth(t){let n=0;const i=this.chart;let s,o,r,a,l;if(!t){for(s=0,o=i.data.datasets.length;s<o;++s)if(i.isDatasetVisible(s)){r=i.getDatasetMeta(s),t=r.data,a=r.controller;break}}if(!t)return 0;for(s=0,o=t.length;s<o;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(n=Math.max(n,l.borderWidth||0,l.hoverBorderWidth||0));return n}getMaxOffset(t){let n=0;for(let i=0,s=t.length;i<s;++i){const o=this.resolveDataElementOptions(i);n=Math.max(n,o.offset||0,o.hoverOffset||0)}return n}_getRingWeightOffset(t){let n=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(n+=this._getRingWeight(i));return n}_getRingWeight(t){return Math.max(P(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}I(Ye,"id","doughnut"),I(Ye,"defaults",{datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"}),I(Ye,"descriptors",{_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")}),I(Ye,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data,{labels:{pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=t.legend.options;return n.labels.length&&n.datasets.length?n.labels.map((l,c)=>{const u=t.getDatasetMeta(0).controller.getStyle(c);return{text:l,fillStyle:u.backgroundColor,fontColor:o,hidden:!t.getDataVisibility(c),lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:u.borderWidth,strokeStyle:u.borderColor,textAlign:s,pointStyle:i,borderRadius:r&&(a||u.borderRadius),index:c}}):[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}}});class ws extends Vt{initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const n=this._cachedMeta,{dataset:i,data:s=[],_dataset:o}=n,r=this.chart._animationsDisabled;let{start:a,count:l}=nu(n,s,r);this._drawStart=a,this._drawCount=l,iu(n)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!o._decimated,i.points=s;const c=this.resolveDatasetElementOptions(t);this.options.showLine||(c.borderWidth=0),c.segment=this.options.segment,this.updateElement(i,void 0,{animated:!r,options:c},t),this.updateElements(s,a,l,t)}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,{sharedOptions:d,includeOptions:u}=this._getSharedOptions(n,s),h=r.axis,f=a.axis,{spanGaps:g,segment:p}=this.options,m=vn(g)?g:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||o||s==="none",y=n+i,x=t.length;let _=n>0&&this.getParsed(n-1);for(let v=0;v<x;++v){const w=t[v],k=b?w:{};if(v<n||v>=y){k.skip=!0;continue}const S=this.getParsed(v),D=N(S[f]),A=k[h]=r.getPixelForValue(S[h],v),T=k[f]=o||D?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,S,l):S[f],v);k.skip=isNaN(A)||isNaN(T)||D,k.stop=v>0&&Math.abs(S[h]-_[h])>m,p&&(k.parsed=S,k.raw=c.data[v]),u&&(k.options=d||this.resolveDataElementOptions(v,w.active?"active":s)),b||this.updateElement(w,v,k,s),_=S}}getMaxOverflow(){const t=this._cachedMeta,n=t.dataset,i=n.options&&n.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const o=s[0].size(this.resolveDataElementOptions(0)),r=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,o,r)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}I(ws,"id","line"),I(ws,"defaults",{datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1}),I(ws,"overrides",{scales:{_index_:{type:"category"},_value_:{type:"linear"}}});class ui extends Vt{constructor(t,n){super(t,n),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const n=this._cachedMeta,i=this.chart,s=i.data.labels||[],o=Ri(n._parsed[t].r,i.options.locale);return{label:s[t]||"",value:o}}parseObjectData(t,n,i,s){return uu.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta.data;this._updateRadius(),this.updateElements(n,0,n.length,t)}getMinMax(){const t=this._cachedMeta,n={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const o=this.getParsed(s).r;!isNaN(o)&&this.chart.getDataVisibility(s)&&(o<n.min&&(n.min=o),o>n.max&&(n.max=o))}),n}_updateRadius(){const t=this.chart,n=t.chartArea,i=t.options,s=Math.min(n.right-n.left,n.bottom-n.top),o=Math.max(s/2,0),r=Math.max(i.cutoutPercentage?o/100*i.cutoutPercentage:1,0),a=(o-r)/t.getVisibleDatasetCount();this.outerRadius=o-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,n,i,s){const o=s==="reset",r=this.chart,l=r.options.animation,c=this._cachedMeta.rScale,d=c.xCenter,u=c.yCenter,h=c.getIndexAngle(0)-.5*U;let f=h,g;const p=360/this.countVisibleElements();for(g=0;g<n;++g)f+=this._computeAngle(g,s,p);for(g=n;g<n+i;g++){const m=t[g];let b=f,y=f+this._computeAngle(g,s,p),x=r.getDataVisibility(g)?c.getDistanceFromCenterForValue(this.getParsed(g).r):0;f=y,o&&(l.animateScale&&(x=0),l.animateRotate&&(b=y=h));const _={x:d,y:u,innerRadius:0,outerRadius:x,startAngle:b,endAngle:y,options:this.resolveDataElementOptions(g,m.active?"active":s)};this.updateElement(m,g,_,s)}}countVisibleElements(){const t=this._cachedMeta;let n=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&n++}),n}_computeAngle(t,n,i){return this.chart.getDataVisibility(t)?jt(this.resolveDataElementOptions(t,n).angle||i):0}}I(ui,"id","polarArea"),I(ui,"defaults",{dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0}),I(ui,"overrides",{aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const n=t.data;if(n.labels.length&&n.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return n.labels.map((o,r)=>{const l=t.getDatasetMeta(0).controller.getStyle(r);return{text:o,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(r),index:r}})}return[]}},onClick(t,n,i){i.chart.toggleDataVisibility(n.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}});class mr extends Ye{}I(mr,"id","pie"),I(mr,"defaults",{cutout:0,rotation:0,circumference:360,radius:"100%"});class ks extends Vt{getLabelAndValue(t){const n=this._cachedMeta.vScale,i=this.getParsed(t);return{label:n.getLabels()[t],value:""+n.getLabelForValue(i[n.axis])}}parseObjectData(t,n,i,s){return uu.bind(this)(t,n,i,s)}update(t){const n=this._cachedMeta,i=n.dataset,s=n.data||[],o=n.iScale.getLabels();if(i.points=s,t!=="resize"){const r=this.resolveDatasetElementOptions(t);this.options.showLine||(r.borderWidth=0);const a={_loop:!0,_fullLoop:o.length===s.length,options:r};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,n,i,s){const o=this._cachedMeta.rScale,r=s==="reset";for(let a=n;a<n+i;a++){const l=t[a],c=this.resolveDataElementOptions(a,l.active?"active":s),d=o.getPointPositionForValue(a,this.getParsed(a).r),u=r?o.xCenter:d.x,h=r?o.yCenter:d.y,f={x:u,y:h,angle:d.angle,skip:isNaN(u)||isNaN(h),options:c};this.updateElement(l,a,f,s)}}}I(ks,"id","radar"),I(ks,"defaults",{datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}}),I(ks,"overrides",{aspectRatio:1,scales:{r:{type:"radialLinear"}}});class Ss extends Vt{getLabelAndValue(t){const n=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:o}=n,r=this.getParsed(t),a=s.getLabelForValue(r.x),l=o.getLabelForValue(r.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const n=this._cachedMeta,{data:i=[]}=n,s=this.chart._animationsDisabled;let{start:o,count:r}=nu(n,i,s);if(this._drawStart=o,this._drawCount=r,iu(n)&&(o=0,r=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=n;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const c=this.resolveDatasetElementOptions(t);c.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:c},t)}else this.datasetElementType&&(delete n.dataset,this.datasetElementType=!1);this.updateElements(i,o,r,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,n,i,s){const o=s==="reset",{iScale:r,vScale:a,_stacked:l,_dataset:c}=this._cachedMeta,d=this.resolveDataElementOptions(n,s),u=this.getSharedOptions(d),h=this.includeOptions(s,u),f=r.axis,g=a.axis,{spanGaps:p,segment:m}=this.options,b=vn(p)?p:Number.POSITIVE_INFINITY,y=this.chart._animationsDisabled||o||s==="none";let x=n>0&&this.getParsed(n-1);for(let _=n;_<n+i;++_){const v=t[_],w=this.getParsed(_),k=y?v:{},S=N(w[g]),D=k[f]=r.getPixelForValue(w[f],_),A=k[g]=o||S?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,w,l):w[g],_);k.skip=isNaN(D)||isNaN(A)||S,k.stop=_>0&&Math.abs(w[f]-x[f])>b,m&&(k.parsed=w,k.raw=c.data[_]),h&&(k.options=u||this.resolveDataElementOptions(_,v.active?"active":s)),y||this.updateElement(v,_,k,s),x=w}this.updateSharedOptions(u,s,d)}getMaxOverflow(){const t=this._cachedMeta,n=t.data||[];if(!this.options.showLine){let a=0;for(let l=n.length-1;l>=0;--l)a=Math.max(a,n[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!n.length)return s;const o=n[0].size(this.resolveDataElementOptions(0)),r=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(s,o,r)/2}}I(Ss,"id","scatter"),I(Ss,"defaults",{datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1}),I(Ss,"overrides",{interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}});var Dy=Object.freeze({__proto__:null,BarController:xs,BubbleController:_s,DoughnutController:Ye,LineController:ws,PieController:mr,PolarAreaController:ui,RadarController:ks,ScatterController:Ss});function $e(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class la{constructor(t){I(this,"options");this.options=t||{}}static override(t){Object.assign(la.prototype,t)}init(){}formats(){return $e()}parse(){return $e()}format(){return $e()}add(){return $e()}diff(){return $e()}startOf(){return $e()}endOf(){return $e()}}var Ty={_date:la};function My(e,t,n,i){const{controller:s,data:o,_sorted:r}=e,a=s._cachedMeta.iScale,l=e.dataset&&e.dataset.options?e.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&r&&o.length){const c=a._reversePixels?Jb:re;if(i){if(s._sharedOptions){const d=o[0],u=typeof d.getRange=="function"&&d.getRange(t);if(u){const h=c(o,t,n-u),f=c(o,t,n+u);return{lo:h.lo,hi:f.hi}}}}else{const d=c(o,t,n);if(l){const{vScale:u}=s._cachedMeta,{_parsed:h}=e,f=h.slice(0,d.lo+1).reverse().findIndex(p=>!N(p[u.axis]));d.lo-=Math.max(0,f);const g=h.slice(d.hi).findIndex(p=>!N(p[u.axis]));d.hi+=Math.max(0,g)}return d}}return{lo:0,hi:o.length-1}}function lo(e,t,n,i,s){const o=e.getSortedVisibleDatasetMetas(),r=n[t];for(let a=0,l=o.length;a<l;++a){const{index:c,data:d}=o[a],{lo:u,hi:h}=My(o[a],t,r,s);for(let f=u;f<=h;++f){const g=d[f];g.skip||i(g,c,f)}}}function Cy(e){const t=e.indexOf("x")!==-1,n=e.indexOf("y")!==-1;return function(i,s){const o=t?Math.abs(i.x-s.x):0,r=n?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(o,2)+Math.pow(r,2))}}function zo(e,t,n,i,s){const o=[];return!s&&!e.isPointInArea(t)||lo(e,n,t,function(a,l,c){!s&&!ae(a,e.chartArea,0)||a.inRange(t.x,t.y,i)&&o.push({element:a,datasetIndex:l,index:c})},!0),o}function Ay(e,t,n,i){let s=[];function o(r,a,l){const{startAngle:c,endAngle:d}=r.getProps(["startAngle","endAngle"],i),{angle:u}=Jd(r,{x:t.x,y:t.y});xi(u,c,d)&&s.push({element:r,datasetIndex:a,index:l})}return lo(e,n,t,o),s}function Ly(e,t,n,i,s,o){let r=[];const a=Cy(n);let l=Number.POSITIVE_INFINITY;function c(d,u,h){const f=d.inRange(t.x,t.y,s);if(i&&!f)return;const g=d.getCenterPoint(s);if(!(!!o||e.isPointInArea(g))&&!f)return;const m=a(t,g);m<l?(r=[{element:d,datasetIndex:u,index:h}],l=m):m===l&&r.push({element:d,datasetIndex:u,index:h})}return lo(e,n,t,c),r}function jo(e,t,n,i,s,o){return!o&&!e.isPointInArea(t)?[]:n==="r"&&!i?Ay(e,t,n,s):Ly(e,t,n,i,s,o)}function Fl(e,t,n,i,s){const o=[],r=n==="x"?"inXRange":"inYRange";let a=!1;return lo(e,n,t,(l,c,d)=>{l[r]&&l[r](t[n],s)&&(o.push({element:l,datasetIndex:c,index:d}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:o}var Oy={modes:{index(e,t,n,i){const s=Ve(t,e),o=n.axis||"x",r=n.includeInvisible||!1,a=n.intersect?zo(e,s,o,i,r):jo(e,s,o,!1,i,r),l=[];return a.length?(e.getSortedVisibleDatasetMetas().forEach(c=>{const d=a[0].index,u=c.data[d];u&&!u.skip&&l.push({element:u,datasetIndex:c.index,index:d})}),l):[]},dataset(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;let a=n.intersect?zo(e,s,o,i,r):jo(e,s,o,!1,i,r);if(a.length>0){const l=a[0].datasetIndex,c=e.getDatasetMeta(l).data;a=[];for(let d=0;d<c.length;++d)a.push({element:c[d],datasetIndex:l,index:d})}return a},point(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return zo(e,s,o,i,r)},nearest(e,t,n,i){const s=Ve(t,e),o=n.axis||"xy",r=n.includeInvisible||!1;return jo(e,s,o,n.intersect,i,r)},x(e,t,n,i){const s=Ve(t,e);return Fl(e,s,"x",n.intersect,i)},y(e,t,n,i){const s=Ve(t,e);return Fl(e,s,"y",n.intersect,i)}}};const wu=["left","top","right","bottom"];function Ln(e,t){return e.filter(n=>n.pos===t)}function Hl(e,t){return e.filter(n=>wu.indexOf(n.pos)===-1&&n.box.axis===t)}function On(e,t){return e.sort((n,i)=>{const s=t?i:n,o=t?n:i;return s.weight===o.weight?s.index-o.index:s.weight-o.weight})}function Py(e){const t=[];let n,i,s,o,r,a;for(n=0,i=(e||[]).length;n<i;++n)s=e[n],{position:o,options:{stack:r,stackWeight:a=1}}=s,t.push({index:n,box:s,pos:o,horizontal:s.isHorizontal(),weight:s.weight,stack:r&&o+r,stackWeight:a});return t}function Ry(e){const t={};for(const n of e){const{stack:i,pos:s,stackWeight:o}=n;if(!i||!wu.includes(s))continue;const r=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});r.count++,r.weight+=o}return t}function By(e,t){const n=Ry(e),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let o,r,a;for(o=0,r=e.length;o<r;++o){a=e[o];const{fullSize:l}=a.box,c=n[a.stack],d=c&&a.stackWeight/c.weight;a.horizontal?(a.width=d?d*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=d?d*s:l&&t.availableHeight)}return n}function Ny(e){const t=Py(e),n=On(t.filter(c=>c.box.fullSize),!0),i=On(Ln(t,"left"),!0),s=On(Ln(t,"right")),o=On(Ln(t,"top"),!0),r=On(Ln(t,"bottom")),a=Hl(t,"x"),l=Hl(t,"y");return{fullSize:n,leftAndTop:i.concat(o),rightAndBottom:s.concat(l).concat(r).concat(a),chartArea:Ln(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:o.concat(r).concat(a)}}function $l(e,t,n,i){return Math.max(e[n],t[n])+Math.max(e[i],t[i])}function ku(e,t){e.top=Math.max(e.top,t.top),e.left=Math.max(e.left,t.left),e.bottom=Math.max(e.bottom,t.bottom),e.right=Math.max(e.right,t.right)}function Fy(e,t,n,i){const{pos:s,box:o}=n,r=e.maxPadding;if(!H(s)){n.size&&(e[s]-=n.size);const u=i[n.stack]||{size:0,count:1};u.size=Math.max(u.size,n.horizontal?o.height:o.width),n.size=u.size/u.count,e[s]+=n.size}o.getPadding&&ku(r,o.getPadding());const a=Math.max(0,t.outerWidth-$l(r,e,"left","right")),l=Math.max(0,t.outerHeight-$l(r,e,"top","bottom")),c=a!==e.w,d=l!==e.h;return e.w=a,e.h=l,n.horizontal?{same:c,other:d}:{same:d,other:c}}function Hy(e){const t=e.maxPadding;function n(i){const s=Math.max(t[i]-e[i],0);return e[i]+=s,s}e.y+=n("top"),e.x+=n("left"),n("right"),n("bottom")}function $y(e,t){const n=t.maxPadding;function i(s){const o={left:0,top:0,right:0,bottom:0};return s.forEach(r=>{o[r]=Math.max(t[r],n[r])}),o}return i(e?["left","right"]:["top","bottom"])}function Un(e,t,n,i){const s=[];let o,r,a,l,c,d;for(o=0,r=e.length,c=0;o<r;++o){a=e[o],l=a.box,l.update(a.width||t.w,a.height||t.h,$y(a.horizontal,t));const{same:u,other:h}=Fy(t,n,a,i);c|=u&&s.length,d=d||h,l.fullSize||s.push(a)}return c&&Un(s,t,n,i)||d}function ts(e,t,n,i,s){e.top=n,e.left=t,e.right=t+i,e.bottom=n+s,e.width=i,e.height=s}function zl(e,t,n,i){const s=n.padding;let{x:o,y:r}=t;for(const a of e){const l=a.box,c=i[a.stack]||{placed:0,weight:1},d=a.stackWeight/c.weight||1;if(a.horizontal){const u=t.w*d,h=c.size||l.height;vi(c.start)&&(r=c.start),l.fullSize?ts(l,s.left,r,n.outerWidth-s.right-s.left,h):ts(l,t.left+c.placed,r,u,h),c.start=r,c.placed+=u,r=l.bottom}else{const u=t.h*d,h=c.size||l.width;vi(c.start)&&(o=c.start),l.fullSize?ts(l,o,s.top,h,n.outerHeight-s.bottom-s.top):ts(l,o,t.top+c.placed,h,u),c.start=o,c.placed+=u,o=l.right}}t.x=o,t.y=r}var _t={addBox(e,t){e.boxes||(e.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(n){t.draw(n)}}]},e.boxes.push(t)},removeBox(e,t){const n=e.boxes?e.boxes.indexOf(t):-1;n!==-1&&e.boxes.splice(n,1)},configure(e,t,n){t.fullSize=n.fullSize,t.position=n.position,t.weight=n.weight},update(e,t,n,i){if(!e)return;const s=wt(e.options.layout.padding),o=Math.max(t-s.width,0),r=Math.max(n-s.height,0),a=Ny(e.boxes),l=a.vertical,c=a.horizontal;q(e.boxes,p=>{typeof p.beforeLayout=="function"&&p.beforeLayout()});const d=l.reduce((p,m)=>m.box.options&&m.box.options.display===!1?p:p+1,0)||1,u=Object.freeze({outerWidth:t,outerHeight:n,padding:s,availableWidth:o,availableHeight:r,vBoxMaxWidth:o/2/d,hBoxMaxHeight:r/2}),h=Object.assign({},s);ku(h,wt(i));const f=Object.assign({maxPadding:h,w:o,h:r,x:s.left,y:s.top},s),g=By(l.concat(c),u);Un(a.fullSize,f,u,g),Un(l,f,u,g),Un(c,f,u,g)&&Un(l,f,u,g),Hy(f),zl(a.leftAndTop,f,u,g),f.x+=f.w,f.y+=f.h,zl(a.rightAndBottom,f,u,g),e.chartArea={left:f.left,top:f.top,right:f.left+f.w,bottom:f.top+f.h,height:f.h,width:f.w},q(a.chartArea,p=>{const m=p.box;Object.assign(m,e.chartArea),m.update(f.w,f.h,{left:0,top:0,right:0,bottom:0})})}};class Su{acquireContext(t,n){}releaseContext(t){return!1}addEventListener(t,n,i){}removeEventListener(t,n,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,n,i,s){return n=Math.max(0,n||t.width),i=i||t.height,{width:n,height:Math.max(0,s?Math.floor(n/s):i)}}isAttached(t){return!0}updateConfig(t){}}class zy extends Su{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Es="$chartjs",jy={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},jl=e=>e===null||e==="";function Vy(e,t){const n=e.style,i=e.getAttribute("height"),s=e.getAttribute("width");if(e[Es]={initial:{height:i,width:s,style:{display:n.display,height:n.height,width:n.width}}},n.display=n.display||"block",n.boxSizing=n.boxSizing||"border-box",jl(s)){const o=El(e,"width");o!==void 0&&(e.width=o)}if(jl(i))if(e.style.height==="")e.height=e.width/(t||2);else{const o=El(e,"height");o!==void 0&&(e.height=o)}return e}const Eu=U0?{passive:!0}:!1;function Uy(e,t,n){e&&e.addEventListener(t,n,Eu)}function Wy(e,t,n){e&&e.canvas&&e.canvas.removeEventListener(t,n,Eu)}function Yy(e,t){const n=jy[e.type]||e.type,{x:i,y:s}=Ve(e,t);return{type:n,chart:t,native:e,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Ks(e,t){for(const n of e)if(n===t||n.contains(t))return!0}function qy(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ks(a.addedNodes,i),r=r&&!Ks(a.removedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}function Gy(e,t,n){const i=e.canvas,s=new MutationObserver(o=>{let r=!1;for(const a of o)r=r||Ks(a.removedNodes,i),r=r&&!Ks(a.addedNodes,i);r&&n()});return s.observe(document,{childList:!0,subtree:!0}),s}const wi=new Map;let Vl=0;function Iu(){const e=window.devicePixelRatio;e!==Vl&&(Vl=e,wi.forEach((t,n)=>{n.currentDevicePixelRatio!==e&&t()}))}function Xy(e,t){wi.size||window.addEventListener("resize",Iu),wi.set(e,t)}function Ky(e){wi.delete(e),wi.size||window.removeEventListener("resize",Iu)}function Jy(e,t,n){const i=e.canvas,s=i&&aa(i);if(!s)return;const o=eu((a,l)=>{const c=s.clientWidth;n(a,l),c<s.clientWidth&&n()},window),r=new ResizeObserver(a=>{const l=a[0],c=l.contentRect.width,d=l.contentRect.height;c===0&&d===0||o(c,d)});return r.observe(s),Xy(e,o),r}function Vo(e,t,n){n&&n.disconnect(),t==="resize"&&Ky(e)}function Zy(e,t,n){const i=e.canvas,s=eu(o=>{e.ctx!==null&&n(Yy(o,e))},e);return Uy(i,t,s),s}class Qy extends Su{acquireContext(t,n){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?(Vy(t,n),i):null}releaseContext(t){const n=t.canvas;if(!n[Es])return!1;const i=n[Es].initial;["height","width"].forEach(o=>{const r=i[o];N(r)?n.removeAttribute(o):n.setAttribute(o,r)});const s=i.style||{};return Object.keys(s).forEach(o=>{n.style[o]=s[o]}),n.width=n.width,delete n[Es],!0}addEventListener(t,n,i){this.removeEventListener(t,n);const s=t.$proxies||(t.$proxies={}),r={attach:qy,detach:Gy,resize:Jy}[n]||Zy;s[n]=r(t,n,i)}removeEventListener(t,n){const i=t.$proxies||(t.$proxies={}),s=i[n];if(!s)return;({attach:Vo,detach:Vo,resize:Vo}[n]||Wy)(t,n,s),i[n]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,n,i,s){return V0(t,n,i,s)}isAttached(t){const n=t&&aa(t);return!!(n&&n.isConnected)}}function tv(e){return!ra()||typeof OffscreenCanvas<"u"&&e instanceof OffscreenCanvas?zy:Qy}class Ut{constructor(){I(this,"x");I(this,"y");I(this,"active",!1);I(this,"options");I(this,"$animations")}tooltipPosition(t){const{x:n,y:i}=this.getProps(["x","y"],t);return{x:n,y:i}}hasValue(){return vn(this.x)&&vn(this.y)}getProps(t,n){const i=this.$animations;if(!n||!i)return this;const s={};return t.forEach(o=>{s[o]=i[o]&&i[o].active()?i[o]._to:this[o]}),s}}I(Ut,"defaults",{}),I(Ut,"defaultRoutes");function ev(e,t){const n=e.options.ticks,i=nv(e),s=Math.min(n.maxTicksLimit||i,i),o=n.major.enabled?sv(t):[],r=o.length,a=o[0],l=o[r-1],c=[];if(r>s)return ov(t,c,o,r/s),c;const d=iv(o,t,s);if(r>0){let u,h;const f=r>1?Math.round((l-a)/(r-1)):null;for(es(t,c,d,N(f)?0:a-f,a),u=0,h=r-1;u<h;u++)es(t,c,d,o[u],o[u+1]);return es(t,c,d,l,N(f)?t.length:l+f),c}return es(t,c,d),c}function nv(e){const t=e.options.offset,n=e._tickSize(),i=e._length/n+(t?0:1),s=e._maxLength/n;return Math.floor(Math.min(i,s))}function iv(e,t,n){const i=rv(e),s=t.length/n;if(!i)return Math.max(s,1);const o=Yb(i);for(let r=0,a=o.length-1;r<a;r++){const l=o[r];if(l>s)return l}return Math.max(s,1)}function sv(e){const t=[];let n,i;for(n=0,i=e.length;n<i;n++)e[n].major&&t.push(n);return t}function ov(e,t,n,i){let s=0,o=n[0],r;for(i=Math.ceil(i),r=0;r<e.length;r++)r===o&&(t.push(e[r]),s++,o=n[s*i])}function es(e,t,n,i,s){const o=P(i,0),r=Math.min(P(s,e.length),e.length);let a=0,l,c,d;for(n=Math.ceil(n),s&&(l=s-i,n=l/Math.floor(l/n)),d=o;d<0;)a++,d=Math.round(o+a*n);for(c=Math.max(o,0);c<r;c++)c===d&&(t.push(e[c]),a++,d=Math.round(o+a*n))}function rv(e){const t=e.length;let n,i;if(t<2)return!1;for(i=e[0],n=1;n<t;++n)if(e[n]-e[n-1]!==i)return!1;return i}const av=e=>e==="left"?"right":e==="right"?"left":e,Ul=(e,t,n)=>t==="top"||t==="left"?e[t]+n:e[t]-n,Wl=(e,t)=>Math.min(t||e,e);function Yl(e,t){const n=[],i=e.length/t,s=e.length;let o=0;for(;o<s;o+=i)n.push(e[Math.floor(o)]);return n}function lv(e,t,n){const i=e.ticks.length,s=Math.min(t,i-1),o=e._startPixel,r=e._endPixel,a=1e-6;let l=e.getPixelForTick(s),c;if(!(n&&(i===1?c=Math.max(l-o,r-l):t===0?c=(e.getPixelForTick(1)-l)/2:c=(l-e.getPixelForTick(s-1))/2,l+=s<t?c:-c,l<o-a||l>r+a)))return l}function cv(e,t){q(e,n=>{const i=n.gc,s=i.length/2;let o;if(s>t){for(o=0;o<s;++o)delete n.data[i[o]];i.splice(0,s)}})}function Pn(e){return e.drawTicks?e.tickLength:0}function ql(e,t){if(!e.display)return 0;const n=dt(e.font,t),i=wt(e.padding);return(et(e.text)?e.text.length:1)*n.lineHeight+i.height}function dv(e,t){return Ae(e,{scale:t,type:"scale"})}function uv(e,t,n){return Ae(e,{tick:n,index:t,type:"tick"})}function hv(e,t,n){let i=ta(e);return(n&&t!=="right"||!n&&t==="right")&&(i=av(i)),i}function fv(e,t,n,i){const{top:s,left:o,bottom:r,right:a,chart:l}=e,{chartArea:c,scales:d}=l;let u=0,h,f,g;const p=r-s,m=a-o;if(e.isHorizontal()){if(f=vt(i,o,a),H(n)){const b=Object.keys(n)[0],y=n[b];g=d[b].getPixelForValue(y)+p-t}else n==="center"?g=(c.bottom+c.top)/2+p-t:g=Ul(e,n,t);h=a-o}else{if(H(n)){const b=Object.keys(n)[0],y=n[b];f=d[b].getPixelForValue(y)-m+t}else n==="center"?f=(c.left+c.right)/2-m+t:f=Ul(e,n,t);g=vt(i,r,s),u=n==="left"?-at:at}return{titleX:f,titleY:g,maxWidth:h,rotation:u}}class tn extends Ut{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,n){return t}getUserBounds(){let{_userMin:t,_userMax:n,_suggestedMin:i,_suggestedMax:s}=this;return t=Lt(t,Number.POSITIVE_INFINITY),n=Lt(n,Number.NEGATIVE_INFINITY),i=Lt(i,Number.POSITIVE_INFINITY),s=Lt(s,Number.NEGATIVE_INFINITY),{min:Lt(t,i),max:Lt(n,s),minDefined:ot(t),maxDefined:ot(n)}}getMinMax(t){let{min:n,max:i,minDefined:s,maxDefined:o}=this.getUserBounds(),r;if(s&&o)return{min:n,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,c=a.length;l<c;++l)r=a[l].controller.getMinMax(this,t),s||(n=Math.min(n,r.min)),o||(i=Math.max(i,r.max));return n=o&&n>i?i:n,i=s&&n>i?n:i,{min:Lt(n,Lt(i,n)),max:Lt(i,Lt(n,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){Z(this.options.beforeUpdate,[this])}update(t,n,i){const{beginAtZero:s,grace:o,ticks:r}=this.options,a=r.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=n,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=_0(this,o,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?Yl(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),r.display&&(r.autoSkip||r.source==="auto")&&(this.ticks=ev(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,n,i;this.isHorizontal()?(n=this.left,i=this.right):(n=this.top,i=this.bottom,t=!t),this._startPixel=n,this._endPixel=i,this._reversePixels=t,this._length=i-n,this._alignToPixels=this.options.alignToPixels}afterUpdate(){Z(this.options.afterUpdate,[this])}beforeSetDimensions(){Z(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){Z(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),Z(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){Z(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const n=this.options.ticks;let i,s,o;for(i=0,s=t.length;i<s;i++)o=t[i],o.label=Z(n.callback,[o.value,i,t],this)}afterTickToLabelConversion(){Z(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){Z(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,n=t.ticks,i=Wl(this.ticks.length,t.ticks.maxTicksLimit),s=n.minRotation||0,o=n.maxRotation;let r=s,a,l,c;if(!this._isVisible()||!n.display||s>=o||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const d=this._getLabelSizes(),u=d.widest.width,h=d.highest.height,f=gt(this.chart.width-u,0,this.maxWidth);a=t.offset?this.maxWidth/i:f/(i-1),u+6>a&&(a=f/(i-(t.offset?.5:1)),l=this.maxHeight-Pn(t.grid)-n.padding-ql(t.title,this.chart.options.font),c=Math.sqrt(u*u+h*h),r=Zr(Math.min(Math.asin(gt((d.highest.height+6)/a,-1,1)),Math.asin(gt(l/c,-1,1))-Math.asin(gt(h/c,-1,1)))),r=Math.max(s,Math.min(o,r))),this.labelRotation=r}afterCalculateLabelRotation(){Z(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){Z(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:n,options:{ticks:i,title:s,grid:o}}=this,r=this._isVisible(),a=this.isHorizontal();if(r){const l=ql(s,n.options.font);if(a?(t.width=this.maxWidth,t.height=Pn(o)+l):(t.height=this.maxHeight,t.width=Pn(o)+l),i.display&&this.ticks.length){const{first:c,last:d,widest:u,highest:h}=this._getLabelSizes(),f=i.padding*2,g=jt(this.labelRotation),p=Math.cos(g),m=Math.sin(g);if(a){const b=i.mirror?0:m*u.width+p*h.height;t.height=Math.min(this.maxHeight,t.height+b+f)}else{const b=i.mirror?0:p*u.width+m*h.height;t.width=Math.min(this.maxWidth,t.width+b+f)}this._calculatePadding(c,d,m,p)}}this._handleMargins(),a?(this.width=this._length=n.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=n.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,n,i,s){const{ticks:{align:o,padding:r},position:a}=this.options,l=this.labelRotation!==0,c=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const d=this.getPixelForTick(0)-this.left,u=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,f=0;l?c?(h=s*t.width,f=i*n.height):(h=i*t.height,f=s*n.width):o==="start"?f=n.width:o==="end"?h=t.width:o!=="inner"&&(h=t.width/2,f=n.width/2),this.paddingLeft=Math.max((h-d+r)*this.width/(this.width-d),0),this.paddingRight=Math.max((f-u+r)*this.width/(this.width-u),0)}else{let d=n.height/2,u=t.height/2;o==="start"?(d=0,u=t.height):o==="end"&&(d=n.height,u=0),this.paddingTop=d+r,this.paddingBottom=u+r}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){Z(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:n}=this.options;return n==="top"||n==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let n,i;for(n=0,i=t.length;n<i;n++)N(t[n].label)&&(t.splice(n,1),i--,n--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const n=this.options.ticks.sampleSize;let i=this.ticks;n<i.length&&(i=Yl(i,n)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,n,i){const{ctx:s,_longestTextCache:o}=this,r=[],a=[],l=Math.floor(n/Wl(n,i));let c=0,d=0,u,h,f,g,p,m,b,y,x,_,v;for(u=0;u<n;u+=l){if(g=t[u].label,p=this._resolveTickFontOptions(u),s.font=m=p.string,b=o[m]=o[m]||{data:{},gc:[]},y=p.lineHeight,x=_=0,!N(g)&&!et(g))x=Gs(s,b.data,b.gc,x,g),_=y;else if(et(g))for(h=0,f=g.length;h<f;++h)v=g[h],!N(v)&&!et(v)&&(x=Gs(s,b.data,b.gc,x,v),_+=y);r.push(x),a.push(_),c=Math.max(x,c),d=Math.max(_,d)}cv(o,n);const w=r.indexOf(c),k=a.indexOf(d),S=D=>({width:r[D]||0,height:a[D]||0});return{first:S(0),last:S(n-1),widest:S(w),highest:S(k),widths:r,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,n){return NaN}getValueForPixel(t){}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const n=this._startPixel+t*this._length;return Kb(this._alignToPixels?He(this.chart,n,0):n)}getDecimalForPixel(t){const n=(t-this._startPixel)/this._length;return this._reversePixels?1-n:n}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:n}=this;return t<0&&n<0?n:t>0&&n>0?t:0}getContext(t){const n=this.ticks||[];if(t>=0&&t<n.length){const i=n[t];return i.$context||(i.$context=uv(this.getContext(),t,i))}return this.$context||(this.$context=dv(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,n=jt(this.labelRotation),i=Math.abs(Math.cos(n)),s=Math.abs(Math.sin(n)),o=this._getLabelSizes(),r=t.autoSkipPadding||0,a=o?o.widest.width+r:0,l=o?o.highest.height+r:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const n=this.axis,i=this.chart,s=this.options,{grid:o,position:r,border:a}=s,l=o.offset,c=this.isHorizontal(),u=this.ticks.length+(l?1:0),h=Pn(o),f=[],g=a.setContext(this.getContext()),p=g.display?g.width:0,m=p/2,b=function(j){return He(i,j,p)};let y,x,_,v,w,k,S,D,A,T,R,G;if(r==="top")y=b(this.bottom),k=this.bottom-h,D=y-m,T=b(t.top)+m,G=t.bottom;else if(r==="bottom")y=b(this.top),T=t.top,G=b(t.bottom)-m,k=y+m,D=this.top+h;else if(r==="left")y=b(this.right),w=this.right-h,S=y-m,A=b(t.left)+m,R=t.right;else if(r==="right")y=b(this.left),A=t.left,R=b(t.right)-m,w=y+m,S=this.left+h;else if(n==="x"){if(r==="center")y=b((t.top+t.bottom)/2+.5);else if(H(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}T=t.top,G=t.bottom,k=y+m,D=k+h}else if(n==="y"){if(r==="center")y=b((t.left+t.right)/2);else if(H(r)){const j=Object.keys(r)[0],J=r[j];y=b(this.chart.scales[j].getPixelForValue(J))}w=y-m,S=w-h,A=t.left,R=t.right}const rt=P(s.ticks.maxTicksLimit,u),z=Math.max(1,Math.ceil(u/rt));for(x=0;x<u;x+=z){const j=this.getContext(x),J=o.setContext(j),pt=a.setContext(j),ut=J.lineWidth,Le=J.color,Oe=pt.dash||[],pe=pt.dashOffset,Tn=J.tickWidth,Pe=J.tickColor,Mn=J.tickBorderDash||[],Re=J.tickBorderDashOffset;_=lv(this,x,l),_!==void 0&&(v=He(i,_,ut),c?w=S=A=R=v:k=D=T=G=v,f.push({tx1:w,ty1:k,tx2:S,ty2:D,x1:A,y1:T,x2:R,y2:G,width:ut,color:Le,borderDash:Oe,borderDashOffset:pe,tickWidth:Tn,tickColor:Pe,tickBorderDash:Mn,tickBorderDashOffset:Re}))}return this._ticksLength=u,this._borderValue=y,f}_computeLabelItems(t){const n=this.axis,i=this.options,{position:s,ticks:o}=i,r=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:c,padding:d,mirror:u}=o,h=Pn(i.grid),f=h+d,g=u?-d:f,p=-jt(this.labelRotation),m=[];let b,y,x,_,v,w,k,S,D,A,T,R,G="middle";if(s==="top")w=this.bottom-g,k=this._getXAxisLabelAlignment();else if(s==="bottom")w=this.top+g,k=this._getXAxisLabelAlignment();else if(s==="left"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,v=z.x}else if(s==="right"){const z=this._getYAxisLabelAlignment(h);k=z.textAlign,v=z.x}else if(n==="x"){if(s==="center")w=(t.top+t.bottom)/2+f;else if(H(s)){const z=Object.keys(s)[0],j=s[z];w=this.chart.scales[z].getPixelForValue(j)+f}k=this._getXAxisLabelAlignment()}else if(n==="y"){if(s==="center")v=(t.left+t.right)/2-f;else if(H(s)){const z=Object.keys(s)[0],j=s[z];v=this.chart.scales[z].getPixelForValue(j)}k=this._getYAxisLabelAlignment(h).textAlign}n==="y"&&(l==="start"?G="top":l==="end"&&(G="bottom"));const rt=this._getLabelSizes();for(b=0,y=a.length;b<y;++b){x=a[b],_=x.label;const z=o.setContext(this.getContext(b));S=this.getPixelForTick(b)+o.labelOffset,D=this._resolveTickFontOptions(b),A=D.lineHeight,T=et(_)?_.length:1;const j=T/2,J=z.color,pt=z.textStrokeColor,ut=z.textStrokeWidth;let Le=k;r?(v=S,k==="inner"&&(b===y-1?Le=this.options.reverse?"left":"right":b===0?Le=this.options.reverse?"right":"left":Le="center"),s==="top"?c==="near"||p!==0?R=-T*A+A/2:c==="center"?R=-rt.highest.height/2-j*A+A:R=-rt.highest.height+A/2:c==="near"||p!==0?R=A/2:c==="center"?R=rt.highest.height/2-j*A:R=rt.highest.height-T*A,u&&(R*=-1),p!==0&&!z.showLabelBackdrop&&(v+=A/2*Math.sin(p))):(w=S,R=(1-T)*A/2);let Oe;if(z.showLabelBackdrop){const pe=wt(z.backdropPadding),Tn=rt.heights[b],Pe=rt.widths[b];let Mn=R-pe.top,Re=0-pe.left;switch(G){case"middle":Mn-=Tn/2;break;case"bottom":Mn-=Tn;break}switch(k){case"center":Re-=Pe/2;break;case"right":Re-=Pe;break;case"inner":b===y-1?Re-=Pe:b>0&&(Re-=Pe/2);break}Oe={left:Re,top:Mn,width:Pe+pe.width,height:Tn+pe.height,color:z.backdropColor}}m.push({label:_,font:D,textOffset:R,options:{rotation:p,color:J,strokeColor:pt,strokeWidth:ut,textAlign:Le,textBaseline:G,translation:[v,w],backdrop:Oe}})}return m}_getXAxisLabelAlignment(){const{position:t,ticks:n}=this.options;if(-jt(this.labelRotation))return t==="top"?"left":"right";let s="center";return n.align==="start"?s="left":n.align==="end"?s="right":n.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:n,ticks:{crossAlign:i,mirror:s,padding:o}}=this.options,r=this._getLabelSizes(),a=t+o,l=r.widest.width;let c,d;return n==="left"?s?(d=this.right+o,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d+=l)):(d=this.right-a,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d=this.left)):n==="right"?s?(d=this.left+o,i==="near"?c="right":i==="center"?(c="center",d-=l/2):(c="left",d-=l)):(d=this.left+a,i==="near"?c="left":i==="center"?(c="center",d+=l/2):(c="right",d=this.right)):c="right",{textAlign:c,x:d}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,n=this.options.position;if(n==="left"||n==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(n==="top"||n==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:n},left:i,top:s,width:o,height:r}=this;n&&(t.save(),t.fillStyle=n,t.fillRect(i,s,o,r),t.restore())}getLineWidthForValue(t){const n=this.options.grid;if(!this._isVisible()||!n.display)return 0;const s=this.ticks.findIndex(o=>o.value===t);return s>=0?n.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const n=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let o,r;const a=(l,c,d)=>{!d.width||!d.color||(i.save(),i.lineWidth=d.width,i.strokeStyle=d.color,i.setLineDash(d.borderDash||[]),i.lineDashOffset=d.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(c.x,c.y),i.stroke(),i.restore())};if(n.display)for(o=0,r=s.length;o<r;++o){const l=s[o];n.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),n.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:n,options:{border:i,grid:s}}=this,o=i.setContext(this.getContext()),r=i.display?o.width:0;if(!r)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let c,d,u,h;this.isHorizontal()?(c=He(t,this.left,r)-r/2,d=He(t,this.right,a)+a/2,u=h=l):(u=He(t,this.top,r)-r/2,h=He(t,this.bottom,a)+a/2,c=d=l),n.save(),n.lineWidth=o.width,n.strokeStyle=o.color,n.beginPath(),n.moveTo(c,u),n.lineTo(d,h),n.stroke(),n.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&oo(i,s);const o=this.getLabelItems(t);for(const r of o){const a=r.options,l=r.font,c=r.label,d=r.textOffset;Je(i,c,0,d,l,a)}s&&ro(i)}drawTitle(){const{ctx:t,options:{position:n,title:i,reverse:s}}=this;if(!i.display)return;const o=dt(i.font),r=wt(i.padding),a=i.align;let l=o.lineHeight/2;n==="bottom"||n==="center"||H(n)?(l+=r.bottom,et(i.text)&&(l+=o.lineHeight*(i.text.length-1))):l+=r.top;const{titleX:c,titleY:d,maxWidth:u,rotation:h}=fv(this,l,n,a);Je(t,i.text,0,0,o,{color:i.color,maxWidth:u,rotation:h,textAlign:hv(a,n,s),textBaseline:"middle",translation:[c,d]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,n=t.ticks&&t.ticks.z||0,i=P(t.grid&&t.grid.z,-1),s=P(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==tn.prototype.draw?[{z:n,draw:o=>{this.draw(o)}}]:[{z:i,draw:o=>{this.drawBackground(),this.drawGrid(o),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:n,draw:o=>{this.drawLabels(o)}}]}getMatchingVisibleMetas(t){const n=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let o,r;for(o=0,r=n.length;o<r;++o){const a=n[o];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const n=this.options.ticks.setContext(this.getContext(t));return dt(n.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class ns{constructor(t,n,i){this.type=t,this.scope=n,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const n=Object.getPrototypeOf(t);let i;mv(n)&&(i=this.register(n));const s=this.items,o=t.id,r=this.scope+"."+o;if(!o)throw new Error("class does not have id: "+t);return o in s||(s[o]=t,gv(t,r,i),this.override&&nt.override(t.id,t.overrides)),r}get(t){return this.items[t]}unregister(t){const n=this.items,i=t.id,s=this.scope;i in n&&delete n[i],s&&i in nt[s]&&(delete nt[s][i],this.override&&delete Ke[i])}}function gv(e,t,n){const i=yi(Object.create(null),[n?nt.get(n):{},nt.get(t),e.defaults]);nt.set(t,i),e.defaultRoutes&&pv(t,e.defaultRoutes),e.descriptors&&nt.describe(t,e.descriptors)}function pv(e,t){Object.keys(t).forEach(n=>{const i=n.split("."),s=i.pop(),o=[e].concat(i).join("."),r=t[n].split("."),a=r.pop(),l=r.join(".");nt.route(o,s,l,a)})}function mv(e){return"id"in e&&"defaults"in e}class bv{constructor(){this.controllers=new ns(Vt,"datasets",!0),this.elements=new ns(Ut,"elements"),this.plugins=new ns(Object,"plugins"),this.scales=new ns(tn,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,n,i){[...n].forEach(s=>{const o=i||this._getRegistryForType(s);i||o.isForType(s)||o===this.plugins&&s.id?this._exec(t,o,s):q(s,r=>{const a=i||this._getRegistryForType(r);this._exec(t,a,r)})})}_exec(t,n,i){const s=Jr(t);Z(i["before"+s],[],i),n[t](i),Z(i["after"+s],[],i)}_getRegistryForType(t){for(let n=0;n<this._typedRegistries.length;n++){const i=this._typedRegistries[n];if(i.isForType(t))return i}return this.plugins}_get(t,n,i){const s=n.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var Yt=new bv;class yv{constructor(){this._init=void 0}notify(t,n,i,s){if(n==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const o=s?this._descriptors(t).filter(s):this._descriptors(t),r=this._notify(o,t,n,i);return n==="afterDestroy"&&(this._notify(o,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),r}_notify(t,n,i,s){s=s||{};for(const o of t){const r=o.plugin,a=r[i],l=[n,s,o.options];if(Z(a,l,r)===!1&&s.cancelable)return!1}return!0}invalidate(){N(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const n=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),n}_createDescriptors(t,n){const i=t&&t.config,s=P(i.options&&i.options.plugins,{}),o=vv(i);return s===!1&&!n?[]:_v(t,o,s,n)}_notifyStateChanges(t){const n=this._oldCache||[],i=this._cache,s=(o,r)=>o.filter(a=>!r.some(l=>a.plugin.id===l.plugin.id));this._notify(s(n,i),t,"stop"),this._notify(s(i,n),t,"start")}}function vv(e){const t={},n=[],i=Object.keys(Yt.plugins.items);for(let o=0;o<i.length;o++)n.push(Yt.getPlugin(i[o]));const s=e.plugins||[];for(let o=0;o<s.length;o++){const r=s[o];n.indexOf(r)===-1&&(n.push(r),t[r.id]=!0)}return{plugins:n,localIds:t}}function xv(e,t){return!t&&e===!1?null:e===!0?{}:e}function _v(e,{plugins:t,localIds:n},i,s){const o=[],r=e.getContext();for(const a of t){const l=a.id,c=xv(i[l],s);c!==null&&o.push({plugin:a,options:wv(e.config,{plugin:a,local:n[l]},c,r)})}return o}function wv(e,{plugin:t,local:n},i,s){const o=e.pluginScopeKeys(t),r=e.getOptionScopes(i,o);return n&&t.defaults&&r.push(t.defaults),e.createResolver(r,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function br(e,t){const n=nt.datasets[e]||{};return((t.datasets||{})[e]||{}).indexAxis||t.indexAxis||n.indexAxis||"x"}function kv(e,t){let n=e;return e==="_index_"?n=t:e==="_value_"&&(n=t==="x"?"y":"x"),n}function Sv(e,t){return e===t?"_index_":"_value_"}function Gl(e){if(e==="x"||e==="y"||e==="r")return e}function Ev(e){if(e==="top"||e==="bottom")return"x";if(e==="left"||e==="right")return"y"}function yr(e,...t){if(Gl(e))return e;for(const n of t){const i=n.axis||Ev(n.position)||e.length>1&&Gl(e[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${e}' axis. Please provide 'axis' or 'position' option.`)}function Xl(e,t,n){if(n[t+"AxisID"]===e)return{axis:t}}function Iv(e,t){if(t.data&&t.data.datasets){const n=t.data.datasets.filter(i=>i.xAxisID===e||i.yAxisID===e);if(n.length)return Xl(e,"x",n[0])||Xl(e,"y",n[0])}return{}}function Dv(e,t){const n=Ke[e.type]||{scales:{}},i=t.scales||{},s=br(e.type,t),o=Object.create(null);return Object.keys(i).forEach(r=>{const a=i[r];if(!H(a))return console.error(`Invalid scale configuration for scale: ${r}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${r}`);const l=yr(r,a,Iv(r,e),nt.scales[a.type]),c=Sv(l,s),d=n.scales||{};o[r]=ai(Object.create(null),[{axis:l},a,d[l],d[c]])}),e.data.datasets.forEach(r=>{const a=r.type||e.type,l=r.indexAxis||br(a,t),d=(Ke[a]||{}).scales||{};Object.keys(d).forEach(u=>{const h=kv(u,l),f=r[h+"AxisID"]||h;o[f]=o[f]||Object.create(null),ai(o[f],[{axis:h},i[f],d[u]])})}),Object.keys(o).forEach(r=>{const a=o[r];ai(a,[nt.scales[a.type],nt.scale])}),o}function Du(e){const t=e.options||(e.options={});t.plugins=P(t.plugins,{}),t.scales=Dv(e,t)}function Tu(e){return e=e||{},e.datasets=e.datasets||[],e.labels=e.labels||[],e}function Tv(e){return e=e||{},e.data=Tu(e.data),Du(e),e}const Kl=new Map,Mu=new Set;function is(e,t){let n=Kl.get(e);return n||(n=t(),Kl.set(e,n),Mu.add(n)),n}const Rn=(e,t,n)=>{const i=Me(t,n);i!==void 0&&e.add(i)};class Mv{constructor(t){this._config=Tv(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=Tu(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),Du(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return is(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,n){return is(`${t}.transition.${n}`,()=>[[`datasets.${t}.transitions.${n}`,`transitions.${n}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,n){return is(`${t}-${n}`,()=>[[`datasets.${t}.elements.${n}`,`datasets.${t}`,`elements.${n}`,""]])}pluginScopeKeys(t){const n=t.id,i=this.type;return is(`${i}-plugin-${n}`,()=>[[`plugins.${n}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,n){const i=this._scopeCache;let s=i.get(t);return(!s||n)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,n,i){const{options:s,type:o}=this,r=this._cachedScopes(t,i),a=r.get(n);if(a)return a;const l=new Set;n.forEach(d=>{t&&(l.add(t),d.forEach(u=>Rn(l,t,u))),d.forEach(u=>Rn(l,s,u)),d.forEach(u=>Rn(l,Ke[o]||{},u)),d.forEach(u=>Rn(l,nt,u)),d.forEach(u=>Rn(l,gr,u))});const c=Array.from(l);return c.length===0&&c.push(Object.create(null)),Mu.has(n)&&r.set(n,c),c}chartOptionScopes(){const{options:t,type:n}=this;return[t,Ke[n]||{},nt.datasets[n]||{},{type:n},nt,gr]}resolveNamedOptions(t,n,i,s=[""]){const o={$shared:!0},{resolver:r,subPrefixes:a}=Jl(this._resolverCache,t,s);let l=r;if(Av(r,n)){o.$shared=!1,i=Ce(i)?i():i;const c=this.createResolver(t,i,a);l=xn(r,i,c)}for(const c of n)o[c]=l[c];return o}createResolver(t,n,i=[""],s){const{resolver:o}=Jl(this._resolverCache,t,i);return H(n)?xn(o,n,void 0,s):o}}function Jl(e,t,n){let i=e.get(t);i||(i=new Map,e.set(t,i));const s=n.join();let o=i.get(s);return o||(o={resolver:ia(t,n),subPrefixes:n.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,o)),o}const Cv=e=>H(e)&&Object.getOwnPropertyNames(e).some(t=>Ce(e[t]));function Av(e,t){const{isScriptable:n,isIndexable:i}=au(e);for(const s of t){const o=n(s),r=i(s),a=(r||o)&&e[s];if(o&&(Ce(a)||Cv(a))||r&&et(a))return!0}return!1}var Lv="4.5.1";const Ov=["top","bottom","left","right","chartArea"];function Zl(e,t){return e==="top"||e==="bottom"||Ov.indexOf(e)===-1&&t==="x"}function Ql(e,t){return function(n,i){return n[e]===i[e]?n[t]-i[t]:n[e]-i[e]}}function tc(e){const t=e.chart,n=t.options.animation;t.notifyPlugins("afterRender"),Z(n&&n.onComplete,[e],t)}function Pv(e){const t=e.chart,n=t.options.animation;Z(n&&n.onProgress,[e],t)}function Cu(e){return ra()&&typeof e=="string"?e=document.getElementById(e):e&&e.length&&(e=e[0]),e&&e.canvas&&(e=e.canvas),e}const Is={},ec=e=>{const t=Cu(e);return Object.values(Is).filter(n=>n.canvas===t).pop()};function Rv(e,t,n){const i=Object.keys(e);for(const s of i){const o=+s;if(o>=t){const r=e[s];delete e[s],(n>0||o>t)&&(e[o+n]=r)}}}function Bv(e,t,n,i){return!n||e.type==="mouseout"?null:i?t:e}class se{static register(...t){Yt.add(...t),nc()}static unregister(...t){Yt.remove(...t),nc()}constructor(t,n){const i=this.config=new Mv(n),s=Cu(t),o=ec(s);if(o)throw new Error("Canvas is already in use. Chart with ID '"+o.id+"' must be destroyed before the canvas with ID '"+o.canvas.id+"' can be reused.");const r=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||tv(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,r.aspectRatio),l=a&&a.canvas,c=l&&l.height,d=l&&l.width;if(this.id=Nb(),this.ctx=a,this.canvas=l,this.width=d,this.height=c,this._options=r,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new yv,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=t0(u=>this.update(u),r.resizeDelay||0),this._dataChanges=[],Is[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}te.listen(this,"complete",tc),te.listen(this,"progress",Pv),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:n},width:i,height:s,_aspectRatio:o}=this;return N(t)?n&&o?o:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return Yt}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Sl(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return _l(this.canvas,this.ctx),this}stop(){return te.stop(this),this}resize(t,n){te.running(this)?this._resizeBeforeDraw={width:t,height:n}:this._resize(t,n)}_resize(t,n){const i=this.options,s=this.canvas,o=i.maintainAspectRatio&&this.aspectRatio,r=this.platform.getMaximumSize(s,t,n,o),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=r.width,this.height=r.height,this._aspectRatio=this.aspectRatio,Sl(this,a,!0)&&(this.notifyPlugins("resize",{size:r}),Z(i.onResize,[this,r],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const n=this.options.scales||{};q(n,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,n=t.scales,i=this.scales,s=Object.keys(i).reduce((r,a)=>(r[a]=!1,r),{});let o=[];n&&(o=o.concat(Object.keys(n).map(r=>{const a=n[r],l=yr(r,a),c=l==="r",d=l==="x";return{options:a,dposition:c?"chartArea":d?"bottom":"left",dtype:c?"radialLinear":d?"category":"linear"}}))),q(o,r=>{const a=r.options,l=a.id,c=yr(l,a),d=P(a.type,r.dtype);(a.position===void 0||Zl(a.position,c)!==Zl(r.dposition))&&(a.position=r.dposition),s[l]=!0;let u=null;if(l in i&&i[l].type===d)u=i[l];else{const h=Yt.getScale(d);u=new h({id:l,type:d,ctx:this.ctx,chart:this}),i[u.id]=u}u.init(a,t)}),q(s,(r,a)=>{r||delete i[a]}),q(i,r=>{_t.configure(this,r,r.options),_t.addBox(this,r)})}_updateMetasets(){const t=this._metasets,n=this.data.datasets.length,i=t.length;if(t.sort((s,o)=>s.index-o.index),i>n){for(let s=n;s<i;++s)this._destroyDatasetMeta(s);t.splice(n,i-n)}this._sortedMetasets=t.slice(0).sort(Ql("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:n}}=this;t.length>n.length&&delete this._stacks,t.forEach((i,s)=>{n.filter(o=>o===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],n=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=n.length;i<s;i++){const o=n[i];let r=this.getDatasetMeta(i);const a=o.type||this.config.type;if(r.type&&r.type!==a&&(this._destroyDatasetMeta(i),r=this.getDatasetMeta(i)),r.type=a,r.indexAxis=o.indexAxis||br(a,this.options),r.order=o.order||0,r.index=i,r.label=""+o.label,r.visible=this.isDatasetVisible(i),r.controller)r.controller.updateIndex(i),r.controller.linkScales();else{const l=Yt.getController(a),{datasetElementType:c,dataElementType:d}=nt.datasets[a];Object.assign(l,{dataElementType:Yt.getElement(d),datasetElementType:c&&Yt.getElement(c)}),r.controller=new l(this,i),t.push(r.controller)}}return this._updateMetasets(),t}_resetElements(){q(this.data.datasets,(t,n)=>{this.getDatasetMeta(n).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const n=this.config;n.update();const i=this._options=n.createResolver(n.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const o=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let r=0;for(let c=0,d=this.data.datasets.length;c<d;c++){const{controller:u}=this.getDatasetMeta(c),h=!s&&o.indexOf(u)===-1;u.buildOrUpdateElements(h),r=Math.max(+u.getMaxOverflow(),r)}r=this._minPadding=i.layout.autoPadding?r:0,this._updateLayout(r),s||q(o,c=>{c.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(Ql("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){q(this.scales,t=>{_t.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,n=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!hl(n,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,n=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:o}of n){const r=i==="_removeElements"?-o:o;Rv(t,s,r)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const n=this.data.datasets.length,i=o=>new Set(t.filter(r=>r[0]===o).map((r,a)=>a+","+r.splice(1).join(","))),s=i(0);for(let o=1;o<n;o++)if(!hl(s,i(o)))return;return Array.from(s).map(o=>o.split(",")).map(o=>({method:o[1],start:+o[2],count:+o[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;_t.update(this,this.width,this.height,t);const n=this.chartArea,i=n.width<=0||n.height<=0;this._layers=[],q(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,o)=>{s._idx=o}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let n=0,i=this.data.datasets.length;n<i;++n)this.getDatasetMeta(n).controller.configure();for(let n=0,i=this.data.datasets.length;n<i;++n)this._updateDataset(n,Ce(t)?t({datasetIndex:n}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,n){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:n,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(n),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(te.has(this)?this.attached&&!te.running(this)&&te.start(this):(this.draw(),tc({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const n=this._layers;for(t=0;t<n.length&&n[t].z<=0;++t)n[t].draw(this.chartArea);for(this._drawDatasets();t<n.length;++t)n[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const n=this._sortedMetasets,i=[];let s,o;for(s=0,o=n.length;s<o;++s){const r=n[s];(!t||r.visible)&&i.push(r)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let n=t.length-1;n>=0;--n)this._drawDataset(t[n]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const n=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=yu(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&oo(n,s),t.controller.draw(),s&&ro(n),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return ae(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,n,i,s){const o=Oy.modes[n];return typeof o=="function"?o(this,t,i,s):[]}getDatasetMeta(t){const n=this.data.datasets[t],i=this._metasets;let s=i.filter(o=>o&&o._dataset===n).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:n&&n.order||0,index:t,_dataset:n,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=Ae(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const n=this.data.datasets[t];if(!n)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!n.hidden}setDatasetVisibility(t,n){const i=this.getDatasetMeta(t);i.hidden=!n}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,n,i){const s=i?"show":"hide",o=this.getDatasetMeta(t),r=o.controller._resolveAnimations(void 0,s);vi(n)?(o.data[n].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),r.update(o,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,n){this._updateVisibility(t,n,!1)}show(t,n){this._updateVisibility(t,n,!0)}_destroyDatasetMeta(t){const n=this._metasets[t];n&&n.controller&&n.controller._destroy(),delete this._metasets[t]}_stop(){let t,n;for(this.stop(),te.remove(this),t=0,n=this.data.datasets.length;t<n;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:n}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),_l(t,n),this.platform.releaseContext(n),this.canvas=null,this.ctx=null),delete Is[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,n=this.platform,i=(o,r)=>{n.addEventListener(this,o,r),t[o]=r},s=(o,r,a)=>{o.offsetX=r,o.offsetY=a,this._eventHandler(o)};q(this.options.events,o=>i(o,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,n=this.platform,i=(l,c)=>{n.addEventListener(this,l,c),t[l]=c},s=(l,c)=>{t[l]&&(n.removeEventListener(this,l,c),delete t[l])},o=(l,c)=>{this.canvas&&this.resize(l,c)};let r;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",o),i("detach",r)};r=()=>{this.attached=!1,s("resize",o),this._stop(),this._resize(0,0),i("attach",a)},n.isAttached(this.canvas)?a():r()}unbindEvents(){q(this._listeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._listeners={},q(this._responsiveListeners,(t,n)=>{this.platform.removeEventListener(this,n,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,n,i){const s=i?"set":"remove";let o,r,a,l;for(n==="dataset"&&(o=this.getDatasetMeta(t[0].datasetIndex),o.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){r=t[a];const c=r&&this.getDatasetMeta(r.datasetIndex).controller;c&&c[s+"HoverStyle"](r.element,r.datasetIndex,r.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const n=this._active||[],i=t.map(({datasetIndex:o,index:r})=>{const a=this.getDatasetMeta(o);if(!a)throw new Error("No dataset found at index "+o);return{datasetIndex:o,element:a.data[r],index:r}});!Ws(i,n)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,n))}notifyPlugins(t,n,i){return this._plugins.notify(this,t,n,i)}isPluginEnabled(t){return this._plugins._cache.filter(n=>n.plugin.id===t).length===1}_updateHoverStyles(t,n,i){const s=this.options.hover,o=(l,c)=>l.filter(d=>!c.some(u=>d.datasetIndex===u.datasetIndex&&d.index===u.index)),r=o(n,t),a=i?t:o(t,n);r.length&&this.updateHoverStyle(r,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,n){const i={event:t,replay:n,cancelable:!0,inChartArea:this.isPointInArea(t)},s=r=>(r.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const o=this._handleEvent(t,n,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(o||i.changed)&&this.render(),this}_handleEvent(t,n,i){const{_active:s=[],options:o}=this,r=n,a=this._getActiveElements(t,s,i,r),l=Vb(t),c=Bv(t,this._lastEvent,i,l);i&&(this._lastEvent=null,Z(o.onHover,[t,a,this],this),l&&Z(o.onClick,[t,a,this],this));const d=!Ws(a,s);return(d||n)&&(this._active=a,this._updateHoverStyles(a,s,n)),this._lastEvent=c,d}_getActiveElements(t,n,i,s){if(t.type==="mouseout")return[];if(!i)return n;const o=this.options.hover;return this.getElementsAtEventForMode(t,o.mode,o,s)}}I(se,"defaults",nt),I(se,"instances",Is),I(se,"overrides",Ke),I(se,"registry",Yt),I(se,"version",Lv),I(se,"getChart",ec);function nc(){return q(se.instances,e=>e._plugins.invalidate())}function Nv(e,t,n){const{startAngle:i,x:s,y:o,outerRadius:r,innerRadius:a,options:l}=t,{borderWidth:c,borderJoinStyle:d}=l,u=Math.min(c/r,xt(i-n));if(e.beginPath(),e.arc(s,o,r-c/2,i+u/2,n-u/2),a>0){const h=Math.min(c/a,xt(i-n));e.arc(s,o,a+c/2,n-h/2,i+h/2,!0)}else{const h=Math.min(c/2,r*xt(i-n));if(d==="round")e.arc(s,o,h,n-U/2,i+U/2,!0);else if(d==="bevel"){const f=2*h*h,g=-f*Math.cos(n+U/2)+s,p=-f*Math.sin(n+U/2)+o,m=f*Math.cos(i+U/2)+s,b=f*Math.sin(i+U/2)+o;e.lineTo(g,p),e.lineTo(m,b)}}e.closePath(),e.moveTo(0,0),e.rect(0,0,e.canvas.width,e.canvas.height),e.clip("evenodd")}function Fv(e,t,n){const{startAngle:i,pixelMargin:s,x:o,y:r,outerRadius:a,innerRadius:l}=t;let c=s/a;e.beginPath(),e.arc(o,r,a,i-c,n+c),l>s?(c=s/l,e.arc(o,r,l,n+c,i-c,!0)):e.arc(o,r,s,n+at,i-at),e.closePath(),e.clip()}function Hv(e){return na(e,["outerStart","outerEnd","innerStart","innerEnd"])}function $v(e,t,n,i){const s=Hv(e.options.borderRadius),o=(n-t)/2,r=Math.min(o,i*t/2),a=l=>{const c=(n-Math.min(o,l))*i/2;return gt(l,0,Math.min(o,c))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:gt(s.innerStart,0,r),innerEnd:gt(s.innerEnd,0,r)}}function rn(e,t,n,i){return{x:n+e*Math.cos(t),y:i+e*Math.sin(t)}}function Js(e,t,n,i,s,o){const{x:r,y:a,startAngle:l,pixelMargin:c,innerRadius:d}=t,u=Math.max(t.outerRadius+i+n-c,0),h=d>0?d+i+n+c:0;let f=0;const g=s-l;if(i){const z=d>0?d-i:0,j=u>0?u-i:0,J=(z+j)/2,pt=J!==0?g*J/(J+i):g;f=(g-pt)/2}const p=Math.max(.001,g*u-n/U)/u,m=(g-p)/2,b=l+m+f,y=s-m-f,{outerStart:x,outerEnd:_,innerStart:v,innerEnd:w}=$v(t,h,u,y-b),k=u-x,S=u-_,D=b+x/k,A=y-_/S,T=h+v,R=h+w,G=b+v/T,rt=y-w/R;if(e.beginPath(),o){const z=(D+A)/2;if(e.arc(r,a,u,D,z),e.arc(r,a,u,z,A),_>0){const ut=rn(S,A,r,a);e.arc(ut.x,ut.y,_,A,y+at)}const j=rn(R,y,r,a);if(e.lineTo(j.x,j.y),w>0){const ut=rn(R,rt,r,a);e.arc(ut.x,ut.y,w,y+at,rt+Math.PI)}const J=(y-w/h+(b+v/h))/2;if(e.arc(r,a,h,y-w/h,J,!0),e.arc(r,a,h,J,b+v/h,!0),v>0){const ut=rn(T,G,r,a);e.arc(ut.x,ut.y,v,G+Math.PI,b-at)}const pt=rn(k,b,r,a);if(e.lineTo(pt.x,pt.y),x>0){const ut=rn(k,D,r,a);e.arc(ut.x,ut.y,x,b-at,D)}}else{e.moveTo(r,a);const z=Math.cos(D)*u+r,j=Math.sin(D)*u+a;e.lineTo(z,j);const J=Math.cos(A)*u+r,pt=Math.sin(A)*u+a;e.lineTo(J,pt)}e.closePath()}function zv(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a}=t;let l=t.endAngle;if(o){Js(e,t,n,i,l,s);for(let c=0;c<o;++c)e.fill();isNaN(a)||(l=r+(a%Q||Q))}return Js(e,t,n,i,l,s),e.fill(),l}function jv(e,t,n,i,s){const{fullCircles:o,startAngle:r,circumference:a,options:l}=t,{borderWidth:c,borderJoinStyle:d,borderDash:u,borderDashOffset:h,borderRadius:f}=l,g=l.borderAlign==="inner";if(!c)return;e.setLineDash(u||[]),e.lineDashOffset=h,g?(e.lineWidth=c*2,e.lineJoin=d||"round"):(e.lineWidth=c,e.lineJoin=d||"bevel");let p=t.endAngle;if(o){Js(e,t,n,i,p,s);for(let m=0;m<o;++m)e.stroke();isNaN(a)||(p=r+(a%Q||Q))}g&&Fv(e,t,p),l.selfJoin&&p-r>=U&&f===0&&d!=="miter"&&Nv(e,t,p),o||(Js(e,t,n,i,p,s),e.stroke())}class Wn extends Ut{constructor(n){super();I(this,"circumference");I(this,"endAngle");I(this,"fullCircles");I(this,"innerRadius");I(this,"outerRadius");I(this,"pixelMargin");I(this,"startAngle");this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.getProps(["x","y"],s),{angle:r,distance:a}=Jd(o,{x:n,y:i}),{startAngle:l,endAngle:c,innerRadius:d,outerRadius:u,circumference:h}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],s),f=(this.options.spacing+this.options.borderWidth)/2,g=P(h,c-l),p=xi(r,l,c)&&l!==c,m=g>=Q||p,b=oe(a,d+f,u+f);return m&&b}getCenterPoint(n){const{x:i,y:s,startAngle:o,endAngle:r,innerRadius:a,outerRadius:l}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],n),{offset:c,spacing:d}=this.options,u=(o+r)/2,h=(a+l+d+c)/2;return{x:i+Math.cos(u)*h,y:s+Math.sin(u)*h}}tooltipPosition(n){return this.getCenterPoint(n)}draw(n){const{options:i,circumference:s}=this,o=(i.offset||0)/4,r=(i.spacing||0)/2,a=i.circular;if(this.pixelMargin=i.borderAlign==="inner"?.33:0,this.fullCircles=s>Q?Math.floor(s/Q):0,s===0||this.innerRadius<0||this.outerRadius<0)return;n.save();const l=(this.startAngle+this.endAngle)/2;n.translate(Math.cos(l)*o,Math.sin(l)*o);const c=1-Math.sin(Math.min(U,s||0)),d=o*c;n.fillStyle=i.backgroundColor,n.strokeStyle=i.borderColor,zv(n,this,d,r,a),jv(n,this,d,r,a),n.restore()}}I(Wn,"id","arc"),I(Wn,"defaults",{borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1}),I(Wn,"defaultRoutes",{backgroundColor:"backgroundColor"}),I(Wn,"descriptors",{_scriptable:!0,_indexable:n=>n!=="borderDash"});function Au(e,t,n=t){e.lineCap=P(n.borderCapStyle,t.borderCapStyle),e.setLineDash(P(n.borderDash,t.borderDash)),e.lineDashOffset=P(n.borderDashOffset,t.borderDashOffset),e.lineJoin=P(n.borderJoinStyle,t.borderJoinStyle),e.lineWidth=P(n.borderWidth,t.borderWidth),e.strokeStyle=P(n.borderColor,t.borderColor)}function Vv(e,t,n){e.lineTo(n.x,n.y)}function Uv(e){return e.stepped?h0:e.tension||e.cubicInterpolationMode==="monotone"?f0:Vv}function Lu(e,t,n={}){const i=e.length,{start:s=0,end:o=i-1}=n,{start:r,end:a}=t,l=Math.max(s,r),c=Math.min(o,a),d=s<r&&o<r||s>a&&o>a;return{count:i,start:l,loop:t.loop,ilen:c<l&&!d?i+c-l:c-l}}function Wv(e,t,n,i){const{points:s,options:o}=t,{count:r,start:a,loop:l,ilen:c}=Lu(s,n,i),d=Uv(o);let{move:u=!0,reverse:h}=i||{},f,g,p;for(f=0;f<=c;++f)g=s[(a+(h?c-f:f))%r],!g.skip&&(u?(e.moveTo(g.x,g.y),u=!1):d(e,p,g,h,o.stepped),p=g);return l&&(g=s[(a+(h?c:0))%r],d(e,p,g,h,o.stepped)),!!l}function Yv(e,t,n,i){const s=t.points,{count:o,start:r,ilen:a}=Lu(s,n,i),{move:l=!0,reverse:c}=i||{};let d=0,u=0,h,f,g,p,m,b;const y=_=>(r+(c?a-_:_))%o,x=()=>{p!==m&&(e.lineTo(d,m),e.lineTo(d,p),e.lineTo(d,b))};for(l&&(f=s[y(0)],e.moveTo(f.x,f.y)),h=0;h<=a;++h){if(f=s[y(h)],f.skip)continue;const _=f.x,v=f.y,w=_|0;w===g?(v<p?p=v:v>m&&(m=v),d=(u*d+_)/++u):(x(),e.lineTo(_,v),g=w,u=0,p=m=v),b=v}x()}function vr(e){const t=e.options,n=t.borderDash&&t.borderDash.length;return!e._decimated&&!e._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!n?Yv:Wv}function qv(e){return e.stepped?W0:e.tension||e.cubicInterpolationMode==="monotone"?Y0:Ue}function Gv(e,t,n,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,n,i)&&s.closePath()),Au(e,t.options),e.stroke(s)}function Xv(e,t,n,i){const{segments:s,options:o}=t,r=vr(t);for(const a of s)Au(e,o,a.style),e.beginPath(),r(e,t,a,{start:n,end:n+i-1})&&e.closePath(),e.stroke()}const Kv=typeof Path2D=="function";function Jv(e,t,n,i){Kv&&!t.options.segment?Gv(e,t,n,i):Xv(e,t,n,i)}class Ee extends Ut{constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,n){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;N0(this._points,i,t,s,n),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=Z0(this,this.options.segment))}first(){const t=this.segments,n=this.points;return t.length&&n[t[0].start]}last(){const t=this.segments,n=this.points,i=t.length;return i&&n[t[i-1].end]}interpolate(t,n){const i=this.options,s=t[n],o=this.points,r=bu(this,{property:n,start:s,end:s});if(!r.length)return;const a=[],l=qv(i);let c,d;for(c=0,d=r.length;c<d;++c){const{start:u,end:h}=r[c],f=o[u],g=o[h];if(f===g){a.push(f);continue}const p=Math.abs((s-f[n])/(g[n]-f[n])),m=l(f,g,p,i.stepped);m[n]=t[n],a.push(m)}return a.length===1?a[0]:a}pathSegment(t,n,i){return vr(this)(t,this,n,i)}path(t,n,i){const s=this.segments,o=vr(this);let r=this._loop;n=n||0,i=i||this.points.length-n;for(const a of s)r&=o(t,this,a,{start:n,end:n+i-1});return!!r}draw(t,n,i,s){const o=this.options||{};(this.points||[]).length&&o.borderWidth&&(t.save(),Jv(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}I(Ee,"id","line"),I(Ee,"defaults",{borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0}),I(Ee,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"}),I(Ee,"descriptors",{_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"});function ic(e,t,n,i){const s=e.options,{[n]:o}=e.getProps([n],i);return Math.abs(t-o)<s.radius+s.hitRadius}class Ds extends Ut{constructor(n){super();I(this,"parsed");I(this,"skip");I(this,"stop");this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,n&&Object.assign(this,n)}inRange(n,i,s){const o=this.options,{x:r,y:a}=this.getProps(["x","y"],s);return Math.pow(n-r,2)+Math.pow(i-a,2)<Math.pow(o.hitRadius+o.radius,2)}inXRange(n,i){return ic(this,n,"x",i)}inYRange(n,i){return ic(this,n,"y",i)}getCenterPoint(n){const{x:i,y:s}=this.getProps(["x","y"],n);return{x:i,y:s}}size(n){n=n||this.options||{};let i=n.radius||0;i=Math.max(i,i&&n.hoverRadius||0);const s=i&&n.borderWidth||0;return(i+s)*2}draw(n,i){const s=this.options;this.skip||s.radius<.1||!ae(this,i,this.size(s)/2)||(n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.fillStyle=s.backgroundColor,pr(n,s,this.x,this.y))}getRange(){const n=this.options||{};return n.radius+n.hitRadius}}I(Ds,"id","point"),I(Ds,"defaults",{borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0}),I(Ds,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});function Ou(e,t){const{x:n,y:i,base:s,width:o,height:r}=e.getProps(["x","y","base","width","height"],t);let a,l,c,d,u;return e.horizontal?(u=r/2,a=Math.min(n,s),l=Math.max(n,s),c=i-u,d=i+u):(u=o/2,a=n-u,l=n+u,c=Math.min(i,s),d=Math.max(i,s)),{left:a,top:c,right:l,bottom:d}}function Ie(e,t,n,i){return e?0:gt(t,n,i)}function Zv(e,t,n){const i=e.options.borderWidth,s=e.borderSkipped,o=ru(i);return{t:Ie(s.top,o.top,0,n),r:Ie(s.right,o.right,0,t),b:Ie(s.bottom,o.bottom,0,n),l:Ie(s.left,o.left,0,t)}}function Qv(e,t,n){const{enableBorderRadius:i}=e.getProps(["enableBorderRadius"]),s=e.options.borderRadius,o=Ge(s),r=Math.min(t,n),a=e.borderSkipped,l=i||H(s);return{topLeft:Ie(!l||a.top||a.left,o.topLeft,0,r),topRight:Ie(!l||a.top||a.right,o.topRight,0,r),bottomLeft:Ie(!l||a.bottom||a.left,o.bottomLeft,0,r),bottomRight:Ie(!l||a.bottom||a.right,o.bottomRight,0,r)}}function tx(e){const t=Ou(e),n=t.right-t.left,i=t.bottom-t.top,s=Zv(e,n/2,i/2),o=Qv(e,n/2,i/2);return{outer:{x:t.left,y:t.top,w:n,h:i,radius:o},inner:{x:t.left+s.l,y:t.top+s.t,w:n-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,o.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,o.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,o.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,o.bottomRight-Math.max(s.b,s.r))}}}}function Uo(e,t,n,i){const s=t===null,o=n===null,a=e&&!(s&&o)&&Ou(e,i);return a&&(s||oe(t,a.left,a.right))&&(o||oe(n,a.top,a.bottom))}function ex(e){return e.topLeft||e.topRight||e.bottomLeft||e.bottomRight}function nx(e,t){e.rect(t.x,t.y,t.w,t.h)}function Wo(e,t,n={}){const i=e.x!==n.x?-t:0,s=e.y!==n.y?-t:0,o=(e.x+e.w!==n.x+n.w?t:0)-i,r=(e.y+e.h!==n.y+n.h?t:0)-s;return{x:e.x+i,y:e.y+s,w:e.w+o,h:e.h+r,radius:e.radius}}class Ts extends Ut{constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:n,options:{borderColor:i,backgroundColor:s}}=this,{inner:o,outer:r}=tx(this),a=ex(r.radius)?_i:nx;t.save(),(r.w!==o.w||r.h!==o.h)&&(t.beginPath(),a(t,Wo(r,n,o)),t.clip(),a(t,Wo(o,-n,r)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Wo(o,n)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,n,i){return Uo(this,t,n,i)}inXRange(t,n){return Uo(this,t,null,n)}inYRange(t,n){return Uo(this,null,t,n)}getCenterPoint(t){const{x:n,y:i,base:s,horizontal:o}=this.getProps(["x","y","base","horizontal"],t);return{x:o?(n+s)/2:n,y:o?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}I(Ts,"id","bar"),I(Ts,"defaults",{borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0}),I(Ts,"defaultRoutes",{backgroundColor:"backgroundColor",borderColor:"borderColor"});var ix=Object.freeze({__proto__:null,ArcElement:Wn,BarElement:Ts,LineElement:Ee,PointElement:Ds});const xr=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],sc=xr.map(e=>e.replace("rgb(","rgba(").replace(")",", 0.5)"));function Pu(e){return xr[e%xr.length]}function Ru(e){return sc[e%sc.length]}function sx(e,t){return e.borderColor=Pu(t),e.backgroundColor=Ru(t),++t}function ox(e,t){return e.backgroundColor=e.data.map(()=>Pu(t++)),t}function rx(e,t){return e.backgroundColor=e.data.map(()=>Ru(t++)),t}function ax(e){let t=0;return(n,i)=>{const s=e.getDatasetMeta(i).controller;s instanceof Ye?t=ox(n,t):s instanceof ui?t=rx(n,t):s&&(t=sx(n,t))}}function oc(e){let t;for(t in e)if(e[t].borderColor||e[t].backgroundColor)return!0;return!1}function lx(e){return e&&(e.borderColor||e.backgroundColor)}function cx(){return nt.borderColor!=="rgba(0,0,0,0.1)"||nt.backgroundColor!=="rgba(0,0,0,0.1)"}var dx={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(e,t,n){if(!n.enabled)return;const{data:{datasets:i},options:s}=e.config,{elements:o}=s,r=oc(i)||lx(s)||o&&oc(o)||cx();if(!n.forceOverride&&r)return;const a=ax(e);i.forEach(a)}};function ux(e,t,n,i,s){const o=s.samples||i;if(o>=n)return e.slice(t,t+n);const r=[],a=(n-2)/(o-2);let l=0;const c=t+n-1;let d=t,u,h,f,g,p;for(r[l++]=e[d],u=0;u<o-2;u++){let m=0,b=0,y;const x=Math.floor((u+1)*a)+1+t,_=Math.min(Math.floor((u+2)*a)+1,n)+t,v=_-x;for(y=x;y<_;y++)m+=e[y].x,b+=e[y].y;m/=v,b/=v;const w=Math.floor(u*a)+1+t,k=Math.min(Math.floor((u+1)*a)+1,n)+t,{x:S,y:D}=e[d];for(f=g=-1,y=w;y<k;y++)g=.5*Math.abs((S-m)*(e[y].y-D)-(S-e[y].x)*(b-D)),g>f&&(f=g,h=e[y],p=y);r[l++]=h,d=p}return r[l++]=e[c],r}function hx(e,t,n,i){let s=0,o=0,r,a,l,c,d,u,h,f,g,p;const m=[],b=t+n-1,y=e[t].x,_=e[b].x-y;for(r=t;r<t+n;++r){a=e[r],l=(a.x-y)/_*i,c=a.y;const v=l|0;if(v===d)c<g?(g=c,u=r):c>p&&(p=c,h=r),s=(o*s+a.x)/++o;else{const w=r-1;if(!N(u)&&!N(h)){const k=Math.min(u,h),S=Math.max(u,h);k!==f&&k!==w&&m.push({...e[k],x:s}),S!==f&&S!==w&&m.push({...e[S],x:s})}r>0&&w!==f&&m.push(e[w]),m.push(a),d=v,o=0,g=p=c,u=h=f=r}}return m}function Bu(e){if(e._decimated){const t=e._data;delete e._decimated,delete e._data,Object.defineProperty(e,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function rc(e){e.data.datasets.forEach(t=>{Bu(t)})}function fx(e,t){const n=t.length;let i=0,s;const{iScale:o}=e,{min:r,max:a,minDefined:l,maxDefined:c}=o.getUserBounds();return l&&(i=gt(re(t,o.axis,r).lo,0,n-1)),c?s=gt(re(t,o.axis,a).hi+1,i,n)-i:s=n-i,{start:i,count:s}}var gx={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(e,t,n)=>{if(!n.enabled){rc(e);return}const i=e.width;e.data.datasets.forEach((s,o)=>{const{_data:r,indexAxis:a}=s,l=e.getDatasetMeta(o),c=r||s.data;if(Vn([a,e.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const d=e.scales[l.xAxisID];if(d.type!=="linear"&&d.type!=="time"||e.options.parsing)return;let{start:u,count:h}=fx(l,c);const f=n.threshold||4*i;if(h<=f){Bu(s);return}N(r)&&(s._data=c,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(p){this._data=p}}));let g;switch(n.algorithm){case"lttb":g=ux(c,u,h,i,n);break;case"min-max":g=hx(c,u,h,i);break;default:throw new Error(`Unsupported decimation algorithm '${n.algorithm}'`)}s._decimated=g})},destroy(e){rc(e)}};function px(e,t,n){const i=e.segments,s=e.points,o=t.points,r=[];for(const a of i){let{start:l,end:c}=a;c=co(l,c,s);const d=_r(n,s[l],s[c],a.loop);if(!t.segments){r.push({source:a,target:d,start:s[l],end:s[c]});continue}const u=bu(t,d);for(const h of u){const f=_r(n,o[h.start],o[h.end],h.loop),g=mu(a,s,f);for(const p of g)r.push({source:p,target:h,start:{[n]:ac(d,f,"start",Math.max)},end:{[n]:ac(d,f,"end",Math.min)}})}}return r}function _r(e,t,n,i){if(i)return;let s=t[e],o=n[e];return e==="angle"&&(s=xt(s),o=xt(o)),{property:e,start:s,end:o}}function mx(e,t){const{x:n=null,y:i=null}=e||{},s=t.points,o=[];return t.segments.forEach(({start:r,end:a})=>{a=co(r,a,s);const l=s[r],c=s[a];i!==null?(o.push({x:l.x,y:i}),o.push({x:c.x,y:i})):n!==null&&(o.push({x:n,y:l.y}),o.push({x:n,y:c.y}))}),o}function co(e,t,n){for(;t>e;t--){const i=n[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function ac(e,t,n,i){return e&&t?i(e[n],t[n]):e?e[n]:t?t[n]:0}function Nu(e,t){let n=[],i=!1;return et(e)?(i=!0,n=e):n=mx(e,t),n.length?new Ee({points:n,options:{tension:0},_loop:i,_fullLoop:i}):null}function lc(e){return e&&e.fill!==!1}function bx(e,t,n){let s=e[t].fill;const o=[t];let r;if(!n)return s;for(;s!==!1&&o.indexOf(s)===-1;){if(!ot(s))return s;if(r=e[s],!r)return!1;if(r.visible)return s;o.push(s),s=r.fill}return!1}function yx(e,t,n){const i=wx(e);if(H(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return ot(s)&&Math.floor(s)===s?vx(i[0],t,s,n):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function vx(e,t,n,i){return(e==="-"||e==="+")&&(n=t+n),n===t||n<0||n>=i?!1:n}function xx(e,t){let n=null;return e==="start"?n=t.bottom:e==="end"?n=t.top:H(e)?n=t.getPixelForValue(e.value):t.getBasePixel&&(n=t.getBasePixel()),n}function _x(e,t,n){let i;return e==="start"?i=n:e==="end"?i=t.options.reverse?t.min:t.max:H(e)?i=e.value:i=t.getBaseValue(),i}function wx(e){const t=e.options,n=t.fill;let i=P(n&&n.target,n);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function kx(e){const{scale:t,index:n,line:i}=e,s=[],o=i.segments,r=i.points,a=Sx(t,n);a.push(Nu({x:null,y:t.bottom},i));for(let l=0;l<o.length;l++){const c=o[l];for(let d=c.start;d<=c.end;d++)Ex(s,r[d],a)}return new Ee({points:s,options:{}})}function Sx(e,t){const n=[],i=e.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const o=i[s];if(o.index===t)break;o.hidden||n.unshift(o.dataset)}return n}function Ex(e,t,n){const i=[];for(let s=0;s<n.length;s++){const o=n[s],{first:r,last:a,point:l}=Ix(o,t,"x");if(!(!l||r&&a)){if(r)i.unshift(l);else if(e.push(l),!a)break}}e.push(...i)}function Ix(e,t,n){const i=e.interpolate(t,n);if(!i)return{};const s=i[n],o=e.segments,r=e.points;let a=!1,l=!1;for(let c=0;c<o.length;c++){const d=o[c],u=r[d.start][n],h=r[d.end][n];if(oe(s,u,h)){a=s===u,l=s===h;break}}return{first:a,last:l,point:i}}class Fu{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,n,i){const{x:s,y:o,radius:r}=this;return n=n||{start:0,end:Q},t.arc(s,o,r,n.end,n.start,!0),!i.bounds}interpolate(t){const{x:n,y:i,radius:s}=this,o=t.angle;return{x:n+Math.cos(o)*s,y:i+Math.sin(o)*s,angle:o}}}function Dx(e){const{chart:t,fill:n,line:i}=e;if(ot(n))return Tx(t,n);if(n==="stack")return kx(e);if(n==="shape")return!0;const s=Mx(e);return s instanceof Fu?s:Nu(s,i)}function Tx(e,t){const n=e.getDatasetMeta(t);return n&&e.isDatasetVisible(t)?n.dataset:null}function Mx(e){return(e.scale||{}).getPointPositionForValue?Ax(e):Cx(e)}function Cx(e){const{scale:t={},fill:n}=e,i=xx(n,t);if(ot(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function Ax(e){const{scale:t,fill:n}=e,i=t.options,s=t.getLabels().length,o=i.reverse?t.max:t.min,r=_x(n,t,o),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,o);return new Fu({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(r)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,r));return a}function Yo(e,t,n){const i=Dx(t),{chart:s,index:o,line:r,scale:a,axis:l}=t,c=r.options,d=c.fill,u=c.backgroundColor,{above:h=u,below:f=u}=d||{},g=s.getDatasetMeta(o),p=yu(s,g);i&&r.points.length&&(oo(e,n),Lx(e,{line:r,target:i,above:h,below:f,area:n,scale:a,axis:l,clip:p}),ro(e))}function Lx(e,t){const{line:n,target:i,above:s,below:o,area:r,scale:a,clip:l}=t,c=n._loop?"angle":t.axis;e.save();let d=o;o!==s&&(c==="x"?(cc(e,i,r.top),qo(e,{line:n,target:i,color:s,scale:a,property:c,clip:l}),e.restore(),e.save(),cc(e,i,r.bottom)):c==="y"&&(dc(e,i,r.left),qo(e,{line:n,target:i,color:o,scale:a,property:c,clip:l}),e.restore(),e.save(),dc(e,i,r.right),d=s)),qo(e,{line:n,target:i,color:d,scale:a,property:c,clip:l}),e.restore()}function cc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[co(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(d.x,n),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(u.x,n)}e.lineTo(t.first().x,n),e.closePath(),e.clip()}function dc(e,t,n){const{segments:i,points:s}=t;let o=!0,r=!1;e.beginPath();for(const a of i){const{start:l,end:c}=a,d=s[l],u=s[co(l,c,s)];o?(e.moveTo(d.x,d.y),o=!1):(e.lineTo(n,d.y),e.lineTo(d.x,d.y)),r=!!t.pathSegment(e,a,{move:r}),r?e.closePath():e.lineTo(n,u.y)}e.lineTo(n,t.first().y),e.closePath(),e.clip()}function qo(e,t){const{line:n,target:i,property:s,color:o,scale:r,clip:a}=t,l=px(n,i,s);for(const{source:c,target:d,start:u,end:h}of l){const{style:{backgroundColor:f=o}={}}=c,g=i!==!0;e.save(),e.fillStyle=f,Ox(e,r,a,g&&_r(s,u,h)),e.beginPath();const p=!!n.pathSegment(e,c);let m;if(g){p?e.closePath():uc(e,i,h,s);const b=!!i.pathSegment(e,d,{move:p,reverse:!0});m=p&&b,m||uc(e,i,u,s)}e.closePath(),e.fill(m?"evenodd":"nonzero"),e.restore()}}function Ox(e,t,n,i){const s=t.chart.chartArea,{property:o,start:r,end:a}=i||{};if(o==="x"||o==="y"){let l,c,d,u;o==="x"?(l=r,c=s.top,d=a,u=s.bottom):(l=s.left,c=r,d=s.right,u=a),e.beginPath(),n&&(l=Math.max(l,n.left),d=Math.min(d,n.right),c=Math.max(c,n.top),u=Math.min(u,n.bottom)),e.rect(l,c,d-l,u-c),e.clip()}}function uc(e,t,n,i){const s=t.interpolate(n,i);s&&e.lineTo(s.x,s.y)}var Px={id:"filler",afterDatasetsUpdate(e,t,n){const i=(e.data.datasets||[]).length,s=[];let o,r,a,l;for(r=0;r<i;++r)o=e.getDatasetMeta(r),a=o.dataset,l=null,a&&a.options&&a instanceof Ee&&(l={visible:e.isDatasetVisible(r),index:r,fill:yx(a,r,i),chart:e,axis:o.controller.options.indexAxis,scale:o.vScale,line:a}),o.$filler=l,s.push(l);for(r=0;r<i;++r)l=s[r],!(!l||l.fill===!1)&&(l.fill=bx(s,r,n.propagate))},beforeDraw(e,t,n){const i=n.drawTime==="beforeDraw",s=e.getSortedVisibleDatasetMetas(),o=e.chartArea;for(let r=s.length-1;r>=0;--r){const a=s[r].$filler;a&&(a.line.updateControlPoints(o,a.axis),i&&a.fill&&Yo(e.ctx,a,o))}},beforeDatasetsDraw(e,t,n){if(n.drawTime!=="beforeDatasetsDraw")return;const i=e.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const o=i[s].$filler;lc(o)&&Yo(e.ctx,o,e.chartArea)}},beforeDatasetDraw(e,t,n){const i=t.meta.$filler;!lc(i)||n.drawTime!=="beforeDatasetDraw"||Yo(e.ctx,i,e.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const hc=(e,t)=>{let{boxHeight:n=t,boxWidth:i=t}=e;return e.usePointStyle&&(n=Math.min(n,t),i=e.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:n,itemHeight:Math.max(t,n)}},Rx=(e,t)=>e!==null&&t!==null&&e.datasetIndex===t.datasetIndex&&e.index===t.index;class fc extends Ut{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n,i){this.maxWidth=t,this.maxHeight=n,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let n=Z(t.generateLabels,[this.chart],this)||[];t.filter&&(n=n.filter(i=>t.filter(i,this.chart.data))),t.sort&&(n=n.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&n.reverse(),this.legendItems=n}fit(){const{options:t,ctx:n}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=dt(i.font),o=s.size,r=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=hc(i,o);let c,d;n.font=s.string,this.isHorizontal()?(c=this.maxWidth,d=this._fitRows(r,o,a,l)+10):(d=this.maxHeight,c=this._fitCols(r,s,a,l)+10),this.width=Math.min(c,t.maxWidth||this.maxWidth),this.height=Math.min(d,t.maxHeight||this.maxHeight)}_fitRows(t,n,i,s){const{ctx:o,maxWidth:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.lineWidths=[0],d=s+a;let u=t;o.textAlign="left",o.textBaseline="middle";let h=-1,f=-d;return this.legendItems.forEach((g,p)=>{const m=i+n/2+o.measureText(g.text).width;(p===0||c[c.length-1]+m+2*a>r)&&(u+=d,c[c.length-(p>0?0:1)]=0,f+=d,h++),l[p]={left:0,top:f,row:h,width:m,height:s},c[c.length-1]+=m+a}),u}_fitCols(t,n,i,s){const{ctx:o,maxHeight:r,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],c=this.columnSizes=[],d=r-t;let u=a,h=0,f=0,g=0,p=0;return this.legendItems.forEach((m,b)=>{const{itemWidth:y,itemHeight:x}=Bx(i,n,o,m,s);b>0&&f+x+2*a>d&&(u+=h+a,c.push({width:h,height:f}),g+=h+a,p++,h=f=0),l[b]={left:g,top:f,col:p,width:y,height:x},h=Math.max(h,y),f+=x+a}),u+=h,c.push({width:h,height:f}),u}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:n,options:{align:i,labels:{padding:s},rtl:o}}=this,r=pn(o,this.left,this.width);if(this.isHorizontal()){let a=0,l=vt(i,this.left+s,this.right-this.lineWidths[a]);for(const c of n)a!==c.row&&(a=c.row,l=vt(i,this.left+s,this.right-this.lineWidths[a])),c.top+=this.top+t+s,c.left=r.leftForLtr(r.x(l),c.width),l+=c.width+s}else{let a=0,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const c of n)c.col!==a&&(a=c.col,l=vt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),c.top=l,c.left+=this.left+s,c.left=r.leftForLtr(r.x(c.left),c.width),l+=c.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;oo(t,this),this._draw(),ro(t)}}_draw(){const{options:t,columnSizes:n,lineWidths:i,ctx:s}=this,{align:o,labels:r}=t,a=nt.color,l=pn(t.rtl,this.left,this.width),c=dt(r.font),{padding:d}=r,u=c.size,h=u/2;let f;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=c.string;const{boxWidth:g,boxHeight:p,itemHeight:m}=hc(r,u),b=function(w,k,S){if(isNaN(g)||g<=0||isNaN(p)||p<0)return;s.save();const D=P(S.lineWidth,1);if(s.fillStyle=P(S.fillStyle,a),s.lineCap=P(S.lineCap,"butt"),s.lineDashOffset=P(S.lineDashOffset,0),s.lineJoin=P(S.lineJoin,"miter"),s.lineWidth=D,s.strokeStyle=P(S.strokeStyle,a),s.setLineDash(P(S.lineDash,[])),r.usePointStyle){const A={radius:p*Math.SQRT2/2,pointStyle:S.pointStyle,rotation:S.rotation,borderWidth:D},T=l.xPlus(w,g/2),R=k+h;ou(s,A,T,R,r.pointStyleWidth&&g)}else{const A=k+Math.max((u-p)/2,0),T=l.leftForLtr(w,g),R=Ge(S.borderRadius);s.beginPath(),Object.values(R).some(G=>G!==0)?_i(s,{x:T,y:A,w:g,h:p,radius:R}):s.rect(T,A,g,p),s.fill(),D!==0&&s.stroke()}s.restore()},y=function(w,k,S){Je(s,S.text,w,k+m/2,c,{strikethrough:S.hidden,textAlign:l.textAlign(S.textAlign)})},x=this.isHorizontal(),_=this._computeTitleHeight();x?f={x:vt(o,this.left+d,this.right-i[0]),y:this.top+d+_,line:0}:f={x:this.left+d,y:vt(o,this.top+_+d,this.bottom-n[0].height),line:0},fu(this.ctx,t.textDirection);const v=m+d;this.legendItems.forEach((w,k)=>{s.strokeStyle=w.fontColor,s.fillStyle=w.fontColor;const S=s.measureText(w.text).width,D=l.textAlign(w.textAlign||(w.textAlign=r.textAlign)),A=g+h+S;let T=f.x,R=f.y;l.setWidth(this.width),x?k>0&&T+A+d>this.right&&(R=f.y+=v,f.line++,T=f.x=vt(o,this.left+d,this.right-i[f.line])):k>0&&R+v>this.bottom&&(T=f.x=T+n[f.line].width+d,f.line++,R=f.y=vt(o,this.top+_+d,this.bottom-n[f.line].height));const G=l.x(T);if(b(G,R,w),T=e0(D,T+g+h,x?T+A:this.right,t.rtl),y(l.x(T),R,w),x)f.x+=A+d;else if(typeof w.text!="string"){const rt=c.lineHeight;f.y+=Hu(w,rt)+d}else f.y+=v}),gu(this.ctx,t.textDirection)}drawTitle(){const t=this.options,n=t.title,i=dt(n.font),s=wt(n.padding);if(!n.display)return;const o=pn(t.rtl,this.left,this.width),r=this.ctx,a=n.position,l=i.size/2,c=s.top+l;let d,u=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),d=this.top+c,u=vt(t.align,u,this.right-h);else{const g=this.columnSizes.reduce((p,m)=>Math.max(p,m.height),0);d=c+vt(t.align,this.top,this.bottom-g-t.labels.padding-this._computeTitleHeight())}const f=vt(a,u,u+h);r.textAlign=o.textAlign(ta(a)),r.textBaseline="middle",r.strokeStyle=n.color,r.fillStyle=n.color,r.font=i.string,Je(r,n.text,f,d,i)}_computeTitleHeight(){const t=this.options.title,n=dt(t.font),i=wt(t.padding);return t.display?n.lineHeight+i.height:0}_getLegendItemAt(t,n){let i,s,o;if(oe(t,this.left,this.right)&&oe(n,this.top,this.bottom)){for(o=this.legendHitBoxes,i=0;i<o.length;++i)if(s=o[i],oe(t,s.left,s.left+s.width)&&oe(n,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const n=this.options;if(!Hx(t.type,n))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,o=Rx(s,i);s&&!o&&Z(n.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!o&&Z(n.onHover,[t,i,this],this)}else i&&Z(n.onClick,[t,i,this],this)}}function Bx(e,t,n,i,s){const o=Nx(i,e,t,n),r=Fx(s,i,t.lineHeight);return{itemWidth:o,itemHeight:r}}function Nx(e,t,n,i){let s=e.text;return s&&typeof s!="string"&&(s=s.reduce((o,r)=>o.length>r.length?o:r)),t+n.size/2+i.measureText(s).width}function Fx(e,t,n){let i=e;return typeof t.text!="string"&&(i=Hu(t,n)),i}function Hu(e,t){const n=e.text?e.text.length:0;return t*n}function Hx(e,t){return!!((e==="mousemove"||e==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(e==="click"||e==="mouseup"))}var $x={id:"legend",_element:fc,start(e,t,n){const i=e.legend=new fc({ctx:e.ctx,options:n,chart:e});_t.configure(e,i,n),_t.addBox(e,i)},stop(e){_t.removeBox(e,e.legend),delete e.legend},beforeUpdate(e,t,n){const i=e.legend;_t.configure(e,i,n),i.options=n},afterUpdate(e){const t=e.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(e,t){t.replay||e.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(e,t,n){const i=t.datasetIndex,s=n.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:e=>e.chart.options.color,boxWidth:40,padding:10,generateLabels(e){const t=e.data.datasets,{labels:{usePointStyle:n,pointStyle:i,textAlign:s,color:o,useBorderRadius:r,borderRadius:a}}=e.legend.options;return e._getSortedDatasetMetas().map(l=>{const c=l.controller.getStyle(n?0:void 0),d=wt(c.borderWidth);return{text:t[l.index].label,fillStyle:c.backgroundColor,fontColor:o,hidden:!l.visible,lineCap:c.borderCapStyle,lineDash:c.borderDash,lineDashOffset:c.borderDashOffset,lineJoin:c.borderJoinStyle,lineWidth:(d.width+d.height)/4,strokeStyle:c.borderColor,pointStyle:i||c.pointStyle,rotation:c.rotation,textAlign:s||c.textAlign,borderRadius:r&&(a||c.borderRadius),datasetIndex:l.index}},this)}},title:{color:e=>e.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:e=>!e.startsWith("on"),labels:{_scriptable:e=>!["generateLabels","filter","sort"].includes(e)}}};class ca extends Ut{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,n){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=n;const s=et(i.text)?i.text.length:1;this._padding=wt(i.padding);const o=s*dt(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=o:this.width=o}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:n,left:i,bottom:s,right:o,options:r}=this,a=r.align;let l=0,c,d,u;return this.isHorizontal()?(d=vt(a,i,o),u=n+t,c=o-i):(r.position==="left"?(d=i+t,u=vt(a,s,n),l=U*-.5):(d=o-t,u=vt(a,n,s),l=U*.5),c=s-n),{titleX:d,titleY:u,maxWidth:c,rotation:l}}draw(){const t=this.ctx,n=this.options;if(!n.display)return;const i=dt(n.font),o=i.lineHeight/2+this._padding.top,{titleX:r,titleY:a,maxWidth:l,rotation:c}=this._drawArgs(o);Je(t,n.text,0,0,i,{color:n.color,maxWidth:l,rotation:c,textAlign:ta(n.align),textBaseline:"middle",translation:[r,a]})}}function zx(e,t){const n=new ca({ctx:e.ctx,options:t,chart:e});_t.configure(e,n,t),_t.addBox(e,n),e.titleBlock=n}var jx={id:"title",_element:ca,start(e,t,n){zx(e,n)},stop(e){const t=e.titleBlock;_t.removeBox(e,t),delete e.titleBlock},beforeUpdate(e,t,n){const i=e.titleBlock;_t.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ss=new WeakMap;var Vx={id:"subtitle",start(e,t,n){const i=new ca({ctx:e.ctx,options:n,chart:e});_t.configure(e,i,n),_t.addBox(e,i),ss.set(e,i)},stop(e){_t.removeBox(e,ss.get(e)),ss.delete(e)},beforeUpdate(e,t,n){const i=ss.get(e);_t.configure(e,i,n),i.options=n},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Yn={average(e){if(!e.length)return!1;let t,n,i=new Set,s=0,o=0;for(t=0,n=e.length;t<n;++t){const a=e[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++o}}return o===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/o}},nearest(e,t){if(!e.length)return!1;let n=t.x,i=t.y,s=Number.POSITIVE_INFINITY,o,r,a;for(o=0,r=e.length;o<r;++o){const l=e[o].element;if(l&&l.hasValue()){const c=l.getCenterPoint(),d=fr(t,c);d<s&&(s=d,a=l)}}if(a){const l=a.tooltipPosition();n=l.x,i=l.y}return{x:n,y:i}}};function Wt(e,t){return t&&(et(t)?Array.prototype.push.apply(e,t):e.push(t)),e}function ee(e){return(typeof e=="string"||e instanceof String)&&e.indexOf(`
`)>-1?e.split(`
`):e}function Ux(e,t){const{element:n,datasetIndex:i,index:s}=t,o=e.getDatasetMeta(i).controller,{label:r,value:a}=o.getLabelAndValue(s);return{chart:e,label:r,parsed:o.getParsed(s),raw:e.data.datasets[i].data[s],formattedValue:a,dataset:o.getDataset(),dataIndex:s,datasetIndex:i,element:n}}function gc(e,t){const n=e.chart.ctx,{body:i,footer:s,title:o}=e,{boxWidth:r,boxHeight:a}=t,l=dt(t.bodyFont),c=dt(t.titleFont),d=dt(t.footerFont),u=o.length,h=s.length,f=i.length,g=wt(t.padding);let p=g.height,m=0,b=i.reduce((_,v)=>_+v.before.length+v.lines.length+v.after.length,0);if(b+=e.beforeBody.length+e.afterBody.length,u&&(p+=u*c.lineHeight+(u-1)*t.titleSpacing+t.titleMarginBottom),b){const _=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;p+=f*_+(b-f)*l.lineHeight+(b-1)*t.bodySpacing}h&&(p+=t.footerMarginTop+h*d.lineHeight+(h-1)*t.footerSpacing);let y=0;const x=function(_){m=Math.max(m,n.measureText(_).width+y)};return n.save(),n.font=c.string,q(e.title,x),n.font=l.string,q(e.beforeBody.concat(e.afterBody),x),y=t.displayColors?r+2+t.boxPadding:0,q(i,_=>{q(_.before,x),q(_.lines,x),q(_.after,x)}),y=0,n.font=d.string,q(e.footer,x),n.restore(),m+=g.width,{width:m,height:p}}function Wx(e,t){const{y:n,height:i}=t;return n<i/2?"top":n>e.height-i/2?"bottom":"center"}function Yx(e,t,n,i){const{x:s,width:o}=i,r=n.caretSize+n.caretPadding;if(e==="left"&&s+o+r>t.width||e==="right"&&s-o-r<0)return!0}function qx(e,t,n,i){const{x:s,width:o}=n,{width:r,chartArea:{left:a,right:l}}=e;let c="center";return i==="center"?c=s<=(a+l)/2?"left":"right":s<=o/2?c="left":s>=r-o/2&&(c="right"),Yx(c,e,t,n)&&(c="center"),c}function pc(e,t,n){const i=n.yAlign||t.yAlign||Wx(e,n);return{xAlign:n.xAlign||t.xAlign||qx(e,t,n,i),yAlign:i}}function Gx(e,t){let{x:n,width:i}=e;return t==="right"?n-=i:t==="center"&&(n-=i/2),n}function Xx(e,t,n){let{y:i,height:s}=e;return t==="top"?i+=n:t==="bottom"?i-=s+n:i-=s/2,i}function mc(e,t,n,i){const{caretSize:s,caretPadding:o,cornerRadius:r}=e,{xAlign:a,yAlign:l}=n,c=s+o,{topLeft:d,topRight:u,bottomLeft:h,bottomRight:f}=Ge(r);let g=Gx(t,a);const p=Xx(t,l,c);return l==="center"?a==="left"?g+=c:a==="right"&&(g-=c):a==="left"?g-=Math.max(d,h)+s:a==="right"&&(g+=Math.max(u,f)+s),{x:gt(g,0,i.width-t.width),y:gt(p,0,i.height-t.height)}}function os(e,t,n){const i=wt(n.padding);return t==="center"?e.x+e.width/2:t==="right"?e.x+e.width-i.right:e.x+i.left}function bc(e){return Wt([],ee(e))}function Kx(e,t,n){return Ae(e,{tooltip:t,tooltipItems:n,type:"tooltip"})}function yc(e,t){const n=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return n?e.override(n):e}const $u={beforeTitle:Qt,title(e){if(e.length>0){const t=e[0],n=t.chart.data.labels,i=n?n.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return n[t.dataIndex]}return""},afterTitle:Qt,beforeBody:Qt,beforeLabel:Qt,label(e){if(this&&this.options&&this.options.mode==="dataset")return e.label+": "+e.formattedValue||e.formattedValue;let t=e.dataset.label||"";t&&(t+=": ");const n=e.formattedValue;return N(n)||(t+=n),t},labelColor(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{borderColor:n.borderColor,backgroundColor:n.backgroundColor,borderWidth:n.borderWidth,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(e){const n=e.chart.getDatasetMeta(e.datasetIndex).controller.getStyle(e.dataIndex);return{pointStyle:n.pointStyle,rotation:n.rotation}},afterLabel:Qt,afterBody:Qt,beforeFooter:Qt,footer:Qt,afterFooter:Qt};function Et(e,t,n,i){const s=e[t].call(n,i);return typeof s>"u"?$u[t].call(n,i):s}class wr extends Ut{constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const n=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&n.options.animation&&i.animations,o=new vu(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(o)),o}getContext(){return this.$context||(this.$context=Kx(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,n){const{callbacks:i}=n,s=Et(i,"beforeTitle",this,t),o=Et(i,"title",this,t),r=Et(i,"afterTitle",this,t);let a=[];return a=Wt(a,ee(s)),a=Wt(a,ee(o)),a=Wt(a,ee(r)),a}getBeforeBody(t,n){return bc(Et(n.callbacks,"beforeBody",this,t))}getBody(t,n){const{callbacks:i}=n,s=[];return q(t,o=>{const r={before:[],lines:[],after:[]},a=yc(i,o);Wt(r.before,ee(Et(a,"beforeLabel",this,o))),Wt(r.lines,Et(a,"label",this,o)),Wt(r.after,ee(Et(a,"afterLabel",this,o))),s.push(r)}),s}getAfterBody(t,n){return bc(Et(n.callbacks,"afterBody",this,t))}getFooter(t,n){const{callbacks:i}=n,s=Et(i,"beforeFooter",this,t),o=Et(i,"footer",this,t),r=Et(i,"afterFooter",this,t);let a=[];return a=Wt(a,ee(s)),a=Wt(a,ee(o)),a=Wt(a,ee(r)),a}_createItems(t){const n=this._active,i=this.chart.data,s=[],o=[],r=[];let a=[],l,c;for(l=0,c=n.length;l<c;++l)a.push(Ux(this.chart,n[l]));return t.filter&&(a=a.filter((d,u,h)=>t.filter(d,u,h,i))),t.itemSort&&(a=a.sort((d,u)=>t.itemSort(d,u,i))),q(a,d=>{const u=yc(t.callbacks,d);s.push(Et(u,"labelColor",this,d)),o.push(Et(u,"labelPointStyle",this,d)),r.push(Et(u,"labelTextColor",this,d))}),this.labelColors=s,this.labelPointStyles=o,this.labelTextColors=r,this.dataPoints=a,a}update(t,n){const i=this.options.setContext(this.getContext()),s=this._active;let o,r=[];if(!s.length)this.opacity!==0&&(o={opacity:0});else{const a=Yn[i.position].call(this,s,this._eventPosition);r=this._createItems(i),this.title=this.getTitle(r,i),this.beforeBody=this.getBeforeBody(r,i),this.body=this.getBody(r,i),this.afterBody=this.getAfterBody(r,i),this.footer=this.getFooter(r,i);const l=this._size=gc(this,i),c=Object.assign({},a,l),d=pc(this.chart,i,c),u=mc(i,c,d,this.chart);this.xAlign=d.xAlign,this.yAlign=d.yAlign,o={opacity:1,x:u.x,y:u.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=r,this.$context=void 0,o&&this._resolveAnimations().update(this,o),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:n})}drawCaret(t,n,i,s){const o=this.getCaretPosition(t,i,s);n.lineTo(o.x1,o.y1),n.lineTo(o.x2,o.y2),n.lineTo(o.x3,o.y3)}getCaretPosition(t,n,i){const{xAlign:s,yAlign:o}=this,{caretSize:r,cornerRadius:a}=i,{topLeft:l,topRight:c,bottomLeft:d,bottomRight:u}=Ge(a),{x:h,y:f}=t,{width:g,height:p}=n;let m,b,y,x,_,v;return o==="center"?(_=f+p/2,s==="left"?(m=h,b=m-r,x=_+r,v=_-r):(m=h+g,b=m+r,x=_-r,v=_+r),y=m):(s==="left"?b=h+Math.max(l,d)+r:s==="right"?b=h+g-Math.max(c,u)-r:b=this.caretX,o==="top"?(x=f,_=x-r,m=b-r,y=b+r):(x=f+p,_=x+r,m=b+r,y=b-r),v=x),{x1:m,x2:b,x3:y,y1:x,y2:_,y3:v}}drawTitle(t,n,i){const s=this.title,o=s.length;let r,a,l;if(o){const c=pn(i.rtl,this.x,this.width);for(t.x=os(this,i.titleAlign,i),n.textAlign=c.textAlign(i.titleAlign),n.textBaseline="middle",r=dt(i.titleFont),a=i.titleSpacing,n.fillStyle=i.titleColor,n.font=r.string,l=0;l<o;++l)n.fillText(s[l],c.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+a,l+1===o&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,n,i,s,o){const r=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:c}=o,d=dt(o.bodyFont),u=os(this,"left",o),h=s.x(u),f=l<d.lineHeight?(d.lineHeight-l)/2:0,g=n.y+f;if(o.usePointStyle){const p={radius:Math.min(c,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},m=s.leftForLtr(h,c)+c/2,b=g+l/2;t.strokeStyle=o.multiKeyBackground,t.fillStyle=o.multiKeyBackground,pr(t,p,m,b),t.strokeStyle=r.borderColor,t.fillStyle=r.backgroundColor,pr(t,p,m,b)}else{t.lineWidth=H(r.borderWidth)?Math.max(...Object.values(r.borderWidth)):r.borderWidth||1,t.strokeStyle=r.borderColor,t.setLineDash(r.borderDash||[]),t.lineDashOffset=r.borderDashOffset||0;const p=s.leftForLtr(h,c),m=s.leftForLtr(s.xPlus(h,1),c-2),b=Ge(r.borderRadius);Object.values(b).some(y=>y!==0)?(t.beginPath(),t.fillStyle=o.multiKeyBackground,_i(t,{x:p,y:g,w:c,h:l,radius:b}),t.fill(),t.stroke(),t.fillStyle=r.backgroundColor,t.beginPath(),_i(t,{x:m,y:g+1,w:c-2,h:l-2,radius:b}),t.fill()):(t.fillStyle=o.multiKeyBackground,t.fillRect(p,g,c,l),t.strokeRect(p,g,c,l),t.fillStyle=r.backgroundColor,t.fillRect(m,g+1,c-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,n,i){const{body:s}=this,{bodySpacing:o,bodyAlign:r,displayColors:a,boxHeight:l,boxWidth:c,boxPadding:d}=i,u=dt(i.bodyFont);let h=u.lineHeight,f=0;const g=pn(i.rtl,this.x,this.width),p=function(S){n.fillText(S,g.x(t.x+f),t.y+h/2),t.y+=h+o},m=g.textAlign(r);let b,y,x,_,v,w,k;for(n.textAlign=r,n.textBaseline="middle",n.font=u.string,t.x=os(this,m,i),n.fillStyle=i.bodyColor,q(this.beforeBody,p),f=a&&m!=="right"?r==="center"?c/2+d:c+2+d:0,_=0,w=s.length;_<w;++_){for(b=s[_],y=this.labelTextColors[_],n.fillStyle=y,q(b.before,p),x=b.lines,a&&x.length&&(this._drawColorBox(n,t,_,g,i),h=Math.max(u.lineHeight,l)),v=0,k=x.length;v<k;++v)p(x[v]),h=u.lineHeight;q(b.after,p)}f=0,h=u.lineHeight,q(this.afterBody,p),t.y-=o}drawFooter(t,n,i){const s=this.footer,o=s.length;let r,a;if(o){const l=pn(i.rtl,this.x,this.width);for(t.x=os(this,i.footerAlign,i),t.y+=i.footerMarginTop,n.textAlign=l.textAlign(i.footerAlign),n.textBaseline="middle",r=dt(i.footerFont),n.fillStyle=i.footerColor,n.font=r.string,a=0;a<o;++a)n.fillText(s[a],l.x(t.x),t.y+r.lineHeight/2),t.y+=r.lineHeight+i.footerSpacing}}drawBackground(t,n,i,s){const{xAlign:o,yAlign:r}=this,{x:a,y:l}=t,{width:c,height:d}=i,{topLeft:u,topRight:h,bottomLeft:f,bottomRight:g}=Ge(s.cornerRadius);n.fillStyle=s.backgroundColor,n.strokeStyle=s.borderColor,n.lineWidth=s.borderWidth,n.beginPath(),n.moveTo(a+u,l),r==="top"&&this.drawCaret(t,n,i,s),n.lineTo(a+c-h,l),n.quadraticCurveTo(a+c,l,a+c,l+h),r==="center"&&o==="right"&&this.drawCaret(t,n,i,s),n.lineTo(a+c,l+d-g),n.quadraticCurveTo(a+c,l+d,a+c-g,l+d),r==="bottom"&&this.drawCaret(t,n,i,s),n.lineTo(a+f,l+d),n.quadraticCurveTo(a,l+d,a,l+d-f),r==="center"&&o==="left"&&this.drawCaret(t,n,i,s),n.lineTo(a,l+u),n.quadraticCurveTo(a,l,a+u,l),n.closePath(),n.fill(),s.borderWidth>0&&n.stroke()}_updateAnimationTarget(t){const n=this.chart,i=this.$animations,s=i&&i.x,o=i&&i.y;if(s||o){const r=Yn[t.position].call(this,this._active,this._eventPosition);if(!r)return;const a=this._size=gc(this,t),l=Object.assign({},r,this._size),c=pc(n,t,l),d=mc(t,l,c,n);(s._to!==d.x||o._to!==d.y)&&(this.xAlign=c.xAlign,this.yAlign=c.yAlign,this.width=a.width,this.height=a.height,this.caretX=r.x,this.caretY=r.y,this._resolveAnimations().update(this,d))}}_willRender(){return!!this.opacity}draw(t){const n=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(n);const s={width:this.width,height:this.height},o={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const r=wt(n.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;n.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(o,t,s,n),fu(t,n.textDirection),o.y+=r.top,this.drawTitle(o,t,n),this.drawBody(o,t,n),this.drawFooter(o,t,n),gu(t,n.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,n){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const c=this.chart.getDatasetMeta(a);if(!c)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:c.data[l],index:l}}),o=!Ws(i,s),r=this._positionChanged(s,n);(o||r)&&(this._active=s,this._eventPosition=n,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,n,i=!0){if(n&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,o=this._active||[],r=this._getActiveElements(t,o,n,i),a=this._positionChanged(r,t),l=n||!Ws(r,o)||a;return l&&(this._active=r,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,n))),l}_getActiveElements(t,n,i,s){const o=this.options;if(t.type==="mouseout")return[];if(!s)return n.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const r=this.chart.getElementsAtEventForMode(t,o.mode,o,i);return o.reverse&&r.reverse(),r}_positionChanged(t,n){const{caretX:i,caretY:s,options:o}=this,r=Yn[o.position].call(this,t,n);return r!==!1&&(i!==r.x||s!==r.y)}}I(wr,"positioners",Yn);var Jx={id:"tooltip",_element:wr,positioners:Yn,afterInit(e,t,n){n&&(e.tooltip=new wr({chart:e,options:n}))},beforeUpdate(e,t,n){e.tooltip&&e.tooltip.initialize(n)},reset(e,t,n){e.tooltip&&e.tooltip.initialize(n)},afterDraw(e){const t=e.tooltip;if(t&&t._willRender()){const n={tooltip:t};if(e.notifyPlugins("beforeTooltipDraw",{...n,cancelable:!0})===!1)return;t.draw(e.ctx),e.notifyPlugins("afterTooltipDraw",n)}},afterEvent(e,t){if(e.tooltip){const n=t.replay;e.tooltip.handleEvent(t.event,n,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(e,t)=>t.bodyFont.size,boxWidth:(e,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:$u},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:e=>e!=="filter"&&e!=="itemSort"&&e!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},Zx=Object.freeze({__proto__:null,Colors:dx,Decimation:gx,Filler:Px,Legend:$x,SubTitle:Vx,Title:jx,Tooltip:Jx});const Qx=(e,t,n,i)=>(typeof t=="string"?(n=e.push(t)-1,i.unshift({index:n,label:t})):isNaN(t)&&(n=null),n);function t_(e,t,n,i){const s=e.indexOf(t);if(s===-1)return Qx(e,t,n,i);const o=e.lastIndexOf(t);return s!==o?n:s}const e_=(e,t)=>e===null?null:gt(Math.round(e),0,t);function vc(e){const t=this.getLabels();return e>=0&&e<t.length?t[e]:e}class kr extends tn{constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const n=this._addedLabels;if(n.length){const i=this.getLabels();for(const{index:s,label:o}of n)i[s]===o&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,n){if(N(t))return null;const i=this.getLabels();return n=isFinite(n)&&i[n]===t?n:t_(i,t,P(n,t),this._addedLabels),e_(n,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),n||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,n=this.max,i=this.options.offset,s=[];let o=this.getLabels();o=t===0&&n===o.length-1?o:o.slice(t,n+1),this._valueRange=Math.max(o.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let r=t;r<=n;r++)s.push({value:r});return s}getLabelForValue(t){return vc.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const n=this.ticks;return t<0||t>n.length-1?null:this.getPixelForValue(n[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}I(kr,"id","category"),I(kr,"defaults",{ticks:{callback:vc}});function n_(e,t){const n=[],{bounds:s,step:o,min:r,max:a,precision:l,count:c,maxTicks:d,maxDigits:u,includeBounds:h}=e,f=o||1,g=d-1,{min:p,max:m}=t,b=!N(r),y=!N(a),x=!N(c),_=(m-p)/(u+1);let v=gl((m-p)/g/f)*f,w,k,S,D;if(v<1e-14&&!b&&!y)return[{value:p},{value:m}];D=Math.ceil(m/v)-Math.floor(p/v),D>g&&(v=gl(D*v/g/f)*f),N(l)||(w=Math.pow(10,l),v=Math.ceil(v*w)/w),s==="ticks"?(k=Math.floor(p/v)*v,S=Math.ceil(m/v)*v):(k=p,S=m),b&&y&&o&&Gb((a-r)/o,v/1e3)?(D=Math.round(Math.min((a-r)/v,d)),v=(a-r)/D,k=r,S=a):x?(k=b?r:k,S=y?a:S,D=c-1,v=(S-k)/D):(D=(S-k)/v,li(D,Math.round(D),v/1e3)?D=Math.round(D):D=Math.ceil(D));const A=Math.max(pl(v),pl(k));w=Math.pow(10,N(l)?A:l),k=Math.round(k*w)/w,S=Math.round(S*w)/w;let T=0;for(b&&(h&&k!==r?(n.push({value:r}),k<r&&T++,li(Math.round((k+T*v)*w)/w,r,xc(r,_,e))&&T++):k<r&&T++);T<D;++T){const R=Math.round((k+T*v)*w)/w;if(y&&R>a)break;n.push({value:R})}return y&&h&&S!==a?n.length&&li(n[n.length-1].value,a,xc(a,_,e))?n[n.length-1].value=a:n.push({value:a}):(!y||S===a)&&n.push({value:S}),n}function xc(e,t,{horizontal:n,minRotation:i}){const s=jt(i),o=(n?Math.sin(s):Math.cos(s))||.001,r=.75*t*(""+e).length;return Math.min(t/o,r)}class Zs extends tn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,n){return N(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:n,maxDefined:i}=this.getUserBounds();let{min:s,max:o}=this;const r=l=>s=n?s:l,a=l=>o=i?o:l;if(t){const l=Xt(s),c=Xt(o);l<0&&c<0?a(0):l>0&&c>0&&r(0)}if(s===o){let l=o===0?1:Math.abs(o*.05);a(o+l),t||r(s-l)}this.min=s,this.max=o}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:n,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),n=n||11),n&&(s=Math.min(n,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,n=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:n.precision,step:n.stepSize,count:n.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:n.minRotation||0,includeBounds:n.includeBounds!==!1},o=this._range||this,r=n_(s,o);return t.bounds==="ticks"&&Kd(r,this,"value"),t.reverse?(r.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),r}configure(){const t=this.ticks;let n=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-n)/Math.max(t.length-1,1)/2;n-=s,i+=s}this._startValue=n,this._endValue=i,this._valueRange=i-n}getLabelForValue(t){return Ri(t,this.chart.options.locale,this.options.ticks.format)}}class Sr extends Zs{determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=ot(t)?t:0,this.max=ot(n)?n:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),n=t?this.width:this.height,i=jt(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,o=this._resolveTickFontOptions(0);return Math.ceil(n/Math.min(40,o.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}I(Sr,"id","linear"),I(Sr,"defaults",{ticks:{callback:so.formatters.numeric}});const ki=e=>Math.floor(ke(e)),ze=(e,t)=>Math.pow(10,ki(e)+t);function _c(e){return e/Math.pow(10,ki(e))===1}function wc(e,t,n){const i=Math.pow(10,n),s=Math.floor(e/i);return Math.ceil(t/i)-s}function i_(e,t){const n=t-e;let i=ki(n);for(;wc(e,t,i)>10;)i++;for(;wc(e,t,i)<10;)i--;return Math.min(i,ki(e))}function s_(e,{min:t,max:n}){t=Lt(e.min,t);const i=[],s=ki(t);let o=i_(t,n),r=o<0?Math.pow(10,Math.abs(o)):1;const a=Math.pow(10,o),l=s>o?Math.pow(10,s):0,c=Math.round((t-l)*r)/r,d=Math.floor((t-l)/a/10)*a*10;let u=Math.floor((c-d)/Math.pow(10,o)),h=Lt(e.min,Math.round((l+d+u*Math.pow(10,o))*r)/r);for(;h<n;)i.push({value:h,major:_c(h),significand:u}),u>=10?u=u<15?15:20:u++,u>=20&&(o++,u=2,r=o>=0?1:r),h=Math.round((l+d+u*Math.pow(10,o))*r)/r;const f=Lt(e.max,h);return i.push({value:f,major:_c(f),significand:u}),i}class Er extends tn{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,n){const i=Zs.prototype.parse.apply(this,[t,n]);if(i===0){this._zero=!0;return}return ot(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!0);this.min=ot(t)?Math.max(0,t):null,this.max=ot(n)?Math.max(0,n):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!ot(this._userMin)&&(this.min=t===ze(this.min,0)?ze(this.min,-1):ze(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:n}=this.getUserBounds();let i=this.min,s=this.max;const o=a=>i=t?i:a,r=a=>s=n?s:a;i===s&&(i<=0?(o(1),r(10)):(o(ze(i,-1)),r(ze(s,1)))),i<=0&&o(ze(s,-1)),s<=0&&r(ze(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,n={min:this._userMin,max:this._userMax},i=s_(n,this);return t.bounds==="ticks"&&Kd(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":Ri(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=ke(t),this._valueRange=ke(this.max)-ke(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(ke(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const n=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+n*this._valueRange)}}I(Er,"id","logarithmic"),I(Er,"defaults",{ticks:{callback:so.formatters.logarithmic,major:{enabled:!0}}});function Ir(e){const t=e.ticks;if(t.display&&e.display){const n=wt(t.backdropPadding);return P(t.font&&t.font.size,nt.font.size)+n.height}return 0}function o_(e,t,n){return n=et(n)?n:[n],{w:u0(e,t.string,n),h:n.length*t.lineHeight}}function kc(e,t,n,i,s){return e===i||e===s?{start:t-n/2,end:t+n/2}:e<i||e>s?{start:t-n,end:t}:{start:t,end:t+n}}function r_(e){const t={l:e.left+e._padding.left,r:e.right-e._padding.right,t:e.top+e._padding.top,b:e.bottom-e._padding.bottom},n=Object.assign({},t),i=[],s=[],o=e._pointLabels.length,r=e.options.pointLabels,a=r.centerPointLabels?U/o:0;for(let l=0;l<o;l++){const c=r.setContext(e.getPointLabelContext(l));s[l]=c.padding;const d=e.getPointPosition(l,e.drawingArea+s[l],a),u=dt(c.font),h=o_(e.ctx,u,e._pointLabels[l]);i[l]=h;const f=xt(e.getIndexAngle(l)+a),g=Math.round(Zr(f)),p=kc(g,d.x,h.w,0,180),m=kc(g,d.y,h.h,90,270);a_(n,t,f,p,m)}e.setCenterPoint(t.l-n.l,n.r-t.r,t.t-n.t,n.b-t.b),e._pointLabelItems=d_(e,i,s)}function a_(e,t,n,i,s){const o=Math.abs(Math.sin(n)),r=Math.abs(Math.cos(n));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/o,e.l=Math.min(e.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/o,e.r=Math.max(e.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/r,e.t=Math.min(e.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/r,e.b=Math.max(e.b,t.b+l))}function l_(e,t,n){const i=e.drawingArea,{extra:s,additionalAngle:o,padding:r,size:a}=n,l=e.getPointPosition(t,i+s+r,o),c=Math.round(Zr(xt(l.angle+at))),d=f_(l.y,a.h,c),u=u_(c),h=h_(l.x,a.w,u);return{visible:!0,x:l.x,y:d,textAlign:u,left:h,top:d,right:h+a.w,bottom:d+a.h}}function c_(e,t){if(!t)return!0;const{left:n,top:i,right:s,bottom:o}=e;return!(ae({x:n,y:i},t)||ae({x:n,y:o},t)||ae({x:s,y:i},t)||ae({x:s,y:o},t))}function d_(e,t,n){const i=[],s=e._pointLabels.length,o=e.options,{centerPointLabels:r,display:a}=o.pointLabels,l={extra:Ir(o)/2,additionalAngle:r?U/s:0};let c;for(let d=0;d<s;d++){l.padding=n[d],l.size=t[d];const u=l_(e,d,l);i.push(u),a==="auto"&&(u.visible=c_(u,c),u.visible&&(c=u))}return i}function u_(e){return e===0||e===180?"center":e<180?"left":"right"}function h_(e,t,n){return n==="right"?e-=t:n==="center"&&(e-=t/2),e}function f_(e,t,n){return n===90||n===270?e-=t/2:(n>270||n<90)&&(e-=t),e}function g_(e,t,n){const{left:i,top:s,right:o,bottom:r}=n,{backdropColor:a}=t;if(!N(a)){const l=Ge(t.borderRadius),c=wt(t.backdropPadding);e.fillStyle=a;const d=i-c.left,u=s-c.top,h=o-i+c.width,f=r-s+c.height;Object.values(l).some(g=>g!==0)?(e.beginPath(),_i(e,{x:d,y:u,w:h,h:f,radius:l}),e.fill()):e.fillRect(d,u,h,f)}}function p_(e,t){const{ctx:n,options:{pointLabels:i}}=e;for(let s=t-1;s>=0;s--){const o=e._pointLabelItems[s];if(!o.visible)continue;const r=i.setContext(e.getPointLabelContext(s));g_(n,r,o);const a=dt(r.font),{x:l,y:c,textAlign:d}=o;Je(n,e._pointLabels[s],l,c+a.lineHeight/2,a,{color:r.color,textAlign:d,textBaseline:"middle"})}}function zu(e,t,n,i){const{ctx:s}=e;if(n)s.arc(e.xCenter,e.yCenter,t,0,Q);else{let o=e.getPointPosition(0,t);s.moveTo(o.x,o.y);for(let r=1;r<i;r++)o=e.getPointPosition(r,t),s.lineTo(o.x,o.y)}}function m_(e,t,n,i,s){const o=e.ctx,r=t.circular,{color:a,lineWidth:l}=t;!r&&!i||!a||!l||n<0||(o.save(),o.strokeStyle=a,o.lineWidth=l,o.setLineDash(s.dash||[]),o.lineDashOffset=s.dashOffset,o.beginPath(),zu(e,n,r,i),o.closePath(),o.stroke(),o.restore())}function b_(e,t,n){return Ae(e,{label:n,index:t,type:"pointLabel"})}class qn extends Zs{constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=wt(Ir(this.options)/2),n=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+n/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(n,i)/2)}determineDataLimits(){const{min:t,max:n}=this.getMinMax(!1);this.min=ot(t)&&!isNaN(t)?t:0,this.max=ot(n)&&!isNaN(n)?n:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ir(this.options))}generateTickLabels(t){Zs.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((n,i)=>{const s=Z(this.options.pointLabels.callback,[n,i],this);return s||s===0?s:""}).filter((n,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?r_(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,n,i,s){this.xCenter+=Math.floor((t-n)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,n,i,s))}getIndexAngle(t){const n=Q/(this._pointLabels.length||1),i=this.options.startAngle||0;return xt(t*n+jt(i))}getDistanceFromCenterForValue(t){if(N(t))return NaN;const n=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*n:(t-this.min)*n}getValueForDistanceFromCenter(t){if(N(t))return NaN;const n=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-n:this.min+n}getPointLabelContext(t){const n=this._pointLabels||[];if(t>=0&&t<n.length){const i=n[t];return b_(this.getContext(),t,i)}}getPointPosition(t,n,i=0){const s=this.getIndexAngle(t)-at+i;return{x:Math.cos(s)*n+this.xCenter,y:Math.sin(s)*n+this.yCenter,angle:s}}getPointPositionForValue(t,n){return this.getPointPosition(t,this.getDistanceFromCenterForValue(n))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:n,top:i,right:s,bottom:o}=this._pointLabelItems[t];return{left:n,top:i,right:s,bottom:o}}drawBackground(){const{backgroundColor:t,grid:{circular:n}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),zu(this,this.getDistanceFromCenterForValue(this._endValue),n,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,n=this.options,{angleLines:i,grid:s,border:o}=n,r=this._pointLabels.length;let a,l,c;if(n.pointLabels.display&&p_(this,r),s.display&&this.ticks.forEach((d,u)=>{if(u!==0||u===0&&this.min<0){l=this.getDistanceFromCenterForValue(d.value);const h=this.getContext(u),f=s.setContext(h),g=o.setContext(h);m_(this,f,l,r,g)}}),i.display){for(t.save(),a=r-1;a>=0;a--){const d=i.setContext(this.getPointLabelContext(a)),{color:u,lineWidth:h}=d;!h||!u||(t.lineWidth=h,t.strokeStyle=u,t.setLineDash(d.borderDash),t.lineDashOffset=d.borderDashOffset,l=this.getDistanceFromCenterForValue(n.reverse?this.min:this.max),c=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(c.x,c.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,n=this.options,i=n.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let o,r;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!n.reverse)return;const c=i.setContext(this.getContext(l)),d=dt(c.font);if(o=this.getDistanceFromCenterForValue(this.ticks[l].value),c.showLabelBackdrop){t.font=d.string,r=t.measureText(a.label).width,t.fillStyle=c.backdropColor;const u=wt(c.backdropPadding);t.fillRect(-r/2-u.left,-o-d.size/2-u.top,r+u.width,d.size+u.height)}Je(t,a.label,0,-o,d,{color:c.color,strokeColor:c.textStrokeColor,strokeWidth:c.textStrokeWidth})}),t.restore()}drawTitle(){}}I(qn,"id","radialLinear"),I(qn,"defaults",{display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:so.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}}),I(qn,"defaultRoutes",{"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"}),I(qn,"descriptors",{angleLines:{_fallback:"grid"}});const uo={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Tt=Object.keys(uo);function Sc(e,t){return e-t}function Ec(e,t){if(N(t))return null;const n=e._adapter,{parser:i,round:s,isoWeekday:o}=e._parseOpts;let r=t;return typeof i=="function"&&(r=i(r)),ot(r)||(r=typeof i=="string"?n.parse(r,i):n.parse(r)),r===null?null:(s&&(r=s==="week"&&(vn(o)||o===!0)?n.startOf(r,"isoWeek",o):n.startOf(r,s)),+r)}function Ic(e,t,n,i){const s=Tt.length;for(let o=Tt.indexOf(e);o<s-1;++o){const r=uo[Tt[o]],a=r.steps?r.steps:Number.MAX_SAFE_INTEGER;if(r.common&&Math.ceil((n-t)/(a*r.size))<=i)return Tt[o]}return Tt[s-1]}function y_(e,t,n,i,s){for(let o=Tt.length-1;o>=Tt.indexOf(n);o--){const r=Tt[o];if(uo[r].common&&e._adapter.diff(s,i,r)>=t-1)return r}return Tt[n?Tt.indexOf(n):0]}function v_(e){for(let t=Tt.indexOf(e)+1,n=Tt.length;t<n;++t)if(uo[Tt[t]].common)return Tt[t]}function Dc(e,t,n){if(!n)e[t]=!0;else if(n.length){const{lo:i,hi:s}=Qr(n,t),o=n[i]>=t?n[i]:n[s];e[o]=!0}}function x_(e,t,n,i){const s=e._adapter,o=+s.startOf(t[0].value,i),r=t[t.length-1].value;let a,l;for(a=o;a<=r;a=+s.add(a,1,i))l=n[a],l>=0&&(t[l].major=!0);return t}function Tc(e,t,n){const i=[],s={},o=t.length;let r,a;for(r=0;r<o;++r)a=t[r],s[a]=r,i.push({value:a,major:!1});return o===0||!n?i:x_(e,i,s,n)}class Si extends tn{constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,n={}){const i=t.time||(t.time={}),s=this._adapter=new Ty._date(t.adapters.date);s.init(n),ai(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=n.normalized}parse(t,n){return t===void 0?null:Ec(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,n=this._adapter,i=t.time.unit||"day";let{min:s,max:o,minDefined:r,maxDefined:a}=this.getUserBounds();function l(c){!r&&!isNaN(c.min)&&(s=Math.min(s,c.min)),!a&&!isNaN(c.max)&&(o=Math.max(o,c.max))}(!r||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=ot(s)&&!isNaN(s)?s:+n.startOf(Date.now(),i),o=ot(o)&&!isNaN(o)?o:+n.endOf(Date.now(),i)+1,this.min=Math.min(s,o-1),this.max=Math.max(s+1,o)}_getLabelBounds(){const t=this.getLabelTimestamps();let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(n=t[0],i=t[t.length-1]),{min:n,max:i}}buildTicks(){const t=this.options,n=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const o=this.min,r=this.max,a=Zb(s,o,r);return this._unit=n.unit||(i.autoSkip?Ic(n.minUnit,this.min,this.max,this._getLabelCapacity(o)):y_(this,a.length,n.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:v_(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Tc(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let n=0,i=0,s,o;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?n=1-s:n=(this.getDecimalForValue(t[1])-s)/2,o=this.getDecimalForValue(t[t.length-1]),t.length===1?i=o:i=(o-this.getDecimalForValue(t[t.length-2]))/2);const r=t.length<3?.5:.25;n=gt(n,0,r),i=gt(i,0,r),this._offsets={start:n,end:i,factor:1/(n+1+i)}}_generate(){const t=this._adapter,n=this.min,i=this.max,s=this.options,o=s.time,r=o.unit||Ic(o.minUnit,n,i,this._getLabelCapacity(n)),a=P(s.ticks.stepSize,1),l=r==="week"?o.isoWeekday:!1,c=vn(l)||l===!0,d={};let u=n,h,f;if(c&&(u=+t.startOf(u,"isoWeek",l)),u=+t.startOf(u,c?"day":r),t.diff(i,n,r)>1e5*a)throw new Error(n+" and "+i+" are too far apart with stepSize of "+a+" "+r);const g=s.ticks.source==="data"&&this.getDataTimestamps();for(h=u,f=0;h<i;h=+t.add(h,a,r),f++)Dc(d,h,g);return(h===i||s.bounds==="ticks"||f===1)&&Dc(d,h,g),Object.keys(d).sort(Sc).map(p=>+p)}getLabelForValue(t){const n=this._adapter,i=this.options.time;return i.tooltipFormat?n.format(t,i.tooltipFormat):n.format(t,i.displayFormats.datetime)}format(t,n){const s=this.options.time.displayFormats,o=this._unit,r=n||s[o];return this._adapter.format(t,r)}_tickFormatFunction(t,n,i,s){const o=this.options,r=o.ticks.callback;if(r)return Z(r,[t,n,i],this);const a=o.time.displayFormats,l=this._unit,c=this._majorUnit,d=l&&a[l],u=c&&a[c],h=i[n],f=c&&u&&h&&h.major;return this._adapter.format(t,s||(f?u:d))}generateTickLabels(t){let n,i,s;for(n=0,i=t.length;n<i;++n)s=t[n],s.label=this._tickFormatFunction(s.value,n,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const n=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((n.start+i)*n.factor)}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const n=this.options.ticks,i=this.ctx.measureText(t).width,s=jt(this.isHorizontal()?n.maxRotation:n.minRotation),o=Math.cos(s),r=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*o+a*r,h:i*r+a*o}}_getLabelCapacity(t){const n=this.options.time,i=n.displayFormats,s=i[n.unit]||i.millisecond,o=this._tickFormatFunction(t,0,Tc(this,[t],this._majorUnit),s),r=this._getLabelSize(o),a=Math.floor(this.isHorizontal()?this.width/r.w:this.height/r.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],n,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(n=0,i=s.length;n<i;++n)t=t.concat(s[n].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let n,i;if(t.length)return t;const s=this.getLabels();for(n=0,i=s.length;n<i;++n)t.push(Ec(this,s[n]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Qd(t.sort(Sc))}}I(Si,"id","time"),I(Si,"defaults",{bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}});function rs(e,t,n){let i=0,s=e.length-1,o,r,a,l;n?(t>=e[i].pos&&t<=e[s].pos&&({lo:i,hi:s}=re(e,"pos",t)),{pos:o,time:a}=e[i],{pos:r,time:l}=e[s]):(t>=e[i].time&&t<=e[s].time&&({lo:i,hi:s}=re(e,"time",t)),{time:o,pos:a}=e[i],{time:r,pos:l}=e[s]);const c=r-o;return c?a+(l-a)*(t-o)/c:a}class Dr extends Si{constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),n=this._table=this.buildLookupTable(t);this._minPos=rs(n,this.min),this._tableRange=rs(n,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:n,max:i}=this,s=[],o=[];let r,a,l,c,d;for(r=0,a=t.length;r<a;++r)c=t[r],c>=n&&c<=i&&s.push(c);if(s.length<2)return[{time:n,pos:0},{time:i,pos:1}];for(r=0,a=s.length;r<a;++r)d=s[r+1],l=s[r-1],c=s[r],Math.round((d+l)/2)!==c&&o.push({time:c,pos:r/(a-1)});return o}_generate(){const t=this.min,n=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(n)||i.length===1)&&i.push(n),i.sort((s,o)=>s-o)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const n=this.getDataTimestamps(),i=this.getLabelTimestamps();return n.length&&i.length?t=this.normalize(n.concat(i)):t=n.length?n:i,t=this._cache.all=t,t}getDecimalForValue(t){return(rs(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const n=this._offsets,i=this.getDecimalForPixel(t)/n.factor-n.end;return rs(this._table,i*this._tableRange+this._minPos,!0)}}I(Dr,"id","timeseries"),I(Dr,"defaults",Si.defaults);var __=Object.freeze({__proto__:null,CategoryScale:kr,LinearScale:Sr,LogarithmicScale:Er,RadialLinearScale:qn,TimeScale:Si,TimeSeriesScale:Dr});const w_=[Dy,ix,Zx,__];se.register(...w_);function ho(e,t=""){return`
        <div class="bg-white/70 dark:bg-gray-900/60 backdrop-blur-md rounded-2xl shadow-xl border border-white/20 dark:border-gray-800/30 ${t}">
            ${e}
        </div>
    `}const le={COLORS:{daily:"#3B82F6",weekly:"#10B981",monthly:"#8B5CF6"},KPI_ITEMS:[{id:"today-count",label:"今日の完了",color:"text-blue-600"},{id:"weekly-count",label:"今週の完了",color:"text-green-600"},{id:"monthly-count",label:"今月の完了",color:"text-purple-600"},{id:"total-count",label:"全期間",color:"text-gray-600"}],CHARTS:[{id:"daily",label:"日次推移 (直近7日)",dot:"bg-blue-500",fullWidth:!1},{id:"weekly",label:"週次推移",dot:"bg-green-500",fullWidth:!1},{id:"monthly",label:"月次推移",dot:"bg-purple-500",fullWidth:!0}],CLASSES:{KPI_CARD:"p-3 flex flex-col items-center justify-center hover:scale-[1.02] transition-transform",CHART_CARD:"p-3 h-64 flex flex-col",CHART_CONTAINER:"relative flex-1 min-h-0 w-full"},CHART_DEFAULTS:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}}}};function Ei(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"};return e.replace(/[&<>"']/g,n=>t[n])}function k_(e,t,n,i){return ho(`
        <span class="text-[10px] font-bold text-gray-400 dark:text-gray-500 uppercase tracking-wider mb-0.5">${Ei(e)}</span>
        <span id="${n}" class="text-2xl font-bold ${i} dark:text-white font-mono tracking-tight">${Ei(t)}</span>
    `,le.CLASSES.KPI_CARD)}function ju(){return`
        <div class="space-y-4 animate-fade-in p-1">
            <h2 class="text-xl font-bold text-gray-800 dark:text-white px-1 mb-2">ダッシュボード</h2>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
                ${le.KPI_ITEMS.map(e=>k_(e.label,"-",e.id,e.color)).join("")}
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                ${le.CHARTS.map(e=>ho(`
                    <h3 class="text-xs font-semibold text-gray-500 dark:text-gray-400 uppercase tracking-wider mb-2 flex items-center gap-1.5">
                        <span class="w-1.5 h-1.5 rounded-full ${e.dot}"></span> ${Ei(e.label)}
                    </h3>
                    <div class="${le.CLASSES.CHART_CONTAINER}">
                        <canvas id="${e.id}Chart"></canvas>
                    </div>
                `,`${le.CLASSES.CHART_CARD} ${e.fullWidth?"md:col-span-2":""}`)).join("")}
            </div>
        </div>
    `}function S_(e=[]){const i=`
        <div class="flex flex-col md:flex-row gap-4">
            <div class="flex-1">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">キーワード</label>
                <input type="text" id="page-search-input" placeholder="タスク名を入力..." 
                    class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white placeholder-gray-400 text-sm">
            </div>
            <div class="md:w-1/3">
                <label class="block text-xs font-bold text-gray-500 dark:text-gray-300 uppercase mb-2">プロジェクト</label>
                <div class="relative">
                    <select id="page-search-project" class="w-full px-4 py-2.5 bg-white/50 dark:bg-gray-800/40 border border-white/30 dark:border-gray-700/50 rounded-lg focus:ring-2 focus:ring-blue-500 outline-none text-gray-800 dark:text-white text-sm appearance-none cursor-pointer">
                        <option value="">全てのプロジェクト</option>
                        ${(Array.isArray(e)?e:[]).map(s=>`<option value="${Ei(s.id)}">${Ei(s.name)}</option>`).join("")}
                    </select>
                </div>
            </div>
        </div>
    `;return`
        <div class="max-w-3xl mx-auto mt-4">
            <h2 class="text-xl font-bold mb-6 text-gray-800 dark:text-white flex items-center gap-2 px-1">
                <svg class="w-6 h-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                タスク検索
            </h2>
            ${ho(i,"p-8 mb-8")}
            <div id="search-results-container"></div>
        </div>
    `}function E_(){return`
        <div class="text-center text-gray-400 py-16 flex flex-col items-center">
            <svg class="w-12 h-12 mb-3 text-gray-300 dark:text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
            </svg>
            <span class="text-sm font-medium">キーワードを入力してタスクを検索</span>
        </div>
    `}function I_(){return`
        <div class="text-center text-gray-400 py-12 flex flex-col items-center">
            <span class="text-sm">一致するタスクが見つかりませんでした</span>
        </div>
    `}const Mc=new WeakMap;function D_(e){const t=document.getElementById("dashboard-view");if(!e||!t)return;t.innerHTML=ju();const n=e.filter(s=>s.status==="completed"&&s.completedAt);T_(n),[{id:"daily",color:le.COLORS.daily,count:7,unit:"day"},{id:"weekly",color:le.COLORS.weekly,count:4,unit:"week"},{id:"monthly",color:le.COLORS.monthly,count:6,unit:"month"}].forEach(s=>{const{labels:o,data:r}=M_(n,s.count,s.unit);C_(s.id,o,r,s.color)})}function T_(e){const t=new Date,n=En(t).getTime(),i=hd(t).getTime(),s=Hg(t).getTime(),o=e.reduce((r,a)=>{const l=fe(a.completedAt);if(!l)return r;const c=l.getTime();return c>=n&&r.today++,c>=i&&r.weekly++,c>=s&&r.monthly++,r},{today:0,weekly:0,monthly:0,total:e.length});Object.entries(o).forEach(([r,a])=>{const l=document.getElementById(`${r}-count`);l&&(l.textContent=a)})}function M_(e,t,n){const i=[],s=[],o=new Date;for(let r=0;r<t;r++){let a,l,c;const d=new Date(o);n==="day"?(d.setDate(o.getDate()-(t-1-r)),a=En(d),l=Fg(d),c=`${a.getMonth()+1}/${a.getDate()}`):n==="week"?(d.setDate(o.getDate()-(t-1-r)*7),a=hd(d),l=new Date(a),l.setDate(a.getDate()+6),c=`${a.getMonth()+1}/${a.getDate()}`):(a=new Date(o.getFullYear(),o.getMonth()-(t-1-r),1),l=new Date(a.getFullYear(),a.getMonth()+1,0),c=`${a.getFullYear()}/${a.getMonth()+1}`);const u=e.filter(h=>{const f=fe(h.completedAt);return f&&f>=a&&f<=l}).length;i.push(c),s.push(u)}return{labels:i,data:s}}function C_(e,t,n,i){const s=document.getElementById(`${e}Chart`);if(!s)return;let o=Mc.get(s);o?(o.data.labels=t,o.data.datasets[0].data=n,o.update()):(o=new se(s.getContext("2d"),{type:"bar",data:{labels:t,datasets:[{data:n,backgroundColor:i,borderRadius:4}]},options:le.CHART_DEFAULTS}),Mc.set(s,o))}function A_(e,t,n){var r;(r=document.getElementById("task-context-menu"))==null||r.remove();const i=document.createElement("div");i.id="task-context-menu",i.className="fixed bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-lg shadow-xl py-1 z-50 animate-fade-in text-sm min-w-[150px]",i.style.left=`${t}px`,i.style.top=`${n}px`,i.innerHTML=`
        <div class="border-b border-gray-100 dark:border-gray-700 pb-1 mb-1">
             <button id="ctx-today" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
                今日
            </button>
            <button id="ctx-tomorrow" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-orange-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                明日
            </button>
            <button id="ctx-next-week" class="flex w-full items-center px-3 py-2 text-left text-gray-700 dark:text-gray-200 hover:bg-gray-100 dark:hover:bg-gray-700 transition">
                <svg class="w-4 h-4 mr-2 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 5l7 7-7 7M5 5l7 7-7 7"></path></svg>
                来週
            </button>
        </div>
        <button id="ctx-delete-task-btn" class="flex w-full items-center px-3 py-2 text-left text-red-600 hover:bg-red-50 dark:hover:bg-red-900/50 transition">
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path></svg>
            削除
        </button>
    `,document.body.appendChild(i);const s=a=>{i.remove(),a()};i.querySelector("#ctx-today").addEventListener("click",()=>{s(()=>Zn(e.id,{dueDate:new Date}))}),i.querySelector("#ctx-tomorrow").addEventListener("click",()=>{const a=new Date;a.setDate(a.getDate()+1),s(()=>Zn(e.id,{dueDate:a}))}),i.querySelector("#ctx-next-week").addEventListener("click",()=>{const a=new Date;a.setDate(a.getDate()+(8-a.getDay())),s(()=>Zn(e.id,{dueDate:a}))}),i.querySelector("#ctx-delete-task-btn").addEventListener("click",()=>{s(()=>L("削除しますか？",async()=>await gd(e.id)))});const o=a=>{i.contains(a.target)||(i.remove(),document.removeEventListener("click",o))};setTimeout(()=>document.addEventListener("click",o),0)}function L_(e){const t=document.createElement("li");t.setAttribute("data-id",e.id),t.setAttribute("draggable","true");const n=e.status==="completed",i=$g(e.dueDate),s=zg(e.dueDate),o=!!e.recurrence,r=!!e.dueDate&&!o,a=ue(),l=e.timeBlockId?a.find(c=>c.id===e.timeBlockId):null;return t.className=`group flex items-start gap-2 sm:gap-3 py-2 px-2 rounded -mx-2 transition-all duration-200 cursor-default border border-transparent ${n?"opacity-60 bg-gray-50 dark:bg-gray-900/50":"hover:bg-gray-50 dark:hover:bg-gray-800/50 hover:border-gray-100 dark:hover:border-gray-700"}`,t.innerHTML=`
        <div class="task-drag-handle mt-1 text-gray-300 dark:text-gray-600 opacity-0 group-hover:opacity-100 cursor-grab active:cursor-grabbing hidden sm:block mr-1">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8h16M4 16h16"></path></svg>
        </div>

        <div class="task-checkbox mt-0.5 w-5 h-5 rounded-full border flex items-center justify-center flex-shrink-0 transition-colors z-10 cursor-pointer ${n?"bg-blue-500 border-blue-500 text-white":"border-gray-400 dark:border-gray-500 hover:border-blue-500 dark:hover:border-blue-400 bg-white dark:bg-transparent text-transparent hover:text-blue-500"}">
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
        </div>
        
        <div class="flex-1 min-w-0 grid grid-cols-1 sm:grid-cols-12 gap-1 sm:gap-2 items-center">
            <div class="col-span-1 sm:col-span-7 flex flex-col justify-center">
                <div class="leading-snug truncate font-medium transition-colors ${n?"line-through text-gray-500 dark:text-gray-500":"text-gray-800 dark:text-gray-200"}">${e.title}</div>
                ${e.description?`<div class="text-xs text-gray-400 truncate mt-0.5 font-light">${e.description}</div>`:""}
            </div>
            
            <div class="col-span-1 sm:col-span-5 flex items-center sm:justify-end space-x-2 text-xs h-full mt-1 sm:mt-0 overflow-hidden">
                ${o?'<div class="text-blue-500 dark:text-blue-400 flex-shrink-0" title="繰り返し">🔁</div>':""}
                ${r?'<div class="text-gray-400 dark:text-gray-500 flex-shrink-0" title="期限あり">▶️</div>':""}
                
                ${l?`
                    <div class="flex items-center px-2 py-0.5 rounded bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 max-w-[140px]" title="${l.start} - ${l.end}">
                        <span class="w-2 h-2 rounded-full mr-1.5 flex-shrink-0" style="background-color: ${l.color}"></span>
                        <span class="truncate font-mono text-[11px]">${l.start} - ${l.end}</span>
                    </div>
                `:""}

                ${e.duration?`
                    <div class="flex items-center text-gray-500 dark:text-gray-400 whitespace-nowrap" title="所要時間: ${e.duration}分">
                        <span class="mr-0.5 text-[10px]">⏱️</span>${e.duration}m
                    </div>
                `:""}

                ${i?`<div class="flex items-center ${s} bg-gray-50 dark:bg-gray-800/50 px-1.5 py-0.5 rounded flex-shrink-0">${i}</div>`:""}
            </div>
        </div>
    `,t.addEventListener("dragstart",c=>{t.classList.add("opacity-50"),c.dataTransfer.setData("text/plain",e.id),c.dataTransfer.effectAllowed="move"}),t.addEventListener("dragend",()=>t.classList.remove("opacity-50")),t.querySelector(".task-checkbox").addEventListener("click",async c=>{c.stopPropagation(),await Wg(e.id,n?"todo":"completed")}),t.addEventListener("click",c=>{!c.target.closest(".task-checkbox")&&!c.target.closest(".task-drag-handle")&&tm(e)}),t.addEventListener("contextmenu",c=>{c.preventDefault(),c.stopPropagation(),A_(e,c.clientX,c.clientY)}),t}function Vu(e,t){if(!e)return;const n=document.createElement("ul");if(n.id="task-list-ul",n.className="divide-y divide-gray-100 dark:divide-gray-800 border-b border-gray-100 dark:border-gray-800 mb-2",!t||t.length===0)n.innerHTML=`
            <li class="py-16 text-center text-gray-400 text-sm list-none">
                タスクがありません
            </li>
        `;else{const i=document.createDocumentFragment();t.forEach(s=>{i.appendChild(L_(s))}),n.appendChild(i)}e.innerHTML="",e.appendChild(n)}function da(e,t,n){if(!(e.dataset.expanded==="true")){e.innerHTML=`
            <div id="show-input-btn" class="flex items-center text-gray-500 hover:text-red-500 cursor-pointer py-2 px-1 rounded hover:bg-gray-50 dark:hover:bg-gray-800/50 transition group select-none">
                <div class="w-6 h-6 mr-2 rounded-full text-red-500 flex items-center justify-center transition-transform group-hover:scale-110">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path></svg>
                </div>
                <div class="text-sm font-medium">タスクを追加</div>
            </div>
        `,e.querySelector("#show-input-btn").onclick=()=>{e.dataset.expanded="true",da(e,t,n)};return}const o=`
        <div class="flex flex-col gap-2">
            <input type="text" id="inline-title-input" placeholder="タスク名" class="w-full text-sm font-semibold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100">
            <textarea id="inline-desc-input" placeholder="詳細メモ" rows="2" class="w-full text-xs bg-transparent border-none outline-none text-gray-600 dark:text-gray-300 resize-none"></textarea>
            
            <div class="flex items-center justify-between border-t border-gray-100 dark:border-gray-700/50 pt-3">
                <select id="inline-timeblock-select" class="bg-transparent text-xs text-gray-500 border border-gray-200 dark:border-gray-600/50 rounded px-2 py-1 cursor-pointer">
                    <option value="">時間帯 (未定)</option>
                    ${ue().map(r=>`<option value="${r.id}">${r.start} - ${r.end}</option>`).join("")}
                </select>
                <div class="flex gap-2">
                    <button id="cancel-input-btn" class="text-xs text-gray-500 px-3 py-1.5 hover:text-gray-800 transition">キャンセル</button>
                    <button id="submit-task-btn" class="bg-red-600 hover:bg-red-700 text-white text-xs font-bold px-4 py-1.5 rounded transition-colors shadow-sm">タスクを追加</button>
                </div>
            </div>
        </div>
    `;e.innerHTML=ho(o,"p-3 animate-fade-in-down"),O_(e,t,n)}function O_(e,t,n){const i=e.querySelector("#inline-title-input"),s=e.querySelector("#submit-task-btn"),o=e.querySelector("#cancel-input-btn"),r=e.querySelector("#inline-desc-input"),a=e.querySelector("#inline-timeblock-select");i.focus(),o.onclick=()=>{e.dataset.expanded="false",da(e,t,n)};const l=async()=>{const c=i.value.trim();c&&(s.disabled=!0,await P_({title:c,description:r.value.trim(),projectId:t,labelIds:n?[n]:[],timeBlockId:a.value||null}),i.value="",r.value="",i.focus(),s.disabled=!1)};s.onclick=l,i.onkeydown=c=>{c.key==="Enter"&&!c.isComposing&&l()}}async function P_(e){try{await Ug(e)}catch(t){console.error(t),L({message:"タスクの追加に失敗した: "+(t.message||"不明なエラー"),type:"error"})}}function R_(e,t="createdAt_desc"){return Array.isArray(e)?[...e].sort((n,i)=>{switch(t){case"createdAt_asc":return Go(n.createdAt,i.createdAt);case"createdAt_desc":return Go(i.createdAt,n.createdAt);case"dueDate_asc":return as(n.dueDate,i.dueDate,(s,o)=>Go(s,o));case"timeBlockId_asc":return as(n.timeBlockId,i.timeBlockId,(s,o)=>String(s).localeCompare(String(o)));case"projectId_asc":return as(n.projectId,i.projectId,(s,o)=>String(s).localeCompare(String(o)));case"duration_asc":return as(n.duration,i.duration,(s,o)=>Number(s)-Number(o));case"title_asc":return(n.title||"").localeCompare(i.title||"","ja");default:return 0}}):[]}function Go(e,t){const n=i=>{if(!i)return 0;if(i.toDate)return i.toDate().getTime();if(i instanceof Date)return i.getTime();const s=new Date(i);return isNaN(s.getTime())?0:s.getTime()};return n(e)-n(t)}function as(e,t,n){return e===t?0:e==null||e==="null"?1:t==null||t==="null"?-1:n(e,t)}function B_(e,t,n=[],i=null,s=null){const o=document.getElementById("task-view");if(!o)return;N_(e.length,i,s,t,n);const r=document.getElementById("sort-select"),a=document.getElementById("sort-trigger");let l="createdAt_desc";r?l=r.value:a&&a.dataset.value&&(l=a.dataset.value);const c=R_(e,l);o.innerHTML="";const d=document.createElement("div");d.id="task-list-container",o.appendChild(d),Vu(d,c);const u=document.createElement("div");u.id="inline-input-container",u.className="mt-2 pb-10",o.appendChild(u),da(u,i,s)}function N_(e,t,n,i,s){const o=document.getElementById("header-title"),r=document.getElementById("header-count");if(o){let a="インボックス";if(t){const l=i.find(c=>c.id===t);a=l?l.name:"プロジェクト"}else if(n){const l=s.find(c=>c.id===n);a=l?`${l.name}`:"ラベル"}o.textContent=a}r&&(r.textContent=`${e}件`)}let Bt={};function F_(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function H_(e){Bt={input:e.querySelector("#page-search-input"),select:e.querySelector("#page-search-project"),results:e.querySelector("#search-results-container")}}function $_(e,t,n,i,s){var r;if(vs(e,t),e.innerHTML=S_(i),H_(e),!Bt.input||!Bt.results)return;const o=F_(()=>Cc(n),300);Bt.input.addEventListener("input",o),(r=Bt.select)==null||r.addEventListener("change",()=>Cc(n)),Ud({type:"search"}),Vd(),requestAnimationFrame(()=>Bt.input.focus())}function Cc(e){var s;const t=Bt.input.value.trim().toLowerCase(),n=((s=Bt.select)==null?void 0:s.value)||null;if(!t){Bt.results.innerHTML=E_();return}const i=Us(e,{keyword:t,projectId:n,showCompleted:!0});i.length===0?Bt.results.innerHTML=I_():(Bt.results.innerHTML="",Vu(Bt.results,i))}let It={type:"inbox",id:null},bt=null;const Ac={SORT:"sort-trigger",COMPLETED_TOGGLE:"toggle-completed-btn"};function z_(){if(bt)return;const{VIEW_IDS:e}=qr;bt={task:document.getElementById(e.TASK),dashboard:document.getElementById(e.DASHBOARD),search:document.getElementById(e.SEARCH),settings:document.getElementById(e.SETTINGS)}}function ls(e,t=[],n=[]){if(e.type==="settings"){no();return}It=e,hb(It),Ud(It,t,n)}function j_(e,t,n){if(z_(),!bt.task||!bt.dashboard||!bt.search)return;const i=document.getElementById(Ac.SORT),s=(i==null?void 0:i.dataset.value)||"createdAt_desc",o=[bt.task,bt.dashboard,bt.search,bt.settings];if(It.type==="dashboard"){vs(bt.dashboard,o.filter(d=>d!==bt.dashboard)),bt.dashboard.innerHTML=ju(),D_(e);return}if(It.type==="search"){vs(bt.search,o.filter(d=>d!==bt.search)),$_(bt.search,e,t,It);return}vs(bt.task,o.filter(d=>d!==bt.task));const r=document.getElementById(Ac.COMPLETED_TOGGLE),l={keyword:"",showCompleted:r?r.classList.contains("text-blue-500"):!1,projectId:It.type==="project"?It.id:null,labelId:It.type==="label"?It.id:null,timeBlockId:It.type==="timeblock"?It.id:null,duration:It.type==="duration"?It.id:null,sortCriteria:s},c=Jm(e,l);B_(c,t,n,l.projectId,l.labelId)}const zt={tasks:null,projects:null,labels:null,timeBlocks:null,filters:null,workspaces:null};let Tr=!1,Xo=null;function mn(){Xo||(Xo=requestAnimationFrame(()=>{const e=Ko.tasks(),t=Ko.projects(),n=Ko.labels();j_(e,t,n),Xo=null}))}function Bn(e){document.dispatchEvent(new CustomEvent(e)),mn()}function V_(e){if(!(V!=null&&V.currentUser)){console.warn("[DataSync] No authenticated user. Cannot start subscriptions.");return}ua(!1);const t=Zt();if(!t){console.warn("[DataSync] No workspace selected. Waiting for workspace selection...");return}Tr=!0,console.log("[DataSync] Starting subscriptions for workspace:",t),zt.tasks=mp(t,()=>Bn("tasks-updated")),zt.projects=ap(t,()=>Bn("projects-updated")),zt.labels=ep(t,()=>Bn("labels-updated")),zt.timeBlocks=up(t,()=>Bn("timeblocks-updated")),zt.filters=Xg(t,()=>Bn("filters-updated"))}function ua(e=!1){(Tr||e)&&console.log("[DataSync] Stopping data sync..."),Object.keys(zt).forEach(t=>{t==="workspaces"&&!e||typeof zt[t]=="function"&&(zt[t](),zt[t]=null)}),fp(),Gg(),Tr=!1,mn()}const Ko={tasks:Sn,projects:Hr,labels:Qg,timeBlocks:ue,filters:pd,workspaceId:()=>Zt()};function Uu(){return zt.workspaces}function Wu(e){zt.workspaces=e}function U_(){const e=document.getElementById("sort-trigger"),t=document.getElementById("sort-menu"),n=document.getElementById("sort-label"),i=document.querySelectorAll(".sort-option");if(!e||!t||!n)return;const s=r=>{r?(t.classList.replace("opacity-0","opacity-100"),t.classList.replace("invisible","visible"),t.classList.replace("scale-95","scale-100"),t.classList.replace("pointer-events-none","pointer-events-auto"),document.addEventListener("click",o)):(t.classList.replace("opacity-100","opacity-0"),t.classList.replace("visible","invisible"),t.classList.replace("scale-100","scale-95"),t.classList.replace("pointer-events-auto","pointer-events-none"),document.removeEventListener("click",o))},o=r=>{r&&(t.contains(r.target)||e.contains(r.target))||s(!1)};e.addEventListener("click",r=>{r.stopPropagation();const a=t.classList.contains("opacity-100");s(!a)}),i.forEach(r=>{r.addEventListener("click",a=>{const l=r.dataset.value,c=r.textContent;n.textContent=c,e.dataset.value=l,mn(),s(!1)})}),e.dataset.value||(e.dataset.value="createdAt_desc",n.textContent="作成日(新しい順)")}function W_(e,t){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function Y_(){var n;let e=!0;document.addEventListener("workspace-changed",i=>{const{workspaceId:s}=i.detail;console.log("[EventManager] Workspace changed to:",s);const o=document.getElementById("header-title");if(o&&(o.textContent="読み込み中..."),V!=null&&V.currentUser){if(e){e=!1;try{const r=JSON.parse(localStorage.getItem("lastPage"));ls(r?{type:r.page,id:r.id||null}:{type:"inbox"})}catch{ls({type:"inbox"})}}else ls({type:"inbox",id:null});ua(!1),V_(),mn()}}),document.addEventListener("route-change",i=>{const{page:s,id:o}=i.detail;ls({type:s,id:o||null}),localStorage.setItem("lastPage",JSON.stringify({page:s,id:o||null})),mn()});const t=W_(()=>mn(),300);(n=document.getElementById("search-input"))==null||n.addEventListener("input",t),U_()}function q_(){try{sh()}catch(e){console.error("Firebase Initialization Failed",e);return}bp(),$p(),Sp(),_d(),Rc(),Y_(),G_()}function G_(){V&&Zu(V,e=>{dh(e),e?X_(e):K_()})}function X_(e){ob();const t=Uu();typeof t=="function"&&t();const n=ph(e.uid,i=>{wd(i)});Wu(n)}function K_(){const e=Uu();typeof e=="function"&&(e(),Wu(null)),ua(!0),gb(),Rc()}function J_(){q_()}let Lc=!1;function Z_(e){const t=document.createElement("div");t.id=db.CRITICAL_ERROR_OVERLAY,t.style.cssText=`
        position: fixed; top: 0; left: 0; width: 100%; height: 100%;
        background: rgba(0,0,0,0.9); color: white; display: flex;
        flex-direction: column; align-items: center; justify-content: center;
        z-index: 9999; font-family: sans-serif; text-align: center; padding: 20px;
    `,t.innerHTML=`
        <h1 style="color: #ff4d4d; margin-bottom: 10px;">Critical Initialization Error</h1>
        <p style="margin-bottom: 20px;">アプリケーションの起動に失敗した。リロードを試してくれ。</p>
        <code id="error-code-box" style="background: #333; padding: 10px; border-radius: 4px; font-size: 12px; display: block; max-width: 80%; overflow-x: auto; margin-bottom: 20px;"></code>
        <button id="error-reload-btn" style="padding: 10px 20px; cursor: pointer; background: #444; border: 1px solid #666; color: white; border-radius: 4px; transition: background 0.2s;">再読み込み</button>
    `;const n=t.querySelector("#error-code-box");n&&(n.textContent=e.message);const i=t.querySelector("#error-reload-btn");i&&(i.addEventListener("click",()=>location.reload()),i.addEventListener("mouseover",()=>{i.style.background="#555"}),i.addEventListener("mouseout",()=>{i.style.background="#444"})),document.body.appendChild(t)}function Q_(){document.querySelectorAll("link[rel*='icon']").forEach(t=>t.remove());const e=document.createElement("link");e.rel="icon",e.type="image/png",e.href=cb.FAVICON,document.head.appendChild(e)}async function Oc(){if(!Lc){Lc=!0;try{Q_(),await J_()}catch(e){console.error("[Main] Critical Initialization Error:",e),Z_(e)}}}(()=>{if(document.readyState==="loading"){const e=()=>{document.removeEventListener("DOMContentLoaded",e),Oc()};document.addEventListener("DOMContentLoaded",e)}else Oc()})();
