import{r as i,R as C,j as r}from"./react-vendor-D2I7O6xs.js";import{u as E,a as N,a4 as y,a5 as W,a6 as M,a7 as D,a8 as R,I as S,B as x}from"./main-ClMj7z8a.js";import{E as I}from"./ErrorMessage-ysv-5oYb.js";import{M as L}from"./Modal-DaVDF2P-.js";import"./vendor-CBsUEP5T.js";import"./dnd-CO_aCEbe.js";import"./firebase-CLDmeQtM.js";import"./i18n-Cw5F73yC.js";const H=({isOpen:_,data:b,zIndex:B})=>{const{t:e}=E(),{closeModal:o,openModal:d}=N(),c=!!_,a=b,n=!!(a!=null&&a.id),[p,g]=i.useState(""),[m,u]=i.useState(!1),[f,l]=i.useState(null),h=C.useRef(null);i.useEffect(()=>{c&&(g((a==null?void 0:a.name)||""),l(null),u(!1))},[c,a]),i.useEffect(()=>{var t;f&&((t=h.current)==null||t.focus())},[f]);const k=i.useCallback(async()=>{const t=p.trim();if(!t){l(e("validation.workspace_name_required"));return}if(y().some(s=>s.name===t&&s.id!==(a==null?void 0:a.id))){l(e("validation.workspace_duplicate"));return}u(!0),l(null);try{if(n&&(a!=null&&a.id))await W(a.id,t),o();else{const s=await M(t);s!=null&&s.id?(o(),d("confirmation",{title:e("modal.workspace_create_title"),message:e("validation.workspace_confirm_switch"),confirmLabel:e("modal.ok"),onConfirm:()=>D(s.id)})):o()}}catch(s){l(e("validation.save_fail")+": "+(s.message||"Error")),u(!1)}},[p,n,a,o,d,e]),w=i.useCallback(()=>{if(!(a!=null&&a.id))return;if(y().length<=1){l(e("validation.workspace_delete_last")||"Cannot delete the last workspace.");return}o(),d("confirmation",{title:e("delete"),message:e("msg.confirm_delete_workspace")||`Are you sure you want to delete workspace "${a.name}"?`,confirmLabel:e("delete"),variant:"danger",onConfirm:async()=>{try{await R(a.id)}catch(v){console.error("Failed to delete workspace:",v)}}})},[a,o,d,e]),j=t=>{t.key==="Enter"&&!t.nativeEvent.isComposing&&k()};return c?r.jsx(L,{isOpen:c,onClose:o,className:"max-w-md",children:r.jsxs("div",{className:"flex flex-col gap-6 max-h-[85vh] overflow-y-auto p-1",children:[r.jsx("div",{children:r.jsx(S,{ref:h,id:"workspace-name-input",name:"workspaceName",label:e(n?"modal.workspace_edit_title":"modal.workspace_create_title"),type:"text",value:p,onChange:t=>g(t.target.value),onKeyDown:j,placeholder:e("modal.workspace_name_placeholder"),className:"w-full text-lg font-bold bg-transparent border-none outline-none text-gray-800 dark:text-gray-100 placeholder-gray-300 dark:placeholder-gray-600 px-0 py-0 h-auto focus:ring-0",autoFocus:!0})}),r.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-400 leading-relaxed",children:e(n?"modal.workspace_desc_edit":"modal.workspace_desc_create")}),r.jsx(I,{message:f}),r.jsxs("div",{className:"flex justify-between items-center pt-4 border-t border-gray-200 dark:border-gray-700",children:[r.jsx("div",{children:n&&r.jsx(x,{onClick:w,disabled:m,variant:"ghost",className:"text-red-500 hover:text-red-700 hover:bg-red-50 dark:hover:bg-red-900/20 px-2",children:e("delete")})}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx(x,{onClick:o,disabled:m,variant:"ghost",className:"text-gray-500 hover:text-gray-800 dark:hover:text-gray-200",children:e("modal.cancel")}),r.jsx(x,{onClick:k,disabled:m,isLoading:m,variant:"primary",children:e(n?"modal.save":"modal.create")})]})]})]})}):null};export{H as WorkspaceEditModal};
