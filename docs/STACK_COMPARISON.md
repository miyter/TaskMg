# 開発環境・技術スタック比較：現状 vs 理想

このドキュメントでは、TaskMg の現在の構成と、今後の拡張性・信頼性を最大化するための「理想の構成」を比較します。
**※理想の構成も、個人利用の範囲内では「完全無料」で運用可能な技術を厳選しています。**

## 📊 比較サマリー

| 比較項目 | 現在の構成 (Standard Stack) | 理想の構成 (Modern Reliable Stack) | 改善のポイント |
| :--- | :--- | :--- | :--- |
| **Backend (DB)** | Firebase Firestore (NoSQL) | **Supabase (PostgreSQL)** | 複雑なデータの関連付けと検索の高速化 |
| **Data Sync** | 自作 Cache + Zustand | **TanStack Query (React Query)** | 負債の温床である同期ロジックの排除 |
| **Frontend** | Vite + React (SPA) | **Next.js (App Router)** | 初期読み込み高速化とルーティングの堅牢化 |
| **State管理** | Zustand (Global & Persist) | **Signals (or Typed States)** | 1箇所の変更による過剰レンダリングの抑制 |
| **型安全性** | 手動型定義 + Zod | **End-to-End Type Safety** | DB定義からフロントの型を自動生成し、不整合をゼロに |
| **デプロイ** | Cloudflare Workers | **Cloudflare Pages / Vercel** | 維持費 0 円のサーバーレス環境 |

---

## 🛠️ 深掘り比較

### 1. データベース (DB)
- **現状 (Firestore)**: 
    - **課題**: 「タスクとタイムブロック」のような紐付け検索が不得意。並び替え（Order）の原子性がなく、大量データの操作時にデータが壊れやすい。
- **理想 (Supabase/PostgreSQL)**:
    - **解決**: 複雑な検索や並び替えを SQL 一行で処理可能。ワークスペース削除時の「一括削除（Cascade Delete）」が完璧に機能し、データの孤立を防ぐ。
    - **コスト**: Free Tier で 500MB 程度のデータ（タスク数万件分）まで完全無料。

### 2. データ同期とキャッシュ
- **現状 (自作ロジック)**:
    - **課題**: `FirestoreCollectionCache` などの自作コードが多く、競合（Race Condition）や ID 漏洩などのバグが発生しやすい。AI がこれ以上複雑な同期を管理するのが限界。
- **理想 (TanStack Query)**:
    - **解決**: 業界標準のライブラリに同期を丸投げ。自動再試行、ページネーション、楽観的更新の標準化により、バグが入り込む余地を 80% 削減。

### 3. パフォーマンス (レンダリング)
- **現状 (React Standard)**:
    - **課題**: 全件再レンダリングが発生しやすく、タスクが増えると UI がカクつく。DOM操作（リッチテキスト変換）が重い。
- **理想 (Next.js + Signals)**:
    - **解決**: 「変わった部分だけ」をピンポイントで更新する仕組みを導入。重い処理はサーバーサイド（SSR）で事前に済ませることで、モバイルでも爆速で動作。

---

## 🚀 なぜ「今」この比較をするのか？

現在の TaskMg は、AI（Google Antigravity）の力で「機能」を積み上げましたが、土台（Firebase × 自作Cache）の限界が来ています。

### もし「理想の環境」で作り直す（リビルド）した場合のメリット：
1. **バグの自然消滅**: 今 `KNOWN_ISSUES.md` にあるデータの整合性や無限ループの問題の多くは、技術スタックの標準機能によって「そもそも発生し得ない」状態になります。
2. **AI の生産性向上**: 理想のスタックは「テンプレート」が強力なため、AI がより正確で高品質なコードを生成しやすくなります。
3. **将来の拡張性**: Wiki や目標ダッシュボードを後から追加しても、データベースの設計がしっかりしているため、今の 1/3 の労力で実装可能になります。

## 💰 運用コストについて
紹介した「理想の構成」は、以下の無料枠を組み合わせることで、月額 0 円で本番運用が可能です。
- **Supabase**: データベース、認証、ストレージ（無料枠内）
- **Cloudflare Pages**: フロントエンドホスティング（無制限）
- **Next.js**: オープンソースフレームワーク
