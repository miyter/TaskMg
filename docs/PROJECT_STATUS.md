# TaskMg プロジェクト状況ドキュメント

**最終更新**: 2026-01-02

## 📝 プロダクト概要
**TaskMg** は、目標達成とタスク管理を統合した先進的な Web アプリケーションです。
**「目標（Target）から逆算して、日々の行動（Task）を設計する」** というコンセプトの元、OKR、WOOP、バックワード・デザインといった複数のフレームワークをシームレスに利用できます。

ファイル総数: 144 ファイル
総行数(LOC): 11,779 行

### 主な機能
- **高度なタスク管理**: プロジェクト・ラベル・時間帯フィルタに加え、AND/OR 複合条件による柔軟な検索が可能。繰り返しタスク（日次/週次/月次）にも対応。
- **目標ダッシュボード (Target Dashboard)**: ウィザード形式で作成した目標を可視化し、日々のタスクとリンクさせて管理。
- **マルチワークスペース**: 完全に分離されたデータ環境で、仕事・プライベートなど複数のコンテキストをスイッチ可能。
- **フレームワーク Wiki**: アプリ内蔵のナレッジベースにより、OKR・WOOP・バックワードデザイン等のベストプラクティスを即座に参照。
- **タイムブロック管理**: 時間帯ごとにタスクを分類・フィルタリング。朝・昼・夜など柔軟に設定可能。
- **ドラッグ＆ドロップ**: タスク・プロジェクト・サイドバーセクションの並び替えをスムーズに実行。
- **多言語対応 (i18n)**: 日本語・英語の切り替えに対応。UIの全域で一貫したローカライズ。
- **リアルタイム同期**: Firebase Firestore によるリアルタイムデータ同期。複数デバイス間で即座に反映。
- **ダークモード**: システム設定に連動、または手動切り替えが可能なダークテーマ。
- **オフライン対応 & 信頼性**: Optimistic Update と失敗時の自動ロールバック機能を備え、不安定なネットワーク環境でも快適に動作。

---

## 🏗️ 技術スタック

| カテゴリ | 技術 | ポイント |
|----------|------|------------|
| **Frontend** | React 18, TypeScript 5, Vite 6 | 型安全性 100% の堅牢なコードベース |
| **State** | Zustand 5 | グローバル状態と UI 状態の一元管理 |
| **Backend** | Firebase Firestore 10 | リアルタイム同期とオフライン対応 |
| **Auth** | Firebase Auth 10 | 堅牢な認証システム |
| **Hosting** | Cloudflare Workers | 高速なエッジネットワーク配信 |
| **Styling** | Tailwind CSS 3 | プレミアムなデザインシステムとレスポンシブ対応 |
| **DnD** | @dnd-kit/core 6, @dnd-kit/sortable 10 | タスク・セクションのドラッグ&ドロップ |
| **Cache** | @tanstack/react-query 5 | 効率的なデータ取得とキャッシュ管理 |
| **Date** | date-fns 4, date-fns-tz 3 | 日付操作とタイムゾーン管理 |

---

## 📁 ディレクトリ構造 (概要)

```
src/
├── components/      # UIコンポーネント (layout, modals, tasks, sidebar 等)
├── features/        # 機能モジュール (target-dashboard, wiki, wizard)
├── hooks/           # カスタムフック (データ購読, DnD, テーマ管理)
├── store/           # 状態管理 (Zustand ストアおよび Firestore CRUD)
├── core/            # Firebase 設定・認証・i18n
├── logic/           # 純粋なビジネスロジック (検索, フィルタ解析)
└── utils/           # 汎用ユーティリティ
```

---

## 🧠 アーキテクチャ・設計思想

### レイヤー分離
- **UI層** (`components/`): 純粋な表示責務。ビジネスロジックを持たない。
- **Hook層** (`hooks/`): データ購読とコンポーネントへの橋渡し。副作用の管理。
- **Store層** (`store/`): Zustand による UI 状態 + Firestore CRUD 操作のカプセル化。
- **Logic層** (`logic/`): 純粋関数によるビジネスロジック。テスト容易性を確保。
- **Core層** (`core/`): インフラ設定、認証、国際化などの基盤機能。

### 状態管理戦略
- **Server State**: Firestore のリアルタイム購読 (`onSnapshot`) + React Query によるキャッシュ管理。
- **UI State**: Zustand + `persist` middleware で localStorage に永続化。
- **Derived State**: `useMemo` / セレクタで計算。不要な再レンダリングを抑制。

### データフロー
```
Firestore → subscribeToXxx() → React Query Cache → Hook → Component
     ↑                                                ↓
     └──────── addXxx() / updateXxx() ←───────────────┘
```

### 設計原則
1. **型安全性**: Zod スキーマによるランタイムバリデーション + TypeScript の静的型付け。
2. **関心の分離**: `store/xxx.ts` (公開API) と `store/xxx-raw.ts` (内部実装) の分離。
3. **統一シグネチャ**: 全 subscribe 関数は `(workspaceId, callback)` 形式に統一。
4. **エラー可視化**: Toast 通知によるユーザーフィードバックと自動ロールバック。
5. **i18n**: ネストされたキー構造による型安全な翻訳管理。
6. **i18nアーキテクチャ**:
    - **Data/Logic/Hook分離**: 辞書データ(`core/i18n/constants`)、純粋関数(`core/i18n/utils`)、Hook(`hooks/useTranslation`)を厳密に分離。
    - **依存方向**: UI/Hook → Core/Logic/Store (StoreはHookに依存しない)。
    - **Store層での利用**: Store内では`useSettingsStore.getState()`と言語別純粋関数を用いて翻訳を行う。Hookは使用しない。

---

## 🎨 UI/UX 設計思想

TaskMg は個人利用を主眼とした生産性ツールとして、**「引き算の美学」** を徹底的に追求したモダンでスタイリッシュなデザインを採用しています。
ユーザーが求めるのは「密度が高く、しかし散らからない」体験——必要最小限の情報だけを常に表示し、余計な要素は徹底的に排除。一画面に情報を詰め込まず、コンテキストに応じてパネル化・画面遷移で情報を段階的に開示します。

### デザイン原則
1. **ミニマリズムと引き算のデザイン**  
   視覚的ノイズを極限まで削減。余白を効果的に使い、要素は本当に必要なものだけを表示。装飾は最小限に抑え、機能美を優先。

2. **情報密度とコンパクトさ**  
   一覧画面では高密度で多くの項目を表示可能にしつつ、フォーカスが必要な場面では「今必要な情報だけ」を強調。過剰なアニメーションや装飾は排除。

3. **コンテキスト適応と段階的開示**  
   デフォルトでは必要最小限の情報のみ表示。アコーディオンパネル、カルーセル、モーダル、画面遷移を活用して、ユーザーが能動的に情報を展開できる設計。「一画面であれもこれも」は厳禁。

4. **直感性と操作の軽快さ**  
   複雑な機能（高度なフィルタ、DnD、タイムブロック）も、ドラッグやシンプルなクリックだけで完結。学習コストを最小化。

5. **一貫性と洗練されたビジュアル**  
   Tailwind CSS を基盤とした統一デザインシステム。ニュートラルなカラーパレットに控えめなアクセントカラー。グラスモーフィズムと微かな影で現代的な階層感を表現。

6. **アクセシビリティ**  
   WCAG 準拠、キーボード操作対応、高コントラスト（ダークモード含む）、十分なタップ領域を確保。

### 主要UIパターン
- **サイドバー中心のナビゲーション**  
  Todoist/Notion 風の常時表示サイドバーで主要項目（プロジェクト、ラベル、タイムブロック、目標）をコンパクトに一覧。折りたたみ可能で画面スペースを最大限確保。

- **アコーディオンとパネル化**  
  サイドバーのセクションや詳細画面でアコーディオンを多用。デフォルトは閉じておき、必要な時だけ展開。情報過多を防ぐ。

- **モーダル中心の詳細・編集体験**  
  タスク詳細・編集、設定変更はフルスクリーンモーダル（特にモバイル）で集中環境を提供。メイン画面を汚さずコンテキストを切り替え。

- **カルーセルと画面遷移による段階的情報提示**  
  目標ダッシュボードやウィザードでは、必要なステップだけを順次表示。横スワイプやページネーションで情報を分離。

- **ビジュアル言語**  
  - カラーパレット：ニュートラルグレー基調 + 控えめなアクセントカラー（プロジェクト/ラベル識別用）
  - タイポグラフィ：クリーンなサンセリフフォント、適切なウェイト階層
  - アイコン：ミニマルな線アイコン（Lucide など）
  - モーション：必要最小限のスムーズなトランジションのみ（過剰なアニメーションは排除）

### レスポンシブ設計
- **モバイルファーストアプローチ**  
  スマートフォンではフルスクリーンモーダル、ボトムシート、縦方向スクロールを優先。タップしやすく、片手操作を意識。

- **デスクトップ対応**  
  ワイド画面ではサイドバー + メインコンテンツの2カラムレイアウトで情報密度を最大化。ウィンドウサイズに応じて柔軟に調整。

- **統一体験**  
  デバイス間で操作感・ビジュアルを極力一致させつつ、各デバイスの特性を活かした最適化を実施。

### コンポーネント設計方針
- **Atomic Design に準拠**  
  Atoms（ボタン、入力、アイコン）→ Molecules（タスクアイテム、フィルタチップ）→ Organisms（タスクリスト、サイドバーセクション）の階層で構築。

- **再利用性最優先**  
  SortableItem、AccordionSection、Modal などの汎用コンポーネントを共通化。タスク/プロジェクト/ラベルで同一コンポーネントを共有。

- **場所**  
  共通コンポーネントは `components/common/` に、機能特化コンポーネントは各 feature ディレクトリに配置。

この設計思想により、TaskMg は「見た目が美しいだけでなく、毎日使いたくなる」ツールを目指しています。シンプルで洗練されたインターフェースが、集中力を妨げず目標達成を静かに支えます。

---

## 🔄 現在のステータス

 **健全性: 極めて良好（全ての主要課題が解決済み）**


