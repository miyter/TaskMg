# TaskMg Known Issues & Roadmap

## 🚀 残存課題

### 【優先度: 高】アーキテクチャ・型安全性の債務
- **完全な多言語化 (i18n) の完遂**: 内部的には翻訳基盤が整っているが、実際には多くのUIラベル、エラーメッセージ、日付表記等が未対応または和英混在となっている（特に英語UI）。

### 【優先度: 中】UI/UXリファクタリング課題



---

## 🏗️ Long-Term Roadmap

- **完全な多言語化 (i18n)**: 主要なモーダルおよびサイドバーの大部分の対応完了。残るはUIラベルの統一とエラーメッセージ等。
- **Firestore制約**: `WorkspaceEditModal` 等でのサーバー側ユニーク制約の検討。
- **定数値の集約**: 引き続きマジックナンバーの抽出を進める。

---

## 🎨 UI/UXリファクタリング課題 (Design Compliance)

`docs/PROJECT_STATUS.md` の「🎨 UI/UX 設計思想」に基づくリファクタリング対象。


### 【優先度: 中】サイドバーコンポーネントの改善

> **修正方針**: 以下は`tsc --noEmit`エラーにならない限りコンパイルは通るが、設計原則違反のためリファクタリング対象。

#### SidebarContent.tsx
| 項目 | 現状 | 対応 |
|------|------|------|
| (なし) | - | - |

#### Modal.tsx
| 項目 | 現状 | 対応 |
|------|------|------|
| レスポンシブ挙動 | モバイルファーストで常に大型モーダル | デスクトップではサイドパネルへの切り替え等を検討 |

#### CustomFilterList.tsx
| 項目 | 現状 | 対応 |
|------|------|------|
| (なし) | - | - |

#### Dashboard
| 項目 | 現状 | 対応 |
|------|------|------|
| (なし) | - | - |

### 【優先度: 高】アーキテクチャ・型安全性の債務

> **修正方針**: 設計思想 (`PROJECT_STATUS.md`) との乖離が大きい項目。

| カテゴリ | 課題内容 | 影響 |
|----------|----------|------|
| (なし) | - | - |


### 【優先度: 低】アイコン統一性
- (なし)


---

## 📋 リファクタリング時の注意事項

1. **アニメーション削除時**: `transition-*`、`duration-*`、`animate-*`クラスを削除。静的表示に変更。
2. **影の削減時**: `shadow-2xl`→`shadow-md`→`shadow`の順で控えめに。完全削除も可。
3. **i18n対応時**: `src/core/translations.ts`にキーを追加し、`t('key')`で参照。
4. **アクセシビリティ**: `aria-expanded={isOpen}`、`aria-controls="panel-id"`を追加。
5. **By Design除外**: `SortableItem.tsx`の`isDragging`時opacity変更はDnDフィードバックとして必要最小限のため現状維持を検討。

---

## 📝 Design Decisions (By Design)
- **Legacy Exports**: API互換性のため、`auth.ts` のプロキシ関数は維持。
- **Inline Styles**: 動的な色指定には Tailwind ではなく `style` 属性を使用。
- **Mobile Behavior**: サイドバーはモバイルでの初期状態を「折りたたみ」とする。
- **Localization Consistency (Work in Progress)**: 現在、日本語と英語が混在している箇所があるが、これは完全な i18n 移行への過渡期としての状態。
- **Facade Pattern (Data Flow)**: `store-raw.ts` は内部実装とし、外部からは `tasks.ts` 等のファサード関数を通じてのみアクセス。単一方向データフローを強制。
- **Optimistic Update with Rollback**: 失敗時は自動ロールバックとToast通知でユーザーに通知。
- **Modal Stack**: `ModalManager`はスタック方式で複数モーダルの重ね表示をサポート。これは設定画面からラベル編集を開く等のユースケースで必要。
- **Custom SVG Icons**: `Icons.tsx`は3つのみの軽量実装のため、Lucide等の外部ライブラリ追加より効率的。

---

## 🧪 Browser Test Plan (Last Run: 2026-01-02)

### 1. Loading & Cache Behavior
- [x] **初期ロード**: アプリを開いた際、Loadingスピナーが一瞬だけ（または全く）表示されず、キャッシュデータが即座に表示されること。
- [x] **ワークスペース切り替え**: サイドバーでワークスペースを切り替えた際、スムーズに新しいデータに切り替わること。
- [x] **リロード**: ページをリロードした際、Loading状態を表示してFirebaseセッションを復元。ログイン画面が一瞬表示される問題を解消。

### 2. Internationalization (i18n)
- [x] **日本語表示**: サイドバーのプロジェクト一覧が空の場合「プロジェクトはありません」、所要時間リストが「15分」のように表示されること。
- [ ] **英語切り替え**: 設定から言語を英語に切り替え、上記箇所が「No projects」「15 min」等に即座に切り替わること。(※多くのラベルが未対応)

### 3. Basic Regressions
- [x] **タスク操作**: タスクの追加、編集、削除がエラーなく動作すること。
- [x] **DnD**: タスクの並び替えがスムーズに行えること。
- [x] **コンソールエラー**: 開発者ツールのConsoleに重大なエラーが出ていないこと。
- [x] **検索体験刷新**: モダンなグラスモーフィズムデザインで検索画面を刷新。サイドバーからのみ検索にアクセス。
- [x] **Fire-and-Forget改善**: `updateTaskStatusRaw`, `updateTaskRaw`, `deleteTaskRaw` に失敗時ロールバックとToast通知を追加。
